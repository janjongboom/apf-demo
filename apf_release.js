var apf={VERSION:"3.0beta",CDN:"",READY:false,NODE_HIDDEN:101,NODE_VISIBLE:102,NODE_O3:103,KEYBOARD:2,KEYBOARD_MOUSE:true,SUCCESS:1,TIMEOUT:2,ERROR:3,OFFLINE:4,debug:false,includeStack:[],initialized:false,AppModules:[],autoLoadSkin:false,started:false,crypto:{},config:{},_GET:{},$asyncObjects:{"apf.oHttp":1},basePath:"./",ns:{apf:"http://ajax.org/2005/aml",aml:"http://ajax.org/2005/aml",xsd:"http://www.w3.org/2001/XMLSchema",xhtml:"http://www.w3.org/1999/xhtml",xslt:"http://www.w3.org/1999/XSL/Transform",xforms:"http://www.w3.org/2002/xforms",ev:"http://www.w3.org/2001/xml-events"},availHTTP:[],releaseHTTP:function(a){if(apf.brokenHttpAbort){return;}if(self.XMLHttpRequestUnSafe&&a.constructor==XMLHttpRequestUnSafe){return;}a.onreadystatechange=function(){};a.abort();this.availHTTP.push(a);},browserDetect:function(){if(this.$bdetect){return;}this.$bdetect=true;var l=navigator.userAgent.toLowerCase()||"";this.isOpera=(self.opera&&Object.prototype.toString.call(self.opera)=="[object Opera]");this.isKonqueror=l.indexOf("konqueror")!=-1;this.isSafari=/a/.__proto__=="//";this.isSafariOld=false;this.isIphone=l.indexOf("iphone")!=-1||l.indexOf("aspen simulator")!=-1;this.isChrome=Boolean(/source/.test((/a/.toString+"")))||l.indexOf("chrome")!=-1;this.isWebkit=this.isSafari||this.isChrome||this.isKonquerer;if(this.isWebkit){var i=l.match(/applewebkit\/(\d+)/);if(i){this.webkitRev=parseInt(i[1]);this.isSafariOld=parseInt(i[1])<420;}}this.isGecko=(function(m){m[m]=m+"";return m[m]!=m+"";})(new String("__count__"));this.isGecko3=this.isGecko&&(function a(){})[-5]=="x";this.isGecko35=this.isGecko&&(/a/[-1]&&Object.getPrototypeOf)?true:false;this.versionGecko=this.isGecko?parseFloat(l.match(/(?:firefox|gecko)\/([\d\.]+)/i)[1]):-1;var d;this.isIE=!+"\v1";if(this.isIE){this.isIE=parseFloat(l.match(/msie ([\d\.]*)/)[1]);}this.isIE8=this.isIE==8&&(d=true);this.isIE7=!d&&this.isIE==7&&(d=true);if(this.isIE==8&&document.documentMode==7){apf.isIE7=true;apf.isIE8=false;apf.isIE7Emulate=true;apf.isIE=7;}this.isIE6=!d&&this.isIE==6&&(d=true);var c=(navigator.platform.match(/mac|win|linux/i)||["other"])[0].toLowerCase();this.isWin=(c=="win");this.isMac=(c=="mac");this.isLinux=(c=="linux");this.isAIR=l.indexOf("adobeair")!=-1;try{}catch(j){this.isDeskrun=false;}},setCompatFlags:function(){this.TAGNAME=apf.isIE?"baseName":"localName";this.styleSheetRules=apf.isIE?"rules":"cssRules";this.brokenHttpAbort=apf.isIE6;this.canUseHtmlAsXml=apf.isIE;this.supportNamespaces=!apf.isIE;this.cannotSizeIframe=apf.isIE;this.hasConditionCompilation=apf.isIE;this.supportOverflowComponent=apf.isIE;this.hasEventSrcElement=apf.isIE;this.canHaveHtmlOverSelects=!apf.isIE6&&!apf.isIE5;this.hasInnerText=apf.isIE;this.hasMsRangeObject=apf.isIE;this.descPropJs=apf.isIE;this.hasClickFastBug=apf.isIE;this.hasExecScript=window.execScript?true:false;this.canDisableKeyCodes=apf.isIE;this.hasTextNodeWhiteSpaceBug=apf.isIE||apf.isIE>=8;this.hasCssUpdateScrollbarBug=apf.isIE;this.canUseInnerHtmlWithTables=!apf.isIE;this.hasSingleResizeEvent=!apf.isIE;this.hasStyleFilters=apf.isIE;this.supportOpacity=!apf.isIE;this.supportPng24=!apf.isIE6&&!apf.isIE5;this.cantParseXmlDefinition=apf.isIE50;this.hasDynamicItemList=!apf.isIE||apf.isIE>=7;this.canImportNode=apf.isIE;this.hasSingleRszEvent=!apf.isIE;this.hasXPathHtmlSupport=!apf.isIE;this.hasFocusBug=apf.isIE;this.hasReadyStateBug=apf.isIE50;this.dateSeparator=apf.isIE?"-":"/";this.canCreateStyleNode=!apf.isIE;this.supportFixedPosition=!apf.isIE||apf.isIE>=7;this.hasHtmlIdsInJs=apf.isIE&&apf.isIE<8||apf.isWebkit;this.needsCssPx=!apf.isIE;this.hasCSSChildOfSelector=!apf.isIE||apf.isIE>=8;this.styleAttrIsObj=apf.isIE<8;this.hasAutocompleteXulBug=apf.isGecko;this.loadsLocalFilesSync=apf.isIE||apf.isGecko;this.mouseEventBuffer=apf.isIE?20:6;this.hasComputedStyle=typeof document.defaultView!="undefined"&&typeof document.defaultView.getComputedStyle!="undefined";this.supportCSSAnim=apf.isWebkit&&(apf.webkitRev>525);this.w3cRange=Boolean(window.getSelection);this.locale=(apf.isIE?navigator.userLanguage:navigator.language).toLowerCase();this.characterSet=document.characterSet||document.defaultCharset||"utf-8";var c=document.createElement("div");this.hasContentEditable=(typeof c.contentEditable=="string"||typeof c.contentEditable=="boolean");c=null;delete c;this.supportVML=apf.isIE;this.supportSVG=!apf.isIE;this.hasHtml5XDomain=apf.versionGecko>=3.5;this.supportCanvas=!!document.createElement("canvas").getContext;this.supportCanvasText=!!(this.supportCanvas&&typeof document.createElement("canvas").getContext("2d").fillText=="function");this.hasVideo=!!document.createElement("video")["canPlayType"];this.hasAudio=!!document.createElement("audio")["canPlayType"];this.hasGeolocation=!!navigator.geolocation;this.supportHashChange=("onhashchange" in self)&&!apf.isIE7Emulate||apf.isIE8;c=document.createElement("input");var a=this;(function(j){for(var d in j){c.setAttribute("type",d);a["hasInput"+d.charAt(0).toUpperCase()+d.substr(1).replace("-l","L")]=!!(c.type!=="text");}})({search:1,tel:1,url:1,email:1,datetime:1,date:1,month:1,week:1,time:1,"datetime-local":1,number:1,range:1,color:1});c=null;delete c;this.maxHttpRetries=apf.isOpera?0:3;this.percentageMatch=new RegExp();this.percentageMatch.compile("([\\-\\d\\.]+)\\%","g");this.reMatchXpath=new RegExp();this.reMatchXpath.compile("(^|\\|)(?!\\@|[\\w-]+::)","g");apf.isGears=!!apf.initGears()||0;},extend:function(c,j){var l,d,a=!c.notNull;if(arguments.length==2){for(l in j){if(a||j[l]){c[l]=j[l];}}return c;}for(d=1;d<arguments.length;d++){j=arguments[d];for(l in j){if(a||j[l]){c[l]=j[l];}}}return c;},$extend:function(a,c){for(var d in c){a[d]=c[d];}return a;},ajax:function(){return this.oHttp.get.apply(this.oHttp,arguments);},start:function(){this.started=true;var w=location.href.split("#")[0].split("?")[0];this.host=location.hostname&&w.replace(/(\/\/[^\/]*)\/.*$/,"$1");this.hostPath=w.replace(/\/[^\/]*$/,"")+"/";this.setCompatFlags();if(this.isIE){apf.runIE();}if(apf.isWebkit){apf.runWebkit();}if(this.isOpera){apf.runOpera();}if(this.isGecko||!this.isIE&&!apf.isWebkit&&!this.isOpera){apf.runGecko();}for(var z,q,B,s,j,d,C,c=location.href.split(/[?&]/),t=c.length,u=1;u<t;u++){if(s=c[u].match(/(.*?)(\..*?|\[.*?\])?=([^#]*)/)){j=decodeURI(s[1]).toLowerCase(),d=this._GET;if(s[2]){for(B=decodeURI(s[2]).replace(/\[\s*\]/g,"[-1]").split(/[\.\[\]]/),z=0,q=B.length;z<q;z++){C=B[z],d=d[j]?d[j]:d[j]=(parseInt(C)==C)?[]:{},j=C.replace(/^["\'](.*)["\']$/,"$1");}}d[j!="-1"?j:d.length]=unescape(decodeURI(s[3]));}}this.oHttp=new this.http();this.Init.addConditional(this.parseAppMarkup,apf,["body"]);try{if(apf.isIE){document.execCommand("BackgroundImageCache",false,true);}}catch(A){}this.started=true;if(this.load_done){this.execDeferred();}this.root=true;for(var z=0;z<apf.$required.length;z++){apf.include(apf.$required[z]);}apf.require=apf.include;},nsqueue:{},findPrefix:function(c,j){var d;if(c.nodeType==9){if(!c.documentElement){return false;}if(c.documentElement.namespaceURI==j){return c.prefix||c.scopeName;}d=c.documentElement;}else{if(c.namespaceURI==j){return c.prefix||c.scopeName;}d=c.ownerDocument.documentElement;if(d&&d.namespaceURI==j){return c.prefix||c.scopeName;}while(c.parentNode){c=c.parentNode;if(c.namespaceURI==j){return c.prefix||c.scopeName;}}}if(d){for(var a=0;a<d.attributes.length;a++){if(d.attributes[a].nodeValue==j){return d.attributes[a][apf.TAGNAME];}}}return false;},importClass:function(c,a,i){if(!c){throw new Error(apf.formatErrorString(1018,null,"importing class","Could not load reference. Reference is null"));}if(!a){return apf.exec(c.toString(),i);}var d=c.toString().replace(/^\s*function\s*\w*\s*\([^\)]*\)\s*\{/,"").replace(/\}\s*$/,"");return apf.exec(d,i);},toString:function(){return"[Ajax.org Platform (apf)]";},all:[],implement:function(j){if(arguments.length==1){j.call(this);}else{for(var d,m=0,c=arguments.length;m<c;m++){d=arguments[m];arguments[m].call(this);}}return this;},uniqueHtmlIds:0,setUniqueHtmlId:function(a){var c;a.setAttribute("id",c="q"+this.uniqueHtmlIds++);return c;},getUniqueId:function(){return this.uniqueHtmlIds++;},lookup:function(a){return this.all[a];},findHost:function(c){while(c&&c.parentNode){try{if(c.host){break;}}catch(a){}c=c.parentNode;}return(c&&c.host&&typeof c.host!="string")?c.host:false;},setReference:function(a,c){return self[a]&&self[a].hasFeature?0:(self[a]=c);},console:{debug:function(d,a,c){},time:function(d,a,c){},log:function(d,a,c){},info:function(d,a,c){},warn:function(d,a,c){},error:function(d,a,c){},dir:function(a){this.info(apf.vardump(a,null,false).replace(/ /g,"&nbsp;").replace(/</g,"&lt;"));}},formatErrorString:function(d,j,i,c,m,l,a){apf.lastErrorMessage=c;return c;},getDirname:function(a){return((a||"").match(/^([^#]*\/)[^\/]*(?:$|\#)/)||{})[1];},getFilename:function(a){return((a||"").split("?")[0].match(/(?:\/|^)([^\/]+)$/)||{})[1];},getAbsolutePath:function(c,a){return !a||!c||a.match(/^\w+\:\/\//)?a:c.replace(/\/$/,"")+"/"+a;},include:function(i,a,l){apf.console.info("including js file: "+i);var c=a?apf.getAbsolutePath(apf.basePath||"",i):i;if(apf.isSafariOld&&!apf.started){document.write('<script type="text/javascript" src="'+c+'"><\/script>');}else{var j=document.getElementsByTagName("head")[0],d=document.createElement("script");if(l){d.setAttribute("_apf_type",l);}d.src=c;j.appendChild(d);}},$required:[],require:function(){var c=apf.getDirname(location.href),d=0,a=arguments.length;for(;d<a;d++){this.$required.push(apf.getAbsolutePath(c,arguments[d]));}},Init:{queue:[],cond:{combined:[]},done:{},add:function(a,c){if(this.inited){a.call(c);}else{if(a){this.queue.push([a,c]);}}},addConditional:function(c,d,a){if(typeof a!="string"){if(this.checkCombined(a)){return c.call(d);}this.cond.combined.push([c,d,a]);}else{if(self[a]){c.call(d);}else{if(!this.cond[a]){this.cond[a]=[];}this.cond[a].push([c,d]);this.checkAllCombined();}}},checkAllCombined:function(){for(var a=0;a<this.cond.combined.length;a++){if(!this.cond.combined[a]){continue;}if(this.checkCombined(this.cond.combined[a][2])){this.cond.combined[a][0].call(this.cond.combined[a][1]);this.cond.combined[a]=null;}}},checkCombined:function(a){for(var c=0;c<a.length;c++){if(!this.done[a[c]]){return false;}}return true;},run:function(a){this.inited=this.done[a]=true;this.checkAllCombined();var d=a?this.cond[a]:this.queue;if(!d){return;}for(var c=0;c<d.length;c++){d[c][0].call(d[c][1]);}}},amlParts:[],parseStrategy:0,parsePartialAml:function(i){var l;if(apf.isIE){l=function(E){try{var B={IMG:1,LINK:1,META:1,INPUT:1,BR:1,HR:1,AREA:1,BASEFONT:1},D=new RegExp(E.outerHTML.replace(/([\(\)\|\\\.\^\$\{\}\[\]])/g,"\\$1")+".*"+E.tagName),A=E.parentNode.outerHTML.replace(/\n/g,"").match(D),G=A[0]+">".replace(/(\w+)\s*=\s*([^\>="'\s ]+)( |\s|\>|\/\>)/g,'$1="$2"$3').replace(/ disabled /g," disabled='true' ").replace(/\]\]\&gt;/g,"]]>").replace(/<(\w+)(\s[^>]*[^\/])?>/g,function(J,I,K){if(B[I]){return"<"+I+(K||"")+"/>";}else{return J;}});}catch(F){return;}var C=apf.getAmlDocFromString("<div jid='"+(a++)+"' "+j+">"+G+"</div>").documentElement;while(C.childNodes.length>1){C.removeChild(C.lastChild);}apf.AppNode.appendChild(C);};}else{l=function(B){var C=B.outerHTML.replace(/ _moz-userdefined=""/g,""),A=apf.getAmlDocFromString("<div jid='"+(a++)+"' "+j+">"+C+"</div>").documentElement;while(A.childNodes.length>1){A.removeChild(A.lastChild);}if(apf.isWebkit){A=apf.AppNode.ownerDocument.importNode(A,true);}apf.AppNode.appendChild(A);};}var n=document.body.outerHTML.match(/(\w+)\s*=\s*["']http:\/\/ajax\.org\/2005\/aml["']/);if(!n){return false;}var j="xmlns:"+n[0],q=(RegExp.$1||"").toUpperCase();if(apf.isOpera){q=q.toLowerCase();}if(!q){return false;}q+=":";apf.AppNode=apf.getAmlDocFromString("<"+q.toLowerCase()+"application "+j+" />").documentElement;var w,o,t,c=false,a=0,d=document.body;while(d){c=d.nodeType==1&&d.tagName.substr(0,2)==q;if(c){l(t=d);if(apf.isIE){o=d;var s=1,m=o.nextSibling;if(m){o.parentNode.removeChild(o);while(m&&(m.nodeType!=1||m.tagName.indexOf(q)>-1)){if(m.nodeType==1){s+=m.tagName.charAt(0)=="/"?-1:1;}if(s==0){if(w){w.parentNode.removeChild(w);}w=m;break;}m=(o=m).nextSibling;if(!m){m=o;break;}if(o.nodeType==1){o.parentNode.removeChild(o);if(w){w.parentNode.removeChild(w);w=null;}}else{if(w){w.parentNode.removeChild(w);}w=o;}}d=m;}else{if(w){w.parentNode.removeChild(w);}w=o;}}else{if(w){w.parentNode.removeChild(w);}w=d;}if(apf.amlParts.length&&apf.amlParts[apf.amlParts.length-1][1]==t){apf.amlParts[apf.amlParts.length-1][1]=-1;}apf.amlParts.push([d.parentNode,apf.isIE?d.nextSibling:d.nextSibling]);}else{if(d.tagName=="SCRIPT"&&d.getAttribute("src")&&(d.getAttribute("src").indexOf("ajax.org")>-1)){var z=d.outerHTML.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/<SCRIPT[^>]*\>\s*<\!\[CDATA\[>?/i,"").replace(/<SCRIPT[^>]*\>(?:<\!\-\-)?/i,"").replace(/(\/\/)?\s*\&\#8211;>\s*<\/SCRIPT>/i,"").replace(/\-\->\s*<\/SCRIPT>/i,"").replace(/\]\](?:\&gt\;|>)\s*<\/SCRIPT>/i,"").replace(/<\/SCRIPT>$/mi,"").replace(/<\/?\s*(?:p|br)\s*\/?>/ig,"").replace(/<\!--\s*.*?\s*-->\s*<script.*/ig,"").replace(/\\+(['"])/g,"$1");if(z.trim()){var u=apf.getAmlDocFromString("<div jid='"+(a++)+"' "+j+">"+z+"</div>").documentElement;if(apf.isWebkit){u=apf.AppNode.ownerDocument.importNode(u,true);}apf.AppNode.appendChild(u);apf.amlParts.push([d.parentNode,d.nextSibling]);}}}if(!c&&d.firstChild||d.nextSibling){if(!c&&d.firstChild){d=d.firstChild;}else{d=d.nextSibling;}}else{do{d=d.parentNode;if(d.tagName=="BODY"){d=null;}}while(d&&!d.nextSibling);if(d){d=d.nextSibling;}}}if(w){w.parentNode.removeChild(w);}},parseAppMarkup:function(a){var c=false;if(this.parseStrategy==1||!this.parseStrategy&&!a&&document.documentElement.outerHTML.split(">",1)[0].indexOf(apf.ns.aml)==-1){this.parsePartialAml(a);if(this.parseStrategy==1||apf.amlParts.length){apf.isParsingPartial=true;apf.loadAmlIncludes(apf.AppNode);if(!self.ERROR_HAS_OCCURRED){apf.initialize();}return;}else{c=true;}}if(c&&document.documentElement.outerHTML.split(">",1)[0].indexOf(apf.ns.aml)==-1){return false;}if(this.parseStrategy==21||!this.parseStrategy&&!a){return apf.oHttp.get((apf.alternativeAml||document.body&&document.body.getAttribute("xmlurl")||location.href).split(/#/)[0],{callback:function(n,m,d){if(m!=apf.SUCCESS){var q=new Error(apf.formatErrorString(0,null,"Loading XML application data","Could not load XML from remote source: "+d.message));if(d.tpModule.retryTimeout(d,m,null,q)===true){return true;}throw q;}var o=n.replace(/\<\!DOCTYPE[^>]*>/,"").replace(/&nbsp;/g," ").replace(/^[\r\n\s]*/,"");if(!apf.supportNamespaces){o=o.replace(/xmlns\=\"[^"]*\"/g,"");}if(self.ERROR_HAS_OCCURRED){return;}if(apf.isIE){document.body.innerHTML="";}else{var j=document.body.childNodes;for(var l=j.length-1;l>=0;l--){j[l].parentNode.removeChild(j[l]);}}document.body.style.display="block";apf.initialize(o);},ignoreOffline:true});}else{document.body.style.display="block";if(!self.ERROR_HAS_OCCURRED){apf.initialize(a.outerHTML||a.xml);}}},namespaces:{},setNamespace:function(a,c){this.namespaces[a]=c;c.namespaceURI=a;},initialize:function(o){if(apf.initialized){return;}apf.initialized=true;apf.console.info("Initializing...");clearInterval(apf.Init.interval);apf.Init.run();var j=parseFloat(apf.getStyle(document.body,"marginTop"));apf.doesNotIncludeMarginInBodyOffset=(document.body.offsetTop!==j);if(apf.isParsingPartial){apf.config.setDefaults();apf.hasSingleRszEvent=true;var c=document.body;var d=c.lastChild;apf.AmlParser.parseMoreAml(apf.AppNode,c,null,true,false);var q,a,n,i,m=null,l=c.lastChild;while(l&&d!=l){i=apf.amlParts[l.getAttribute("jid")];n=l.previousSibling;if(i){q=i[0];if("P".indexOf(q.tagName)>-1){m=q.parentNode.insertBefore(apf.getNode(l,[0]),q);}else{a=apf.getNode(l,[0]);while(a){if(a){m=q.insertBefore(a,typeof i[1]=="number"?m:i[1]);}else{m=typeof i[1]=="number"?m:i[1];}a=apf.getNode(l,[0]);}}l.parentNode.removeChild(l);}l=n;}$setTimeout("apf.layout.forceResize();");}else{apf.window.init(o);}},execDeferred:function(){var a=apf.load_events.length;while(a--){(apf.load_events.shift())();}},load_events:[],load_timer:null,load_done:false,load_init:null,addDomLoadEvent:function(m){if(!this.$bdetect){this.browserDetect();}if(apf.load_done){return m();}if(!apf.load_init){apf.load_init=function(){if(apf.load_done){return;}clearInterval(apf.load_timer);apf.load_timer=null;apf.load_done=true;if(apf.started){apf.execDeferred();}};}apf.load_events.push(m);if(m&&apf.load_events.length==1){var n=document,d="undefined";if((typeof n.readyState!=d&&n.readyState=="complete")||(typeof n.readyState==d&&(n.getElementsByTagName("body")[0]||n.body))){return apf.load_init();}if(n.addEventListener&&!apf.isOpera){window.addEventListener("DOMContentLoaded",apf.load_init,false);}else{if(apf.isIE&&window==top){apf.load_timer=setInterval(function(){try{n.documentElement.doScroll("left");}catch(i){$setTimeout(arguments.callee,0);return;}apf.load_init();},10);}else{if(apf.isOpera){n.addEventListener("DOMContentLoaded",function(){apf.load_timer=setInterval(function(){for(var q=0,o=n.styleSheets.length;q<o;q++){if(n.styleSheets[q].disabled){return;}}apf.load_init();},10);},false);}else{if(apf.isWebkit&&!apf.isIphone){var l=n.getElementsByTagName("link"),c=l.length,j;for(;c>=0;c++){if(!l[c]||l[c].getAttribute("rel")!="stylesheet"){l.splice(c,0);}}j=l.length;apf.load_timer=setInterval(function(){if(/loaded|complete/.test(n.readyState)&&n.styleSheets.length==j){apf.load_init();}},10);}else{var a=window.onload;window.onload=function(){apf.load_init();if(a){a();}};}}}}}},addListener:function(d,c,a){if(d.addEventListener){d.addEventListener(c,a,false);}else{if(d.attachEvent){d.attachEvent("on"+c,a);}}return this;},removeListener:function(d,c,a){if(d.removeEventListener){d.removeEventListener(c,a,false);}else{if(d.detachEvent){d.detachEvent("on"+c,a);}}return this;},unload:function(c){this.isDestroying=true;this.popup.destroy();var j,d=0,a=this.all.length;for(;d<a;d++){j=this.all[d];if(j&&j!=c&&j.destroy&&!j.apf){j.destroy(false);}}for(d=0,a=this.availHTTP.length;d<a;d++){this.availHTTP[d]=null;}this.availHTTP.length=0;if(apf.xmldb){apf.xmldb.unbind(apf.window);}this.isDestroying=false;}};var $xmlns=function(c,a,i,d){if(!apf.supportNamespaces){if(!d){d=apf.findPrefix(c,i);}if(c.style||c==document){return c.getElementsByTagName(a);}else{if(d){(c.nodeType==9?c:c.ownerDocument).setProperty("SelectionNamespaces","xmlns:"+d+"='"+i+"'");}return c.selectNodes(".//"+(d?d+":":"")+a);}}return c.getElementsByTagNameNS(i,a);};var $setTimeout=setTimeout;var $setInterval=setInterval;document.documentElement.className+=" has_apf";apf.browserDetect();apf.Init.run("apf");apf.Class=function(){};apf.Class.prototype=new (function(){var FUN="function",OBJ="object",UNDEF="undefined",SEL="selected|selection";PROP="prop.",MODEL="model",VALUE="value";this.$regbase=0;this.hasFeature=function(test){return this.$regbase&test;};this.$initStack=[];this.$bufferEvents=[];this.$init=function(callback,nodeFunc,struct){if(typeof callback==FUN||callback===true){this.$bufferEvents=this.$bufferEvents.slice();if(callback===true){return this;}this.$initStack=this.$initStack.slice();this.$initStack.push(callback);return this;}this.addEventListener=realAddEventListener;this.$removalQueue=[];if(this.nodeType!=2){this.$uniqueId=apf.all.push(this)-1;}this.$captureStack={};this.$eventsStack={};this.$funcHandlers={};var i=0,l=this.$initStack.length;for(;i<l;i++){this.$initStack[i].apply(this,arguments);}for(i=0,l=this.$bufferEvents.length;i<l;i++){this.addEventListener.apply(this,this.$bufferEvents[i]);}delete realAddEventListener;delete this.$initStack;delete this.$bufferEvents;if(struct&&struct.htmlNode){this.$pHtmlNode=struct.htmlNode;this.ownerDocument.$domParser.$continueParsing(this);apf.queue.empty();}return this;};this.implement=apf.implement;this.$handlePropSet=function(prop,value){this[prop]=value;};this.$bindProperty=function(myProp,bObject,bProp,fParsed){if(!fParsed){return bObject.$handlePropSet(bProp,this[myProp]);}var eventName=PROP+myProp,eFunc,isBeingCalled,isLang;(this.$eventsStack[eventName]||(this.$eventsStack[eventName]=[])).push(eFunc=function(e){if(isBeingCalled){return;}apf.$lm_has_lang=false;isBeingCalled=true;try{if(fParsed.asyncs){return fParsed.call(bObject,bObject.xmlRoot,function(value){bObject.setProperty(bProp,value,true,false,10);if(apf.$lm_has_lang&&!isLang){isLang=true;apf.language.addProperty(bObject,bProp,fParsed);}isBeingCalled=false;});}else{var value=fParsed.call(bObject,bObject.xmlRoot);}}catch(e){apf.console.warn("[331] Could not execute binding for property "+bProp+"\n\n"+e.message);isBeingCalled=false;return;}bObject.setProperty(bProp,value,true,false,10);if(apf.$lm_has_lang&&!isLang){isLang=true;apf.language.addProperty(bObject,bProp,fParsed);}isBeingCalled=false;});return eFunc;};this.$attrExcludePropBind=false;this.$setDynamicProperty=function(prop,pValue){var exclNr=this.$attrExcludePropBind[prop],options;if(SEL.indexOf(prop)>-1){options={xpathmode:2,parsecode:true};}else{if(exclNr==2){options={nostring:true};}else{if(exclNr===0){options={parsecode:true};}}}var fParsed=apf.lm.compile(pValue,options);if(prop==MODEL){(this.$modelParsed=fParsed).instruction=pValue;}if(fParsed.type==2){this[prop]=!pValue;return this.setProperty(prop,fParsed.str);}if(exclNr==2||fParsed.xpaths.length&&exclNr!=1){if(!this.hasFeature(apf.__DATABINDING__)){this.implement(apf.StandardBinding);}this.$addAttrBind(prop,fParsed,pValue);}var matches=exclNr&&exclNr!=3&&prop!=MODEL?{}:fParsed.props,found=false,_self=this,o,node,bProp,p;for(p in matches){if(typeof matches[p]==FUN){continue;}o=p.split(".");if(o.length>2){bProp=o.pop();try{node=eval(o.join("."));}catch(e){if(arguments[2]){apf.console.warn("[287] Could not execute binding test : "+pValue.replace(/</g,"&lt;")+"\n\n"+e.message);}else{apf.queue.add(prop+":"+this.$uniqueId,function(){_self.$clearDynamicProperty(prop);_self.$setDynamicProperty(prop,pValue,true);});}continue;}if(typeof node!=OBJ||!node.$regbase){bProp=o[1];node=self[o[0]];}else{o.push(bProp);}}else{bProp=o[1];node=self[o[0]]||o[0]=="this"&&this;}if(!node){if(arguments[2]){apf.console.warn("[287] Could not execute binding test : "+pValue.replace(/</g,"&lt;")+"\n\n"+o[0]+" does not exist");}else{apf.queue.add(prop+":"+this.$uniqueId,function(){_self.$clearDynamicProperty(prop);_self.$setDynamicProperty(prop,pValue,true);});return;}}if(!node.$bindProperty){continue;}if(!this.$funcHandlers[prop]){this.$funcHandlers[prop]=[];}this.$funcHandlers[prop].push({amlNode:node,prop:bProp,handler:node.$bindProperty(bProp,this,prop,fParsed)});found=true;}if(found){this.$funcHandlers[prop][0].handler({initial:true});}else{if(exclNr){return this.setProperty(prop,pValue);}apf.$lm_has_lang=false;try{if(fParsed.asyncs){return fParsed.call(this,this.xmlRoot,function(value){_self.setProperty(prop,value,true);if(apf.$lm_has_lang){apf.language.addProperty(this,prop,fParsed);}});}else{var value=fParsed.call(this,this.xmlRoot);}}catch(e){apf.console.warn("[331] Could not execute binding test or: "+pValue.replace(/</g,"&lt;")+"\n\n"+e.message);return;}this[prop]=!value;this.setProperty(prop,value,true);if(apf.$lm_has_lang){apf.language.addProperty(this,prop,fParsed);}}};this.$clearDynamicProperty=function(prop){if(this.$removeAttrBind){this.$removeAttrBind(prop);}apf.language.removeProperty(this,prop);if(prop==MODEL){this.$modelParsed=null;}var f,i,l,h=this.$funcHandlers[prop];if(h&&typeof h!=FUN){for(i=0,l=h.length;i<l;i++){(f=h[i]).amlNode.removeEventListener(PROP+f.prop,f.handler);}delete this.$funcHandlers[prop];}};this.watch=function(propName,callback){var eventName=PROP+propName,wrapper=function(e){callback.call(this,propName,e.oldvalue,e.value);};wrapper.callback=callback;(this.$eventsStack[eventName]||(this.$eventsStack[eventName]=[])).push(wrapper);};this.unwatch=function(propName,callback){var list,eventName=PROP+propName;if(!(list=this.$eventsStack[eventName])){return;}for(var i=0,l=list.length;i<l;i++){if(list[i].callback==callback){list.remove(i);return;}}};this.getAvailableProperties=function(){return this.$supportedProperties.slice();};this.setProperty=function(prop,value,forceOnMe,setAttr,inherited){var s,r,arr,e,i,l,oldvalue=this[prop],isChanged=(typeof value==OBJ)?value!=(typeof oldvalue==OBJ?oldvalue:null):String(oldvalue)!==String(value),eventName=PROP+prop;if(isChanged){if(!forceOnMe){if(this.xmlRoot&&typeof value!=OBJ&&(!(s=this.$attrExcludePropBind[prop]))&&(r=(this.$attrBindings&&this.$attrBindings[prop]||prop!=VALUE&&this.$bindings[prop]&&this.$bindings[prop][0]))){if(r.cvalue.type==3){return apf.setNodeValue(this.$getDataNode(prop.toLowerCase(),this.xmlRoot,true),value,true);}}else{if(typeof apf.offline!=UNDEF){if(apf.loaded&&apf.offline.state.enabled){apf.offline.state.set(this,prop,typeof value==OBJ?value.name:value);}else{if(apf.offline.enabled){}}}}}if(this.$handlePropSet(prop,value,forceOnMe)===false){return;}value=this[prop];if(setAttr){this.setAttribute(prop,value,true);}}if(arr=this.$eventsStack[eventName]){for(i=0,l=arr.length;i<l;i++){if(arr[i].call(this,e||(e=new apf.AmlEvent(eventName,{prop:prop,value:value,oldvalue:oldvalue})))===false){e.returnValue=false;}}}if((aci||(aci=apf.config.$inheritProperties))[prop]&&this.$amlLoaded){if(inherited!=10&&!value){delete this.$inheritProperties[prop];if(this.$setInheritedAttribute(prop)){return;}}else{if(inherited!=10){this.$inheritProperties[prop]=inherited||-1;}}if((!e||e.returnValue!==false)&&this.childNodes){(function recur(nodes){var i,l,node,n;for(i=0,l=nodes.length;i<l;i++){node=nodes[i];if(node.nodeType!=1){continue;}if(!(n=node.$inheritProperties[prop])){recur(node.childNodes);}else{if(n>0){node.setProperty(prop,value,false,false,2);}}}})(this.childNodes);}}return value;};var aci;this.getProperty=function(prop){return this[prop];};apf.eventDepth=0;var allowEvents={DOMNodeInsertedIntoDocument:1,DOMNodeRemovedFromDocument:1};this.dispatchEvent=function(eventName,options,e){var arr,result,rValue,i,l;apf.eventDepth++;e=options&&options.name?options:e;if(this.disabled&&!allowEvents[eventName]){result=false;}else{if(!e||!e.currentTarget){if(!(options||(options={})).currentTarget){options.currentTarget=this;}if(arr=this.$captureStack[eventName]){for(i=0,l=arr.length;i<l;i++){rValue=arr[i].call(this,e||(e=new apf.AmlEvent(eventName,options)));if(typeof rValue!=UNDEF){result=rValue;}}}}if(options&&options.captureOnly){return e&&typeof e.returnValue!=UNDEF?e.returnValue:result;}else{if(this["on"+eventName]){result=this["on"+eventName].call(this,e||(e=new apf.AmlEvent(eventName,options)));}if(arr=this.$eventsStack[eventName]){for(i=0,l=arr.length;i<l;i++){if(!arr[i]){continue;}rValue=arr[i].call(this,e||(e=new apf.AmlEvent(eventName,options)));if(typeof rValue!=UNDEF){result=rValue;}}}}}if((e&&e.bubbles&&!e.cancelBubble||options&&options.bubbles)&&this!=apf){rValue=(this.parentNode||apf).dispatchEvent(eventName,null,e||(e=new apf.AmlEvent(eventName,options)));if(typeof rValue!=UNDEF){result=rValue;}}var p;while(this.$removalQueue.length){p=this.$removalQueue.shift();p[0].remove(p[1]);}if(--apf.eventDepth==0&&this.ownerDocument&&!this.ownerDocument.$domParser.$parseContext&&!apf.isDestroying&&apf.queue){apf.queue.empty();}return e&&typeof e.returnValue!=UNDEF?e.returnValue:result;};this.addEventListener=function(a,b,c){this.$bufferEvents.push([a,b,c]);};var realAddEventListener=function(eventName,callback,useCapture){if(eventName.substr(0,2)=="on"){eventName=eventName.substr(2);}var stack=useCapture?this.$captureStack:this.$eventsStack;if(!stack[eventName]){stack[eventName]=[];}if(stack[eventName].indexOf(callback)==-1){stack[eventName].unshift(callback);}var f;if(f=this.$eventsStack["$event."+eventName]){f[0].call(this,callback);}};this.removeEventListener=function(eventName,callback,useCapture){var stack=useCapture?this.$captureStack:this.$eventsStack;if(stack[eventName]){this.$removalQueue.push([stack[eventName],callback]);}};this.hasEventListener=function(eventName){return(this.$eventsStack[eventName]&&this.$eventsStack[eventName].length>0);};this.destroy=function(deep,clean){if(typeof this.$uniqueId==UNDEF&&this.nodeType!=2){return;}this.$amlLoaded=false;this.$amlDestroyed=true;if(this.$destroy){this.$destroy();}this.dispatchEvent("DOMNodeRemoved");this.dispatchEvent("DOMNodeRemovedFromDocument");apf.all[this.$uniqueId]=undefined;if(!this.nodeFunc&&this.nodeType!=2){try{if(this.id||this.name){self[this.id||this.name]=null;}}catch(ex){}return;}if(this.$ext&&!this.$ext.isNative&&this.$ext.nodeType==1&&this.localName!="a"){this.$ext.oncontextmenu=this.$ext.host=null;if(clean){if(this.localName!="collection"){this.$ext.parentNode.removeChild(this.$ext);}}}if(this.$int&&!this.$int.isNative&&this.$int.nodeType==1&&this.localName!="a"){this.$int.host=null;}this.$aml=null;if(deep&&this.childNodes){var nodes=this.childNodes;for(i=nodes.length-1;i>=0;i--){if(nodes[i].destroy){nodes[i].destroy(true,clean&&this.localName=="collection");}}this.childNodes=null;}if(this.parentNode&&this.removeNode){this.removeNode();}else{if(this.ownerElement&&!this.ownerElement.$amlDestroyed){this.ownerElement.removeAttributeNode(this);}}if(this.$focussable&&this.focussable){apf.window.$removeFocus(this);}if(this.attributes){var attr=this.attributes;for(var i=attr.length-1;i>=0;i--){this.$clearDynamicProperty(attr[i].nodeName);attr[i].destroy();}}try{if(this.id||this.name){self[this.id||this.name]=null;}}catch(ex){}apf.nameserver.remove(this.localName,this);};})();apf.extend(apf,new apf.Class().$init());apf.Init.run("class");apf.color={colors:{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},fixHSB:function(a){return{h:Math.min(360,Math.max(0,a.h)),s:Math.min(100,Math.max(0,a.s)),b:Math.min(100,Math.max(0,a.b))};},fixRGB:function(a){return{r:Math.min(255,Math.max(0,a.r)),g:Math.min(255,Math.max(0,a.g)),b:Math.min(255,Math.max(0,a.b))};},fixHex:function(d){var a=6-d.length;if(a>0){var j=[],c=0;for(;c<a;c++){j.push("0");}j.push(d);d=j.join("");}return d;},hexToRGB:function(a){a=parseInt(((a.indexOf("#")>-1)?a.substring(1):a),16);return{r:a>>16,g:(a&65280)>>8,b:(a&255)};},hexToHSB:function(a){return this.RGBToHSB(this.hexToRGB(a));},RGBToHSB:function(d){var c={h:0,s:0,b:0};var i=Math.min(d.r,d.g,d.b),a=Math.max(d.r,d.g,d.b),j=a-i;c.b=a;if(a!=0){}c.s=a!=0?255*j/a:0;if(c.s!=0){if(d.r==a){c.h=(d.g-d.b)/j;}else{if(d.g==a){c.h=2+(d.b-d.r)/j;}else{c.h=4+(d.r-d.g)/j;}}}else{c.h=-1;}c.h*=60;if(c.h<0){c.h+=360;}c.s*=100/255;c.b*=100/255;return c;},HSBToRGB:function(a){var d={},m=Math.round(a.h),l=Math.round(a.s*255/100),c=Math.round(a.b*255/100);if(l==0){d.r=d.g=d.b=c;}else{var n=c,j=(255-l)*c/255,i=(n-j)*(m%60)/60;if(m==360){m=0;}if(m<60){d.r=n,d.b=j,d.g=j+i;}else{if(m<120){d.g=n,d.b=j,d.r=n-i;}else{if(m<180){d.g=n,d.r=j,d.b=j+i;}else{if(m<240){d.b=n,d.r=j,d.g=n-i;}else{if(m<300){d.b=n,d.g=j,d.r=j+i;}else{if(m<360){d.r=n,d.g=j,d.b=n-i;}else{d.r=0,d.g=0,d.b=0;}}}}}}}return{r:Math.round(d.r),g:Math.round(d.g),b:Math.round(d.b)};},RGBToHex:function(a){var d=[a.r.toString(16),a.g.toString(16),a.b.toString(16)],c=0;for(;c<3;c++){if(d[c].length==1){d[c]="0"+d[c];}}return d.join("");},HSBToHex:function(a){return this.RGBToHex(this.HSBToRGB(a));}};if(typeof isFinite=="undefined"){function isFinite(a){return a+1!=a;}}apf.ARRAY=1;apf.NUMBER=2;apf.DATE=3;apf.BOOLEAN=4;apf.STRING=5;apf.REGEXP=6;apf.FUNCTION=7;Array.prototype.dataType=apf.ARRAY;Number.prototype.dataType=apf.NUMBER;Date.prototype.dataType=apf.DATE;Boolean.prototype.dataType=apf.BOOLEAN;String.prototype.dataType=apf.STRING;RegExp.prototype.dataType=apf.REGEXP;Function.prototype.dataType=apf.FUNCTION;apf.getCgiString=function(a,j,d){var m=[];function l(q,i){var s;if(apf.isArray(q)){for(var n=0;n<q.length;n++){l(q[n],i+"%5B%5D");}}else{if(typeof q=="object"){for(s in q){if(apf.isSafariOld&&(!q[s]||typeof p[s]!="object")){continue;}if(typeof q[s]=="function"){continue;}l(q[s],i+"%5B"+encodeURIComponent(s)+"%5D");}}else{m.push(i+"="+encodeURIComponent(q));}}}if(j){m.push("func="+d);for(var c=0;c<a[0].length;c++){l(a[0][c],"f%5B"+c+"%5D");}}else{for(prop in a){if(apf.isSafariOld&&(!a[prop]||typeof a[prop]=="function")){continue;}l(a[prop],prop);}}return m.join("&");};apf.fromCgiString=function(c){if(!c){return false;}var o={};c=c.split("&");for(var m,l=0;l<c.length;l++){m=c[l].split("=");m[0]=decodeURIComponent(m[0]);var n=m[0].replace(/\]/g,"").split("[");var d=o;for(var a=0;a<n.length;a++){if(d[n[a]]){d=d[n[a]];}else{if(n.length==a+1){if(n[a]){d[n[a]]=decodeURIComponent(m[1]);}else{d.push(decodeURIComponent(m[1]));}break;}else{d[n[a]]=!n[a+1]?[]:{};d=d[n[a]];}}}}return o;};Function.prototype.extend=function(){apf.extend.apply(this,[this].concat(Array.prototype.slice.call(arguments)));return this;};Function.prototype.bindWithEvent=function(){var a=this,c=Array.prototype.slice.call(arguments),i=c.shift(),d=c.shift();return function(j){if(!j){j=window.event;}if(d!==false){j=new apf.AbstractEvent(j,window);}return a.apply(i,[j].concat(c).concat(Array.prototype.slice.call(arguments)));};};Array.prototype.copy=function(){var a=[];for(var d=0,c=this.length;d<c;d++){a[d]=this[d]&&this[d].copy?this[d].copy():this[d];}return a;};Array.prototype.merge=function(){for(var m=0,c=arguments.length;m<c;m++){for(var d=0,a=arguments[m].length;d<a;d++){this.push(arguments[m][d]);}}};Array.prototype.arrayAdd=function(){var n=this.copy();for(var m=0,c=arguments.length;m<c;m++){for(var d=0,a=n.length;d<a;d++){n[d]+=arguments[m][d];}}return n;};Array.prototype.equals=function(d){for(var c=0,a=this.length;c<a;c++){if(this[c]!=d[c]){return false;}}return true;};Array.prototype.makeUnique=function(){var a,d,c=[];for(a=0,d=this.length;a<d;a++){if(c.indexOf(this[a])==-1){c.push(this[a]);}}this.length=0;for(a=0,d=c.length;a<d;a++){this.push(c[a]);}return this;};Array.prototype.contains=function(a,c){return this.indexOf(a,c)!=-1;};Array.prototype.indexOf=Array.prototype.indexOf||function(d,j){var a=this.length;for(var c=(j<0)?Math.max(0,a+j):j||0;c<a;c++){if(this[c]===d){return c;}}return -1;};Array.prototype.lastIndexOf=Array.prototype.lastIndexOf||function(d,j){var a=this.length;for(var c=(j>=a)?a-1:(j<0)?j+a:a-1;c>=0;c--){if(this[c]===d){return c;}}return -1;};Array.prototype.pushUnique=function(a){if(this.indexOf(a)==-1){this.push(a);}return this;};Array.prototype.search=function(){for(var c=0,d=arguments.length;c<d;c++){if(typeof this[c]!="array"){continue;}for(var a=0;a<d;a++){if(this[c][a]!=arguments[a]){break;}else{if(a==(d-1)){return this[c];}}}}};Array.prototype.each=Array.prototype.forEach=Array.prototype.forEach||function(d){for(var c=0,a=this.length;c<a;c++){d.call(this,this[c],c,this);}return this;};Array.prototype.remove=function(c){for(var a=this.length-1;a>=0;a--){if(this[a]!=c){continue;}this.splice(a,1);}return this;};Array.prototype.removeIndex=function(a){if(!this.length){return null;}return this.splice(a,1);};Array.prototype.insertIndex=function(c,a){this.splice(a,0,c);};Array.prototype.invert=Array.prototype.reverse=Array.prototype.reverse||function(){var a=this.length-1;for(var c,d=0;d<Math.ceil(0.5*a);d++){c=this[d];this[d]=this[a-d];this[a-d]=c;}return this;};Array.prototype.filter=Array.prototype.filter||function(j,m){var d=[];for(var c=0,a=this.length;c<a;c++){if(j.call(m,this[c],c,this)){d.push(this[c]);}}return d;};Array.prototype.every=Array.prototype.every||function(d,j){for(var c=0,a=this.length;c<a;c++){if(!d.call(j,this[c],c,this)){return false;}}return true;};Array.prototype.map=Array.prototype.map||function(j,m){var d=[];for(var c=0,a=this.length;c<a;c++){d[c]=j.call(m,this[c],c,this);}return d;};Array.prototype.some=Array.prototype.some||function(d,j){for(var c=0,a=this.length;c<a;c++){if(d.call(j,this[c],c,this)){return true;}}return false;};Number.prototype.toPrettyDigit=Number.prototype.toPrettyDigit||function(){var a=this.toString();return(a.length==1)?"0"+a:a;};RegExp.prototype.getNativeFlags=function(){return(this.global?"g":"")+(this.ignoreCase?"i":"")+(this.multiline?"m":"")+(this.extended?"x":"")+(this.sticky?"y":"");};RegExp.prototype.addFlags=function(a){return new RegExp(this.source,(a||"")+this.getNativeFlags());};String.prototype.uCaseFirst=function(){return this.substr(0,1).toUpperCase()+this.substr(1);};String.prototype.trim=function(){return this.replace(/[\s\n\r]*$/,"").replace(/^[\s\n\r]*/,"");};String.prototype.repeat=function(a){return Array(a+1).join(this);};String.prototype.count=function(a){return this.split(a).length-1;};String.prototype.stripTags=function(){return this.replace(/<\/?[^>]+>/gi,"");};String.prototype.escape=function(){return escape(this);};String.prototype.toXml=function(){var d=apf.getXml("<root>"+this+"</root>");if(d.childNodes.length==1){return d.childNodes[0];}else{var c=d.ownerDocument.createDocumentFragment(),a=d.childNodes;while(a.length){c.appendChild(a[0]);}return c;}};if(typeof window!="undefined"&&typeof window.document!="undefined"&&typeof window.document.createElement=="function"){String.prototype.escapeHTML=function(){this.escapeHTML.text.data=this;return this.escapeHTML.div.innerHTML;};String.prototype.unescapeHTML=function(){var d=document.createElement("div");d.innerHTML=this.stripTags();if(d.childNodes[0]){if(d.childNodes.length>1){var a=[];for(var c=0;c<d.childNodes.length;c++){a.push(d.childNodes[c].nodeValue);}return a.join("");}else{return d.childNodes[0].nodeValue;}}return"";};String.prototype.escapeHTML.div=document.createElement("div");String.prototype.escapeHTML.text=document.createTextNode("");String.prototype.escapeHTML.div.appendChild(String.prototype.escapeHTML.text);if("<\n>".escapeHTML()!=="&lt;\n&gt;"){String.prototype.escapeHTML=null;}if("&lt;\n&gt;".unescapeHTML()!=="<\n>"){String.prototype.unescapeHTML=null;}}if(!String.prototype.escapeHTML){String.prototype.escapeHTML=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");};}if(!String.prototype.unescapeHTML){String.prototype.unescapeHTML=function(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");};}String.prototype.truncate=function(c,a){return this.length>=c?this.substring(0,c-(a?4:1))+(a?"...":""):this;};String.prototype.pad=function(a,d,c){return c?(this+Array(a).join(d)).slice(0,a):(Array(a).join(d)+this).slice(-a);};apf.PAD_LEFT=false;apf.PAD_RIGHT=true;String.prototype.splitSafe=function(d,a,c){return(c&&this.toLowerCase()||this).replace(/(?:^\s+|\n|\s+$)/g,"").split(new RegExp("[\\s ]*"+d+"[\\s ]*","g"),a||999);};String.prototype.appendRandomNumber=function(d){for(var a=[],c=1;c<=d;c++){a.push(apf.randomGenerator.generate(1,9));}return this.toString()+a.join("");};String.prototype.prependRandomNumber=function(d){for(var a=[],c=1;c<=d;c++){a.push(apf.randomGenerator.generate(1,9));}return a.join("")+this.toString();};String.prototype.sprintf=function(){var j=this.toString(),a=0,d=j.indexOf("%s");while(d>=0){var c=arguments[a++]||" ";j=j.substr(0,d)+c+j.substr(d+2);d=j.indexOf("%s");}return j;};apf.iepngfix=(function(){var i=null,d=null,a=true,m,l=function(){if(!m){m=apf.skins.skins["default"].mediaPath+"/blank.gif";}if(d===null){if(i){d=i.splitSafe(",");}else{d=[document];}}function o(w){if(w.currentStyle.backgroundImage.match(/\.png/i)!==null){j(w);}if(w.tagName=="IMG"&&w.src.match(/\.png$/i)!==null){c(w);}if(a&&(w.tagName=="A"||w.tagName=="INPUT")&&w.style.position===""){w.style.position="relative";}}for(var q=0,n=d.length,t;q<n;q++){if(typeof d[q]=="string"){d[q]=document.getElementById(d[q]);}t=d[q];if(!t){continue;}if(t!=document){o(t);}for(var s=t.all.length-1,u=null;(u=t.all[s]);s--){o(u);}}},j=function(o){var s="scale",n=o.currentStyle.backgroundImage,q=n.substring(5,n.length-2);if(o.currentStyle.backgroundRepeat=="no-repeat"){s="crop";}o.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+q+"', sizingMethod='"+s+"')";o.style.backgroundImage="url("+m+")";},c=function(n){var o=n.src;n.style.width=n.width+"px";n.style.height=n.height+"px";n.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+o+"', sizingMethod='scale')";n.src=m;};return{limitTo:function(n){i=n;return this;},run:l};})();apf.json2xml_Obj={};apf.json2xml_Attr={};apf.json2xml_ObjByAttr={};apf.json2Xml=(function(){var a=function(z,j,w,u){var s,l,o,A;function d(i){return i.replace(/&/g,"&amp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;");}if(!u){if(j!=(o=j.replace(/[^a-zA-Z0-9_-]/g,"_"))){apf.console.warn("Json2XML, invalid characters found in JSON tagname '"+j,"json2Xml");}j=o;}if(apf.isArray(z)){for(s=0,l=z.length;s<l;s++){a(z[s],j,w);}}else{if(typeof z=="object"){var q=false,c=null;if(!u){w.push("<",j);}for(s in z){if((l=apf.json2xml_Attr[s])||s.charAt(0)=="@"){if(!l&&!c){c=apf.json2xml_ObjByAttr[s.slice(1)];}if(!u){w.push(" ",l?l:s.slice(1),'="',d(z[s].toString()),'"');}}else{q=true;}}if(q){if(!u){w.push(">");}if(A=(c||apf.json2xml_Obj[j])){if(A==1){A={child:j.replace(/(.*)s$/,"$1")||j,key:"name",value:"value"};}for(s in z){if(s.charAt(0)!="@"&&!apf.json2xml_Attr[s]){if(typeof(o=z[s])=="object"){if(apf.json2xml_Obj[s]){a(o,s,w);}else{w.push("<",A.child," ",A.key,'="',d(s.toString()),'" >');a(o,s,w,true);w.push("</",A.child,">\n");}}else{w.push("<",A.child," ",A.key,'="',s,'" ');if(A.value){if(A.value==1){w.push("/>");}else{w.push(A.value,'="',d(z[s].toString()),'"/>');}}else{w.push(">",d(z[s].toString()),"</",A.child,">");}}}}if(!u){w.push("</",j,">\n");}}else{for(s in z){if(!apf.json2xml_Attr[s]&&s.charAt(0)!="@"){if(s.match(/[^a-zA-Z0-9_-]/g)){apf.console.warn("Json2XML, invalid characters found in JSON tagname: '"+s,"json2Xml");}else{a(z[s],s,w,false);}}}if(!u){w.push("</",j,">");}}}else{if(!u){w.push("/>");}}}else{if(!u){w.push("<",j,">",d(z.toString()),"</",j,">");}else{w.push(d(z.toString()));}}}};return function(m,c,d){var n=(typeof m=="string"&&apf.isJson(m))?JSON.parse(m.replace(/""/g,'" "')):m,j=[],l;a(n,"jsondoc",j,false);return apf.getXmlDom(j.join("").replace(/\t|\n/g,""),c,true);};})();apf.xml2json=function(d,K){var l,P={},F,I=d.childNodes,q,O,N,G,J,C,B,A,E,D,c,Q,a,z,R;if(!K){if(J=(d.attributes)){for(C=0,B=J.length;C<B;C++){D=apf.json2xml_Attr[A=J[C].nodeName]||("@"+A);if(D.indexOf("@a_")!=0){P[D]=J[C].nodeValue,l=true;}}}}for(var O=0,N=I.length;O<N;O++){if((G=I[O]).nodeType!=1){continue;}R=G.tagName;l=true;D=E=null,F={};if(J=(G.attributes)){for(C=0,B=J.length;C<B;C++){F["@"+(A=J[C].nodeName)]=J[C].nodeValue;if(!E){E=apf.json2xml_ObjByAttr[A];}}}if(D=E||apf.json2xml_Obj[R]){if(D==1){D={key:"name",value:"value"};}for(q=G.childNodes,C=0,B=q.length;C<B;C++){if((E=q[C]).nodeType!=1){continue;}if(z=apf.json2xml_Obj[E.nodeName]){var M={};for(c=E.childNodes,Q=0,a=c.length;Q<a;Q++){if((s1=c[Q]).nodeType!=1){continue;}if(A=s1.getAttribute(z.key)){M[A]=(z.value==1?(s1.childNodes.length?apf.xml2json(s1,1):1):(s1.getAttribute(z.value||"value"))||apf.xml2json(s1,1));}}F[E.nodeName]=M;}else{if(A=E.getAttribute(D.key)){F[A]=(D.value==1?(E.childNodes.length?apf.xml2json(E,1):1):(E.getAttribute(D.value||"value"))||apf.xml2json(E,1));}}}}else{F=apf.xml2json(G);}if(P[R]!==undefined){if((E=P[R]).dataType!=apf.ARRAY){P[R]=[E,F];}else{P[R].push(F);}}else{P[R]=F;}}return l?P:apf.queryValue(d,"text()");};apf.isJson=(function(){var c=/\\["\\\/bfnrtu]/g,a=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,i=/(?:^|:|,)(?:\s*\[)+/g,d=/^[\],:{}\s]*$/;return function(j){if(!j){return false;}return d.test(j.replace(c,"@").replace(a,"]").replace(i,""));};})();if(!self.JSON){self.JSON=(function(){var j=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),q=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),m={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},n=function(s,t,u){return t?m[t]:String.fromCharCode(parseInt(u,16));},c=new String(""),a="\\",l={"{":Object,"[":Array},d=Object.hasOwnProperty,o=function(t,u){t=u+t;return t.substring(t.length-u.length);},i={0:function(t){if(t.nodeType&&t.ownerDocument&&t.cloneNode(true)){return"apf.xmldb.getXml("+JSON.stringify(apf.getXmlString(t))+")";}var s=[];for(var u in t){s.push('"'+u.replace(/(["\\])/g,"\\$1")+'": '+JSON.stringify(t[u]));}return"{"+s.join(", ")+"}";},5:function(t){t='"'+t.replace(/(["\\])/g,"\\$1")+'"';return t.replace(/(\n)/g,"\\n").replace(/\r/g,"");},2:function(s){return s.toString();},4:function(s){return s.toString();},3:function(s){return'{"jsonclass":["sys.ISODate", ["'+o(s.getUTCFullYear(),"0000")+o(s.getUTCMonth()+1,"00")+o(s.getUTCDate(),"00")+"T"+o(s.getUTCHours(),"00")+":"+o(s.getUTCMinutes(),"00")+":"+o(s.getUTCSeconds(),"00")+'"]]}';},1:function(s){for(var u=[],t=0;t<s.length;t++){u.push(JSON.stringify(s[t]));}return"["+u.join(", ")+"]";},7:function(s){return;}};return{parse:function(C,w){var u=C.match(j),E;var D=u[0];if("{"==D){E={};}else{if("["==D){E=[];}else{throw new Error(D);}}var B,F,z=[E];for(var t=1,s=u.length;t<s;++t){D=u[t];switch(D.charCodeAt(0)){default:F=z[0];F[B||F.length]=+(D);B=void 0;break;case 34:D=D.substring(1,D.length-1);if(D.indexOf(a)!==-1){D=D.replace(q,n);}F=z[0];if(!B){if(F instanceof Array){B=F.length;}else{B=D||c;break;}}F[B]=D;B=void 0;break;case 91:F=z[0];z.unshift(F[B||F.length]=[]);B=void 0;break;case 93:z.shift();break;case 102:F=z[0];F[B||F.length]=false;B=void 0;break;case 110:F=z[0];F[B||F.length]=null;B=void 0;break;case 116:F=z[0];F[B||F.length]=true;B=void 0;break;case 123:F=z[0];z.unshift(F[B||F.length]={});B=void 0;break;case 125:z.shift();break;}}if(z.length){throw new Error();}if(w){var A=function(N,M){var O=N[M];if(O&&typeof O=="object"){var G=null;for(var J in O){if(d.call(O,J)&&O!==N){var I=A(O,J);if(I!==void 0){O[J]=I;}else{if(!G){G=[];}G.push(J);}}}if(G){for(var K=G.length;--K>=0;){delete O[G[K]];}}}return w.call(N,M,O);};E=A({"":E},"");}return E;},stringify:function(s){if(typeof args=="function"||apf.isNot(s)){return"null";}return i[s.dataType||0](s);}};})();}apf.serialize=function(a){return self.JSON.stringify(a);};apf.unserialize=function(a){if(!a){return a;}return self.JSON.parse(a);};apf.hotkeys={};apf.keyMods={ctrl:1,alt:2,shift:4,meta:8};apf.keyNames={"32":"Spacebar","13":"Enter","9":"Tab","27":"Esc","46":"Del","36":"Home","35":"End","107":"+","37":"Left Arrow","38":"Up Arrow","39":"Right Arrow","40":"Down Arrow","33":"Page Up","34":"Page Down","112":"F1","113":"F2","114":"F3","115":"F4","116":"F5","117":"F6","118":"F7","119":"F8","120":"F9","121":"F10","122":"F11","123":"F12"};apf.registerHotkey=function(a,j){var n=0,d;var m=a.splitSafe("\\-|\\+| ",null,true),l=false,o=false;for(var c=0;c<m.length;c++){if(apf.keyMods[m[c]]){n=n|apf.keyMods[m[c]];if(apf.isMac){l=(apf.keyMods[m[c]]===apf.keyMods.ctrl);o=(apf.keyMods[m[c]]===apf.keyMods.meta);}}else{d=m[c];}}if(l&&!o){n=n|apf.keyMods.meta;}(apf.hotkeys[n]||(apf.hotkeys[n]={}))[d]=j;if(!apf.initHotkey){apf.initHotkey=true;apf.addEventListener("hotkey",function(t){if(apf.isMac&&t.metaKey){t.ctrlKey=true;}var s=0|(t.ctrlKey?1:0)|(t.shiftKey?2:0)|(t.shiftKey?4:0)|(t.metaKey?8:0);var i=apf.keyNames[t.keyCode];if(!s&&!i){return;}var q=(apf.hotkeys[s]||{})[(i||String.fromCharCode(t.keyCode)).toLowerCase()];if(q){q();t.returnValue=false;}});}};apf.removeHotkey=function(a){apf.registerHotkey(a,null);};apf.AbstractEvent=function(a,i){i=i||window;var d=i.document;a=a||i.event;if(a.$extended){return a;}this.$extended=true;this.event=a;this.type=a.type;this.target=a.target||a.srcElement;while(this.target&&this.target.nodeType==3){this.target=this.target.parentNode;}if(this.type.indexOf("key")!=-1){this.code=a.which||a.keyCode;}else{if(this.type.match(/(click|mouse|menu)/i)){d=(!d.compatMode||d.compatMode=="CSS1Compat")?d.html:d.body;this.page={x:a.pageX||a.clientX+(d?d.scrollLeft:0),y:a.pageY||a.clientY+(d?d.scrollTop:0)};this.client={x:(a.pageX)?a.pageX-i.pageXOffset:a.clientX,y:(a.pageY)?a.pageY-i.pageYOffset:a.clientY};if(this.type.match(/DOMMouseScroll|mousewheel/)){this.wheel=(a.wheelDelta)?a.wheelDelta/120:-(a.detail||0)/3;}this.rightClick=(a.which==3)||(a.button==2);this.relatedTarget=null;if(this.type.match(/over|out/)){if(this.type=="mouseover"){this.relatedTarget=a.relatedTarget||a.fromElement;}else{if(this.type=="mouseout"){this.relatedTarget=a.relatedTarget||a.toElement;}else{try{while(this.relatedTarget&&this.relatedTarget.nodeType==3){this.relatedTarget=this.relatedTarget.parentNode;}}catch(c){}}}}}}this.shift=Boolean(a.shiftKey);this.control=Boolean(a.ctrlKey);this.alt=Boolean(a.altKey);this.meta=Boolean(a.metaKey);this.stop=function(){return this.stopPropagation().preventDefault();};this.stopPropagation=function(){if(this.event.stopPropagation){this.event.stopPropagation();}else{this.event.cancelBubble=true;}return this;};this.preventDefault=function(){if(this.event.preventDefault){this.event.preventDefault();}else{this.event.returnValue=false;}return this;};};apf.AbstractEvent.KEYS={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,"delete":46,fromCode:function(c){for(var a in this){if(this[a]==c){return a;}return null;}}};apf.AbstractEvent.stop=function(a){return(new apf.AbstractEvent(a)).stop();};apf.AbstractEvent.addListener=function(d,c,a){if(d.addEventListener){d.addEventListener(c,a,false);}else{if(d.attachEvent){d.attachEvent("on"+c,a);}}return this;};apf.AbstractEvent.removeListener=function(d,c,a){if(d.removeEventListener){d.removeEventListener(c,a,false);}else{if(d.detachEvent){d.detachEvent("on"+c,a);}}return this;};apf.setStyleRule=function(c,q,s,a,n){c=c.toLowerCase();if(!a){var m=(n||self).document.styleSheets;for(var d=m.length-1;d>=0;d--){try{var t=m[d][apf.styleSheetRules];for(var l=0;l<t.length;l++){if(t.item(l).selectorText.toLowerCase()==c){t.item(l).style[q]=s;return true;}}}catch(o){}}}else{var t=(n||self).document.styleSheets[a||0][apf.styleSheetRules];for(var l=0;l<t.length;l++){if(t.item(l).selectorText.toLowerCase()==c){t.item(l).style[q]=s;return true;}}}return false;};apf.getStyleRule=function(c,q,a,n){c=c.toLowerCase();if(!a){var m=(n||self).document.styleSheets;for(var d=m.length-1;d>=0;d--){try{var s=m[d][apf.styleSheetRules];for(var l=0;l<s.length;l++){if(s.item(l).selectorText.toLowerCase()==c){return s.item(l).style[q];}}}catch(o){}}}else{var s=(n||self).document.styleSheets[a||0][apf.styleSheetRules];for(var l=0;l<s.length;l++){if(s.item(l).selectorText.toLowerCase()==c){return s.item(l).style[q];}}}return false;};apf.setStyleClass=function(i,d,j,a){if(!i||this.disabled){return;}if(d){if(j){j[j.length]=d;}else{j=[d];}}var c=new RegExp("(^| +)(?:"+(j?j.join("|"):"")+")","gi");i.className!=null?(i.className=i.className.replace(c," ")+(d?" "+d:"")):i.setAttribute("class",(i.getAttribute("class")||"").replace(c," ")+(d?" "+d:""));return i;};apf.importCssString=function(c,j,i){j=j||document;var d=j.getElementsByTagName("head")[0];if(!apf.supportOpacity){c=c.replace(/opacity[ \s]*\:[ \s]*([\d\.]+)/g,function(l,n){return"filter:progid:DXImageTransform.Microsoft.Alpha(opacity="+(n*100)+")";});}if(apf.canCreateStyleNode){var a=j.createElement("style");a.appendChild(j.createTextNode(c));if(i){a.setAttribute("media",i);}d.appendChild(a);}else{d.insertAdjacentHTML("beforeend",".<style media='"+(i||"all")+"'>"+c+"</style>");}};apf.getStyleRecur=function(a,d){var c=apf.hasComputedStyle?document.defaultView.getComputedStyle(a,"").getPropertyValue(d.replace(/([A-Z])/g,function(i,j){return"-"+j.toLowerCase();})):a.currentStyle[d];return((!c||c=="transparent"||c=="inherit")&&a.parentNode&&a.parentNode.nodeType==1)?this.getStyleRecur(a.parentNode,d):c;};apf.importStylesheet=function(c,d){for(var a=0;a<c.length;a++){if(!c[a][1]){continue;}if(apf.isIE){(d||window).document.styleSheets[0].addRule(c[a][0],c[a][1]);}else{(d||window).document.styleSheets[0].insertRule(c[a][0]+" {"+c[a][1]+"}",0);}}};apf.isInRect=function(c,a,i){var d=this.getAbsolutePosition(c);if(a<d[0]||i<d[1]||a>c.offsetWidth+d[0]-10||i>c.offsetHeight+d[1]-10){return false;}return true;};apf.getOverflowParent=function(a){a=a.offsetParent;while(a&&(this.getStyle(a,"overflow")!="hidden"||"absolute|relative".indexOf(this.getStyle(a,"position"))==-1)){a=a.offsetParent;}return a||document.documentElement;};apf.getPositionedParent=function(a){a=a.offsetParent;while(a&&a.tagName.toLowerCase()!="body"&&"absolute|relative".indexOf(this.getStyle(a,"position"))==-1){a=a.offsetParent;}return a||document.documentElement;};apf.getAbsolutePosition=function(c,m,d){if("getBoundingClientRect" in document.documentElement){if(apf.doesNotIncludeMarginInBodyOffset&&c==document.body){return[c.offsetLeft+(parseFloat(apf.getStyle(c,apf.descPropJs?"marginLeft":"margin-top"))||0),+(c.scrollLeft||0),c.offsetTop+(parseFloat(apf.getStyle(c,apf.descPropJs?"marginTop":"margin-top"))||0)+(c.scrollTop||0)];}var l=c.getBoundingClientRect(),w=l.top,i=l.left,t=(apf.isIE&&apf.isIE<8);if(!(apf.isIE&&c==document.documentElement)){i+=document.body.scrollLeft||document.documentElement.scrollLeft||0;w+=document.body.scrollTop||document.documentElement.scrollTop||0;}return[i-(t?2:0),w-(t?2:0)];}var n=d?0:c.offsetLeft,z=d?0:c.offsetTop;c=d?c:c.offsetParent||c.parentNode;if(apf.isIE8&&m){u=this.getStyle(c,"borderLeftWidth");n-=(apf.isIE&&c.currentStyle.borderLeftStyle!="none"&&u=="medium"?2:parseInt(u)||0);j=this.getStyle(c,"borderTopWidth");z-=(apf.isIE&&c.currentStyle.borderTopStyle!="none"&&j=="medium"?2:parseInt(j)||0);}var u,j,A;while(c&&c!=m){u=apf.isOpera||apf.isIE8?0:this.getStyle(c,apf.descPropJs?"borderLeftWidth":"border-left-width");n+=(apf.isIE&&c.currentStyle.borderLeftStyle!="none"&&u=="medium"?2:parseInt(u)||0)+c.offsetLeft;if(apf.isIE&&!apf.isIE8&&apf.getStyle(c,"styleFloat")=="none"&&apf.getStyle(c,"position")=="relative"){var a=c.previousSibling;while(a){if(a.nodeType==1){A=apf.getStyle(a,"styleFloat");if(A=="left"){n-=parseInt(apf.getStyle(c,"marginLeft"))||0;break;}else{if(A=="right"){break;}}}a=a.previousSibling;}}j=apf.isOpera||apf.isIE8?0:this.getStyle(c,apf.descPropJs?"borderTopWidth":"border-top-width");z+=(apf.isIE&&c.currentStyle.borderTopStyle!="none"&&j=="medium"?2:parseInt(j)||0)+c.offsetTop;if(!apf.isGecko&&c!=m&&(c.tagName!="HTML"||c.ownerDocument!=document)){n-=c.scrollLeft;z-=c.scrollTop;}if(c.tagName.toLowerCase()=="table"){z-=parseInt(c.border||0)+parseInt(c.cellSpacing||0);n-=parseInt(c.border||0)+parseInt(c.cellSpacing||0)*2;}else{if(c.tagName.toLowerCase()=="tr"){var s;z-=(s=parseInt(c.parentNode.parentNode.cellSpacing));while(c.previousSibling){z-=(c=c.previousSibling).offsetHeight+s;}}}if(apf.isIE&&!c.offsetParent&&c.parentNode.nodeType==1){n-=c.parentNode.scrollLeft;z-=c.parentNode.scrollTop;}c=c.offsetParent;}return[n,z];};apf.getViewPort=function(c){c=c||window;var a=(!c.document.compatMode||c.document.compatMode=="CSS1Compat")?c.document.html||c.document.documentElement:c.document.body;return{x:c.pageXOffset||a.scrollLeft,y:c.pageYOffset||a.scrollTop,width:c.innerWidth||a.clientWidth,height:c.innerHeight||a.clientHeight};};apf.plane={init:function(){if(!this.plane){this.plane=document.createElement("DIV");document.body.appendChild(this.plane);this.plane.style.background="url(images/spacer.gif)";this.plane.style.position="absolute";this.plane.style.zIndex=100000000;this.plane.style.left=0;this.plane.style.top=0;}},lastCursor:null,show:function(m,i,d){this.init();var c=this.plane;this.current=m;if(!i){this.lastZ=this.current.style.zIndex;this.current.style.zIndex=100000;}else{this.plane.appendChild(m);}var a=(c.parentNode==document.body?(apf.isIE?document.documentElement.offsetWidth-(apf.isIE<8?2:4):window.innerWidth):c.parentNode.offsetWidth);var j=(c.parentNode==document.body?(apf.isIE?document.documentElement.offsetHeight-(apf.isIE<8?2:4):window.innerHeight):c.parentNode.offsetHeight);if(d){if(this.lastCursor===null){this.lastCursor=document.body.style.cursor;}document.body.style.cursor=apf.getStyle(m,"cursor");}this.plane.style.display="block";var l=apf.getDiff(c.parentNode);this.plane.style.width=(a-l[0])+"px";this.plane.style.height=(j-l[1])+"px";return c;},hide:function(){var a=apf.isChildOf(this.plane,document.activeElement);if(this.lastZ){if(this.current.style.zIndex==100000){this.current.style.zIndex=this.lastZ;}this.lastZ=null;}if(this.current.parentNode==this.plane){this.plane.parentNode.appendChild(this.current);}this.plane.style.display="none";if(a){if(!apf.isIE){document.activeElement.focus();}apf.document.activeElement.$focus();}this.current=null;if(this.lastCursor!==null){document.body.style.cursor=this.lastCursor;this.lastCursor=null;}return this.plane;}};apf.xmlDiff=function(K,I){var ad={},A=[],c=[],G=1,E=2,s=3,D=4,W={},F={},Q={},T={},d={},ah={include:{}},J,U,ae,n,z,aa,ac,Z,af,ag,ak,V,P,m,o,M,al=[],X;(function C(am,j,ao){var ap,q,ar,an,at,aq,t;j+="/"+am.tagName;if(an=(q=am.childNodes).length){for(ap=0;ap<an;ap++){if((aq=q[ap]).nodeType==1){C(q[ap],j,ao);}else{t=j+"/"+aq.nodeType,(ao[t]||(ao[t]=[])).push(aq),aq.$isValid=false;}}}if(an=(ar=am.attributes).length){for(ap=0;ap<an;ap++){t=j+"/@"+(at=ar[ap]).nodeName,(ao[t]||(ao[t]=[])).push(at),at.$isValid=false;}}(ao[j]||(ao[j]=[])).push(am);am.$isValid=false;})(K,"",ad);ah.include[K.parentNode.$uniqueId]=K;(function B(ao,aB,an,q,aF){var aQ,ar,at,aI,aM,t,aH,ay,aA,aC,aO,aK,ax,av,aN,ap,aE,aJ,am,aw,aq,az,aG=0,au=[],aP={length:0},aL=aF.include;aB+="/"+ao.tagName;if(!(av=an[aB])){(W[aB]||(W[aB]=[])).push({arr:null,node:ao,curNode:aF});return false;}else{t=(aE={}).include={};for(aH=0,aC=av.length;aH<aC;aH++){if((aM=av[aH])){t[aM.$uniqueId]=aM;}}t.length=aC;}if(aC=(ay=ao.childNodes).length){for(aH=0;aH<aC;aH++){if((aK=ay[aH]).nodeType==1){B(aK,aB,an,q,aE);}else{if((aN=an[ax=aB+"/"+aK.nodeType])){for(aQ=0,ar=null,at=aK.nodeValue,aD=0,aI=aN.length;aD<aI;aD++){if((ap=aN[aD])&&ap.nodeValue==at){if(!ar){ar={node:aK,index:aD,arr:aN,curNode:aE,pcur:[ap.parentNode.$uniqueId],found:[aD]};}else{ar.found.push(aD),ar.pcur.push(ap.parentNode.$uniqueId);}aQ++;}}if(aQ){aJ=ar.pcur,am=aJ.length;for(aD=0;aD<am;aD++){if(aE[aJ[aD]]){aE[aJ[aD]]+=(1/aQ);}else{aE[aJ[aD]]=(1/aQ);}}(T[ax]||(T[ax]=[])).push(ar);continue;}(W[ax]||(W[ax]=[])).push({arr:aN,node:aK,curNode:aE});continue;}(W[ax]||(W[ax]=[])).push({isNew:true,arr:null,node:aK,curNode:aE});}}}if(aC=(aA=ao.attributes).length){for(aH=0;aH<aC;aH++){pattr=aB+"/@"+(aO=aA[aH]).nodeName;if(aN=an[pattr]){for(aQ=0,ar=null,at=aO.nodeValue,aD=0,aI=aN.length;aD<aI;aD++){if((ap=aN[aD])&&ap.nodeValue==at){if(!ar){ar={node:aO,index:aD,arr:aN,curNode:aE,pcur:[ap.ownerElement.$uniqueId],found:[aD]};}else{ar.found.push(aD),ar.pcur.push(ap.ownerElement.$uniqueId);}aQ++;}}if(aQ){aJ=ar.pcur,am=aJ.length;for(aD=0;aD<am;aD++){if(aE[aJ[aD]]){aE[aJ[aD]]+=(1/aQ);}else{aE[aJ[aD]]=(1/aQ);}}(d[pattr]||(d[pattr]=[])).push(ar);continue;}(F[pattr]||(F[pattr]=[])).push({arr:aN,node:aO,curNode:aE});continue;}(F[pattr]||(F[pattr]=[])).push({isNew:true,arr:null,node:aO,curNode:aE});}}for(aw in aE){if(aE[aw]>aG){aG=aE[aw],aq=1;}else{if(aE[aw]==aG){aq++;}}}if(!aG){aq=av.length;for(aH=aq;aH>=0;aH--){if(!av[aH]){continue;}q=(az=av[aH]).parentNode;if(az.$isValid||!t[az.$uniqueId]||!aL[q.$uniqueId]){delete t[az.$uniqueId],aq--;continue;}if(!aP[q.$uniqueId]){aP[q.$uniqueId]=q,aP.length++;}au.push(az);}}else{for(aw in aE){if(aE[aw]!=aG){continue;}q=(az=apf.all[aw]).parentNode;if(az.$isValid||!t[az.$uniqueId]||!aL[q.$uniqueId]){delete t[az.$uniqueId],aq--;continue;}if(!aP[q.$uniqueId]){aP[q.$uniqueId]=q,aP.length++;}au.push(az);}}if(au.length){aF.include=aP;}for(ar=null,aH=0,aC=au.length;aH<aC;aH++){q=(aM=au[aH]).parentNode;if(aF[q.$uniqueId]){aF[q.$uniqueId]+=1/aq;}else{aF[q.$uniqueId]=1/aq;}if(aq>1){if(!ar){ar={node:ao,arr:av,curNode:aE,curParentNode:aF,found:au};(Q[aB]||(Q[aB]=[])).push(ar);}if(aq>(aM.$matchedNodes||0)){aM.$matchedNodes=aq;}}else{aM.$isValid=true;for(var aD=av.length-1;aD>=0;aD--){if(av[aD]==aM){delete av[aD];break;}}}}if(!au.length){(W[ax]||(W[ax]=[])).push({arr:av,node:ao,curNode:aF});}aE.curNode=au[0],aE.parent=aF,aE.curPath=aB;})(I,"",ad,K,ah);function R(au){var ar=Q[au];if(!ar){return;}var av,aw,t,aq,ax,an,ao,ap,a,am,at;for(ao=0,am=ar.length;ao<am;ao++){ap=(av=ar[ao]).found,a=100000;for(aq=an=0,t=ap.length;an<t;an++){if((aw=ap[an]).$isValid){continue;}ax=aw.$matchedNodes;if(ax<a){a=ax,aq=1;}else{if(ax==a){aq++;}}}if(aq==1){for(an=0,t=ap.length;an<t;an++){if(!(aw=ap[an]).$isValid&&aw.$matchedNodes==a){aw.$isValid=true,av.curNode.curNode=aw;break;}}}else{if(aq){var q=av.curParentNode.include;if(q.length==1){at=av.curParentNode.curNode;for(an=0,t=ap.length;an<t;an++){if(!(aw=ap[an]).$isValid&&aw.$matchedNodes==a&&aw.parentNode==at){aw.$isValid=true,av.curNode.curNode=aw;break;}}continue;}R(av.curParentNode.curPath),at=av.curParentNode.curNode;for(an=0,t=ap.length;an<t;an++){if(!(aw=ap[an]).$isValid&&aw.$matchedNodes==a&&aw.parentNode==at){aw.$isValid=true,av.curNode.curNode=aw;break;}}}}}delete Q[au];}for(aa in Q){R(aa);}for(aa in T){J=T[aa],ae=J.length,U=J[0].arr;for(ag=0;ag<ae;ag++){Z=J[ag],m=Z.found;if((ac=Z.curNode)&&(ac=ac.curNode)){if(U[Z.index]&&ac==U[Z.index].parentNode){delete U[Z.index];}else{for(z=false,af=0;af<m.length;af++){if(U[m[af]]&&U[m[af]].parentNode==ac){delete U[m[af]],z=true;break;}}if(!z){(W[aa]||(W[aa]=[])).push(Z);}}}else{}}}for(aa in d){J=d[aa],ae=J.length,U=J[0].arr;for(ag=0;ag<ae;ag++){Z=J[ag],m=Z.found;if((ac=Z.curNode)&&(ac=ac.curNode)){if(U[Z.index]&&ac==U[Z.index].ownerElement){delete U[Z.index];}else{for(z=false,af=0;af<m.length;af++){if(U[m[af]]&&U[m[af]].ownerElement==ac){delete U[m[af]],z=true;break;}}if(!z){(F[aa]||(F[aa]=[])).push(Z);}}}else{}}}for(aa in F){J=F[aa],ae=J.length,U=J[0].arr||al,n=U.length;for(ag=0;ag<ae;ag++){ak=J[ag];if((ac=ak.curNode)&&(ac=ac.curNode)){if(ak.node.nodeName=="id"){ac.setAttribute("id",ak.node.nodeValue);}else{A.push([D,ac,ak.node]);}for(af=0;af<n;af++){if(U[af]&&U[af].ownerElement==ac){delete U[af];break;}}}else{}}}for(aa in W){J=W[aa],ae=J.length,U=J[0].arr||al,n=U.length;for(ag=0;ag<ae;ag++){Z=J[ag];if((ac=Z.curNode)&&(ac=ac.curNode)){c.push(o=[G,ac,Z.node]);for(af=0;af<n;af++){if(U[af]&&U[af].parentNode==ac){if(Z.node.nodeType!=1){o[0]=E;o[1]=U[af];}else{c.length--;}delete U[af];break;}}}else{}}}for(M in ad){V=ad[M];for(ag=0,ae=V.length;ag<ae;ag++){P=V[ag];if(P&&!P.$isValid&&(P.parentNode||P.ownerElement).$isValid){A.push([s,P]);}}}var u=new Date().getTime();var ab={},w=K.ownerDocument;for(ag=0,ae=c.length;ag<ae;ag++){switch((V=c[ag])[0]){case E:V[1].$setValue(V[2].nodeValue);if(V[1].nodeType!=2){var aj=apf.getChildNumber(V[1]),ai=apf.getChildNumber(V[2]);if(aj!=ai){V[1].parentNode.insertBefore(V[1],V[1].parentNode.childNodes[ai]);}}break;case G:if(!V[1].canHaveChildren){V[1].$aml=V[2].parentNode;if(V[1].$redraw){V[1].$redraw();}continue;}if(V[1].render!="runtime"){var N=V[1].parentNode;while(N&&N.nodeType==1&&!N.getAttribute("render")){N=N.parentNode;}if(N&&N.render){if(N.$amlList){N.$amlList.push(V);}else{N.$amlList=[V];N.addEventListener("beforerender",function(an){var j=this.$amlList;this.$amlList=null;for(var am,t=0,a=j.length;t<a;t++){am=j[t];var q=apf.getChildNumber(X=am[2]);am[1].insertBefore(w.importNode(X,true),am[1].childNodes[q]);}this.$rendered=true;this.removeEventListener("beforerender",arguments.callee);return false;});N.$rendered=false;}}else{(V[1].$amlList||(V[1].$amlList=[]))[apf.getChildNumber(V[2])]=V;ab[V[1].$uniqueId]=V[1];}}else{V[1].$aml=V[2].parentNode;V[1].$rendered=false;}break;}}var O;for(var Y in ab){O=ab[Y].$amlList;for(var V,ag=0;ag<O.length;ag++){V=O[ag];if(!V){continue;}V[1].insertBefore(w.importNode(V[2],true),V[1].childNodes[ag]);}}for(ag=0,ae=A.length;ag<ae;ag++){switch((V=A[ag])[0]){case s:if((X=V[1]).destroy){X.destroy(true,true);}else{if(X.parentNode){X.parentNode.removeChild(X);}else{X.ownerElement.removeAttributeNode(X);}}break;case D:V[1].setAttribute((V=V[2]).nodeName,V.nodeValue);break;}}apf.queue.empty();alert(new Date().getTime()-u);};apf.silverlight=(function(){var s=0;var E=false;var d="http://go2.microsoft.com/fwlink/?LinkID=";var i=false;var t=null;function D(){window.location.reload(false);}function u(Z){if(Z==undefined){Z=null;}var ac=false;var P=null;try{var V=null;var ab=false;if(window.ActiveXObject){try{V=new ActiveXObject("AgControl.AgControl");if(Z===null){ac=true;}else{if(V.IsVersionSupported(Z)){ac=true;}}V=null;}catch(Y){ab=true;}}else{ab=true;}if(ab){var W=navigator.plugins["Silverlight Plug-In"];if(W){if(Z===null){ac=true;}else{var Q=W.description;if(Q==="1.0.30226.2"){Q="2.0.30226.2";}var R=Q.split(".");while(R.length>3){R.pop();}while(R.length<4){R.push(0);}var T=Z.split(".");while(T.length>4){T.pop();}var aa;var U;var X=0;do{aa=parseInt(T[X]);U=parseInt(R[X]);X++;}while(X<T.length&&aa===U);if(aa<=U&&!isNaN(aa)){ac=true;}}}}}catch(Y){ac=false;}return ac;}function l(){if(!apf.silverlight.isBrowserRestartRequired&&D){try{navigator.plugins.refresh();}catch(P){}if(u(null)&&!E){D();E=true;}else{$setTimeout(l,3000);}}}function j(){navigator.plugins.refresh();apf.silverlight.isBrowserRestartRequired=u(null);if(!apf.silverlight.isBrowserRestartRequired){l();if(!i){C();i=true;}}else{if(window.navigator.mimeTypes){var T=navigator.mimeTypes["application/x-silverlight-2"];var P=navigator.mimeTypes["application/x-silverlight-2-b2"];var Q=navigator.mimeTypes["application/x-silverlight-2-b1"];var R=Q;if(P){R=P;}if(!T&&(Q||P)){if(!i){I();i=true;}}else{if(T&&R){if(T.enabledPlugin&&R.enabledPlugin){if(T.enabledPlugin.description!=R.enabledPlugin.description){if(!i){a();i=true;}}}}}}}}function A(P,aa,T,Y,ac,W,X){var ad={},U=Y,ab=ac;ad.version=U.version;U.source=P;ad.alt=U.alt;if(W){U.initParams=W;}if(U.isWindowless&&!U.windowless){U.windowless=U.isWindowless;}if(U.framerate&&!U.maxFramerate){U.maxFramerate=U.framerate;}if(T&&!U.id){U.id=T;}delete U.ignoreBrowserVer;delete U.inplaceInstallPrompt;delete U.version;delete U.isWindowless;delete U.framerate;delete U.data;delete U.src;delete U.alt;var R;if(u(ad.version)){for(var Q in ab){if(ab[Q]){if(Q=="onLoad"&&typeof ab[Q]=="function"&&ab[Q].length!=1){var Z=ab[Q];ab[Q]=function(ae){return Z(document.getElementById(T),X,ae);};}var V=z(ab[Q]);if(V!=null){U[Q]=V;ab[Q]=null;}else{throw"typeof events."+Q+" must be 'function' or 'string'";}}}R=O(U);}else{R=K(ad);}if(aa){aa.innerHTML=R;}else{return R;}}function O(R){var Q=[];Q.push('<object type="application/x-silverlight" data="data:application/x-silverlight,"');if(R.id!=null){Q.push(' id="'+m(R.id)+'"');}if(R.width!=null){Q.push(' width="'+R.width+'"');}if(R.height!=null){Q.push(' height="'+R.height+'"');}Q.push(" >");delete R.id;delete R.width;delete R.height;for(var P in R){if(R[P]){Q.push('<param name="'+m(P)+'" value="'+m(R[P])+'" />');}}Q.push("</object>");return Q.join("");}function J(R){var Q=R;var P=A(Q.source,Q.parentElement,Q.id,Q.properties,Q.events,Q.initParams,Q.context);if(Q.parentElement==null){return P;}}function K(P){var T="";var R=d;var Q=P.version;if(P.alt){T=P.alt;}else{if(!Q){Q="";}T="<a href='javascript:Silverlight.getSilverlight(\"{1}\");' style='text-decoration: none;'><img src='{2}' alt='Get Microsoft Silverlight' style='border-style: none'/></a>";T=T.replace("{1}",Q);T=T.replace("{2}",R+"108181");}return T;}function w(R){if(t){t();}var P="";var U=String(R).split(".");if(U.length>1){var T=parseInt(U[0]);if(isNaN(T)||T<2){P="1.0";}else{P=U[0]+"."+U[1];}}var Q="";if(P.match(/^\d+\056\d+$/)){Q="&v="+P;}n("114576"+Q);}function n(P){top.location=d+String(P);}function m(Q){var T;var R="";if(Q==null){return null;}for(var P=0;P<Q.length;P++){T=Q.charCodeAt(P);if(((T>96)&&(T<123))||((T>64)&&(T<91))||((T>43)&&(T<58)&&(T!=47))||(T==95)){R=R+String.fromCharCode(T);}else{R=R+"&#"+T+";";}}return R;}function B(Q,P){var R;var U=P.ErrorType;R=P.ErrorCode;var T=["\nSilverlight error message     \n          ErrorCode: ",R,"\n          ErrorType: ",U,"       \n          Message: ",P.ErrorMessage,"     \n"];if(U=="ParserError"){T.push("XamlFile: ",P.xamlFile,"     \n              Line: ",P.lineNumber,"     \n              Position: ",P.charPosition,"     \n");}else{if(U=="RuntimeError"){if(P.lineNumber!=0){T.push("Line: ",P.lineNumber,"     \n                    Position: ",P.charPosition,"     \n");}T.push("MethodName: ",P.methodName,"     \n");}}throw new Error(apf.formatErrorString(0,this,T.join("")));}function c(){for(var P=s-1;P>=0;P--){window["__slEvent"+P]=null;}s=0;if(window.removeEventListener){window.removeEventListener("unload",c,false);}else{window.detachEvent("onunload",c);}}function z(Q){var P="";if(typeof Q=="string"){P=Q;}else{if(typeof Q=="function"){if(s==0){if(window.addEventListener){window.addEventListener("onunload",c,false);}else{window.attachEvent("onunload",c);}}var R=s++;P="__slEvent"+R;window[P]=Q;}else{P=null;}}return P;}function N(){}function a(){}function I(){}function C(){}function F(Q,P){var T=false;try{if(P.ErrorCode==8001&&!i){I();i=true;}else{if(P.ErrorCode==8002&&!i){a();i=true;}else{if(P.ErrorCode==5014||P.ErrorCode==2106){if(M(P.getHost())){T=true;}}else{T=true;}}}}catch(R){}return T;}function q(P){var R=false;try{if(M(P.getHost())){R=true;}}catch(Q){}return R;}function M(Q){var U=false,P="2.0.31005",T=null;try{if(Q.IsVersionSupported(P+".99")){T=N;U=true;}else{if(Q.IsVersionSupported(P+".0")){T=a;}else{T=I;}}if(T&&!i){T();i=true;}}catch(R){}return U;}var G={};function o(P){if(typeof P=="undefined"){P="1.0";}if(typeof G[P]=="undefined"){G[P]=u(P);}return G[P];}return{onGetSilverlight:null,isBrowserRestartRequired:false,startup:j,createObject:A,createObjectEx:J,getSilverlight:w,default_error_handler:B,isAvailable:o};})();apf.flash=(function(){function getControlVersion(){var version,axo;try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");version=axo.GetVariable("$version");}catch(e){}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");version="WIN 6,0,21,0";axo.AllowScriptAccess="always";version=axo.GetVariable("$version");}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");version=axo.GetVariable("$version");}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");version="WIN 3,0,18,0";}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");version="WIN 2,0,0,11";}catch(e){version=-1;}}return version;}function getSwfVersion(){var flashVer=-1,sAgent=navigator.userAgent.toLowerCase();if(navigator.plugins!=null&&navigator.plugins.length>0){if(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]){var swVer2=navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"",swfDescr=navigator.plugins["Shockwave Flash"+swVer2].description,aDescr=swfDescr.split(" "),aTempMaj=aDescr[2].split("."),nMajor=aTempMaj[0],nMinor=aTempMaj[1],sRev=aDescr[3];if(sRev==""){sRev=aDescr[4];}if(sRev[0]=="d"){sRev=sRev.substring(1);}else{if(sRev[0]=="r"){sRev=sRev.substring(1);if(sRev.indexOf("d")>0){sRev=sRev.substring(0,sRev.indexOf("d"));}}}flashVer=nMajor+"."+nMinor+"."+sRev;}}else{if(sAgent.indexOf("webtv/2.6")!=-1){flashVer=4;}else{if(sAgent.indexOf("webtv/2.5")!=-1){flashVer=3;}else{if(sAgent.indexOf("webtv")!=-1){flashVer=2;}else{if(apf.isIE&&!apf.isOpera){flashVer=getControlVersion();}}}}}return flashVer;}function detectFlashVersion(reqMajorVer,reqMinorVer,reqRevision){var versionStr=getSwfVersion();if(versionStr==-1){return false;}if(versionStr!=0){var aVersions;if(apf.isIE&&!apf.isOpera){var aTemp=versionStr.split(" "),sTemp=aTemp[1];aVersions=sTemp.split(",");}else{aVersions=versionStr.split(".");}var nMajor=aVersions[0],nMinor=aVersions[1],sRev=aVersions[2];if(nMajor>parseFloat(reqMajorVer)){return true;}if(nMajor==parseFloat(reqMajorVer)){if(nMinor>parseFloat(reqMinorVer)){return true;}if(nMinor==parseFloat(reqMinorVer)&&sRev>=parseFloat(reqRevision)){return true;}}return false;}}function generateObj(objAttrs,params,embedAttrs,stdout){if(stdout=="undefined"){stdout=false;}var i,str=[];if(apf.isIE&&!apf.isOpera){str.push("<object ");for(i in objAttrs){str.push(i,'="',objAttrs[i],'" ');}str.push(">");for(i in params){str.push('<param name="',i,'" value="',params[i],'" />');}str.push("</object>");}else{str.push("<embed ");for(i in embedAttrs){str.push(i,'="',embedAttrs[i],'" ');}str.push("></embed>");}var sOut=str.join("");if(stdout===true){document.write(sOut);}return sOut;}function AC_FL_RunContent(options){var ret=AC_GetArgs(options,"movie","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash");return generateObj(ret.objAttrs,ret.params,ret.embedAttrs);}function buildContent(options){var v=isEightAvailable();if(isAvailable()&&!v){return buildInstaller(options||{});}if(v){return AC_FL_RunContent(options);}return'This content requires the             <a href="http://www.adobe.com/go/getflash/">Adobe Flash Player</a>.';}function embed(options){var obj=options.context,node=options.htmlNode,prop=options.property||"$player";delete options.context,delete options.htmlNode,delete options.property;var content=buildContent(options),cb=function(){$setTimeout(function(){node.innerHTML=content;obj[prop]=getElement(options.id);$setTimeout(function(){var fail=null;if(!obj[prop].parentNode){fail="File Uploader error: The movie has to be enabled manually because of Flashblock. No browser refresh is required.";}else{if(obj[prop].style.display=="none"){fail="File Uploader error: Adblock Plus blocks or hides the movie. Please enable it and refresh your browser.";}else{if(!obj[prop].offsetWidth){fail="File Uploader error: The Flash movie failed to load. Please check if the file exists and the path is correct.";}}}if(fail){obj.dispatchEvent("error",{message:fail});}},1000);},200);};return apf.loaded?cb():apf.addEventListener("load",cb);}function buildInstaller(options){if(!options){options={};}var ret=AC_GetArgs(options,"movie","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash"),MMPlayerType=(apf.isIE==true)?"ActiveX":"PlugIn",MMredirectURL=window.location;document.title=document.title.slice(0,47)+" - Flash Player Installation";var MMdoctitle=document.title;return AC_FL_RunContent({src:"playerProductInstall",FlashVars:"MMredirectURL="+MMredirectURL+"&MMplayerType="+MMPlayerType+"&MMdoctitle="+MMdoctitle+"",width:"100%",height:"100%",align:"middle",id:ret.embedAttrs.name,quality:"high",bgcolor:"#000000",name:ret.embedAttrs.name,allowScriptAccess:"always",type:"application/x-shockwave-flash",pluginspage:"http://www.adobe.com/go/getflashplayer"});}var sSrc="src|movie",sObj="onafterupdate|onbeforeupdate|onblur|oncellchange|onclick|ondblclick|ondrag|ondragend|ondragenter|ondragleave|ondragover|ondrop|onfinish|onfocus|onhelp|onmousedown|onmouseup|onmouseover|onmousemove|onmouseout|onkeypress|onkeydown|onkeyup|onload|onlosecapture|onpropertychange|onreadystatechange|onrowsdelete|onrowenter|onrowexit|onrowsinserted|onstart|onscroll|onbeforeeditfocus|onactivate|onbeforedeactivate|ondeactivate|type|codebase|id",sEmb="width|height|align|vspace|hspace|class|title|accesskey|name|tabindex";function AC_GetArgs(options,srcParamName,classid,mimeType){var i,name,ret={embedAttrs:{},params:{},objAttrs:{}};for(i in options){name=i.toLowerCase();if(name=="classid"){continue;}if(name=="pluginspage"){ret.embedAttrs[i]=options[i];}else{if(sSrc.indexOf(name)>-1){ret.embedAttrs.src=options[i];ret.params[srcParamName]=options[i];}else{if(sObj.indexOf(name)>-1){ret.objAttrs[i]=options[i];}else{if(sEmb.indexOf(name)>-1){ret.embedAttrs[i]=ret.objAttrs[i]=options[i];}else{ret.embedAttrs[i]=ret.params[i]=options[i];}}}}}ret.objAttrs.classid=classid;if(mimeType){ret.embedAttrs.type=mimeType;}return ret;}function getElement(id){var elem;if(typeof id=="object"){return id;}if(apf.isIE){return self[id];}else{elem=document[id]?document[id]:document.getElementById(id);if(!elem){elem=apf.lookup(id);}return elem;}}var hash={},uniqueID=1;function addPlayer(player){hash[++uniqueID]=player;return uniqueID;}function getPlayer(id){return hash[id];}function callMethod(id,methodName){var player=hash[id];if(player==null){throw new Error(apf.formatErrorString(0,this,"Player with id: "+id+" not found"));}if(player[methodName]==null){throw new Error(apf.formatErrorString(0,this,"Method "+methodName+" Not found"));}var args=[],i=2,l=arguments.length;for(;i<l;i++){args.push(decode(arguments[i]));}player[methodName].apply(player,args);}function remote(o,fn){if(typeof o=="string"){o=hash[o];}var rs=o.CallFunction('<invoke name="'+fn+'" returntype="javascript">'+__flash__argumentsToXML(arguments,2)+"</invoke>");return eval(rs);}function encode(data){if(!data||typeof data!="string"){return data;}return data.replace(/\&([^;]*)\;/g,"&amp;$1;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace("\\","&custom_backslash;").replace(/\0/g,"\\0").replace(/\"/g,"&quot;");}function decode(data){if(data&&data.length&&typeof data!="string"){data=data[0];}if(!data||typeof data!="string"){return data;}return data.replace(/\&custom_lt\;/g,"<").replace(/\&custom_gt\;/g,">").replace(/\&custom_backslash\;/g,"\\").replace(/\\0/g,"\0");}var aIsAvailable={};function isAvailable(sVersion){if(typeof sVersion!="string"){sVersion="6.0.65";}var aVersion=sVersion.split(".");while(aVersion.length<3){aVersion.push("0");}if(typeof aIsAvailable[sVersion]=="undefined"){aIsAvailable[sVersion]=detectFlashVersion(parseInt(aVersion[0]),parseInt(aVersion[1]),parseInt(aVersion[2]));}return aIsAvailable[sVersion];}function isEightAvailable(){return isAvailable("8.0.0");}var oSandboxTypes={remote:"remote (domain-based) rules",localwithfile:"local with file access (no internet access)",localwithnetwork:"local with network (internet access only, no local access)",localtrusted:"local, trusted (local + internet access)"};function getSandbox(sType){var oSandbox={type:null,description:null,noRemote:false,noLocal:false,error:null};oSandbox.type=sType.toLowerCase();oSandbox.description=oSandboxTypes[(typeof oSandboxTypes[oSandbox.type]!="undefined"?oSandbox.type:"unknown")];if(oSandbox.type=="localwithfile"){oSandbox.noRemote=true;oSandbox.noLocal=false;oSandbox.error="Flash security note: Network/internet URLs will not                                  load due to security restrictions.                                 Access can be configured via Flash Player Global Security                                 Settings Page:                                  http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html";}else{if(oSandbox.type=="localwithnetwork"){oSandbox.noRemote=false;oSandbox.noLocal=true;}else{if(oSandbox.type=="localtrusted"){oSandbox.noRemote=false;oSandbox.noLocal=false;}}}return oSandbox;}return{isAvailable:isAvailable,isEightAvailable:isEightAvailable,buildContent:buildContent,embed:embed,encode:encode,decode:decode,getElement:getElement,addPlayer:addPlayer,getPlayer:getPlayer,callMethod:callMethod,getSandbox:getSandbox,remote:remote};})();apf.setcookie=function(d,j,c,m,i,l){var a=d+"="+escape(j)+";";if(c){a+="expires="+new Date(c+new Date().getTimezoneOffset()*60).toGMTString()+";";}if(m){a+="path="+m+";";}if(i){a+="domain="+i+";";}if(l){a+="secure";}document.cookie=a;return j;};apf.getcookie=function(d){var c=document.cookie.split("; ");for(var j=0;j<c.length;j++){var a=c[j].split("=");if(d==a[0]){return unescape(a[1]);}}return"";};apf.delcookie=function(a,c){document.cookie=a+"=blah; expires=Fri, 31 Dec 1999 23:59:59 GMT;"+(c?"domain="+c:"");};apf.highlightXml=apf.highlightCode=function(m){var c=m.split(/\n\r?/);for(var j=1000,d=0,a=c.length;d<a;d++){j=Math.min(j,c[d].match(/^(\s+)?[^\s]/)&&RegExp.$1.length||1000);if(!j){break;}}m=m.replace(new RegExp("^ {"+j+"}","gm"),"").replace(/<!--([\s\S]+?)-->|<\?([\w\-]+)([\s\S]+?)\?>|<\!\[CDATA\[([\s\S]*?)\]\]>|<(\w+:)?script([\s\S]*?)>([\s\S]*?)<\/(?:\w+:)?script>|<([\/\w\:\-]+)([\s\S]*?)(\/?)>/g,function(o,s,q,u,w,i,t,A,n,z,l){if(s){return'<span style="color:green">&lt;!--'+s+"--&gt;</span>";}else{if(q){return'<span style="color:orange">&lt;?'+q+"</span>"+apf.highlightJs(u,true)+'<span style="color:orange">?&gt;</span>';}else{if(w){return'<span style="color:gray">&lt;![CDATA['+w+"]]&gt;</span>";}else{if(i){return'<span style="color:#127ac6">&lt;'+i+"script"+(z?"</span>"+z.replace(/("[\s\S]*?")|([\w\-\:]+)/g,function(B,D,C){if(D){return D;}return'<span style="color:red">'+C+"</span>";})+'<span style="color:#127ac6">&gt;</span>':"&gt;</span>")+apf.highlightJs(A,true)+'<span style="color:#127ac6">&lt;/'+i+"script&gt;</span>";}else{if(n){return'<span style="color:#127ac6">&lt;'+(n.substr(0,2)=="a:"?"<a href='element."+n.substr(2)+"'>"+n+"</a>":n)+(z?"</span>"+z.replace(/("[\s\S]*?")|([\w\-\:]+)/g,function(B,D,C){if(D){return D;}return'<span style="color:red">'+C+"</span>";})+'<span style="color:#127ac6">'+l+"&gt;</span>":"&gt;</span>");}}}}}});return m;};apf.convertAmlToJson=function(l){var i=apf.getXml("<a:app xmlns:a='"+apf.ns.apf+"'>"+l+"</a:app>",null,true);var d=[],c={"true":1,"false":1};var a=(function j(n,B,w){var t=new Array(B+2).join("  "),o=[];for(var q,C=0,u=n.length;C<u;C++){q=n[C];if(q.nodeType==3||q.nodeType==4){if(q.nodeValue.replace(/[\s]*$/,"").replace(/^[\s]*/,"")){(w||o).push("data",'"'+q.nodeValue.trim().replace(/"/g,'\\"').replace(/\n/g,"\\\n")+'"');}continue;}else{if(q.nodeType==8){o.push(t+"//"+q.nodeValue);continue;}else{if(q.nodeType!=1){continue;}else{if(q[apf.TAGNAME]=="script"){var J=q.childNodes;for(var z=0,A=J.length;z<A;z++){if(J[z].nodeValue.trim()!="//"){d.push(J[z].nodeValue.replace(/^ {16}/gm,"").replace(/\/\/$/,"")+"\n");}}continue;}}}}var E,D=q.childNodes.length+(E=q.attributes).length;var G=0,m=[];o.push(t+"new apf."+q[apf.TAGNAME]+(D||!B?"({":"()"+(B==0?";":(C==u-1?"":","))));if(!B){m.push("htmlNode","document.body");G=Math.max(8,G);}for(var I,z=0,A=E.length;z<A;z++){m.push((I=E[z]).nodeName,I.nodeName.substr(0,2)=="on"?"function(){"+I.nodeValue+"}":(parseInt(I.nodeValue)==I.nodeValue||c[I.nodeValue]?I.nodeValue:'"'+I.nodeValue.replace(/"/g,'\\"')+'"'));G=Math.max(I.nodeName.length,G);}var F="";if(q[apf.TAGNAME]=="model"&&q.childNodes.length){m.push("data",'"'+apf.serializeChildren(q).trim().replace(/"/g,'\\"').replace(/\r?\n/g,"\\\n")+'"');}else{if(D){var F=j(q.childNodes,B+2,m);}}G=Math.max(F?10:4,G);G++;for(z=0,A=m.length;z<A;z+=2){o.push(t+"  "+m[z].pad(G," ",apf.PAD_RIGHT)+": "+m[z+1]+(z!=A-2||F?",":""));}if(F){o.push(t+"  "+"childNodes".pad(G," ",apf.PAD_RIGHT)+": [");o.push(F.substr(0,F.length-1));o.push(t+"  ]");}if(D||!B){o.push(t+"})"+(B==0?";":(C==u-1?"":",")));}}return o.join("\n")+(B==0?"\n\n"+d.join("").trim():"");})(i.childNodes,0);return a+"\n\n";};apf.highlightJs=function(a,n){if(!n){var d=a.split(/\n\r?/);for(var m=1000,j=0,c=d.length;j<c;j++){m=Math.min(m,d[j].match(/^(\s+)?[^\s]/)&&RegExp.$1.length||1000);if(!m){break;}}a=a.replace(new RegExp("^ {"+m+"}","gm"),"");}return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/(\/\*[\s\S]+\*\/)|(\/\/.*)$|("(?:[^"\\]+|\\[\s\S])*")|('(?:[^'\\]+|\\[\s\S])*')|(\W)(apf|break|continue|do|for|import|new|this|void|case|default|else|function|in|return|typeof|while|comment|delete|export|if|label|switch|var|with|abstract|implements|protected|boolean|instanceOf|public|byte|int|short|char|interface|static|double|long|synchronized|false|native|throws|final|null|transient|float|package|true|goto|private|catch|enum|throw|class|extends|try|const|finally|debugger|super)(\W)|(\W)(\w+)(\s*\()/gm,function(i,B,z,q,o,t,u,l,w,s,A){if(s){return w+'<span style="color:#ff8000">'+s+"</span>"+A;}else{if(z||B){return'<span style="color:green">'+(z||B)+"</span>";}else{if(q||o){return'<span style="color:#808080">'+(q||o)+"</span>";}else{if(t){return t+'<span style="color:#127ac6">'+u+"</span>"+l;}}}}});};apf.highlightCode2=function(a){var d=[],c=[];return a.replace(/(\/\*[\s\S]*?\*\/|\/\/.*)/g,function(i){d.push(i);return"###n"+(d.length-1)+"###";}).replace(/\"([\s\S]*?)\"/g,function(j,i){c.push(i);return"###s"+(c.length-1)+"###";}).replace(/\'([\s\S]*?)\'/g,function(j,i){c.push(i);return"###q"+(c.length-1)+"###";}).replace(/(\<)|(\>)/g,function(l,j,i){return"<span stylecolorwhite>"+(j?"@lt@":"@gt@")+"</span>";}).replace(/(\W)-?([\d\.]+)(\W)/g,"$1<span stylecolor#127ac6>$2</span>$3").replace(/([\|\&\=\;\,\:\?\+\*\-]+)/g,"<span stylecolorwhite>$1</span>").replace(/(\W)(break|continue|do|for|import|new|this|void|case|default|else|function|in|return|typeof|while|comment|delete|export|if|label|switch|var|with|abstract|implements|protected|boolean|instanceOf|public|byte|int|short|char|interface|static|double|long|synchronized|false|native|throws|final|null|transient|float|package|true|goto|private|catch|enum|throw|class|extends|try|const|finally|debugger|super)(\W)/g,"$1<span stylecolorgreen>$2</span>$3").replace(/([\(\)\{\}\[\]])/g,"<span stylecoloryellow>$1</span>").replace(/###n(\d+)###/g,function(j,i){return"<span stylecolorpurple>"+d[i].escapeHTML()+"</span>";}).replace(/###s(\d+)###/g,function(j,i){return'<span stylecolorgray>"'+c[i].escapeHTML()+'"</span>';}).replace(/###q(\d+)###/g,function(j,i){return"<span stylecolorgray>'"+c[i].escapeHTML()+"'</span>";}).replace(/stylecolor(.*?)\>/g,"style='color:$1'>").replace(/@(.*?)@/g,"&$1;");};apf.formatJS=function(c){var j=0,a=0;var l=[],i=[];return c.replace(/(\/\*[\s\S]*?\*\/|\/\/.*)/g,function(d){l.push(d);return"###n"+(l.length-1)+"###";}).replace(/\"([\s\S]*?)\"/g,function(m,d){i.push(d);return"###s"+(i.length-1)+"###";}).replace(/\'([\s\S]*?)\'/g,function(m,d){i.push(d);return"###q"+(i.length-1)+"###";}).replace(/;+/g,";").replace(/{;/g,"{").replace(/({)|(})|(\()|(\))|(;)/g,function(d,w,z,q,s,t){if(w){j++;}if(z){j--;}if(q){a++;return q;}if(s){a--;return s;}var u="";for(var n=0;n<j;n++){u+="\t";}if(w){return"{\n"+u;}if(z){return"\n"+u+"}";}if(t){return(a>0)?t:(";\n"+u);}}).replace(/;\s*\n\s*\n/g,";\n").replace(/}var/g,"}\nvar").replace(/([\n\s]*)###n(\d+)###[\n\s]*/g,function(m,d,n){return d+l[n]+d;}).replace(/###s(\d+)###/g,function(m,d,n){return'"'+i[d]+'"';}).replace(/###q(\d+)###/g,function(m,d,n){return"'"+i[d]+"'";});};apf.pasteWindow=function(c){var a=window.open("about:blank");a.document.write(c);};apf.xmlEntityMap={quot:"34",amp:"38",apos:"39",lt:"60",gt:"62",nbsp:"160",iexcl:"161",cent:"162",pound:"163",curren:"164",yen:"165",brvbar:"166",sect:"167",uml:"168",copy:"169",ordf:"170",laquo:"171",not:"172",shy:"173",reg:"174",macr:"175",deg:"176",plusmn:"177",sup2:"178",sup3:"179",acute:"180",micro:"181",para:"182",middot:"183",cedil:"184",sup1:"185",ordm:"186",raquo:"187",frac14:"188",frac12:"189",frac34:"190",iquest:"191",agrave:"192",aacute:"193",acirc:"194",atilde:"195",auml:"196",aring:"197",aelig:"198",ccedil:"199",egrave:"200",eacute:"201",ecirc:"202",euml:"203",igrave:"204",iacute:"205",icirc:"206",iuml:"207",eth:"208",ntilde:"209",ograve:"210",oacute:"211",ocirc:"212",otilde:"213",ouml:"214",times:"215",oslash:"216",ugrave:"217",uacute:"218",ucirc:"219",uuml:"220",yacute:"221",thorn:"222",szlig:"223",agrave:"224",aacute:"225",acirc:"226",atilde:"227",auml:"228",aring:"229",aelig:"230",ccedil:"231",egrave:"232",eacute:"233",ecirc:"234",euml:"235",igrave:"236",iacute:"237",icirc:"238",iuml:"239",eth:"240",ntilde:"241",ograve:"242",oacute:"243",ocirc:"244",otilde:"245",ouml:"246",divide:"247",oslash:"248",ugrave:"249",uacute:"250",ucirc:"251",uuml:"252",yacute:"253",thorn:"254",yuml:"255",oelig:"338",oelig:"339",scaron:"352",scaron:"353",yuml:"376",fnof:"402",circ:"710",tilde:"732",alpha:"913",beta:"914",gamma:"915",delta:"916",epsilon:"917",zeta:"918",eta:"919",theta:"920",iota:"921",kappa:"922",lambda:"923",mu:"924",nu:"925",xi:"926",omicron:"927",pi:"928",rho:"929",sigma:"931",tau:"932",upsilon:"933",phi:"934",chi:"935",psi:"936",omega:"937",alpha:"945",beta:"946",gamma:"947",delta:"948",epsilon:"949",zeta:"950",eta:"951",theta:"952",iota:"953",kappa:"954",lambda:"955",mu:"956",nu:"957",xi:"958",omicron:"959",pi:"960",rho:"961",sigmaf:"962",sigma:"963",tau:"964",upsilon:"965",phi:"966",chi:"967",psi:"968",omega:"969",thetasym:"977",upsih:"978",piv:"982",ensp:"8194",emsp:"8195",thinsp:"8201",zwnj:"8204",zwj:"8205",lrm:"8206",rlm:"8207",ndash:"8211",mdash:"8212",lsquo:"8216",rsquo:"8217",sbquo:"8218",ldquo:"8220",rdquo:"8221",bdquo:"8222",dagger:"8224",dagger:"8225",bull:"8226",hellip:"8230",permil:"8240",prime:"8242",prime:"8243",lsaquo:"8249",rsaquo:"8250",oline:"8254",frasl:"8260",euro:"8364",image:"8465",weierp:"8472",real:"8476",trade:"8482",alefsym:"8501",larr:"8592",uarr:"8593",rarr:"8594",darr:"8595",harr:"8596",crarr:"8629",larr:"8656",uarr:"8657",rarr:"8658",darr:"8659",harr:"8660",forall:"8704",part:"8706",exist:"8707",empty:"8709",nabla:"8711",isin:"8712",notin:"8713",ni:"8715",prod:"8719",sum:"8721",minus:"8722",lowast:"8727",radic:"8730",prop:"8733",infin:"8734",ang:"8736",and:"8743",or:"8744",cap:"8745",cup:"8746","int":"8747",there4:"8756",sim:"8764",cong:"8773",asymp:"8776",ne:"8800",equiv:"8801",le:"8804",ge:"8805",sub:"8834",sup:"8835",nsub:"8836",sube:"8838",supe:"8839",oplus:"8853",otimes:"8855",perp:"8869",sdot:"8901",lceil:"8968",rceil:"8969",lfloor:"8970",rfloor:"8971",lang:"9001",rang:"9002",loz:"9674",spades:"9824",clubs:"9827",hearts:"9829",diams:"9830"};apf.htmlentities=function(a){return a.escapeHTML();};apf.xmlentities=function(a){return a.replace(/&([a-z]+);/gi,function(d,c){if(apf.xmlEntityMap[c=c.toLowerCase()]){return"&#"+apf.xmlEntityMap[c]+";";}return d;});};apf.html_entity_decode=function(a){return(a||"").replace(/\&\#38;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&nbsp;/g," ");};apf.isCharacter=function(a){return(a<112||a>122)&&(a==32||a>42||a==8);};apf.randomGenerator={d:new Date(),seed:null,A:48271,M:2147483647,Q:null,R:null,oneOverM:null,generate:function(c,a){if(this.seed==null){this.seed=2345678901+(this.d.getSeconds()*16777215)+(this.d.getMinutes()*65535);}this.Q=this.M/this.A;this.R=this.M%this.A;this.oneOverM=1/this.M;return Math.floor((a-c+1)*this.next()+c);},next:function(){var a=this.seed/this.Q;var c=this.seed%this.Q;var d=this.A*c-this.R*a;if(d>0){this.seed=d;}else{this.seed=d+this.M;}return(this.seed*this.oneOverM);}};apf.getNoCacheUrl=function(a){return a+(a.indexOf("?")==-1?"?":"&")+"nocache="+new Date().getTime();};apf.parseExpression=function(str){if(!apf.parseExpression.regexp.test(str)){return str;}return eval(RegExp.$1);};apf.parseExpression.regexp=/^\{([\s\S]*)\}$/;apf.formatNumber=function(a,d){var c=parseFloat(a);if(!c){return a;}var i=new String(Math.round(c*100)/100).replace(/(\.\d?\d?)$/,function(j){return j.pad(3,"0",apf.PAD_RIGHT);});if(i.indexOf(".")==-1){i+=".00";}return d+i;};apf.exec=function(str,win){if(!str){return str;}if(!win){win=self;}if(apf.isO3){eval(str,self);}else{if(apf.hasExecScript){win.execScript(str);}else{var head=win.document.getElementsByTagName("head")[0];if(head){var script=win.document.createElement("script");script.setAttribute("type","text/javascript");script.text=str;head.appendChild(script);head.removeChild(script);}else{eval(str,win);}}}return str;};apf.K=function(){};apf.isNumber=function(a){return parseFloat(a)==a;};apf.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]";};apf.isTrue=function(a){return(a===true||a==="true"||a==="on"||typeof a=="number"&&a>0||a==="1");};apf.isFalse=function(a){return(a===false||a==="false"||a==="off"||a===0||a==="0");};apf.isNot=function(a){return(!a&&typeof a!="string"&&a!==0||(typeof a=="number"&&!isFinite(a)));};apf.removePathContext=function(c,a){if(!a){return"";}if(a.indexOf(c)>-1){return a.substr(c.length);}return a;};apf.cancelBubble=function(a,c){a.cancelBubble=true;if(c.$focussable&&!c.disabled){apf.window.$focus(c);}};apf.destroyHtmlNode=function(a){if(!a){return;}if(!apf.isIE||a.ownerDocument!=document){if(a.parentNode){a.parentNode.removeChild(a);}return;}var c=document.getElementById("IELeakGarbageBin");if(!c){c=document.createElement("DIV");c.id="IELeakGarbageBin";c.style.display="none";document.body.appendChild(c);}c.appendChild(a);c.innerHTML="";};apf.getRules=function(c){var d={};for(var a=c.firstChild;a;a=a.nextSibling){if(a.nodeType!=1){continue;}else{if(!d[a[apf.TAGNAME]]){d[a[apf.TAGNAME]]=[];}d[a[apf.TAGNAME]].push(a);}}return d;};apf.getBox=function(j,d){if(!d){d=0;}if(j==null||(!parseInt(j)&&parseInt(j)!=0)){return[0,0,0,0];}var a=j.split(" ");for(var c=0;c<a.length;c++){a[c]=parseInt(a[c])||0;}switch(a.length){case 1:a[1]=a[0];a[2]=a[0];a[3]=a[0];break;case 2:a[2]=a[0];a[3]=a[1];break;case 3:a[3]=a[1];break;}return a;};apf.getNode=function(d,a){var j=0;if(d!=null){for(var c=0;c<d.childNodes.length;c++){if(d.childNodes[c].nodeType==1){if(j==a[0]){d=d.childNodes[c];if(a.length>1){a.shift();d=this.getNode(d,a);}return d;}j++;}}}return null;};apf.getFirstElement=function(a){return a.firstChild.nodeType==1?a.firstChild:a.firstChild.nextSibling;};apf.getLastElement=function(a){return a.lastChild.nodeType==1?a.lastChild:a.lastChild.previousSibling;};apf.selectTextHtml=function(c){if(!apf.hasMsRangeObject){return;}var a=document.selection.createRange();try{a.moveToElementText(c);}catch(d){}a.select();};apf.isChildOf=function(a,i,c){if(!a||!i){return false;}if(i.nodeType==2){i=i.selectSingleNode("..");}if(c&&a==i){return true;}var d=i.parentNode;while(d){if(d==a){return true;}d=d.parentNode;}return false;};apf.isOnlyChild=function(n,c){if(!n||!n.parentNode||c&&c.indexOf(n.nodeType)==-1){return false;}var j,a,m,d=n.parentNode.childNodes;for(j=0,a=d.length;j<a;j++){m=d[j];if(m.nodeType==1&&m!=n){return false;}if(m.nodeType==3&&!m.nodeValue.trim()){return false;}}return true;};apf.getChildNumber=function(l,a){var m=l.parentNode,c=0;if(!m){return 0;}for(var d=0;d<m.childNodes.length;d++){if(m.childNodes[d]==l){return c;}if(!a||l.nodeType==1&&l.tagName==m.childNodes[d].tagName){c++;}}return c;};apf.mergeXml=function(A,t,D){if(typeof t!="object"){t=getElementById(t);}if(D&&D.clearContents){var d,n,q,a=t.selectNodes("descendant::node()[@"+apf.xmldb.xmlListenTag+"]");for(q=a.length-1;q>=0;q--){var C=a[q].getAttribute(apf.xmldb.xmlListenTag).split(";");for(n=C.length-1;n>=0;n--){d=apf.all[C[n]];if(d.dataParent&&d.dataParent.xpath){d.dataParent.parent.signalXmlUpdate[d.$uniqueId]=true;}else{if(d.$model){d.$model.$waitForXml(d);}}}}var a=t.childNodes;for(var q=a.length-1;q>=0;q--){t.removeChild(a[q]);}}if(D&&D.start){var c,w,a,z,q,m,o=D.marker;if(!o){}if(o.getAttribute("start")-D.start==0){o.setAttribute("start",D.start+D.length);c=parseInt(o.getAttribute("reserved"));o.setAttribute("reserved",c+D.length);w=o;}else{if(D.start+D.length==o.getAttribute("end")){o.setAttribute("end",D.start+D.length);w=o.nextSibling;c=parseInt(o.getAttribute("reserved"))+parseInt(o.getAttribute("end"))-D.length;}else{var B=o.parentNode.insertBefore(o.cloneNode(true),o);B.setAttribute("end",D.start-1);o.setAttribute("start",D.start+D.length);c=parseInt(o.getAttribute("reserved"));o.setAttribute("reserved",c+D.length);w=o;}}a=A.childNodes;if(t.ownerDocument.importNode){z=t.ownerDocument;for(q=0,m=a.length;q<m;q++){t.insertBefore(z.importNode(a[q],true),w).setAttribute(apf.xmldb.xmlIdTag,D.documentId+"|"+(c+q));}}else{for(q=a.length-1;q>=0;q--){t.insertBefore(a[0],w).setAttribute(apf.xmldb.xmlIdTag,D.documentId+"|"+(c+q));}}}else{w=D.beforeNode||apf.getNode(t,[0]);a=A.childNodes;if(t.ownerDocument.importNode){z=t.ownerDocument;for(q=0,m=a.length;q<m;q++){t.insertBefore(z.importNode(a[q],true),w);}}else{for(q=a.length-1;q>=0;q--){t.insertBefore(a[0],w);}}}if(D&&D.copyAttributes){var u=A.attributes;for(q=0;q<u.length;q++){if(u[q].nodeName!=apf.xmldb.xmlIdTag){t.setAttribute(u[q].nodeName,u[q].nodeValue);}}}return t;};apf.setNodeValue=function(j,i,m,d){if(!j){return;}var l,a,c;if(d){l=d.undoObj;a=d.xpath;c=d.newNodes;l.extra.oldValue=d.forceNew?"":apf.queryValue(j,a);l.xmlNode=j;if(a){j=apf.createNodeFromXpath(j,a,c,d.forceNew);}l.extra.appliedNode=j;}if(j.nodeType==1){if(!j.firstChild){j.appendChild(j.ownerDocument.createTextNode("-"));}j.firstChild.nodeValue=apf.isNot(i)?"":i;if(m){apf.xmldb.applyChanges("synchronize",j,l);}}else{j.nodeValue=apf.isNot(i)?"":i;if(m){apf.xmldb.applyChanges("synchronize",j.parentNode||j.ownerElement||j.selectSingleNode(".."),l);}}};apf.setQueryValue=function(c,a,i){var d=apf.createNodeFromXpath(c,a);if(!d){return null;}apf.setNodeValue(d,i,true);return d;};apf.queryValue=function(c,a){if(!c){return"";}if(c.nodeType==2){return c.nodeValue;}if(a){c=c.selectSingleNode(a);if(!c){return"";}}return c.nodeType==1?(!c.firstChild?"":c.firstChild.nodeValue):c.nodeValue;};apf.queryValues=function(l,c){var d=[];if(!l){return d;}var a=l.selectNodes(c);if(!a.length){return d;}for(var j=0;j<a.length;j++){var m=a[j];if(m.nodeType==1){m=m.firstChild;}d.push(m.nodeValue||"");}return d;};apf.queryNodes=function(c,a){if(a&&(apf.hasXPathHtmlSupport&&a.selectSingleNode||!a.style)){return a.selectNodes(c);}return apf.XPath.selectNodes(c,a);};apf.queryNode=function(c,a){if(a&&(apf.hasXPathHtmlSupport&&a.selectSingleNode||!a.style)){return a.selectSingleNode(c);}var d=apf.queryNodes(c+(apf.isIE?"":"[1]"),a?a:null);return d.length>0?d[0]:null;};apf.getInheritedAttribute=function(i,d,j){var c,a;if(i.nodeValue!=1){i=i.parentNode;}while(i&&(i.nodeType!=1||!(c=d&&((a=i.getAttribute(d))||typeof a=="string")||j&&j(i)))){i=i.parentNode;}if(a==""){return"";}return !c&&d&&apf.config?apf.config[d]:c;};apf.createNodeFromXpath=function(l,A,m,o){var w,u="",B=A.replace(/('.*?')|(".*?")|\|/g,function(i,D,C){if(D||C){return D||C;}return"-%-|-%-";}).split("-%-|-%-")[0].split("/");if(!o&&(w=l.selectSingleNode(A))){return w;}var n=B.length-1;if(o){if(B[n].trim().match(/^\@(.*)$|^text\(\)$/)){n--;}}for(var a,q=false,d=0;d<n;d++){if(!q&&l.selectSingleNode(u+(d!=0?"/":"")+B[d])){u+=(d!=0?"/":"")+B[d];continue;}var c=B[d].match(/(\w+)\[@([\w-]+)=(\w+)\]/);if(c){B[d]=c[1];}q=true;a=l.selectSingleNode(u||".").appendChild(l.ownerDocument.createElement(B[d]));if(c){a.setAttribute(c[2],c[3]);u+=(u?"/":"")+c[0];}else{u+=(u?"/":"")+B[d];}if(m){m.push(a);}}if(!u){u=".";}var t,j=B[n],s=l.nodeType==9?l:l.ownerDocument;do{if(j.match(/^\@(.*)$/)){(t||l.selectSingleNode(u)).setAttributeNode(t=l.ownerDocument.createAttribute(RegExp.$1));}else{if(j.trim()=="text()"){t=(t||l.selectSingleNode(u)).appendChild(l.ownerDocument.createTextNode(""));}else{var z=j.match(/(\w+)\[@([\w-]+)=(\w+)\]/);if(z){j=z[1];}t=(t||l.selectSingleNode(u)).appendChild(s.createElement(j));if(z){t.setAttribute(z[2],z[3]);}if(m){m.push(t);}}}u+=(u?"/":"")+B[n];}while((j=B[++n]));return t;};apf.convertMethods={json:function(a){return JSON.stringify(apf.xml2json(a));},cgivars:function(o,t){if(!t){t="";}var s=[],u,c=o.childNodes,m={};for(var n=0;n<c.length;n++){if(c[n].nodeType!=1){continue;}var a=c[n].tagName;if(m[a]){continue;}var d=o.selectNodes(a);if(d.length>1){m[a]=true;for(var l=0;l<d.length;l++){u=this.cgivars(d[l],t+a+"["+l+"]");if(u){s.push(u);}}}else{u=this.cgivars(c[n],t+a);if(u){s.push(u);}}}var q=o.attributes;for(n=0;n<q.length;n++){if(q[n].nodeValue){if(t){s.push(t+"["+q[n].nodeName+"]="+escape(q[n].nodeValue));}else{s.push(q[n].nodeName+"="+escape(q[n].nodeValue));}}}if(s.length){return s.join("&");}u=apf.queryValue(o,"text()");if(t&&u){return t+"="+escape(u);}},cgiobjects:function(n,c,q){if(!c){c="";}var z=[],w,t=n.childNodes,s={};for(var E=0;E<t.length;E++){var A=t[E];if(A.nodeType!=1){continue;}var I=A.tagName;if(I=="revision"){continue;}var m=apf.isOnlyChild(A.firstChild,[3,4]);var o=0;if(!A.attributes.length&&!m){var F=A.childNodes;for(var d,D=0,B=F.length;D<B;D++){if(F[D].nodeType!=1){continue;}d=c+(q?"[":"")+I+(q?"]":"")+"["+E+"]";w=this.cgiobjects(F[D],d,true);if(w){z.push(w);}if(apf.isOnlyChild(F[D].firstChild,[3,4])){z.push(d+"["+F[D].tagName+"]="+escape(F[D].firstChild.nodeValue));}var C,G,u=F[D].attributes;for(C=0;C<u.length;C++){if(!(G=u[C]).nodeValue){continue;}z.push(d+"["+G.nodeName+"]="+escape(G.nodeValue));}}}else{if(m){z.push(c+(q?"[":"")+I+(q?"]":"")+"="+escape(A.firstChild.nodeValue));}var G,u=A.attributes;for(D=0;D<u.length;D++){if(!(G=u[D]).nodeValue){continue;}z.push(c+(q?"[":"")+I+"_"+G.nodeName+(q?"]":"")+"="+escape(G.nodeValue));}}}if(!q&&n.getAttribute("id")){z.push("id="+escape(n.getAttribute("id")));}if(z.length){return z.join("&");}}};apf.convertXml=function(a,c){return apf.convertMethods[c](a);};apf.getTextNode=function(a){for(var c=0;c<a.childNodes.length;c++){if(a.childNodes[c].nodeType==3||a.childNodes[c].nodeType==4){return a.childNodes[c];}}return false;};apf.getBoundValue=function(c,i,d){if(!i&&!c.xmlRoot){return"";}var a=c.$getDataNode("value",c.xmlRoot);return a?apf.queryValue(a):"";};apf.getArrayFromNodelist=function(d){for(var a=[],c=0;c<d.length;c++){a.push(d[c]);}return a;};apf.serializeChildren=function(j){var m=[],c=j.childNodes;for(var n,d=0,a=c.length;d<a;d++){m[d]=(n=c[d]).nodeType==1?n.xml||n.serialize():(n.nodeType==8?"":n.nodeValue);}return m.join("");};apf.getXmlString=function(c){var a=apf.xmldb.cleanNode(c.cloneNode(true));return a.xml||a.serialize();};apf.getXml=function(d,a,c){return apf.getXmlDom(d,a,c).documentElement;};apf.formatXml=function(j){j=j.trim();var a=j.split("\n");for(var c=0;c<a.length;c++){a[c]=a[c].trim();}a=a.join("\n").replace(/\>\n/g,">").replace(/\>/g,">\n").replace(/\n\</g,"<").replace(/\</g,"\n<").split("\n");a.removeIndex(0);a.removeIndex(a.length);for(var d=0,c=0;c<a.length;c++){a[c]="    ".repeat((a[c].match(/^\s*\<\//)?(d==0)?0:--d:(a[c].match(/^\s*\<[^\?][^>]+[^\/]\>/)?d++:d)))+a[c];}if(!j){return"";}return a.join("\n");};apf.xmlToXpath=function(o,q,n){if(!o){return"";}if(n===true&&o.nodeType==1&&o.getAttribute(apf.xmldb.xmlIdTag)){return"//node()[@"+apf.xmldb.xmlIdTag+"='"+o.getAttribute(apf.xmldb.xmlIdTag)+"']";}if(apf!=this&&this.lookup&&this.select){var c=this.lookup[o.tagName];if(c){var j=o.selectSingleNode(c).nodeValue;return"//"+o.tagName+"["+c+"='"+j+"']";}for(var l=0;l<this.select.length;l++){if(o.selectSingleNode(this.select[l][0])){var j=o.selectSingleNode(this.select[l][1]).nodeValue;return"//"+this.select[l][0]+"["+this.select[l][1]+"='"+j+"']";}}}if(o==q){return".";}if(!o.parentNode){return false;}var m=[],d=o;if(d.nodeType==2){m.push("@"+d.nodeName);d=d.ownerElement||o.selectSingleNode("..");}var a;do{m.unshift((d.nodeType==1?d.tagName:"text()")+"["+(n&&(a=d.nodeType==1&&d.getAttribute(apf.xmldb.xmlIdTag))?"@"+apf.xmldb.xmlIdTag+"='"+a+"'":(apf.getChildNumber(d,true)+1))+"]");d=d.parentNode;}while(d&&d.nodeType==1&&d!=q);return m.join("/");};apf.xpathToXml=function(a,c){if(!c){return false;}return c.selectSingleNode(a);};apf.diff_match_patch=new (function(){this.diffTimeout=1;this.diffEditCost=4;this.diffDualThreshold=32;this.matchThreshold=0.5;this.matchDistance=1000;this.patchDeleteThreshold=0.5;this.patchMargin=4;var l=-1,d=1,c=0,j=function(){var s=0,o=1,q=2;while(o!=q){s++;o=q;q=q<<1;}return s;},i=function(){this.diffs=[];this.start1=null;this.start2=null;this.length1=0;this.length2=0;},m=[];m[d]="+";m[l]="-";m[c]=" ";i.prototype.toString=function(){var q=(this.length1===0)?this.start1+",0":(this.length1==1)?this.start1+1:(this.start1+1)+","+this.length1,u=(this.length2===0)?this.start2+",0":(this.length2==1)?this.start2+1:(this.start2+1)+","+this.length2,t=["@@ -"+q+" +"+u+" @@\n"],o=0,s=this.diffs.length;for(;o<s;o++){t[o+1]=m[this.diffs[o][0]]+encodeURI(this.diffs[o][1])+"\n";}return t.join("").replace(/\x00/g,"%00").replace(/%20/g," ");};this.matchMaxBits=j();this.diff_main=function(z,w,t){if(z==w){return[[c,z]];}if(typeof t=="undefined"){t=true;}var u=t,o=this.diff_commonPrefix(z,w),q=z.substring(0,o);z=z.substring(o);w=w.substring(o);o=this.diff_commonSuffix(z,w);var s=z.substring(z.length-o);z=z.substring(0,z.length-o);w=w.substring(0,w.length-o);var A=n.call(this,z,w,u);if(q){A.unshift([c,q]);}if(s){A.push([c,s]);}this.diff_cleanupMerge(A);return A;};var n=function(t,s,J){var B;if(!t){return[[d,s]];}if(!s){return[[l,t]];}var D=t.length>s.length?t:s,w=t.length>s.length?s:t,A=D.indexOf(w);if(A!=-1){B=[[d,D.substring(0,A)],[c,w],[d,D.substring(A+w.length)]];if(t.length>s.length){B[0][0]=B[2][0]=l;}return B;}D=w=null;var F,u,q=this.diff_halfMatch(t,s);if(q){return this.diff_main(q[0],q[2],J).concat([[c,q[4]]],this.diff_main(q[1],q[3],J));}if(J&&(t.length<100||s.length<100)){J=false;}if(J){F=this.diff_linesToChars(t,s);t=F[0];s=F[1];u=F[2];}B=this.diff_map(t,s);if(!B){B=[[l,t],[d,s]];}if(J){this.diff_charsToLines(B,u);this.diff_cleanupSemantic(B);B.push([c,""]);var o=0,I=0,G=0,E="",C="";while(o<B.length){switch(B[o][0]){case d:G++;C+=B[o][1];break;case l:I++;E+=B[o][1];break;case c:if(I>=1&&G>=1){F=this.diff_main(E,C,false);B.splice(o-I-G,I+G);o=o-I-G;for(var z=F.length-1;z>=0;z--){B.splice(o,0,F[z]);}o=o+F.length;}G=0;I=0;E="";C="";break;}o++;}B.pop();}return B;};this.diff_linesToChars=function(u,t){var s=[""],o={};function q(D){var B="",z=0,C=-1,A=s.length;while(C<D.length-1){C=D.indexOf("\n",z);if(C==-1){C=D.length-1;}var w=D.substring(z,C+1);z=C+1;if(o.hasOwnProperty?o.hasOwnProperty(w):(o[w]!==undefined)){B+=String.fromCharCode(o[w]);}else{B+=String.fromCharCode(A);o[w]=A;s[A++]=w;}}return B;}return[q(u),q(t),s];};this.diff_charsToLines=function(u,q){var o=0,s,t,w;for(;o<u.length;o++){s=u[o][1];t=[];for(w=0;w<s.length;w++){t[w]=q[s.charCodeAt(w)];}u[o][1]=t.join("");}};this.diff_map=function(D,B){var I=(new Date()).getTime()+this.diffTimeout*1000,M=D.length,u=B.length,O=0,w=M+u-1,G=this.diffDualThreshold*2<w,s=[],o=[],t={},q={},N={},F=false,E=!!(N.hasOwnProperty),z=(M+u)%2,C,A,J,P,K;t[1]=0;q[1]=0;for(;O<w;O++){if(this.diffTimeout>0&&(new Date()).getTime()>I){return null;}s[O]={};for(J=-O;J<=O;J+=2){if(J==-O||J!=O&&t[J-1]<t[J+1]){C=t[J+1];}else{C=t[J-1]+1;}A=C-J;if(G){K=C+","+A;if(z&&(E?N.hasOwnProperty(K):(N[K]!==undefined))){F=true;}if(!z){N[K]=O;}}while(!F&&C<M&&A<u&&D.charAt(C)==B.charAt(A)){C++;A++;if(G){K=C+","+A;if(z&&(E?N.hasOwnProperty(K):(N[K]!==undefined))){F=true;}if(!z){N[K]=O;}}}t[J]=C;s[O][C+","+A]=true;if(C==M&&A==u){return this.diff_path1(s,D,B);}else{if(F){o=o.slice(0,N[K]+1);P=this.diff_path1(s,D.substring(0,C),B.substring(0,A));return P.concat(this.diff_path2(o,D.substring(C),B.substring(A)));}}}if(G){o[O]={};for(J=-O;J<=O;J+=2){C=(J==-O||J!=O&&q[J-1]<q[J+1])?q[J+1]:q[J-1]+1;A=C-J;K=(M-C)+","+(u-A);if(!z&&(E?N.hasOwnProperty(K):(N[K]!==undefined))){F=true;}if(z){N[K]=O;}while(!F&&C<M&&A<u&&D.charAt(M-C-1)==B.charAt(u-A-1)){C++;A++;K=(M-C)+","+(u-A);if(!z&&(E?N.hasOwnProperty(K):(N[K]!==undefined))){F=true;}if(z){N[K]=O;}}q[J]=C;o[O][C+","+A]=true;if(F){s=s.slice(0,N[K]+1);P=this.diff_path1(s,D.substring(0,M-C),B.substring(0,u-A));return P.concat(this.diff_path2(o,D.substring(M-C),B.substring(u-A)));}}}}return null;};this.diff_path1=function(q,u,t){var w=[],o=u.length,A=t.length,s=null,z=q.length-2;for(;z>=0;z--){while(1){if(q[z].hasOwnProperty?q[z].hasOwnProperty((o-1)+","+A):(q[z][(o-1)+","+A]!==undefined)){o--;if(s===l){w[0][1]=u.charAt(o)+w[0][1];}else{w.unshift([l,u.charAt(o)]);}s=l;break;}else{if(q[z].hasOwnProperty?q[z].hasOwnProperty(o+","+(A-1)):(q[z][o+","+(A-1)]!==undefined)){A--;if(s===d){w[0][1]=t.charAt(A)+w[0][1];}else{w.unshift([d,t.charAt(A)]);}s=d;break;}else{o--;A--;if(s===c){w[0][1]=u.charAt(o)+w[0][1];}else{w.unshift([c,u.charAt(o)]);}s=c;}}}}return w;};this.diff_path2=function(o,t,q){var B=[],A=0,z=t.length,w=q.length,s=null,u=o.length-2;for(;u>=0;u--){while(1){if(o[u].hasOwnProperty?o[u].hasOwnProperty((z-1)+","+w):(o[u][(z-1)+","+w]!==undefined)){z--;if(s===l){B[A-1][1]+=t.charAt(t.length-z-1);}else{B[A++]=[l,t.charAt(t.length-z-1)];}s=l;break;}else{if(o[u].hasOwnProperty?o[u].hasOwnProperty(z+","+(w-1)):(o[u][z+","+(w-1)]!==undefined)){w--;if(s===d){B[A-1][1]+=q.charAt(q.length-w-1);}else{B[A++]=[d,q.charAt(q.length-w-1)];}s=d;break;}else{z--;w--;if(s===c){B[A-1][1]+=t.charAt(t.length-z-1);}else{B[A++]=[c,t.charAt(t.length-z-1)];}s=c;}}}}return B;};this.diff_commonPrefix=function(u,t){if(!u||!t||u.charCodeAt(0)!==t.charCodeAt(0)){return 0;}var q=0,w=Math.min(u.length,t.length),o=w,s=0;while(q<o){if(u.substring(s,o)==t.substring(s,o)){q=o;s=q;}else{w=o;}o=Math.floor((w-q)/2+q);}return o;};this.diff_commonSuffix=function(t,s){if(!t||!s||t.charCodeAt(t.length-1)!==s.charCodeAt(s.length-1)){return 0;}var q=0,u=Math.min(t.length,s.length),o=u,w=0;while(q<o){if(t.substring(t.length-o,t.length-w)==s.substring(s.length-o,s.length-w)){q=o;w=q;}else{u=o;}o=Math.floor((u-q)/2+q);}return o;};this.diff_halfMatch=function(s,q){var C=s.length>q.length?s:q,t=s.length>q.length?q:s,D=this;if(C.length<10||t.length<1){return null;}function A(P,G,K){var N=P.substring(K,K+Math.floor(P.length/4)),I=-1,U="",M,J,T,R,O,Q;while((I=G.indexOf(N,I+1))!=-1){O=D.diff_commonPrefix(P.substring(K),G.substring(I));Q=D.diff_commonSuffix(P.substring(0,K),G.substring(0,I));if(U.length<Q+O){U=G.substring(I-Q,I)+G.substring(I,I+O);M=P.substring(0,K-Q);J=P.substring(K+O);T=G.substring(0,I-Q);R=G.substring(I+O);}}if(U.length>=P.length/2){return[M,J,T,R,U];}else{return null;}}var w=A(C,t,Math.ceil(C.length/4)),u=A(C,t,Math.ceil(C.length/2)),o;if(!w&&!u){return null;}else{if(!u){o=w;}else{if(!w){o=u;}else{o=w[4].length>u[4].length?w:u;}}}var B,z,F,E;if(s.length>q.length){B=o[0];z=o[1];F=o[2];E=o[3];}else{F=o[0];E=o[1];B=o[2];z=o[3];}return[B,z,F,E,o[4]];};this.diff_cleanupSemantic=function(A){var t=false,o=[],w=0,u=null,z=0,s=0,q=0;while(z<A.length){if(A[z][0]==c){o[w++]=z;s=q;q=0;u=A[z][1];}else{q+=A[z][1].length;if(u!==null&&(u.length<=s)&&(u.length<=q)){A.splice(o[w-1],0,[l,u]);A[o[w-1]+1][0]=d;w--;w--;z=w>0?o[w-1]:-1;s=0;q=0;u=null;t=true;}}z++;}if(t){this.diff_cleanupMerge(A);}this.diff_cleanupSemanticLossless(A);};this.diff_cleanupSemanticLossless=function(q){var u=/[^a-zA-Z0-9]/,K=/\s/,t=/[\r\n]/,C=/\n\r?\n$/,o=/^\r?\n\r?\n/;function w(O,N){if(!O||!N){return 5;}var P=0;if(O.charAt(O.length-1).match(u)||N.charAt(0).match(u)){P++;if(O.charAt(O.length-1).match(K)||N.charAt(0).match(K)){P++;if(O.charAt(O.length-1).match(t)||N.charAt(0).match(t)){P++;if(O.match(C)||N.match(o)){P++;}}}}return P;}var G=1,A,E,z,M,s,I,D,F,B,J;while(G<q.length-1){if(q[G-1][0]==c&&q[G+1][0]==c){A=q[G-1][1];E=q[G][1];z=q[G+1][1];M=this.diff_commonSuffix(A,E);if(M){s=E.substring(E.length-M);A=A.substring(0,A.length-M);E=s+E.substring(0,E.length-M);z=s+z;}I=A;D=E;F=z;B=w(A,E)+w(E,z);while(E.charAt(0)===z.charAt(0)){A+=E.charAt(0);E=E.substring(1)+z.charAt(0);z=z.substring(1);J=w(A,E)+w(E,z);if(J>=B){B=J;I=A;D=E;F=z;}}if(q[G-1][1]!=I){if(I){q[G-1][1]=I;}else{q.splice(G-1,1);G--;}q[G][1]=D;if(F){q[G+1][1]=F;}else{q.splice(G+1,1);G--;}}}G++;}};this.diff_cleanupEfficiency=function(z){var B=false,w=[],s=0,t="",o=0,A=false,C=false,q=false,u=false;while(o<z.length){if(z[o][0]==c){if(z[o][1].length<this.diffEditCost&&(q||u)){w[s++]=o;A=q;C=u;t=z[o][1];}else{s=0;t="";}q=u=false;}else{if(z[o][0]==l){u=true;}else{q=true;}if(t&&((A&&C&&q&&u)||((t.length<this.diffEditCost/2)&&(A+C+q+u)==3))){z.splice(w[s-1],0,[l,t]);z[w[s-1]+1][0]=d;s--;t="";if(A&&C){q=u=true;s=0;}else{s--;o=s>0?w[s-1]:-1;q=u=false;}B=true;}}o++;}if(B){this.diff_cleanupMerge(z);}};this.diff_cleanupMerge=function(A){A.push([c,""]);var z=0,w=0,u=0,s="",q="",o;while(z<A.length){switch(A[z][0]){case d:u++;q+=A[z][1];z++;break;case l:w++;s+=A[z][1];z++;break;case c:if(w!==0||u!==0){if(w!==0&&u!==0){o=this.diff_commonPrefix(q,s);if(o!==0){if((z-w-u)>0&&A[z-w-u-1][0]==c){A[z-w-u-1][1]+=q.substring(0,o);}else{A.splice(0,0,[c,q.substring(0,o)]);z++;}q=q.substring(o);s=s.substring(o);}o=this.diff_commonSuffix(q,s);if(o!==0){A[z][1]=q.substring(q.length-o)+A[z][1];q=q.substring(0,q.length-o);s=s.substring(0,s.length-o);}}if(w===0){A.splice(z-w-u,w+u,[d,q]);}else{if(u===0){A.splice(z-w-u,w+u,[l,s]);}else{A.splice(z-w-u,w+u,[l,s],[d,q]);}}z=z-w-u+(w?1:0)+(u?1:0)+1;}else{if(z!==0&&A[z-1][0]==c){A[z-1][1]+=A[z][1];A.splice(z,1);}else{z++;}}u=0;w=0;s="";q="";break;}}if(A[A.length-1][1]===""){A.pop();}var t=false;z=1;while(z<A.length-1){if(A[z-1][0]==c&&A[z+1][0]==c){if(A[z][1].substring(A[z][1].length-A[z-1][1].length)==A[z-1][1]){A[z][1]=A[z-1][1]+A[z][1].substring(0,A[z][1].length-A[z-1][1].length);A[z+1][1]=A[z-1][1]+A[z+1][1];A.splice(z-1,1);t=true;}else{if(A[z][1].substring(0,A[z+1][1].length)==A[z+1][1]){A[z-1][1]+=A[z+1][1];A[z][1]=A[z][1].substring(A[z+1][1].length)+A[z+1][1];A.splice(z+1,1);t=true;}}}z++;}if(t){this.diff_cleanupMerge(A);}};this.diff_xIndex=function(A,z){var u=0,s=0,w=0,t=0,o=0,q=A.length;for(;o<q;o++){if(A[o][0]!==d){u+=A[o][1].length;}if(A[o][0]!==l){s+=A[o][1].length;}if(u>z){break;}w=u;t=s;}if(A.length!=o&&A[o][0]===l){return t;}return t+(z-w);};this.diff_prettyHtml=function(z){var t=[],s=0,o=0,q=z.length,A,u,w;for(;o<q;o++){A=z[o][0];u=z[o][1];w=u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"&para;<BR>");switch(A){case d:t[o]='<INS STYLE="background:#E6FFE6;" TITLE="i='+s+'">'+w+"</INS>";break;case l:t[o]='<DEL STYLE="background:#FFE6E6;" TITLE="i='+s+'">'+w+"</DEL>";break;case c:t[o]='<SPAN TITLE="i='+s+'">'+w+"</SPAN>";break;}if(A!==l){s+=u.length;}}return t.join("");};this.diff_text1=function(t){var s=[],o=0,q=t.length;for(;o<q;o++){if(t[o][0]!==d){s[o]=t[o][1];}}return s.join("");};this.diff_text2=function(t){var s=[],o=0,q=t.length;for(;o<q;o++){if(t[o][0]!==l){s[o]=t[o][1];}}return s.join("");};this.diff_levenshtein=function(z){var w=0,s=0,u=0,o=0,q=z.length,A,t;for(;o<q;o++){A=z[o][0];t=z[o][1];switch(A){case d:s+=t.length;break;case l:u+=t.length;break;case c:w+=Math.max(s,u);s=0;u=0;break;}}return w+Math.max(s,u);};this.diff_toDelta=function(t){var s=[],o=0,q=t.length;for(;o<q;o++){switch(t[o][0]){case d:s[o]="+"+encodeURI(t[o][1]);break;case l:s[o]="-"+t[o][1].length;break;case c:s[o]="="+t[o][1].length;break;}}return s.join("\t").replace(/\x00/g,"%00").replace(/%20/g," ");};this.diff_fromDelta=function(q,D){var z=[],w=0,o=0;D=D.replace(/%00/g,"\0");var B=D.split(/\t/g),C=0,u=B.length,t,s,E;for(;C<u;C++){t=B[C].substring(1);switch(B[C].charAt(0)){case"+":try{z[w++]=[d,decodeURI(t)];}catch(A){throw new Error("Illegal escape in diff_fromDelta: "+t);}break;case"-":case"=":s=parseInt(t,10);if(isNaN(s)||s<0){throw new Error("Invalid number in diff_fromDelta: "+t);}E=q.substring(o,o+=s);if(B[C].charAt(0)=="="){z[w++]=[c,E];}else{z[w++]=[l,E];}break;default:if(B[C]){throw new Error("Invalid diff operation in diff_fromDelta: "+B[C]);}}}if(o!=q.length){throw new Error("Delta length ("+o+") does not equal source text length ("+q.length+").");}return z;};this.match_main=function(s,o,q){q=Math.max(0,Math.min(q,s.length));if(s==o){return 0;}else{if(!s.length){return -1;}else{if(s.substring(q,q+o.length)==o){return q;}else{return this.match_bitap(s,o,q);}}}};this.match_bitap=function(D,N,B){if(N.length>this.matchMaxBits){throw new Error("Pattern too long for this browser.");}var E=this.match_alphabet(N),q=this;function o(U,s){var T=U/N.length,R=Math.abs(B-s);if(!q.matchDistance){return R?1:T;}return T+(R/q.matchDistance);}var G=this.matchThreshold,t=D.indexOf(N,B);if(t!=-1){G=Math.min(o(0,t),G);}t=D.lastIndexOf(N,B+N.length);if(t!=-1){G=Math.min(o(0,t),G);}t=-1;var P=1<<(N.length-1),z=N.length+D.length,O=0,J=N.length,w,C,A,u,F,I,K,Q,M;for(;O<J;O++){w=0;C=z;while(w<C){if(o(O,B+C)<=G){w=C;}else{z=C;}C=Math.floor((z-w)/2+w);}z=C;u=Math.max(1,B-C+1);F=Math.min(B+C,D.length)+N.length;I=Array(F+2);I[F+1]=(1<<O)-1;for(K=F;K>=u;K--){Q=E[D.charAt(K-1)];if(O===0){I[K]=((I[K+1]<<1)|1)&Q;}else{I[K]=((I[K+1]<<1)|1)&Q|(((A[K+1]|A[K])<<1)|1)|A[K+1];}if(I[K]&P){M=o(O,K-1);if(M<=G){G=M;t=K-1;if(t>B){u=Math.max(1,2*B-t);}else{break;}}}}if(o(O+1,B)>G){break;}A=I;}return t;};this.match_alphabet=function(u){var t={},q=0,o=u.length;for(;q<o;q++){t[u.charAt(q)]=0;}for(q=0;q<u.length;q++){t[u.charAt(q)]|=1<<(u.length-q-1);}return t;};this.patch_addContext=function(w,u){var q=u.substring(w.start2,w.start2+w.length1),t=0;while(u.indexOf(q)!=u.lastIndexOf(q)&&q.length<this.matchMaxBits-this.patchMargin-this.patchMargin){t+=this.patchMargin;q=u.substring(w.start2-t,w.start2+w.length1+t);}t+=this.patchMargin;var o=u.substring(w.start2-t,w.start2);if(o){w.diffs.unshift([c,o]);}var s=u.substring(w.start2+w.length1,w.start2+w.length1+t);if(s){w.diffs.push([c,s]);}w.start1-=o.length;w.start2-=o.length;w.length1+=o.length+s.length;w.length2+=o.length+s.length;};this.patch_make=function(I,q,J){var s,D;if(typeof I=="string"&&typeof q=="string"&&typeof J=="undefined"){s=I;D=this.diff_main(s,q,true);if(D.length>2){this.diff_cleanupSemantic(D);this.diff_cleanupEfficiency(D);}}else{if(typeof I=="object"&&typeof q=="undefined"&&typeof J=="undefined"){D=I;s=this.diff_text1(D);}else{if(typeof I=="string"&&typeof q=="object"&&typeof J=="undefined"){s=I;D=q;}else{if(typeof I=="string"&&typeof q=="string"&&typeof J=="object"){s=I;D=J;}else{throw new Error("Unknown call format to patch_make.");}}}}if(D.length===0){return[];}var o=[],t=new i(),A=0,C=0,B=0,z=s,F=s,G=0,u=D.length,w,E;for(;G<u;G++){w=D[G][0];E=D[G][1];if(!A&&w!==c){t.start1=C;t.start2=B;}switch(w){case d:t.diffs[A++]=D[G];t.length2+=E.length;F=F.substring(0,B)+E+F.substring(B);break;case l:t.length1+=E.length;t.diffs[A++]=D[G];F=F.substring(0,B)+F.substring(B+E.length);break;case c:if(E.length<=2*this.patchMargin&&A&&u!=G+1){t.diffs[A++]=D[G];t.length1+=E.length;t.length2+=E.length;}else{if(E.length>=2*this.patchMargin){if(A){this.patch_addContext(t,z);o.push(t);t=new i();A=0;z=F;C=B;}}}break;}if(w!==d){C+=E.length;}if(w!==l){B+=E.length;}}if(A){this.patch_addContext(t,z);o.push(t);}return o;};var a=function(t){var u=[],q=0,s=t.length,z,o,w;for(;q<s;q++){z=t[q];o=new i();o.diffs=[];for(w=0;w<z.diffs.length;w++){o.diffs[w]=z.diffs[w].slice();}o.start1=z.start1;o.start2=z.start2;o.length1=z.length1;o.length2=z.length2;u[q]=o;}return u;};this.patch_apply=function(z,E){if(z.length==0){return[E,[]];}z=a(z);var N=this.patch_addPadding(z);E=N+E+N;this.patch_splitMax(z);var K=0,G=[],C=0,J=z.length,q,t,D,F,s,B,o,w,u,A,M,I;for(;C<J;C++){q=z[C];t=q.start2+K;D=this.diff_text1(q.diffs);s=-1;if(D.length>this.matchMaxBits){F=this.match_main(E,D.substring(0,this.matchMaxBits),t);if(F!=-1){s=this.match_main(E,D.substring(D.length-this.matchMaxBits),t+D.length-this.matchMaxBits);if(s==-1||F>=s){F=-1;}}}else{F=this.match_main(E,D,t);}if(F==-1){G[C]=false;K-=q.length2-q.length1;}else{G[C]=true;K=F-t;if(s==-1){B=E.substring(F,F+D.length);}else{B=E.substring(F,s+this.matchMaxBits);}if(D==B){E=E.substring(0,F)+this.diff_text2(q.diffs)+E.substring(F+D.length);}else{o=this.diff_main(D,B,false);if(D.length>this.matchMaxBits&&this.diff_levenshtein(o)/D.length>this.patchDeleteThreshold){G[C]=false;}else{this.diff_cleanupSemanticLossless(o);w=0;for(A=0,I=q.diffs.length;A<I;A++){M=q.diffs[A];if(M[0]!==c){u=this.diff_xIndex(o,w);}if(M[0]===d){E=E.substring(0,F+u)+M[1]+E.substring(F+u);}else{if(M[0]===l){E=E.substring(0,F+u)+E.substring(F+this.diff_xIndex(o,w+M[1].length));}}if(M[0]!==l){w+=M[1].length;}}}}}}E=E.substring(N.length,E.length-N.length);return[E,G];};this.patch_addPadding=function(u){var t=this.patchMargin,s="",o=1,q=u.length;for(;o<=t;o++){s+=String.fromCharCode(o);}for(o=0;o<q;o++){u[o].start1+=t;u[o].start2+=t;}var A=u[0],z=A.diffs,w;if(z.length==0||z[0][0]!=c){z.unshift([c,s]);A.start1-=t;A.start2-=t;A.length1+=t;A.length2+=t;}else{if(t>z[0][1].length){w=t-z[0][1].length;z[0][1]=s.substring(z[0][1].length)+z[0][1];A.start1-=w;A.start2-=w;A.length1+=w;A.length2+=w;}}A=u[u.length-1];z=A.diffs;if(z.length==0||z[z.length-1][0]!=c){z.push([c,s]);A.length1+=t;A.length2+=t;}else{if(t>z[z.length-1][1].length){w=t-z[z.length-1][1].length;z[z.length-1][1]+=s.substring(0,w);A.length1+=w;A.length2+=w;}}return s;};this.patch_splitMax=function(o){var E=0,w,B,s,q,z,u,C,A,D,t;for(;E<o.length;E++){if(o[E].length1<=this.matchMaxBits){continue;}w=o[E];o.splice(E--,1);B=this.matchMaxBits;s=w.start1;q=w.start2;z="";while(w.diffs.length!==0){u=new i();C=true;u.start1=s-z.length;u.start2=q-z.length;if(z!==""){u.length1=u.length2=z.length;u.diffs.push([c,z]);}while(w.diffs.length!==0&&u.length1<B-this.patchMargin){A=w.diffs[0][0];D=w.diffs[0][1];if(A===d){u.length2+=D.length;q+=D.length;u.diffs.push(w.diffs.shift());C=false;}else{if(A===l&&u.diffs.length==1&&u.diffs[0][0]==c&&D.length>2*B){u.length1+=D.length;s+=D.length;C=false;u.diffs.push([A,D]);w.diffs.shift();}else{D=D.substring(0,B-u.length1-this.patchMargin);u.length1+=D.length;s+=D.length;if(A===c){u.length2+=D.length;q+=D.length;}else{C=false;}u.diffs.push([A,D]);if(D==w.diffs[0][1]){w.diffs.shift();}else{w.diffs[0][1]=w.diffs[0][1].substring(D.length);}}}}z=this.diff_text2(u.diffs).substring(z.length-this.patchMargin);t=this.diff_text1(w.diffs).substring(0,this.patchMargin);if(t!==""){u.length1+=t.length;u.length2+=t.length;if(u.diffs.length!==0&&u.diffs[u.diffs.length-1][0]===c){u.diffs[u.diffs.length-1][1]+=t;}else{u.diffs.push([c,t]);}}if(!C){o.splice(++E,0,u);}}}};this.patch_toText=function(s){var t=[],o=0,q=s.length;for(;o<q;o++){t[o]=s[o];}return t.join("");};this.patch_fromText=function(z){var o=[];if(!z){return o;}z=z.replace(/%00/g,"\0");var A=z.split("\n"),D=0,u=A.length,B=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/,t,s,q,C;while(D<u){t=A[D].match(B);if(!t){throw new Error("Invalid patch string: "+A[D]);}s=new i();o.push(s);s.start1=parseInt(t[1],10);if(t[2]===""){s.start1--;s.length1=1;}else{if(t[2]=="0"){s.length1=0;}else{s.start1--;s.length1=parseInt(t[2],10);}}s.start2=parseInt(t[3],10);if(t[4]===""){s.start2--;s.length2=1;}else{if(t[4]=="0"){s.length2=0;}else{s.start2--;s.length2=parseInt(t[4],10);}}D++;while(D<u){q=A[D].charAt(0);try{C=decodeURI(A[D].substring(1));}catch(w){throw new Error("Illegal escape in patch_fromText: "+C);}if(q=="-"){s.diffs.push([l,C]);}else{if(q=="+"){s.diffs.push([d,C]);}else{if(q==" "){s.diffs.push([c,C]);}else{if(q=="@"){break;}else{if(q===""){}else{throw new Error("Invalid patch mode '"+q+"' in: "+C);}}}}}D++;}}return o;};})();apf.popup={cache:{},focusFix:{INPUT:1,TEXTAREA:1,SELECT:1},setContent:function(j,i,d,c,a){if(!this.popup){this.init();}this.cache[j]={content:i,style:d,width:c,height:a};i.style.position="absolute";i.onmousedown=function(l){if(!l){l=event;}if(apf.hasFocusBug&&!apf.popup.focusFix[(l.srcElement||l.target).tagName]){apf.window.$focusfix();}(l||event).cancelBubble=true;};return i.ownerDocument;},removeContent:function(a){this.cache[a]=null;delete this.cache[a];},init:function(){this.popup={};apf.addEventListener("hotkey",function(a){if(a.keyCode=="27"||a.altKey){apf.popup.forceHide();}});},show:function(t,u){u=apf.extend({x:0,y:0,animate:false,ref:null,width:null,height:null,callback:null,draggable:false,resizable:false,allowTogether:false,autoCorrect:true},u);if(!this.popup){this.init();}if((!u.allowTogether||u.allowTogether!=this.last)&&this.last!=t){this.hide();}var d=this.cache[t];d.options=u;var a=d.content,l=false;if(!d.content.style.zIndex){d.content.style.zIndex=10000000;}if(d.content.style.display&&d.content.style.display.indexOf("none")>-1){d.content.style.display="";}if(u.ref){var n=apf.getAbsolutePosition(u.ref,d.content.offsetParent||d.content.parentNode),q=(u.y||0)+n[1],c=apf.getOverflowParent(d.content);if(u.width||d.width){a.style.width=((u.width||d.width)-3)+"px";}l=u.autoCorrect&&(q+(u.height||d.height||d.content.offsetHeight))>(c==document.documentElement?(apf.isIE?c.offsetHeight:(window.innerHeight+window.pageYOffset))+c.scrollTop:c.offsetHeight+c.scrollTop);a.style.top=(l?(q-(u.height||d.height||d.content.offsetHeight)):q)+"px";a.style.left=((u.x||0)+n[0])+"px";}apf.setStyleClass(a,l?"upward":"downward",[l?"downward":"upward"]);if(u.animate){if(u.animate=="fade"){apf.tween.single(a,{type:"fade",from:0,to:1,anim:apf.tween.NORMAL,steps:apf.isIE?5:10});}else{var s,m=apf.isIE8?5:7,j=0;s=setInterval(function(){var i=++j*((u.height||d.height)/m);a.style.height=i+"px";if(l){a.style.top=(q-i-u.y)+"px";}else{a.scrollTop=-1*(j-m)*((u.height||d.height)/m);}a.style.display="block";if(j>=m){clearInterval(s);if(u.callback){u.callback(a);}}},10);}}else{if(u.height||d.height){a.style.height=(u.height||d.height)+"px";}a.style.top=(q)+"px";a.style.display="block";if(u.callback){u.callback(a);}}$setTimeout(function(){apf.popup.last=t;});if(u.draggable){u.id=t;this.makeDraggable(u);}},hide:function(){if(this.isDragging){return;}var a=this.cache[this.last];if(a){if(a.content){a.content.style.display="none";}if(a.options&&a.options.onclose){a.options.onclose(apf.extend(a.options,{htmlNode:a.content}));a.options.onclose=false;}}},isShowing:function(a){return this.last&&this.last==a&&this.cache[this.last]&&this.cache[this.last].content.style.display!="none";},isDragging:false,makeDraggable:function(a){if(!apf.Interactive||this.cache[a.id].draggable){return;}var c=this.cache[a.id].content;this.cache[a.id].draggable=true;var d={$propHandlers:{},minwidth:10,minheight:10,maxwidth:10000,maxheight:10000,dragOutline:false,resizeOutline:false,draggable:true,resizable:a.resizable,$ext:c,oDrag:c.firstChild};c.onmousedown=c.firstChild.onmousedown=function(i){if(!i){i=event;}if(apf.hasFocusBug&&!apf.popup.focusFix[(i.srcElement||i.target).tagName]){apf.window.$focusfix();}(i||event).cancelBubble=true;};apf.implement.call(d,apf.Interactive);d.$propHandlers.draggable.call(d,true);d.$propHandlers.resizable.call(d,true);},forceHide:function(){if(this.last&&!apf.plane.current&&this.isShowing(this.last)){var a=apf.lookup(this.last);if(!a){this.last=null;}else{if(a.dispatchEvent("popuphide")!==false){this.hide();}}}},destroy:function(){for(var a in this.cache){if(this.cache[a]){this.cache[a].content.onmousedown=null;apf.destroyHtmlNode(this.cache[a].content);this.cache[a].content=null;this.cache[a]=null;}}if(!this.popup){return;}}};apf.nameserver={lookup:{},add:function(a,c){if(!this.lookup[a]){this.lookup[a]=[];}return this.lookup[a].push(c)-1;},register:function(a,d,c){if(!this.lookup[a]){this.lookup[a]={};}return(this.lookup[a][d]=c);},remove:function(a,c){var d=this.lookup[a];if(d){for(var i in d){if(d[i]==c){delete d[i];}}}},get:function(a,c){return this.lookup[a]?this.lookup[a][c]:null;},getAll:function(m){var d,a=[],c=this.lookup[m];if(!c){return a;}if(c.dataType==apf.ARRAY){for(var j=0;j<c.length;j++){a.push(c[j]);}}else{for(d in c){if(apf.isSafariOld&&(!c[d]||typeof c[d]!="object")){continue;}a.push(c[d]);}}return a;},getAllNames:function(d){var c,a=[];for(c in this.lookup[d]){if(parseInt(c)==c){continue;}a.push(c);}return a;}};apf.registry=apf.extend({put:function(a,d,c){this.register(c,a,d);},getNamespaces:function(){},getKeys:function(a){return this.getAllNames(a);},remove:function(a,c){delete this.lookup[c][a];},clear:function(a){this.lookup={};},$export:function(d){var c,a;for(c in this.lookup){for(a in this.lookup[c]){d.put(a,this.lookup[a][c],c);}}}},apf.nameserver);apf.registry.lookup={};apf.registry.get=function(a,c){return this.lookup[c]?this.lookup[c][a]:null;};apf.Init.run("nameserver");apf.history={inited:false,page:null,past:[],future:[],init:function(i,a,d){if(this.inited){return;}if(d){this.delay=d;}var c=location.href.match(/#(.*)$/)&&decodeURI(RegExp.$1)||apf._GET[a||-1]||i;this.inited=true;location.hash=c;this.hasChanged(c||null);if(apf.supportHashChange){window.onhashchange=function(){var l=location.hash.replace("#","");apf.history.hasChanged(decodeURI(l));};}else{if(apf.isIE){var j="<style>                    BODY, HTML{margin : 0;}                    h1{height : 100px;margin : 0;padding : 0;}                </style>                <body>                    <h1 id='"+c+"'>0</h1>                </body>                <script>                    var lastURL = -1;                    if(document.all){                        document.body.onscroll = checkUrl;                    }else{                        setInterval('checkUrl()', 200);                    }                    function checkUrl(){                        if (top.apf.isIE7Emulate && top.apf.history.lastHtml)                            document.body.innerHTML = top.apf.history.lastHtml;                        var nr=Math.round((document.all ? document.body : document.documentElement).scrollTop/100);                        if (top.apf.isIE7Emulate) {                            clearTimeout(top.apf.history.ie7timer);                            top.apf.history.ie7timer = setTimeout(function(){                                top.apf.history.hasChanged(document.getElementsByTagName('h1')[nr].id);                            }, 100);                        }                        else {                            top.apf.history.hasChanged(document.getElementsByTagName('h1')[nr].id);                        }                        lastURL = document.body.scrollTop;                    }                    checkUrl();                <\/script>";if(top==self){document.body.insertAdjacentHTML("beforeend","<iframe name='nav' style2='position:absolute;left:10px;top:10px;height:100px;width:100px;z-index:1000'                       style='width:1px;height:1px;' src='about:blank'></iframe>");document.frames.nav.document.open();document.frames.nav.document.write(j);document.frames.nav.document.close();}this.iframe=document.frames.nav;this.timer2=setInterval(function(){if(!apf.history.changingHash&&location.hash!="#"+apf.history.page){var l=location.hash.replace(/^#/,"");var m=apf.history.page;apf.history.setHash(l,true,true);apf.history.page=m;apf.history.hasChanged(l);}},apf.history.delay||1);}else{apf.history.lastUrl=location.href.toString();this.timer2=setInterval(function(){if(apf.history.lastUrl==location.href.toString()){return;}apf.history.lastUrl=location.href.toString();var l=location.hash.replace("#","");apf.history.hasChanged(decodeURI(l));},20);}}},to_name:null,setHash:function(c,a,i){if(this.changing||this.page==c||!i&&location.hash=="#"+c){this.to_name=c;return;}if(apf.isIE&&!apf.isIE8&&!a){this.to_name=c;return $setTimeout(function(){apf.history.setHash(apf.history.to_name,true);},200);}this.changePage(c);if(!this.inited){return this.init(c);}if(apf.isIE&&!apf.isIE8){var d=this.iframe.document.body.appendChild(this.iframe.document.createElement("h1"));d.id=c;d.innerHTML=this.length;this.lastHtml=this.iframe.document.body.innerHTML;}(apf.isIE&&!apf.isIE8?this.iframe:window).location.href="#"+c;if(!apf.isIE&&!apf.isIphone){apf.history.lastUrl=location.href.toString();}else{if(apf.isIE8){this.page=c;}}},timer:null,changePage:function(a){if(apf.isIE&&!apf.isIE8){this.page=a;this.changingHash=true;clearTimeout(this.timer);this.timer=$setTimeout(function(){location.hash=a;apf.history.changingHash=false;},1);}},update:function(j){var d,c,a=0;for(d=0,c=this.past.length;d<c&&a===0;d++){if(this.past[d]==j){a=d+1;}}if(a>0){this.future=this.past.slice(a,this.past.length-1).concat(this.future).makeUnique();this.past.splice(a,this.past.length-(a));a=-a;}else{for(d=0,c=this.future.length;d<c&&a===0;d++){if(this.future[d]==j){a=d+1;this.past=this.past.concat(this.future.splice(0,this.future.length-a)).makeUnique();}}if(a===0){this.past.push(j);a=1;}}return a;},hasChanged:function(a){if(a==this.page){return;}this.changePage(a);this.changing=true;apf.dispatchEvent("hashchange",{page:a,index:this.update(a)});this.changing=false;}};apf.config=new apf.Class().$init();apf.extend(apf.config,{disableRightClick:false,allowSelect:false,allowBlur:true,autoDisableActions:true,autoDisable:false,disableF5:true,autoHideLoading:true,disableSpace:true,defaultPage:"home",disableBackspace:true,undokeys:false,outline:false,dragOutline:false,resizeOutline:false,autoDisableNavKeys:true,disableTabbing:false,resourcePath:null,initdelay:true,liveText:false,iePngFix:false,iphoneFullscreen:true,iphoneStatusbar:"default",iphoneIcon:null,iphoneIconIsGlossy:false,iphoneFixedViewport:true,skinset:"default",name:self.window&&window.location.href.replace(/[^0-9A-Za-z_]/g,"_"),tags:{},defaults:{},baseurl:"",model:"@default","empty-message":"No items","loading-message":"Loading...","offline-message":"You are currently offline.",setDefaults:function(){if(apf.isParsingPartial){this.disableRightClick=false;this.allowSelect=true;this.autoDisableActions=true;this.autoDisable=false;this.disableF5=false;this.autoHideLoading=true;this.disableSpace=false;this.disableBackspace=false;this.undokeys=false;this.disableTabbing=true;this.allowBlur=true;}},getDefault:function(c,l){var j=this.defaults[c];if(!j){return;}for(var a=j.length-1;a>=0;a--){if(j[a][0]==l){return j[a][1];}}},setProperty:function(a,c){this[a.replace(/-(\w)/g,function(d,i){return i.toUpperCase();})]=this[a]=c;(this.$propHandlers&&this.$propHandlers[a]||apf.GuiElement.propHandlers[a]||apf.K).call(this,c);},$inheritProperties:{},$propHandlers:{baseurl:function(a){this.baseurl=apf.parseExpression(a);},language:function(a){apf.queue.add("language",function(){apf.setModel(apf.config.language,apf.language);});},layout:function(a){apf.queue.add("layout",function(){apf.setModel(apf.config.layout,apf.layout);});},"resource-path":function(a){this.resourcePath=apf.parseExpression(a||"").replace(/resources\/?|\/$/g,"");},iepngfix:function(c,a){this.iePngFix=(!apf.supportPng24&&(apf.isTrue(c)||a.getAttribute("iepngfix-elements")));if(this.iePngFix){$setTimeout(function(){apf.iepngfix.limitTo(a.getAttribute("iepngfix-elements")||"").run();});}},skinset:function(a){if(this.$amlLoaded){apf.skins.changeSkinset(a);}},outline:function(a){this.dragOutline=this.resizeOutline=this.outline=apf.isTrue(a);},"drag-outline":function(a){this.dragOutline=a?apf.isTrue(a):false;},"resize-outline":function(a){this.resizeOutline=a?!apf.isFalse(a):false;},login:function(c,a){apf.auth.init(a);},storage:function(a){if(a){apf.storage.init(a);}},offline:function(a){if(a&&typeof apf.offline!="undefined"){apf.offline.init(a);}},"disable-f5":function(a){if(apf.isDeskrun&&a){shell.norefresh=true;}},debug:function(a){apf.debug=a;}}});if(apf.history){apf.addEventListener("load",function(){apf.history.init(apf.config.defaultPage,"page");});}apf.offline={enabled:false,onLine:-1,resources:["application","models","transactions","queue","state"],autoInstall:false,storage:null,inited:false,rsbTimeout:600000,init:function(l){apf.makeClass(this);if(l){this.$aml=l;if(typeof l=="string"){}else{if(l.nodeType){if(l.getAttribute("resources")){this.providers=l.getAttribute("resources").split("|");}if(l.getAttribute("rsb-timeout")){this.rsbTimeout=parseInt(l.getAttribute("rsb-timeout"));}var d,j,c=l.attributes;for(j=0;j<c.length;j++){d=c[j];if(d.nodeName.indexOf("on")==0){this.addEventListener(d.nodeName,apf.lm.compile(d.nodeValue,{event:true,parsecode:true}));}}}else{apf.extend(this,l);}}}var m=apf.offline.application.init(l);if(m){this.storage=apf.storage.getProvider(m);}if(!this.storage){this.storage=apf.storage.initialized?apf.storage:apf.storage.init();}if(!this.storage){return;}if(!this.storage.isPermanent()){apf.addEventListener("exit",function(){return apf.offline.dispatchEvent("losechanges");});}if(this.storage.asyncInit){apf.document.$domParser.$shouldWait++;this.storage.ready(function(){apf.offline.storage.onready=null;apf.offline.continueInit();apf.document.$domParser.$continueParsing(apf.document.documentElement);});return;}this.continueInit();},continueInit:function(){for(var a=this.resources.length-1;a>=0;a--){if(!this[this.resources[a]]){this.resources.removeIndex(a);}else{this[this.resources[a]].init(this.$aml);}}this.enabled=true;this.detector.init(this.$aml);this.offlineTime=parseInt(this.storage.get("offlinetime",this.namespace));if(this.offlineTime){this.goOffline();}else{this.goOnline();}apf.offline.dispatchEvent("load");},$destroy:function(){if(this.provider&&this.provider.destroy){this.provider.destroy();}if(this.storage&&this.storage.destroy){this.storage.destroy();}for(var a=this.resources.length-1;a>=0;a--){if(this[this.resources[a]]&&this[this.resources[a]].destroy){this[this.resources[a]].destroy();}}},IDLE:0,TO_OFFLINE:1,TO_ONLINE:2,STOPPING:3,inProcess:0,$supportedProperties:["syncing","position","length","progress","onLine"],handlePropSet:function(d,c,a){this[d]=c;},goOffline:function(){if(!this.enabled||this.onLine===false||this.inProcess==this.TO_OFFLINE){return false;}if(this.inProcess){this.inProcess=this.STOPPING;return false;}if(this.dispatchEvent("beforeoffline")===false){return false;}this.setProperty("onLine",false);this.inProcess=this.TO_OFFLINE;if(!this.offlineTime){this.offlineTime=new Date().getTime();this.storage.put("offlinetime",this.offlineTime,this.namespace);}if(this.detector.enabled&&this.detector.detection!="manual"){this.detector.start();}if(!this.initial){this.initial={disableRSB:apf.xmldb.disableRSB};}apf.xmldb.disableRSB=true;this.inProcess=this.IDLE;this.dispatchEvent("afteroffline");return true;},goOnline:function(){if(!this.enabled||this.onLine===true||this.inProcess==this.TO_ONLINE){return false;}if(this.dispatchEvent("beforeonline")===false){return false;}this.setProperty("onLine",true);this.inProcess=this.TO_ONLINE;this.onlineTime=new Date().getTime();this.reloading=false;if(this.detector.enabled&&this.detector.detection=="error"){this.detector.stop();}this.$checkRsbTimeout();if(this.initial){apf.xmldb.disableRSB=this.initial.disableRSB;}var c=function(){this.startSync();this.dispatchEvent("afteronline");};var a=apf.document.getElementsByTagNameNS(apf.ns.apf,"auth")[0];if(!a){return;}if(a.needsLogin&&a.loggedIn){a.authRequired({object:this,retry:c});}else{c.call(this);}return true;},$checkRsbTimeout:function(){if(!this.rsbTimeout){return;}var l,c,d=apf.nameserver.getAll("remote");for(l=0;l<d.length;l++){var m=d[l];if(this.reloading||this.onlineTime-this.offlineTime>this.rsbTimeout){if(!this.reloading){if(this.dispatchEvent("beforereload")===false){break;}this.reloading=true;}m.discardBefore=this.onlineTime;for(c=0;k<m.models.length;c++){m.models[c].clear();apf.offline.models.addToInitQueue(m.models[c]);}}}if(this.reloading){apf.offline.transactions.clear("undo|redo");var a=apf.nameserver.getAll("actiontracker");for(var l=0;l<a.length;l++){a[l].reset();}}},$goOnlineDone:function(a){this.inProcess=this.IDLE;this.setProperty("syncing",false);if(a){this.offlineTime=null;this.initial=null;this.storage.remove("offlinetime",this.namespace);}else{this.goOffline();}},clear:function(){if(!this.enabled){return false;}for(var a=this.resources.length-1;a>=0;a--){if(this[this.resources[a]].clear){this[this.resources[a]].clear();}}},startSync:function(){if(this.syncing){return;}this.setProperty("syncing",true);var c=[],l=0,q=0,o=null,j,d;for(d=this.resources.length-1;d>=0;d--){if(this[this.resources[d]].sync){j=this[this.resources[d]].getSyncLength();if(j){c.push(this[this.resources[d]]);l+=j;}}}var m=apf.offline;var n=function(i){if(m.inProcess==m.STOPPING){if(!i.finished&&i.length-1!=i.position){o.stopSync(function(){m.$goOnlineDone(false);});}else{m.$goOnlineDone(false);}return;}if(i.finished){if(c.length){o=c.pop();o.sync(n);}else{m.$goOnlineDone(true);}return;}if(!i.start){q++;}m.setProperty("progress",parseInt(q/l*100));m.setProperty("position",q);m.setProperty("length",l);m.dispatchEvent("sync",apf.extend(i,{position:q,length:l}));};if(l){n({start:true});n({finished:true});}else{this.$goOnlineDone(true);}var a=apf.all;for(d=0;d<a.length;d++){if(a[d].$loadedWhenOffline){a[d].reload();}}},stopSync:function(){if(this.syncing){this.inProcess=this.STOPPING;}}};apf.offline.application={enabled:false,urls:[],providers:["deskrun","gears"],init:function(c){if(this.enabled){return;}this.namespace=apf.config.name+".apf.offline.application";if(typeof c=="string"){this.providers=c.split("|");}else{if(c.nodeType){if(c.getAttribute("version-get")){this.application.versionGet=c.getAttribute("version-get");}if(c.getAttribute("providers")){this.providers=c.getAttribute("providers").split("|");}if(c.getAttribute("auto-install")){this.autoInstall=apf.isTrue(c.getAttribute("auto-install"));}}}for(var a=0;a<this.providers.length;a++){if(!this[this.providers[a]]){continue;}if(this[this.providers[a]].isAvailable()){this.provider=this[this.providers[a]].init(this.storeName);if(this.provider!==false){this.provider.name=this.providers[a];break;}}}if(!this.provider){if(this.autoInstall){if(this.install()===false){apf.offline.application=null;return this.providers[0];}}else{apf.offline.application=null;return this.providers[0];}}if(!apf.loaded){apf.addEventListener("load",function(){if(apf.offline.application.enabled){apf.offline.application.save();}apf.removeEventListener("load",arguments.callee);});}else{apf.offline.addEventListener("load",function(){apf.offline.application.save();});}this.enabled=true;return this.provider.name;},install:function(){if(apf.offline.dispatchEvent("beforeinstall")===false){return false;}for(var a=0;a<this.providers.length;a++){if(!this[this.providers[a]]){continue;}if(this[this.providers[a]].install()){this.provider=this[this.providers[a]].init(this.storeName);if(this.provider!==false){break;}}}apf.offline.dispatchEvent("afterinstall");if(!this.provider){return false;}},clear:function(){if(this.provider){this.provider.clear();}},cache:function(a){if(a.indexOf(":")>-1&&a.indexOf("http://"+location.host)==-1){return;}this.urls.pushUnique(a.replace(/\#.*$/,""));},remove:function(a){this.urls.remove(a);},refresh:function(j){var i=apf.offline.storage;if(this.versionGet){var c=i.get("oldVersion",this.namespace);var d=null;var a=this;apf.getData(this.versionGet,{callback:function(n,m,l){if(m==apf.TIMEOUT){return l.tpModule.retryTimeout(l,m,apf.offline);}if(m==apf.OFFLINE){return;}if(m==apf.ERROR){i.remove("oldVersion",a.namespace);}if(apf.debug||!n||!c||c!=n){if(apf.offline.state.enabled){apf.offline.state.clear();if(apf.offline.state.realtime){apf.offline.state.search();}}a.search();a.provider.store(a.urls,j,n);}else{j({finished:true});}}});}else{this.search();this.provider.store(this.urls,j);}},search:function(){this.cache(window.location.href);var m,c=document.getElementsByTagName("script");for(m=0;m<c.length;m++){this.cache(c[m].getAttribute("src"));}c=document.getElementsByTagName("link");for(m=0;m<c.length;m++){if((c[m].getAttribute("rel")||"").toLowerCase()=="stylesheet"){continue;}this.cache(c[m].getAttribute("href"));}c=document.getElementsByTagName("img");for(m=0;m<c.length;m++){this.cache(c[m].getAttribute("src"));}c=document.getElementsByTagName("a");for(m=0;m<c.length;m++){this.cache(c[m].getAttribute("href"));}var a=this,d,o,l,n=document.styleSheets;for(m=0;m<n.length;m++){l=n[m];if(apf.isIE){if(l.readOnly){l.cssText.replace(/url\(\s*([^\) ]*)\s*\)/gi,function(i,j){a.cache(j);return"";});}}else{if(l.ownerNode.tagName=="STYLE"){continue;}for(d=0;d<l.cssRules.length;d++){o=l.cssRules[d].cssText;if(!o){continue;}o.replace(/url\(\s*([^\) ]*)\s*\)/gi,function(i,j){a.cache(j);return"";});}}}apf.skins.loadedCss.replace(/url\(\s*([^\) ]*)\s*\)/gi,function(i,j){a.cache(j);return"";});},save:function(c){if(!apf.offline.onLine){var a=function(){apf.offline.application.save();apf.offline.removeEventListener("afteronline",a);};apf.offline.addEventListener("afteronline",a);return;}this.refresh(c);}};apf.offline.application.gears={localServer:null,lastStore:null,cancelID:null,refreshing:false,fileIndex:0,init:function(){this.name=this.storeName.truncate(64);this.storeName=apf.config.name+".apf.offline";try{this.localServer=apf.nameserver.get("google","gears").create("beta.localserver","1.0");}catch(a){apf.console.warn("Error loading gears: "+a.message);return false;}return this;},install:function(){apf.isGears=true;},isAvailable:function(){return apf.isGears&&location.protocol!="file:";},clear:function(){this.localServer.removeStore(this.name);},store:function(d,l,i){this.localServer.removeStore(this.name);this.localServer.openStore(this.name);try{var c=this.lastStore=this.localServer.createStore(this.name);}catch(j){return false;}var a=this;this.refreshing=true;this.fileIndex=0;this.cancelID=c.capture(d,function(n,o,m){if(!o&&a.refreshing){a.cancelID=null;a.refreshing=false;if(l){l({error:true,message:"Unable to capture "+n});}return;}else{if(o){a.fileIndex++;if(l){l({position:a.fileIndex,length:listOfURLS.length});}}}if(o&&a.fileIndex>=d.length){a.cancelID=null;a.refreshing=false;if(i){apf.storage.put("oldVersion",i,null,apf.offline.application.storeName);}if(l){l({finished:true});}}});},abort:function(){if(!this.refreshing){return;}this.lastStore.abortCapture(this.cancelID);this.refreshing=false;}};apf.offline.transactions={enabled:false,init:function(){this.namespace=apf.config.name+".apf.offline.transactions";this.enabled=true;apf.addEventListener("load",function(){apf.offline.transactions.rebuildActionQueues();apf.removeEventListener("load",arguments.callee);});},actionNotAllowed:function(){apf.offline.dispatchEvent("transactioncancel",{message:"Transaction is not allowed",bubbles:true});return;},addAction:function(c,l,i){var d=this.namespace+"."+c.name+"."+i;var j=apf.offline.storage;var a=parseInt(j.get("length",d))||0;j.put(a,apf.serialize(i=="queue"?{undo:l.undo,undoObj:l.undoObj.$export()}:l.$export()),d);j.put("length",++a,d);},removeAction:function(c,d,j){var i=this.namespace+"."+c.name+"."+j;var m=apf.offline.storage;if(d){var a=parseInt(m.get("length",i))-1;var l=parseInt(m.get("start",i))||0;if(l==a||a<0){m.clear(i);return;}m.remove(a,i);m.put("length",a,i);}else{var l=parseInt(m.get("start",i))||0;var a=parseInt(m.get("length",i))||0;if(l+1==a){m.clear(i);return;}m.remove(l,i);m.put("start",++l,i);}},rebuildActionQueues:function(){var t=apf.offline.storage;var c=t.getNamespaces();if(!c){return;}var l,A=new RegExp(this.namespace+"\\.([^\\.]*)\\.([^\\.]*)");for(var z=[],o=0;o<c.length;o++){if(c[o].match(A)){z.push([RegExp.$1,RegExp.$2]);}}var o,n,q,w,m,d,a,s,u;for(o=0;o<z.length;o++){d=apf.nameserver.get("actiontracker",z[o][0]);u=z[o][1];l={};m=this.namespace+"."+d.name+"."+u;t.getAllPairs(m,l);a=parseInt(l.start)||0;s=parseInt(l.length)||0;w=[];if(u=="queue"){for(n=s-1;n>=a;n--){q=apf.unserialize(l[n]);q.undoObj=new apf.UndoData(q.undoObj,d).$import();w.unshift(q);}}else{for(n=s-1;n>=a;n--){q=apf.unserialize(l[n]);w.unshift(new apf.UndoData(q,d).$import());}}d.$loadQueue(w,u);apf.offline.sLookup=null;}},clearActions:function(a,c){apf.offline.storage.clear(this.namespace+"."+a.name+"."+c);},clear:function(d){if(!d){d="undo|redo|queue";}var l=apf.offline.storage;var j=l.getNamespaces();var c=new RegExp(this.namespace+"\\.([^\\.]*)\\.("+d+")");for(var a=0;a<j.length;a++){if(j[a].match(c)){l.clear(j[a]);}}},stopSync:function(a){a();},getSyncLength:function(){var c=apf.nameserver.getAll("actiontracker");var a=0;for(var d=0;d<c.length;d++){a+=c[d].$getQueueLength();}return a;},sync:function(l){var c=apf.nameserver.getAll("actiontracker");var j=0,a=0;for(var d=0;d<c.length;d++){if(c[d].$getQueueLength()){a+=c[d].$getQueueLength();c[d].$startQueue(function(i){if(j>=a-1){return false;}if(i){j=a;}l({position:++j,length:a});if(j>=a-1){l({finished:true});}});}}}};apf.offline.canTransact=function(){if(!apf.offline.enabled||this.onLine||this.transactions.enabled){return true;}if(this.dispatchEvent("transactioncancel",{message:"Could not execute transaction whilst being offline,                   silently doing nothing",bubbles:true})===true){return true;}return false;};apf.offline.detector={detectUrl:apf.basePath+"core/lib/offline/network_check.txt",detection:"auto",interval:5000,init:function(a){if(a.nodeType){if(a.getAttribute("detect-url")){this.detectUrl=a.getAttribute("detect-url");}else{this.detectUrl=(apf.config.resourcePath||apf.basePath)+"resources/network_check.txt";}this.detection=apf.isTrue(a.getAttribute("detection"))?"auto":a.getAttribute("detection")||"auto";if(a.getAttribute("interval")){this.interval=parseInt(a.getAttribute("interval"));}}if("error|auto".indexOf(this.detection)>-1){apf.addEventListener("error",function(c){if(c.state==apf.TIMEOUT){return !apf.offline.goOffline();}});}this.oHttp=new apf.http();this.oHttp.timeout=this.interval;this.isSiteAvailable();if(this.detection=="auto"){this.start();}},isSiteAvailable:function(a){this.oHttp.get(apf.getNoCacheUrl(this.detectUrl),{callback:function(i,d,c){if(d!=apf.SUCCESS||!window.navigator.onLine){apf.offline.goOffline(a);}else{apf.offline.goOnline(a);}},ignoreOffline:true,hideLogMessage:true});},start:function(){clearInterval(this.timer);var a=this;this.timer=setInterval(function(){a.isSiteAvailable();},this.interval);},stop:function(){clearInterval(this.timer);}};apf.offline.models={enabled:false,timer:null,models:{},initQueue:[],realtime:true,init:function(a){this.namespace=apf.config.name+".apf.offline.models";if(a.nodeType&&a.getAttribute("realtime")){this.realtime=!apf.isFalse(a.getAttribute("realtime"));}if(!this.realtime){apf.addEventListener("exit",function(){apf.offline.models.search();});}this.enabled=true;},markForUpdate:function(c){this.models[c.$uniqueId]=c;if(!this.timer){var a=this;this.timer=$setTimeout(function(){a.timer=null;var i=a.models;for(var d in i){a.updateModel(i[d]);}a.models={};},2000);}},clear:function(){apf.offline.storage.clear(this.namespace);},removeModel:function(c){var a=c.name||c.$uniqueId+".model";apf.offline.storage.remove(a,this.namespace);this.initQueue.remove(c);},updateModel:function(c){var a=c.name||c.$uniqueId+".model";var d=c.data.getAttribute(apf.xmldb.xmlDocTag);c.data.setAttribute(apf.xmldb.xmlDocTag+"_length",apf.xmldb.nodeCount[d]);apf.offline.storage.put(a,c.data.xml||c.data.serialize(),this.namespace);},loadModel:function(c){var a=c.name||c.$uniqueId+".model";var j=apf.offline.storage.get(a,this.namespace);if(!j){return false;}var i=apf.getXmlDom(j).documentElement;var d=i.getAttribute(apf.xmldb.xmlDocTag);apf.xmldb.nodeCount[d]=parseInt(i.getAttribute(apf.xmldb.xmlDocTag+"_length"));c.load(i);return true;},search:function(){var a={},d=apf.nameserver.getAll("model");for(var c=0;c<d.length;c++){if(a[d[c].$uniqueId]){continue;}a[d[c].$uniqueId]=true;this.updateModel(d[c]);}return true;},addToInitQueue:function(a){this.initQueue.pushUnique(a);a.session=false;},stopSync:function(a){a();},getSyncLength:function(){return this.initQueue.length;},sync:function(l){var c=this.initQueue.slice();this.initQueue.length=0;var j=0,a=c.length;for(var d=0;d<c.length;d++){c[d].init(function(){l({position:++j,length:a});if(j==a-1){l({finished:true});}});}}};apf.offline.queue={enabled:false,stack:[],init:function(){this.namespace=apf.config.name+".apf.offline.queue";this.enabled=true;},add:function(c){var d=this.namespace;var j=apf.offline.storage;var a=parseInt(j.get("length",d))||0;this.stack[a]=c;j.put(a,apf.serialize(c),d);j.put("length",++a,d);var i=c.callback;if(!c.undoObj&&i){i(null,apf.OFFLINE,apf.extend({offline:true},c));}},stopSync:function(a){this.stop=a;},getSyncLength:function(){return parseInt(apf.offline.storage.get("length",this.namespace))||0;},sync:function(m,d){if(this.stop){this.stop();this.stop=null;return;}var i=this.namespace;var l=apf.offline.storage;var a=parseInt(l.get("length",i))||0;var j=parseInt(l.get("start",i))||0;var c;if(this.stack[j]){c=this.stack[j];}else{c=this.$getCommInfo(l.get(j,i));if(!c){this.clear();apf.offline.stopSync();return m({finished:true});}this.stack[j]=c;}if(!c.callback2){c.callback2=c.callback;c.callback=function(q,o,n){if(c.callback2&&c.callback2.apply(window,arguments)===true){return true;}l.remove(j,i);l.put("start",j+1,i);apf.offline.queue.stack[j]=null;m({position:j,length:a,info:c});if(j==a-1){l.clear(i);m({finished:true});}else{apf.offline.queue.sync(m,true);}};}this.stack[j].retry();},clear:function(){apf.offline.storage.clear(this.namespace);},$getCommInfo:function(strCommItem){if(!strCommItem){return false;}var commObject,commInfo=apf.unserialize(strCommItem);for(var i=0;i<commInfo.$object.length;i++){commObject=self[commInfo.$object[i]]||eval(commInfo.$object[i]);if(commObject){break;}}commInfo.object=commObject;commInfo.retry=new Function(commInfo.$retry);return commInfo;}};apf.offline.state={enabled:false,states:{},realtime:true,lookup:{},init:function(c){this.namespace=apf.config.name+".apf.offline.state";if(c.nodeType){if(c.getAttribute("realtime")){this.realtime=!apf.isFalse(c.getAttribute("realtime"));}if(c.getAttribute("set")){this.setInstruction=c.getAttribute("set");}}apf.addEventListener("exit",function(){if(!apf.offline.state.realtime){var j=apf.offline.state.lookup;var l=apf.offline.storage;var i=apf.offline.state.namespace;for(var d in j){var i=apf.offline.state.namespace;l.put(d,j[d],i);}}if(apf.offline.state.setInstruction){apf.offline.state.send();}});var a=apf.extend({},apf.offline.storage||apf.storage);a.namespace=apf.config.name+".apf.registry";apf.registry.$export(a);apf.registry=a;if(apf.offline.storage.getAllPairs(this.namespace,this.lookup)){if(apf.offline.dispatchEvent("restore")===false){this.clear();this.lookup={};apf.offline.transactions.clear("undo|redo");}}apf.offline.transactions.doStateSync=true;this.enabled=true;},warned:false,timeout:{},set:function(j,c,i){if(!j.tagName){return;}var a=j.name||j.$uniqueId+"_"+j.tagName;var l=apf.offline.storage;c=a+"."+c;this.lookup[c]=i;if(!this.realtime){return;}var d=this.namespace;clearTimeout(this.timeout[c]);this.timeout[c]=$setTimeout(function(){l.put(c,i,d);},200);},get:function(d,a,c){return this.lookup[(d.name||d.$uniqueId+"_"+d.tagName)+"."+a];},getAll:function(i){var j,d={},a,c=i.name||i.$uniqueId+"_"+i.tagName;for(j in this.lookup){a=j.split(".");if(a[0]==c){d[a[1]]=this.lookup[j];}}return d;},clear:function(){apf.offline.storage.clear(this.namespace);var c=apf.registry.getNamespaces();for(var a=0;a<c.length;a++){apf.registry.clear(c[a]);}apf.offline.transactions.clear("undo|redo");},search:function(){var m=apf.offline.storage;var l,d,c,a=apf.all;for(d=0;d<a.length;d++){if(a[d].name&&a[d].getAvailableProperties){l=a[d].getAvailableProperties();for(c=0;c<l.length;c++){if(a[d][l[c]]){this.set(a[d],l[c],a[d][l[c]]);}}}}},send:function(){var j=apf.offline.storage;var d={};var c=j.getKeys(this.namespace);for(var a=0;a<c.length;a++){d[c[a]]=j.get(c[a],this.namespace);}apf.saveData(this.setInstruction,{ignoreOffline:true,data:apf.serialize(d),callback:function(m,l,i){if(i.tpModule.retryTimeout(i,l,apf.offline)===true){return true;}}});}};apf.printer={tagName:"printer",nodeFunc:apf.NODE_HIDDEN,lastContent:"",inited:false,init:function(aml){this.inited=true;this.$aml=aml;this.contentShower=document.body.appendChild(document.createElement("DIV"));this.contentShower.id="print_content";with(this.contentShower.style){width="100%";height="100%";backgroundColor="white";zIndex=100000000;}apf.importCssString("#print_content{display:none}");apf.importCssString((apf.hasCSSChildOfSelector?"body #print_content{display:block} body>*{display:none}":"body #print_content, body #print_content *{display:block} body *{display:none}"),"print");if(aml){var a,i,attr=aml.attributes;for(i=0;i<attr.length;i++){a=attr[i];if(a.nodeName.indexOf("on")==0){apf.addEventListener(a.nodeName,apf.lm.compile(a.nodeValue,{event:true,parsecode:true}));}}}function printPNGFix(disable){if(apf.supportPng24){return;}if(!apf.config.iePngFix){return;}for(var e,i=0,j=document.all.length;i<j;i++){e=document.all[i];if(e.filters["DXImageTransform.Microsoft.AlphaImageLoader"]||e._png_print){if(disable){e._png_print=e.style.filter;e.style.filter="";}else{e.style.filter=e._png_print;e._png_print="";}}}}window.onbeforeprint=function(){printPNGFix(true);apf.dispatchEvent("beforeprint");};window.onafterprint=function(){printPNGFix(false);apf.dispatchEvent("afterprint");};},preview:function(a){if(!this.inited){this.init();}if(typeof a!="string"){a=a.outerHTML||a.xml||a.serialize();}this.lastContent=a;this.contentShower.innerHTML=a;}};apf.print=function(a){if(!apf.printer.inited){apf.printer.init();}apf.printer.preview(a);window.print();};apf.tween={left:function(c,a){c.style.left=a+"px";},right:function(c,a){c.style.left="";c.style.right=a+"px";},top:function(c,a){c.style.top=a+"px";},bottom:function(c,a){c.style.top="";c.style.bottom=a+"px";},width:function(d,c,a){d.style.width=c+"px";},height:function(d,c,a){d.style.height=c+"px";},scrollTop:function(d,c,a){d.scrollTop=c;},scrollLeft:function(d,c,a){d.scrollLeft=c;},"height-rsz":function(d,c,a){d.style.height=c+"px";if(apf.hasSingleResizeEvent){window.onresize();}},mwidth:function(c,a,i){var d=apf.getDiff(c);c.style.width=a+"px";c.style.marginLeft=-1*(a/2+(parseInt(apf.getStyle(c,"borderLeftWidth"))||d[0]/2)+(i.margin||0))+"px";},mheight:function(c,a,i){var d=apf.getDiff(c);c.style.height=a+"px";c.style.marginTop=(-1*a/2-(parseInt(apf.getStyle(c,"borderTopWidth"))||d[1]/2)+(i.margin||0))+"px";},scrollwidth:function(c,a){c.style.width=a+"px";c.scrollLeft=c.scrollWidth;},scrollheight_old:function(c,a){try{c.style.height=a+"px";c.scrollTop=c.scrollHeight;}catch(d){alert(a);}},scrollheight:function(d,c,j){var i=apf.getHeightDiff(d),a=j.$int||d;d.style.height=Math.max((c+(j.diff||0)),0)+"px";a.scrollTop=a.scrollHeight-a.offsetHeight-i+(j.diff||0);},scrolltop:function(c,a){c.style.height=a+"px";c.style.top=(-1*a-2)+"px";c.scrollTop=0;},clipright:function(d,c,a){d.style.clip="rect(auto, auto, auto, "+c+"px)";d.style.marginLeft=(-1*c)+"px";},fade:function(c,a){if(apf.hasStyleFilters){c.style.filter="alpha(opacity="+parseInt(a*100)+")";}else{c.style.opacity=a;}},bgcolor:function(c,a){c.style.backgroundColor=a;},textcolor:function(c,a){c.style.color=a;},htmlcss:function(c,a,d){if(apf.hasStyleFilters&&d.type=="filter"){c.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+a+")";}else{c.style[d.type]=a+(d.needsPx?"px":"");}},NORMAL:0,EASEIN:1,EASEOUT:2,CSSTIMING:["linear","ease-in","ease-out","ease","ease-in-out","cubic-bezier"],CSSPROPS:{left:"left",right:"right",top:"top",bottom:"bottom",width:"width",height:"height",scrollTop:false,scrollLeft:false,mwidth:false,mheight:false,scrollwidth:false,scrollheight:false,fade:"opacity",bgcolor:"background-color",textcolor:"color"},queue:{},current:null,setQueue:function(a,c){if(!a.getAttribute("id")){apf.setUniqueHtmlId(a);}if(!this.queue[a.getAttribute("id")]){this.queue[a.getAttribute("id")]=[];}this.queue[a.getAttribute("id")].push(c);if(this.queue[a.getAttribute("id")].length==1){c(0);}},nextQueue:function(c){var a=this.queue[c.getAttribute("id")];if(!a){return;}a.shift();if(a.length){a[0](0);}},clearQueue:function(d,a){var c=this.queue[d.getAttribute("id")];if(!c){return;}if(a&&this.current&&this.current.control){this.current.control.stop=true;}c.length=0;},$calcSteps:function(m,a,l,n){var d,q;var o=[a];var c=0;var j=(l-a)/((Math.pow(n,2)+2*n+1)/(4*n));for(d=0;d<n;d++){if(!m&&!q){q=(l-a)/n;}else{if(m==1){q=j*Math.pow(((n-d))/n,3);}else{if(m==2){q=j*Math.pow(d/n,3);}}}o.push(o[o.length-1]+q);}o[o.length-1]=l;return o;},$calcColorSteps:function(q,d,o,s){var t=apf.color.colors,w=parseInt((t[d]||d).slice(1),16),u=parseInt((t[o]||o).slice(1),16),m=0,n=Math.round,l=[],j;for(;m<s;m++){j=m/(s-1),d2=1-j;l[l.length]="#"+("000000"+((n((w&255)*d2+(u&255)*j)&255)|(n((w&65280)*d2+(u&65280)*j)&65280)|(n((w&16711680)*d2+(u&16711680)*j)&16711680)).toString(16)).slice(-6);}return l;},single:function(j,l){l=apf.extend({steps:3,interval:20,anim:apf.tween.NORMAL,control:{}},l);if(j.nodeFunc>100){l.$int=j.$int;j=j.$ext;}if("fixed|absolute|relative".indexOf(apf.getStyle(j,"position"))==-1){j.style.position="relative";}var i=(apf.supportCSSAnim&&apf.tween.CSSPROPS[l.type]);l.method=i?l.type:apf.tween[l.type];if(i){var d=apf.tween.CSSPROPS[l.type];if(d===false){return this;}l.type=d||l.type;j.style[l.type]=l.from+(apf.tween.needsPix[l.type]?"px":"");$setTimeout(function(){j.style[l.type]=l.to+(apf.tween.needsPix[l.type]?"px":"");j.style.webkitTransition=l.type+" "+((l.steps*l.interval)/1000)+"s "+apf.tween.CSSTIMING[l.anim||0];var o=function(){if(l.onfinish){l.onfinish(j,l.userdata);}j.style.webkitTransition="";j.removeEventListener("webkitTransitionEnd",o);};j.addEventListener("webkitTransitionEnd",o);});return this;}var n,c=l.color?apf.tween.$calcColorSteps(l.anim,l.from,l.to,l.steps):apf.tween.$calcSteps(l.anim,parseFloat(l.from),parseFloat(l.to),l.steps),a=this,m=function(o){a.current=l;if(l.control&&l.control.stop){l.control.stop=false;apf.tween.clearQueue(j);if(l.onstop){l.onstop(j,l.userdata);}return;}if(l.onbeforeeach&&l.onbeforeeach(j,l.userdata)===false){return;}try{l.method(j,c[o],l);}catch(q){}if(l.oneach){l.oneach(j,l.userdata);}if(o<l.steps){n=$setTimeout(function(){m(o+1);},l.interval);}else{a.current=null;if(l.control){l.control.stopped=true;}if(l.onfinish){l.onfinish(j,l.userdata);}apf.tween.nextQueue(j);}};this.setQueue(j,m);return this;},multi:function(l,E){E=apf.extend({steps:3,interval:20,anim:apf.tween.NORMAL,control:{}},E);if(l.nodeFunc>100){E.$int=l.$int;l=l.$ext;}var t=apf.supportCSSAnim,q=false,a=((E.steps*E.interval)/1000),c=apf.tween.CSSTIMING[E.anim||0];for(var C=[],w=[],B=0;B<E.tweens.length;B++){var F=E.tweens[B];if(F.oHtml&&F.oHtml.nodeFunc>100){F.$int=F.oHtml.$int;F.oHtml=F.oHtml.$ext;}t=(apf.supportCSSAnim&&apf.tween.CSSPROPS[F.type]);F.method=t?F.type:apf.tween[F.type]||apf.tween.htmlcss;if(t){var d=apf.tween.CSSPROPS[F.type];F.type=d||F.type;l.style[F.type]=F.from+(apf.tween.needsPix[F.type]?"px":"");w.push([F.type,F.to+(apf.tween.needsPix[F.type]?"px":"")]);C.push(F.type+" "+a+"s "+c+" 0");q=true;}else{C.push(F.color?apf.tween.$calcColorSteps(E.anim,F.from,F.to,E.steps):apf.tween.$calcSteps(E.anim,parseFloat(F.from),parseFloat(F.to),E.steps));}}if(q){l.style.webkitTransition=C.join(",");var n=0,D=function(){n++;if(n==w.length){if(E.onfinish){E.onfinish(l,E.userdata);}l.style.webkitTransition="";l.removeEventListener("webkitTransitionEnd",D);}};l.addEventListener("webkitTransitionEnd",D);for(var z=0,A=w.length;z<A;z++){l.style[w[z][0]]=w[z][1];}return this;}var s,u=E.tweens,m=this,o=function(G){m.current=E;if(E.control&&E.control.stop){E.control.stop=false;apf.tween.clearQueue(l);if(E.onstop){E.onstop(l,E.userdata);}return;}try{for(var j=0;j<C.length;j++){u[j].method(u[j].oHtml||l,C[j][G],u[j]);}}catch(I){}if(E.oneach){E.oneach(l,E.userdata);}if(G<E.steps){s=$setTimeout(function(){o(G+1);},E.interval);}else{m.current=null;if(E.control){E.control.stopped=true;}if(E.onfinish){E.onfinish(l,E.userdata);}apf.tween.nextQueue(l);}};this.setQueue(l,o);return this;},css:function(m,c,D,E){(D=D||{}).tweens=[];if(m.nodeFunc>100){m=m.$ext;}if(E){apf.setStyleClass(m,"",[c]);}var z=function(j,G){if(j){apf.setStyleClass(m,"",[c]);}else{apf.setStyleClass(m,c);}for(var F=0;F<D.tweens.length;F++){if(D.tweens[F].type=="filter"){continue;}m.style[D.tweens[F].type]="";}if(G){G.apply(this,arguments);}};var a=D.onfinish;var l=D.onstop;D.onfinish=function(){z(E,a);};D.onstop=function(){z(!E,l);};var s,n,t,w,C,B,q,A,u={};for(A=0;A<document.styleSheets.length;A++){q=document.styleSheets[A][apf.styleSheetRules];for(w=q.length-1;w>=0;w--){var o=q[w];if(!o.style||!o.selectorText.match("."+c+"$")){continue;}for(B in o.style){if(!o.style[B]||this.cssProps.indexOf("|"+B+"|")==-1){continue;}if(B=="filter"){if(!o.style[B].match(/opacity\=([\d\.]+)/)){continue;}n=RegExp.$1;s=(apf.getStyleRecur(m,B)||"").match(/opacity\=([\d\.]+)/);t=s?RegExp.$1:100;C=false;if(n==t){if(E){t=100;}else{n=100;}}}else{n=E&&m.style[B]||o.style[B];if(E){m.style[B]="";}t=apf.getStyleRecur(m,B);C=B.match(/color/i)?true:false;}u[B]={type:B,from:(C?String:parseFloat)(E?n:t),to:(C?String:parseFloat)(E?t:n),color:C,needsPx:apf.tween.needsPix[B.toLowerCase()]||false};}}}for(var d in u){D.tweens.push(u[d]);}if(E){apf.setStyleClass(m,c);}return this.multi(m,D);},cssRemove:function(c,a,d){this.css(c,a,d,true);},needsPix:{left:true,top:true,bottom:true,right:true,width:true,height:true,fontSize:true,lineHeight:true,textIndent:true},cssProps:"|backgroundColor|backgroundPosition|color|width|filter|                |height|left|top|bottom|right|fontSize|                |letterSpacing|lineHeight|textIndent|opacity|                |paddingLeft|paddingTop|paddingRight|paddingBottom|                |borderLeftWidth|borderTopWidth|borderRightWidth|borderBottomWidth|                |borderLeftColor|borderTopColor|borderRightColor|borderBottomColor|                |marginLeft|marginTop|marginRight|marginBottom|"};apf.draw={initDriver:function(){if(!this.initLayer){var a,c=apf.supportVML?apf.draw.vml:apf.draw.canvas;for(a in c){this[a]=c[a];}}},basevars:function(){return["var  _math_,v,t=0,n=(new Date()).getTime()*0.001",",e=Math.E, p=Math.PI, p2=2*p, p12=0.5*p",",x, y, z, _x,_y,_z, zt, i, j, k, _opt_;"].join("");},vars:function(i,a,c,d){return["var  _math_,vx1 = v.vx1, vy1 = v.vy1,_rseed=1",",vx2 = v.vx2, vy2 = v.vy2, vw = vx2-vx1, vh = vy1-vy2",",vz2 = v.vz2, vz1 = v.vz1, vd = vz2-vz1",",zoom = 1/v.zoom",",a=v.a,b=v.b,c=v.c,d=v.d",",dw = l.dw",i?"-"+(i+c):"",",dh = l.dh",a?"-"+(a+d):"",",dw12 = dw*0.5, dh12 = dh*0.5",",dzw = dw/v.zoomx, dzh = -dh/v.zoomy",",dx = ",i?i:0,",dy = ",a?a:0,",mx = m&&m.x, my = m&&m.y",",db = dy+dh, dr = dx+dw",",tw = dw/vw, th = dh/vh, ty = -vy2*th+dy, tx = -vx1*tw+dx",",v,t=0,nt=0,n=(new Date()).getTime()*0.001, dt=-(l._n?l._n:n)+(l._n=n)",",e=Math.E, p=Math.PI, p2=2*p, p12=0.5*p",",x, y = 0, z = 0, _x,_y,_z, zt, i, j, k, _opt_, _anim = 0,","_storelut,_storelist,_translut,_speedlut,_overlaylut;"].join("");},defCamVec:function(){return"var inv=1/m00*(m11*m22-m12*m21)-m01*(m10*m22-m12*m20)+m02*(m10*m21-m11*m20);var mcx = inv*(m11*m22-m12*m21)*m03 + inv*(m02*m21-m01*m22)*m13 + inv*(m01*m12-m02*m11)*m23,    mcy = inv*(m12*m20-m10*m22)*m03 + inv*(m00*m22-m02*m20)*m13 + inv*(m02*m10-m00*m12)*m23,    mcz = inv*(m10*m21-m11*m20)*m03 + inv*(m01*m20-m00*m21)*m13 + inv*(m00*m11-m01*m10)*m23;";},setMatrix3D:function(a){var c=this.l;var d=["var m00=",a[0],",m01=",a[1],",m02=",a[2],",m03=",a[3],",m10=",a[4],",m11=",a[5],",m12=",a[6],",m13=",a[7],",m20=",a[8],",m21=",a[9],",m22=",a[10],",m23=",a[11],";"];if(c.p3d<0){this.ortho=1;d.push("var persp = dw / v.p3d/-v.tz, perspd = persp / ",c.ds,";");}else{this.ortho=0;d.push("var persp = dw / v.p3d, perspd = persp / ",c.ds,";");}return d.join("");},sincos3:function(i,d,c,a){return["var ",i,"cx = __cos(",d,"),",i,"sx = __sin(",d,"),",i,"cy = __cos(",c,"),",i,"sy = __sin(",c,"),",i,"cz = __cos(",a,"),",i,"sz = __sin(",a,");"].join("");},matrix4S:function(d,c,a){return[d,0,0,0,0,c,0,0,0,0,a,0,0,0,0,1];},matrix4T:function(c,a,d){return[1,0,0,c,0,1,0,a,0,0,1,d,0,0,0,1];},matrix4RP:function(a){return this.matrix4R(a+"cx",a+"sx",a+"cy",a+"sy",a+"cz",a+"sz");},matrix4R:function(a,l,j,i,d,c){return[[j,"*",d].join(""),["(-",c,"*",j,")"].join(""),i,0,["(",d,"*",l,"*",i,"+",c,"*",a,")"].join(""),["(-",l,"*",i,"*",c,"+",a,"*",d,")"].join(""),["(-",l,"*",j,")"].join(""),0,["(-",a,"*",i,"*",d,"+",l,"*",c,")"].join(""),["(",a,"*",i,"*",c,"+",d,"*",l,")"].join(""),["(",a,"*",j,")"].join(""),0,0,0,0,1];},matrixMul:function(){var a=arguments[arguments.length-1];for(var c=arguments.length-2;c>=0;c--){a=this.matrixAB(a,arguments[c]);}return a;},matrixAB:function(o,n){var c=[],q,m,l,d,u,s;for(m=0;m<16;m+=4){for(q=0;q<4;q++){s=[];if((l=o[m])&&(d=n[q])){s[s.length]=l==1?d:(d==1?l:(l+"*"+d));}if((l=o[m+1])&&(d=n[q+4])){s[s.length]=l==1?d:(d==1?l:(l+"*"+d));}if((l=o[m+2])&&(d=n[q+8])){s[s.length]=l==1?d:(d==1?l:(l+"*"+d));}if((l=o[m+3])&&(d=n[q+12])){s[s.length]=l==1?d:(d==1?l:(l+"*"+d));}c[c.length]=s.length?((s.length>1)?"("+s.join("+")+")":s[0]):0;}}return c;},backface3D:function(s,o,q){var m=s[0],l=s[1],i=s[2],n=0,j=1,d=2;if(o){n=o[0],j=o[1],d=o[2];}return this.ortho?["-((m00*",l[n],"+m01*",l[j],"+m02*",l[d],"+m03)-(__ax=m00*",m[n],"+m01*",m[j],"+m02*",m[d],"+m03))*","((m10*",i[n],"+m11*",i[j],"+m12*",i[d],"+m13)-(__ay=m10*",m[n],"+m11*",m[j],"+m12*",m[d],"+m13))+","((m10*",l[n],"+m11*",l[j],"+m12*",l[d],"+m13)-__ay)*((m00*",i[n],"+m01*",i[j],"+m02*",i[d],"+m03)-__ax)"].join(""):["(((__by=m10*",l[n],"+m11*",l[j],"+m12*",l[d],"+m13) - (__ay=m10*",m[n],"+m11*",m[j],"+m12*",m[d],"+m13)) *","((__cz=m20*",i[n],"+m21*",i[j],"+m22*",i[d],"+m23) - (__az=m20*",m[n],"+m21*",m[j],"+m22*",m[d],"+m23)) -","((__bz=m20*",l[n],"+m21*",l[j],"+m22*",l[d],"+m23) - __az) * ((__cy=m10*",i[n],"+m11*",i[j],"+m12*",i[d],"+m13) - __ay) ) * ","(__ax=m00*",m[n],"+m01*",m[j],"+m02*",m[d],"+m03) + ","((__bz - __az) * ((__cx=m00*",i[n],"+m01*",i[j],"+m02*",i[d],"+m03) - __ax) -","((__bx=m00*",l[n],"+m01*",l[j],"+m02*",l[d],"+m03) - __ax) * (__cz - __az) ) * __ay + ","((__bx - __ax) * (__cy - __ay) - (__by - __ay) * (__cx - __ax) ) * __az "].join("");},text3D:function(D,c,m,o){var F=0,G,E,B,t=["__n=0;"],n=0,l=1,j=2,w,u,C,A,I,a;if(c){n=c[0],l=c[1],j=c[2];}return["if((__z = m20*",D[n],"+m21*",D[l],"+m22*",D[j],"+m23) < ",m,"){",this.text(["dw12+(m00*",D[n],"+m01*",D[l],"+m02*",D[j],"+m03)*",this.ortho?"persp":"(persp/__z)"].join(""),["dh12+(m10*",D[n],"+m11*",D[l],"+m12*",D[j],"+m13)*",this.ortho?"persp":"(persp/__z)"].join(""),o),"}"].join("");},poly3DClip:function(u,F,c,m,o){var G=0,I,E,F,C,t=["__n=0;"],n=0,l=1,j=2,A,w,D,B,J,a;if(c){n=c[0],l=c[1],j=c[2];}for(var G=0;G<u.length;G++){E=F[u[G]];t.push(["if(__n",G,"=(__z",G," = m20*",E[n],"+m21*",E[l],"+m22*",E[j],"+m23) < ",m,")__n++;"].join(""));}t.push("if(__n){","if(__n==",u.length,"){");for(var G=0;G<u.length;G++){E=F[u[G]];D=["dw12+(m00*",E[n],"+m01*",E[l],"+m02*",E[j],"+m03)*",this.ortho?"persp":"(persp/__z"+G+")"].join("");B=["dh12+(m10*",E[n],"+m11*",E[l],"+m12*",E[j],"+m13)*",this.ortho?"persp":"(persp/__z"+G+")"].join("");if(G==0){t.push(this.moveTo(D,B));}else{t.push(this.lineTo(D,B));}}if(!o){t.push(this.close());}t.push("}else{");for(var G=0;G<u.length;G++){E=F[u[G]];if(G==0){t.push(["__x0=m00*",E[n],"+m01*",E[l],"+m02*",E[j],"+m03;","__y0=m10*",E[n],"+m11*",E[l],"+m12*",E[j],"+m13;","if( __o=__n0){",this.moveTo("dw12+__x0*"+(this.ortho?"persp":"(persp/__z0)"),"dh12+__y0*"+(this.ortho?"persp":"(persp/__z0)")),"}"].join(""));}else{t.push(["__xn=dw12+(__x",G,"=m00*",E[n],"+m01*",E[l],"+m02*",E[j],"+m03)*",(this.ortho?"persp;":"(persp/__z"+G+");"),"__yn=dh12+(__y",G,"=m10*",E[n],"+m11*",E[l],"+m12*",E[j],"+m13)*",(this.ortho?"persp;":"(persp/__z"+G+");"),"if( __n",G," && !__n",G-1," || !__n",G,"&& __n",G-1,"){","__z=(__zc=(",m,"-__z",G-1,")/(__z",G,"-__z",G-1,")) * __z",G,"+(__ze=1-__zc)* __z",G-1,";","__xi=dw12+(__zc*__x",G,"+__ze* __x",G-1,")*",(this.ortho?"persp":"(persp/__z)"),";","__yi=dh12+(__zc*__y",G,"+__ze* __y",G-1,")*",(this.ortho?"persp":"(persp/__z)"),";","if(!__o){__o=true;",this.moveTo("__xi","__yi"),"}else{",this.lineTo("__xi","__yi"),"}","}","if( __n",G,"){",this.lineTo("__xn","__yn"),"}"].join(""));}if(G==u.length-1){t.push(["if(!__n0 && __n",G," || __n0 && ! __n",G,"){","__z=(__zc=(",m,"-__z",G,")/(__z0-__z",G,")) * __z0+(__ze=1-__zc)* __z",G,";",this.lineTo(["dw12+(__zc*__x0+__ze* __x",G,")*",(this.ortho?"persp":"(persp/__z)")].join(""),["dh12+(__zc*__y0+__ze* __y",G,")*",(this.ortho?"persp":"(persp/__z)")].join("")),"}",o?"":this.close()].join(""));}}t.push("}};");return t.join("").replace(/m\d\d\*\(?0\)?\+/g,"");},poly3D:function(C,F,A){var B,w=1,u,o=0,z,E,a,D=[],l=new Array(F.length),c=new Array(F.length),t,n,m;if(A){t=A[0],n=A[1],m=A[2];}else{t=0,n=1,m=2;}for(u=0;u<C.length;u++){z=C[u];if(z>=0){l[z]++;}}for(u=0;u<F.length;u++){if(l[u]>1){l[u]=o++;}else{l[u]=0;}}for(var u=0;u<C.length;u++){z=C[u];if(z>=0){E=F[z];a=[this.ortho?"":"zt = persp / ((zt=(m20*"+E[t]+"+m21*"+E[n]+"+m22*"+E[m]+"+m23)<-0.01)?zt:-0.01);","dw12+(m00*"+E[t]+"+m01*"+E[n]+"+m02*"+E[m]+"+m03)*"+(this.ortho?"persp":"zt"),"dh12+(m10*"+E[t]+"+m11*"+E[n]+"+m12*"+E[m]+"+m13)*"+(this.ortho?"persp":"zt")];z=w?0:u;if(l[z]){a[1]="__t"+l[z]+(c[z]?"":"="+a[1]),a[2]="__t"+l[z]+(c[z]++?"":"="+a[2]);}}switch(z){case -1:w=1;D.push(this.close());break;case 0:w=0;D.push(a[0],this.moveTo(a[1],a[2]));break;case C.length-1:D.push(a[0],this.lineTo(a[1],a[2]),this.close());break;default:D.push(a[0],this.lineTo(a[1],a[2]));break;}}return D.join("").replace(/m\d\d\*\(?0\)?\+/g,"");},lineTo3D:function(a,l,i,j,d,c){return this.$do3D("lineTo",a,l,i,j,d,c);},moveTo3D:function(a,l,i,j,d,c){return this.$do3D("moveTo",a,l,i,j,d,c);},$store3D:function(a,c){return a+";"+c+";";},store3D:function(a,l,i,j,d,c){return this.$do3D("$store3D",a,l,i,j,d,c);},$do3D:function(c,q,l,j,o,m,t){var n,i,d;if(typeof q=="string"&&q.match(/[\[\]\*\+\-\/]/)){q="(_x="+q+")",n="_x";}else{q="("+q+")",n=q;}if(typeof l=="string"&&l.match(/[\[\]\*\+\-\/]/)){l="(_y="+l+")",i="_y";}else{l="("+l+")",i=l;}if(typeof j=="string"&&j.match(/[\[\]\*\+\-\/]/)){j="(_z="+j+")",d="_z";}else{j="("+j+")",d=j;}if(t){var u=[q,l,j],s=[n,i,d];q=u[n=t[0]],l=u[i=t[1]],j=u[d=t[2]];n=s[n],i=s[i],d=s[d];}var a=[];if(!this.ortho){a.push("zt =persp/((zt=m20*"+q+"+m21*"+l+"+m22*"+j+"+m23)<-0.01?zt:-0.01);");}a.push(this[c]((o===undefined?"":o)+"dw12+(m00*"+n+"+m01*"+i+"+m02*"+d+"+m03)*"+(this.ortho?"persp":"zt"),(m===undefined?"":m)+"dh12+(m10*"+n+"+m11*"+i+"+m12*"+d+"+m13)*"+(this.ortho?"persp":"zt")));return a.join("").replace(/m\d\d\*\(?0\)?\+/g,"");},parseStyle:function(A,u,l){var O={},E,w,J,B,z,N,K,F,G;var c=this;if(!(z=c.stateTransition)[262145]){B={};for(w in z){for(N=0;N<32;N++){B[w|N]=z[w]|N;}}c.stateTransition=B;}u=u?this.parseJSS(u.item?u.join(""):u,l):{};function I(Q,P,n){var m,j,i,s;for(j in P){if(Q[j]===undefined){Q[j]=c.isDynamic(i=P[j])?c.parseJSS(i):i;}}if(m=P.inherit){I(Q,A[m]||c["$"+m],m);}if(s=u[n]){for(j in s){Q[j]=s[j];}}}for(J in A){if(typeof(w=A[J])=="object"&&w!==null&&w["$"]==1){I(O[J]={},w,J);}}function D(Q,i,P,n){var t,m,j;do{if(!P&&!n){t=O[i];}else{t=u[i+(P?"."+P:"")+(n?":"+n:"")];}if(typeof(t)=="object"){for(j in t){if(j.indexOf("$")==-1&&Q[j]===undefined){Q[j]=t[j];}}}if(n){n=c.$stateInherit[m];}}while(n);}for(J in u){if(typeof(w=u[J])=="object"){z=J.match(/([\w\_-]+)\.?([\w\_-]+)?\:?([\w\_-]+)?/);var q=z[1],a=z[2],d=z[3];if(a||d){E=O[J]={};if(d){if(a){D(E,q,a,d);}D(E,q,0,d);}if(a){D(E,q,a,0);}D(E,q,0,0);E.$cls=a?a:"",E.$state=d?d:"";E.$base=B=O[q];if(!B){alert("ERROR, baseless style found: "+q);return;}(B.$stylelist?B.$stylelist:(B.$stylelist=[])).push(E);if(!a){(B.$baselist?B.$baselist:(B.$baselist={}))[d]=1;}else{(B.$clslist?B.$clslist:(B.$clsc=1,B.$clslist={}))[a]=B.$clsc++;}}}}function M(i){if(i.stroke===null||i.stroke=="null"||i.stroke==0){delete i.stroke;}if(i.fill===null||i.fill=="null"||i.fill==0){delete i.fill;}if(i.family===null||i.family=="null"||i.family==0){delete i.family;}if((i.isshape&&i.fill===undefined&&i.stroke===undefined&&i.tile===undefined)||(i.isfont&&i.family===undefined)){return false;}if(i.isshape){i.opacity=i.opacity!==undefined?i.opacity:1;i.fillopacity=i.fillopacity!==undefined?i.fillopacity:i.opacity;i.gradopacity=i.gradopacity!==undefined?i.gradopacity:i.fillopacity;i.strokeopacity=i.strokeopacity!==undefined?i.strokeopacity:i.opacity;i.angle=i.angle!==undefined?i.angle:0;i.weight=i.weight!==undefined?i.weight:1;}return true;}for(J in O){if(typeof(B=O[J])=="object"){if(B.$baselist&&B.$clslist){delete B.$clsc;for(N in B.$clslist){for(K in B.$baselist){if(!O[z=J+"."+N+":"+K]){if((G=O[J+":"+K])&&G.overlay){(G.$clsovl?G.$clsovl:G.$clsovl=[]).push(N);}else{O[z]=E={};for(w in (z=O[J+"."+N])){E[w]=z[w];}for(w in (z=u[J+":"+K])){E[w]=z[w];}E.$cls=N,E.$state=K,E.$base=B;M(E);B.$stylelist.push(E);}}}}}if(B.$stylelist){B.$storelut={};B.$speedlut={};B.$overlaylut={};var a,d,u,C;K=B.$stylelist;for(N=0;N<K.length;N++){E=K[N];a=B.$clslist?(B.$clslist[E.$cls]||0):0;d=apf.draw.stateBit[E.$state]||0;E.$lutvalue=d|a;E.$store=F;if(z=E.overlay){if(z=="base"){u=a?a:268435456;}else{u=(B.$clslist?(B.$clslist[z]||0):0)|(apf.draw.stateBit[z]||0);}}else{u=0;}B.$storelut[d|a]=N;B.$speedlut[d|a]=E.speed||1;if(u){B.$overlaylut[d|a]=u;}if(E.$clsovl){for(G=E.$clsovl.length-1;G>=0;G--){a=B.$clslist?(B.$clslist[E.$clsovl[G]]||0):0;B.$storelut[d|a]=N;B.$speedlut[d|a]=E.speed||1;if(u){B.$overlaylut[d|a]=(u==268435456)?a:u;}}}}}if(!M(B)){delete O[J];}}}return O;},stateBit:{0:0,init:16777216,hidden:65536,deinit:33554432,hover:131072,hoverin:16908288,hoverout:33685504,select:196608,selectin:16973824,selectout:33751040,selecthover:262144,selecthoverin:17039360,selecthoverout:33816576,animating:50659328},stateTransition:{16777216:0,33554432:65536,16908288:131072,33685504:0,16973824:196608,33751040:0,17039360:262144,33816576:196608,17104896:17104896},stateMask:{selected:16777216|8388608|2097152|1048576|524288,normal:536870912|134217728|67108864|33554432|262144,dynamic:536870912|268435456|67108864|33554432|8388608|4194304|1048576|524288|262144,hover:134217728|67108864|2097152|1048576},$stateInherit:{hidden:0,init:0,deinit:0,hover:0,hoverin:"hover",hoverout:"hover",select:0,selectin:"select",selectout:"select",selecthover:"hover",selecthoverin:"selecthover",selecthoverout:"selecthover",animating:0},$stateFallback:{init:1,hover:1,hoverin:"hover",hoverout:1,select:1,selectin:"select",selectout:1,selecthover:"hover",selecthoverin:"selecthover",selecthoverout:"select",hidden:1},getXYWH:function(a,i,d){var c;if(!((c=this.$getXYWH_NT[i])||(i=this.$getXYWH_TN[c=i]))){return"0";}if(a==null){return"0";}if(typeof(a)=="object"){if(a.sort){return --i>=a.length?"0":((c=a[i])&&c.sort&&!d?c.join(""):c);}return(c=a[c])===undefined||i>1?"0":(c&&c.sort&&!d?c.join(""):c);}return i==1?a:"0";},$getXYWH_NT:{1:"x",2:"y",3:"z",4:"w"},$getXYWH_TN:{x:1,y:2,z:3,w:4},getTRBL:function(a,i,d){var c;if(!((c=this.$getTRBL_NT[i])||(i=this.$getTRBL_TN[c=i]))){return"0";}if(a==null){return"0";}if(typeof(a)=="object"){if(a.sort){return --i>=a.length?"0":((c=a[i])&&c.sort&&!d?c.join(""):c);}return(c=a[c])===undefined||i>1?"0":(c&&c.sort&&!d?c.join(""):c);}return i==1?a:"0";},$getTRBL_NT:{1:"t",2:"r",3:"b",4:"l"},$getTRBL_TN:{t:1,y1:1,r:2,x2:2,b:3,y2:3,l:4,x1:4},getFlat:function(a){if(typeof(a)=="object"&&a.sort){return a.join("");}return a;},getColor:function(d){if(d.match(/\(/)){return d;}if(d.match(/^#/)){return"'"+d+"'";}var c=d.toLowerCase();return(this.colors[c])?"'"+this.colors[c]+"'":d;},getX:function(d,j,l,c,i){var a;return(typeof(a=d[l+"-x"])=="undefined"&&(typeof(a=d[l])!="object"||typeof(a=a[0])=="undefined"))?(typeof(i)!="undefined"?i:""):(j+a+c);},getY:function(i,l,m,d,j,c){var a;return(typeof(a=i[m+"-y"])=="undefined"&&(typeof(a=i[m])!="object"||typeof(a=a[1])=="undefined"))?(typeof(j)!="undefined"?j:""):(l+a+d);},checkX:function(d,j,c,i){var a;return(typeof(a=d[j+"-x"])=="undefined"&&(typeof(a=d[j])!="object"||typeof(a=a[0])=="undefined"))?(typeof(i)=="undefined"?"":i):c;},checkY:function(d,j,c,i){var a;return(typeof(a=d[j+"-y"])=="undefined"&&(typeof(a=d[j])!="object"||typeof(a=a[1])=="undefined"))?(typeof(i)=="undefined"?"":i):c;},isDynamic:function(c){return c&&typeof(c)=="string"&&!(c.indexOf(".")!=-1&&c.match(/^[\s:a-zA-Z0-9\/\\\._-]+$/))&&c.match(/[\(+*\/-]/)!=null;},baseMacro:function(m){for(var c=m.length,d=0,a;d<c;d++){if(typeof(a=m[d])=="object"){m[d]=this.parseJSS(a[0]);}}var l=this.optimize([this.basevars(),m.join(""),]);return l;},optimize:function(j){var d,a,i=[],c={},l=0;if(typeof(j)=="object"){j=j.join("");}j.replace(/\_\_(\w+)/g,function(n,o){if(!c[o]){if(o.length<=2){i.push("__"+o);}else{i.push("__"+o+"=Math."+o);}c[o]=1;}});j=j.replace(/(__(\w+))\((\-?\d+\.?\d*)\)/g,function(o,q,n,s){if(q=="__round"){return Math.round(s);}return Math[n](s);});if(j.match("_rndtab")){i.push("_rndtab=apf.draw.$rndtab");}j=i.length?j.replace(/\_math\_/,i.join(",")):j;c={},l=0,i=[];j=i.length?j.replace(/\_opt\_/,i.join(",")):j;j=j.replace(/__round\((d[wh])\)/g,"$1");return j;},parseJSS:function(A,d,D,B){if(!A){return{};}var N=true;var m=0,J=0,w,F,G,l=0,O=[],j=[],n=[],M=[],z=[],I=[],u=D||{},a=0,C=[],c=this,E={1:"}",2:")",3:"]",4:")",5:"}"},q={"{":1,"(":2,"[":3},o=6;try{A=A.replace(/\/\*[\S\s]*?\*\/|\/\/.*?;/g,"");A.replace(/(["'])|(\^)|([\w\.\_]+\:?[\w\_\s-]*)\s*\{\s*|([\w\_]+)\s*[:]+\s*|([\w\.\_]+)\s*\(\s*|(\#[0-9a-zA-Z]+|0x[0-9a-zA-Z]+)|(\d+\.?\d*[\_a-zA-Z]+)|([({\[])|([)}\]])|(\\["'{}\[\](),;\:]|\s*[\<\>\=*+\%@&\/]\s*|\s*\-\s+)|([,\s]+)|(;)|$/g,function(s,V,t,R,P,X,i,T,Q,Z,Y,aa,U,W){if(Y||i){return s;}if(J||V){if(V&&!J){J=V;}else{if(J==V){J=0;}}return s;}if(aa){M.push(A.slice(m,W));j.push(M.join(""));m=W+aa.length,M=[];return s;}if(P){if(o>=5){o=6,a=P,m=W+s.length;j=[],M=[];}return s;}if(T){M.push(A.slice(m,W));w=s.match(/(\d\.?\d*)(.+)/);M.push(w[1],"*",w[2]);m=W+s.length;return s;}if(X){I.push(o=4);if(W>m){M.push(A.slice(m,W));}if(M.length&&M[M.length-1].match(/\)\s*$/)){M.push("*");}if(w=X.match(/(\d\.?\d*)(.+)/)){M.push(w[1]+"*");X=w[2];}z.push(M);n.push(j);O.push(l);l=X;j=[],M=[],m=W+s.length;return s;}if(R){if(o<5){throw ({t:"JSS Error - object scope found inside macro",p:W});}m=W+s.length;I.push(o=5);(R=R.replace(/^\s*/,"").replace(/\s*$/,"").split(" ")).length>1?(R=R[1]+"@"+R[0]):R=R[0];C.push(u);u=(typeof(w=u[R])=="object")?w:(u[R]={});return s;}if(Q){I.push(o=q[Q]);if(o==1&&a){I.pop();m=W+s.length;I.push(o=5);C.push(u);u=(typeof(w=u[a])=="object")?w:(u[a]={});}else{if(o==3){if(W>m){M.push(A.slice(m,W));}z.push(M);n.push(j);j=[],M=[],m=W+Q.length;}}return s;}if(Z){if(!I.length||E[o=I.pop()]!=Z){throw ({t:"JSS Error - closed "+o+" with "+Z,p:W});log();}switch(o){case 3:M.push(A.slice(m,W));j.push(M.join(""));if(n.length!=1){(M=z.pop()).push("[",j.join(","),"]");j=n.pop();}else{z.pop();w=n.pop();M=[];for(F=0,G=j.length;F<G;F++){w.push(j[F]);}j=w;}m=W+Z.length;break;case 4:M.push(A.slice(m,W));j.push(M.join(""));(M=z.pop()).push((w=c[l])?w.apply(c,j):l+"*("+j.join(",")+")");j=n.pop(),l=O.pop(),m=W+1;break;case 5:M.push(A.slice(m,W));j.push(M.join(""));m=W+Z.length,M=[];if(a){u[a]=j.length>1?j:j[0];}j=[],a=null,u=C.pop();break;}if(!n.length){o=6;}return s;}if(o>=5){M.push(A.slice(m,W));if((w=M.join("")).length){j.push(w);}m=W+s.length,M=[];if(a){u[a]=j.length>1?j:j[0];}else{if(w&&I.length==0){u=j.length>1?j:j[0];}}j=[],a=null;}return s;});if(J){throw ({t:"JSS Error - Unclosed string found "+J,p:m});}if(I.length>0){throw ({t:"JSS Error - Unclosed object found "+I[I.length-1],p:m});}}catch(K){apf.alert_r(K);if(d){d.v=K.p>=0?K.t+" at: "+K.p+" ->"+A.slice((w=K.p-4)<0?0:w,7)+"<-":K.t;}return null;}return u;},sin:function(c){return"__sin("+c+")";},cos:function(c){return"__cos("+c+")";},tan:function(c){return"__tan("+c+")";},asin:function(c){return"__asin("+c+")";},acos:function(c){return"__acos("+c+")";},atan:function(c){return"__atan("+c+")";},atan2:function(c){return"__atan2("+c+")";},floor:function(c){return"__floor("+c+")";},exp:function(c){return"__exp("+c+")";},log:function(c){return"__log("+c+")";},pow:function(d,c){return"__pow("+d+","+c+")";},random:function(c){return"__random("+c+")";},round:function(c){return"__round("+c+")";},sqrt:function(c){return"__sqrt("+c+")";},$pal:function(c,m){var l=["'#'+('000000'+(__round(","((__a=parseInt((__t=["];for(var j=2,a=arguments.length;j<a;j++){var d=arguments[j];l.push(j>2?",":"");if(apf.draw.colors[d]){l.push("'",apf.draw.colors[d],"'");}else{if(d.match(/\(/)){l.push(d);}else{if(d.match(/^#/)){l.push("'",d,"'");}else{l.push(d);}}}}if(c&2){l.push("])[ (__g=__floor( __c=(__f=(",m,")",(c&1)?"*"+(a-3):"",")<0?0:__f))>",a-3,"?",a-3,":__g].slice(1),16))&0xff)","*(__d=1-(__c-__floor(__c)))","+((__b=parseInt(__t[ (__g=__ceil(__c))>",a-3,"?",a-3,":__g","].slice(1),16))&0xff)*(__e=1-__d) )","+(__round(__d*(__a&0xff00)+__e*(__b&0xff00))&0xff00)","+(__round(__d*(__a&0xff0000)+__e*(__b&0xff0000))&0xff0000)",").toString(16)).slice(-6)");}else{l.push("])[ __floor( __c=(__f=(",m,")",c?"*"+(a-3):"",")<0?-__f:__f)%",a-2,"].slice(1),16))&0xff)","*(__d=1-(__c-__floor(__c)))","+((__b=parseInt(__t[ __ceil(__c)%",a-2,"].slice(1),16))&0xff)*(__e=1-__d) )","+(__round(__d*(__a&0xff00)+__e*(__b&0xff00))&0xff00)","+(__round(__d*(__a&0xff0000)+__e*(__b&0xff0000))&0xff0000)",").toString(16)).slice(-6)");}return l.join("");},$lut:function(j,o){var m=["(["],d,l=2,c=arguments.length;for(;l<c;l++){d=arguments[l];m.push(l>2?",":"");if(typeof(d)=="string"&&d.match(/\(/)||d.match(/^['"]/)){m.push(d);}else{m.push("'",d,"'");}}m.push("])[__floor((__b=((",o,")",j?"*"+(c-3):"",")%",c-2,")<0?-__b:__b)]");return m.join("");},$lin:function(j,o){var m=["((__t=["],d,l=2,c=arguments.length;for(;l<c;l++){d=arguments[l];m.push(l>2?",":"");if(typeof(d)=="string"&&d.match(/\(/)||d.match(/^['"]/)){m.push(d);}else{m.push("'",d,"'");}}m.push("])[__floor( __c=(__f=(",o,")",j?"*"+(c-3):"",")<0?-__f:__f)%",c-2,"]","*(__d=1-(__c-__floor(__c)))","+__t[ __ceil(__c)%",c-2,"]*(__e=1-__d) )");return m.join("");},fixed:function(c,d,i){d="parseFloat(("+c+").toFixed("+d+"))";return parseInt(i)?this.nozero(c,d):d;},padded:function(c,d,i){d="("+c+").toFixed("+d+")";return parseInt(i)?this.nozero(c,d):d;},abs:function(c){if(parseFloat(c)==c){return Math.abs(c);}if(typeof(c)=="number"||c.match(/$[a-z0-9_]+^/)){return"("+c+"<0?-"+c+":"+c+")";}return"((__t="+c+")<0?-__t:__t)";},min:function(j,d){if(d===null){return j;}if(parseFloat(j)==j&&parseFloat(d)==d){return Math.min(j,d);}var i=j,m=d,c=j,l=d;if(typeof(j)=="string"&&!j.match(/$-?[a-z0-9\_]+^/)){i="(__a="+j+")",c="__a";}if(typeof(d)=="string"&&!d.match(/$-?[a-z0-9\_]+^/)){m="(__b="+d+")",l="__b";}return"(("+i+")<("+m+")?"+c+":"+l+")";},max:function(j,d){if(d===null){return j;}if(parseFloat(j)==j&&parseFloat(d)==d){return Math.max(j,d);}var i=j,m=d,c=j,l=d;if(typeof(j)=="string"&&!j.match(/$-?[a-z0-9\_]+^/)){i="(__c="+j+")",c="__c";}if(typeof(d)=="string"&&!d.match(/$-?[a-z0-9\_]+^/)){m="(__d="+d+")",l="__d";}return"(("+i+")>("+m+")?"+c+":"+l+")";},clamp:function(i,d,j){if(d===null||j==null){return i;}return this.max(this.min(i,j),d);},pal:function(){var a=Array.prototype.slice.call(arguments,0);a.unshift(1);return this.$pal.apply(this,a);},pali:function(){var a=Array.prototype.slice.call(arguments,0);a.unshift(0);return this.$pal.apply(this,a);},palc:function(){var a=Array.prototype.slice.call(arguments,0);a.unshift(3);return this.$pal.apply(this,a);},palci:function(){var a=Array.prototype.slice.call(arguments,0);a.unshift(2);return this.$pal.apply(this,a);},lin:function(){var a=Array.prototype.slice.call(arguments,0);a.unshift(1);return this.$lin.apply(this,a);},lini:function(){var a=Array.prototype.slice.call(arguments,0);a.unshift(0);return this.$lin.apply(this,a);},lut:function(){var a=Array.prototype.slice.call(arguments,0);a.unshift(1);return this.$lut.apply(this,a);},luti:function(){var a=Array.prototype.slice.call(arguments,0);a.unshift(0);return this.$lut.apply(this,a);},$rgbpack:function(d,c,a){return("#"+("000000"+(((d<0?0:(d>255?255:parseInt(d)))<<16)+((c<0?0:(c>255?255:parseInt(c)))<<8)+((a<0?0:(a>255?255:parseInt(a))))).toString(16)).slice(-6));},rgb:function(d,c,a){if(parseFloat(d)==d&&parseFloat(c)==c&&parseFloat(a)==a){return this.$rgbpack(d,c,a);}return["('#'+('000000'+(",(parseFloat(d)==d?((d<0?0:(d>255?255:parseInt(d)))<<16):"(((__t="+d+")<0?0:(__t>255?255:parseInt(__t)))<<16)"),"+",(parseFloat(c)==c?((c<0?0:(c>255?255:parseInt(c)))<<8):"(((__t="+c+")<0?0:(__t>255?255:parseInt(__t)))<<8)+"),"+",(parseFloat(a)==a?((a<0?0:(a>255?255:parseInt(a)))):"(((__t="+a+")<0?0:(__t>255?255:parseInt(__t))))"),").toString(16)).slice(-6))"].join("");},$hsvpack:function(l,j,c){var d,a=c*(1-j),o=c*(1-j*((d=Math.floor(((l<0?-l:l)%1)*6))?l-d:1-(l-d)));switch(d){case 6:case 0:return this.$rgbpack(c,o,a);case 1:return this.$rgbpack(o,c,a);case 2:return this.$rgbpack(a,c,o);case 3:return this.$rgbpack(a,o,c);case 4:return this.$rgbpack(o,a,c);default:case 5:return this.$rgbpack.rgb(c,a,o);}},hsv:function(d,c,a){if(parseFloat(r)==r&&parseFloat(g)==g&&parseFloat(b)==b){return this.$hsvpack(r,g,b);}return"apf.draw.$hsvpack("+d+","+c+","+a+");";},rgbf:function(d,c,a){return this.rgb(parseFloat(d)==d?d*255:"255*("+d+")",parseFloat(c)==c?c*255:"255*("+c+")",parseFloat(a)==a?a*255:"255*("+a+")");},nozero:function(c,d,i){return"(("+c+")>-0.0000000001 && ("+c+")<0.0000000001)?"+(i!==undefined?i:"''")+":("+(d!==undefined?d:c)+")";},$rndtab:null,rnd:function(c){if(c){if(!this.$rndtab){var j,d=this.$rndtab=Array(256);for(j=-256;j<256;j++){d[j]=Math.random();}}return"_rndtab[__round(("+c+")*255)%255]";}return"((_rseed=(_rseed * 16807)%2147483647)/2147483647)";},ang:function(c){if(c==parseFloat(c)){return c*(Math.PI/180);}return"(("+c+")*p/180)";},snap:function(d,c){return"(__round(("+d+")/(__t=("+c+")))*__t)";},rnds:function(d,c){return this.rnd(this.snap(d,c));},tsin:function(c){return"(0.5+0.5*__sin("+c+"))";},tcos:function(c){return"(0.5+0.5*__cos("+c+"))";},usin:function(c){return"(0.5-0.5*__sin("+c+"))";},ucos:function(c){return"(0.5-0.5*__cos("+c+"))";},two:function(c){return"(0.5+0.5*("+c+"))";},easein:function(a,c){if(!c){c="3";}return["__pow(",a,",",c,")"].join("");},easeout:function(a,c){if(!c){c="3";}return["(1-__pow(1-(",a,"),",c,"))"].join("");},ease:function(c,d,a){if(!d){d="3";}if(!a){a=d;}return["(0.5*((__a=2*(",c,"))<1?","__pow(__a,",d,"):","(2-__pow(2-__a,",a,"))))"].join("");},fontz:function(d,c){return(-d/c)+(this.ortho?"*perspd":"*(perspd/__z)");},$canJoin:function(d,c){if(d.isfont&&c.isfont){return d.join!=null&&c.join!=null&&d.family===c.family&&d.join===c.join&&d.height==c.height&&d.width==c.width&&d.align===c.align&&d.color===c.color&&d.size===c.size&&d.style===c.style;}if(d.isshape&&c.isshape){return d.join!=null&&c.join!=null&&d.stroke===c.stroke&&d.join===c.join&&d.weight==c.weight&&d.fill===c.fill&&d.fillopacity===c.fillopacity&&d.strokeopacity===c.strokeopacity&&d.angle===c.angle;}return false;},$shape:{isshape:true,stroke:null,fill:null,tilex:"(this.$tilex)",tiley:"(this.$tiley)"},$font:{isfont:true,height:12,family:"verdana",weight:"normal",color:"#00000",size:10},draw3D:function(a,m,l,c,i,j){return"";},beginMouseState:function(a,q,d,c){var B=[],m=this.l;this.mousestyle=a;this.mousethis=q;this.mousefunc=d;this.mousestates=[];var w=a.$statelist,o,n,A,z;if(!w||!w.length){return"";}w=this.mousestates=w.slice(0);if(w[0]!=a){w.unshift(a);}if(!m._mousestyles){m._mousestyles=[];}for(o=0,n=w.length;o<n;o++){z=(A=w[o])._mid=m._mousestyles.push(A)-1;if(A.$store){A.$store._mid=z;}}B.push("_s = l._mousestyles[",a._mid,"], _sh = _s.$statehash, _sp = _s.$speedhash;");return B.join("");},checkMouseState:function(d,l){var o=[],u,n,m,q=this.mousestates,w;if(!q||!q.length){for(n=2,m=arguments.length;n<m;n++){o.push(arguments[n]);}o.push(true);this.style=this.mousestyle;w=this.mousefunc.apply(this.mousethis,o);this.style=0;return w;}w=["t=(n-",l,")*(_sp[_t=_sh[",d,"]]||100000);"];for(n=2,m=arguments.length;n<m;n++){o.push(u="_s"+(n-1));w.push(u,"=",arguments[n],(n!=m-1)?",":";");}o.push(true);w.push("switch(_t?_t._mid:0){");for(n=0,m=q.length;n<m;n++){var c=q[n];this.style=c;if(q[n]){w[w.length]=["case ",c._mid,":{","/*"+apf.vardump(c,0,1)+"*/\n",this.mousefunc.apply(this.mousethis,o),"}break;"].join("");}}w.push("};");this.style=0;return w.join("");},$endMouseState:function(){this.mousestyle=0;return"";},shapedPart:function(s,q,u,o,n,c,i){var B=this.style;var d="0",a="1";var A=this.getX,z=this.getY,l=this.checkX,j=this.checkY;switch(B.shape){default:case"pie":if(A(B,"","scale","","1")!="1"){n=["_x5=(",A(B,"(","offset",")+"),"(",n,")","+",A(B,"(","center",")","0.5"),"*(_x3=",c,")",A(B,"*(1-(_x4=","scale","))"),")*p2"].join("");c="_x5+(_x3*_x4)*p2";}else{n=["_x5=(",A(B,"(","offset",")+"),"(",n,")",")*p2"].join("");c="_x5+("+c+")*p2";}if(z(B,"","scale","","1")!="1"){d=[z(B,"(","offset",")+"),z(B,"(","center",")","0.5"),z(B,"*(1-(_y4=","scale","))")].join("");a="_y4";}else{d=[z(B,"(","offset",")","0")].join("");a="1";}if(d!="0"){s="_x6=__sin(_y8=((_x9="+n+")+(_y9="+c+"))*0.5)*(_x8="+d+")*(_x7="+u+")+("+s+")"+A(B,"+_x7*(","move",")");q="_y6=__cos(_y8)*_x8*(_y7="+o+")+("+q+")"+z(B,"+_y7*(","move",")");u="_x7*(_x3="+a+")";o="_y7*_x3";n="_x9";c="_y9";}else{s="_x6=("+s+")";q="_y6=("+q+")";u=a=="1"?"("+u+")":"("+u+")*(_x3="+a+")";o=a=="1"?"("+o+")":"("+o+")*_x3";}if(i){return["if( ((_x1=((",s,")-mx)/(",u,"))*_x1+(_y1=((",q,")-my)/(",o,"))*_y1) < 1 ){","_x1=(p+__atan2(_x1,_y1));","if( ((_x2=(",n,")%p2)<0?(_x2=p2-_x2):_x2) >","((_y2=(",c,")%p2)<0?(_y2=p2-_y2):_y2) ){","if(_x1 >= _x2 || _x1<=_y2 )return x;","}else{","if(_x1 >= _x2 && _x1<=_y2 )return x;","}","}"].join("");}else{return[this.moveTo(s,q),this.ellipse("_x6","_y6",u,o,n,c,1),this.close()].join("");}}},shapedRect:function(n,l,o,i,a){var u=this.style;var s=this.getX,q=this.getY,d=this.checkX,c=this.checkY;function j(){if(s(u,"","scale","","1")!="1"){n=[s(u,"dzw*(","offset",")+"),"(",n,")","+",s(u,"(","center",")","0.5"),"*(_x3=",o,")",s(u,"*(1-(_x4=","scale","))"),s(u,"+_x3*(","move",")")].join("");o="_x3*_x4";}else{n=[s(u,"dzw*(","offset",")+"),"(",n,")",s(u,"+(_x3="+o+")*(","move",")")].join("");o=d(u,"move","_x3",o);}if(q(u,"","scale","","1")!="1"){l=[q(u,"dzh*(","offset",")+"),"(",l,")","+",q(u,"(","center",")","0.5"),"*(_y3=",i,")",q(u,"*(1-(_y4=","scale","))"),q(u,"+_y3*(","move",")")].join("");i="_y3*_y4";}else{l=[q(u,"dzh*(","offset",")+"),"(",l,")",q(u,"+(_y3="+i+")*(","move",")")].join("");i=c(u,"move","_y3",i);}}switch(u.shape){case"rect":default:if(!u.rotate){j();if(a){return["if( (_x9 = mx - (",n,"))>=0 && _x9<(",o,")&&","    (_y9 = my - (",l,"))>=0 && _y9<(",i,")) return x;",].join("");}return this.rect(n,l,o,i);}else{return["_x9=(_x8=(_x6=",s(u,"(","center",")","0.5"),"*(_x3=",o,"))*(",s(u,"(1-(_x4=","scale","))","0"),"-1))+_x3",d(u,"scale","*_x4"),";","_y9=(_y8=(_y6=",q(u,"(","center",")","0.5"),"*(_y3=",i,"))*(",q(u,"(1-(_y4=","scale","))","0"),"-1))+_y3",c(u,"scale","*_y4"),";",this.moveTo("(_cr=__cos(_t="+u.rotate+"))*_x8-(_sr=__sin(_t))*_y8+(_x5="+s(u,"(","offset",")+")+n+"+_x6)","_sr*_x8+_cr*_y8+(_y5="+q(u,"(","offset",")+")+l+"+_y6)"),this.lineTo("_cr*_x9-_sr*_y8+_x5","_sr*_x9+_cr*_y8+_y5"),this.lineTo("_cr*_x9-_sr*_y9+_x5","_sr*_x9+_cr*_y9+_y5"),this.lineTo("_cr*_x8-_sr*_y9+_x5","_sr*_x8+_cr*_y9+_y5"),this.close()].join("");}case"circle":j();if(a){return["if( (_x9 = mx - (",n,"))>=0 && _x9<(",o,")&&","    (_y9 = my - (",l,"))>=0 && _y9<(",i,")) return x;",].join("");}return u.pie?[this.moveTo("_x6="+n+"+(_x5=0.5*("+o+"))","_y6="+l+"+(_y5=0.5*("+i+"))"),this.ellipse("_x6","_y6","_x5","_y5",s(u,"","range",""),q(u,"","range","")),this.close()].join(""):[this.ellipse(n+"+(_x5=0.5*("+o+"))",l+"+(_y5=0.5*("+i+"))","_x5","_y5",s(u,"","range",""),q(u,"","range","")),this.close()].join("");break;case"polygon":if(u.frames){}else{return["_x3=((_x2=",q(u,"","range","","2*p"),")-(_x1=",s(u,"","range","","0"),"))/(",u.steps||10,");v=_x1;",this.moveTo("(_x4="+n+")+__sin(_x1)*(_x5="+o+")","(_y4="+l+")+__cos(_x1)*(_y5="+i+")"),"for(v=_x1+_x3;v<_x2;v+=_x3){",this.lineTo("_x4+__sin(_x1)*_x5","_y4+__cos(_x1)*_y5"),"}",this.close()].join("");}break;case"math":if(u.frames){}else{j();return["_x7=((_x6=",q(u,"","range","","2*p"),")-(_x5=",s(u,"","range","","0"),"))/(",u.steps||10,");v=_x5;",this.moveTo("(_x8="+n+")+"+s(u,"(","path",")","0")+"*(_x9="+o+")","(_y8="+l+")+"+q(u,"(","path",")","0")+"*(_y9="+i+")"),"for(v=_x5+_x7;v<_x6;v+=_x7){",this.lineTo("_x8"+s(u,"+(","path",")*_x9"),"_y8"+q(u,"+(","path",")*_y9")),"}",this.close()].join("");}break;}return"";},$endDraw:function(){if(this.mousemode){return this.$endMouse();}if(this.statemode){return this.$endState();}var a=this.style;if(a){if(a.isshape){return this.$endShape();}if(a.isfont){return this.$endFont();}}return"";},serializeStyleState:function(j){var i=[],d,c,a,l;if(!j.$stylelist){return"";}i.push("$storelist:_n=[",Array(j.$stylelist.length).join("[],"),"[]]");i.push(",$storelut:{");d=j.$storelut;l=1;for(a in d){i.push(--l?",":"","0x",parseInt(a).toString(16),":_n[",d[a],"]");}i.push("},$speedlut:{");d=j.$speedlut;l=1;for(a in d){i.push(--l?",":"","0x",parseInt(a).toString(16),":",d[a]);}i.push("},$overlaylut:{");d=j.$overlaylut;l=1;for(a in d){i.push(--l?",":"","0x",parseInt(a).toString(16),":0x",parseInt(d[a]).toString(16));}i.push("}");return i.join("");},beginState:function(a,m,j,c,q){var t=[this.beginShape(a.$shadow||a)];this.statemode=1;this.statethis=m;this.stateargs=c;this.statefunc=j;this.statedyns=q||[];this.statedyns.push("t","x");var o=a.$stylelist,l,d;if(!o||!o.length){return t.join("");}t.push("_storelut = _s.$storelut, _storelist = _s.$storelist,_overlaylut = _s.$overlaylut,","_translut = apf.draw.stateTransition, _speedlut = _s.$speedlut ;\n");for(l=0,d=o.length;l<d;l++){t[t.length]="_storelist["+l+"].length=";}t[t.length]="0;";return t.join("");},drawState:function(c,l){var q=[],w,n,m,u=this.style.$stylelist,o;if(!u||!u.length){for(n=2,m=arguments.length;n<m;n++){q.push(arguments[n]);}return this.statefunc.apply(this.statethis,q);}var z=["if((_t=",c,")&0x0f000000){","if((t=(n-(",l,"))*(_speedlut[_t]||100000))>1){","_t=",c,"=_translut[_t],",l,"=n,t=0;","}","if(_t&0x0f000000)_anim=1,nt=1-t;","}"];for(n=2,m=arguments.length;n<m;n++){q.push(w="_s"+(n-1));z.push(w,"=",arguments[n],(n!=m-1)?",":";");}o=this.statedyns.join(",");w=q.join(",");z.push("if(_st=_storelut[_t]){","_st.push(",o,",",w,");","while(_t=_overlaylut[_t]){","if(_st = _storelut[_t]){_st.push(",o,",",w,");}","};","};","if(!_st){",this.statefunc.apply(this.statethis,q),"}\n");return z.join("");},$endState:function(){this.statemode=0;var c=this.style,C=[this.$endDraw()];var B=c.$stylelist,w,u,t,q,o=this.stateargs+this.statedyns.length,A=[],z=[];if(!B||!B.length){return C.join("");}for(w=this.statedyns.length;w<o;w++){A.push("_su[_sv+"+w+"]");}for(w=0;w<this.statedyns.length;w++){z.push(this.statedyns[w]+"=_su[_sv+"+w+"]");}z=z.join(",");for(w=0,u=B.length;w<u;w++){c=B[w];C[C.length]=["if((_st=(_su=_storelist["+w+"]).length)>0){","_sv=0,",z,";",this.beginShape(c),"for(_sv=0;_sv<_st;_sv+=",o,"){",z,",nt = 1-t;",this.statefunc.apply(this.statethis,A),"}",this.$endDraw(),"}else _styles[",c._id,"]._path=[];\n"].join("");}return C.join("");},beginFont:function(c,o,j,a,d,n){if(!c||o===undefined){return"document.title='beginFont Failed';";}var i=this.l,m=i._htmljoin,q=[this.$endDraw()];this.style=c;c._id=i._styles.push(c)-1;j=j!==undefined?j/i.ds:0;a=a!==undefined?a/i.ds:0;d=d!==undefined?d/i.ds:0;n=n!==undefined?n/i.ds:0;if(parseInt(c.left)!=c.left){this.mx="+("+c.left+")"+(j?"-"+j:"");}else{this.mx="+"+(c.left-j);}if(parseInt(c.top)!=c.top){this.my="+("+c.top+")"+(a?"-"+a:"");}else{this.my="+"+(c.top-a);}this.dynsize=(parseInt(c.size)!=c.size);c._txtdiv=["<div style='",(c.vertical)?"filter: flipv() fliph(); writing-mode: tb-rl;":"","position:absolute;cursor:default;overflow:hidden;left:0;top:0;display:none;font-family:",c.family,";color:",c.color,";font-weight:",c.weight,";",";font-size:",this.dynsize?10:c.size,"px;",(c.stroke!==undefined)?"border:1px solid "+c.stroke+";":"",(c.fill!==undefined)?"background:"+c.fill+";":"",(c.width!==undefined)?"width:"+c.width+"px;":"",(c.height!==undefined)?"height:"+c.height+"px;":"",(c.style!==undefined)?"font-style:"+c.style+";":"",(c.align!==undefined)?"text-align:"+c.align+";":"","'>-</div>"].join("");m.push("<div onmousedown='return false' style='cursor:default;position:absolute;left:",j,"px;top:",a,"px;width:",i.width-(d+j),"px;height:",i.height-(n+a),"px;overflow:hidden;'></div>");q.push("_s=_styles[",c._id,"],_tn=_s._txtnodes,_tc = 0;\n");q.push("if((_l=(",o,")) > _tn.length-_tc)apf.draw.$allocText(_s,_l);");return q.join("");},text:function(a,i,d){var c=((this.l.ds>1)?"/"+this.l.ds:"");return["if( (_t=_tn[_tc++]).s!=(_v=",d,") )_t.v.nodeValue=_t.s=_v;","if(_t.x!=(_v=__round(",a,")))_t.n.style.left=_t.x=(_v",c,this.mx,")+'px';","if(_t.y!=(_v=__round(",i,")))_t.n.style.top=_t.y=(_v",c,this.my,")+'px';",this.dynsize?["if(_t.sz!=(_v=__round(",this.style.size,"))&&_v>0)_t.n.style.fontSize=_t.sz=_v+'px';"].join(""):""].join("");},$allocText:function(d,j){var c,a=d._domnode,i=d._txtnodes;if(!i.length){a.innerHTML=Array(j+1).join(d._txtdiv);}else{a.insertAdjacentHTML("beforeend",Array(j+1).join(d._txtdiv));}while(j-->0){c=a.childNodes[i.length];i.push({x:-10000000000,y:-10000000000,n:c,v:c.firstChild,sz:-1,s:null});}},$endFont:function(){this.last=this.style._id;this.style=0;this.mx="",this.my="";return"_s._txtcount = _tc;";},$finalizeFont:function(c){var a=["if((_lc=(_s=_styles[",c._id,"])._txtused)>","(_tc=_s._txtcount)){_tn=_s._txtnodes;","for(;_lc>_tc;)_tn[--_lc].n.style.display='none';","_s._txtused=_tc;","} else if(_lc<_tc) {_tn=_s._txtnodes;","for(;_lc<_tc;)_tn[_lc++].n.style.display='block';","_s._txtused=_tc;","}\n"];return a.join("");},colors:apf.color.colors};apf.date=(function(){return{masks:{"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},i18n:{beginWeekday:1,dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNumbers:{Sun:0,Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6,Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6},monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],monthNumbers:{Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}}};})();apf.date.dateFormat=(function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,c=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,i=/[^-+\dA-Z]/g,d=function(l,j){l=String(l);j=j||2;while(l.length<j){l="0"+l;}return l;};return function(t,I,C){var n=apf.date;if(arguments.length==1&&(typeof t=="string"||t instanceof String)&&!/\d/.test(t)){I=t;t=undefined;}t=t?new Date(t):new Date();if(isNaN(t)){return"NaN";}I=String(n.masks[I]||I||n.masks["default"]);if(I.slice(0,4)=="UTC:"){I=I.slice(4);C=true;}var F=C?"getUTC":"get",z=t[F+"Date"](),j=t[F+"Day"](),u=t[F+"Month"](),B=t[F+"FullYear"](),E=t[F+"Hours"](),w=t[F+"Minutes"](),G=t[F+"Seconds"](),A=t[F+"Milliseconds"](),l=C?0:t.getTimezoneOffset(),q={d:z,dd:d(z),ddd:n.i18n.dayNames[j],dddd:n.i18n.dayNames[j+7],m:u+1,mm:d(u+1),mmm:n.i18n.monthNames[u],mmmm:n.i18n.monthNames[u+12],yy:String(B).slice(2),yyyy:B,h:E%12||12,hh:d(E%12||12),H:E,HH:d(E),M:w,MM:d(w),s:G,ss:d(G),l:d(A,3),L:d(A>99?Math.round(A/10):A),t:E<12?"a":"p",tt:E<12?"am":"pm",T:E<12?"A":"P",TT:E<12?"AM":"PM",Z:C?"UTC":(String(t).match(c)||[""]).pop().replace(i,""),o:(l>0?"-":"+")+d(Math.floor(Math.abs(l)/60)*100+Math.abs(l)%60,4),S:["th","st","nd","rd"][z%10>3?0:(z%100-z%10!=10)*z%10]};return I.replace(a,function(m){return m in q?q[m]:m.slice(1,m.length-1);});};})();apf.date.getDateTime=function(t,z){var j=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g;var n=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC:)(?:[-+]\d{4})?)\b/g;var a=0;var c,w=new Date().getFullYear(),i=1,q=1,l=12,o=0,B=0;var A=apf.date.i18n;if(!z){throw new Error(apf.formatErrorString(0,null,"date-format","Date format is null"));}z=z.replace(n,"");var u=z.replace(j,function(E,D,C){var d=t.substring(C+a,C+a+E.length);switch(E){case"d":case"m":case"h":case"H":case"M":case"s":if(!/[\/, :\-](d|m|h|H|M|s)$|^(d|m|h|H|M|s)[\/, :\-]|[\/, :\-](d|m|h|H|M|s)[\/, :\-]/.test(z)){throw new Error(apf.formatErrorString(0,null,"date-format","Dates without leading zero needs separators"));}var s=parseInt(t.substring(C+a,C+a+2));if(s.toString().length==2){a++;}return E=="d"?q=s:(E=="m"?i=s:(E=="M"?o=s:(E=="s"?B=s:l=s)));case"dd":return q=d;case"dddd":a+=A.dayNames[A.dayNumbers[d.substring(0,3)]+7].length-4;break;case"mm":return i=d;case"mmm":return i=A.monthNumbers[d]+1;case"mmmm":var m=A.monthNumbers[d.substring(0,3)];a+=A.monthNames[m+12].length-4;return i=m+1;case"yy":return w=parseInt(d)<70?"20"+d:d;case"yyyy":return w=d;case"hh":return l=d;case"HH":return l=d;case"MM":return o=d;case"ss":return B=d;case"'T'":case"'Z'":a-=2;break;}});return new Date(w,i-1,q,l,o,B);};Date.prototype.format=function(a,c){return apf.date.dateFormat(this,a,c);};Date.parse=function(c,a){return apf.date.getDateTime(c,a);};apf.xmldb=new (function(){this.xmlDocTag="a_doc";this.xmlIdTag="a_id";this.xmlListenTag="a_listen";this.htmlIdTag="id";this.disableRSB=false;var a=[];this.getElementById=function(j,i){if(!i){i=a[j.split("|")[0]];}if(!i){return false;}return i.selectSingleNode("descendant-or-self::node()[@"+this.xmlIdTag+"='"+j+"']");};this.getNode=function(i){if(!i||!i.getAttribute(this.htmlIdTag)){return false;}return this.getElementById(i.getAttribute(this.htmlIdTag).split("|",2).join("|"));};this.getNodeById=function(l,j){var i=l.split("|");i.pop();return this.getElementById(i.join("|"),j);};this.getDocumentById=function(i){return a[i];};this.getDocument=function(i){return a[i.getAttribute(this.xmlIdTag).split("|")[0]];};this.getID=function(i,j){return i.getAttribute(this.xmlIdTag)+"|"+j.$uniqueId;};this.getElement=function(o,q){var l=o.childNodes;for(var m=0,n=0;n<l.length;n++){if(l[n].nodeType!=1){continue;}if(m++==q){return l[n];}}};this.setModel=function(i){apf.nameserver.register("model",i.data.ownerDocument.documentElement.getAttribute(this.xmlDocTag),i);};this.findModel=function(i){return apf.nameserver.get("model",i.ownerDocument.documentElement.getAttribute(this.xmlDocTag));};this.getXmlId=function(i){return i.getAttribute(this.xmlIdTag)||this.nodeConnect(apf.xmldb.getXmlDocId(i),i);};this.getHtmlNode=function(i,j){if(i&&i.nodeType==1&&i.getAttribute(this.xmlIdTag)){return j.$findHtmlNode(i.getAttribute(this.xmlIdTag)+"|"+j.$uniqueId);}return null;};this.findHtmlNode=function(i,j){do{if(i.nodeType==1&&i.getAttribute(this.xmlIdTag)){return j.$findHtmlNode(i.getAttribute(this.xmlIdTag)+"|"+j.$uniqueId);}if(i==j.xmlRoot){return null;}i=i.parentNode;}while(i&&i.nodeType!=9);return null;};this.findXmlNode=function(i){if(!i){return false;}var j;while(i&&i.nodeType==1&&(i.tagName.toLowerCase()!="body"&&!(j=i.getAttribute(this.htmlIdTag))||(j||(j=i.getAttribute(this.htmlIdTag)))&&j.match(/^q/))){if(i.host&&i.host.$ext==i){return i.host.xmlRoot;}i=i.parentNode;}if(!i||i.nodeType!=1){return false;}if(i.tagName.toLowerCase()=="body"){return false;}return this.getNode(i);};this.getXml=apf.getXml;this.nodeCount={};this.nodeConnect=function(l,j,n,q){if(!this.nodeCount[l]){this.nodeCount[l]=0;}var m;m=j.getAttribute(this.xmlIdTag)||j.setAttribute(this.xmlIdTag,(m=l+"|"+ ++this.nodeCount[l]))||m;if(!q){return m;}var i=m+"|"+q.$uniqueId;if(n){n.setAttribute(this.htmlIdTag,i);}return i;};this.addNodeListener=function(j,l,m){var i=j.getAttribute(this.xmlListenTag);m||(m=String(l.$uniqueId));if(!i||i.indexOf(m)==-1){j.setAttribute(this.xmlListenTag,i?i+";"+m:m);}return j;};this.removeNodeListener=function(n,s,t){var m=n.getAttribute(this.xmlListenTag);var j=(m?m.split(";"):[]);if(!t){t=s.$uniqueId;}for(var q=[],l=0;l<j.length;l++){if(j[l]!=t){q.push(j[l]);}}n.setAttribute(this.xmlListenTag,q.join(";"));return n;};this.setTextNode=apf.setTextNode=function(j,m,i,n){var l;if(i){l=j.selectSingleNode(i);if(!l){return;}j=l.nodeType==1?l:null;}if(j||!l){l=j.selectSingleNode("text()");if(!l){l=j.appendChild(j.ownerDocument.createTextNode(""));}}if(n){n.extra.oldValue=l.nodeValue;}l.nodeValue=m;this.applyChanges("text",l.parentNode,n);this.applyRSB(["setTextNode",j,m,i],n);};this.setAttribute=apf.setAttribute=function(l,j,m,i,n){(i?l.selectSingleNode(i):l).setAttribute(j,m);this.applyChanges("attribute",l,n);this.applyRSB(["setAttribute",l,j,m,i],n);};this.removeAttribute=apf.removeAttribute=function(l,j,i,m){if(m){m.name=j;}(i?l.selectSingleNode(i):l).removeAttribute(j);this.applyChanges("attribute",l,m);this.applyRSB(["removeAttribute",l,j,i],m);};this.replaceNode=apf.replaceNode=function(l,m,j,n){if(j){m=m.selectSingleNode(j);}if(n){n.oldNode=m;n.xmlNode=l;}var i=m.parentNode;i.replaceChild(l,m);this.copyConnections(m,l);this.applyChanges("replacechild",l,n);this.applyRSB(["replaceChild",m,l,j],n);return l;};this.addChildNode=apf.addChildNode=function(q,o,j,l,s){var n=q.insertBefore(q.ownerDocument.createElement(o),l);for(var m=0;m<j.length;m++){n.setAttribute(j[m][0],j[m][1]);}if(s){s.extra.addedNode=n;}this.applyChanges("add",n,s);this.applyRSB(["addChildNode",q,o,j,l],s);return n;};this.appendChild=apf.appendChild=function(n,m,j,q,i,o){if(q&&n.selectSingleNode(m.tagName)){return false;}if(o){this.cleanNode(m);}if(n.ownerDocument.importNode&&n.ownerDocument!=m.ownerDocument){m=n.ownerDocument.importNode(m,true);}if(i){var l=[];var n=apf.createNodeFromXpath(n,i,l);if(l.length){n.appendChild(m);while(l.length){if(n==l.pop()&&l.length){n=n.parentNode;}}}}else{if(m.parentNode){this.removeNode(m);}}n.insertBefore(m,j);this.applyChanges("add",m,o);this.applyRSB(["appendChild",n,m.xml,j,q,i],o);return m;};this.moveNode=apf.moveNode=function(m,l,j,i,n){if(!n){n={extra:{}};}n.extra.oldParent=l.parentNode;n.extra.beforeNode=l.nextSibling;n.extra.parent=(i?m.selectSingleNode(i):m);this.applyChanges("move-away",l,n);this.applyRSB(["moveNode",m,l,j,i],n);if(!apf.isWebkit&&apf.xmldb.getXmlDocId(l)!=apf.xmldb.getXmlDocId(m)){l.removeAttributeNode(l.getAttributeNode(this.xmlIdTag));this.nodeConnect(apf.xmldb.getXmlDocId(m),l);}if(apf.isWebkit&&m.ownerDocument!=l.ownerDocument){l=m.ownerDocument.importNode(l,true);}n.extra.parent.insertBefore(l,j);this.applyChanges("move",l,n);};this.removeNode=apf.removeNode=function(j,i,m){if(i){j=j.selectSingleNode(i);}if(m){m.extra.parent=j.parentNode;m.extra.removedNode=j;m.extra.beforeNode=j.nextSibling;}this.applyRSB(["removeNode",j,i],m);this.applyChanges("remove",j,m);var l=j.parentNode;l.removeChild(j);this.applyChanges("redo-remove",j,null,l);};this.removeNodeList=apf.removeNodeList=function(j,o){for(var m=[],l=0;l<j.length;l++){if(o){m.push({pNode:j[l].parentNode,removedNode:j[l],beforeNode:j[l].nextSibling});}this.applyChanges("remove",j[l],o);var n=j[l].parentNode;n.removeChild(j[l]);this.applyChanges("redo-remove",j[l],null,n);}if(o){o.extra.removeList=m;}this.applyRSB(["removeNodeList",j,null],o);};var d={},c;this.$hasQueue=false;this.applyChanges=function(C,n,I,o){if(typeof apf.offline!="undefined"&&apf.offline.models.enabled&&apf.offline.models.realtime){var q=apf.nameserver.get("model",apf.xmldb.getXmlDocId(n));if(q){apf.offline.models.markForUpdate(q);}}if(I&&!I.xmlNode){I.xmlNode=n;}var D=o;var t=(n.nodeType==1?n:n.parentNode);if(!this.delayUpdate&&"|remove|move-away|".indexOf("|"+C+"|")>-1){this.notifyQueued();}var s,w,u,F,E,m,G,B,l,z;while(t&&t.nodeType!=9){s=t.getAttribute(this.xmlListenTag);if(s){u=s.split(";");for(F=0;F<u.length;F++){w=u[F];if(w.charAt(0)=="p"){w=w.split("|");B=apf.all[w[1]];if(B){var q=apf.all[w[3]];var A=q.$propBinds[w[1]][w[2]].root;B.$execProperty(w[2],A?q.data.selectSingleNode(A):q.data);}continue;}m=d[w];if(!m){d[w]=m=[];}if("|update|attribute|text|".indexOf("|"+C+"|")>-1){z=false;for(E=0;E<m.length;E++){if(m[E]&&n==m[E][1]&&"|update|attribute|text|".indexOf("|"+m[E][0]+"|")>-1){m[E]=null;z=true;continue;}}m.push(["update",n,t,I,D]);l=true;continue;}if(!this.delayUpdate&&"|remove|move-away|add|".indexOf("|"+C+"|")>-1){B=apf.all[w];if(B){B.$xmlUpdate(C,n,t,I,D);}}else{m.push([C,n,t,I,D]);l=true;}}}t=t.parentNode||o;if(t==o){o=null;}}if(I&&!this.delayUpdate){apf.xmldb.notifyQueued();}else{if(l){clearTimeout(c);apf.xmldb.notifyQueued();}}};this.notifyQueued=function(){this.$hasQueue=false;clearTimeout(c);for(var m in d){var n=d[m];var l=apf.all[m];if(!l||!n){continue;}for(var j=0;j<n.length;j++){if(!n[j]){continue;}l.$xmlUpdate.apply(l,n[j]);}}d={};};this.notifyListeners=function(m){var l=m.getAttribute(apf.xmldb.xmlListenTag);if(l){l=l.split(";");for(var i=0;i<l.length;i++){apf.all[l[i]].$xmlUpdate("synchronize",m,m);}}};this.applyRSB=function(l,n){if(apf.xmldb.disableRSB){return;}var m=l[1]&&l[1].length&&l[1][0]||l[1],i=apf.xmldb.getXmlDocId(m),j=apf.nameserver.get("model",i);if(!j&&apf.isO3){j=self[i];}if(!j){if(!apf.nameserver.getAll("remove").length){return;}return;}if(!j.rsb){return;}if(n){j.rsb.queueMessage(l,j,n);}else{j.rsb.sendChange(l,j);}};this.copyConnections=function(j,i){try{i.setAttribute(this.xmlListenTag,j.getAttribute(this.xmlListenTag));}catch(l){}try{i.setAttribute(this.xmlIdTag,j.getAttribute(this.xmlIdTag));}catch(l){}};this.cleanNode=function(m){try{var l,j=m.selectNodes("descendant-or-self::node()[@"+this.xmlListenTag+"]");for(l=j.length-1;l>=0;l--){j[l].removeAttribute(this.xmlListenTag);}j=m.selectNodes("descendant-or-self::node()[@"+this.xmlIdTag+"]");for(l=j.length-1;l>=0;l--){j[l].removeAttribute(this.xmlIdTag);}j=m.selectNodes("descendant-or-self::node()[@"+this.xmlDocTag+"]");for(l=j.length-1;l>=0;l--){j[l].removeAttribute(this.xmlDocTag);}j=m.selectNodes("descendant-or-self::node()[@a_loaded]");for(l=j.length-1;l>=0;l--){j[l].removeAttribute("a_loaded");}}catch(n){}return m;};this.copy=this.getCleanCopy=apf.getCleanCopy=function(i){return apf.xmldb.cleanNode(i.cloneNode(true));};this.unbind=function(s){for(var u={},o=0;o<s.apf.all.length;o++){if(s.apf.all[o]&&s.apf.all[o].unloadBindings){u[s.apf.all[o].unloadBindings()]=true;}}for(var l=0;l<a.length;l++){if(!a[l]){continue;}var t=a[l].selectNodes("//self::node()[@"+this.xmlListenTag+"]");for(var o=0;o<t.length;o++){var n=t[o].getAttribute(this.xmlListenTag).split(";");for(var q=[],m=0;m<n.length;m++){if(!u[n[m]]){q.push(n[m]);}}if(q.length!=n.length){t[o].setAttribute(this.xmlListenTag,q.join(";"));}}}};this.getXmlDocId=function(l,i){var m=l.ownerDocument.documentElement;if(!apf.isChildOf(m,l)){m=l;}var j=(m||l).getAttribute(this.xmlDocTag)||a.indexOf(m||l.ownerDocument||l);if(j&&j>-1){return j;}j=a.push(m||l.ownerDocument||l)-1;if(m){m.setAttribute(this.xmlDocTag,j);}if(i){apf.nameserver.register("model",j,i);}return a.length-1;};});apf.resize=function(){this.scales={scalex:false,scaley:false,scaleratio:false,dwidth:0,dheight:0,snap:false,gridW:48,gridH:48};this.htmlElement;var a=[];this.init=function(){a=[new apf.resize.square("top","left",this),new apf.resize.square("top","middle",this),new apf.resize.square("top","right",this),new apf.resize.square("middle","left",this),new apf.resize.square("middle","right",this),new apf.resize.square("bottom","left",this),new apf.resize.square("bottom","middle",this),new apf.resize.square("bottom","right",this)];};this.grab=function(c,d){this.htmlElement=c;this.scales=d;if(!a.length){this.init();}this.show();};this.hide=function(){for(var d=0,c=a.length;d<c;d++){a[d].visible=false;a[d].repaint();}};this.show=function(){var o=this.scales.scalex;var n=this.scales.scaley;var m=this.scales.scaleratio;for(var d=0,c=a.length,j;d<c;d++){j=a[d];j.visible=o&&n?true:(n&&!o?(j.posX=="middle"?true:false):(o&&!n?(j.posY=="middle"?true:false):(m?((j.posY=="top"||j.posY=="bottom")&&j.posX!=="middle"?true:false):false)));j.repaint();}};this.destroy=function(){for(var c=0;c<a.length;c++){a[c].destroy();}};};apf.resize.square=function(i,j,c){this.visible=true;this.posX=j;this.posY=i;var d=0;var a=this;this.htmlElement=c.htmlElement.parentNode.appendChild(document.createElement("div"));apf.setStyleClass(this.htmlElement,"square");this.repaint=function(){if(this.visible){var o=c.htmlElement;this.htmlElement.style.display="block";var w=parseInt(o.style.width)+apf.getDiff(o)[0];var q=parseInt(o.style.height)+apf.getDiff(o)[1];var A=parseInt(o.style.top);var m=parseInt(o.style.left);var z=this.htmlElement.offsetWidth;var s=this.htmlElement.offsetHeight;var B=i=="top"?A-d-s:i=="middle"?A+q/2-s/2:A+q+d;var n=j=="left"?m-d-z:j=="middle"?m+w/2-z/2:m+w+d;var u=(i=="middle"?"w-resize":(j=="middle"?"n-resize":(i+j=="topleft"||i+j=="bottomright")?"nw-resize":"ne-resize"));this.htmlElement.style.top=(B-1)+"px";this.htmlElement.style.left=(n-1)+"px";this.htmlElement.style.cursor=u;}else{var z=this.htmlElement.offsetWidth;this.htmlElement.style.display="none";}};this.destroy=function(){apf.destroyHtmlNode(this.htmlElement);};this.htmlElement.onmouseover=function(l){apf.setStyleClass(a.htmlElement,"squareHover");};this.htmlElement.onmouseout=function(l){apf.setStyleClass(a.htmlElement,"",["squareHover"]);};this.htmlElement.onmousedown=function(X){X=(X||event);var u=c.htmlElement,K=X.clientX,G=X.clientY,N=u.parentNode.offsetTop,W=u.parentNode.offsetLeft,C=c.scales.dwidth,V=c.scales.dheight,M=c.scales.snap,m=c.scales.gridH,T=c.scales.gridW,Q=apf.flow.isBlock(u),I=Q.other.ratio,s=a.posX,q=a.posY,O,J,F,o,B,A,n,E,P=parseInt(u.style.left),D=parseInt(u.style.top),z=parseInt(u.style.width),R=parseInt(u.style.height),U=false;c.onresizedone(z,R,D,P);if(X.preventDefault){X.preventDefault();}document.onmousemove=function(w){w=(w||event);B=w.clientX-K;A=w.clientY-G;var l=w.shiftKey,t=I;if(l){if(s=="right"&&q=="bottom"){O=z+B;J=O/t;o=P;F=D;}else{if(s=="right"&&q=="top"){O=z+B;J=O/t;o=P;F=D-B/t;}else{if(s=="left"&&q=="bottom"){O=z-B;J=O/t;o=P+B;F=D;}else{if(s=="left"&&q=="top"){O=z-B;J=O/t;o=P+B;F=D+B/t;}}}}if(O>=C&&J>=V){O=n=Math.max(C,O);J=E=Math.max(V,J);}else{O=n;J=E;return false;}}else{O=s=="right"?z+B:(s=="left"?z-B:z);J=q=="bottom"?R+A:(q=="top"?R-A:R);o=s=="right"?P:(s=="left"?Math.min(P+z-C,P+B):P);F=q=="bottom"?D:(q=="top"?Math.min(D+R-V,D+A):D);O=Math.max(C,O);J=Math.max(V,J);}if(M){o=Math.floor(o/T)*T;F=Math.floor(F/m)*m;O=Math.ceil(O/T)*T;J=Math.ceil(J/m)*m;}if(c.onresize){c.onresize(u,F,o,O,J);}c.show();U=true;};document.onmouseup=function(l){document.onmousemove=null;if(c.onresizedone&&U){c.onresizedone(O,J,F,o);Q.other.ratio=O/J;U=false;}};};};apf.queue={q:{},timer:null,add:function(c,a){this.q[c]=a;if(!this.timer){this.timer=$setTimeout("apf.queue.empty()");}},empty:function(d){clearTimeout(this.timer);this.timer=null;if(apf.layout&&apf.layout.$hasQueue){apf.layout.processQueue();}if(apf.xmldb&&apf.xmldb.$hasQueue){apf.xmldb.notifyQueued();}var c=this.q;for(var d in c){var a=c[d];if(a){delete c[d];a();}}}};apf.storage={modules:{},init:function(a){if(!a){a=this.autodetect();}var c=this.getProvider(a);apf.storage=apf.extend(c,this);apf.storage.init=null;return c;},getProvider:function(a){var c=apf.storage.modules[a];if(!c||typeof c!="object"){return false;}if(!c.isAvailable()){return false;}if(!c.initialized&&(!c.init||c.init()===false)){return false;}c.name=a;apf.extend(c,this.base);return c;},autodetect:function(){for(var a in this.modules){if(a=="memory"){continue;}if(this.modules[a].isAvailable()){return a;}}return this.modules.memory?"memory":null;},base:{namespace:"default",isValidKeyArray:function(a){return(!a||!a.join)?false:/^[0-9A-Za-z_\.\-]*$/.test(a.join(""));},isValidKey:function(a){return(a===null||a===undefined)?false:/^[0-9A-Za-z_\.\-]*$/.test(a);},getAllPairs:function(j,c){var l=this.getKeys(j);if(!l||!l.length){return;}var a=this.getMultiple(l,j);for(var d=0;d<l.length&&a;d++){if(a[d]){c[l[d]]=a[d];}}return l.length;}}};apf.selection=function(c,F,o){c=c||window;F=F||window.document;this.current=null;var w="function",B="undefined",l="character",G="Text",D="Control",t="None",m,i=(o&&typeof o.$visualFocus==w),n=this;this.get=function(){return apf.w3cRange?c.getSelection():F.selection;};this.set=function(){if(!this.current){return null;}if(apf.w3cRange){this.moveToBookmark(this.current);return this.current;}try{if(i){o.$visualFocus();}else{c.focus();}this.current.select();}catch(M){}if(i){o.$visualFocus();}else{c.focus();}return this.current;};this.cache=function(N){if(apf.w3cRange){if(N){this.current=this.getBookmark();}return this;}var M=F.selection;this.current=M.createRange();this.current.type=M.type;if(this.current.type==G&&this.current.text==""&&!m){m=$setTimeout(this.cache,0);}else{clearTimeout(m);m=null;}return this;};this.getRange=function(){var M=this.get(),N;try{if(M){N=M.rangeCount>0?M.getRangeAt(0):(M.createRange?M.createRange():F.createRange());}}catch(O){}if(!N){N=apf.w3cRange?F.createRange():F.body.createTextRange();}return N;};this.setRange=function(N){if(apf.w3cRange){var M=this.get();if(M){M.removeAllRanges();M.addRange(N);}}else{try{N.select();}catch(O){}}return this;};var q,z="BR|IMG|HR|INPUT",J="P|BUTTON|TEXTAREA|SELECT|DIV|H[1-6]|ADDRESS|PRE|OL|UL|LI|TABLE|TBODY|TR|DT|DE|TD|SUB|SUP",C="SELECT|BUTTON|TEXTAREA",d=new RegExp("^(?:"+J+")$","i"),A=new RegExp("^(?:"+C+")$","i"),u=new RegExp("^(?:"+z+")$","i");this.inline=z;this.block=J;this.form=C;function E(M){return(apf.isOpera||apf.isIE)?M:M.replace(/\r\n/g," ");}function a(M){return String(apf.isIE?M.nodeType==3?M.nodeValue:M.innerText:M.textContent);}function K(M){return String(M.nodeType==3?apf.isIE?M.nodeValue:M.textContent:M.innerHTML);}function I(O,R){var T,P=0,Q="",N=0,M=O.childNodes.length;for(;N<M;N++){T=O.childNodes[N];if(A.test(T.nodeName)){Q+="<->"+(apf.isIE?"":E(a(T)).replace(/./gi," "))+"</->";}else{if(d.test(T.nodeName)){Q+="<+>"+(apf.isIE?"":E(a(T)).replace(/./gi," "))+"</+>";}else{if(u.test(T.nodeName)){Q+="<>";}else{if(T.nodeName=="SPAN"&&(P=_4.attr(T,"scaytid"))){Q+="<"+P+">"+E(K(T))+"</>";}else{Q+=E(K(T));}}}}}return Q;}function s(Q,P,M,N){var O;N=N||this.containerNode;P=P?new RegExp("^(?:"+P+")$"):null;while(Q&&Q!=N){if(P&&P.test(Q.nodeName.toUpperCase())){return Q;}if(M){for(O in M){if(Q.getAttribute(O)!==null&&M[O]===null){return Q;}if((M[O]!==null&&Q.getAttribute(O)!==null&&!(Q.getAttribute(O)===false))?!M[O]:M[O]){return Q;}}}Q=Q.parentNode;}return false;}this.getBookmark=function(P,Q){var V=-16777215,X=this.getRange(),ag=apf.getViewPort(c),ai=F.body,Z={scrollX:ag.x,scrollY:ag.y,collapse:0,start:0},ad=this.get();q=null;if(P=="simple"){Z.rng=X;return Z;}if(!apf.w3cRange){if(X.item){var ah=X.item(0),aa=ai.getElementsByTagName(ah.nodeName),ae=0,ac=aa.length;for(;ae<ac;ae++){if(ah==aa[ae]){return !(af=ae);}}return apf.extend(Z,{tag:ah.nodeName,index:af});}var O,ak,af,aj;O=X.duplicate();O.moveToElementText(ai);O.collapse(true);ak=Math.abs(O.move(l,V));O=X.duplicate();O.collapse(true);af=Math.abs(O.move(l,V));O=X.duplicate();O.collapse(false);var R=0;aj=O.duplicate();aj.moveEnd(l,1);aj.collapse(false);var U=aj.parentElement();if(d.test(U.nodeName)){if(s(O.parentElement(),J,null,ai)!=U){q=U;}}return apf.extend(Z,{start:af-ak-R,length:Math.abs(O.move(l,V))-af});}var Y=ad.anchorNode;while(Y&&(Y.nodeType!=1)){Y=Y.parentNode;}if(Y&&Y.nodeName=="IMG"){return Z;}if(!ad){return null;}var T,N=X.startContainer,ab=ad.anchorNode,M=Q?Q(ab):null;if(ad.isCollapsed){Z.collapse=1;Y=s(ab,J)||ai;if(ab.nodeType==3){T=F.createTreeWalker(Y,NodeFilter.SHOW_TEXT,null,false);while(aa=T.nextNode()){if(aa==ab){Z.start=Z.start+ad.anchorOffset;break;}Z.start+=E(aa.nodeValue||"").length;}}else{if(ab!=Y){T=F.createTreeWalker(Y,NodeFilter.SHOW_ALL,null,false);while(aa=T.nextNode()){if(aa==ab){break;}Z.start+=E(aa.nodeValue||"").length;}}for(ae=0,ac=X.startOffset;ae<ac;ae++){Z.start+=parseInt(String(N.childNodes[ae].textContent).length);}}Z.end=Z.start;if(!M){Z.content=N.textContent||N.innerHTML;try{if(X.startOffset==0&&N.previousSibling&&(/IMG|BR|INPUT/.test(N.previousSibling.nodeName))){Z.br=N.previousSibling;}if(N.childNodes[X.startOffset-1]&&(/IMG|BR|INPUT/.test(N.childNodes[X.startOffset-1].nodeName))){Z.br=N.childNodes[X.startOffset-1];}}catch(ah){}}if(M&&X.startOffset==0){aa=M.previousSibling;while(aa&&((aa.nodeType==3&&aa.textContent=="")||(aa.nodeType!=3&&aa.innerHTML==""))){if(aa&&(/IMG|BR|INPUT/.test(aa.nodeName))){Z.br=aa;Z.br2=aa.nextSibling;break;}aa=aa.previousSibling;}}apf.extend(Z,{block:Y,node:N,offset:X.startOffset});return Z;}var W=[];Y=0;T=F.createTreeWalker(ai,NodeFilter.SHOW_TEXT,null,false);while((aa=T.nextNode())!=null){if(aa==N){W[0]=Y;}if(aa==X.endContainer){W[1]=Y;break;}Y+=E(aa.nodeValue||"").length;}apf.extend(Z,{start:W[0]+X.startOffset,end:W[1]+X.endOffset,block:ai});return Z;};this.moveToBookmark=function(X){var Z,N=this.get(),W=F.body,M=this.getRange();function Q(ab,ak){var ae,ai,ag,ad,ac,aa=0,ah={},af=-1,aj=F.createTreeWalker(X.block,NodeFilter.SHOW_TEXT,null,false);while(ae=aj.nextNode()){ag=ae.nodeValue||"";ad=E(ag).length;aa+=ad;if(X.collapse){if(aa>=ab){ai=s(ae,J)||W;}if(aa==ab){af=ai==X.block?1:0;}if(af==-1&&aa>ab||af==1){ah.endNode=ah.startNode=ae;ah.endOffset=ah.startOffset=ab-(aa-ad);return ah;}}else{if(aa>=ab&&!ah.startNode){ac=ab-(aa-ad);ah.startNode=ae;ah.startOffset=ab-(aa-ad);}if(aa>=ak){ah.endNode=ae;ah.endOffset=ak-(aa-ad);return ah;}}}return null;}if(!X){return false;}if(!apf.w3cRange){F.body.setActive();if(Z=X.rng){try{Z.select();}catch(V){}return true;}if(X.tag){Z=W.createControlRange();var O=F.getElementsByTagName(X.tag),R=0,P=O.length;for(;R<P;R++){if(R==X.index){Z.addElement(O[R]);}}}else{try{if(X.start<0){return true;}Z=N.createRange();if(q){Z.moveToElementText(q);Z.moveStart(l,-2);Z.expand(word);Z.collapse(false);}else{Z.moveToElementText(W);Z.collapse(true);Z.moveStart(l,X.start);Z.moveEnd(l,X.length);}}catch(T){return true;}}try{Z.select();}catch(V){}return true;}if(!N){return false;}Z=M.cloneRange();if(X.rng){N.removeAllRanges();N.addRange(X.rng);}else{if(typeof X.node!=B){var Y=false;if((X.node.nodeType==3&&X.node.parentNode!=null&&X.node.textContent==X.content)||(X.node.nodeType!=3&&X.node.innerHTML==X.content)){Z.setStart(X.node,X.offset);Z.collapse(true);Y=true;}if(typeof X.br!=B&&(/IMG|BR|INPUT/.test(X.br.nodeName))){if(X.br.nextSibling){Z.selectNode(X.br.nextSibling);Z.collapse(true);}else{Z.selectNode(X.br);Z.collapse(false);}Y=true;}if(Y){if(!apf.isOpera){N.removeAllRanges();}N.addRange(Z);W.focus();c.scrollTo(X.scrollX,X.scrollY);return;}}if(typeof X.start!=B&&typeof X.end!=B){try{var U=Q(X.start,X.end);if(U){Z.setStart(U.startNode,U.startOffset);Z.setEnd(U.endNode,U.endOffset);c.scrollTo(X.scrollX,X.scrollY);if(!apf.isOpera){N.removeAllRanges();}N.addRange(Z);}}catch(V){apf.console.error(V);}}return;}};this.getContent=function(R){if(typeof R!="string"){R="html";}var N=this.getRange(),M=this.get(),P,Q,U,T=F.body;if(R=="text"){return this.isCollapsed()?"":(N.text||(M.toString?M.toString():""));}if(this.isCollapsed()){return"";}if(typeof N.htmlText!=B){return N.htmlText;}var O,U=N.cloneContents();if(!U.childNodes.length){return"";}O=U.childNodes[0].ownerDocument.createElement("div");O.appendChild(U);return O.innerHTML;};this.setContent=function(N,Q){var M=this.getRange();if(!Q){N=apf.htmlCleaner.prepare(N,true);}if(M.insertNode){N+='<span id="__caret">_</span>';M.deleteContents();M.insertNode(this.getRange().createContextualFragment(N));var O=F.getElementById("__caret");var P=O.previousSibling;M=F.createRange();M.setStartBefore(O);M.setEndAfter(O);this.setRange(M);F.execCommand("Delete",false,null);if(O&&O.parentNode){O.parentNode.removeChild(O);}return P;}else{if(M.item){this.remove();M=this.getRange();}N=N.replace(/^<(\w+)/,'<$1 id="__caret"');M.pasteHTML(N);var P=F.getElementById("__caret");if(P){P.removeAttribute("id");return P;}}};var j={img:1,hr:1,li:1,table:1,tr:1,td:1,embed:1,object:1,ol:1,ul:1};this.getType=function(){var M=this.get();if(apf.isIE){return M.type;}else{var O="Text";if(M&&M.rangeCount==1){var N=M.getRangeAt(0);if(N.startContainer==N.endContainer&&(N.endOffset-N.startOffset)==1&&N.startContainer.nodeType==1&&j[N.startContainer.childNodes[N.startOffset].nodeName.toLowerCase()]){O=D;}}return O;}};this.getSelectedNode=function(){var N=this.getRange();if(!apf.isIE){if(!N){return F;}var M=this.get(),O=N.commonAncestorContainer;if(!N.collapsed){if(apf.isWebkit&&M.anchorNode&&M.anchorNode.nodeType==1){return M.anchorNode.childNodes[M.anchorOffset];}if(N.startContainer==N.endContainer){if(N.startOffset-N.endOffset<2){if(N.startContainer.hasChildNodes()){O=N.startContainer.childNodes[N.startOffset];}}}}return O;}return N.item?N.item(0):N.parentElement();};this.getParentNode=function(){switch(this.getType()){case D:if(apf.isIE){return this.getSelectedNode().parentElement;}else{return this.getSelectedNode().parentNode;}case t:return;default:var M=this.get();if(apf.isIE){return M.createRange().parentElement();}else{if(M){var N=M.anchorNode;while(N&&N.nodeType!=1){N=N.parentNode;}return N;}}break;}};this.selectNode=function(O){var M,N;while(O.nodeType==1&&O.firstChild){O=O.firstChild;}if(apf.isIE){M=this.get();if(!O){O=M.createRange().parentElement();}try{M.empty();}catch(Q){}try{N=F.body.createControlRange();N.addElement(O);}catch(Q){N=F.body.createTextRange();try{N.moveToElementText(O.nodeType!=1?O.parentNode:O);}catch(P){if(O.nodeValue){N.findText(O.nodeValue);}}}try{N.select();}catch(Q){}}else{N=this.getRange();if(O){N.selectNode(O);}M=this.get();M.removeAllRanges();M.addRange(N);}return this;};this.collapse=function(N){var M=this.getRange(),O;if(M.item){O=M.item(0);M=F.body.createTextRange();M.moveToElementText(O);}M.collapse(!!N);this.setRange(M);return this;};this.isCollapsed=function(){var N=this.getRange(),M=this.get();if(!N||N.item){return false;}return !M||N.boundingWidth==0||N.collapsed;};this.hasAncestorNode=function(P){var N,M=this.getRange();if(this.getType()==D||!apf.isIE){N=this.getSelectedNode();if(!N&&!apf.isIE){try{N=M.startContainer;}catch(O){}}}else{N=M.parentElement();}while(N){if(apf.isIE){if(N.tagName==P){return true;}else{if(N.nodeType==1&&N.tagName==P){return true;}}}N=N.parentNode;}return false;};this.moveToAncestorNode=function(Q){var P,O,M=this.getRange();Q=Q.toUpperCase();if(apf.isIE){if(this.getType()==D){for(O=0;O<M.length;O++){if(M(O).parentNode){P=M(O).parentNode;break;}}}else{P=M.parentElement();}while(P&&P.nodeName!=Q){P=P.parentNode;}return P;}else{var N=this.getSelectedNode();if(!N){N=c.getSelection().getRangeAt(0).startContainer;}while(N){if(N.tagName==Q){return N;}N=N.parentNode;}return null;}};this.remove=function(){var M=this.get(),N;if(apf.isIE){if(M.type!=t){M.clear();}}else{if(M){for(N=0;N<M.rangeCount;N++){M.getRangeAt(N).deleteContents();}}}return this;};this.$destroy=function(){c=F=o=this.current=n=null;delete c;delete F;delete o;delete this.current;delete n;};};apf.htmlCleaner=(function(){var i=null,c=null,d={table:1,TABLE:1},a={br:1,img:1,input:1,hr:1};return{prepare:function(o,m){if(!i){i=[/<(\/?)strong>|<strong( [^>]+)>/gi,/<(\/?)em>|<em( [^>]+)>/gi,/&apos;/g,/(<(\/?)(span|strong|em|u|i|b|a|strike|sup|sub|font|img)(?:\s+[\s\S]*?)?>)|(<br[\s\S]*?>)|(<(\/?)([\w\-]+)(?:\s+[\s\S]*?)?>)|([^<>]*)/gi,/(<a[^>]*href=)([^\s^>]+)*([^>]*>)/gi,/<p><\/p>/gi,/<a( )([^>]+)\/>|<a\/>/gi];}if(apf.isGecko){o=o.replace(i[0],"<$1b$2>").replace(i[1],"<$1i$2>");}else{if(apf.isIE){o=o.replace(i[2],"&#39;").replace(i[4],"$1$2 _apf_href=$2$3");var t=[],u=false,j=[],n=[],q=[],l=false;o.replace(i[3],function(A,F,I,K,J,C,s,D,E){if(F){var z=j.push(F);K=K.toLowerCase();if(!a[K]){if(I){if(!n[n.length-1]||n[n.length-1][0]!=K){j.length--;}else{n.length--;}}else{n.push([K,z]);}}u=true;}else{if(E){j.push(E);u=true;}else{if(J){if(u){if(n.length){j.push(J);}else{t.push("<p>",j.join(""),"</p>");j=[];}if(!n.length){u=false;}}else{if((q.length||l)&&J.indexOf("_apf_marker")>-1){}else{t.push("<p>&nbsp;</p>");}}}else{if(C){if(s){if(q[q.length-1]!=D.toLowerCase()){return;}else{q.length--;}if(j.length){t.push(j.join(""));j=[];}l=2;}else{var B=j.length&&j.join("").trim();var G=B?j:t;if(!d[D]){if(G[G.length-1]=="<p>&nbsp;</p>"){G[G.length-1]="";}else{if(B&&!q.length){G.push("<p></p>");}}}if(j.length){if(!B||q.length){t.push(j.join(""));j=[];}else{t.push("<p>",j.join(""),"</p>");j=[];}}q.push(D.toLowerCase());}t.push(C);u=false;}}}}l=l==2?1:false;});var w;if((w=j.join("")).trim()){t.push(m?w:"<p>"+w+"</p>");}o=t.join("");}}o=(apf.xmlentities?apf.xmlentities(o):o).replace(i[6],"<a$1$2></a>");return o;},parse:function(n,l,o){if(!c){c=[/<br[^>]*><\/li>/gi,/<br[^>]*_apf_placeholder="1"\/?>/gi,/<(a|span|div|h1|h2|h3|h4|h5|h6|pre|address)>[\s\n\r\t]*<\/(a|span|div|h1|h2|h3|h4|h5|h6|pre|address)>/gi,/<(tr|td)>[\s\n\r\t]*<\/(tr|td)>/gi,/[\s]*_apf_href="?[^\s^>]+"?/gi,/(".*?"|'.*?')|(\w)=([^'"\s>]+)/gi,/<((?:br|input|hr|img)(?:[^>]*[^\/]|))>/ig,/<p>&nbsp;$/mig,/(<br[^>]*?>(?:[\r\n\s]|&nbsp;)*<br[^>]*?>)|(<(\/?)(span|strong|em|u|i|b|a|br|strike|sup|sub|font|img)(?:\s+.*?)?>)|(<(\/?)([\w\-]+)(?:\s+.*?)?>)|([^<>]*)/gi,/<\/p>/gi,/<p>/gi,/<\s*\/?\s*(?:\w+:\s*)?[\w-]*[\s>\/]/g];}if(apf.isIE){n=n.replace(c[7],"<p></p>").replace(c[9],"<br />").replace(c[10],"");}else{if(n=="<br>"){n="";}}n=(apf.xmlentities?apf.xmlentities(n):n).replace(c[0],"</li>").replace(c[1],"").replace(c[2],"").replace(c[3],"<$1>&nbsp;</$2>").replace(c[4],"").replace(c[6],"<$1 />").replace(c[11],function(u){return u.toLowerCase();});if(apf.isIE&&!o){var t=[],m=true,s=[],q=[],j=[];n.replace(c[8],function(z,G,D,F,J,A,u,B,C){if(D){if(apf.isIE){D=D.replace(c[5],function(K,N,K,M){return N||K+'="'+M+'"';});}var w=s.push(D);if(!a[J]){if(F){if(!q[q.length-1]||q[q.length-1][0]!=J){s.length--;}else{q.length--;}}else{q.push([J,w]);}}m=true;}else{if(C){s.push(C);m=true;}else{if(G){if(m){if(q.length){s.push(G);}else{t.push("<p>",s.join("").trim()||"&nbsp;","</p>");s=[];m=false;}}else{t.push("<p>&nbsp;</p>");}}else{if(A){if(u){if(j[j.length-1]!=B){return;}else{j.length--;}if(s.length){t.push(s.join(""));s=[];}}else{if(apf.isIE){A=A.replace(c[5],function(K,N,K,M){return N||K+'="'+M+'"';});}var E=s.length?s:t;if(E[E.length-1]=="<p>&nbsp;</p>"){E.length--;}if(s.length){var I;if(j.length||(I=s.join("").trim()).replace(/<.*?>/g,"").trim()==""){t.push(I||s.join(""));s=[];}else{t.push("<p>",(I||s.join("").trim()||"&nbsp;").replace(/<br \/>[\s\r\n]*$/,""),"</p>");s=[];}}j.push(B);}t.push(A);m=false;}}}}});if(s.length){t.push("<p>"+s.join("").replace(/<br \/>[\s\r\n]*$/,"")+"</p>");}n=t.join("");}else{n=n.replace(/<br[^>]*_apf_marker="1"[^>]*>/gi,"<br />");}return n;}};})();apf.Sort=function(c){var d={};this.parseXml=function(n,l){if(l){d={};}d.order=n.order;d.getValue=n.csort||n.$compile("sort");d.getNodes=self[n["nodes-method"]];d.ascending=(d.order||"").indexOf("desc")==-1;d.order=null;if(n["data-type"]){d.method=i[n["data-type"]];}else{if(n["sort-method"]){d.method=self[n["sort-method"]];}else{d.method=i.alpha;}}var o=n["date-format"];if(o){d.sort_dateFmtStr=o;d.method=i.date;var j=o.match(/(D+|Y+|M+|h+|m+|s+)/g);if(j){for(var q={},m=0;m<j.length;m++){q[j[m].substr(0,1)]=m+1;}d.dateFormat=new RegExp(o.replace(/([^\sDYMhms])/g,"\\$1").replace(/YYYY/,"(\\d\\d\\d\\d)").replace(/(DD|YY|MM|hh|mm|ss)/g,"(\\d\\d)"));d.dateReplace="$"+q.M+"/$"+q.D+"/$"+q.Y;if(q.h){d.dateReplace+=" $"+q.h+":$"+q.m+":$"+q.s;}}}};this.set=function(l,j){if(j){d={};}apf.extend(d,l);if(!d.ascending){d.ascending=l.order?l.order.indexOf("desc")==-1:true;}d.order=null;if(l.type){d.method=i[l.type];}else{if(l.method){d.method=self[l.method];}else{if(!d.method){d.method=i.alpha;}}}if(!d.getValue){d.getValue=function(m){return apf.queryValue(m,d.xpath);};}};this.get=function(){return apf.extend({},d);};this.findSortSibling=function(n,m){var j=getNodes?getNodes(n,m):this.getTraverseNodes(n);for(var l=0;l<j.length;l++){if(!compare(m,j[l],true,sortSettings)){return j[l];}}return null;};var a=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000"];var i={alpha:function(j){return j.toString().toLowerCase();},number:function(j){return(j.length<a.length?a[a.length-j.length]:"")+j;},date:function(l,j){var m=d.dateFormat;var o=d.dateReplace;var q=d.sort_dateFmtStr;var n;if(!m){n=new Date(l);}else{if(q=="*"){n=Date.parse(l);}else{n=(new Date(l.replace(m,o))).getTime();}}l=""+n.getTime();if(l=="NaN"){l="0";}return(l.length<a.length?a[a.length-l.length]:"")+l;}};this.apply=function(l,u,m,j,s){var w=[],q=l.length;while(q--){var z=d.getValue(l[q]);if(l){w[w.length]={toString:function(){return this.v;},xmlNode:l[q],v:(d.method||i.alpha)(z||"",u,l[q])};}}w.sort();var o=s?Math.min(w.length,j+s):w.length;if(!j){j=0;}if(m){if(d.ascending){for(q=j;q<o;q++){f(q,o,w[q].xmlNode,w[q].v);}}else{for(q=o-1;q>=j;q--){f(o-q-1,o,w[q].xmlNode,w[q].v);}}}else{var t=[];if(d.ascending){for(q=j;q<o;q++){t[t.length]=w[q].xmlNode;}}else{for(q=o-1;q>=j;q--){t[t.length]=w[q].xmlNode;}}return t;}};if(c){this.parseXml(c);}};apf.skins={skins:{},css:[],events:["onmousemove","onmousedown","onmouseup","onmouseout","onclick","ondragcopy","ondragstart"],Init:function(s,n,t){var d=(n?n.getAttribute("id"):null)||s.getAttribute("id");var j=(n?n.getAttribute("src").match(/\//)||t:"")?(t||n.getAttribute("src")).replace(/\/[^\/]*$/,"")+"/":"";var l=(s.getAttribute("media-path")?apf.getAbsolutePath(j||apf.hostPath,s.getAttribute("media-path")):(n?n.getAttribute("media-path"):null));var o=(s.getAttribute("icon-path")?apf.getAbsolutePath(j||apf.hostPath,s.getAttribute("icon-path")):(n?n.getAttribute("icon-path"):null));if(!d){d="default";}if(s.getAttribute("id")){document.body.className+=" "+s.getAttribute("id");}var q=d.split("|");d=q[0];if(!this.skins[d]||d=="default"){this.skins[d]={base:j,name:d,iconPath:typeof o!="string"&&!o?"icons/":o,mediaPath:typeof l!="string"&&!l?"images/":l,templates:{},originals:{},xml:s};if(q.length>1){for(var m=0;m<q.length;m++){this.skins[q[m]]=this.skins[d];}}}if(!this.skins["default"]&&this.$first==n){this.skins["default"]=this.skins[d];}var c=s.childNodes;for(var m=c.length-1;m>=0;m--){if(c[m].nodeType!=1){continue;}this.skins[d].templates[c[m].getAttribute("name")]=c[m];if(c[m].ownerDocument){this.importSkinDef(c[m],j,d);}}this.purgeCss(l||j+"images/",o||j+"icons/");if(this.queue[d]){for(var a in this.queue[d]){this.queue[d][a]();}}},loadStylesheet:function(filename,title){var o;with(o=document.getElementsByTagName("head")[0].appendChild(document.createElement("LINK"))){rel="stylesheet";type="text/css";href=filename;title=title;}return o;},importSkinDef:function(xmlNode,basepath,name){var i,l,nodes=$xmlns(xmlNode,"style",apf.ns.aml),tnode,node;for(i=0,l=nodes.length;i<l;i++){node=nodes[i];if(node.getAttribute("src")){this.loadStylesheet(node.getAttribute("src").replace(/src/,basepath+"/src"));}else{var test=true;if(node.getAttribute("condition")){try{test=eval(node.getAttribute("condition"));}catch(e){test=false;}}if(test){tnode=node.firstChild;while(tnode){this.css.push(tnode.nodeValue);tnode=tnode.nextSibling;}}}}nodes=$xmlns(xmlNode,"alias",apf.ns.apf);var t=this.skins[name].templates;for(i=0;i<nodes.length;i++){if(!nodes[i].firstChild){continue;}t[nodes[i].firstChild.nodeValue.toLowerCase()]=xmlNode;}},loadedCss:"",purgeCss:function(a,d){if(!this.css.length){return;}var c=this.css.join("\n").replace(/images\//g,a).replace(/icons\//g,d);apf.importCssString(c);this.loadedCss+=c;this.css=[];},loadCssInWindow:function(a,n,d,l){this.css=[];var c=a.split(":");var m=this.skins[c[0]];var i=m.templates[c[1]];this.importSkinDef(i,m.base,m.name);var j=this.css.join("\n").replace(/images\//g,d).replace(/icons\//g,l);apf.importCssString(j);this.css=[];},setSkinPaths:function(a,d){a=a.split(":");var c=a[0];var i=a[1];d.iconPath=this.skins[c].iconPath;d.mediaPath=this.skins[c].mediaPath;},getTemplate:function(d,c){d=d.split(":");var l=d[0];var n=d[1];if(!this.skins[l]){if(c){return false;}return false;}if(!this.skins[l].templates[n]){return false;}var o=this.skins[l].templates[n];var a=this.skins[l].originals[n];if(!a){a=this.skins[l].originals[n]={};var j=$xmlns(o,"presentation",apf.ns.aml)[0].childNodes;for(var m=0;m<j.length;m++){if(j[m].nodeType!=1){continue;}a[j[m].baseName||j[m][apf.TAGNAME]]=j[m];}}return a;},getCssString:function(a){return apf.queryValue($xmlns(this.skins[a.split(":")[0]].xml,"style",apf.ns.aml)[0],"text()");},changeSkinset:function(c){var a=apf.document.documentElement;while(a){if(a&&a.nodeFunc==apf.NODE_VISIBLE&&a.hasFeature(apf.__PRESENTATION__)&&!a.skinset){a.$propHandlers.skinset.call(a,c);a.skinset=null;}if(a.firstChild||a.nextSibling){a=a.firstChild||a.nextSibling;}else{do{a=a.parentNode;}while(a&&!a.nextSibling);if(a){a=a.nextSibling;}}}},queue:{},waitForSkin:function(a,d,c){if(this.skins[a]){return;}(this.queue[a]||(this.queue[a]={}))[d]=c;return true;},iconMaps:{},addIconMap:function(a){this.iconMaps[a.name]=a;if(a.size){a.width=a.height=a.size;}else{if(!a.width){a.width=1;}if(!a.height){a.height=1;}}},setIcon:function(d,n,a){if(!n){d.style.backgroundImage="";return;}if(d.tagName.toLowerCase()=="img"){d.setAttribute("src",n?(a||"")+n:"");return;}var m=n.split(":");var l=this.iconMaps[m[0]];if(l){var j,i,c=m[1].split(",");j=(c[(l.type=="vertical")?1:0]||0)*l.width;i=(c[(l.type=="vertical")?0:1]||0)*l.height;d.style.backgroundImage="url("+(a||"")+l.src+")";d.style.backgroundPosition=((-1*j)-l.offset[0])+"px "+((-1*i)-l.offset[1])+"px";}else{d.style.backgroundImage="url("+(a||"")+n+")";}}};apf.flow={isMoved:false,objCanvases:{},connectionsTemp:null,connectionsManager:null,sSize:7,fsSize:15,init:function(){document.body.onmousedown=function(m){m=(m||event);var n=m.target||m.srcElement,c=false;if(n.tagName=="HTML"){return;}while(n!=document.body&&!apf.flow.findBlock(n.id)){n=n.parentNode||n.parentElement;}var A=apf.flow.isBlock(n);if(!A){return;}if(!A.draggable){return;}var s=m.clientX,q=m.clientY,B=0,z=0,i=parseInt(n.style.left),w=parseInt(n.style.top),o,u;var d=A.canvas.snap,j=A.canvas.gridW,a=A.canvas.gridH;if(m.preventDefault){m.preventDefault();}document.body.onmousemove=function(l){l=(l||event);c=true;B=l.clientX-s;z=l.clientY-q;o=w+z;u=i+B;if(d){n.style.left=Math.round(u/j)*j+"px";n.style.top=Math.round(o/a)*a+"px";}else{n.style.left=u+"px";n.style.top=o+"px";}A.onMove();apf.flow.onblockmove();return false;};document.body.onmouseup=function(l){document.body.onmousemove=null;if(apf.flow.onaftermove&&c){apf.flow.onaftermove(z,B);c=false;}};};}};apf.flow.canvas=function(a){if(!a.getAttribute("id")){apf.setUniqueHtmlId(a);}this.id=a.getAttribute("id");this.htmlElement=a;this.htmlBlocks={};this.htmlConnectors={};this.scrollPointer=null;this.lastTop=0;this.lastLeft=0;this.mode="normal";this.disableremove=false;this.snap=false;this.gridW=48;this.gridH=48;this.initCanvas=function(){apf.flow.objCanvases[this.htmlElement.getAttribute("id")]=this;};this.removeConnector=function(i){var d=this.htmlConnectors[i];d.htmlElement.parentNode.removeChild(d.htmlElement);this.htmlConnectors[i]=d=null;delete this.htmlConnectors[i];};this.deselectConnections=function(){for(var d in this.htmlConnectors){var c=this.htmlConnectors[d];if(c.selected){c.deselect("selected");c.deselectInputs("Selected");c.selected=false;}}};this.setMode=function(c){this.mode=c;};this.getMode=function(){return this.mode;};this.getWindowScrollLeft=function(){return document.documentElement.scrollLeft||document.body.scrollLeft;};this.getWindowScrollTop=function(){return document.documentElement.scrollTop||document.body.scrollTop;};this.scrollLeft=function(){this.htmlElement.scrollLeft=9999;};this.scrollTop=function(){this.htmlElement.scrollTop=9999;};this.getScrollLeft=function(){return this.htmlElement.scrollLeft;};this.getScrollTop=function(){return this.htmlElement.scrollTop;};this.addScrollPointer=function(){this.scrollPointer=this.htmlElement.appendChild(document.createElement("div"));this.scrollPointer.className="scrollPointer";};this.moveLeftScrollPointer=function(d){var c=parseInt(d)+150;this.scrollPointer.style.left=c+"px";this.lastLeft=parseInt(d);};this.moveTopScrollPointer=function(d){var c=parseInt(d)+150;this.scrollPointer.style.top=c+"px";this.lastTop=parseInt(d);};this.getWidth=function(){return this.htmlElement.offsetWidth;};this.getHeight=function(){return this.htmlElement.offsetHeight;};};apf.flow.block=function(i,d,c){this.canvas=d;this.htmlElement=i;this.id=i.getAttribute("id");this.moveListeners=new Array();this.draggable=true;this.htmlOutputs={};this.image=null;this.other=c;var a=this;this.destroy=function(){this.htmlElement.onmouseover=this.htmlElement.onmouseout=this.htmlElement.onclick=null;for(var j=this.moveListeners.length-1;j>=0;j--){this.moveListeners[j].destroy();this.moveListeners.removeIndex(j);}delete this.canvas.htmlBlocks[this.id];};this.initBlock=function(){this.canvas.htmlBlocks[this.id]=this;var n,q,s,m,u=this.htmlElement.childNodes,t=0,o=u.length;for(;t<o;t++){n=u[t].tagName;if(n&&(n=n.toLowerCase())){if(n=="div"){q=u[t].childNodes;for(s=0,m=q.length;s<m;s++){if(q[s].tagName&&q[s].tagName.toLowerCase()=="img"){this.imageContainer=u[t];this.image=q[s];}}}else{if(n=="blockquote"){this.caption=u[t];}}}}if(!this.other.type){apf.setStyleClass(this.htmlElement,"empty");this.image.style.display="none";}else{if(this.other.picture==null){this.image.style.display="none";}else{this.image.style.display="block";this.image.src=this.other.picture;this.image.onload=function(){a.changeRotation(a.other.rotation,a.other.fliph,a.other.flipv,true);};}}this.other.ratio=this.other.dwidth/this.other.dheight;this.changeRotation(a.other.rotation,a.other.fliph,a.other.flipv,true);this.setCaption(this.other.caption);this.setLock(this.other.lock,true);this.updateOutputs();};this.updateOutputs=function(){var q,l,o,m,j,n=this.other.inputList;for(q in n){l=this.htmlOutputs[q]?this.htmlOutputs[q]:new apf.flow.input(this,q);if(!this.htmlOutputs[q]){this.htmlOutputs[q]=l;}o=this.updateInputPos(n[q]);m=o[0]-(o[2]=="left"||o[2]=="right"?Math.ceil(parseInt(apf.getStyle(l.htmlElement,"width"))/2):Math.ceil(apf.flow.sSize/2));j=o[1]-(o[2]=="top"||o[2]=="bottom"?Math.ceil(parseInt(apf.getStyle(l.htmlElement,"height"))/2):Math.ceil(apf.flow.sSize/2));l.lastUpdate=o;l.moveTo(m,j);}};this.outputsVisibility=function(m){var l=this.htmlOutputs;for(var n in l){var j=l[n];if(m){j.show();}else{j.hide();}}};this.setLock=function(j,l){if(this.other.lock!==j||l){this.draggable=!j;this.other.lock=j;this.outputsVisibility(!j);if(j){apf.setStyleClass(this.htmlElement,"locked");}else{apf.setStyleClass(this.htmlElement,"",["locked"]);}}};this.setCaption=function(j){var l=this.caption;if(!l||l.nodeType!=1){return;}l.innerHTML=j;if(this.other.capPos=="inside"){if(l.offsetWidth!==0&&l.offsetHeight!==0){l.style.marginLeft="-"+(Math.ceil(l.offsetWidth/2))+"px";l.style.marginTop="-"+(Math.ceil(l.offsetHeight/2))+"px";}}};this.moveTo=function(o,n){var m=parseInt(this.htmlElement.style.top),j=parseInt(this.htmlElement.style.left);if(m!==o||j!==n){this.htmlElement.style.top=o+"px";this.htmlElement.style.left=n+"px";if(this.canvas.lastTop<o||o>this.canvas.getHeight()-100){this.canvas.moveTopScrollPointer(o);this.canvas.scrollTop();}if(this.canvas.lastLeft<n&&n>this.canvas.getWidth()-100){this.canvas.moveLeftScrollPointer(n);this.canvas.scrollLeft();}}};this.resize=function(n,j){var l=parseInt(this.htmlElement.style.width),m=parseInt(this.htmlElement.style.height);if(l!==n||m!==j){this.htmlElement.style.width=this.imageContainer.style.width=n+"px";this.htmlElement.style.height=this.imageContainer.style.height=j+"px";this.image.style.height=j+"px";this.image.style.width=n+"px";this.image.style.filter="";}};this.changeRotation=function(j,t,m,s){var q=this.other,l=[q.rotation,q.fliph,q.flipv];if(!q.type){return;}q.rotation=parseInt(j)%360||0;q.fliph=String(t)=="true"?true:false;q.flipv=String(m)=="true"?true:false;var n=(q.fliph&&!q.flipv?"horizontal":(!q.fliph&&q.flipv?"vertical":"none"));this.repaintImage(n,q.rotation,"rel");};this.repaintImage=function(s,o,m){var l=this.image;if(l.style.display=="none"){return;}l.style.display="block";l.angle=!m?((l.angle==undefined?0:l.angle)+o)%360:o;var n,w=Math.PI*(l.angle>=0?l.angle:360+l.angle)/180,u=Math.cos(w),q=Math.sin(w);if(document.all&&!window.opera){n=document.createElement("img");n.src=l.src;n.style.height=l.height+"px";n.style.width=l.width+"px";n.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+u+",M12="+(-q)+",M21="+q+",M22="+u+",SizingMethod='auto expand')";if(s!=="none"){n.style.filter+="progid:DXImageTransform.Microsoft.BasicImage("+(s=="horizontal"?"mirror=1":"rotation=2, mirror=1")+")";}}else{n=document.createElement("canvas");if(!l.oImage){n.oImage=new Image();n.oImage.src=l.src;}else{n.oImage=l.oImage;}n.style.width=n.width=Math.abs(u*n.oImage.width)+Math.abs(q*n.oImage.height);n.style.height=n.height=Math.abs(u*n.oImage.height)+Math.abs(q*n.oImage.width);var j=n.getContext("2d");j.save();switch(s){case"vertical":j.translate(0,n.oImage.height);j.scale(1,-1);break;case"horizontal":j.translate(n.oImage.height,0);j.scale(-1,1);break;}if(w<=Math.PI/2){j.translate(q*n.oImage.height,0);}else{if(w<=Math.PI){j.translate(n.width,-u*n.oImage.height);}else{if(w<=1.5*Math.PI){j.translate(-u*n.oImage.width,n.height);}else{j.translate(0,-q*n.oImage.width);}}}j.rotate(w);try{j.drawImage(n.oImage,0,0,n.oImage.width,n.oImage.height);j.restore();}catch(t){}}n.angle=l.angle;this.imageContainer.replaceChild(n,l);this.image=n;};this.onMove=function(){for(var m=0,n=this.moveListeners,j=n.length;m<j;m++){n[m].onMove();}};this.updateInputPos=function(t,u){var O=this.htmlElement,D=this.other,s=parseInt(O.style.width),J=parseInt(O.style.height),q=t?t.position:"auto",n=t?t.x:s/2,m=t?t.y:J/2,A=D.dwidth,M=D.dheight,j=D.flipv,z=D.fliph,C=D.rotation,l={0:"top",1:"right",2:"bottom",3:"left",top:0,right:1,bottom:2,left:3},K=apf.flow.sSize,P=Math.floor(apf.flow.sSize/2);q=(q=="auto")?"auto":l[(l[q]+parseInt(C)/90)%4];if(q!=="auto"){if(j){q=q=="top"?"bottom":(q=="bottom"?"top":q);}if(z){q=q=="left"?"right":(q=="right"?"left":q);}n=(C==90||C==270)?n*J/M:n*s/A;m=(C==90||C==270)?m*s/A:m*J/M;var I=n,G=m;I=(C==90)?s-m-1:(C==180?s-n-1:(C==270?m:n));G=(C==90)?n:(C==180?J-m-1:(C==270?J-n-1:m));I=z?s-I:I;G=j?J-G:G;I=z?(q=="top"||q=="bottom"?I-1:I):I;G=j?(q=="left"||q=="right"?G-1:G):G;I=q=="top"||q=="bottom"?I-(K/2)+(apf.isIE||apf.isOpera||apf.isChrome?1:0):I;G=q=="left"||q=="right"?G-(K/2)+(apf.isIE||apf.isOpera||apf.isChrome?1:0):G;}else{var E=parseInt(O.style.top),N=parseInt(O.style.left),B=u[1],F=u[0];A=u[2],M=u[3];if(E+J*1.5<B){q="bottom";}else{if(E>B+M*1.5){q="top";}else{if(N>F+A/2){q="left";}else{if(N<F){q="right";}else{q="left";}}}}I=(q=="top"||q=="bottom")?s/2-P:q=="right"?s:0;G=(q=="left"||q=="right")?J/2-P:q=="bottom"?J:0;}return[I,G,q];};this.htmlElement.onmouseup=function(j){if(!a.other.type&&a.canvas.mode=="connection-add"){apf.flow.connectionsManager.addBlock(a,0);}};};apf.flow.input=function(i,j){this.objBlock=i;this.htmlElement=i.htmlElement.appendChild(document.createElement("div"));this.number=j;this.lastUpdate=null;var c=this;apf.setStyleClass(this.htmlElement,"input");this.hide=function(){this.htmlElement.style.display="none";};this.show=function(){this.htmlElement.style.display="block";};this.moveTo=function(l,m){this.htmlElement.style.left=l+"px";this.htmlElement.style.top=m+"px";};var d;var a;this.htmlElement.onmousedown=function(t){t=(t||event);t.cancelBubble=true;apf.flow.isMoved=true;var o=c.objBlock.canvas,q=c.htmlElement.parentNode,s=o.mode;if(t.preventDefault){t.preventDefault();}a=new apf.flow.virtualMouseBlock(o,t);var n=apf.flow.findConnector(c.objBlock,c.number);if(n){var m=n.source?n.connector.objDestination:n.connector.objSource,u=n.source?n.connector.objSource:n.connector.objDestination,w=n.source?n.connector.other.input:n.connector.other.output,l=n.source?n.connector.other.output:n.connector.other.input;a.other.inputList[1].position=u.updateInputPos(u.other.inputList[l])[2];c.objBlock.onremoveconnection([n.connector.other.xmlNode]);apf.flow.removeConnector(n.connector.htmlElement);d=new apf.flow.addConnector(o,m,a,{output:w,input:1});apf.flow.connectionsManager.addBlock(m,w);o.setMode("connection-change");}else{d=new apf.flow.addConnector(o,c.objBlock,a,{output:c.number});apf.flow.connectionsManager.addBlock(c.objBlock,c.number);o.setMode("connection-add");}d.newConnector.virtualSegment=true;a.onMove(t);document.body.onmousemove=function(z){z=(z||event);if(a){a.onMove(z);}};document.body.onmouseup=function(A){A=(A||event);var z=A.target||A.srcElement;document.body.onmousemove=null;apf.flow.isMoved=false;if(z&&o.mode=="connection-change"){if((z.className||"").indexOf("input")==-1){apf.flow.connectionsManager.addBlock(u,l);}}apf.flow.connectionsManager.clear();if(d){apf.flow.removeConnector(d.newConnector.htmlElement);}if(a){a.onMove(A);a.destroy();a=null;c.objBlock.canvas.setMode("normal");}};};this.htmlElement.onmouseup=function(l){apf.flow.connectionsManager.addBlock(c.objBlock,c.number);};this.htmlElement.onmouseover=function(l){var m=c.objBlock.canvas.mode;if(m=="connection-add"||m=="connection-change"){apf.setStyleClass(c.htmlElement,"inputHover");}};this.htmlElement.onmouseout=function(l){apf.setStyleClass(c.htmlElement,"",["inputHover"]);};};apf.flow.connectionsManager=new (function(){this.addBlock=function(c,a){if(c&&(a||a==0)){var d=apf.flow.connectionsTemp;if(!d){apf.flow.connectionsTemp={objBlock:c,inputNumber:a};}else{if(d.objBlock.id!==c.id||d.inputNumber!==a){c.oncreateconnection(d.objBlock.other.xmlNode,d.inputNumber,c.other.xmlNode,a);c.canvas.setMode("normal");}this.clear();}}};this.clear=function(){apf.flow.connectionsTemp=null;};})();apf.flow.virtualMouseBlock=function(c){var d=[0,0,"virtual"];this.canvas=c;this.htmlElement=document.createElement("div");this.canvas.htmlElement.appendChild(this.htmlElement);this.htmlElement.style.display="block";this.moveListeners=new Array();this.draggable=0;this.htmlOutputs={};this.htmlOutputs[1]={htmlElement:this.htmlElement.appendChild(document.createElement("div")),number:1,lastUpdate:d};this.other={};this.other.inputList={};this.other.inputList[1]={x:d[0],y:d[1],position:d[2]};apf.setStyleClass(this.htmlElement,"vMB");var a=apf.getAbsolutePosition(this.canvas.htmlElement);this.onMove=function(n){this.htmlElement.style.left=(n.clientX+2+this.canvas.getWindowScrollLeft()+this.canvas.getScrollLeft()-a[0])+"px";this.htmlElement.style.top=(n.clientY+2+this.canvas.getWindowScrollTop()+this.canvas.getScrollTop()-a[1])+"px";for(var m=0,j=this.moveListeners.length;m<j;m++){this.moveListeners[m].onMove();}};this.destroy=function(){this.htmlElement.parentNode.removeChild(this.htmlElement);};this.updateInputPos=function(i){return d;};};apf.flow.connector=function(d,a,i,c,o){this.htmlSegments=[];var t=[];this.htmlLabel=null;this.htmlStart=null;this.htmlEnd=null;this.objSource=i;this.objDestination=c;this.other=o;this.selected=false;this.htmlElement=d;this.virtualSegment=null;var m=apf.flow.sSize,q=apf.flow.fsSize,j=Math.floor(m/2),n=this.objSource.htmlElement,l=this.objDestination.htmlElement,s=this;this.initConnector=function(){if(!d.getAttribute("id")){apf.setUniqueHtmlId(d);}a.htmlConnectors[d.getAttribute("id")]=this;this.objSource.moveListeners.push(this);this.objDestination.moveListeners.push(this);this.activateInputs();this.onMove();};this.activateInputs=function(){this.i1=o.output&&this.objSource.other.inputList[o.output]?this.objSource.other.inputList[o.output]:{x:0,y:0,position:"auto"};this.i2=o.input&&this.objDestination.other.inputList[o.input]?this.objDestination.other.inputList[o.input]:{x:0,y:0,position:"auto"};};this.destroy=function(){this.deselectInputs("Selected");var u=this.objSource.moveListeners,A=0,w=u.length;for(;A<w;A++){if(u[A]==this){this.objSource.moveListeners.removeIndex(A);}}var z=this.objDestination.moveListeners;for(A=0,w=z.length;A<w;A++){if(z[A]==this){this.objDestination.moveListeners.removeIndex(A);}}a.removeConnector(this.htmlElement.getAttribute("id"));};this.onMove=function(){this.draw();if(this.selected){this.deselectInputs("Hover");this.deselect("selected");this.deselectInputs("Selected");this.selected=false;}};this.draw=function(){var F,u,z=[],I=[parseInt(n.style.left),parseInt(n.style.top)],E=[parseInt(l.style.left),parseInt(l.style.top)];t=this.htmlSegments;this.htmlSegments=[];if(this.i1.position=="auto"||this.i2.position=="auto"){F=this.objSource.updateInputPos(this.i1,E);u=this.objDestination.updateInputPos(this.i2,I);}else{F=this.objSource.htmlOutputs[o.output].lastUpdate;u=this.objDestination.htmlOutputs[o.input].lastUpdate;}var D=F[2];var G=u[2];I[0]+=F[0];I[1]+=F[1];E[0]+=u[0];E[1]+=u[1];if(D!=="virtual"){I=this.createSegment(I,[q,D],true);}if(G!=="virtual"){E=this.createSegment(E,[q,G],true);}z=I;var C=I[0]>E[0]?(I[1]>E[1]?"TL":(I[1]<E[1]?"BL":"ML")):(I[0]<E[0]?(I[1]>E[1]?"TR":(I[1]<E[1]?"BR":"MR")):(I[1]>E[1]?"TM":(I[1]<E[1]?"MM":"BM"))),w=C+(D=="left"?1:(D=="right"?2:D=="top"?4:8))+(G=="left"?1:(G=="right"?2:G=="top"?4:8));switch(w){case"TR41":z=this.createSegment(z,[apf.isGecko?I[1]-E[1]:Math.ceil(I[1]-E[1]),"top"]);z=this.createSegment(z,[apf.isGecko?E[0]-I[0]:Math.ceil(E[0]-I[0]),"right"]);break;case"TR44":case"TR14":case"TR11":z=this.createSegment(z,[apf.isGecko?I[1]-E[1]:Math.ceil(I[1]-E[1]),"top"]);z=this.createSegment(z,[apf.isGecko?E[0]-I[0]:Math.floor(E[0]-I[0]),"right"]);break;case"BR22":case"BR24":case"BR42":case"BR44":z=this.createSegment(z,[apf.isGecko?E[0]-I[0]:Math.floor(E[0]-I[0]),"right"]);z=this.createSegment(z,[Math.ceil(Math.abs(E[1]-I[1])),"bottom"]);break;case"BR41":z=this.createSegment(z,[apf.isGecko?(E[0]-I[0])/2:(E[0]-I[0])/2,"right"]);z=this.createSegment(z,[E[1]-I[1],"bottom"]);z=this.createSegment(z,[apf.isGecko?(E[0]-I[0])/2:Math.ceil((E[0]-I[0])/2),"right"]);break;case"BR48":case"BR28":z=this.createSegment(z,[apf.isGecko?(E[0]-I[0])/2:(E[0]-I[0])/2,"right"]);z=this.createSegment(z,[apf.isGecko?E[1]-I[1]:Math.ceil(E[1]-I[1]),"bottom"]);z=this.createSegment(z,[apf.isGecko?(E[0]-I[0])/2:(E[0]-I[0])/2,"right"]);break;case"BR21":z=this.createSegment(z,[apf.isGecko?(E[0]-I[0])/2:(E[0]-I[0])/2,"right"]);z=this.createSegment(z,[apf.isGecko?E[1]-I[1]:Math.ceil(E[1]-I[1]),"bottom"]);z=this.createSegment(z,[parseInt((E[0]-I[0])/2)+1,"right"]);break;case"TL44":case"TL42":case"TL24":case"TL22":z=this.createSegment(z,[apf.isGecko?I[1]-E[1]:Math.ceil(I[1]-E[1]),"top"]);z=this.createSegment(z,[apf.isGecko?I[0]-E[0]:Math.ceil(I[0]-E[0]),"left"]);break;case"TR21":case"TR24":case"TR81":case"TR84":case"TR21":case"TR24":case"TR81":case"TR84":z=this.createSegment(z,[apf.isGecko?(E[0]-I[0])/2:(E[0]-I[0])/2,"right"]);z=this.createSegment(z,[apf.isGecko?I[1]-E[1]:Math.ceil(I[1]-E[1]),"top"]);z=this.createSegment(z,[apf.isGecko?(E[0]-I[0])/2:(E[0]-I[0])/2,"right"]);break;case"BR18":case"BR88":case"BR81":case"BR11":z=this.createSegment(z,[E[1]-I[1],"bottom"]);z=this.createSegment(z,[apf.isGecko?E[0]-I[0]:Math.ceil(E[0]-I[0]),"right"]);break;case"BR14":z=this.createSegment(z,[apf.isGecko?(E[1]-I[1])/2:Math.ceil((E[1]-I[1])/2),"bottom"]);z=this.createSegment(z,[apf.isGecko?E[0]-I[0]:Math.floor(E[0]-I[0]),"right"]);z=this.createSegment(z,[Math.ceil((E[1]-I[1])/2),"bottom"]);break;case"BR84":case"BR82":case"BR12":z=this.createSegment(z,[apf.isGecko?(E[1]-I[1])/2:Math.ceil((E[1]-I[1])/2),"bottom"]);z=this.createSegment(z,[apf.isGecko?E[0]-I[0]:Math.floor(E[0]-I[0]),"right"]);z=this.createSegment(z,[(E[1]-I[1])/2,"bottom"]);break;case"BL84":case"BL24":case"BL21":z=this.createSegment(z,[apf.isGecko?(E[1]-I[1])/2:Math.ceil((E[1]-I[1])/2),"bottom"]);z=this.createSegment(z,[apf.isGecko?I[0]-E[0]:Math.ceil(I[0]-E[0]),"left"]);z=this.createSegment(z,[apf.isGecko?(E[1]-I[1])/2:Math.ceil((E[1]-I[1])/2),"bottom"]);break;case"BL11":case"BL14":case"BL41":case"BL44":case"BL81":z=this.createSegment(z,[apf.isGecko?I[0]-E[0]:Math.ceil(I[0]-E[0]),"left"]);z=this.createSegment(z,[apf.isGecko?E[1]-I[1]:Math.ceil(E[1]-I[1]),"bottom"]);break;case"BL12":case"BL18":case"BL42":case"BL48":z=this.createSegment(z,[apf.isGecko?(I[0]-E[0])/2:(I[0]-E[0])/2,"left"]);z=this.createSegment(z,[apf.isGecko?E[1]-I[1]:Math.ceil(E[1]-I[1]),"bottom"]);z=this.createSegment(z,[apf.isGecko?(I[0]-E[0])/2:(I[0]-E[0])/2,"left"]);break;case"BL88":case"BL82":case"BL28":case"BL22":z=this.createSegment(z,[apf.isGecko?E[1]-I[1]:Math.ceil(E[1]-I[1]),"bottom"]);z=this.createSegment(z,[apf.isGecko?I[0]-E[0]:Math.ceil(I[0]-E[0]),"left"]);break;case"TL88":case"TL81":case"TL18":case"TL11":z=this.createSegment(z,[apf.isGecko?I[0]-E[0]:Math.ceil(I[0]-E[0]),"left"]);z=this.createSegment(z,[apf.isGecko?I[1]-E[1]:Math.ceil(I[1]-E[1]),"top"]);break;case"TL41":z=this.createSegment(z,[apf.isGecko?(I[1]-E[1])/2:Math.floor((I[1]-E[1])/2),"top"]);z=this.createSegment(z,[apf.isGecko?I[0]-E[0]:Math.ceil(I[0]-E[0]),"left"]);z=this.createSegment(z,[apf.isGecko?(I[1]-E[1])/2:Math.ceil((I[1]-E[1])/2),"top"]);break;case"TL48":case"TL28":case"TL21":z=this.createSegment(z,[apf.isGecko?(I[1]-E[1])/2:Math.floor((I[1]-E[1])/2),"top"]);z=this.createSegment(z,[apf.isGecko?I[0]-E[0]:Math.ceil(I[0]-E[0]),"left"]);z=this.createSegment(z,[apf.isGecko?(I[1]-E[1])/2:Math.floor((I[1]-E[1])/2),"top"]);break;case"TL12":case"TL14":case"TL82":case"TL84":z=this.createSegment(z,[apf.isGecko?(I[0]-E[0])/2:(I[0]-E[0])/2,"left"]);z=this.createSegment(z,[apf.isGecko?I[1]-E[1]:Math.ceil(I[1]-E[1]),"top"]);z=this.createSegment(z,[apf.isGecko?(I[0]-E[0])/2:(I[0]-E[0])/2,"left"]);break;case"TR12":case"TR18":case"TR42":case"TR48":z=this.createSegment(z,[apf.isGecko?(I[1]-E[1])/2:Math.floor((I[1]-E[1])/2),"top"]);z=this.createSegment(z,[apf.isGecko?E[0]-I[0]:Math.floor(E[0]-I[0]),"right"]);z=this.createSegment(z,[apf.isGecko?(I[1]-E[1])/2:Math.floor((I[1]-E[1])/2),"top"]);break;case"TR22":case"TR28":case"TR82":case"TR88":z=this.createSegment(z,[apf.isGecko?E[0]-I[0]:Math.floor(E[0]-I[0]),"right"]);z=this.createSegment(z,[apf.isGecko?I[1]-E[1]:Math.ceil(I[1]-E[1]),"top"]);break;default:switch(C){case"ML":z=this.createSegment(z,[apf.isGecko?I[0]-E[0]:Math.ceil(I[0]-E[0]),"left"]);break;case"MM":z=this.createSegment(z,[apf.isGecko?I[0]-E[0]:Math.ceil(I[0]-E[0]),"left"]);z=this.createSegment(z,[apf.isGecko?E[1]-I[1]:Math.ceil(E[1]-I[1]),"bottom"]);break;case"TM":z=this.createSegment(z,[apf.isGecko?I[1]-E[1]:Math.ceil(I[1]-E[1]),"top"]);z=this.createSegment(z,[apf.isGecko?I[0]-E[0]:Math.ceil(I[0]-E[0]),"left"]);break;case"MR":z=this.createSegment(z,[apf.isGecko?E[0]-I[0]:Math.floor(E[0]-I[0]),"right"]);if(w.substring(2,4)=="41"){break;}z=this.createSegment(z,[Math.abs(E[1]-I[1]),"bottom"]);break;}break;}for(var B=t.length-1;B>=0;B--){t[B][0].style.display="none";}if(this.other.label){this.htmlLabel=apf.flow.label(this);}if(this.other.type){var A=this.other.type.split("-");if(A[0]!=="none"){this.htmlStart=apf.flow.connectorsEnds(this,"start",A[0]);}if(A[1]!=="none"){this.htmlEnd=apf.flow.connectorsEnds(this,"end",A[1]);}}};this.createSegment=function(M,O,B){var D=O[1],C=O[0],A=M[0]||0,u=M[1]||0,J=t.shift(),K=this,G=J?J[0]:null,F=(D=="top"||D=="bottom")?"ver":"hor";if(!G){G=d.appendChild(document.createElement("div"));apf.setUniqueHtmlId(G);apf.setStyleClass(G,"segment");if(K.selected){K.select("selected");}var z=this.objSource.canvas;G.onmouseover=function(w){if(!apf.flow.isMoved&&((z.mode=="connection-change"&&K.selected)||z.mode=="connection-add")){K.select("hover");}};G.onmouseout=function(w){K.deselect("hover");};G.onmousedown=function(w){w=w||event;w.cancelBubble=true;K.deselect("selected");K.select("clicked");};G.onmouseup=function(P){P=(P||event);P.cancelBubble=true;var Q=P.ctrlKey,w=K.selected;if(!Q){K.objSource.canvas.deselectConnections();}K.selected=w?false:K.selected?false:true;if(K.selected){K.selectInputs("Selected");K.deselect("clicked");K.select("selected");z.setMode("connection-change");}else{K.deselectInputs("Selected");K.deselect("clicked");K.deselect("selected");z.setMode("normal");}};}G.plane=F;var N=F=="ver"?m:C,E=F=="ver"?C:m,I="segment seg_"+F;if(K.virtualSegment){I+=" seg_"+F+"_virtual";}G.className=I;if(D=="top"){u-=C;}if(D=="left"){A-=C;}G.style.display="block";G.style.left=A+(F=="hor"&&!B||(D=="left"&&B)?3:0)+"px";G.style.top=u+(F=="ver"?3:0)+"px";G.style.width=N+(D=="left"&&B?-3:(D=="right"&&B?3:0))+"px";G.style.height=E+"px";if(D=="bottom"){u+=E;}if(D=="right"){A+=N;}this.htmlSegments.push([G,D]);return[A,u];};this.deselect=function(A){var w=this.htmlElement.childNodes,z=0,u=w.length;for(;z<u;z++){if((w[z].className||"").indexOf("segment")!=-1){apf.setStyleClass(w[z],"",["seg_"+w[z].plane+"_"+A]);}}if(!this.selected){this.deselectInputs("Selected");}if(this.htmlLabel&&A=="selected"){this.htmlLabel.className="label";}};this.select=function(A){var w=this.htmlElement.childNodes,z=0,u=w.length;for(;z<u;z++){if((w[z].className||"").indexOf("segment")!=-1){apf.setStyleClass(w[z],"seg_"+w[z].plane+"_"+A);}}this.selectInputs();if(this.htmlLabel&&A=="selected"){this.htmlLabel.className="label labelSelected";}};this.selectInputs=function(z){if(this.other.output&&this.objSource.htmlOutputs[o.output]){var w=this.objSource.htmlOutputs[o.output].htmlElement;apf.setStyleClass(w,"input"+z);}if(this.other.input&&this.objDestination.htmlOutputs[o.input]){var u=this.objDestination.htmlOutputs[o.input].htmlElement;apf.setStyleClass(u,"input"+z);}};this.deselectInputs=function(z){if(this.other.output&&this.objSource.htmlOutputs[this.other.output]){var w=this.objSource.htmlOutputs[this.other.output].htmlElement;apf.setStyleClass(w,"",["input"+z]);}if(this.other.input&&this.objDestination.htmlOutputs[this.other.input]){var u=this.objDestination.htmlOutputs[this.other.input].htmlElement;apf.setStyleClass(u,"",["input"+z]);}};};apf.flow.connectorsEnds=function(d,c,m){var j=(c=="start")?d.htmlStart:d.htmlEnd,n=d.htmlSegments[c=="start"?0:1],a=parseInt(n[0].style.left),i=parseInt(n[0].style.top),o=j?j:d.htmlElement.appendChild(document.createElement("div"));i+=(n[1]=="top")?parseInt(n[0].style.height)-14:0;a+=(n[1]=="left")?parseInt(n[0].style.width)-11:(n[1]=="right"?3:0);o.style.left=a+"px";o.style.top=i+"px";o.className="connector-end "+m+" or"+n[1];return o;};apf.flow.label=function(c,j){j=j||Math.ceil(c.htmlSegments.length/2);var m,i=c.htmlSegments[j],a=parseInt(i[0].style.left),d=parseInt(i[0].style.top);if(c.htmlLabel){m=c.htmlLabel;}else{m=c.htmlElement.appendChild(document.createElement("span"));apf.setStyleClass(m,"label");}a+=i[1]=="top"||i[1]=="bottom"?i[0].offsetWidth+3:(i[0].offsetWidth-m.offsetWidth)/2;d+=i[1]=="top"||i[1]=="bottom"?(i[0].offsetHeight-m.offsetHeight)/2:i[0].offsetHeight-2;m.style.left=a+"px";m.style.top=d+"px";m.innerHTML=c.other.label;return m;};apf.flow.findBlock=function(a){var i=apf.flow.objCanvases;for(var d in i){if(i[d].htmlBlocks[a]){return i[d].htmlBlocks[a];}}};apf.flow.isBlock=function(a){if(!a){return;}var j,d,i=apf.flow.objCanvases;for(j in i){d=i[j].htmlBlocks[a.getAttribute("id")];if(d){return d;}}};apf.flow.isCanvas=function(a){if(a){return apf.flow.objCanvases[a.id];}};apf.flow.findConnector=function(u,j,o,l){var a,q,i,s,n,t,d,m=apf.flow.objCanvases;for(a in m){d=m[a].htmlConnectors;for(q in d){if(d[q]){i=d[q].objSource,s=d[q].objDestination,n=d[q].other.output,t=d[q].other.input;if(o&&l){if(i.id==u.id&&n==j&&s.id==o.id&&t==l){return{connector:d[q],source:true};}else{if(s.id==u.id&&t==j&&i.id==o.id&&n==l){return{connector:d[q],source:false};}}}else{if(i==u&&n==j){return{connector:d[q],source:true};}else{if(s==u&&t==j){return{connector:d[q],source:false};}}}}}}};apf.flow.isConnector=function(a){var i=apf.flow.objCanvases;for(var d in i){if(i[d].htmlConnectors[a.id]){return i[d].htmlConnectors[a.id];}}};apf.flow.getCanvas=function(c){var a=apf.flow.isCanvas(c);if(!a){a=new apf.flow.canvas(c);a.initCanvas();}return a;};apf.flow.removeCanvas=function(c){var a=apf.flow.isCanvas(c);a.destroy();};apf.flow.addBlock=function(d,c,a){if(d&&!apf.flow.isBlock(d)){if(!d.getAttribute("id")){apf.setUniqueHtmlId(d);}var i=new apf.flow.block(d,c,a);i.initBlock();return i;}};apf.flow.removeBlock=function(a){var c=apf.flow.isBlock(a);c.destroy();};apf.flow.addConnector=function(m,a,l,j){var i=m.htmlElement.appendChild(document.createElement("div"));this.newConnector=new apf.flow.connector(i,m,a,l,j);this.newConnector.initConnector();};apf.flow.removeConnector=function(c){var a=apf.flow.isConnector(c);if(a){a.destroy();}delete a;};apf.layout={layouts:{},addParent:function(c,a){var d;if(!(d=c.getAttribute("id"))){d=apf.setUniqueHtmlId(c);}return this.layouts[d]={layout:new apf.layoutParser(c,a),controls:[]};},splitters:{},freesplitters:[],vars:{},getSplitter:function(a){if(!this.splitters[this.getHtmlId(a.parentNode)]){this.splitters[this.getHtmlId(a.parentNode)]=[];}if(this.freesplitters.length){var c=this.freesplitters.pop();}else{var c=new apf.splitter();var d=apf.findHost(a.parentNode)||apf.document.documentElement;c.parentNode=d;c.skinset=apf.getInheritedAttribute(d,"skinset");c.dispatchEvent("DOMNodeInsertedIntoDocument");}this.splitters[this.getHtmlId(a.parentNode)].push(c);return c;},clearSplitters:function(d){var a=this.splitters[this.getHtmlId(d.parentNode)];if(!a){return;}for(var c=0;c<a.length;c++){this.freesplitters.push(a[c]);if(!a[c].$ext.parentNode){continue;}a[c].$ext.parentNode.removeChild(a[c].$ext);}a.length=0;},get:function(d,a){var c=this.layouts[d.getAttribute("id")];if(!c){c=this.addParent(d,a);}return c;},isLoadedXml:function(j){var a=j.childNodes;var l=j.selectSingleNode(".//node[@name]");var i=l?self[l.getAttribute("name")]:null;var d=i.$ext.parentNode;var c=this.getHtmlId(d);return(this.loadedXml[c]==j);},$loadFrom:function(a){apf.getData(a,{callback:function(c){if(!c){return;}apf.layout.loadXml(c);}});},loadedXml:{},cacheXml:{},loadXml:function(m){var a=m.childNodes;var o=m.selectSingleNode(".//node[@name]");var l=o?self[o.getAttribute("name")]:null;var j=l.$ext.parentNode;var n=this.get(j,apf.getBox(m.getAttribute("margin")||""));var d=this.getHtmlId(j);this.metadata=[];for(var c=0;c<a.length;c++){if(a[c].nodeType!=1){continue;}n.root=this.parseXml(a[c],n);break;}this.compile(j);if(apf.window.inited){this.activateRules(j);}this.loadedXml[d]=m;},metadata:[],getData:function(a,c){return{vbox:(a=="vbox"),hbox:(a=="hbox"),node:"vbox|hbox".indexOf(a)==-1,children:[],isRight:false,isBottom:false,edgeMargin:0,splitter:null,minwidth:0,minheight:0,weight:1,pHtml:c.parentNode,size:[300,200],position:[0,0],last:{},copy:function(){var j=apf.extend({},this);if(!this.node){j.children=[];for(var d=0;d<this.children.length;d++){j.children[d]=this.children[d].copy();j.children[d].parent=j;}}return j;},setPosition:function(d,i){this.oHtml.style.left=d+"px";this.oHtml.style.top=i+"px";this.position=[d,i];},setFloat:function(){var i=apf.getDiff(this.oHtml);this.oHtml.style.width=(this.size[0]-i[0])+"px";if(this.state<0){this.oHtml.style.height=(this.size[1]-i[1])+"px";}this.prehide();this.hidden=3;if(this.hid){var d=apf.lookup(this.hid);if(d.syncAlignment){d.syncAlignment(this);}}},unfloat:function(){if(this.hidden!=3){return;}this.show();},state:-1,minimize:function(d){if(this.state<0){this.lastfheight=this.fheight;this.fheight=""+d;this.lastsplitter=this.splitter;if(this.parent.vbox){this.splitter=-1;}this.state=1;}},restore:function(){if(this.state>0){this.fheight=this.lastfheight;this.splitter=this.lastsplitter;this.state=-1;}},hidden:false,hiddenChildren:[],prehide:function(m){if(this.hidden==3){this.hidden=true;if(this.hid){apf.lookup(this.hid).visible=false;}if(this.oHtml){this.oHtml.style.display="none";}return;}if(this.hidden&&!m){return;}if(!this.parent){return;}this.hidepos={prev:this.parent.children[this.stackId-1],next:this.parent.children[this.stackId+1]};this.hidden=true;var j,s,q=0,n,d,o=["children","hiddenChildren"];while(o.length){j=this.parent[o.pop()];for(n=0,d=j.length;n<d;n++){s=j[n];if(s!=this&&!s.hidden){q=1;break;}}}if(!q){this.parent.prehide(m);}if(m){return this.hide(true);}if(apf.layout.dlist.contains(this)){apf.layout.dlist.remove(this);return false;}else{apf.layout.dlist.pushUnique(this);}},preshow:function(d){if(!this.hidden){return;}this.hidden=false;if(d){return this.show(true);}if(this.parent.hidden){this.parent.preshow();}if(apf.layout.dlist.contains(this)){apf.layout.dlist.remove(this);return false;}else{apf.layout.dlist.pushUnique(this);}},hide:function(j){var d=this.parent.children;d.removeIndex(this.stackId);for(var l=0;l<d.length;l++){d[l].stackId=l;}this.parent.hiddenChildren.push(this);if(j){return;}if(this.hidden!=3){if(this.hid){apf.lookup(this.hid).visible=false;}if(this.oHtml){this.oHtml.style.display="none";}}},show:function(j){var d=this.parent.children;if(this.hidepos.prev&&this.hidepos.prev.parent==this.parent&&!this.hidepos.prev.hidden&&!apf.layout.dlist.contains(this.hidepos.prev)){if(d.length<this.hidepos.prev.stackId+1){d.push(this);}else{d.insertIndex(this,this.hidepos.prev.stackId+1);}}else{if(this.hidepos.next&&this.hidepos.next.parent==this.parent&&!this.hidepos.next.hidden&&!apf.layout.dlist.contains(this.hidepos.next)){if(this.hidepos.next.stackId==0){d.unshift(this);}else{if(d.length<this.hidepos.next.stackId-1){d.push(this);}else{d.insertIndex(this,this.hidepos.next.stackId-1);}}}else{if(!this.hidepos.prev){d.unshift(this);}else{if(!this.hidepos.next){d.push(this);}else{if(this.stackId<d.length){d.insertIndex(this,this.stackId);}else{d.push(this);}}}}}for(var l=0;l<d.length;l++){if(d[l]){d[l].stackId=l;}}this.parent.hiddenChildren.remove(this);if(!j){if(this.hidden!=3){if(this.hid){apf.lookup(this.hid).visible=true;}if(this.oHtml){this.oHtml.style.display="block";}}}this.hidden=false;this.hidepos=null;},remove:function(){var l=this.parent;if(!l){return;}if(this.hidden||l.hiddenChildren.contains(this)){l.hiddenChildren.remove(this);apf.layout.dlist.remove(this);}else{var d=l.children;d.remove(this);for(var j=0;j<d.length;j++){d[j].stackId=j;}}for(var m in this.last){if(m=="splitter"){if(l.originalMargin){if(l.parent.pOriginalMargin){l.parent.splitter=null;l.parent.edgeMargin=l.parent.pOriginalMargin[0];l.parent.pOriginalMargin=null;delete l.last.splitter;}l.splitter=null;l.edgeMargin=l.originalMargin[0];l.originalMargin=null;}}this[m]=l[m]||this.last[m];}this.last={};if(!l.children.length&&!l.hiddenChildren.length){l.remove();}this.parent=null;},add:function(l){this.parent=l;if(this.hidden){var d=l.hiddenChildren;d.push(this);}else{var d=l.children;d.push(this);for(var j=0;j<d.length;j++){if(d[j]){d[j].stackId=j;}}}}};},parseXml:function(x,layout,amlNode,norecur){var aData=this.getData(typeof amlNode=="string"?amlNode:x.localName||x[apf.TAGNAME],layout.layout);if(aData.node){if(!amlNode){amlNode=self[x.getAttribute("name")];}aData.oHtml=amlNode.$ext;amlNode.aData=aData;amlNode.$setLayout("alignment");var aml=amlNode;if(aml.getAttribute("width")){aData.fwidth=aml.getAttribute("width");}if(aml.getAttribute("height")){aData.fheight=aml.getAttribute("height");}if(!this.getHtmlId(aData.oHtml)){apf.setUniqueHtmlId(aData.oHtml);}aData.id=this.getHtmlId(aData.oHtml);if(aData.oHtml.style){aData.oHtml.style.position="absolute";}aData.hid=amlNode.$uniqueId;}else{aData.id=this.metadata.push(aData)-1;}if(x.getAttribute("align")){aData.template=x.getAttribute("align");}if(x.getAttribute("lean")){aData.isBottom=x.getAttribute("lean").match(/bottom/);}if(x.getAttribute("lean")){aData.isRight=x.getAttribute("lean").match(/right/);}if(x.getAttribute("edge")&&x.getAttribute("edge")!="splitter"){aData.edgeMargin=x.getAttribute("edge");}if(x.getAttribute("weight")){aData.weight=parseFloat(x.getAttribute("weight"));}if(x.getAttribute("splitter")||x.getAttribute("edge")=="splitter"){aData.splitter=x.getAttribute("splitter")||(x.getAttribute("edge")=="splitter"?4:false);}if(x.getAttribute("width")){aData.fwidth=String(apf.parseExpression(x.getAttribute("width")));}if(x.getAttribute("height")){aData.fheight=String(apf.parseExpression(x.getAttribute("height")));}if(x.getAttribute("lastsplitter")){aData.lastsplitter=x.getAttribute("lastsplitter");}if(x.getAttribute("hidden")){aData.hidden=(x.getAttribute("hidden")==3)?x.getAttribute("hidden"):apf.isTrue(x.getAttribute("hidden"));}else{if(x.getAttribute("visible")=="false"){aData.hidden=true;}}if(x.getAttribute("state")){aData.state=x.getAttribute("state");}if(x.getAttribute("stack")){aData.stackId=parseInt(x.getAttribute("stack"));}if(x.getAttribute("position")){aData.position=x.getAttribute("position").split(",");}if(x.getAttribute("size")){aData.size=x.getAttribute("size").split(",");}if(aData.fwidth&&aData.fwidth.indexOf("/")>-1){aData.fwidth=eval(aData.fwidth);if(aData.fwidth<=1){aData.fwidth=(aData.fwidth*100)+"%";}}if(aData.fheight&&aData.fheight.indexOf("/")>-1){aData.fheight=eval(aData.fheight);if(aData.fheight<=1){aData.fheight=(aData.fheight*100)+"%";}}aData.edgeMargin=Math.max(aData.splitter||0,aData.edgeMargin||0);if(aData.node&&amlNode.syncAlignment){amlNode.syncAlignment(aData);}if(!norecur&&!aData.node){var nodes=x.childNodes;for(var last,a,i=0;i<nodes.length;i++){if(nodes[i].nodeType!=1){continue;}a=this.parseXml(nodes[i],layout);if(last&&last.hidden){last.hidepos.next=a;}if(a.hidden){if(a.hid){var j=apf.lookup(a.hid);if(a.hidden===true&&j.visible){j.visible=false;a.oHtml.style.display="none";}if(a.hidden==3){var diff=apf.getDiff(a.oHtml);a.oHtml.style.left=a.position[0]+"px";a.oHtml.style.top=a.position[1]+"px";a.oHtml.style.width=(a.size[0]-diff[0])+"px";a.oHtml.style.height=((!this.state||this.state<0?a.size[1]:a.fheight)-diff[1])+"px";}}aData.hiddenChildren.push(a);a.hidepos={prev:aData.children[aData.children.length-1]};}else{if(a.hid){var j=apf.lookup(a.hid);if(!j.visible){j.visible=true;a.oHtml.style.display="block";}}a.stackId=aData.children.push(a)-1;}a.parent=aData;last=a;}}aData.xml=x;return aData;},getXml:function(d){var a=apf.layout.get(d);var c=a.root.xml?a.root.xml.ownerDocument.createElement("layout"):apf.xmldb.getXml("<layout />");apf.layout.parseToXml(a.root,c);return c;},saveXml:function(){for(var m in this.loadedXml){var j=this.loadedXml[m];var c=this.layouts[m];var a=c.root;for(var d=j.childNodes.length-1;d>=0;d--){j.removeChild(j.childNodes[d]);}this.parseToXml(a,j);}},parseToXml:function(n,a){var l=n.xml?n.xml.cloneNode(false):a.ownerDocument.createElement(n.vbox?"vbox":(n.hbox?"hbox":"node"));a.appendChild(l);if(n.template){l.setAttribute("align",n.template);}if(n.edgeMargin){l.setAttribute("edge",n.edgeMargin);}if(n.weight){l.setAttribute("weight",n.weight);}if(n.splitter){l.setAttribute("splitter",n.splitter===false?-1:n.splitter);}if(n.fwidth){l.setAttribute("width",n.fwidth);}if(n.fheight){l.setAttribute("height",n.fheight);}if(n.minwidth){l.setAttribute("minwidth",n.minwidth);}if(n.minheight){l.setAttribute("minheight",n.minheight);}if(n.lastfheight){l.setAttribute("lastheight",n.lastfheight);}if(n.lastsplitter){l.setAttribute("lastsplitter",n.lastsplitter);}if(n.hidden){l.setAttribute("hidden",(n.hidden==3)?"3":"true");}else{if(l.getAttribute("hidden")){l.removeAttribute("hidden");}}if(n.stackId){l.setAttribute("stack",n.stackId);}if(n.state>0){l.setAttribute("state",n.state);}else{if(l.getAttribute("state")){l.removeAttribute("state");}}if(n.position){l.setAttribute("position",n.position.join(","));}if(n.size){l.setAttribute("size",n.size.join(","));}var m=n.children.copy();for(var j=0;j<n.hiddenChildren.length;j++){var d=n.hiddenChildren[j].hidepos;if(d.prev){var c=m.indexOf(d.prev);if(c<0){m.unshift(n.hiddenChildren[j]);}else{m.insertIndex(n.hiddenChildren[j],c);}}else{if(d.next){var c=m.indexOf(d.next);if(c-1<0){m.unshift(n.hiddenChildren[j]);}else{m.insertIndex(n.hiddenChildren[j],c-1);}}else{m.push(n.hiddenChildren[j]);}}}for(var j=0;j<m.length;j++){this.parseToXml(m[j],l);}},checkInheritance:function(l){var j=l.children[l.children.length-1];if(l.originalMargin){if(l.parent.pOriginalMargin){l.parent.splitter=null;l.parent.edgeMargin=l.parent.pOriginalMargin[0];l.parent.pOriginalMargin=null;l.splitter=l.last.splitter;delete l.last.splitter;}l.splitter=null;var a=l.originalMargin[1];l.edgeMargin=l.originalMargin[0];a.splitter=a.splitter===false?false:a.last.splitter;l.originalMargin=null;delete a.last.splitter;}if(j&&j.template&&(j.splitter||j.splitter===null&&l.originalMargin)&&l.parent){if(!l.splitter){j.last.splitter=l.splitter=j.splitter;l.originalMargin=[l.edgeMargin,j];l.edgeMargin=Math.max(l.edgeMargin,l.splitter);}j.splitter=null;if(l.parent&&l.stackId==l.parent.children.length-1&&(l.parent.parent&&l.parent.parent.children.length>1)){if(!l.parent.splitter){l.last.splitter=l.parent.splitter=l.splitter;l.parent.last.splitter=null;l.parent.edgeMargin=Math.max(l.parent.edgeMargin,l.parent.splitter);l.parent.pOriginalMargin=[l.parent.edgeMargin];}l.splitter=null;}else{if(l.parent.pOriginalMargin){l.parent.splitter=null;l.parent.edgeMargin=l.parent.pOriginalMargin[0];l.parent.pOriginalMargin=null;l.splitter=l.last.splitter;delete l.last.splitter;}}}for(var d=0;d<l.children.length;d++){if(!l.children[d].node){this.checkInheritance(l.children[d]);}}var m=l.children[0];if(m&&l.parent){if(l.vbox){if(!l.fwidth&&m.fwidth||m.last.fwidth&&m.fwidth!==null&&m.last.fwidth==l.fwidth){m.last.fwidth=l.fwidth=m.fwidth;m.fwidth=null;}var c=l.parent;if((c&&!c.fheight&&m.fheight||m.last.fheight&&m.fheight!==null&&m.last.fheight==c.fheight)&&l.children.length==1){m.last.fheight=c.fheight=m.fheight;m.fheight=null;}}else{if((!l.fheight&&m.fheight||m.last.fheight&&m.fheight!==null&&m.last.fheight==l.fheight)&&l.children.length==1){m.last.fheight=l.fheight=m.fheight;m.fheight=null;}}if(m.weight||m.last.weight&&m.last.weight==l.weight){m.last.weight=l.weight=m.weight;}}},compileAlignment:function(c){if(!c.children.length){this.removeRule(c.pHtml,"layout");var a=this.layouts[c.pHtml.getAttribute("id")];if(a){apf.layout.clearSplitters(a.layout);}return;}var m=c.children;for(var j=false,d=0;d<m.length;d++){if(m[d].template=="bottom"){if(m[d].splitter){m[d-1].splitter=m[d].splitter;m[d].splitter=null;}m[d-1].edgeMargin=Math.max(m[d].edgeMargin,m[d-1].edgeMargin||0,m[d-1].splitter||0);m[d].edgeMargin=null;}if(m[d].hidden){m[d].prehide(true);}}this.checkInheritance(c);var a=this.layouts[c.pHtml.getAttribute("id")];a.layout.compile(c.copy());a.layout.reset();},addAlignNode:function(o,c){var B=(typeof o.align=="undefined"?o.getAttribute("align"):o.align).split("-");var E=c.children;var C=o.aData;if(typeof o.splitter=="undefined"){if(B[1]=="splitter"){C.splitter=B[2]||4;}else{C.splitter=false;}}C.edgeMargin=Math.max(C.edgeMargin,C.splitter||0);B=B[0];C.template=B;if(B=="top"){for(var d=E.length,u=0;u<E.length;u++){if(E[u].template!="top"){d=u;break;}}for(var u=E.length-1;u>=d;u--){E[u+1]=E[u];E[u].stackId=u+1;}E[d]=C;E[d].stackId=d;C.parent=c;}else{if(B=="bottom"){C.stackId=E.push(C)-1;C.parent=c;}else{var t=null;for(var d=-1,u=0;u<E.length;u++){if(E[u].hbox){t=E[u];break;}else{if(E[u].node&&E[u].template=="top"){d=u;}}}if(!t){var q=apf.layout.get(c.pHtml);t=apf.layout.parseXml(apf.xmldb.getXml("<hbox />"),q,null,true);t.parent=c;if(d>-1){for(var u=E.length-1;u>d;u--){E[u+1]=E[u];E[u].stackId++;}E[d+1]=t;t.stackId=d+1;}else{t.stackId=E.unshift(t)-1;}}var m,j=t.children.concat(t.hiddenChildren);for(var u=0;u<j.length;u++){if(j[u].template==B){m=j[u];break;}}j=t.children;if(!m){var q=apf.layout.get(c.pHtml);m=apf.layout.parseXml(apf.xmldb.getXml("<vbox />"),q,null,true);m.parent=t;m.template=B;if(B=="left"){if(!C.fwidth){var z;for(var D=false,u=0;u<j.length;u++){if(j[u].template=="middle"){D=j[u];break;}}if(D&&!D.children.length){j.remove(D);for(var u=0;u<j.length;u++){j[u].stackId=u;}}}j.unshift(m);for(var u=0;u<j.length;u++){j[u].stackId=u;}}else{if(B=="right"){if(C.fwidth){var z;for(var D=false,u=0;u<j.length;u++){if(j[u].template=="middle"||j[u].template=="left"&&!j[u].fwidth){D=true;break;}}if(!D){z=apf.layout.parseXml(apf.xmldb.getXml("<vbox />"),q,null,true);z.parent=t;z.template="middle";z.stackId=j.push(z)-1;}}m.stackId=j.push(m)-1;}else{if(B=="middle"){for(var A,u=0;u<j.length;u++){if(j[u].template=="right"){A=u;}}var w=j[A];if(w){j[A]=m;m.stackId=A;w.stackId=j.push(w)-1;}else{m.stackId=j.push(m)-1;}}}}}C.stackId=m.children.push(C)-1;C.parent=m;if(m.hidden){m.preshow(true);}}}},compile:function(d){var c=this.layouts[d.getAttribute("id")];if(!c){return false;}var a=c.root.copy();c.layout.compile(a);c.layout.reset();},removeAll:function(c){c.children.length=null;this.compileAlignment(c);var a=this.getHtmlId(c.pHtml);if(!this.rules[a]){delete this.qlist[a];}},timer:null,qlist:{},dlist:[],$hasQueue:false,queue:function(c,d,a){this.$hasQueue=true;var i;if(!(i=this.getHtmlId(c))){i=apf.setUniqueHtmlId(c);}if(this.qlist[i]){if(d){this.qlist[i][2].push(d);}if(a){this.qlist[i][1]=a;}return;}this.qlist[i]=[c,a,[d]];if(!this.timer){this.timer=$setTimeout("apf.layout.processQueue()");}},processQueue:function(){clearTimeout(this.timer);this.timer=null;this.$hasQueue=false;var c,m,a,j,d;for(c=0;c<this.dlist.length;c++){if(this.dlist[c].hidden){this.dlist[c].hide();}else{this.dlist[c].show();}}for(m in this.qlist){j=this.qlist[m];if(j[1]){apf.layout.compileAlignment(j[1]);}d=j[2];for(c=0,a=d.length;c<a;c++){if(d[c]){d[c].$updateLayout();}}apf.layout.activateRules(j[0]);}if(apf.hasSingleRszEvent){apf.layout.forceResize();}this.qlist={};this.dlist=[];},rules:{},onresize:{},getHtmlId:function(a){return a.getAttribute?a.getAttribute("id"):1;},setRules:function(d,j,i,c){if(!this.getHtmlId(d)){apf.setUniqueHtmlId(d);}if(!this.rules[this.getHtmlId(d)]){this.rules[this.getHtmlId(d)]={};}var a=this.rules[this.getHtmlId(d)][j];if(!c&&a){this.rules[this.getHtmlId(d)][j]=i+"\n"+a;}else{this.rules[this.getHtmlId(d)][j]=i;}},getRules:function(a,c){return c?this.rules[this.getHtmlId(a)][c]:this.rules[this.getHtmlId(a)];},removeRule:function(i,m){var c=this.getHtmlId(i);if(!this.rules[c]){return;}var d=this.rules[c][m]||false;delete this.rules[c][m];var l;for(l in this.rules[c]){}if(!l){delete this.rules[c];}if(apf.hasSingleRszEvent){if(this.onresize[c]){this.onresize[c]=null;}else{var j=i.parentNode;while(j&&j.nodeType==1&&!this.onresize[j.getAttribute("id")]){j=j.parentNode;}if(j&&j.nodeType==1){var a=this.onresize[j.getAttribute("id")];if(a.children){delete a.children[c];}}}}return d;},activateRules:function(j,o){if(!j){var a,l;for(a in this.rules){l=document.getElementById(a);if(!l||l.onresize){continue;}this.activateRules(l);}if(apf.hasSingleRszEvent&&window.onresize){window.onresize();}return;}var m,i,q,u,t=[];if(!apf.hasSingleRszEvent){u=this.rules[this.getHtmlId(j)];if(!u){j.onresize=null;return false;}for(i in u){if(typeof u[i]!="string"){continue;}t.push(u[i]);}m=apf.needsCssPx?new Function(t.join("\n")):new Function(t.join("\n").replace(/ \+ 'px'|try\{\}catch\(e\)\{\}\n/g,""));j.onresize=m;if(!o){m();}}else{var d=this.getHtmlId(j);u=this.rules[d];if(!u){return false;}for(i in u){if(typeof u[i]!="string"){continue;}t.push(u[i]);}var c=j.parentNode;while(c&&c.nodeType==1&&!this.onresize[c.getAttribute("id")]){c=c.parentNode;}var n=new Function(t.join("\n"));if(this.onresize[d]){n.children=this.onresize[d].children;}if(c&&c.nodeType==1){var s=this.onresize[c.getAttribute("id")];(s.children||(s.children={}))[d]=n;}else{this.onresize[d]=n;}if(!o){n();}if(!window.onresize){var m=function(A){try{var C=[];for(var w in A){C.unshift(A[w]);}for(var z=0;z<C.length;z++){C[z]();if(C[z].children){m(C[z].children);}}}catch(B){}};window.onresize=function(){m(apf.layout.onresize);};}}},forceResize:function(m){if(apf.hasSingleRszEvent){return window.onresize&&window.onresize();}var c=m.onresize;if(c){c();}var j=m.getElementsByTagName("*");for(var d=0,a=j.length;d<a;d++){if(j[d].onresize){j[d].onresize();}}},paused:{},pause:function(c,d){if(apf.hasSingleRszEvent){var a=this.getHtmlId(c);this.paused[a]=this.onresize[a]||true;if(d){this.onresize[a]=d;this.onresize[a].children=this.paused[a].children;d();}else{delete this.onresize[a];}}else{this.paused[this.getHtmlId(c)]=c.onresize||true;if(d){c.onresize=d;d();}else{c.onresize=null;}}},play:function(c){if(!this.paused[this.getHtmlId(c)]){return;}if(apf.hasSingleRszEvent){var a=this.getHtmlId(c);var d=this.paused[a];if(typeof d=="function"){this.onresize[a]=d;}else{delete this.onresize[a];}if(window.onresize){window.onresize();}this.paused[this.getHtmlId(c)]=null;}else{var d=this.paused[this.getHtmlId(c)];if(typeof d=="function"){c.onresize=d;d();}else{c.onresize=null;}this.paused[this.getHtmlId(c)]=null;}}};apf.layout.load=apf.layout.loadXml;apf.getWindowWidth=function(){return apf.isIE?document.documentElement.offsetWidth-(apf.isIE8?4:0):window.innerWidth;};apf.getWindowHeight=function(){return apf.isIE?document.documentElement.offsetHeight-(apf.isIE8?4:0):window.innerHeight;};apf.layoutParser=function(a,d){d=(d&&d.length==4)?d:[0,0,0,0];this.pMargin=d;this.RULES=[];this.parentNode=a;if(!this.parentNode.getAttribute("id")){apf.setUniqueHtmlId(this.parentNode);}var l={};var i=0;var j=0;this.createSplitters=true;this.setMargin=function(m){d=m;};this.reset=function(){this.RULES=[];l={};this.lastType=this.globalEdge=this.globalSplitter=null;};this.compile=function(m,n){this.addRule("var v = apf.layout.vars");this.globalSplitter=m.splitter;this.globalEdge=m.edgeMargin;if(this.globalSplitter||this.globalEdge){this.setglobals(m);}this.preparse(m);this.parserules(m);if(this.createSplitters){apf.layout.clearSplitters(this);this.parsesplitters(m);}this.RULES=new c().calc(this.RULES);var o=("try{"+this.RULES.join("}catch(e){}\ntry{")+"}catch(e){}\n").replace(/([^=]+\.style[^=]+) = (.*?)\}/g,"$1 = ($2) + 'px'}");if(!apf.hasHtmlIdsInJs){o=o.replace(/q([\w|]+)\.(offset|style)/g,'document.getElementById("q$1").$2');}this.lastRoot=m;if(!n){apf.layout.setRules(this.parentNode,"layout",o,true);apf.layout.queue(this.parentNode);}else{return o;}return false;};this.addRule=function(m){this.RULES.push(m);};this.setglobals=function(n,o){if(!o&&this.globalEdge&&!n.edgeMargin&&(!n.xml||!n.xml.getAttribute("edge"))){if(!n.splitter){n.splitter=this.globalSplitter;}n.edgeMargin=Math.max(this.globalSplitter,this.globalEdge);}if(n.node){return;}for(var m=0;m<n.children.length;m++){this.setglobals(n.children[m],m==n.children.length-1);}};this.preparse=function(n){if(n.node){return;}else{var A=n.vbox?"height":"width";var q=0;var z=0;var F=0;n.childweight=0;n.childminwidth=0;n.childminheight=0;var E=["v."+A+"_"+n.id],o=[];var m=n.children;for(var t=0;t<m.length;t++){if(t<m.length-1){E.push(" - "+m[t].edgeMargin);}var w=m[t]["f"+A];if(w){o.push((w.indexOf("%")>-1)?" - ("+(m[t]["calc"+A]="v.innerspace_"+n.id+" * "+parseFloat(w)/100)+")":" - ("+w+")");}else{n.childweight+=m[t].weight;m[t]["calc"+A]="Math."+(t%2==0?"ceil":"floor")+"(v.restspace_"+n.id+" * ("+m[t].weight+"/v.weight_"+n.id+"))";}var u=(n.vbox?"width":"height");var C=m[t]["f"+u];if(!C){m[t]["calc"+u]=(n.vbox?"v.width_":"v.height_")+n.id;}else{m[t]["calc"+u]=C.indexOf("%")>-1?"v.innerspace_"+n.id+" * "+parseFloat(C)/100:C;}if(m[t].node&&m[t].xml.visible!==false){m[t].oHtml.style.display="block";}else{this.preparse(m[t]);}if(n.vbox){n.childminheight+=Math.max(m[t].childminheight||0,m[t].minheight||0,10)+m[t].edgeMargin;n.childminwidth=Math.max(n.childminwidth,m[t].minwidth||m[t].childminwidth||10);}else{n.childminwidth+=Math.max(m[t].minwidth||0,m[t].childminwidth||0,10)+m[t].edgeMargin;n.childminheight=Math.max(n.childminheight,m[t].minheight||m[t].childminheight||10);}}n.innerspace=E.join("");n.restspace=n.innerspace+" "+o.join("");if(!n.parent){var s=0,I=0;if(this.parentNode.tagName.toLowerCase()!="body"){var B=apf.getDiff(this.parentNode);I=B[0];s=B[1];}var G=(this.parentNode.tagName.toLowerCase()=="body"?"apf.getWindowWidth()":"document.getElementById('"+this.parentNode.id+"').offsetWidth");var D=(this.parentNode.tagName.toLowerCase()=="body"?"apf.getWindowHeight()":"document.getElementById('"+this.parentNode.id+"').offsetHeight");n.calcwidth="Math.max("+i+", "+G+" - "+(d[1])+" - "+d[3]+" - "+s+")";n.calcheight="Math.max("+j+", "+D+" - "+(d[2])+" - "+d[0]+" - "+I+")";}}};this.parserules=function(t){if(!t.node){this.addRule("v.width_"+t.id+" = Math.max("+t.childminwidth+","+t.minwidth+","+(t.calcwidth||t.fwidth)+")");this.addRule("v.height_"+t.id+" = Math.max("+t.childminheight+","+t.minheight+","+(t.calcheight||t.fheight)+")");this.addRule("v.weight_"+t.id+" = "+t.childweight);this.addRule("v.innerspace_"+t.id+" = "+t.innerspace);this.addRule("v.restspace_"+t.id+" = "+t.restspace);var n=apf.layout.metadata[t.id];n.calcData=t;t.original=n;if(!t.parent){this.addRule("v.left_"+t.id+" = "+d[3]);this.addRule("v.top_"+t.id+" = "+d[0]);for(var q=0;q<t.children.length;q++){this.parserules(t.children[q]);}return;}else{var z=["v.top_"+t.id," = "];var B=["v.left_"+t.id," = "];}}else{var z=[t.id,".style.top = "];var B=[t.id,".style.left = "];if(t.hid){var n=apf.lookup(t.hid).aData;n.calcData=t;t.original=n;}var s=t.oHtml;var w=apf.getDiff(s);var A=w[1];var o=w[0];if(t.calcwidth){this.addRule(t.id+".style.width = -"+o+" + Math.max( "+t.calcwidth+", "+t.minwidth+")");}else{s.style.width=Math.max(0,t.fwidth-o)+"px";}if(t.calcheight){this.addRule(t.id+".style.height = -"+A+" + Math.max( "+t.calcheight+", "+t.minheight+")");}else{s.style.height=Math.max(0,t.fheight-A)+"px";}}var m=t.parent.children[t.stackId-1];var u=t.parent.children[t.stackId+1];if(t.parent.vbox){if(t.parent.isBottom){if(!u){z.push("v.top_",t.parent.id," + v.height_",t.parent.id," - ",t.id,".offsetHeight");}else{if(u.node){z.push(u.id,".offsetTop - ",u.edgeMargin," - ",t.id,".offsetHeight");}else{z.push("v.top_"+u.id," - ",u.edgeMargin," - ",(t.node?t.id+".offsetHeight":"v.height_"+t.id));}}}else{if(!t.stackId){z.push("v.top_"+t.parent.id);}else{if(m){if(m.node){z.push(m.id,".offsetTop + ",m.id,".offsetHeight + ",m.edgeMargin);}else{z.push("v.top_",m.id," + v.height_",m.id," + ",m.edgeMargin);}}}}}else{z.push("v.top_"+t.parent.id);}if(t.parent.hbox){if(t.parent.isRight){if(!u){B.push("v.left_",t.parent.id," + v.width_",t.parent.id," - ",(t.node?t.id+".offsetWidth":"v.width_"+t.id),null);}else{if(u.node){B.push(u.id,".offsetLeft - ",u.edgeMargin," - ",(t.node?t.id+".offsetWidth":"v.width_"+t.id));}else{B.push("v.left_"+u.id," - ",u.edgeMargin," - ",(t.node?t.id+".offsetWidth":"v.width_"+t.id));}}}else{if(!t.stackId){B.push("v.left_"+t.parent.id);}else{if(m){if(m.node){B.push(m.id,".offsetLeft + ",m.id,".offsetWidth + ",m.edgeMargin);}else{B.push("v.left_",m.id," + v.width_",m.id," + ",m.edgeMargin);}}}}}else{B.push("v.left_"+t.parent.id);}if(B.length>2){this.addRule(B.join(""));}if(z.length>2){this.addRule(z.join(""));}if(!t.node){for(var q=0;q<t.children.length;q++){this.parserules(t.children[q]);}}};this.parsesplitters=function(n){if(n.parent&&n.splitter>0){apf.layout.getSplitter(this).init(n.splitter,n.hid,n);}if(!n.node){for(var m=0;m<n.children.length;m++){this.parsesplitters(n.children[m]);}}};function c(){this.parselookup={};this.nRules=[];this.doneRules={};this.maskText=function(q,o,n,m){return o+".offset"+n.toUpperCase();};this.handleVar=function(q,o,n,m){var s="a"+o.replace(/\|/g,"_")+"_style_"+n.toLowerCase();return l[s]?s:q;};this.parseRule=function(t){var o=t.split(" = "),w=o[0].replace(/^([_\w\d\|]+)\.style\.(\w)/,this.maskText),s="a"+o[0].replace(/[\.\|]/g,"_");l[s]=true;var q=o[1].split(/[ \(\)]/),u=[],m;for(var n=0;n<q.length;n++){if(q[n].match(/^([_\w\d\|]+)\.offset(\w+)$/)&&!q[n].match(/PNODE/)){u.push(q[n]);}}if(s.match(/width|height/i)){o[1]=o[1].replace(/^(\s*[\-\d]+[\s\-\+]+)/,"");m=o[0]+" = "+RegExp.$1+s;}else{m=o[0]+" = "+s;}if(t.match(/^v\./)){return{id:w,rule_p1:o[0]+" = ",rule_p2:o[1],ruleb:null,deps:u,processed:false};}return{id:w,rule_p1:"var "+s+" = ",rule_p2:o[1],ruleb:m,deps:u,processed:false};};this.calc=function(q){var n,u,t="";for(n=0;n<q.length;n++){if(q[n].match(/^var/)){this.nRules.push(q[n]);continue;}var s=this.parseRule(q[n],n);this.parselookup[s.id]=s;}for(u in this.parselookup){this.processNode(this.parselookup[u]);}for(u in this.parselookup){var m=this.parselookup[u];this.walkRules(m);}for(u in this.parselookup){this.nRules.push(this.parselookup[u].ruleb);}return this.nRules;};this.walkRules=function(m){if(this.doneRules[m.id]){return;}for(var n=0;n<m.deps.length;n++){if(m.deps[n]&&!m.deps[n].walked&&!this.doneRules[m.deps[n].id]){m.deps[n].walked=true;this.walkRules(m.deps[n]);}}this.doneRules[m.id]=true;this.nRules.push(m.rule_p1+m.rule_p2.replace(/([_\w\d\|]+)\.offset(\w+)/g,this.handleVar));};this.processNode=function(q){for(var n=0;n<q.deps.length;n++){var m=typeof q.deps[n]=="string"?this.parselookup[q.deps[n]]:q.deps[n];if(!m){q.deps[n]=null;continue;}q.deps[n]=m;if(!m.processed){m.processed=true;this.processNode(m);}}};}};apf.language={automatch:false,loaded:false,prefix:"sub.main.",words:{},texts:{},elements:{},bindings:{},count:0,load:function(a,c){if(!a){return;}if(typeof a=="string"){if(a.charAt(0)=="<"){a=apf.getXmlDom(a).documentElement;}else{return this.loadFrom(a);}}this.parseSection(a,c);this.redraw();this.loaded=true;},loadFrom:function(a){apf.getData(a,{callback:function(c){if(!c){return;}apf.language.load(c);}});},parseSection:function(d,j){if(!j){j=d.getAttribute("id")||"";}if(d.tagName=="key"){j+="/"+d.getAttribute("id");this.words[j]=d.firstChild?d.firstChild.nodeValue:"";return;}if(d.tagName=="group"){j+=(j?"/":"")+d.getAttribute("id");}var a=d.childNodes;for(var c=0;c<a.length;c++){if(a[c].nodeType==1){this.parseSection(a[c],j);}}},redraw:function(){var c,j,a,o,l=this.elements,i;for(c in l){o=l[c],i=apf.all[c];for(a in o){j=o[a];try{if(j.asyncs){return j.call(this,i.xmlRoot,function(s){i.setProperty(a,s,true);});}else{var q=j.call(i,i.xmlRoot);}}catch(n){apf.console.warn("[275] Could not execute language update for "+a+"\n\n"+n.message);continue;}i.setProperty(a,q,true);}}var d,i,m=this.bindings;for(c in m){i=apf.all[c];if(i.selection){d=i.getSelection();i.reload();i.selectList(d);}else{i.reload();}}},getWord:function(a){return this.words[a];},addProperty:function(a,d,c){(this.elements[a.$uniqueId]||(this.elements[a.$uniqueId]={}))[d]=c;},removeProperty:function(a,c){delete (this.elements[a.$uniqueId]||false)[c];},addBinding:function(a){this.bindings[a.$uniqueId]=true;},removeBinding:function(a){delete this.bindings[a.$uniqueId];}};apf.saveData=apf.getData=function(c,o){if(!c){return false;}var q,l=c.charAt(0),n=o.callback;var j=function(u,t,s){var w=o.callback;if(t!=apf.SUCCESS){return w(u,t,s||{});}return w(u,t,s||{});};if(!o){o={};}var i=o.fParsed||(c.indexOf("{")>-1||c.indexOf("[")>-1?apf.lm.compile(c,{withopt:true,precall:o._pc==-1?false:o._pc,alwayscb:true,simplexpath:true}):{str:c,type:2});if(i.type==3){if(i.xpaths[0]){return j(apf.nameserver.get("model",i.xpaths[0]).data.selectSingleNode(i.xpaths[1]),apf.SUCCESS,{});}else{return j(o.xmlNode.data.selectSingleNode(i.xpaths[1]),apf.SUCCESS,{});}}if(l=="<"){if(i.type==2){q=i.str;}else{return i(o.xmlNode,j,o);}}else{if((l=="["||l=="{")){return i(o.xmlNode,j,o);}else{if(i.type==1||i.type==3){var m=n;n=o.callback=function(w,u,s){if(o._pc===true){return;}if(u!=apf.SUCCESS){return m.apply(this,arguments);}var t=w.split(" "),z="get";if(t.length>1&&t[0].length<10){z=t.shift();t=t.join(" ");}else{t=w;}n=o.callback=m;apf.oHttp.exec(z,[t],j,o);};i(o.xmlNode,j,o);}else{if(o._pc===true){return;}var d=c.split(" "),a="get";if(d.length>1&&d[0].length<10){a=d.shift();d=d.join(" ");}else{d=c;}apf.oHttp.exec(a,[d],j,o);}}}if(q){if(n){j(q,apf.SUCCESS,{});}else{return q;}}};apf.setModel=function(a,i){if(!a){return;}var d=a.indexOf("{")>-1||a.indexOf("[")>-1?apf.lm.compile(a,{alwayscb:true}):{type:2,str:a};if(a=="@default"||d.type==2){var c=apf.nameserver.get("model",a);if(c){return c.register(i);}else{if(a=="@default"){return;}}if(a.indexOf(".")==-1&&a.indexOf("/")==-1){return;}}if(d.type==3){if(d.models){if(d.xpaths.length==2&&d.xpaths[0]!="#"&&d.xpaths[1]!="#"){apf.nameserver.get("model",d.xpaths[0]).register(i,d.xpaths[1]);return;}}}if(i.clear){i.clear("loading");}apf.getData(a,{parsed:d,callback:function(n,m,j){if(m!=apf.SUCCESS){throw new Error(apf.formatErrorString(0,null,"Loading new data","Could not load data into model.                 \nMessage: "+j.message+"                \nInstruction: '"+a+"'"));}if(!n){return;}if(typeof n=="string"){if(n.charAt(0)=="<"){n=apf.getXml(n);}else{if(n.indexOf("http://")==0){return apf.setModel(n,i);}else{throw new Error("Invalid data from server");}}}var l=apf.xmldb.findModel(n);if(l){l.register(i,apf.xmlToXpath(n,l.data));}else{new apf.model().register(i).load(n);}}});};apf.storage.modules.gears=apf.storage.modules["gears.sql"]={table_name:"STORAGE",initialized:false,$available:null,$db:null,init:function(){this.factory=apf.nameserver.get("google","gears");this.database_name=apf.config.name+".apf.offline.gears";this.$db=this.factory.create("beta.database","1.0");this.$db.open(this.database_name);try{this.$sql("CREATE TABLE IF NOT EXISTS "+this.table_name+"(  namespace TEXT,  key TEXT,  value TEXT )");this.$sql("CREATE UNIQUE INDEX IF NOT EXISTS namespace_key_index ON "+this.table_name+" (namespace, key)");this.initialized=true;}catch(a){apf.console.warn(a.message);return false;}},$sql:function(c,d){var a=this.$db.execute(c,d);return this.$normalizeResults(a);},destroy:function(){this.$db.close();},$normalizeResults:function(a){var d=[];if(!a){return[];}while(a.isValidRow()){var l={};for(var c=0;c<a.fieldCount();c++){var m=a.fieldName(c);var j=a.field(c);l[m]=j;}d.push(l);a.next();}a.close();return d;},isAvailable:function(){return apf.isGears;},put:function(a,d,c){if(!c){c=this.namespace;}d=apf.serialize(d);try{this.$sql("DELETE FROM "+this.table_name+" WHERE namespace = ? AND key = ?",[c,a]);this.$sql("INSERT INTO "+this.table_name+" VALUES (?, ?, ?)",[c,a,d]);}catch(i){return false;}return true;},get:function(c,d){if(!d){d=this.namespace;}var a=this.$sql("SELECT * FROM "+this.table_name+" WHERE namespace = ? AND  key = ?",[d,c]);if(!a.length){return null;}return apf.unserialize(a[0].value);},getNamespaces:function(){var d=[this.namespace];var a=this.$sql("SELECT namespace FROM "+this.table_name+" DESC GROUP BY namespace");for(var c=0;c<a.length;c++){if(a[c].namespace!=this.namespace){d.push(a[c].namespace);}}return d;},getKeys:function(j){if(!j){j=this.namespace;}var a=this.$sql("SELECT key FROM "+this.table_name+" WHERE namespace = ?",[j]);var d=[];for(var c=0;c<a.length;c++){d.push(a[c].key);}return d;},clear:function(a){if(!a){a=this.namespace;}this.$sql("DELETE FROM "+this.table_name+" WHERE namespace = ?",[a]);},remove:function(a,c){if(!c){c=this.namespace;}this.$sql("DELETE FROM "+this.table_name+" WHERE namespace = ? AND key = ?",[c,a]);},putMultiple:function(j,a,d){if(!d){d=this.namespace;}try{this.$sql.open();this.$sql.db.execute("BEGIN TRANSACTION");var m="REPLACE INTO "+this.table_name+" VALUES (?, ?, ?)";for(var c=0;c<j.length;c++){var l=apf.serialize(a[c]);this.$sql.db.execute(m,[d,j[c],l]);}this.$sql.db.execute("COMMIT TRANSACTION");this.$sql.close();}catch(n){return false;}return true;},getMultiple:function(l,j){if(!j){j=this.namespace;}var m="SELECT * FROM "+this.table_name+" WHERE namespace = ? AND  key = ?";var d=[];for(var c=0;c<l.length;c++){var a=this.$sql(m,[j,l[c]]);d[c]=a.length?apf.unserialize(a[0].value):null;}return d;},removeMultiple:function(d,c){if(!c){c=this.namespace;}this.$sql.open();this.$sql.db.execute("BEGIN TRANSACTION");var j="DELETE FROM "+this.table_name+" WHERE namespace = ? AND key = ?";for(var a=0;a<d.length;a++){this.$sql.db.execute(j,[c,d[a]]);}this.$sql.db.execute("COMMIT TRANSACTION");this.$sql.close();},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.storage.modules.air={init:function(){this.ByteArray=window.runtime.flash.utils.ByteArray;this.EncryptedLocalStore=window.runtime.flash.data.EncryptedLocalStore;},isAvailable:function(){return apf.isAIR;},_getItem:function(a){var c=this.EncryptedLocalStore.getItem("__apf_"+a);return c?c.readUTFBytes(c.length):"";},_setItem:function(c,d){var a=new this.ByteArray();a.writeUTFBytes(d);this.EncryptedLocalStore.setItem("__apf_"+c,a);},_removeItem:function(a){this.EncryptedLocalStore.removeItem("__apf_"+a);},put:function(a,j,c){if(!c){c=this.namespace;}try{var i=this._getItem("namespaces")||"";if(i.indexOf("|"+c+"|")==-1){this._setItem("namespaces",i+c+"|");}var d=this._getItem(c+"_keys")||"";if(d.indexOf("|"+a+"|")==-1){this._setItem(c+"_keys",d+a+"|");}this._setItem("_"+c+"_"+a,j);}catch(l){return false;}return true;},get:function(a,c){if(!c){c=this.namespace;}return this._getItem("_"+c+"_"+a);},getNamespaces:function(){var c=[this.namespace];var d=(this._getItem("namespaces")||"").split("|");for(var a=0;a<d.length;a++){if(d[a]&&d[a]!=this.namespace){c.push(d[a]);}}return c;},getKeys:function(d){if(!d){d=this.namespace;}var c=[];var j=(this._getItem(d+"_keys")||"").split("|");for(var a=0;a<j.length;a++){if(j[a]){c.push(j[a]);}}return c;},clear:function(c){if(!c){c=this.namespace;}var j=this._getItem("namespaces")||"";if(j.indexOf("|"+c+"|")!=-1){this._setItem("namespaces",j.replace("|"+c+"|","|"));}var d=(this._getItem(c+"_keys")||"").split("|");for(var a=0;a<d.length;a++){if(d[a].length){this._removeItem(c+"_"+d[a]);}}this._removeItem(c+"_keys");},remove:function(a,c){if(!c){c=this.namespace;}var d=this._getItem(c+"_keys")||"";if(d.indexOf("|"+a+"|")!=-1){this._setItem(c+"_keys",d.replace("|"+a+"|","|"));}this._removeItem("_"+c+"_"+a);},putMultiple:function(j,a,d){if(!d){d=this.namespace;}try{for(var c=0;c<j.length;c++){this.put(j[c],value[c],null,d);}}catch(l){return false;}return true;},getMultiple:function(j,d){if(!d){d=this.namespace;}var c=[];for(var a=0;a<j.length;a++){c[a]=this.get(j[a],d);}return c;},removeMultiple:function(d,c){if(!c){c=this.namespace;}for(var a=0;a<d.length;a++){this.remove(d[a],c);}},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.storage.modules.memory={initialized:true,store:{},isAvailable:function(){return true;},put:function(a,d,c){if(!c){c=this.namespace;}d=apf.serialize(d);if(!this.store[c]){this.store[c]={};}this.store[c][a]=d;},get:function(a,c){if(!c){c=this.namespace;}if(!this.store[c]||!this.store[c][a]){return null;}return apf.unserialize(this.store[c][a]);},getNamespaces:function(){var a=[this.namespace];for(var c in this.store){a.push(c);}return a;},getKeys:function(c){if(!c){c=this.namespace;}var a=[];for(var d in this.store[c]){a.push(d);}return a;},clear:function(a){if(!a){a=this.namespace;}delete this.store[a];},remove:function(a,c){if(!c){c=this.namespace;}if(this.store[c]){delete this.store[c][a];}},putMultiple:function(j,a,d){if(!d){d=this.namespace;}if(!this.store[d]){this.store[d]={};}for(var c=0;c<j.length;c++){this.store[d][j[c]]=apf.serialize(a[c]);}return true;},getMultiple:function(j,d){if(!d){d=this.namespace;}if(!this.store[d]){return[];}var c=[];for(var a=0;a<j.length;a++){if(this.store[d][j[a]]){c.push(apf.unserialize(this.store[d][j[a]]));}}return c;},removeMultiple:function(d,c){if(!c){c=this.namespace;}if(!this.store[c]){return;}for(var a=0;a<d.length;a++){delete this.store[c][d[a]];}},isPermanent:function(){return false;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.storage.modules.flash={initialized:false,asyncInit:true,_available:null,_statusHandler:null,_flashReady:false,_pageReady:false,delayCalls:[],init:function(){this.name="flashStorage";this.id=apf.flash.addPlayer(this);this.STORAGE_SWF=(apf.config.resourcePath||apf.basePath)+"resources/apfStorage.swf?cachebust="+new Date().getTime();var flash=apf.flash.buildContent("src",this.STORAGE_SWF,"width","215","height","138","align","middle","id",this.name,"quality","high","bgcolor","#ffffff","allowFullScreen","true","name",this.name,"flashvars","playerID="+this.id,"allowScriptAccess","always","type","application/x-shockwave-flash","pluginspage","http://www.adobe.com/go/getflashplayer","menu","true");this.container=document.createElement("div");this.container.id=this.name+"_Container";this.container.className="apfVideo";with(this.container.style){width=height="0px";overflow="hidden";}document.body.appendChild(this.container);this.container.innerHTML=flash;this.player=apf.flash.getElement(this.name);this._allNamespaces=this.getNamespaces();this._flashReady=this._pageReady=true;},setVisible:function(visible){if(visible==true){this.container.style.position="absolute";this.container.style.visibility="visible";}else{with(this.container.style){position="absolute";x="-1000px";y="-1000px";visibility="hidden";}}return this;},callMethod:function(){if(!this.initialized||typeof this.player.callMethod!="function"){this.delayCalls.push(arguments);}else{var c=[this.player,"callMethod"],j=apf.flash,d=0,a=arguments.length;for(;d<a;d++){c.push(j.encode(c[d]));}j.remote.apply(null,c);}},delayedCallTimer:null,makeDelayCalls:function(){clearTimeout(this.delayedCallTimer);if(!this.delayCalls.length){if(typeof this["onready"]=="function"){this.onready();}return this;}this.callMethod.apply(this,this.delayCalls[0]);this.delayCalls.splice(0,1);var a=this;this.delayedCallTimer=window.setTimeout(function(){a.makeDelayCalls();},1);return this;},ready:function(a){if(this.initialized){a();}else{this.onready=a;}},event:function(c,d){if(c=="status"){var a=apf.storage;if(statusResult==a.PENDING){this.setVisible(true);}else{this.setVisible(false);}if(a._statusHandler){a._statusHandler.call(null,d.status,d.keyName,d.namespace);}}else{if(c=="loaded"){this.initialized=true;this.setVisible(false).makeDelayCalls();}}},setFlushDelay:function(a){if(a===null||typeof a==="undefined"||isNaN(a)){throw new Error("Invalid argunment: "+a);}this.callMethod("setFlushDelay",String(a));},getFlushDelay:function(){return Number(this.callMethod("getFlushDelay"));},flush:function(a){if(a==null||typeof a=="undefined"){a=apf.storage.namespace;}this.callMethod("flush",a);},isAvailable:function(){return location.protocol!="file:"&&apf.flash.isEightAvailable();},put:function(a,d,c){if(!c){c=this.namespace;}this.callMethod("put",a,apf.serialize(d),c);},putMultiple:function(m,c,j){if(!j){j=this.namespace;}var n=m.join(",");var o=[];for(var d=0;d<c.length;d++){c[d]=apf.unserialize(c[d]);o[d]=c[d].length;}var a=c.join("");var l=o.join(",");this.callMethod("putMultiple",n,a,l,j);},get:function(c,d){if(!d){d=this.namespace;}var a=this.callMethod("get",c,d);if(a==""){return null;}return apf.unserialize(apf.flash.decode(a));},getMultiple:function(keys,namespace){if(!namespace){namespace=this.namespace;}var metaKey=keys.join(",");var metaResults=this.callMethod("getMultiple",metaKey,namespace);if(!metaResults){return null;}var results=eval("("+metaResults.replace(/""([^",\]]+)/g,'"\\"$1').replace(/([^",]+)""/g,'$1\\""')+")");for(var i=0;i<results.length;i++){results[i]=(results[i]=="")?null:apf.unserialize(apf.flash.decode(results[i]));}return results;},_destringify:function(results){if(typeof results=="string"&&(/^string:/.test(results))){results=results.substring("string:".length);}else{results=eval(results);}return results;},getKeys:function(c){if(!c){c=this.namespace;}var a=this.callMethod("getKeys",c);if(a==this||a==null||a=="null"){a="";}a=a.split(",");a.sort();return a;},getNamespaces:function(){var a=this.callMethod("getNamespaces");if(a==this||a==null||a=="null"){a=apf.storage.namespace||"default";}a=a.split(",");a.sort();return a;},clear:function(a){if(!a){a=this.namespace;}this.callMethod("clear",a);},remove:function(a,c){if(!c){c=this.namespace;}this.callMethod("remove",a,c);},removeMultiple:function(c,a){if(!a){a=this.namespace;}var d=c.join(",");this.callMethod("removeMultiple",d,a);},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(apf.formatErrorString(0,null,this.declaredClass+" does not support a storage settings user-interface"));},hideSettingsUI:function(){throw new Error(apf.formatErrorString(0,null,this.declaredClass+" does not support a storage settings user-interface"));},getResourceList:function(){return[];}};apf.storage.modules.html5={domain:(location.hostname=="localhost")?"localhost.localdomain":location.hostname,initialized:true,isAvailable:function(){try{var c=globalStorage[this.domain];}catch(a){return false;}return true;},put:function(a,d,c){a=this.getFullKey(a,c);d=apf.serialize(d);try{var j=globalStorage[this.domain];j.setItem(a,d);}catch(i){}},get:function(c,d){c=this.getFullKey(c,d);var i=globalStorage[this.domain];var a=i.getItem(c);if(a==null||a==""){return null;}return apf.unserialize(a);},getNamespaces:function(){var d=[this.namespace];var l={};var m=globalStorage[this.domain];var a=/^__([^_]*)_/;for(var c=0;c<m.length;c++){var n=m.key(c);if(a.test(n)==true){var j=n.match(a)[1];if(typeof l[j]=="undefined"){l[j]=true;d.push(j);}}}return d;},getKeys:function(d){if(!d){d=this.namespace;}var m=new RegExp(d==this.namespace?"^([^_]{2}.*)$":"^__"+d+"_(.*)$");var j=globalStorage[this.domain];var a=[];for(var c=0;c<j.length;c++){var l=j.key(c);if(m.test(l)==true){l=l.match(m)[1];a.push(l);}}return a;},clear:function(c){if(!c){c=this.namespace;}var j=new RegExp(c==this.namespace?"^[^_]{2}":"^__"+c+"_");var d=globalStorage[this.domain];for(var a=d.length-1;a>=0;a--){if(j.test(d.key(a))==true){d.removeItem(d.key(a));}}},remove:function(a,c){a=this.getFullKey(a,c);var d=globalStorage[this.domain];d.removeItem(a);},isPermanent:function(){return true;},getMaximumSize:function(){return 0;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(apf.formatErrorString(0,null,this.declaredClass+" does not support a storage settings user-interface"));},hideSettingsUI:function(){throw new Error(apf.formatErrorString(0,null,this.declaredClass+" does not support a storage settings user-interface"));},getFullKey:function(a,c){if(!c){c=this.namespace;}return c==this.namespace?a:"__"+c+"_"+a;}};apf.storage.modules["air.file"]={initialized:false,init:function(){this.File=window.runtime.flash.filesystem.File;this.FileStream=window.runtime.flash.filesystem.FileStream;this.FileMode=window.runtime.flash.filesystem.FileMode;this.storagePath="__JPF_"+(apf.config.name?apf.config.name.toUpperCase():"STORAGE")+"/";try{var a=this.File.applicationStorageDirectory.resolvePath(this.storagePath);if(!a.exists){a.createDirectory();}this.initialized=true;}catch(c){apf.console.warn(c.message);return false;}},isAvailable:function(){return apf.isAIR;},put:function(d,j,i){if(!i){i=this.namespace;}try{this.remove(d,i);var a=this.File.applicationStorageDirectory.resolvePath(this.storagePath+i);if(!a.exists){a.createDirectory();}var c=a.resolvePath(d);var m=new this.FileStream();m.open(c,this.FileMode.WRITE);m.writeObject(j);m.close();}catch(l){return false;}return true;},get:function(d,i){if(!i){i=this.namespace;}var c=this.File.applicationStorageDirectory.resolvePath(this.storagePath+i+"/"+d);if(!c.exists||c.isDirectory){return false;}var j=new this.FileStream();j.open(c,this.FileMode.READ);var a=j.readObject();j.close();return a;},getNamespaces:function(){var d=[this.namespace];var a=this.File.applicationStorageDirectory.resolvePath(this.storagePath);var j=a.getDirectoryListing();for(var c=0;c<j.length;c++){if(j[c].isDirectory&&j[c].name!=this.namespace){d.push(j[c].name);}}return d;},getKeys:function(j){if(!j){j=this.namespace;}var d=[];var a=this.File.applicationStorageDirectory.resolvePath(this.storagePath+j);if(a.exists&&a.isDirectory){var l=a.getDirectoryListing();for(var c=0;c<l.length;c++){d.push(l[c].name);}}return d;},clear:function(c){if(!c){c=this.namespace;}var a=this.File.applicationStorageDirectory.resolvePath(this.storagePath+c);if(a.exists&&a.isDirectory){a.deleteDirectory(true);}},remove:function(c,d){if(!d){d=this.namespace;}var a=this.File.applicationStorageDirectory.resolvePath(this.storagePath+d+"/"+c);if(a.exists&&!a.isDirectory){a.deleteFile();}},putMultiple:function(j,a,d){if(!d){d=this.namespace;}try{for(var c=0;c<j.length;c++){this.put(j[c],a[c],null,d);}}catch(l){return false;}return true;},getMultiple:function(j,d){if(!d){d=this.namespace;}var c=[];for(var a=0;a<j.length;a++){c[a]=this.get(j[a],d);}return c;},removeMultiple:function(d,c){if(!c){c=this.namespace;}for(var a=0;a<d.length;a++){this.remove(d[a],c);}},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.storage.modules["air.sql"]={database_file:"apf.db",initialized:false,_db:null,init:function(){this.File=window.runtime.flash.filesystem.File;this.SQLConnection=window.runtime.flash.data.SQLConnection;this.SQLStatement=window.runtime.flash.data.SQLStatement;this.table_name="__JPF_"+(apf.config.name?apf.config.name.toUpperCase():"STORAGE");try{this._db=new this.SQLConnection();this._db.open(this.File.applicationStorageDirectory.resolvePath(this.database_file));this._sql("CREATE TABLE IF NOT EXISTS "+this.table_name+"(namespace TEXT, key TEXT, value TEXT)");this._sql("CREATE UNIQUE INDEX IF NOT EXISTS namespace_key_index ON "+this.table_name+" (namespace, key)");this.initialized=true;}catch(a){apf.console.warn(a.message);return false;}},_sql:function(c,d){var a=new this.SQLStatement();a.sqlConnection=this._db;a.text=c;if(d){apf.extend(a.parameters,d);}a.execute();return a.getResult();},isAvailable:function(){return apf.isAIR;},put:function(a,d,c){if(!c){c=this.namespace;}try{this._sql("DELETE FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":c,":key":a});this._sql("INSERT INTO "+this.table_name+" VALUES (:namespace, :key, :value)",{":namespace":c,":key":a,":value":d});}catch(i){return false;}return true;},get:function(c,d){if(!d){d=this.namespace;}var a=this._sql("SELECT * FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":d,":key":c});if(a.data&&a.data.length){return a.data[0].value;}return null;},getNamespaces:function(){var d=[this.namespace];var a=this._sql("SELECT namespace FROM "+this.table_name+" DESC GROUP BY namespace");if(a.data){for(var c=0;c<a.data.length;c++){if(a.data[c].namespace!=this.namespace){d.push(a.data[c].namespace);}}}return d;},getKeys:function(j){if(!j){j=this.namespace;}var d=[];var a=this._sql("SELECT key FROM "+this.table_name+" WHERE namespace = :namespace",{":namespace":j});if(a.data){for(var c=0;c<a.data.length;c++){d.push(a.data[c].key);}}return d;},clear:function(a){if(!a){a=this.namespace;}this._sql("DELETE FROM "+this.table_name+" WHERE namespace = :namespace",{":namespace":a});},remove:function(a,c){if(!c){c=this.namespace;}this._sql("DELETE FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":c,":key":a});},putMultiple:function(j,a,d){if(!d){d=this.namespace;}try{this._db.begin();for(var c=0;c<j.length;c++){this._sql("DELETE FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":d,":key":key[c]});this._sql("INSERT INTO "+this.table_name+" VALUES (:namespace, :key, :value)",{":namespace":d,":key":key[c],":value":value});}this._db.commit();}catch(l){return false;}return true;},getMultiple:function(l,j){if(!j){j=this.namespace;}var d=[];for(var c=0;c<l.length;c++){var a=this._sql("SELECT * FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":j,":key":l[c]});d[c]=a.data&&a.data.length?a.data[0].value:null;}return d;},removeMultiple:function(d,c){if(!c){c=this.namespace;}this._db.begin();for(var a=0;a<d.length;a++){this._sql("DELETE FROM "+this.table_name+" WHERE namespace = namespace = :namespace AND key = :key",{":namespace":c,":key":d[a]});}this._db.commit();},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.http=function(){this.queue=[null];this.callbacks={};this.cache={};this.timeout=this.timeout||10000;this.autoroute=this.autoroute||false;this["route-server"]=this["route-server"]||null;if(!this.$uniqueId){this.$uniqueId=apf.all.push(this)-1;}this.toString=this.toString||function(){return"[Ajax.org Teleport Component : (HTTP)]";};var a=apf.config.name+".apf.http";this.saveCache=function(){var c=apf.serialize(comm.cache);apf.storage.put("cache_"+this.name,c,apf.config.name+".apf.http");};this.loadCache=function(){var c=apf.storage.get("cache_"+this.name,apf.config.name+".apf.http");if(!c){return false;}this.cache=apf.unserialize(c);return true;};this.clearCache=function(){apf.storage.remove("cache_"+this.name,apf.config.name+".apf.http");};this.getXml=function(d,i,c){if(!c){c={};}c.useXML=true;c.callback=i;return this.get(d,c);};this.get=this.$get=function(l,c){if(!c){c={};}var i=this;var q=c.id;var j=(typeof apf.offline!="undefined");if(j&&!apf.offline.onLine&&c.notWhenOffline){return false;}if(j&&!apf.offline.onLine&&!c.ignoreOffline){if(apf.offline.queue.enabled){var z=apf.extend({url:l,callback:c.callback,retry:function(){i.get(this.url,this.options);},$object:[this.name,"apf.oHttp","new apf.http()"],$retry:"this.object.get(this.url, this.options)"},c);apf.offline.queue.add(z);return;}}var m=c.async=(c.async||typeof c.async=="undefined"||apf.isOpera||false);if(apf.isWebkit){l=apf.html_entity_decode(l);}var C=c.data||"";if(apf.isNot(q)){if(this.cache[l]&&this.cache[l][C]){var t={responseText:this.cache[l][C],responseXML:{},status:200,isCaching:true};}else{var t=apf.getHttpReq();}q=this.queue.push({http:t,url:l,callback:c.callback,retries:0,options:c})-1;if(t.isCaching){if(m){return $setTimeout("apf.lookup("+this.$uniqueId+").receive("+q+");",50);}else{return this.receive(q);}}}else{var t=this.queue[q].http;if(t.isCaching){t=apf.getHttpReq();}else{t.abort();}}if(m){if(apf.hasReadyStateBug){this.queue[q].starttime=new Date().getTime();this.queue[q].timer=setInterval(function(){var E=new Date().getTime()-i.queue[q].starttime;if(E>i.timeout){i.$timeout(q);return;}if(i.queue[q].http.readyState==4){clearInterval(i.queue[q].timer);i.receive(q);}},20);}else{t.onreadystatechange=function(){if(!i.queue[q]||t.readyState!=4){return;}i.receive(q);};}}var s=this.autoroute&&apf.isOpera?true:(c.autoroute||this.shouldAutoroute),u=s?this["route-server"]:l;var d=false;try{if(c.nocache){u=apf.getNoCacheUrl(u);}if(apf.config.queryAppend){u+=(u.indexOf("?")==-1?"?":"&")+apf.config.queryAppend;}if(apf.hasHtml5XDomain&&u.match(/^http:\/\//)&&!new apf.url(u).isSameLocation()){throw new Error(apf.formatErrorString(0,this,"Communication error","Url: "+u+"\nReason: Same origin policy in effect"));}t.open(this.method||c.method||"GET",u,m);if(c.username){t.setRequestHeader("Authorization","Basic "+apf.crypto.Base64.encode(c.username+":"+c.password));}if(!apf.isWebkit){t.setRequestHeader("User-Agent","Ajax.org Teleport 3.0");}t.setRequestHeader("X-Requested-With","XMLHttpRequest");if(!c.headers||!c.headers["Content-type"]){t.setRequestHeader("Content-type",this.contentType||(this.useXML||c.useXML?"text/xml":"text/plain"));}if(s){t.setRequestHeader("X-Route-Request",l);t.setRequestHeader("X-Proxy-Request",l);t.setRequestHeader("X-Compress-Response","gzip");}}catch(w){d=w.message;}if(d){var B=false;if(!B&&this.autoroute&&!s){if(!apf.isNot(q)){clearInterval(this.queue[q].timer);}this.shouldAutoroute=true;c.autoroute=true;return this.get(l,c);}if(!B){var A=c.callback?c.callback(null,apf.ERROR,{userdata:c.userdata,http:t,url:l,tpModule:this,id:q,message:"Permission denied accessing remote resource: "+l+"\nMessage: "+d}):false;if(!A){this.clearQueueItem(q);}return;}}if(this.$headerHook){this.$headerHook(t);}if(c.headers){for(var D in c.headers){t.setRequestHeader(D,c.headers[D]);}}function o(){var G=self.navigator.onLine?"File or Resource not available "+l:"Browser is currently working offline";var E=self.navigator&&navigator.onLine?apf.ERROR:apf.TIMEOUT;var F=c.callback?c.callback(null,E,{userdata:c.userdata,http:t,url:l,tpModule:i,id:q,message:G}):false;if(!F){i.clearQueueItem(q);}}function n(G){var E;if(apf.isIE&&G){var F=window.onerror;window.onerror=function(){if(arguments.caller.callee==n){window.onerror=F;return true;}else{window.onerror=F;if(F){return F.apply(window,arguments);}}};t.send(C);window.onerror=F;}else{try{t.send(C);}catch(I){E=true;}}if(E){o();return;}}if(!m){n.call(this);return this.receive(q);}else{if(apf.loadsLocalFilesSync&&location.protocol=="file:"&&l.indexOf("http://")==-1){$setTimeout(function(){n.call(i,true);});}else{n.call(i);}return q;}};if(!this.exec){this.exec=function(m,i,l,d){if(!d){d={};}var c=i[0],j="";if(!d.method){d.method=m.toUpperCase();}if(!d.callback){d.callback=l;}this.contentType="application/x-www-form-urlencoded";this.$get(apf.getAbsolutePath(apf.config.baseurl,c),d.method=="GET"?d:apf.extend({data:j},d));};}this.receive=function(c){if(!this.queue[c]){return false;}var l=this.queue[c],q=l.http,s=l.callback;clearInterval(l.timer);if(self.navigator&&navigator.onLine===false&&(location.protocol!="file:"||l.url.indexOf("http://")>-1)){return false;}if(l.async){try{if(q.status){}}catch(n){var o=this;return $setTimeout(function(){o.receive(c);},10);}}var m=[],j={tpModule:this,http:q,url:l.url,callback:s,id:c,retries:l.retries||0,userdata:l.options.userdata};if(q.status>600){return this.$timeout(c);}j.data=q.responseText;if(q.status>=400&&q.status<600||q.status<10&&q.status!=0){if(q.status==401){var i=apf.document.getElementsByTagNameNS(apf.ns.apf,"auth")[0];if(i){var d=l.isAuthDelayed;l.isAuthDelayed=true;if(i.authRequired(j,d)===true){return;}}}m.push("HTTP error ["+c+"]:"+q.status+"\n"+q.responseText);}if(l.options.useXML||this.useXML){if((q.responseText||"").replace(/^[\s\n\r]+|[\s\n\r]+$/g,"")==""){m.push("Received an empty XML document (0 bytes)");}else{try{var t=(q.responseXML&&q.responseXML.documentElement)?apf.xmlParseError(q.responseXML):apf.getXmlDom(q.responseText);if(!apf.supportNamespaces){t.setProperty("SelectionLanguage","XPath");}j.data=t.documentElement;}catch(n){m.push("Received invalid XML\n\n"+n.message);}}}if(m.length){j.message=m.join("\n");if(!s||!s(j.data,apf.ERROR,j)){this.clearQueueItem(c);}return;}if(l.options.caching){if(!this.cache[l.url]){this.cache[l.url]={};}this.cache[l.url][l.options.data]=q.responseText;}if(!s||!s(j.data,apf.SUCCESS,j)){this.clearQueueItem(c);}return j.data;};this.$timeout=function(n){if(!this.queue[n]){return false;}var m=this.queue[n],d=m.http;clearInterval(m.timer);try{if(d.status){}}catch(i){var c=this;return $setTimeout(function(){c.$timeout(n);},10);}var l=m.callback;d.abort();var j=l?l(null,apf.TIMEOUT,{userdata:m.options.userdata,http:d,url:m.url,tpModule:this,id:n,message:"HTTP Call timed out",retries:m.retries||0}):false;if(!j){this.clearQueueItem(n);}};this.retryTimeout=function(c,i,d,l,j){if(i==apf.TIMEOUT&&c.retries<(j||apf.maxHttpRetries)){return c.tpModule.retry(c.id);}l=l||new Error(apf.formatErrorString(0,this,"Communication "+(i==apf.TIMEOUT?"timeout":"error"),"Url: "+c.url+"\nInfo: "+c.message));if((d||apf).dispatchEvent("error",apf.extend({error:l,state:i,bubbles:true},c))===false){return true;}};this.clearQueueItem=function(c){if(!this.queue[c]){return false;}clearInterval(this.queue[c].timer);if(apf.releaseHTTP){apf.releaseHTTP(this.queue[c].http);}this.queue[c]=null;delete this.queue[c];return true;};this.retry=function(d){if(!this.queue[d]){return false;}var c=this.queue[d];clearInterval(c.timer);c.retries++;this.get(c.url,c.options);return true;};this.cancel=function(c){if(c===null){c=this.queue.length-1;}if(!this.queue[c]){return false;}this.clearQueueItem(c);};if(!this.$loadAml&&!this.instantiate&&!this.call){this.$loadAml=function(c){var o=this["receive"];for(var n=0,d=this.childNodes.length;n<d;n++){if(this.childNodes[n].nodeType!=1){continue;}var m=this.childNodes[n].getAttribute("url"),q=self[this.childNodes[n].getAttribute("receive")||o],j={useXML:this.childNodes[n].getAttribute("type")=="XML",async:!apf.isFalse(this.childNodes[n].getAttribute("async"))};this[this.childNodes[n].getAttribute("name")]=function(l,i){j.userdata=i;j.data=l;return this.get(m,j);};}};this.instantiate=function(c){var j=c.getAttribute("src"),i={async:c.getAttribute("async")!="false",nocache:true};this.getURL=function(m,l){i.data=m;i.userdata=l;i.callback=this.callbacks.getURL;return this.get(j,i);};var d="http"+Math.round(Math.random()*100000);apf.setReference(d,this);return d+".getURL()";};this.call=function(d,c){this[d].call(this,c);};}};apf.Init.run("http");apf.USEIFRAME=false;function runTpIframe(){function c(){this.$uniqueId=apf.all.push(this);var d=this;if(apf.USEIFRAME){this.iframe=document.body.appendChild(document.createElement("iframe"));this.iframe.style.width="400px";this.iframe.style.height="300px";this.iframe.style.position="absolute";this.iframe.style.left="0";this.iframe.style.top="0";this.iframe.style.zIndex=1000000000;document.body.style.display="block";}else{var j=document.body.appendChild(document.createElement("xml"));this.xmlDocument=j.XMLDocument;this.xmlDocument.setProperty("SelectionLanguage","XPath");document.body.removeChild(j);}this.readyState=0;this.status=null;this.responseText=null;this.responseXML=null;this.setRequestHeader=function(){};this.send=function(){this.done=false;if(apf.USEIFRAME){this.iframe.src=this.url;}else{this.xmlDocument.load(this.url);}};this.open=function(q,n,o){this.method=q;this.url=n;this.async=o;if(apf.USEIFRAME){if(!o){throw new Error(apf.formatErrorString(1081,null,"Iframe callback","Compatibility mode prevents possibility of non-async calls"));}this.iframe.onload=i;}else{this.xmlDocument.async=o;this.xmlDocument.onreadystatechange=l;}};this.abort=function(){if(apf.USEIFRAME){this.iframe.onreadystatechange=null;this.iframe.src="about:blank";d.done=false;d.readyState="";}else{this.xmlDocument.abort();}};var m=this;function l(){m.receive();}this.receive=function(){this.readyState=this.xmlDocument.readyState;if(this.readyState==4){this.status=200;this.responseText=this.xmlDocument.responseText||this.xmlDocument.xml;this.responseXML=this.xmlDocument;}if(this.onreadystatechange){this.onreadystatechange();}};function i(){if(d.done){return;}d.done=true;d.receiveIframe();}this.receiveIframe=function(){var o=this.iframe.contentWindow.document.body.innerText;o=o.replace(/^- /gm,"");try{this.responseXML=apf.getXmlDom(o);this.responseXML.setProperty("SelectionLanguage","XPath");this.responseXML.loadXML(o);}catch(n){this.responseXML=null;}this.responseText=this.responseXML?this.responseXML.xml:o;this.status=200;this.readyState=4;if(this.onreadystatechange){this.onreadystatechange();}};}function a(l,j){var d=document.body.appendChild(document.createElement("xml"));var i=d.XMLDocument;document.body.removeChild(d);i.setProperty("SelectionLanguage","XPath");if(l){i.loadXML(l);}if(!j){apf.xmlParseError(i);}return i;}}apf.draw.vml={initRoot:function(a){if(!apf.isIE8){apf.importCssString("v\\:fill {behavior: url(#default#VML);display:inline-block} v\\:stroke {behavior: url(#default#VML);} v\\:shape {behavior: url(#default#VML);} v\\:path {behavior: url(#default#VML);}");a.$int.innerHTML="                <div style='z-index:10000;position:absolute;left:0px;width:0px;                            background:url(images/spacer.gif);width:"+a.width+"px;height:"+a.height+"px;'>                </div>                <div style='margin: 0 0 0 0;padding: 0px 0px 0px 0px;                             position:absolute;display:inline-block;left:0;top:0;width:"+a.width+"px;height:"+a.height+"px;overflow:hidden;'>                </div>";a.vmlroot=a.$int.lastChild;}else{a.$int.innerHTML="                <div style='z-index:10000;position:absolute;left:0px;width:0px;                            background:url(images/spacer.gif);width:"+a.width+"px;height:"+a.height+"px;'>                </div>                <iframe style='margin:0 0 0 0;padding:0 0 0 0;background:transparent;                             position:absolute;border:0px;display:inline-block;left:0;top:0;width:"+a.width+"px;height:"+a.height+"px;overflow:hidden;'>                </iframe>";a.vmliframe=a.$int.lastChild;a.vmliframe.allowTransparency=true;var c=a.vmliframe.contentWindow.document;c.open();c.writeln("<head><meta http-equiv='X-UA-Compatible' content='IE=EmulateIE7' /></head>                        <style>v\\:fill {behavior: url(#default#VML);display:inline-block} v\\:stroke {behavior: url(#default#VML);}                        v\\:shape {behavior: url(#default#VML);} v\\:path {behavior: url(#default#VML);}</style>                        <html><body style='margin: 0 0 0 0;padding: 0 0 0 0;border: 0px;background:transparent;'>                        <div style='position:absolute;display:inline-block;'></div></body></html>");c.close();a.vmlroot=c.body.firstChild;}return this;},resizeRoot:function(c){var a=c.vmliframe||c.vmlroot;a.style.width=c.width;a.style.height=c.height;a=a.previousSibling;a.style.width=c.width,a.style.height=c.height;if(c.vmliframe){a=c.vmlroot;a.style.width=c.width;a.style.height=c.height;}},initLayer:function(a,c){a.ds=1;a.dx=0,a.dy=0;a.dw=parseFloat(a.width)*a.ds;a.dh=parseFloat(a.height)*a.ds;a._styles=[];a._htmljoin=[];a._vmlroot=c.vmlroot;},resizeLayer:function(o,a){var j,c,m,u,w;o.dx=0,o.dy=0;o.dw=parseFloat(m=o.width)*o.ds;o.dh=parseFloat(u=o.height)*o.ds;var s=(o.dw+1)+","+(o.dh+1);if(o._vmlgroup){(w=o._vmlgroup).style.left=j=o.left,w.style.top=c=o.top,w.style.width=m,w.style.height=u;for(var d=o._vmlgroup.childNodes,o=d.length,q=0;q<o;q++){(w=d[q]).style.width=m,w.style.height=u;if(w.coordsize){w.coordsize=s;}}}},deinitLayer:function(a){if(a._vmlgroup){a._vmlgroup.removeNode();a._vmlgroup=0;}},beginLayer:function(a){if(a._styles.length){if(a._vmlgroup){a._vmlgroup.innerHTML="";}a._styles=[];a._htmljoin=[];}this.l=a,this.mx="",this.my="",this.last=null;return[this.jssVars,"if(!l._styles)_initStyles();","var _s1,_s2,_s3,_s4,_s5,_s6,_s7,_s8,_s9,_st,_su,_sv,","_x1,_x2,_x3,_x4,_x5,_x6,_x7,_x8,_x9,_x10,","_y1,_y2,_y3,_y4,_y5,_y6,_y7,_y8,_y9,_y10,","_t,_u,_l,_dx,_dy,_tn,_tc,_lc,_s,_p,","_styles = l._styles;"].join("");},clear:function(){return"";},endLayer:function(){var d=this.l;var z=[this.$endDraw()],m,q,w,u;var c=[];var o=0,n=0,a,t=d._styles.length;for(;o<t;o++){a=d._styles[o];if(a._prev===undefined){c.push("_styles[",o,"]={","_domnode:_n=l._vmlgroup.childNodes[",n,"]");if(a.$stylelist){c.push(",",apf.draw.serializeStyleState(a));}if(a.isshape){z.push(this.$finalizeShape(a));c.push(",_vmlfill:_n.lastChild?_n.lastChild.previousSibling:0,_vmlstroke:_n.lastChild");}else{c.push(',_txtused:0,_txtcount:0,_txtnodes:[],_txtdiv:"',a._txtdiv,'"');z.push(this.$finalizeFont(a));}c.push("};");n++;}}z.push(["l._anim = _anim;","function _initStyles(){","l._vmlroot.insertAdjacentHTML('beforeend',[",'"<div style=\'position:absolute;display:inline-block;left:",l.left,"','px;top:",l.top,"px;width:",l.width,"px;height:",l.height,"',"px;overflow:hidden;'>\",",'"',d._htmljoin.join(""),'",',"\"</div>\"].join(''));","l._vmlgroup = l._vmlroot.lastChild;","var _n, _styles = l._styles = [];",c.join(""),"};"].join(""));d._styles=null;this.l=null;return z.join("");},beginShape:function(I){if(!I){return"document.title='beginShape Failed';";}var B=this.l,o=B._htmljoin,F,u,a=[],z=[],j=[],c="",w=[this.$endDraw()];I._path=[];if(I._id===undefined){I._id=B._styles.push(I)-1;}this.style=I;for(F=B._styles.length-2;F>=0;F--){if(!B._styles[F]._prev&&this.$canJoin(u=B._styles[F],I)){I._prev=(u._prev!==undefined)?u._prev:F;break;}}if(I._prev===undefined){w.push("_p=(_s=_styles[",I._id,"])._path=[];");if(typeof I.tile!="undefined"){var A=I.fillopacity;if(this.isDynamic(A)){A="1";w.push("_s._vmlfill.opacity=",I.fillopacity,";");}if(this.isDynamic(I.tile)){w.push("if(_s._vmlimg!=(_t=",I.tile,"))_s._vmlfill.src=_t;");j.push("<v:fill origin='0,0' position='0,0' opacity='",A,"' src='' type='tile'/>");}else{j.push("<v:fill origin='0,0' position='0,0' opacity='",A,"'  src='",I.tile,"' type='tile'/>");if(I.tilex||I.tiley){I._img=new Image();I._img.src=I.tile;if(I.tilex){w.push("_s._vmlfill.origin.x=((_t=((",I.tilex,")/(_s._img.width))%1)<0?1+_t:_t);");}if(I.tiley){w.push("_s._vmlfill.origin.y=((_t=((",I.tiley,")/_s._img.height)%1)<0?1+_t:_t);");}}}w.push("_p.push('m',_dx=-_s._img.width*100,' ',_dy=-_s._img.height*100,","',l',_dx,' ',_dy);");}else{if(I.fill!==undefined){var E=I.fill,A=I.fillopacity,K=I.angle,C=I.gradopacity;if(!E.sort){E=[E];}var G=E.length;var D="black",n,J,d;if(G>2){for(F=1;F<G-1&&!this.isDynamic(E[F]);F++){}if(F!=G-1){for(u=[],F=1;F<G-1;F++){u.push(F>1?'+",':'"',Math.round((F/(G-1))*100),'% "+',this.getColor(E[F]));}n=u.join("");d=1;}else{for(u=[],F=1;F<G-1;F++){u.push(F>1?",":"",Math.round((F/(G-1))*100),"% ",E[F]);}n=u.join("");}}if(G>1){if(this.isDynamic(C)||this.isDynamic(A)){if(C==A){A="_t="+A,C="_t";}if(G>2){u=C,C=A,A=u;}w.push("if(_s._vmldata!=(_t=",'["<v:fill opacity=\'",(',A,"),\"' method='none' ","o:opacity2='\",",C,",\"' color='\",",this.getColor(E[0]),",\"' color2='\",",this.getColor(E[G-1]),",\"' type='gradient' angle='\",parseInt(((",K,")*360+180)%360),\"' ",n?(d?"colors='\","+n+",\"'":"colors='"+n+"'"):"","/>\"].join(''))){","_s._domnode.removeChild(_s._vmlfill);","_s._domnode.insertAdjacentHTML( 'beforeend',_s._vmldata=_t);","_s._vmlfill = _s._domnode.lastChild;};");j.push("<v:fill opacity='0' color='black' type='fill'/>");}else{if(G>2){u=C,C=A,A=u;}if(this.isDynamic(E[0])){w.push("_s._vmlfill.color=",this.getColor(E[0]),";");}else{D=E[0];}if(this.isDynamic(E[G-1])){w.push("_s._vmlfill.color2=",this.getColor(E[G-1]),";");}else{J=E[G-1];}if(d){w.push("_s._vmlfill.colors.value=",n,";");}if(this.isDynamic(K)){K="0";w.push("_s._vmlfill.angle=(((",I.angle,")+180)*360)%360;");}if(this.isDynamic(A)){A="1";w.push("_s._vmlfill.opacity=",I.fillopacity,";");}j.push("<v:fill opacity='",A,"' method='none' o:opacity2='",C,n?"' colors='"+n+"'":"","' color='",D,"' color2='",J,"' type='gradient' angle='",(K*360+180)%360,"'/>");}}else{if(this.isDynamic(A)){A="1";w.push("_s._vmlfill.opacity=",I.fillopacity,";");}if(this.isDynamic(E[0])){w.push("_s._vmlfill.color=",this.getColor(E[0]),";");}else{D=E[0];}j.push("<v:fill opacity='",A,"' color=",this.getColor(D)," type='fill'/>");}a.push("fill='t'"),z.push("fillok='t'");}else{a.push("fill='f'"),z.push("fillok='f'");}}if(I.stroke!==undefined){var q=I.weight,c=I.strokeopacity,m=I.stroke;if(this.isDynamic(c)){c="1";w.push("_s._vmlstroke.opacity=",I.opacity,";");}if(this.isDynamic(q)){q="1";w.push("_t=",I.weight,";_s._vmlstroke.weight=_t;if(_t<",c,")_s._vmlstroke.opacity=_t;");}if(this.isDynamic(m)){m="black";w.push("_s._vmlstroke.color=",this.getColor(I.stroke),";");}j.push("<v:stroke opacity='",q<1?(c<q?c:q):c,"' weight='",q,"' color=",this.getColor(m.dataType==apf.ARRAY?m[0]:m),"/>");}else{a.push("stroke='f'"),z.push("strokeok='f'");}o.push(["<v:shape alignshape='f' ","style='position:absolute;display:inline-block;left:0;top:0;width:",'",l.width,"px;height:",l.height,"px;overflow:hidden;\' ',"coordorigin='0,0' coordsize='\",(l.dw+1),\",\",(l.dh+1),\"'","path='' ",a.join(" "),"><v:path ",z.join(" "),"/>",j.join(" "),"</v:shape>"].join(""));}else{if(I._prev!==undefined){if(this.last!==I._prev){w.push("_p=(_s=_styles[",I._prev,"])._path;");}}}return w.join("");},moveTo:function(a,c){return["_p.push('m',__round(",a,")",",' ',__round(",c+"),'l');\n"].join("");},lineTo:function(a,c){return["_p.push(__round(",a,")",",' ',__round("+c+"));\n"].join("");},lineH:function(a,d,c){return["_p.push('m',__round(",a,")",",' ',__round(",d,")",",'r',__round(",c,"),' 0');"].join("");},lineV:function(a,d,c){return["_p.push('m',__round(",a,")",",' ',__round(",d,")",",'r0 ',__round(",c,"));"].join("");},dot:function(a,c){return["_p.push('m',__round(",a,")",",' ',__round(",c,")",",'r0 0');"].join("");},rect:function(c,j,d,i,a){return["_u=",c,";if((_t=__round(",d,"))>0)_p.push('m',__round(_u),' ',__round(",j,")",",'r',_t,' 0r0 ',__round(",i,a?"),'r-'+_t,' 0x');":"),'r-'+_t,' 0xe');"].join("");},ellipse:function(a,n,d,j,i,l,m){if(!i){return["_p.push('at ',(_x1=__round(",a,"))-(_x2=__round(",d,")),' ',(_y1=__round(",n,"))-(_y2=__round(",j,")),' ',","_x1+_x2,' ',_y1+_y2,' 0 0 0 0');"].join("");}else{return["if( (_t=",i,")+0.000001<(_u=",l,")){","_p.push('",m?"wa":"at"," ',(_x1=__round(",a,"))-(_x2=__round(",d,")),' ',(_y1=__round(",n,"))-(_y2=__round(",j,")),' ',_x1+_x2,' ',_y1+_y2,' ',","__round(_x1+__sin(_t)*_x2*4000),' ',","__round(_y1+__cos(_t)*_y2*4000),' ',","__round(_x1+__sin(_u)*_x2*4000),' ',","__round(_y1+__cos(_u)*_y2*4000),'x');}else{","_p.push('l',__round((",a,")+__sin(_t)*(",d,")),' ',__round((",n,")+__cos(_t)*(",j,")),'x');","}",].join("");}},rectInv:function(a,i,c,d){return this.rect(a,i,c,d,1);},close:function(){return"_p.push('xe');";},$endShape:function(){this.mx="",this.my="";this.last=this.style._id;this.style=0;return"";},$finalizeShape:function(a){return["if((_s=_styles[",a._id,"])._pathstr!=(_t=","(_p=_s._path).length?_p.join(' '):'m'))_s._domnode.path=_t;\n"].join("");}};apf.draw.canvas={initRoot:function(c){var a=document.createElement("canvas");a.setAttribute("width",c.canvaswidth=c.width);a.setAttribute("height",c.canvasheight=c.height);a.className="canvas";c.$int.appendChild(a);c.canvaselem=a;c.canvas=a.getContext("2d");c.canvas.translate(0.5,0.5);c.imgcache={};return this;},resizeRoot:function(a){a.canvaselem.setAttribute("width",a.width);a.canvaselem.setAttribute("height",a.height);for(var c=a.canvaselem.nextSibling;c!=null;c=c.nextSibling){c.style.width=a.width+"px",c.style.height=a.height+"px";}},initLayer:function(a,c){a.imgcache=c.imgcache;a.canvas=c.canvas;a.textroot=c.$int;a.dx=a.left;a.dy=a.top;a.dw=a.width;a.dh=a.height;a.ds=1;a._styles=[];a._htmljoin=[];return this;},resizeLayer:function(a,c){a.dx=a.left;a.dy=a.top;a.dw=a.width;a.dh=a.height;},destroyLayer:function(a){},beginLayer:function(a){this.l=a,this.mx="",this.my="",this.last=null;this.tiletrans=0;this.dodraw=0;if(a._styles.length){for(var c=a._styles.length,d=0;d<c;d++){var m=a._styles[d];if(m._txtnode){m._txtnode.removeNode();}}a._styles=[];a._htmljoin=[];}var m=["if(!l._styles)_initStyles();","var _c=l.canvas,_styles=l._styles,","_s1,_s2,_s3,_s4,_s5,_s6,_s7,_s8,_s9,","_x1,_x2,_x3,_x4,_x5,_x6,_x7,_x8,_x9,_x10,","_y1,_y2,_y3,_y4,_y5,_y6,_y7,_y8,_y9,_y10,","_s,_sh,_sp,_sl,_sv,_su,_st,_dx,_dy,_td,_l,_lc,","_tc,_cv,_t,_u,_r,_q,_o,_m,_sr,_cr;"];if(a.dx!=0){m.push("_c.save();_c.beginPath();_c.translate(l.dx,l.dy);","_c.moveTo(0,0);_c.lineTo(l.dw,0);_c.lineTo(l.dw,l.dh);","_c.lineTo(0,l.dh);_c.closePath();_c.clip();\n");}return m.join("");},clear:function(){var a=this.l;var c=["_c.clearRect(l.dx,l.dy,l.dw,l.dh);\n"];return c.join("");},endLayer:function(){var c=this.l;var o=[this.$endDraw()];var q=[];var m=0,d=0,n,a=c._styles.length;for(;m<a;m++){n=c._styles[m];if(n._prev===undefined&&n.isfont){q.push("_styles[",m,"]={","_domnode:_n=l.textroot.childNodes[b+",d,"]",',_txtused:0,_txtcount:0,_txtnodes:[],_txtdiv:"',n._txtdiv,'"');o.push(this.$finalizeFont(n));q.push("};");d++;}else{q.push("_styles[",m,"]={");if(n.$stylelist){q.push(apf.draw.serializeStyleState(n));}q.push("};");}}o.push(["l._anim = _anim;","function _initStyles(){","var _n, _styles = l._styles = [], b=l.textroot.childNodes.length;","l.textroot.insertAdjacentHTML('beforeend', \"",c._htmljoin.join(""),'");',q.join(""),"}"].join(""));if(c.dx!=0){o.push("_c.restore();");}c._styles=null;this.l=null;return o.join("");},beginShape:function(I,K,B,C,c){var n=(this.style&&this.style.isshape)?this.style:{fill:"-",gradient:"-",angle:"-",stroke:"-",fillopacity:"-",strokeopacity:"-",weight:"-"};var q=[this.$endDraw(),"_c.beginPath();"],D=this.l;this.style=I;if(I._id===undefined){I._id=D._styles.push(I)-1;}q.push("_s=_styles[",I._id,"];");if(K!==undefined&&K!=""){this._clip=1;q.push("_c.save();_c.moveTo(",K,",",B,");_c.lineTo(l.dw-",C,",",B,");_c.lineTo(l.dw-",C,",l.dh-",c,");","_c.lineTo(",B,",l.dh-",c,");_c.closePath();_c.clip();","_c.beginPath();\n");}else{this._clip=0;}var N,J,F,z=0,E=I.fill;if(I.tile!==undefined){var d="";if(I.tilex||I.tiley){d=["_dx=__round(",(I.tilex||"0"),")%((_s._img&&_s._img.width)?_s._img.width:1),","_dy=__round(",(I.tiley||"0"),")%((_s._img&&_s._img.height)?_s._img.height:1);","_c.save();_c.translate(-_dx,-_dy);"].join("");this.tiletrans=1,this.mx="+_dx",this.my="+_dy";}z|=1;if(this.isDynamic(I.tile)){if(apf.isGecko&&I.fillopacity!=1){if(this.isDynamic(I.fillopacity)){q.push("if(!(_u=l.imgcache[_t=",I.tile,"])){","l.imgcache[_t]=_u=new Image();","_u.onload=function(){","_u._canvas = document.createElement('canvas');","_u._canvas.setAttribute('width', _u.width);","_u._canvas.setAttribute('height', _u.height);","_u._ctx = _u._canvas.getContext('2d');","_u.onload=null;","};","_u.src=_t;","}","if(_u && !_u.onload && _u._opacity !== (_q=",I.fillopacity,")){","_u._ctx.clearRect(0,0,_u.width,_u.height);","_u._ctx.globalAlpha=_u._opacity=_q;","_u._ctx.drawImage(_u,0,0);","_s._pattern=l.canvas.createPattern(_u._canvas,","'repeat');","}","if(_t=_s._pattern)_c.fillStyle=_t;\n",d);}else{q.push("if(!(_u=l.imgcache[_t=",I.tile,"])){","l.imgcache[_t]=_u=new Image();","_u.onload=function(){","_u._canvas = document.createElement('canvas');","_u._canvas.setAttribute('width', _u.width);","_u._canvas.setAttribute('height', _u.height);","_u._ctx = _s._canvas.getContext('2d');","_u._ctx.globalAlpha="+I.fillopacity+";_u._ctx.drawImage(_u,0,0);","_u._pattern=l.canvas.createPattern(_u._canvas,'repeat');","_u.onload=null;","};","_u.src=_t;","}","if(_u && !_u.onload && _u!=_s._img){","_s._img=_u,_s.pattern=_u._pattern;","}","if(_t=_s._pattern)_c.fillStyle=_t;\n",d);}}else{q.push("if(!(_u=l.imgcache[_t=",I.tile,"])){","l.imgcache[_t]=_u=new Image();","_u.onload=function(){","_u.onload=null;","_u._pattern=l.canvas.createPattern(_u,'repeat');","};","_u.src=_t;","}","if(_u && !_u.onload && _u!=_s._img){","_s._img=_u,_s.pattern=_u._pattern;","}","if(_t=_s._pattern)_c.fillStyle=_t;\n",d);}}else{if(D.imgcache[I.tile]){I._pattern=D.canvas.createPattern(D.imgcache[I.tile],"repeat");}else{var O=new Image();O.onload=function(){I._img=O;if(apf.isGecko&&I.fillopacity!=1){I._canvas=document.createElement("canvas");I._canvas.setAttribute("width",O.width);I._canvas.setAttribute("height",O.height);I._ctx=I._canvas.getContext("2d");if(!apf.draw.isDynamic(I.fillopacity)){I._ctx.globalAlpha=I.fillopacity;I._ctx.drawImage(O,0,0);}I._pattern=D.canvas.createPattern(I._canvas,"repeat");}else{I._pattern=D.canvas.createPattern(I._img=this,"repeat");}};if(apf.isGecko&&this.isDynamic(I.fillopacity)){q.push("if(_s._ctx){","_s._ctx.clearRect(0,0,_s._img.width,_s._img.height);","_s._ctx.globalAlpha=",I.fillopacity,";","_s._ctx.drawImage(_s._img,0,0);","_s._pattern=l.canvas.createPattern(_s._canvas,","'repeat');}\n");}O.src=I.tile;}q.push("if(_t=(_s._pattern))_c.fillStyle=_t;",d);}}else{if(E!==undefined){z|=1;if(E.sort&&E.length<=1){E=E.length&&E[0]?E[0]:"black";}if(E.sort){var M=E,G=M.length;for(F=0;F<G&&!this.isDynamic(E[F]);F++){}if(F!=G||this.isDynamic(I.angle)||this.isDynamic(I.fillopacity)){q.push("_o=",I.fillopacity,",_r=",I.gradopacity,",_t=_s._colors,_m=0;");for(F=0;F<G;F++){if(this.isDynamic(E[G-F-1])){q.push("if(_t[",F,"]!=(_l=[","'rgba(',(((_q=parseInt((",this.getColor(E[G-F-1]),").slice(1),16))>>16)&0xff),","',',((_q>>8)&0xff),',',(_q&0xff),',',","(",F/(G-1),"*_o+",1-(F/(G-1)),"*_r)",",')'].join(''))",")_t[",F,"]=_l,_m=1;");}else{var m=parseInt((this.colors[E[G-F-1].toLowerCase()]||E[G-F-1]).slice(1),16);q.push("if(_t[",F,"]!=(_l=","['rgba(",(m>>16)&255,",",(m>>8)&255,",",m&255,",',","(",F/(G-1),"*_o+",1-(F/(G-1)),"*_r),')'].join(''))",")_t[",F,"]=_l,_m=1;");}}q.push("if(_s._angle!=(_u=(",I.angle,")*2*p) || _m){","_s._grad=_q=_c.createLinearGradient(","dtx+(__sin(_s._angle=_u)*0.5+0.5)*dw,","dty+(__cos(_u)*0.5+0.5)*dh,","dtx+(__sin(p+_u)*0.5+0.5)*dw,","dty+(__cos(p+_u)*0.5+0.5)*dh);");for(F=0;F<G;F++){q.push("_q.addColorStop(",F/(G-1),",_t[",F,"]);");}q.push("_c.fillStyle=_q;}else _c.fillStyle=_s._grad;\n");I._colors=[];}else{var J=D.canvas.createLinearGradient((Math.sin(I.angle)*0.5+0.5)*D.dw,(Math.cos(I.angle)*0.5+0.5)*D.dh,(Math.sin(Math.PI+I.angle)*0.5+0.5)*D.dw,(Math.cos(Math.PI+I.angle)*0.5+0.5)*D.dh);var j,A=I.fillopacity,w=I.gradopacity;for(F=0;F<G;F++){N=this.colors[N=E[G-F-1].toLowerCase()]||E[G-F-1];J.addColorStop(j=F/(G-1),"rgba("+(((N=parseInt(N.slice(1),16))>>16)&255)+","+((N>>8)&255)+","+((N)&255)+","+(j*A+(1-j)*w)+")");}I._gradient=J;q.push("_c.fillStyle=_styles[",I._id,"]._gradient;");}}else{if(this.isDynamic(E)||n.fill!=E){q.push("_c.fillStyle=",this.getColor(E),";");}}}}if(I.stroke!==undefined){z|=2;if(this.isDynamic(I.stroke)||n.stroke!=I.stroke){q.push("_c.strokeStyle=",this.getColor(I.stroke),";");}if(this.isDynamic(I.weight)||n.weight!=I.weight){q.push("_c.lineWidth=",I.weight,";");}}this.fillopacity="";this.strokeopacity="";this.fillmode=z;switch(z){case 3:if(I.fillopacity!=I.strokeopacity){this.fillopacity="_c.globalAlpha="+I.fillopacity+";";this.strokeopacity="_c.globalAlpha="+I.strokeopacity+";";}else{if(this.isDynamic(I.fillopacity)||I.fillopacity!=n.fillopacity){q.push("_c.globalAlpha=",I.fillopacity,";");}}break;case 2:if(this.isDynamic(I.strokeopacity)||I.strokeopacity!=n.strokeopacity){q.push("_c.globalAlpha=",I.strokeopacity,";");}break;case 1:if(this.isDynamic(I.fillopacity)||I.fillopacity!=n.fillopacity){q.push("_c.globalAlpha=",I.fillopacity,";");}break;}return q.join("");},moveTo:function(a,c){return"_c.moveTo("+a+this.mx+","+c+this.my+");\n";},lineTo:function(a,c){this.dodraw=1;return"_c.lineTo("+a+this.mx+","+c+this.my+");\n";},lineH:function(a,d,c){this.dodraw=1;return["_c.moveTo(",a,this.mx,",",d,this.my,");","_c.lineTo(",a,this.mx,"+",c,",",d,this.my,");\n"].join("");},lineV:function(a,d,c){this.dodraw=1;return["_c.moveTo(",a,this.mx,",",d,this.my,");","_c.lineTo(",a,this.mx,",",d,this.my,"+",c,");\n"].join("");},dot:function(a,c){this.dodraw=1;return["_c.moveTo(",a,this.mx,",",c,this.my,");","_c.lineTo(",a,this.mx,",",c,this.my,");\n"].join("");},circle:function(a,m,i,d,j,l){this.dodraw=1;if(!d){d="0";}if(!j){j="p";}l=l?1:0;return["_c.arc(",a,",",m,",",i,",",d,",",j,",",l,");"].join("");},ellipse:function(a,n,d,j,i,l,m){this.dodraw=1;if(!i){i="0";}if(!l){l="p2";}m=m?1:0;return["if((_x2=(",d,"))!=0 && (_y2=-(",j,"))!=0){_c.translate(_x1=(",a,"),_y1=(",n,"));_c.scale(_x2,_y2);","_c.arc(0,0,1,(",i,")-1.5707965,(",l,")-1.5707965,",!m,");_c.scale(1/_x2,1/_y2);_c.translate(-_x1,-_y1);}"].join("");},rect:function(a,i,c,d){switch(this.fillmode){case 3:return this.fillopacity+"_c.fillRect(_x1="+a+this.mx+",_y1="+i+this.my+",_x2="+c+",_y2="+d+");"+this.strokeopacity+"_c.strokeRect(_x1,_y1,_x2,_y2);";case 2:return"_c.strokeRect("+a+this.mx+","+i+this.my+","+c+","+d+");\n";case 1:return"_c.fillRect("+a+this.mx+","+i+this.my+","+c+","+d+");\n";}},close:function(){return["_c.closePath();",this.$dodraw()].join("");},$dodraw:function(){this.dodraw=0;switch(this.fillmode){case 3:return this.fillopacity+"_c.fill();"+this.strokeopacity+"_c.stroke();_c.beginPath();\n";case 2:return"_c.stroke();_c.beginPath();\n";case 1:return"_c.fill();_c.beginPath();\n";}},$endShape:function(){var a=this.dodraw?[this.$dodraw()]:[];this.mx="",this.my="";this.last=this.style._id;this.style=0;if(this.tiletrans){a.push("_c.restore();");}this.tiletrans=0;if(this._clip){a.push("_c.restore();");}this._clip=0;return a.join("");},$finalizeShape:function(){return"";}};apf.chart_draw={_axis2D:{margin:{left:30,top:30,right:30,bottom:30,$:1},layout:{pow:10,step:4,onsidex:0,onaxisx:0,onsidey:1,onaxisy:0,$:1},plane:{inherit:"shape",stroke:"#cfcfcf",fill:"#e6f1f8",$:1},plane2:{inherit:"shape",$:1},label:{inherit:"font",join:"label",left:0,top:0,format:"fixed(v,1)",$:0},labelx:{inherit:"label",width:40,top:5,left:-19,side:0,axis:0,edgeclip:2,align:"center",$:1},labely:{inherit:"label",left:-110,top:-6,width:100,side:1,edgeclip:0,align:1?"right":"left",$:1},grid:{inherit:"shape",join:"grid",extend:0,$:0},hgrid:{inherit:"grid",$:1},vgrid:{inherit:"grid",$:1},tiles:{inherit:"shape",join:"tiles",fill:"#dfe7f5",$:1},bar:{inherit:"shape",join:"bar",$:0},hbar:{inherit:"bar",$:1},vbar:{inherit:"bar",$:1},axis:{inherit:"shape",join:"grid",stroke:"black",weight:1,extend:2,$:0},axisx:{inherit:"axis",$:1},axisy:{inherit:"axis",$:1},tick:{inherit:"shape",join:"grid",steps:5,left:0,top:0,size:4,stroke:"#000000",$:0},tickx:{inherit:"tick",$:1},ticky:{inherit:"tick",$:1},tickgx:{inherit:"tick",weight:2,size:6,$:1},tickgy:{inherit:"tick",weight:2,size:6,$:1}},axis2D:function(i,t){var m=apf.draw;if(!t.margin||!t.layout){return new Function("");}var j=t.margin.left*i.ds,a=t.margin.top*i.ds,d=t.margin.right*i.ds,q=t.margin.bottom*i.ds;var n=m.optimize([m.beginLayer(i),m.vars(j,a,d,q),m.clear(),"var v,d,u,h,","vcx = 0.5*__pow(",t.layout.pow,", __round(__log(__abs(vw)/",t.layout.pow,")/__log(",t.layout.pow,")))*",t.layout.step,",","vcy = 0.5*__pow(",t.layout.pow,", __round(__log(__abs(vh)/",t.layout.pow,")/__log(",t.layout.pow,")))*",t.layout.step,",","vbx = __ceil(vx1/vcx) * vcx,","vby = __ceil(vy1/vcy) * vcy,","vex = __floor(vx2/vcx) * vcx,","vey = __floor(vy2/vcy) * vcy,","dcx = vcx*tw, dcy = vcy*th,","dbx = vbx*tw+tx, dby = vby*th+ty,","dex = vex*tw+tx, dey = vey*th+ty,","dcx2 = dcx*2, dcy2 = dcy*2,","dbx2 = __ceil(vx1/(2*vcx))*2*vcx*tw+tx,","dex2 = __floor(vx2/(2*vcx))*2*vcx*tw+tx,","dby2 = __floor(vy1/(2*vcy))*2*vcy*th+ty,","dey2 = __floor(vy2/(2*vcy))*2*vcy*th+ty;","var xmaxstep = __ceil( (dex-dbx)/dcx )+4,","ymaxstep = __ceil( (dey-dby)/dcy )+4;",t.plane?[m.beginShape(t.plane),m.rect(j,a,"dw","dh")].join(""):"",t.tiles?[m.rectInv?[m.beginShape(t.tiles),"if((u=dbx2-dcx-",j,")>0){",m.rectInv(j,a,"u","dh"),"}","for( v = dbx2, u  = dex-dcx; v < u; v += dcx2){",m.rectInv("v",a,"dcx","dh"),"};","if((u=dr-v)>0){",m.rectInv("v",a,"__min(dcx,u)","dh"),"}","if((u=dey2+dcy-",a,")>0){",m.rectInv(j,a,"dw","u"),"}","for( v = dey2,u = dby+dcy; v < u; v -= dcy2){",m.rectInv(j,"v","dw","-dcy"),"};","if((u=db-v)>0){",m.rectInv(j,"v","dw","__min(-dcy,u)"),"}"].join(""):[m.beginShape(t.tiles,j,a,d,q),"for( u = dey2+dcy2, t = dby2-dcy2; u <= t; u -= dcy2){","for( v = dbx2-dcx2, d = dex2+dcx2; v <= d; v += dcx2){",m.rect("v+dcx","u","dcx","-dcy"),m.rect("v","u-dcy","dcx","-dcy"),"};","}"].join("")].join(""):"",t.vbar?[m.beginShape(t.vbar),"if((u=dbx2-dcx-",j,")>0){",m.rect(j,a,"u","dh"),"}","for( v = dbx2, u  = dex-dcx; v < u; v += dcx2){",m.rect("v",a,"dcx","dh"),"};","if((u=dr-v)>0){",m.rect("v",a,"__min(dcx,u)","dh"),"}"].join(""):"",t.hbar?[m.beginShape(t.hbar),"if((u=dey2+dcy-",a,")>0){",m.rect(j,a,"dw","u"),"}","for( v = dey2, u = dby+dcy; v < u; v -= dcy2){",m.rect(j,"v","dw","-dcy"),"};","if((u=db-v)>0){",m.rect(j,"v","dw","__min(-dcy,u)"),"}"].join(""):"",t.tickx?[m.beginShape(t.tickx),"u = ",t.layout.onaxisx?("ty+"+(t.tickx.top*i.ds)):(t.layout.onsidex?t.tickx.size*-i.ds+j:("db")),";","t = dcx/",t.tickx.steps,";","h = ",t.tickx.size*i.ds,";",t.layout.onaxisx?["if(u+h>",a," && u<dh+",q,"){","if(u<dy)h=h-(dy-u),u=dy;","if(u+h>db)h=db-u;"].join(""):"","x = dbx-dcx;while(x<dx)x+=t;","for(; x < dr; x += t){",m.lineV("x","u","h"),"};",t.layout.onaxisx?"}":"",].join(""):"",t.ticky?[m.beginShape(t.ticky),"t = dcy/",t.ticky.steps,";","u = ",t.layout.onaxisy?("tx+"+t.ticky.left*i.ds):(t.layout.onsidey?t.ticky.size*-i.ds+a:"dr"),";","h = ",t.ticky.size*i.ds,";",t.layout.onaxisy?["if(u+h>dx && u<dr){","if(u<dx)h=h-(dx-u),u=dx;","if(u+h>dr)h=dr-u;"].join(""):"","y = dey+dcy;while(y<dy)y-=t;","for(; y < db; y -= t){",m.lineH("u","y","h"),"};",t.layout.onaxisy?"}":"",].join(""):"",t.hgrid?[m.beginShape(t.hgrid),"t=dw+",t.hgrid.extend*i.ds,";","u=",(t.hgrid.extend*i.ds*-t.layout.onsidey)+j,";","for(y = dby; y >= dy; y += dcy){",m.lineH("u","y","t"),"};"].join(""):"",t.vgrid?[m.beginShape(t.vgrid),"t=dh+",t.vgrid.extend*i.ds,";","u=",(t.vgrid.extend*i.ds*-t.layout.onsidex)+a,";","for(x = dbx; x <= dr; x += dcx){",m.lineV("x","u","t"),"};"].join(""):"",t.tickgx?[m.beginShape(t.tickgx),"u = ",t.layout.onaxisx?("ty+"+t.tickgx.top*i.ds):(t.layout.onsidex?t.tickgx.size*-i.ds+j:("db")),";","h = ",t.tickgx.size*i.ds,";",t.layout.onaxisx?["if(u+h>dy && u<db){","if(u<dy)h=h-(dy-u),u=dy;","if(u+h>db)h=db-u;"].join(""):"","for(v=dbx; v <= dr; v += dcx){",m.lineV("v","u","h"),"};",t.layout.onaxisx?"}":"",].join(""):"",t.tickgy?[m.beginShape(t.tickgy),"u = ",t.layout.onaxisy?("tx+"+t.tickgy.left*i.ds):(t.layout.onsidey?t.tickgy.size*-i.ds+a:"dr"),";","h = ",t.tickgy.size*i.ds,";",t.layout.onaxisy?["if(u+h>dx && u<dr){","if(u<dx)h=h-(dx-u),u=dx;","if(u+h>dr)h=dr-u;"].join(""):"","for(v=dby; v >= dy; v += dcy){",m.lineH("u","v","h"),"};",t.layout.onaxisy?"}":"",].join(""):"",t.axisx?[m.beginShape(t.axisx),"if(ty>=dy && ty<=dy+dh){","t=dw+",t.axisx.extend*i.ds,";","u=dx+",(t.axisx.extend*i.ds*-t.layout.onsidey),";",m.lineH("u","ty","t"),"}"].join(""):"",t.axisy?[m.beginShape(t.axisy),"if(tx>=dx && tx<=dx+dw){","t=dh+",t.axisy.extend*i.ds,";","u=dy+",(t.axisy.extend*i.ds*-t.layout.onsidex),";",m.lineV("tx","u","t"),"}"].join(""):"",t.plane2?[m.beginShape(t.plane2),m.rect(j,a,"dw","dh")].join(""):"",t.labelx?[t.layout.onaxisx?m.beginFont(t.labelx,"xmaxstep",j,a,d,q):m.beginFont(t.labelx,"xmaxstep",j-t.labelx.edgeclip*i.ds,0,d-t.labelx.edgeclip*i.ds,0),"for( v = vbx, u = vex,d = dbx; v <= u; v+= vcx, d+= dcx ){",m.text("d",t.layout.onaxisx?"ty":(t.layout.onsidex?"dy":"db"),t.labelx.format),"}"].join(""):"",t.labely?[t.layout.onaxisy?m.beginFont(t.labely,"ymaxstep",j,a,d,q):m.beginFont(t.labely,"ymaxstep",0,a-t.labely.edgeclip*i.ds,0,q-t.labely.edgeclip*i.ds),"for( v = vby, u = vey,d = dby;v<= u; v+= vcy, d+= dcy ){;",m.text(t.layout.onaxisy?"tx":(t.layout.onsidey?"dx":"dr"),"d",t.labelx.format),"}"].join(""):"",m.endLayer()]);try{return new Function("l","v","m",n);}catch(o){alert("Failed to compile:\n"+o.message+"\n"+n);return 0;}},_axis3D:{layout:{pow:10,step:4,$:1},plane:{inherit:"shape",side:1,oneside:0,fill:"#e6f1f8",$:0},plane2:{inherit:"shape",$:1},planexy:{inherit:"plane",$:1},planexz:{inherit:"plane",$:1},planeyz:{inherit:"plane",$:1},bar:{inherit:"shape",join:"bar",oneside:0,$:0},hbar:{side:1,inherit:"bar",stroke:"#cfcfcf",$:0},vbar:{side:1,inherit:"bar",stroke:"#cfcfcf",fill:"blue",opacity:0.25,$:0},hbarxy:{inherit:"hbar",$:1},vbarxy:{inherit:"vbar",$:1},hbarxz:{inherit:"hbar",stroke:"black",opacity:0.25,$:1},vbarxz:{inherit:"vbar",fill:"#e6f1f8",stroke:"black",$:1},hbaryz:{inherit:"hbar",fill:"#blue",opacity:0.25,$:1},vbaryz:{inherit:"vbar",stroke:"black",opacity:0.25,fill:null,$:1},axis:{inherit:"shape",join:"grid",stroke:"black",opacity:0.5,weight:3,$:0},axisx:{inherit:"axis",$:1},axisy:{inherit:"axis",$:1},axisz:{inherit:"axis",$:1},tick:{inherit:"shape",join:"grid",steps:5,size:4,scale:0.1,angle:"ang(180)",stroke:"#000000",$:0},tickx:{inherit:"tick",angle:"ang(90+f1*90)",$:1},ticky:{inherit:"tick",angle:"ang(90+f2*90)",$:1},tickz:{inherit:"tick",$:1},label:{inherit:"font",join:"label",width:40,height:40,left:-20,top:"fontz(-5,200)",size:"fontz(10,200)",scale:0.2,stroke:null,angle:"ang(180)",format:"fixed(v,1)",$:0},labelx:{inherit:"label",angle:"ang(90+f1*90)",align:"center",$:1},labely:{inherit:"label",angle:"ang(90+f2*90)",align:"center",$:1},labelz:{inherit:"label",align:"center",$:1},$:0},chartView3D:function(a,c){return["var s3x=v.x3d/vw,s3xi=1/s3x,s3y=v.y3d/vh,s3yi=1/s3y,s3z=v.z3d/vd,s3zi=1/s3z;",c.sincos3("_m","v.rx","v.ry","v.rz"),c.setMatrix3D(c.matrixMul(c.matrix4T("(-0.5*vx1-0.5*vx2)","(-0.5*vy1-0.5*vy2)","(-0.5*vz1-0.5*vz2)"),c.matrix4S("s3x","s3y","s3z"),c.matrix4RP("_m"),c.matrix4T("v.tx","v.ty","v.tz")))].join("");},axis3D:function(d,u){if(!u.layout){return new Function("");}var m=apf.draw;var a=(new Date()).getTime();var n=-0.01;function i(U,M,Q,P,A,s,c,w,B,T,E,K,C,N,J,l,z,V,R,I,O){function D(W){return m.poly3DClip([0,1,2,3],[[s,N,W],[s,J,W],[c,J,W],[c,N,W]],M,n);}function F(W){return["if((u=(",T,"-",K,")-",s,")<",K," && u>0){",m.poly3DClip([0,1,2,3],[[s,N,W],["("+s+"+u)",N,W],["("+s+"+u)",J,W],[s,J,W]],M,n),"}","for( v = ",T,", u  = ",E,"-0.000001; v < u; v += ",C,"){",m.poly3DClip([0,1,2,3],[["v",N,W],["(v+"+K+")",N,W],["(v+"+K+")",J,W],["v",J,W]],M,n),"};","if( v<",c," ){",m.poly3DClip([0,1,2,3],[["v",N,W],["(u="+m.min("v+"+K,c)+")",N,W],["u",J,W],["v",J,W]],M,n),"}"].join("");}function G(W){return["if((u=(",V,"-",I,")-",N,")<",I," && u>0){",m.poly3DClip([0,1,2,3],[[s,N,W],[s,"("+N+"+u)",W],[c,"("+N+"+u)",W],[c,N,W]],M,n),"}","for( v = ",V,", u  = ",R,"-0.000001; v < u; v += ",O,"){",m.poly3DClip([0,1,2,3],[[s,"v",W],[s,"(v+"+I+")",W],[c,"(v+"+I+")",W],[c,"v",W]],M,n),"};","if( v<",J," ){",m.poly3DClip([0,1,2,3],[[s,"v",W],[s,"(u="+m.min("v+"+I,J)+")",W],[c,"u",W],[c,"v",W]],M,n),"}"].join("");}return["s1=-(",m.backface3D([[s,N,Q],[s,J,Q],[c,N,Q]],M),");","s2=",m.backface3D([[s,N,P],[s,J,P],[c,N,P]],M),";","s",U,"=s1*",A,">=s2*",A,";",u["plane"+U]?[m.beginShape(u["plane"+U]),"sa = s1*",m.style.side*A,";","sb = s2*",m.style.side*A,";",m.style.oneside?"if(sa>=sb)sb = -1;if(sb>=sa)sa = -1;":"","for(i=1;i>=0;i--){if((i?sa:sb)>=0){z=i?",Q,":",P,";",D("z"),"}};",].join(""):"",u["hbar"+U]?[m.beginShape(u["hbar"+U]),"sa = s1*",m.style.side*A,";","sb = s2*",m.style.side*A,";",m.style.oneside?"if(sa>=sb)sb = -1;if(sb>=sa)sa = -1;":"","for(i=1;i>=0;i--){if((i?sa:sb)>=0){z=i?",Q,":",P,";",F("z"),"}};"].join(""):"",u["vbar"+U]?[m.beginShape(u["vbar"+U]),"sa = s1*",m.style.side*A,";","sb = s2*",m.style.side*A,";",m.style.oneside?"if(sa>=sb)sb = -1;if(sb>=sa)sa = -1;":"","for(i=1;i>=0;i--){if((i?sa:sb)>=0){z=i?",Q,":",P,";",G("z"),"}};"].join(""):"",u["plane2"+U]?[m.beginShape(u["plane2"+U]),m.poly3DClip([0,1,2,3],[[s,N,Q],[c,N,Q],[c,J,Q],[s,J,Q]],M,n),].join(""):""].join("");}function t(Y,R,V,U,K,J,M,z,G,B,w,C,D,X,I,Q,F,P,O,s,A,aa,W,N,T){var E=-1,Z,c;if(u["axis"+Y]){if((c=u["axis"+Y].side1)!==undefined){K=c;}if((c=u["axis"+Y].side2)!==undefined){J=c;}}var l=["for(i=0;i<4;i++)if((i&2?(",J,"?((f1=0,c=1,y=",P,"),1):0):(",J,"?0:((f1=1,c=-1,y=",O,"),1)))&&","(i&1?(",K,"?((f2=0,d=1,z=",V,"),1):0):(",K,"?0:((f2=1,d=-1,z=",U,"),1))))"].join("");return[u["axis"+Y]?[m.beginShape(u["axis"+Y]),l,"{",m.poly3DClip([0,1],[[B,"y","z"],[w,"y","z"]],R,E,true),"};"].join(""):"",u["tick"+Y]?[m.beginShape(u["tick"+Y]),l,"{",";u=y+",M,"*__sin(f=(",m.style.angle,")*",G,")*(",m.style.scale,")*c;w=z+",z,"*__cos(f)*(",m.style.scale,")*d;","for(v=",C,";v<=",D,";v+=",Q,"){",m.poly3DClip([0,1],[["v","y","z"],["v","u","w"]],R,E,true),"};","};"].join(""):"",u["label"+Y]?[m.beginFont(u["label"+Y],["__ceil(((",D,")-(",C,"))/(",Q,"))*2"].join("")),l,"{",";u=y+",M,"*__sin(f=(",m.style.angle,")*",G,")*(",m.style.scale,")*c;w=z+",z,"*__cos(f)*(",m.style.scale,")*d;","for(v=",C,";v<=",D,";v+=",Q,"){",m.text3D(["v","u","w"],R,E,m.style.format),"}","}"].join(""):"",].join("");}var o=m.optimize([m.beginLayer(d),m.vars(),this.chartView3D(d,m),m.defCamVec(),m.clear(),"var v,d,c,u,h,w,f1,f2,","vcx = 0.5*__pow(",u.layout.pow,", __round(__log(__abs(vw)/",u.layout.pow,")/__log(",u.layout.pow,")))*",u.layout.step,",","vcy = 0.5*__pow(",u.layout.pow,", __round(__log(__abs(vh)/",u.layout.pow,")/__log(",u.layout.pow,")))*",u.layout.step,",","vcz = 0.5*__pow(",u.layout.pow,", __round(__log(__abs(vd)/",u.layout.pow,")/__log(",u.layout.pow,")))*",u.layout.step,",","vbx = __ceil(vx1/vcx) * vcx,","vby = __ceil(vy1/vcy) * vcy,","vbz = __ceil(vz1/vcz) * vcz,","vex = __floor(vx2/vcx) * vcx,","vey = __floor(vy2/vcy) * vcy,","vez = __floor(vz2/vcz) * vcz,","vcx2 = vcx*2, vcy2 = vcy*2, vcz2 = vcz*2,","vbx2 = __ceil(vx1/vcx2)*vcx2,","vex2 = __floor(vx2/vcx2)*vcx2,","vby2 = __ceil(vy1/vcy2)*vcy2,","vey2 = __floor(vy2/vcy2)*vcy2,","vbz2 = __ceil(vz1/vcz2)*vcz2,","vez2 = __floor(vz2/vcz2)*vcz2,","s1, s2, sa, sb, sxy, sxz, syz;","var xmaxstep = __ceil( (vex-vbx)/vcx )+4,","ymaxstep = __ceil( (vey-vby)/vcy )+4,","zmaxstep = __ceil( (vez-vbz)/vcz )+4;",i("xy",[0,1,2],"vz1","vz2",1,"vx1","vx2","vbx","vex","vbx2","vex2","vcx","vcx2","vy1","vy2","vby","vey","vby2","vey2","vcy","vcy2"),i("xz",[0,2,1],"vy1","vy2",-1,"vx1","vx2","vbx","vex","vbx2","vex2","vcx","vcx2","vz1","vz2","vbz","vez","vbz2","vez2","vcz","vcz2"),i("yz",[2,0,1],"vx1","vx2",1,"vy1","vy2","vby","vey","vby2","vey2","vcy","vcy2","vz1","vz2","vbz","vez","vbz2","vez2","vcz","vcz2"),t("x",[0,1,2],"vz1","vz2","sxy","sxz","s3yi","s3zi",1,"vx1","vx2","vbx","vex","vbx2","vex2","vcx","vcx2","vy1","vy2","vby","vey","vby2","vey2","vcy","vcy2"),t("y",[1,0,2],"vz1","vz2","sxy","syz","s3xi","s3zi",-1,"vy1","vy2","vby","vey","vby2","vey2","vcy","vcy2","vx1","vx2","vbx","vex","vbx2","vex2","vcx","vcx2"),t("z",[2,1,0],"vx1","vx2","syz","sxz","s3yi","s3xi",1,"vz1","vz2","vbz","vez","vbz2","vez2","vcz","vcz2","vy1","vy2","vby","vey","vby2","vey2","vcy","vcy2"),m.endLayer()]);try{var j=new Function("l","v","m",o);return j;}catch(q){alert("Failed to compile:\n"+q.message+"\n"+o);return 0;}},_line2D:{graph:{inherit:"shape",stroke:"#000000",weight:1,$:1}},line2D:function(i,q,m){if(!m.graph){return new Function("");}var j=m.graph.weight*8,o=apf.draw;var n=m.graph.fillout?"db":"ty";var t=o.optimize([o.vars(),"if(m){","return -1;","}",o.beginLayer(i),q.vars,q.stats,o.beginShape(m.graph),"var x1=",q.x1,",x2=",q.x2,",xs=",q.xs,",x = x1,xw=x2-x1,idx=xw/xs;",q.begin,"var xfirst = x,dx=-vx1*tw,dy=-vy1*th;",q.seek,q.ifdraw,"{",m.graph.fill?[o.moveTo(q.x+"*tw+tx",n),o.lineTo(q.x+"*tw+tx",q.y+"*th+ty"),].join(""):o.moveTo(q.x+"*tw+tx",q.y+"*th+ty"),"for(x+=idx;x<x2",q.forx,";x+=idx",q.incx,")",q.ifx,"{",o.lineTo(q.x+"*tw+tx",q.y+"*th+ty"),"}",m.graph.fill?["x-=idx;",o.lineTo(q.x+"*tw+tx",n)].join(""):"","}",o.endLayer()].join(""));try{return new Function("l","v","m",t);}catch(a){alert("Failed to compile:\n"+t);return 0;}},_line3D:{graph:{inherit:"shape",steps:50,zpos:0,depth:0.5,stroke:"black",fill:"red",opacity:0.3,$:1}},line3D:function(i,o,m){if(!m.graph){return new Function("");}var n=apf.draw,j=m.graph.weight*4;var q=n.optimize([n.vars(),"if(m){","return -1;","}",n.beginLayer(i),this.chartView3D(i,n),o.vars,o.stats,"var x1=",o.x1,",x2=",o.x2,",xs=",o.xs,",x=x1,xw=x2-x1,idx=xw/xs,","k = 0, xi, yi, xa, ya, xb, yb, xc, yc, xd, yd;",o.seek,n.beginShape(m.graph),o.ifdraw,"{",n.moveTo3D("xb="+o.x,"yb="+o.y,m.graph.zpos),"for(x+=idx,i=0;x<x2",o.forx,";x+=idx",o.incx,")",o.ifx,"{","xa = ",o.x,",ya=",o.y,";",n.lineTo3D("xa","ya",m.graph.zpos,"xi=","yi="),n.lineTo3D("xa","ya",m.graph.zpos+"+"+m.graph.depth,"xc=","yc="),"if(!i){i++;",n.lineTo3D("xb","yb",m.graph.zpos+"+"+m.graph.depth),"} else {",n.lineTo("xd","yd"),"}",n.close(),n.moveTo("xi","yi"),"xd=xc, yd=yc, xb = xa, yb = ya;","}","}",n.endLayer()]);try{return new Function("l","v","m",q);}catch(a){alert("Failed to compile:\n"+q);return 0;}},_bar3D:{graph:{inherit:"shape",stroke:"#000000",weight:1,fill:"red",$:1}},bar3D:function(i,o,j){if(!j.graph){return new Function("");}var n=apf.draw,m=apf.visualize;var q=n.optimize(["if(m){return -1;}",n.beginLayer(i),n.vars(),this.chartView3D(i,n),n.defCamVec(),o.vars,"var x1=",o.x1,",x2=",o.x2,",xs=",o.xs,",x,xw=x2-x1,idx=xw/xs,","wx = idx*tw,wy,cx1,cx2,cy1,cy2;",o.seek,n.beginState(j.graph,n,n.shapedRect,4),o.ifdraw,"{","for(x=x1;x<x2",o.forx,";x+=idx",o.incx,")",o.ifx,"{","cx1=",o.x,",cy1=",o.y,",cx2=cx1+idx,cy2=0;",n.poly3DClip([0,1,2,3],[["cx1","cy1",0],["cx2","cy1",0],["cx2","cy2",0],["cx1","cy2",0]],[0,1,2],-1),"};","}",n.endLayer()]);try{return new Function("l","v","m",q);}catch(a){alert(a.message+"\nFailed to compile:\n"+q);return 0;}},_height3D:{graph:{inherit:"shape",steps:50,zpos:0,depth:0.5,stroke:"black",fill:"red",opacity:0.3,$:1}},height3D:function(i,n,j){if(!j.graph){return new Function("");}var m=apf.draw;var o=m.optimize([m.vars(),"if(m){","return -1;","}",m.beginLayer(i),this.chartView3D(i,m),n.vars,n.stats,"var x1=",n.x1,",x2=",n.x2,",xs=",n.xs,",x=x1,xw=x2-x1,idx=xw/xs,","z1=",n.z1,",z2=",n.z2,",zs=",n.zs,",z=z1,zw=z2-z1,idz=zw/zs,","k = 0, xi, yi, xa, ya, xb, yb, xc, yc, xd, yd;",n.seek,m.beginShape(j.graph),n.ifdraw,"{",(j.graph.fill)?["var ar1=[], ar2=[];","for(x=x1,i=0;x<x2",n.forx,";x+=idx",n.incx,")",n.ifx,"{",m.store3D(n.x,n.y,n.z,"ar1[i++]=","ar1[i++]="),"};","for(z+=idz;z<z2",n.forz,";z+=idz",n.incz,")",n.ifz,"{","x=x1, i=0, j=0;",m.store3D(n.x,n.y,n.z,"ar2[i++]=","ar2[i++]="),"for(x+=idx;x<x2",n.forx,";x+=idx,j+=2",n.incx,")",n.ifx,"{",m.moveTo("ar1[j]","ar1[j+1]"),m.lineTo("ar1[j+2]","ar1[j+3]"),m.lineTo3D(n.x,n.y,n.z,"ar2[i++]=","ar2[i++]="),m.lineTo("ar2[j]","ar2[j+1]"),m.close(),"}","ar1=ar2,ar2=[];","}"].join(""):["for(;z<z2",n.forz,";z+=idz",n.incz,")",n.ifz,"{","x=x1;",m.moveTo3D(n.x,n.y,n.z),"for(x+=idx;x<x2",n.forx,";x+=idx",n.incx,")",n.ifx,"{",m.lineTo3D(n.x,n.y,n.z),"}","}",(j.graph.single>0)?"":["for(x=x1;x<x2",n.forx,";x+=idx",n.incx,")",n.ifx,"{","z=z1;",m.moveTo3D(n.x,n.y,n.z),"for(z+=idz;z<z2",n.forz,";z+=idz",n.incz,")",n.ifz,"{",m.lineTo3D(n.x,n.y,n.z),"}","}"].join(""),].join(""),"}",m.endLayer()]);try{return new Function("l","v","m",o);}catch(a){alert("Failed to compile:\n"+o);return 0;}},_bar2D:{graph:{inherit:"shape",shape:"rect",stroke:"#000000",weight:1,fill:"red",$:1}},bar2D:function(i,o,j){var n=apf.draw,m=apf.visualize;if(!j.graph){return new Function("");}var q=n.optimize([n.vars(),o.vars,"var x1=",o.x1,",x2=",o.x2,",xs=",o.xs,",x,xw=x2-x1,idx=xw/xs,","wx = idx*tw,wy;",o.seek,"\n\n/*------ bar2D Mousecode ------ */\n","if(m){",n.beginMouseState(j.graph,n,n.shapedRect,4),"for(x=x1;x<x2",o.forx,";x+=idx",o.incx,")",o.ifx,"{",n.checkMouseState(o.state,o.time,"("+o.x+")*tw+tx","wy=("+o.y+")*th+ty","wx","ty-wy"),"};","return -1;","}","\n\n/*------ bar2D Drawcode ------ */\n",n.beginLayer(i),n.beginState(j.graph,n,n.shapedRect,4),o.ifdraw,"{","for(x=x1;x<x2",o.forx,";x+=idx",o.incx,")",o.ifx,"{",n.drawState(o.state,o.time,"("+o.x+")*tw+tx","wy=("+o.y+")*th+ty","wx","ty-wy"),"};","}",n.endLayer()]);try{return new Function("l","v","m",q);}catch(a){alert(a.message+"\nFailed to compile:\n"+q);return 0;}},_shape2D:{graph:{inherit:"shape",stroke:"#000000",weight:1,left:-1.5,top:-1.5,height:3,width:4,fill:"red",$:1}},shape2D:function(i,o,j){if(!j.graph){return new Function("");}var n=apf.draw,m=apf.visualize;var q=n.optimize(["if(m){return -1;}",n.beginLayer(i),n.vars(),o.vars,"var x1=",o.x1,",x2=",o.x2,",xs=",o.xs,",x,xw=x2-x1,idx=xw/xs,","wx = idx*tw,wy;","tx += ",j.graph.left*i.ds,";","ty += ",j.graph.top*i.ds,";",o.seek,n.beginState(j.graph,n,n.draw2D,4),o.ifdraw,"{","for(x=x1;x<x2",o.forx,";x+=idx",o.incx,")",o.ifx,"{",n.drawState(o.state,o.time,"("+o.x+")*tw+tx","wy=("+o.y+")*th+ty",j.graph.width*i.ds,j.graph.height*i.ds),"};","}",n.endLayer()]);try{return new Function("l","v","m",q);}catch(a){alert(a.message+"\nFailed to compile:\n"+q);return 0;}},_pie2D:{margin:{left:0,top:0,width:1,height:1,$:1},graph:{inherit:"shape",stroke:"#000000",weight:1,fill:"red",$:1}},pie2D:function(i,o,j){if(!j.graph){return new Function("");}var n=apf.draw,m=apf.visualize;var q=n.optimize(["/*------ pie2D Init ------*/\n",n.vars(),o.vars,o.stats,"var x1=",o.vx1,",x2=",o.vx2,",xw=x2-x1,","idx=1,sum=1/(",o.sum,"),rx=0,","xp=(",j.margin.left,")*tw+tx,","yp=(",j.margin.top,")*th+ty,","wp=(",j.margin.width,")*tw,","hp=(",j.margin.height,")*th,","wq=0.5*wp, hq = 0.5*hp,","xc=xp+wq, yc=yp+hq, piesize;",o.seek,"\n\n/*------ pie2D Mousecode ------ */\n","if(m){",n.beginMouseState(j.graph,n,n.shapedPart,6,["piesize"]),"for(rx=0,x=x1;x<x2",o.forx,";x+=idx",o.incx,")",o.ifx,"{",n.checkMouseState(o.state,o.time,"xc","yc","wq","hq","rx","-rx+(rx+=("+o.y+")*sum)"),"};","return -1;","}","\n\n/*------ pie2D Drawcode ------ */\n",n.beginLayer(i),n.beginState(j.graph,n,n.shapedPart,6,["piesize"]),"for(rx=0,x=x1;x<x2",o.forx,";x+=idx",o.incx,")",o.ifx,"{","piesize = ("+o.y+")*sum;",n.drawState(o.state,o.time,"xc","yc","wq","hq","rx","-rx+(rx+=piesize)"),"};","\n\n/*------ pie2D End ------ */\n",n.endLayer()]);try{return new Function("l","v","m",q);}catch(a){alert(a.message+"\nFailed to compile:\n"+q);return 0;}},dt_math1X:function(a){return{type:"math1X",vars:"var _stp= l.step&&(vx2-vx1)/l.step<l.steps?l.step:(vx2-vx1)/l.steps;",vx1:0,vx2:1,vy1:0,vy2:1,vz1:0,vz2:1,x1:"__floor(vx1/_stp)*_stp",x2:"__ceil(vx2/_stp+1)*_stp",xs:"(x2-x1)/_stp",stats:"",seek:"",forx:"",ifx:"",incx:"",ifdraw:"",x:"x",y:"("+apf.draw.getXYWH(a.pformula,"x")+")"};},dt_math2X:function(a){return{type:"math2X",vars:"var _stp= l.step&&(vx2-vx1)/l.step<l.steps?l.step:(vx2-vx1)/l.steps;",vx1:-1,vx2:1,vy1:-1,vy2:1,vz1:0,vz2:1,x1:"__floor(vx1/_stp)*_stp",x2:"__ceil(vx2/_stp+1)*_stp",xs:"(x2-x1)/_stp",stats:"",seek:"",forx:"",ifx:"",incx:"",ifdraw:"",x:"("+apf.draw.getXYWH(a.pformula,"x")+")",y:"("+apf.draw.getXYWH(a.pformula,"y")+")"};},dt_math1XZ:function(a){return{type:"math1XY",vars:"var _stpx= l.step&&(vx2-vx1)/l.step<l.steps?l.step:(vx2-vx1)/l.steps,_stpz=l.step&&(vz2-vz1)/l.step<l.steps?l.step:(vz2-vz1)/l.steps;",vx1:-1,vx2:1,vy1:-1,vy2:1,vz1:0,vz2:1,x1:"vx1",x2:"vx2",xs:"(x2-x1)/_stpx",z1:"vz1",z2:"vz2",zs:"(z2-z1)/_stpz",stats:"",seek:"",forx:"",ifx:"",incx:"",ifdraw:"",forz:"",ifz:"",incz:"",ifdraw:"",x:"x",z:"z",y:"("+apf.draw.getXYWH(a.pformula,"x")+")"};},dt_math1R:function(a){var c=a.formula.split(";");return{type:"math1R",vx1:-1,vx2:1,vy1:-1,vy2:1,vz1:0,vz2:1,x1:0,x2:"Math.PI*2+(Math.PI*2/(l.style.steps-1))",xs:"l.style.steps",x:"__sin(_p="+apf.visualize.mathParse(c[0])+")*(_r="+apf.visualize.mathParse(c[1])+")",y:"__cos(_p)*_r"};},dt_series1XM:function(a){return{type:"series1XM",vars:"var _mf = __min(__ceil(vx2)+1,l.v_yvalmip[0].length)-__max(__floor(vx1),0);var _ms = l.mipstep, _mt = 1;while(_mf>l.mipthres && _mt<l.v_yvalmip.length){_mf = _mf / _ms;_mt++;}var _div = __pow(_ms,_mt-1);var _off = _mt>1?__pow(_ms,_mt-2):0;var _yv = l.v_yvalmip[_mt-1],_i;",vx1:0,vx2:"_yv.length",vy1:-1,vy2:1,vz1:0,vz2:1,state:"0",time:"0",sum:"l.v_sum",min:"l.v_min",max:"l.v_max",avg:"l.v_avg",seek:"",stats:"",ifdraw:"if((!l.mipmin || _mt>l.mipmin) && (!l.mipmax || _mt<l.mipmax))",forx:"",ifx:"",incx:"",x1:"__max(__floor(vx1/_div-1),0)",x2:"__min((__ceil(vx2/_div)+1),_yv.length)",xs:"x2-x1",x:"(x*_div+_off)",y:"_yv[x]"};},dt_series1X:function(a){return{type:"series1X",vars:"var _yv = l.v_yval,_sv = l.v_state, _tv = l.v_time,_i,_mi,_ma;",vx1:0,vx2:"_yv.length",vy1:-1,vy2:1,vz1:0,vz2:1,state:"_sv[x]",time:"_tv[x]",sum:"l.v_sum",min:"l.v_min",max:"l.v_max",avg:"l.v_avg",forx:"",ifx:"",incx:"",stats:"if(!l.v_sum){for(i=_yv.length-1,j=0,_mi=10000000,_ma=-10000000;i>=0;--i)j+=((m=_yv[i])<_mi?_mi=m:m)>_ma?_ma=m:m;l.v_avg=(l.v_sum=j)/_yv.length;l.v_min=_mi;l.v_max=_ma;}",x1:"__max(__floor(vx1),0)",x2:"__min(__ceil(vx2)+1,_yv.length)",x1c:"__max(__floor(vx1),0)",x2c:"__min(__ceil(vx2)+1,_yv.length)",xs:"x2-x1",x:"x",y:"_yv[x]"};},dt_series2X:function(c){var a=c.yvalue.length;return{type:"series2X",vx1:0,vx2:a,vy1:-1,vy2:1,vz1:0,vz2:1,vars:"var _vx = l.xvalue, _vy = l.yvalue, _len = _vy.length;",x1:0,x2:"_len",xs:"_len",x:"_vx[x]",y:"_vy[x]"};},$:0};apf.chart_draw.height2D=apf.chart_draw.line2D;apf.chart_draw._height2D=apf.chart_draw._line2D;apf.DOMParser=function(){};apf.DOMParser.prototype=new (function(){this.caseInsensitive=true;this.preserveWhiteSpace=true;this.$shouldWait=0;var i=[/\<\!(DOCTYPE|doctype)[^>]*>/,/&nbsp;/g,/<\s*\/?\s*(?:\w+:\s*)[\w-]*[\s>\/]/g],c="//@*[not(contains(local-name(), '.')) and not(translate(local-name(), 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz') = local-name())]",j="DOMNodeInsertedIntoDocument",d="@default",a="id";this.parseFromString=function(t,w,o){var s;if(this.caseInsensitive){var u=t.replace(i[0],"").replace(i[1]," ").replace(i[2],function(l){return l.toLowerCase();});if(!this.supportNamespaces){u=u.replace(/xmlns\=\"[^"]*\"/g,"");}s=apf.getXmlDom(u,null,this.preserveWhiteSpace||apf.debug).documentElement;var q,m,n=s.selectNodes(c);for(q=0,m=n.length;q<m;q++){(n[q].ownerElement||n[q].selectSingleNode("..")).setAttribute(n[q].nodeName.toLowerCase(),n[q].nodeValue);}}else{s=apf.getXmlDom(t,null,this.preserveWhiteSpace||apf.debug).documentElement;}return this.parseFromXml(s,o);};this.parseFromXml=function(B,E){var A,C;if(!E){E={};}if(!E.delayedRender){if(E.doc){A=E.doc;C=E.docFrag||A.createDocumentFragment();}else{A=new apf.AmlDocument();A.$aml=B;A.$domParser=this;}var o=this.$createNode(A,B.nodeType,B);(C||A).appendChild(o);if(E.htmlNode){o.$int=E.htmlNode;}}else{var o=E.amlNode;var A=E.doc;}this.$parseContext=[o,E];var m,D={},z=[],w=this;(function u(J,F){var K,P,I,O,G=J.childNodes,N=0,M=F.length;for(;N<M;N++){P=w.$createNode(A,(I=F[N]).nodeType,I);if(!P){continue;}G[K=G.length]=P;P.parentNode=J;if(K>0){(P.previousSibling=G[K-1]).nextSibling=P;}if(!P.render&&P.canHaveChildren&&(O=I.childNodes).length){u(P,O);}if(P.$parsePrio){if(P.$parsePrio=="001"){P.dispatchEvent(j);continue;}(D[P.$parsePrio]||(z.push(P.$parsePrio)&&(D[P.$parsePrio]=[]))).push(P);}}J.firstChild=G[0];J.lastChild=G[M-1];})(o,B.childNodes);if(E.delay){o.$parseOptions={prios:z,nodelist:D};return(C||A);}z.sort();var t,s,q,n;for(t=0,q=z.length;t<q;t++){m=D[z[t]];for(s=0,n=m.length;s<n;s++){m[s].dispatchEvent(j);}}if(this.$shouldWait){return(C||A);}if(E.timeout){$setTimeout(function(){w.$continueParsing(o,E);});}else{this.$continueParsing(o,E);}return(C||A);};this.$callCount=0;this.$continueParsing=function(n,A){if(this.$shouldWait&&--this.$shouldWait!=0){return;}if(!A){A={};}this.$callCount++;if(n.$parseOptions){var u=n.$parseOptions.prios,z=n.$parseOptions.nodelist,t,s,q,o,m;delete n.$parseOptions;u.sort();for(t=0,q=u.length;t<q;t++){nodes=z[u[t]];for(s=0,o=nodes.length;s<o;s++){if(!(m=nodes[s]).parentNode||m.$amlLoaded){continue;}nodes[s].dispatchEvent(j);}}}if(!A.ignoreSelf&&!n.$amlLoaded){n.dispatchEvent(j);}(function w(C){var E,F;for(var D=0,B=C.length;D<B;D++){if(!(E=C[D]).$parsePrio&&!E.$amlLoaded){E.dispatchEvent(j);}if(!E.render&&(F=E.childNodes).length){w(F);}}})(n.childNodes);if(!this.$callCount&&!A.delay){apf.queue.empty();}if(A.callback){A.callback.call(n.ownerDocument);}delete this.$parseContext;};this.$createNode=function(I,z,J,s,G,C){var q;switch(z){case 1:var m,B;if(J){if((s=J.namespaceURI||apf.ns.xhtml)&&!(B=I.$prefixes[s])){I.$prefixes[B=J.prefix||J.scopeName||""]=s;I.$namespaceURIs[s]=B;if(!I.namespaceURI&&!B){I.namespaceURI=s;I.prefix=B;}}G=J.baseName||J.localName||J.tagName.split(":").pop();}else{B=I.$prefixes[s]||"";}var w=apf.namespaces[s].elements;q=new (w[G]||w[d])(null,G);q.prefix=B||"";q.namespaceURI=s;q.tagName=B?B+":"+G:G;if(J){if(m=J.getAttribute(a)){q.$propHandlers[a].call(q,q.id=m);}var E=J.attributes,t;for(var F,A=0,u=E.length;A<u;A++){q.attributes.push(new apf.AmlAttr(q,(t=(F=E[A]).nodeName),F.nodeValue));if(t=="render"){q.render=true;}}}break;case 2:q=new apf.AmlAttr();q.name=q.nodeName=G;if(C||(C=J&&J.nodeValue)){q.value=q.nodeValue=C;}if(J){if(J.namespaceURI&&!(q.prefix=I.$namespaceURIs[q.namespaceURI=J.namespaceURI])){I.$prefixes[q.prefix=J.prefix||J.scopeName]=q.namespaceURI;}}else{q.prefix=I.$prefixes[s];}break;case 3:if(J){C=J&&J.nodeValue;}if(!this.preserveWhitespace&&!(C||"").trim()){return;}q=new apf.AmlText();q.nodeValue=C||J&&J.nodeValue;break;case 7:var D=G||J&&J.nodeName;q=new apf.aml.processingInstructions[D]();q.target=q.nodeName=D;q.data=q.nodeValue=C||J&&J.nodeValue;break;case 4:q=new apf.AmlCDATASection();q.nodeValue=C||J&&J.nodeValue;break;case 5:q=new apf.AmlNode();q.nodeType=z;break;case 6:q=new apf.AmlNode();q.nodeType=z;break;case 8:q=new apf.AmlComment();q.nodeValue=C||J&&J.nodeValue;break;case 9:q=new apf.AmlDocument();q.$domParser=this;break;case 10:q=new apf.AmlNode();q.nodeType=z;break;case 11:q=new apf.AmlDocumentFragment();break;}q.$aml=J;q.ownerDocument=I;return q;};})();apf.AmlNamespace=function(){this.elements={};this.processingInstructions={};};apf.AmlNamespace.prototype={setElement:function(a,c){return this.elements[a]=c;},setProcessingInstruction:function(c,a){this.processingInstructions[c]=a;}};apf.aml=new apf.AmlNamespace();apf.setNamespace("http://ajax.org/2005/aml",apf.aml);apf.__AMLNODE__=1<<14;apf.AmlNode=function(){this.$init(function(){this.childNodes=[];});};(function(){this.$regbase=this.$regbase|apf.__AMLNODE__;this.NODE_ELEMENT=1;this.NODE_ATTRIBUTE=2;this.NODE_TEXT=3;this.NODE_CDATA_SECTION=4;this.NODE_ENTITY_REFERENCE=5;this.NODE_ENTITY=6;this.NODE_PROCESSING_INSTRUCTION=7;this.NODE_COMMENT=8;this.NODE_DOCUMENT=9;this.NODE_DOCUMENT_TYPE=10;this.NODE_DOCUMENT_FRAGMENT=11;this.NODE_NOTATION=12;this.ownerDocument=null;this.nodeValue="";this.namespaceURI="";this.appendChild=this.insertBefore=function(j,t,d){if(this.nodeType==this.NODE_DOCUMENT){if(this.childNodes.length){throw new Error(apf.formatErrorString(0,this,"Insertbefore DOM operation","Only one top level element is allowed in an AML document."));}else{this.documentElement=j;}}if(j.nodeType==this.NODE_DOCUMENT_FRAGMENT){var a=j.childNodes.slice(0);for(var n=0,m=a.length;n<m;n++){this.insertBefore(a[n],t);}return j;}var c=j.parentNode==this,q=j.$pHtmlNode,w=j.parentNode,o=-1,s=this;if(t){o=this.childNodes.indexOf(t);if(o<0){return false;}}if(!j.ownerDocument){j.ownerDocument=this.ownerDocument||apf.ownerDocument;}if(j.parentNode){j.removeNode(c,d);}j.parentNode=this;if(t){j.nextSibling=t;j.previousSibling=t.previousSibling;t.previousSibling=j;if(j.previousSibling){j.previousSibling.nextSibling=j;}}if(o>=0){this.childNodes=this.childNodes.slice(0,o).concat(j,this.childNodes.slice(o));}else{o=this.childNodes.push(j)-1;j.nextSibling=null;if(o>0){j.previousSibling=this.childNodes[o-1];j.previousSibling.nextSibling=j;}else{j.previousSibling=null;}}this.firstChild=this.childNodes[0];this.lastChild=this.childNodes[this.childNodes.length-1];function z(){j.$pHtmlNode=s.canHaveChildren?s.$int:document.body;j.dispatchEvent("DOMNodeInserted",{$beforeNode:t,relatedNode:s,$isMoveWithinParent:c,$oldParentHtmlNode:q,$oldParent:w,bubbles:true});var i;var l=(j.$ext&&j.$ext.nodeType==1&&(i=j.$ext.getElementsByTagName("iframe")).length>0&&apf.findHost(i[0].parentNode)==j);if(!d&&j.$ext&&!l){j.$pHtmlNode.insertBefore(j.$ext,t&&t.$ext||null);}}var u=this.nodeType==this.NODE_DOCUMENT?this:this.ownerDocument;if(!u||u.$domParser.$shouldWait){return j;}if(this.nodeType==this.NODE_DOCUMENT_FRAGMENT){return;}if(!j.$amlLoaded){(this.ownerDocument||this).$domParser.$continueParsing(j,{delay:true});}z();return j;};this.removeNode=function(c,a){if(!this.parentNode||!this.parentNode.childNodes){return this;}this.parentNode.childNodes.remove(this);if(this.$amlLoaded&&!apf.isDestroying){if(!a&&this.$ext&&this.$ext.parentNode){this.$ext.parentNode.removeChild(this.$ext);}this.dispatchEvent("DOMNodeRemoved",{relatedNode:this.parentNode,bubbles:true,$doOnlyAdmin:c});}if(this.parentNode.firstChild==this){this.parentNode.firstChild=this.nextSibling;}if(this.parentNode.lastChild==this){this.parentNode.lastChild=this.previousSibling;}if(this.nextSibling){this.nextSibling.previousSibling=this.previousSibling;}if(this.previousSibling){this.previousSibling.nextSibling=this.nextSibling;}this.$pHtmlNode=this.parentNode=this.previousSibling=this.nextSibling=null;return this;};this.removeChild=function(a){a.removeNode();return this;};this.replaceChild=function(){};this.cloneNode=function(a){if(a&&this.nodeType==1){return this.ownerDocument.$domParser.parseFromXml(this,{doc:this.ownerDocument,delay:true}).childNodes[0];}else{return this.ownerDocument.$domParser.$createNode(this.ownerDocument,this.nodeType,this);}};this.canDispatch=function(a,c){};this.compareDocumentPosition=function(a){};this.hasAttributes=function(){return this.attributes&&this.attributes.length;};this.hasChildNodes=function(){return this.childNodes&&this.childNodes.length;};this.isDefaultNamespace=function(a){if(c.nodeType==1){if(!this.prefix){return this.namespaceURI==a;}}var c=this.parentNode||this.ownerElement;return c&&c.isDefaultNamespace(a);};this.lookupNamespaceURI=function(c){if(a.nodeType==1){if(this.namespaceURI&&c==this.prefix){return this.namespaceURI;}}var a=this.parentNode||this.ownerElement;return a&&a.lookupNamespaceURI(c);};this.lookupPrefix=function(a){if(this.nodeType==1){if(a==this.namespaceURI&&this.prefix){return this.prefix;}}var c=this.parentNode||this.ownerElement;return c&&c.lookupPrefix(a);};this.normalize=function(){};this.selectNodes=function(c,a){if(!apf.XPath){apf.runXpath();}return apf.XPath.selectNodes(c,a||(this.nodeType==9?this.documentElement:this));};this.selectSingleNode=function(c,a){if(!apf.XPath){apf.runXpath();}return apf.XPath.selectNodes(c,a||(this.nodeType==9?this.documentElement:this))[0];};}).call(apf.AmlNode.prototype=new apf.Class());apf.AmlElement=function(d,a){var c=this.$init;this.$init=function(j,i,n){this.$supportedProperties=this.$supportedProperties.slice();var o,m,l;m=this.$propHandlers;l=this.$propHandlers={};for(o in m){l[o]=m[o];}m=this.$booleanProperties;l=this.$booleanProperties={};for(o in m){l[o]=m[o];}c.call(this,j,i,n);};this.$init(function(q,n,s){this.$events={};this.$inheritProperties={};this.attributes=new apf.AmlNamedNodeMap(this);this.nodeFunc=n;this.localName=q;if(s){var m,t,o,j;if(s.childNodes){m=s.childNodes;delete s.childNodes;}for(t in s){if(t=="htmlNode"){continue;}this.attributes.push(new apf.AmlAttr(this,t,s[t]));}if(!this.ownerDocument){this.ownerDocument=apf.document;this.prefix="";this.namespaceURI=null;this.tagName=q;}if(m){this.childNodes=m;for(o=0,j=m.length;o<j;o++){m[o].nextSibling=m[o+1]||null;m[o].previousSibling=m[o-1]||null;m[o].parentNode=this;}this.firstChild=m[0]||null;this.lastChild=m[m.length-1]||null;}this.$aml=apf.$emptyNode||(apf.$emptyNode=apf.getXml("<empty />"));}});if(a){c.call(this,a,apf.NODE_HIDDEN,d);}};(function(){this.nodeType=this.NODE_ELEMENT;this.canHaveChildren=true;this.$propHandlers={id:function(c){if(this.name==c){return;}if(self[this.name]==this){self[this.name]=null;}if(!self[c]||!self[c].hasFeature){try{self[c]=this;}catch(a){}}apf.nameserver.register(this.localName,c,this);this.name=c;}};this.$booleanProperties={};this.$inheritProperties={};this.$supportedProperties=[];this.getElementsByTagName=function(m,o){m=m.toLowerCase();var n,j,c,d=this.childNodes,a=[];for(j=0,c=d.length;j<c;j++){if((n=d[j]).nodeType!=1){continue;}if(n.tagName==m||m=="*"){a.push(n);}if(!o&&n.nodeType==1){a=a.concat(n.getElementsByTagName(m));}}return a;};this.getElementsByTagNameNS=function(m,j,q){j=j.toLowerCase();var o,n,c,d=this.childNodes,a=[];for(n=0,c=d.length;n<c;n++){if((o=d[n]).nodeType!=1){continue;}if(o.namespaceURI==m&&(o.localName==j||j=="*")){a.push(o);}if(!q&&o.nodeType==1){a=a.concat(o.getElementsByTagNameNS(m,j));}}return a;};this.setAttribute=function(d,j,i){d=d.toLowerCase();var c=this.attributes.getNamedItem(d);if(!c){this.attributes.push(c=new apf.AmlAttr(this,d,j));if(!this.$amlLoaded){return;}if(i){c.$setValue(j);}else{c.dispatchEvent("DOMNodeInsertedIntoDocument",{relatedNode:this});c.dispatchEvent("DOMNodeInserted",{relatedNode:this,bubbles:true});}return;}c.$setValue(j);if(i||!this.$amlLoaded){return;}c.$triggerUpdate();};this.setAttributeNode=function(a){this.attributes.setNamedItem(a);};this.setAttributeNS=function(c,a,d){return this.setAttribute(a,d);};this.hasAttribute=function(a){return this.getAttributeNode(a)?true:false;};this.hasAttributeNS=function(c,a){return this.hasAttribute(a);};this.removeAttribute=function(a){this.attributes.removeNamedItem(a);return this;};this.removeAttributeNS=function(c,a){return this.removeAttribute(a);};this.removeAttributeNode=function(a){this.attributes.removeNamedItem(a.name);};this.getAttribute=function(c,a){var d=this.attributes.getNamedItem(c);return d?(a?d.inheritedValue||d.nodeValue:d.nodeValue):null;};this.getAttributeNode=function(a){return this.attributes.getNamedItem(a);};this.getBoundingClientRect=function(){return new apf.AmlTextRectangle(this);};this.querySelector=function(){};this.querySelectorAll=function(){};this.scrollIntoView=function(){};this.replaceMarkup=function(a,c){if(!c){c={};}if(!c.$intAML){c.$intAML=this.$aml;}if(!c.$int){c.$int=this.$int;}c.clear=true;for(var d=this.childNodes.length-1;d>=0;d--){var j=this.childNodes[d];if(j.destroy){j.destroy(true);}if(j.$ext!=this.$int){apf.destroyHtmlNode(j.$ext);}}this.childNodes.length=0;this.$int.innerHTML="<div class='loading'>loading...</div>";this.insertMarkup(a,c);};this.insertMarkup=function(c,d){if(typeof apf.offline!="undefined"&&!apf.offline.onLine){return false;}var a=new apf.XiInclude();a.setAttribute("href",c);if(d&&d.clear){a.setAttribute("clear",true);}a.options=d;a.callback=d&&d.callback;this.appendChild(a);};this.serialize=function(c){if(c||!this.firstChild){return"<"+(this.prefix?this.prefix+":"+this.localName+" xmlns:"+this.prefix+'="'+this.namespaceURI+'"':this.localName)+(this.attributes.length?" ":"")+this.attributes.join(" ")+"/>";}else{var d=["<"+(this.prefix?this.prefix+":"+this.localName+" xmlns:"+this.prefix+'="'+this.namespaceURI+'"':this.localName)+(this.attributes.length?" ":"")+this.attributes.join(" ")+">"];for(var a=this.firstChild;a;a=a.nextSibling){d.push(a.serialize());}return d.join("")+"</"+(this.prefix?this.prefix+":"+this.localName:this.localName)+">";}};this.$setInheritedAttribute=function(d){var c,a=this;c=a.getAttribute(d);if(!c){a=a.parentNode;while(a&&a.nodeType==1&&!(c=a.getAttribute(d,true))){a=a.parentNode;}}if(!c&&apf.config&&d){c=apf.config[d];}if(c){this.$clearDynamicProperty(d);if(typeof c=="string"&&(c.indexOf("{")>-1||c.indexOf("[")>-1)){this.$setDynamicProperty(d,c);this.$inheritProperties[d]=2;}else{this.setProperty(d,c,false,false,2);}}return c;};this.$handlePropSet=function(i,d,c){if(d&&this.$booleanProperties[i]){d=apf.isTrue(d);}this[i]=d;var a;return(a=this.$propHandlers&&this.$propHandlers[i]||this.nodeFunc==apf.NODE_VISIBLE&&apf.GuiElement&&apf.GuiElement.propHandlers[i]||null)&&a.call(this,d,i,c);};this.addEventListener("DOMNodeInsertedIntoDocument",function(s){var z,q,c,t=this.attributes;if(typeof apf.offline!="undefined"&&apf.offline.state.enabled){var A=apf.offline.state.getAll(this);for(q in A){z=t.getNamedItem(q);if(z){z.$setValue(A[q]);}else{this.attributes.push(new apf.AmlAttr(this,q,A[q]));}}}var n=apf.nameserver.getAll("defaults_"+this.localName);if(n.length){for(var m=0,o=n.length;m<o;m++){var w=n[m].attributes,u;for(q=0,c=w.length;q<c;q++){z=t.getNamedItem((u=w[q]).nodeName);if(z){if(z.value){continue;}z.$setValue(u.nodeValue);this.$inheritProperties[u.nodeName]=2;}else{this.attributes.push(new apf.AmlAttr(this,u.nodeName,u.nodeValue));this.$inheritProperties[u.nodeName]=2;}}}}for(q=0,c=t.length;q<c;q++){t[q].dispatchEvent("DOMNodeInsertedIntoDocument");}this.$amlLoaded=true;},true);}).call(apf.AmlElement.prototype=new apf.AmlNode());apf.AmlCharacterData=function(){this.data="";this.length=0;this.$init(true);this.appendData=function(a){this.dispatchEvent("DOMCharacterDataModified",{value:a});};this.deleteData=function(c,a){this.dispatchEvent("DOMCharacterDataModified",{offset:c,count:a});};this.insertData=function(c,a){this.dispatchEvent("DOMCharacterDataModified",{offset:c,count:a});};this.replaceData=function(d,a,c){this.dispatchEvent("DOMCharacterDataModified",{offset:d,count:a,value:c});};this.substringData=function(c,a){};};apf.AmlCharacterData.prototype=new apf.AmlNode();apf.AmlText=function(a){this.$init(a);};(function(){this.nodeType=this.NODE_TEXT;this.nodeName="#text";this.serialize=function(){return apf.xmlentities(this.nodeValue).replace(/</g,"&lt;").replace(/>/g,"&gt;");};this.$handlePropSet=function(d,c,a){this[d]=c;if(d=="data"){this.$clearDynamicProperty("calcdata");this.$setDynamicProperty(d,c);}else{if(this.$propHandlers[d]){this.$propHandlers[d].call(this,c,d);}}};this.$attrExcludePropBind={data:0};this.getAttribute=function(){};this.mainBind="data";this.$setValue=function(a){this.dispatchEvent("DOMCharacterDataModified",{bubbles:true,prevValue:this.nodeValue,newValue:this.nodeValue=a});if(this.$amlLoaded){this.$ext.nodeValue=a;}};this.addEventListener("DOMNodeInsertedIntoDocument",function(c){var d;if(!(d=this.parentNode.$int)){return;}this.$amlLoaded=true;var a=this.nodeValue;if(apf.config.liveText&&!this.parentNode.hasFeature(apf.__CHILDVALUE__)&&(a.indexOf("{")>-1||a.indexOf("[")>-1)){this.$supportedProperties=[];this.$propHandlers={};this.$booleanProperties={};this.$inheritProperties={};this.$propHandlers.calcdata=apf.LiveMarkupPi.prototype.$propHandlers.calcdata;this.$setInheritedAttribute=apf.AmlElement.prototype.$setInheritedAttribute;this.implement(apf.StandardBinding);d.appendChild(this.$ext=this.$int=document.createElement("span"));this.$setDynamicProperty("calcdata",this.nodeValue);return;}if(apf.hasTextNodeWhiteSpaceBug){var a=a.replace(/[\t\n\r ]+/g," ");if(a&&a!=" "){this.$ext=d.appendChild(d.ownerDocument.createTextNode(a));}}else{this.$ext=d.appendChild(d.ownerDocument.createTextNode(a));}},true);}).call(apf.AmlText.prototype=new apf.AmlCharacterData());apf.AmlTextRectangle=function(d){var a=this;function c(){var i=a.getAbsolutePosition(a.$ext);a.setProperty("left",i[0]);a.setProperty("top",i[1]);a.setProperty("right",document.documentElement.offsetWidth-i[0]);a.setProperty("bottom",document.documentElement.offsetWidth-i[1]);}d.addEventListener("prop.width",c);d.addEventListener("prop.height",c);d.addEventListener("prop.left",c);d.addEventListener("prop.top",c);c.call(d);};apf.AmlTextRectangle.prototype=new apf.Class();apf.AmlProcessingInstruction=function(a){this.$init(a);this.$supportedProperties=[];this.$propHandlers={};this.$booleanProperties={};this.$inheritProperties={};};(function(){this.nodeType=this.NODE_PROCESSING_INSTRUCTION;this.data=null;this.target=null;this.serialize=function(){return"<?"+this.target+"\n"+apf.xmlentities(this.nodeValue)+"\n?>";};this.$attrExcludePropBind=apf.extend({calcdata:0},this.$attrExcludePropBind);this.getAttribute=function(){};this.$setInheritedAttribute=apf.AmlElement.prototype.$setInheritedAttribute;this.$handlePropSet=function(d,c,a){this[d]=c;if(d=="data"){this.$clearDynamicProperty("calcdata");this.$setDynamicProperty("calcdata",c);}else{if(d=="target"){}else{if(this.$propHandlers[d]){this.$propHandlers[d].call(this,c,d);}}}};this.addEventListener("DOMNodeInsertedIntoDocument",function(a){var c;if(this.parentNode.$bindingRule||!(c=this.parentNode.$int)){return;}c.appendChild(this.$ext=this.$int=document.createElement("span"));this.$ext.host=this;this.$setDynamicProperty("calcdata",this.data);},true);this.addEventListener("DOMNodeRemovedFromDocument",function(a){this.$clearDynamicProperty("calcdata");});}).call(apf.AmlProcessingInstruction.prototype=new apf.AmlNode());apf.AmlDocument=function(){this.$prefixes={};this.$namespaceURIs={};this.domConfig=new apf.AmlConfiguration();this.$init();};(function(){this.nodeType=this.NODE_DOCUMENT;this.nodeFunc=apf.NODE_HIDDEN;this.nodeName="#document";this.$amlLoaded=true;this.activeElement=null;this.doctype=null;this.domConfig=null;this.implementation=null;this.characterSet=apf.characterSet;this.documentElement=null;this.getElementById=function(a){return self[a];};this.getElementsByTagName=function(c){var d,a=(d=this.documentElement).getElementsByTagName(c);if(d.tagName==c){a.push(d);}return a;};this.getElementsByTagNameNS=function(d,c){var i,a=(i=this.documentElement).getElementsByTagNameNS(d,c);if(i.tagName==c&&i.namespaceURI==d){a.push(i);}return a;};this.createElement=function(a){return this.$domParser.$createNode(this,this.NODE_ELEMENT,null,this.namespaceURI,a);};this.createElementNS=function(a,c){return this.$domParser.$createNode(this,this.NODE_ELEMENT,null,a,c);};this.importNode=function(c,a){if(a&&c.nodeType==1){return this.$domParser.parseFromXml(c,{doc:this,delay:true}).childNodes[0];}else{return this.$domParser.$createNode(this,c.nodeType,c);}};this.createAttribute=function(a){return this.$domParser.$createNode(this,this.NODE_ATTRIBUTE,null,this.nameSpaceURI,a);};this.createAttributeNS=function(a,c){return this.$domParser.$createNode(this,this.NODE_ATTRIBUTE,null,a,c);};this.createEvent=function(){return new apf.AmlEvent();};this.createComment=function(a){return this.$domParser.$createNode(this,this.NODE_COMMENT,null,null,null,a);};this.createProcessingInstruction=function(a){return this.$domParser.$createNode(this,this.NODE_PROCESSING_INSTRUCTION,null,null,null,a);};this.createCDATASection=function(a){return this.$domParser.$createNode(this,this.NODE_CDATA_SECTION,null,null,null,a);};this.createTextNode=function(a){return this.$domParser.$createNode(this,this.NODE_TEXT,null,null,null,a);};this.createDocumentFragment=function(){return this.$domParser.$createNode(this,this.NODE_DOCUMENT_FRAGMENT);};this.querySelector=function(){};this.querySelectorAll=function(){};this.evaluate=function(j,i,d,l,c){var a=apf.XPath.selectNodes(j,i||this.documentElement);return{snapshotLength:a.length,snapshotItem:function(m){return a[m];}};};this.createNSResolver=function(a){return{};};this.queryCommandState=function(a){if(!apf.document.activeElement||!apf.document.activeElement.$queryCommandState){return;}apf.document.activeElement.$queryCommandState(a);};this.queryCommandValue=function(a){if(!apf.document.activeElement||!apf.document.activeElement.$queryCommandValue){return;}apf.document.activeElement.$queryCommandValue(a);};this.execCommand=function(c,a,d){if(!apf.document.activeElement||!apf.document.activeElement.$execCommand){return;}apf.document.activeElement.$execCommand(c,d);};}).call(apf.AmlDocument.prototype=new apf.AmlNode());apf.AmlComment=function(a){this.nodeType=this.NODE_COMMENT;this.nodeName="#comment";this.$init(a);};(function(){this.serialize=function(){return"<!--"+this.nodeValue+"-->";};this.$setValue=function(a){this.dispatchEvent("DOMCharacterDataModified",{bubbles:true,newValue:a,prevValue:this.nodeValue});};}).call(apf.AmlComment.prototype=new apf.AmlCharacterData());apf.AmlNamedNodeMap=function(a){this.$host=a;};(function(){this.getNamedItem=function(a){for(var c=0;c<this.length;c++){if(this[c].name==a){return this[c];}}return false;};this.setNamedItem=function(j){var a=j.name;for(var d,c=this.length-1;c>=0;c--){if(this[c].name==a){this[c].ownerElement=null;this.splice(c,1);break;}}this.push(j);j.ownerElement=this.$host;j.$triggerUpdate();};this.removeNamedItem=function(a){for(var d,c=this.length-1;c>=0;c--){if(this[c].name==a){d=this[c];this.splice(c,1);break;}}if(!d){return false;}d.ownerElement.setProperty(a,"");d.ownerElement=null;return d;};this.item=function(a){return this[a];};this.length=0;this.splice=function(j,d){for(var c=j,a=this.length-d;c<a;c++){this[c]=this[c+1];}delete this[c];this.length-=d;};this.push=function(a){this[this.length++]=a;return this.length;};this.join=function(n){var c=[];for(var o,j,m=0,d=this.length;m<d;m++){if((o=(j=this[m]).ownerElement)&&!o.$inheritProperties[j.nodeName]){c.push(this[m]);}}return c.join(n);};}).call(apf.AmlNamedNodeMap.prototype={});apf.AmlEvent=function(a,c){this.name=a;var d;for(d in c){this[d]=c[d];}};apf.AmlEvent.prototype={bubbles:false,cancelBubble:false,preventDefault:function(){this.returnValue=false;},stopPropagation:function(){this.cancelBubble=true;},stop:function(){this.returnValue=false;this.cancelBubble=true;}};apf.AmlAttr=function(d,a,c){this.$init();this.ownerElement=d;this.ownerDocument=d.ownerDocument;this.nodeName=this.name=a;this.nodeValue=this.value=c;};(function(){this.nodeType=this.NODE_ATTRIBUTE;this.MODIFICATION=1;this.ADDITION=2;this.REMOVAL=3;this.serialize=this.toString=function(){return this.name+'="'+apf.xmlentities(String(this.value)).replace(/</g,"&lt;").replace(/>/g,"&gt;")+'"';};this.$setValue=function(a){this.nodeValue=this.value=a;this.specified=true;};this.$triggerUpdate=function(i){var a=this.name,d=this.value,c=this.ownerElement;if(a=="id"&&!this.specified&&c.id){this.specified=true;return;}if(a.substr(0,2)=="on"){if(c.$events[a]){c.removeEventListener(a.replace(/^on/,""),c.$events[a]);}if(d){c.addEventListener(a,(c.$events[a]=(typeof d=="string"?apf.lm.compile(d,{event:true,parsecode:true}):d)));}return;}else{if(this.specified){c.$clearDynamicProperty(a);}if(typeof d=="string"&&(c.$attrExcludePropBind[a]||(d.indexOf("{")>-1||d.indexOf("[")>-1))){c.$setDynamicProperty(a,d);return;}}c.setProperty(a,d);if(this.specified){c.dispatchEvent("DOMAttrModified",{relatedNode:this,attrChange:this.MODIFICATION,attrName:a,newValue:d,prevValue:null,bubble:true});}else{this.specified=true;}};this.addEventListener("DOMNodeInsertedIntoDocument",this.$triggerUpdate);}).call(apf.AmlAttr.prototype=new apf.AmlNode());apf.AmlCDATASection=function(a){this.nodeType=this.NODE_CDATA_SECTION;this.nodeName="#cdata-section";this.$init(a);};apf.AmlCDATASection.prototype=new apf.AmlText(true);apf.AmlCDATASection.prototype.serialize=function(){return"<![CDATA["+this.nodeValue+"]]>";};apf.AmlConfiguration=function(a){this.parameterNames=[];this.$init(a);};(function(){this.setParameter=this.setProperty;this.getParameter=this.getProperty;this.canSetParameter=function(a,c){return this.parameterNames.indexOf(a)>-1;};}).call(apf.AmlConfiguration.prototype=new apf.Class());apf.AmlDocumentFragment=function(a){this.$init(a);};apf.AmlDocumentFragment.prototype=new apf.AmlNode();apf.AmlDocumentFragment.prototype.nodeName="#document-fragment";apf.AmlDocumentFragment.prototype.nodeType=apf.AmlDocumentFragment.prototype.NODE_DOCUMENT_FRAGMENT;apf.xhtml=new apf.AmlNamespace();apf.setNamespace("http://www.w3.org/1999/xhtml",apf.xhtml);apf.XhtmlElement=function(d,c){this.$init(c||true,apf.NODE_VISIBLE,d);this.$xoe=this.addEventListener;this.addEventListener=this.$xae;this.removeEventListener=this.$xre;var a=this;this.$de=function(i){a.dispatchEvent(i.type,i);};};(function(){this.$xae=function(c,a){if(!this.$ext){return;}apf.addListener(this.$ext,c,this.$de);this.$xoe.apply(this,arguments);};this.$xre=function(c,a){if(!this.$ext){return;}apf.removeListener(this.$ext,c,this.$de);apf.AmlElement.prototype.removeEventListener.apply(this,arguments);};this.$handlePropSet=function(a,i,d){if(this.$booleanProperties[a]){i=apf.isTrue(i);}this[a]=i;var c=this.$propHandlers&&this.$propHandlers[a]||apf.GuiElement.propHandlers[a];if(c){c.call(this,i,null,a);}else{if(this.$int){this.$int.setAttribute(apf.isIE&&a=="class"?"className":a,i);}}};this.addEventListener("DOMNodeInsertedIntoDocument",function(a){var c;if(!(c=this.parentNode.$int)){return;}if(this.$aml){this.$ext=this.$int=apf.insertHtmlNode(this.$aml.serialize?this.$aml:this.$aml.cloneNode(false),c);}else{this.$ext=this.$int=c.appendChild(document.createElement(this.localName));}},true);}).call(apf.XhtmlElement.prototype=new apf.AmlElement());apf.xhtml.setElement("@default",apf.XhtmlElement);apf.XhtmlOptionElement=function(c,a){this.$init(a||"option",apf.NODE_VISIBLE,c);};(function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(a){this.$ext=this.$int=this.parentNode.$int.appendChild(this.parentNode.$int.ownerDocument.createElement("option"));if(this.value){this.$int.setAttribute("value",this.value);}},true);}).call(apf.XhtmlOptionElement.prototype=new apf.AmlElement());apf.xhtml.setElement("option",apf.XhtmlOptionElement);apf.XhtmlHtmlElement=function(c,a){this.$init(a||"html",apf.NODE_VISIBLE,c);this.$int=document.body;this.$tabList=[];this.$focussable=apf.KEYBOARD;this.focussable=true;this.visible=true;this.$isWindowContainer=true;this.focus=function(){this.dispatchEvent("focus");};this.blur=function(){this.dispatchEvent("blur");};apf.window.$addFocus(this);this.addEventListener("DOMNodeInsertedIntoDocument",function(s){var o,m,u,j,t,d=this.attributes,q=this.ownerDocument;for(o=0,m=d.length;o<m;o++){u=(j=d[o]).nodeName.split(":");if(u[0]=="xmlns"){if(t=u[1]){q.$prefixes[t]=j.nodeValue;q.$namespaceURIs[j.nodeValue]=t;}else{q.namespaceURI=j.nodeValue;}}}if(!q.namespaceURI){q.namespaceURI=apf.ns.xhtml;}});};apf.XhtmlHtmlElement.prototype=new apf.XhtmlElement();apf.xhtml.setElement("html",apf.XhtmlHtmlElement);apf.XhtmlSkipChildrenElement=function(c,a){this.$init(a,apf.NODE_VISIBLE,c);};(function(){this.canHaveChildren=false;this.$redraw=function(){var a=this;apf.queue.add("redraw"+this.$uniqueId,function(){var d=a.$ext.parentNode;var c=a.$ext.nextSibling;d.removeChild(a.$ext);a.$ext=apf.insertHtmlNode(null,d,c,a.$aml?(a.$aml.serialize?a.$aml.serialize():a.$aml.xml):a.serialize());});};this.addEventListener("DOMNodeInsertedIntoDocument",function(a){var c;if(!(c=this.parentNode.$int)){return;}this.$ext=apf.insertHtmlNode(null,c,null,this.$aml?(this.$aml.serialize?this.$aml.serialize():this.$aml.xml):this.serialize());},true);}).call(apf.XhtmlSkipChildrenElement.prototype=new apf.AmlElement());apf.xhtml.setElement("object",apf.XhtmlSkipChildrenElement);apf.xhtml.setElement("embed",apf.XhtmlSkipChildrenElement);apf.xhtml.setElement("table",apf.XhtmlSkipChildrenElement);apf.xhtml.setElement("pre",apf.XhtmlSkipChildrenElement);apf.XhtmlBodyElement=function(c,a){this.$init(a||"body",apf.NODE_VISIBLE,c);};(function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(a){if(!this.ownerDocument.body){this.ownerDocument.body=this;}this.$ext=this.$int=document.body;},true);}).call(apf.XhtmlBodyElement.prototype=new apf.AmlElement());apf.xhtml.setElement("body",apf.XhtmlBodyElement);apf.XhtmlIgnoreElement=function(c,a){this.$init(a,apf.NODE_VISIBLE,c);};apf.XhtmlIgnoreElement.prototype=new apf.AmlElement();apf.xhtml.setElement("script",apf.XhtmlIgnoreElement);apf.xhtml.setElement("noscript",apf.XhtmlIgnoreElement);apf.xhtml.setElement("head",apf.XhtmlIgnoreElement);apf.xhtml.setElement("meta",apf.XhtmlIgnoreElement);apf.xsd=new apf.AmlNamespace();apf.setNamespace("http://www.w3.org/2001/XMLSchema",apf.xsd);apf.xsd.typeHandlers={"http://www.w3.org/2001/XMLSchema":{dateTime:function(c){c=c.replace(/-/g,"/");c.match(/^(\d{2})\/(\d{2})\/(\d{4}) (\d{2}):(\d{2}):(\d{2})$/);if(!RegExp.$3||RegExp.$3.length<4){return false;}var a=new Date(c);if(a.getFullYear()!=parseFloat(RegExp.$3)){return false;}if(a.getMonth()!=parseFloat(RegExp.$2)-1){return false;}if(a.getDate()!=parseFloat(RegExp.$1)){return false;}if(a.getHours()!=parseFloat(RegExp.$4)){return false;}if(a.getMinutes()!=parseFloat(RegExp.$5)){return false;}if(a.getSeconds()!=parseFloat(RegExp.$5)){return false;}return true;},time:function(c){c.match(/^(\d{2}):(\d{2}):(\d{2})$/);var a=new Date("21/06/1980 "+c);if(a.getHours()!=parseFloat(RegExp.$1)){return false;}if(a.getMinutes()!=parseFloat(RegExp.$2)){return false;}if(a.getSeconds()!=parseFloat(RegExp.$3)){return false;}return true;},date:function(c){c=c.replace(/-/g,"/");c.match(/^(\d{2})\/(\d{2})\/(\d{4})$/);if(!RegExp.$3||RegExp.$3.length<4){return false;}var a=new Date(RegExp.$2+"/"+RegExp.$1+"/"+RegExp.$3);if(a.getFullYear()!=parseFloat(RegExp.$3)){return false;}if(a.getMonth()!=parseFloat(RegExp.$2)-1){return false;}if(a.getDate()!=parseFloat(RegExp.$1)){return false;}return true;},gYearMonth:function(c){c=c.replace(/-/g,"/");c.match(/^\/?(\d{4})(?:\d\d)?\/(\d{2})(?:\w|[\+\-]\d{2}:\d{2})?$/);if(!RegExp.$1||RegExp.$1.length<4){return false;}var a=new Date(c);if(a.getFullYear()!=parseFloat(RegExp.$)){return false;}if(a.getMonth()!=parseFloat(RegExp.$2)-1){return false;}return true;},gYear:function(c){c.match(/^\/?(\d{4})(?:\d\d)?(?:\w|[\+\-]\d{2}:\d{2})?$/);if(!RegExp.$1||RegExp.$1.length<4){return false;}var a=new Date(c);if(a.getFullYear()!=parseFloat(RegExp.$1)){return false;}return true;},gMonthDay:function(c){c=c.replace(/-/g,"/");c.match(/^\/\/(\d{2})\/(\d{2})(?:\w|[\+\-]\d{2}:\d{2})?$/);var a=new Date(c);if(a.getMonth()!=parseFloat(RegExp.$1)-1){return false;}if(a.getDate()!=parseFloat(RegExp.$2)){return false;}return true;},gDay:function(c){c=c.replace(/-/g,"/");c.match(/^\/{3}(\d{2})(?:\w|[\+\-]\d{2}:\d{2})?$/);var a=new Date(c);if(a.getDate()!=parseFloat(RegExp.$1)){return false;}return true;},gMonth:function(c){c=c.replace(/-/g,"/");c.match(/^\/{2}(\d{2})(?:\w|[\+\-]\d{2}:\d{2})?$/);var a=new Date(c);if(a.getMonth()!=parseFloat(RegExp.$1)-1){return false;}return true;},string:function(a){return typeof a=="string";},"boolean":function(a){return/^(true|false)$/i.test(a);},base64Binary:function(a){return true;},hexBinary:function(a){return/^(?:0x|x|#)?[A-F0-9]{0,8}$/i.test(a);},"float":function(a){return parseFloat(a)==a;},decimal:function(a){return/^[0-9\.\-,]+$/.test(a);},"double":function(a){return parseFloat(a)==a;},anyURI:function(a){return/^(?:\w+:\/\/)?(?:(?:[\w\-]+\.)+(?:[a-z]+)|(?:(?:1?\d?\d?|2[0-4]9|25[0-5])\.){3}(?:1?\d\d|2[0-4]9|25[0-5]))(?:\:\d+)?(?:\/([^\s\\\%]+|%[\da-f]{2})*)?$/i.test(a);},QName:function(a){return true;},normalizedString:function(a){return true;},token:function(a){return true;},language:function(a){return true;},Name:function(a){return true;},NCName:function(a){return true;},ID:function(a){return true;},IDREF:function(a){return true;},IDREFS:function(a){return true;},NMTOKEN:function(a){return true;},NMTOKENS:function(a){return true;},integer:function(a){return parseInt(a)==a;},nonPositiveInteger:function(a){return parseInt(a)==a&&a<=0;},negativeInteger:function(a){return parseInt(a)==a&&a<0;},"long":function(a){return parseInt(a)==a&&a>=-2147483648&&a<=2147483647;},"int":function(a){return parseInt(a)==a;},"short":function(a){return parseInt(a)==a&&a>=-32768&&a<=32767;},"byte":function(a){return parseInt(a)==a&&a>=-128&&a<=127;},nonNegativeInteger:function(a){return parseInt(a)==a&&a>=0;},unsignedLong:function(a){return parseInt(a)==a&&a>=0&&a<=4294967295;},unsignedInt:function(a){return parseInt(a)==a&&a>=0;},unsignedShort:function(a){return parseInt(a)==a&&a>=0&&a<=65535;},unsignedByte:function(a){return parseInt(a)==a&&a>=0&&a<=255;},positiveInteger:function(a){return parseInt(a)==a&&a>0;}},"http://ajax.org/2005/aml":{url:function(a){return/\b(https?|ftp):\/\/([\-A-Z0-9.]+)(\/[\-A-Z0-9+&@#\/%=~_|!:,.;]*)?(\?[\-A-Z0-9+&@#\/%=~_|!:,.;]*)?/i.test(a.trim());},website:function(a){return/^(?:http:\/\/)?([\w-]+\.)+\w{2,4}$/.test(a.trim());},email:function(a){return/^[A-Z0-9\.\_\%\-]+@(?:[A-Z0-9\-]+\.)+[A-Z]{2,4}$/i.test(a.trim());},creditcard:function(j){j=j.replace(/ /g,"");j=j.pad(21,"0",apf.PAD_LEFT);for(var d=0,c,a=j.length;a>=0;a--){c=j.substr(a,1)*(a%2+1);d+=c>9?c-9:c;}return d%10===0;},expdate:function(c){c=c.replace(/-/g,"/");c=c.split("/");var a=new Date(c[0]+"/01/"+c[1]);if(a.getYear()!=parseFloat(c[1])){return false;}if(a.getMonth()!=parseFloat(c[0])-1){return false;}return true;},wechars:function(a){return/^[0-9A-Za-z\xC0-\xCF\xD1-\xD6\xD8-\xDD\xDF-\xF6\xF8-\xFF -\.',]+$/.test(a);},phonenumber:function(a){return/^[\d\+\- \(\)]+$/.test(a);},faxnumber:function(a){return/^[\d\+\- \(\)]+$/.test(a);},mobile:function(a){return/^[\d\+\- \(\)]+$/.test(a);}}};apf.xsd.custumTypeHandlers={};apf.xsd.matchType=function(l,i){var a=i.split(":"),j=a[0],m=apf.document,d=m.$prefixes[j];i=a[1];if(j=="xsd"){d="http://www.w3.org/2001/XMLSchema";}if(!d){d=m.namespaceURI||apf.ns.xhtml;}var n=this.typeHandlers[d];if(n&&n[i]){return n[i](l);}throw new Error(apf.formatErrorString(0,null,"Validating XSD Type","Could not find type: "+i));return true;};apf.xsd.checkType=function(j,q){var o=typeof q=="object"?apf.queryValue(q):q;if(j.indexOf(":")>-1){var l=j.split(":"),d=l[0],a=l[1],n=apf.document,m=n.$prefixes[d];if(d=="xsd"){m="http://www.w3.org/2001/XMLSchema";}if(!m){m=n.namespaceURI||apf.ns.xhtml;}var i=this.typeHandlers[m];if(i&&i[a]){return i[a](o);}}if(this.custumTypeHandlers[j]){return this.custumTypeHandlers[j](o);}else{}};apf.XsdElement=function(c,a){this.$init(true);this.addEventListener("DOMNodeInserted",function(){if(!this.parentNode.$compile){this.$compile();}});this.addEventListener("DOMNodeRemoved",function(){if(!this.parentNode.$compile){this.$compile();}});this.addEventListener("DOMNodeInsertedIntoDocument",function(i){if(this.parentNode.$compile){return;}var d=this;apf.queue.add("compile"+this.$uniqueId,function(){d.$compile();});});};apf.XsdElement.prototype=new apf.AmlElement();apf.XsdElement.prototype.$recompile=function(a){if(!this.$amlLoaded){return;}if(this.parentNode.$recompile){this.parentNode.$recompile();}else{this.$compile();}};apf.XsdMaxInclusive=function(c,a){this.$init(a||"maxinclusive",apf.NODE_HIDDEN,c);};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();};this.$compile=function(a){a.push("if (parseFloat(value) > "+this.value+") return false;");};}).call(apf.XsdMaxInclusive.prototype=new apf.XsdElement());apf.xsd.setElement("maxinclusive",apf.XsdMaxInclusive);apf.XsdEnumeration=function(c,a){this.$init(a||"enumeration",apf.NODE_HIDDEN,c);};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();};this.$compile=function(a){if(a.enumDone){return;}a.enumDone=true;var i,c,j=[],d=this.parentNode.getElementsByTagNameNS(this.namespaceURI,"enumeration");for(i=0,c=d.length;i<c;i++){j.push(d[i].value);}a.push("if (!/^(?:"+j.join("|")+")$/.test(value)) return false;");};}).call(apf.XsdEnumeration.prototype=new apf.XsdElement());apf.xsd.setElement("enumeration",apf.XsdEnumeration);apf.XsdMaxScale=function(c,a){this.$init(a||"maxscale",apf.NODE_HIDDEN,c);};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();};this.$compile=function(a){};}).call(apf.XsdMaxScale.prototype=new apf.XsdElement());apf.xsd.setElement("maxscale",apf.XsdMaxScale);apf.XsdLength=function(c,a){this.$init(a||"length",apf.NODE_HIDDEN,c);};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();};this.$compile=function(a){a.push("if (value.length != "+this.value+") return false;");};}).call(apf.XsdLength.prototype=new apf.XsdElement());apf.xsd.setElement("length",apf.XsdLength);apf.XsdList=function(c,a){this.$init(a||"list",apf.NODE_HIDDEN,c);};(function(){this.$compile=function(a){};}).call(apf.XsdList.prototype=new apf.XsdElement());apf.xsd.setElement("list",apf.XsdList);apf.XsdPattern=function(c,a){this.$init(a||"pattern",apf.NODE_HIDDEN,c);};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();};this.$compile=function(a){a.push("if (!/^"+this.value.replace(/(\/|\^|\$)/g,"\\$1")+"$/.test(value)) return false;");};}).call(apf.XsdPattern.prototype=new apf.XsdElement());apf.xsd.setElement("pattern",apf.XsdPattern);apf.XsdTotalDigits=function(c,a){this.$init(a||"totaldigits",apf.NODE_HIDDEN,c);};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();};this.$compile=function(a){a.push("if (new String(parseFloat(value)).length == "+this.value+") return false;");};}).call(apf.XsdTotalDigits.prototype=new apf.XsdElement());apf.xsd.setElement("totaldigits",apf.XsdTotalDigits);apf.XsdMaxLength=function(c,a){this.$init(a||"maxlength",apf.NODE_HIDDEN,c);};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();};this.$compile=function(a){a.push("if (value.length > "+this.value+") return false;");};}).call(apf.XsdMaxLength.prototype=new apf.XsdElement());apf.xsd.setElement("maxlength",apf.XsdMaxLength);apf.XsdUnion=function(c,a){this.$init(a||"union",apf.NODE_HIDDEN,c);};(function(){this.$propHandlers.memberTypes=function(a){this.$memberTypes=a.splitSafe(" ");this.parentNode.$recompile();};this.$compile=function(a){var j,c,m,d=this.childNodes;for(j=0,c=this.$memberTypes.length;j<c;j++){a.push("if (apf.xsd.checkType('"+this.$memberTypes[j]+"', value)) return true;");}for(j=0,c=d.length;j<c;j++){(m=d[j]).$compile&&m.$compile(a);}};}).call(apf.XsdUnion.prototype=new apf.XsdElement());apf.xsd.setElement("union",apf.XsdUnion);apf.XsdMinScale=function(c,a){this.$init(a||"minscale",apf.NODE_HIDDEN,c);};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();};this.$compile=function(a){};}).call(apf.XsdMinScale.prototype=new apf.XsdElement());apf.xsd.setElement("minscale",apf.XsdMinScale);apf.XsdRestriction=function(c,a){this.$init(a||"restriction",apf.NODE_HIDDEN,c);};(function(){this.$propHandlers.base=function(){this.parentNode.$recompile();};this.$compile=function(a){a.push("if (!apf.xsd.matchType(value, '"+this.base+"')) return false;");var j,c,m,d=this.childNodes;for(j=0,c=d.length;j<c;j++){(m=d[j]).$compile&&m.$compile(a);}};}).call(apf.XsdRestriction.prototype=new apf.XsdElement());apf.xsd.setElement("restriction",apf.XsdRestriction);apf.XsdSimpleType=function(d,c){this.$init(c||"simpletype",apf.NODE_HIDDEN,d);var a;this.$propHandlers.name=function(i){if(a){apf.xsd.custumTypeHandlers[i]=apf.xsd.custumTypeHandlers[a];apf.xsd.custumTypeHandlers[a]=null;}a=i;};};(function(){this.$compile=function(a){var j,c,d,m;if(!this.parentNode.$compile){a=[];d=this.childNodes;for(j=0,c=d.length;j<c;j++){(m=d[j]).$compile&&m.$compile(a);}a.push("return true;");apf.xsd.custumTypeHandlers[this.name]=new Function("value",a.join("\n"));}else{d=this.childNodes;for(j=0,c=d.length;j<c;j++){(m=d[j]).$compile&&m.$compile(a);}}};}).call(apf.XsdSimpleType.prototype=new apf.XsdElement());apf.xsd.setElement("simpletype",apf.XsdSimpleType);apf.XsdMinLength=function(c,a){this.$init(a||"minlength",apf.NODE_HIDDEN,c);};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();};this.$compile=function(a){a.push("if (value.length < "+this.value+") return false;");};}).call(apf.XsdMinLength.prototype=new apf.XsdElement());apf.xsd.setElement("minlength",apf.XsdMinLength);apf.XsdSchema=function(c,a){this.$init(true);};apf.XsdSchema.prototype=new apf.XsdElement();apf.xsd.setElement("schema",apf.XsdSchema);apf.XsdMinInclusive=function(c,a){this.$init(a||"mininclusive",apf.NODE_HIDDEN,c);};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();};this.$compile=function(a){a.push("if (parseFloat(value) < "+this.value+") return false;");};}).call(apf.XsdMinInclusive.prototype=new apf.XsdElement());apf.xsd.setElement("mininclusive",apf.XsdMinInclusive);apf.XsdMinExclusive=function(c,a){this.$init(a||"minexclusive",apf.NODE_HIDDEN,c);};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();};this.$compile=function(a){a.push("if (parseFloat(value) => "+this.value+") return false;");};}).call(apf.XsdMinExclusive.prototype=new apf.XsdElement());apf.xsd.setElement("minexclusive",apf.XsdMinExclusive);apf.XsdFractionDigits=function(c,a){this.$init(a||"maxinclusive",apf.NODE_HIDDEN,c);};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();};this.$compile=function(a){a.push("if (parseFloat(value) == value && value.split('.')[1].length != "+this.value+") return false;");};}).call(apf.XsdFractionDigits.prototype=new apf.XsdElement());apf.xsd.setElement("maxinclusive",apf.XsdFractionDigits);apf.XsdMaxExclusive=function(c,a){this.$init(a||"maxexclusive",apf.NODE_HIDDEN,c);};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();};this.$compile=function(a){a.push("if (parseFloat(value) =< "+this.value+") return false;");};}).call(apf.XsdMaxExclusive.prototype=new apf.XsdElement());apf.xsd.setElement("maxexclusive",apf.XsdMaxExclusive);apf.xinclude=new apf.AmlNamespace();apf.setNamespace("http://www.w3.org/2001/XInclude",apf.xinclude);apf.html5=new apf.AmlNamespace();apf.setNamespace("",apf.html5);apf.HTML5INPUT={email:"textbox",url:"textbox",password:"textbox",datetime:"spinner",date:"calendar",month:"spinner",week:"spinner",time:"spinner",number:"spinner",range:"slider",checkbox:"checkbox",radio:"radiobutton",file:"upload",submit:"submit",image:"submit",reset:"button"};apf.runXslt=function(){apf.XSLTProcessor=function(){this.templates={};this.p={"value-of":function(d,l,j,a){var i,c=apf.XPath.selectNodes(l.getAttribute("select"),d)[0];if(!c){i="";}else{if(c.nodeType==1){i=c.firstChild?c.firstChild.nodeValue:"";}else{i=typeof c=="object"?c.nodeValue:c;}}a.appendChild(this.xmlDoc.createTextNode(i));},"copy-of":function(d,j,i,a){var c=apf.XPath.selectNodes(j.getAttribute("select"),d)[0];if(c){a.appendChild(apf.canImportNode?a.ownerDocument.importNode(c,true):c.cloneNode(true));}},"if":function(c,i,d,a){if(apf.XPath.selectNodes(i.getAttribute("test"),c)[0]){this.parseChildren(c,i,d,a);}},"for-each":function(m,o,n,a){var j,c,d=apf.XPath.selectNodes(o.getAttribute("select"),m);for(j=0,c=d.length;j<c;j++){this.parseChildren(d[j],o,n,a);}},choose:function(m,o,n,a){var j,c,d=o.childNodes;for(j=0,c=d.length;j<c;j++){if(!d[j].tagName){continue;}if(d[j][apf.TAGNAME]=="otherwise"||d[j][apf.TAGNAME]=="when"&&apf.XPath.selectNodes(d[j].getAttribute("test"),m)[0]){return this.parseChildren(m,d[j],n[j][2],a);}}},output:function(c,i,d,a){},param:function(c,i,d,a){},attribute:function(d,j,i,a){var c=this.xmlDoc.createDocumentFragment();this.parseChildren(d,j,i,c);a.setAttribute(j.getAttribute("name"),c.xml);},"apply-templates":function(d,D,C,I){var F,B,q,a;if(!D){F=this.templates["/"]||this.templates[d.tagName];if(F){this.parseChildren(F==this.templates["/"]?d.ownerDocument:d,F[0],F[1],I);}}else{if(D.getAttribute("select")){F=this.templates[D.getAttribute("select")];if(F){if(D.getAttribute("select")=="/"){return alert("Something went wrong. The / template was executed as a normal template");}a=d.selectNodes(D.getAttribute("select"));for(B=0,q=a.length;B<q;B++){this.parseChildren(a[B],F[0],F[1],I);}}}else{if(D.getAttribute("name")){F=this.templates[D.getAttribute("name")];if(F){this.parseChildren(d,F[0],F[1],I);}}else{var o=d.cloneNode(true),E=this.xmlDoc.createDocumentFragment(),z,c,w;a=o.childNodes;for(B=a.length-1;B>=0;B--){if(a[B].nodeType==3||a[B].nodeType==4){continue;}if(!a[B].nodeType==1){continue;}var m=a[B];for(z in this.templates){if(z=="/"){continue;}F=this.templates[z];var u=m.selectNodes("self::"+z);for(var A=u.length-1;A>=0;A--){var G=u[A];c=G.parentNode;this.parseChildren(G,F[0],F[1],E);if(E.childNodes){for(w=E.childNodes.length-1;w>=0;w--){c.insertBefore(E.childNodes[w],G);}}c.removeChild(G);}}if(m.parentNode){c=m.parentNode;this.p["apply-templates"].call(this,m,D,C,E);if(E.childNodes){for(w=E.childNodes.length-1;w>=0;w--){c.insertBefore(E.childNodes[w],m);}}c.removeChild(m);}}for(B=o.childNodes.length-1;B>=0;B--){I.insertBefore(o.childNodes[B],I.firstChild);}}}}},cache:{},"import":function(d,l,j,a){var c=l.getAttribute("href");if(!this.cache[c]){var i=apf.oHttp.get(c);this.cache[c]=i;}},include:function(c,i,d,a){},when:function(){},otherwise:function(){},"copy-clone":function(m,q,o,a){a=a.appendChild(apf.canImportNode?a.ownerDocument.importNode(q,false):q.cloneNode(false));if(a.nodeType==1){for(var n,j=0,d=a.attributes.length;j<d;j++){var c=a.attributes[j].nodeValue;if(!apf.isSafariOld&&a.attributes[j].nodeName.match(/^xmlns/)){continue;}a.attributes[j].nodeValue=a.attributes[j].nodeValue.replace(/\{([^\}]+)\}/g,function(i,l){var s=apf.XPath.selectNodes(l,m)[0];if(!s){n="";}else{if(s.nodeType==1){n=s.firstChild?s.firstChild.nodeValue:"";}else{n=typeof s=="object"?s.nodeValue:s;}}return n;});a.attributes[j].nodeValue;}}this.parseChildren(m,q,o,a);}};this.parseChildren=function(j,n,m,a){if(!m){return;}for(var d=0,c=m.length;d<c;d++){m[d][0].call(this,j,m[d][1],m[d][2],a);}};this.compile=function(n){var d=n.childNodes;for(var a=[],j=0,c=d.length;j<c;j++){if(d[j].nodeType!=1&&d[j].nodeType!=3&&d[j].nodeType!=4){continue;}if(d[j][apf.TAGNAME]=="template"){this.templates[d[j].getAttribute("match")||d[j].getAttribute("name")]=[d[j],this.compile(d[j])];}else{if(d[j][apf.TAGNAME]=="stylesheet"){this.compile(d[j]);}else{if(d[j].prefix=="xsl"){var m=this.p[d[j][apf.TAGNAME]];if(!m){alert("xsl:"+d[j][apf.TAGNAME]+" is not supported at this time on this platform");}else{a.push([m,d[j],this.compile(d[j])]);}}else{a.push([this.p["copy-clone"],d[j],this.compile(d[j])]);}}}}return a;};this.importStylesheet=function(c){this.xslDoc=c.nodeType==9?c.documentElement:c;var a=this.compile(c);this.xslStack=[[this.p["apply-templates"],null]];};this.transformToFragment=function(i,c){this.xmlDoc=c.nodeType!=9?c.ownerDocument:c;var d=this.xmlDoc.createDocumentFragment();if(!apf.isSafariOld&&i.nodeType==9){i=i.documentElement;}var a=this.parseChildren(i,this.xslDoc,this.xslStack,d);return d;};};self.XSLTProcessor=apf.XSLTProcessor;};apf.XiInclude=function(c,a){this.$init(a||"include",apf.NODE_HIDDEN,c);};apf.xinclude.setElement("include",apf.XiInclude);apf.aml.setElement("include",apf.XiInclude);(function(){this.$parsePrio="002";this.$propHandlers.href=this.$propHandlers.src=function(d){if(typeof d!="string"){return a.call(this,d);}this.$path=d.charAt(0)=="{"?d:apf.getAbsolutePath(apf.hostPath,d);var i=this.ownerDocument.$domParser;if(!this.defer){i.$shouldWait++;this.$parseContext=i.$callCount<2&&i.$parseContext||[this.parentNode];}c.call(this,this.$path);};function a(o){var s=this.ownerDocument.$domParser;if(this.clear){this.parentNode.$int.innerHTML="";}if(o){var j=s.parseFromXml(o,{doc:this.ownerDocument}).firstChild.childNodes,n=this.parentNode,q,m,d;for(q,m=0,d=j.length;m<d;m++){(q=j[m]).parentNode=null;n.insertBefore(q,this);}}if(!this.defer){s.$continueParsing.apply(s,this.$parseContext);}if(this.callback){this.callback({xmlNode:o,amlNode:this.parentNode});}this.parentNode.removeChild(this);}function c(i){var d=this;apf.getData(i,apf.extend(this.options||{},{callback:function(n,m,j){if(m!=apf.SUCCESS){var o=new Error(apf.formatErrorString(1007,d,"Loading Includes","Could not load Include file '"+(i||d.src)+"'\nReason: "+j.message));if(j.tpModule.retryTimeout(j,m,null,o)===true){return true;}apf.console.error(o.message);a.call(d,null);return;}n=n.replace(/\<\!DOCTYPE[^>]*>/,"").replace(/&nbsp;/g," ").replace(/^[\r\n\s]*/,"");if(!apf.supportNamespaces){n=n.replace(/xmlns\=\"[^"]*\"/g,"");}if(n.indexOf("<a:application")==-1){n="<a:application xmlns:a='"+apf.ns.aml+"'>"+n+"</a:application>";}var l=apf.getXml(n,null,true);if(!l){throw new Error(apf.formatErrorString(0,null,"Loading skin","Could not parse include file. Maybe the file does not exist?",l));}l.setAttribute("filename",j.url);a.call(d,l);},async:true,ignoreOffline:true}));}}).call(apf.XiInclude.prototype=new apf.AmlElement());apf.XiFallback=function(c,a){this.$init(a||"fallback",apf.NODE_HIDDEN,c);};apf.XiFallback.prototype=new apf.AmlElement();apf.XiFallback.prototype.$parsePrio="002";apf.xinclude.setElement("fallback",apf.XiFallback);apf.aml.setElement("fallback",apf.XiFallback);apf.__ANCHORING__=1<<13;apf.Anchoring=function(){this.$regbase=this.$regbase|apf.__ANCHORING__;this.$anchors=[];var m=1;var d=2;this.$updateQueue=0;this.$inited=this.$parsed=this.$anchoringEnabled=false;this.$hordiff=this.$verdiff=0;this.$rule_v=this.$rule_h=this.$rule_header="";var i=apf.layout;this.$supportedProperties.push("anchors");var c={right:function(l,s){if(!this.$anchoringEnabled&&!this.$setLayout("anchoring")){return;}if(!l){this.$ext.style[s]="";}if(!this.$updateQueue){i.queue(this.$pHtmlNode,this);}this.$updateQueue=this.$updateQueue|d;},bottom:function(l,s){if(!this.$anchoringEnabled&&!this.$setLayout("anchoring")){return;}if(!l){this.$ext.style[s]="";}if(!this.$updateQueue){i.queue(this.$pHtmlNode,this);}this.$updateQueue=this.$updateQueue|m;}};c.left=c.width=c.right;c.top=c.height=c.bottom;this.$propHandlers.anchors=function(l){this.$anchors=l?l.splitSafe("(?:, *| )"):[];if(!this.$anchoringEnabled&&!this.$setLayout("anchoring")){return;}if(!this.$updateQueue&&apf.loaded){i.queue(this.$pHtmlNode,this);}this.$updateQueue=this.$updateQueue|d|m;};this.$disableAnchoring=function(l){if(!this.$inited||!this.$anchoringEnabled||!this.$pHtmlNode){return;}i.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");if(i.queue){i.queue(this.$pHtmlNode);}for(var s in c){delete this.$propHandlers[s];}this.removeEventListener("DOMNodeRemoved",n);this.removeEventListener("DOMNodeInserted",a);if(this.right){this.$ext.style.left=this.$ext.offsetLeft;}if(this.bottom){this.$ext.style.top=this.$ext.offsetTop;}this.removeEventListener("prop.visible",j);this.$inited=false;this.$anchoringEnabled=false;};this.$enableAnchoring=function(){if(this.$inited){return;}apf.extend(this.$propHandlers,c);this.addEventListener("DOMNodeRemoved",n);this.addEventListener("DOMNodeInserted",a);this.addEventListener("prop.visible",j);this.$updateQueue=0|((this.left||this.width||this.right||this.anchors)&&d)|((this.top||this.height||this.bottom||this.anchors)&&m);if(this.$updateQueue){i.queue(this.$pHtmlNode,this);}this.$inited=true;this.$anchoringEnabled=true;};function j(l){if(!(this.$rule_header||this.$rule_v||this.$rule_h)){return;}if(l.value){if(this.$rule_v||this.$rule_h){var s=this.$rule_header+"\n"+this.$rule_v+"\n"+this.$rule_h;i.setRules(this.$pHtmlNode,this.$uniqueId+"_anchors",s);i.queue(this.$pHtmlNode,this);}i.processQueue();}else{i.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");i.queue(this.$pHtmlNode);}}function n(l){if(l&&(l.$doOnlyAdmin||l.currentTarget==this)){return;}if(i.queue&&this.$pHtmlNode){i.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");i.queue(this.$pHtmlNode);}}function a(l){if(!this.$amlLoaded||l.currentTarget!=this){return;}if(!l.$moveWithinParent&&this.$parsed){this.$moveAnchoringRules(l.$oldParentHtmlNode);}}this.$moveAnchoringRules=function(l,s){var t=l&&i.removeRule(l,this.$uniqueId+"_anchors");if(t){i.queue(l);}if(!this.$rule_v&&!this.$rule_h){return;}this.$rule_header=q.call(this);t=this.$rule_header+"\n"+this.$rule_v+"\n"+this.$rule_h;this.$ext.style.display="none";i.setRules(this.$pHtmlNode,this.$uniqueId+"_anchors",t);i.queue(this.$pHtmlNode,this);};this.$hasAnchorRules=function(){return this.$rule_v||this.$rule_h?true:false;};function q(){return"try{            var oHtml = "+(apf.hasHtmlIdsInJs?this.$ext.getAttribute("id"):"document.getElementById('"+this.$ext.getAttribute("id")+"')")+";                        var pWidth = "+(this.$pHtmlNode==this.$pHtmlDoc.body?"apf.getWindowWidth()":"oHtml.parentNode.offsetWidth")+";                        var pHeight = "+(this.$pHtmlNode==this.$pHtmlDoc.body?"apf.getWindowHeight()":"oHtml.parentNode.offsetHeight")+";            }catch(e){            }";}function o(s,l){return String(s).replace(apf.percentageMatch,"(("+l+" * $1)/100)");}this.$recalcAnchoring=function(l){var s=apf.getDiff(this.$ext);this.$hordiff=s[0];this.$verdiff=s[1];this.$updateQueue=this.$updateQueue|d|m;this.$updateLayout();i.queue(this.$pHtmlNode,this);if(!l){i.processQueue();}};this.$updateLayout=function(){if(!this.$ext.offsetHeight&&!this.$ext.offsetWidth){var z=this;var u=function(G,F,I){if(z.$updateQueue&&apf.isTrue(I)&&(z.$ext.offsetWidth||z.$ext.offsetHeight)){z.$updateLayout();apf.layout.activateRules(z.$ext.parentNode);var J=z;while(J){J.unwatch("visible",u);J=J.parentNode;}z.$isWaitingOnDisplay=false;}};this.$isWaitingOnDisplay=true;this.watch("visible",u);var s=this.parentNode;while(s){s.watch("visible",u);s=s.parentNode;}return;}if(!this.$parsed){if(!this.$ext.getAttribute("id")){apf.setUniqueHtmlId(this.$ext);}var B=apf.getDiff(this.$ext);this.$hordiff=B[0];this.$verdiff=B[1];if(this.$getOption){this.$minheight=Math.max(parseInt(this.$getOption("main","minheight"))||0,parseInt(this.getAttribute("minheight"))||0)||0;this.$maxheight=Math.min(parseInt(this.$getOption("main","maxheight"))||0,parseInt(this.getAttribute("maxheight"))||100000)||100000;this.$minwidth=Math.max(parseInt(this.$getOption("main","minwidth"))||0,parseInt(this.getAttribute("minwidth"))||0)||0;this.$maxwidth=Math.min(parseInt(this.$getOption("main","maxwidth"))||0,parseInt(this.getAttribute("maxwidth"))||100000)||100000;}else{this.$minheight=0;this.$maxheight=100000;this.$minwidth=0;this.$maxwidth=100000;}this.$rule_header=q.call(this);this.$parsed=true;}if(!this.$updateQueue){if(this.visible){this.$ext.style.display="";}return;}if(this.draggable=="relative"){if("absolute|fixed|relative".indexOf(apf.getStyle(this.$ext,"position"))==-1){this.$ext.style.position="absolute";}}else{if(this.left||this.top||this.right||this.bottom||this.$anchors.length){if("absolute|fixed".indexOf(apf.getStyle(this.$ext,"position"))==-1){this.$ext.style.position="absolute";}}}var E;if(this.$updateQueue&d){E=[];var w=this.left||this.$anchors[3],C=this.right||this.$anchors[1],t=this.width;if(C&&typeof C=="string"){C=o(C,"pWidth");}if(w){if(parseInt(w)!=w){w=o(w,"pWidth");E.push("oHtml.style.left = ("+w+") + 'px'");}else{this.$ext.style.left=w+"px";}}if(!w&&C){if(parseInt(C)!=C){C=o(C,"pWidth");E.push("oHtml.style.right = ("+C+") + 'px'");}else{this.$ext.style.right=C+"px";}}if(t){if(parseInt(t)!=t){t=o(t,"pWidth");E.push("oHtml.style.width = Math.max("+this.$minwidth+", Math.min("+this.$maxwidth+", "+t+" - "+this.$hordiff+")) + 'px'");}else{this.$ext.style.width=(t>this.$hordiff+this.$minwidth?(t<this.$hordiff+this.$maxwidth?t-this.$hordiff:this.$maxwidth):this.$minwidth)+"px";}}if(C!=null&&w!=null){E.push("oHtml.style.width = (pWidth - ("+C+") - ("+w+") - "+this.$hordiff+") + 'px'");}this.$rule_h=(E.length?"try{"+E.join(";}catch(e){};try{")+";}catch(e){};":"");}if(this.$updateQueue&m){E=[];var A=this.top||this.$anchors[0],l=this.bottom||this.$anchors[2],D=this.height;if(l&&typeof l=="string"){l=o(l,"pHeight");}if(A){if(parseInt(A)!=A){A=o(A,"pHeight");E.push("oHtml.style.top = ("+A+") + 'px'");}else{this.$ext.style.top=A+"px";}}if(!A&&l){if(parseInt(l)!=l){E.push("oHtml.style.bottom = ("+l+") + 'px'");}else{this.$ext.style.bottom=l+"px";}}if(D){if(parseInt(D)!=D){D=o(D,"pHeight");E.push("oHtml.style.height = Math.max("+this.$minheight+", Math.min("+this.$maxheight+", "+D+" - "+this.$verdiff+")) + 'px'");}else{this.$ext.style.height=(D>this.$verdiff+this.$minheight?(D<this.$verdiff+this.$maxheight?D-this.$verdiff:this.$maxheight):this.$minheight)+"px";}}if(l!=null&&A!=null){E.push("oHtml.style.height = (pHeight - ("+l+") - ("+A+") - "+this.$verdiff+") + 'px'");}this.$rule_v=(E.length?"try{"+E.join(";}catch(e){};try{")+";}catch(e){};":"");}if(this.$rule_v||this.$rule_h){i.setRules(this.$pHtmlNode,this.$uniqueId+"_anchors",this.$rule_header+"\n"+this.$rule_v+"\n"+this.$rule_h,true);}else{i.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");}this.$updateQueue=0;};this.addEventListener("DOMNodeInsertedIntoDocument",function(l){});this.addEventListener("DOMNodeRemovedFromDocument",function(l){this.$disableAnchoring();});};apf.__ALIGNMENT__=1<<12;apf.Alignment=function(){this.$regbase=this.$regbase|apf.__ALIGNMENT__;var l=apf.layout;if(typeof this.dock=="undefined"){this.dock=false;}if(typeof this.dockable=="undefined"){this.dockable=false;}this.$booleanProperties.dock=true;this.$booleanProperties.dockable=true;this.$supportedProperties.push("dock","dockable","align","lean","edge","weight","splitter","minwidth","minheight");this.$disableAlignment=function(purge){if(!this.aData||!this.$alignmentEnabled){return;}for(var prop in propHandlers){delete this.$propHandlers[prop];}this.removeEventListener("DOMNodeRemoved",remove);this.removeEventListener("DOMNodeInserted",reparent);this.removeEventListener("prop.visible",visibleHandler);remove.call(this);};this.$enableAlignment=function(purge){this.$alignmentEnabled=true;var buildParent="vbox|hbox".indexOf(this.parentNode.tagName)==-1&&!this.parentNode.pData;apf.extend(this.$propHandlers,propHandlers);this.addEventListener("DOMNodeRemoved",remove);this.addEventListener("DOMNodeInserted",reparent);this.addEventListener("prop.visible",visibleHandler);var layout=l.get(this.$pHtmlNode,buildParent?apf.getBox(this.parentNode.margin||this.$pHtmlNode.getAttribute("margin")||""):null);if(buildParent){this.parentNode.pData=l.parseXml(this.parentNode||apf.getXml("<vbox />"),layout,"vbox",true);layout.root=this.parentNode.pData;}if(!this.aData){this.aData=l.parseXml(this,layout,this,true);}if(this.align){l.addAlignNode(this,layout.root);if(this.aData.hidden||this.visible===false){this.aData.prehide(true);}this.$purgeAlignment();}else{var pData=this.parentNode.aData||this.parentNode.pData;this.aData.stackId=pData.children.push(this.aData)-1;this.aData.parent=pData;}};function visibleHandler(e){if(!this.aData){return;}if(!this.aData.hidden==e.value){return;}if(e.value){if(this.aData.preshow()!==false){this.$ext.style.display="none";}this.$purgeAlignment();}else{this.$ext.style.display="block";this.aData.prehide();this.$purgeAlignment();}apf.layout.processQueue();}this.$purgeAlignment=function(){var layout=l.get(this.$pHtmlNode);if(this.$ext&&this.$ext.style.display=="block"&&!this.$ext.offsetHeight&&!this.$ext.offsetWidth){var _self=this;var propChange=function(name,old,value){if(_self.$ext.offsetWidth||_self.$ext.offsetHeight){l.queue(_self.$pHtmlNode,null,layout.root);var p=_self;while(p){p.unwatch("visible",propChange);p=p.parentNode;}_self.$isWaitingOnDisplay=false;}};this.$isWaitingOnDisplay=true;this.watch("visible",propChange);var p=this.parentNode;while(p){p.watch("visible",propChange);p=p.parentNode;}return;}l.queue(this.$pHtmlNode,null,layout.root);};function remove(e){if(e&&(e.$doOnlyAdmin||e.currentTarget!=this)){return;}if(this.aData){this.aData.remove();this.$purgeAlignment();if(this.parentNode.pData&&!this.parentNode.pData.children.length){l.removeAll(this.parentNode.pData);this.parentNode.pData=null;}if(this.$ext){this.$ext.style.display="none";}}}function reparent(e){if(!this.$amlLoaded||e.currentTarget!=this){return;}if(!e.$moveWithinParent&&this.aData&&this.aData.pHtml!=this.$pHtmlNode){this.aData.pHtml=this.$pHtmlNode;this.$enableAlignment();}}var propHandlers={align:function(value){this.aData.remove();this.aData.template=value;this.splitter=undefined;this.aData.edgeMargin=this.edge||0;this.$enableAlignment();},lean:function(value){this.aData.isBottom=(value||"").indexOf("bottom")>-1;this.aData.isRight=(value||"").indexOf("right")>-1;this.$purgeAlignment();},edge:function(value){this.aData.edgeMargin=Math.max(this.aData.splitter||0,value!="splitter"?value:0);this.aData.splitter=value=="splitter"?5:false;this.$purgeAlignment();},weight:function(value){this.aData.weight=parseFloat(value);this.$purgeAlignment();},splitter:function(value){this.aData.splitter=value?5:false;this.aData.edgeMargin=Math.max(this.aData.splitter||0,this.edge||0);if(!value&&this.align&&this.align.indexOf("-splitter")){this.align=this.aData.template=this.align.replace("-splitter","");}this.$purgeAlignment();},width:function(value){this.width=null;this.aData.fwidth=value||false;if(this.aData.fwidth&&this.aData.fwidth.indexOf("/")>-1){this.aData.fwidth=eval(this.aData.fwidth);if(this.aData.fwidth<=1){this.aData.fwidth=(this.aData.fwidth*100)+"%";}}this.$purgeAlignment();},height:function(value){this.height=null;this.aData.fheight=String(value)||false;if(this.aData.fheight&&this.aData.fheight.indexOf("/")>-1){this.aData.fheight=eval(this.aData.fheight);if(this.aData.fheight<=1){this.aData.fheight=(this.aData.fheight*100)+"%";}}this.$purgeAlignment();},minwidth:function(value){this.aData.minwidth=value;this.$purgeAlignment();},minheight:function(value){this.aData.minheight=value;this.$purgeAlignment();}};this.addEventListener("DOMNodeRemovedFromDocument",function(e){this.$disableAlignment();this.aData=null;});};apf.__GUIELEMENT__=1<<15;apf.__VALIDATION__=1<<6;apf.GuiElement=function(){this.$init(true);};(function(){this.$regbase=this.$regbase|apf.__GUIELEMENT__;this.$focussable=apf.KEYBOARD_MOUSE;this.visible=true;this.$booleanProperties["disable-keyboard"]=true;this.$booleanProperties.visible=true;this.$booleanProperties.focussable=true;this.$supportedProperties.push("draggable","resizable");this.$supportedProperties.push("focussable","zindex","disabled","tabindex","disable-keyboard","contextmenu","visible","autosize","loadaml","actiontracker","alias","width","left","top","height");this.$setLayout=function(c){if(!this.$drawn||!this.$pHtmlNode){return false;}if(this.parentNode){if(this.parentNode.localName=="table"){this.parentNode.register(this);this.$disableCurrentLayout=null;return c=="table";}else{if(this.aData||this.align||"vbox|hbox".indexOf(this.parentNode.localName)>-1){if(!this.$alignmentEnabled){if(this.$disableCurrentLayout){this.$disableCurrentLayout();}this.$enableAlignment();this.$disableCurrentLayout=this.$disableAlignment;}return c=="alignment";}}}if(!this.$anchoringEnabled){if(this.$disableCurrentLayout){this.$disableCurrentLayout();}this.$enableAnchoring();this.$disableCurrentLayout=this.$disableAnchoring;}return c=="anchoring";};this.implement(apf.Anchoring,apf.Alignment);this.setWidth=function(c){this.setProperty("width",c,false,true);return this;};this.setHeight=function(c){this.setProperty("height",c,false,true);return this;};this.setLeft=function(c){this.setProperty("left",c,false,true);return this;};this.setTop=function(c){this.setProperty("top",c,false,true);return this;};if(!this.show){this.show=function(){this.setProperty("visible",true,false,true);return this;};}if(!this.hide){this.hide=function(){this.setProperty("visible",false,false,true);return this;};}this.getWidth=function(){return(this.$ext||{}).offsetWidth;};this.getHeight=function(){return(this.$ext||{}).offsetHeight;};this.getLeft=function(){return(this.$ext||{}).offsetLeft;};this.getTop=function(){return(this.$ext||{}).offsetTop;};this.enable=function(){this.setProperty("disabled",false,false,true);return this;};this.disable=function(){this.setProperty("disabled",true,false,true);return this;};this.sendToBack=function(){this.setProperty("zindex",0,false,true);return this;};this.bringToFront=function(){this.setProperty("zindex",apf.all.length+1,false,true);return this;};this.sendBackwards=function(){this.setProperty("zindex",this.zindex-1,false,true);return this;};this.bringForward=function(){this.setProperty("zindex",this.zindex+1,false,true);return this;};this.hasFocus=function(){};this.addEventListener("DOMNodeInsertedIntoDocument",function(d){var c=this.$aml;if(this.parentNode&&this.parentNode.$int!=this.$pHtmlNode){this.$pHtmlNode=this.parentNode.$int;}if(!this.$pHtmlNode){return;}this.$pHtmlDoc=this.$pHtmlNode.ownerDocument||document;if(this.$initSkin){this.$initSkin(c);}if(this.$draw){this.$draw();}if(d.id){this.$ext.setAttribute("id",d.id);}if(typeof this.visible=="undefined"){this.visible=true;}if(this.$focussable&&typeof this.focussable=="undefined"){apf.GuiElement.propHandlers.focussable.call(this);}this.$drawn=true;},true);this.addEventListener("DOMNodeInsertedIntoDocument",function(c){if(!this.$pHtmlNode){return;}this.$setLayout();if(this.$loadAml){this.$loadAml(this.$aml);}});var a;this.addEventListener("$event.resize",a=function(d){apf.layout.setRules(this.$ext,"resize","var o = apf.all["+this.$uniqueId+"];            if (o) o.dispatchEvent('resize');",true);apf.layout.queue(this.$ext);this.removeEventListener("$event.resize",a);});this.addEventListener("contextmenu",function(s){if(!this.contextmenus){return;}if(this.hasFeature(apf.__DATABINDING__)){var c;var w=this.hasFeature(apf.__MULTISELECT__)?this.selected:this.xmlRoot;var q,o,n,d,j,t,u,z;for(q=0,o=this.contextmenus.length;q<o;q++){d=(typeof(u=this.contextmenus[q])=="string");z=null;if(!d&&u.match&&w){z=(u.cmatch||(u.cmatch=apf.lm.compile(u.match,{xpathmode:3,injectself:true})))(w);}if(d||w&&z||!u.match){t=d?u:u.menu;if(!self[t]){return;}self[t].display(s.x,s.y,null,this,w);s.returnValue=false;s.cancelBubble=true;break;}}}else{t=typeof this.contextmenus[0]=="string"?this.contextmenus[0]:this.contextmenus[0].getAttribute("menu");if(!self[t]){return;}self[t].display(s.x,s.y,null,this);s.returnValue=false;s.cancelBubble=true;}});}).call(apf.GuiElement.prototype=new apf.AmlElement());apf.GuiElement.propHandlers={focussable:function(a){if(typeof a=="undefined"){this.focussable=true;}if(!this.hasFeature(apf.__FOCUSSABLE__)){this.implement(apf.Focussable);}if(this.focussable){apf.window.$addFocus(this,this.tabindex);}else{apf.window.$removeFocus(this);}},zindex:function(a){this.$ext.style.zIndex=a;},visible:function(a){if(apf.isFalse(a)||typeof a=="undefined"){this.$ext.style.display="none";if(apf.document.activeElement==this||this.canHaveChildren&&apf.isChildOf(this,apf.document.activeElement,false)){if(apf.config.allowBlur&&this.hasFeature(apf.__FOCUSSABLE__)){this.blur();}else{apf.window.moveNext();}}this.visible=false;}else{this.$ext.style.display="block";if(apf.layout&&this.$int){apf.layout.forceResize(this.$int);}this.visible=true;}},disabled:function(n){if(!this.$drawn){var a=this;this.disabled=false;apf.queue.add("disable"+this.$uniqueId,function(i){a.disabled=n;apf.GuiElement.propHandlers.disabled.call(a,n);});return;}if(this.canHaveChildren){if(n!=-1){n=this.disabled=apf.isTrue(n);}var d=this.childNodes;for(var m,j=0,c=d.length;j<c;j++){m=d[j];if(m.nodeFunc==apf.NODE_VISIBLE){if(n&&m.disabled!=-1){m.$disabled=m.disabled||false;}m.setProperty("disabled",n?-1:false);}}if(this.$isWindowContainer){return;}}if(n==-1||n==false){}else{if(typeof this.$disabled=="boolean"){if(n===null){n=this.$disabled;this.$disabled=null;}else{this.$disabled=n||false;return;}}}if(apf.isTrue(n)||n==-1){this.disabled=false;if(apf.document.activeElement==this){apf.window.moveNext(true);if(apf.document.activeElement==this){this.$blur();}}if(this.hasFeature(apf.__PRESENTATION__)){this.$setStyleClass(this.$ext,this.$baseCSSname+"Disabled");}if(this.$disable){this.$disable();}this.disabled=n;}else{if(this.hasFeature(apf.__DATABINDING__)&&apf.config.autoDisable&&!(!this.$bindings||this.xmlRoot)){return false;}this.disabled=false;if(apf.document.activeElement==this){this.$focus();}if(this.hasFeature(apf.__PRESENTATION__)){this.$setStyleClass(this.$ext,null,[this.$baseCSSname+"Disabled"]);}if(this.$enable){this.$enable();}}},enabled:function(a){this.setProperty("disabled",!a);},"disable-keyboard":function(a){this.disableKeyboard=apf.isTrue(a);},contextmenu:function(a){this.contextmenus=[a];},actiontracker:function(a){if(!a){this.$at=null;}else{if(a.tagName=="actiontracker"){this.$at=a;}else{this.$at=typeof a=="string"&&self[a]?apf.nameserver.get("actiontracker",a)||self[a].getActionTracker():apf.setReference(a,apf.nameserver.register("actiontracker",a,new apf.actiontracker()));if(!this.$at.name){this.$at.name=a;}}}},aml:function(a){this.insertMarkup(a);},editable:function(a){this.implement(apf.ContentEditable2);this.$propHandlers.editable.apply(this,arguments);},contenteditable:function(a){this.implement(apf.ContentEditable);if(!this.hasFeature(apf.__VALIDATION__)){this.implement(apf.Validation);}this.$propHandlers.contenteditable.apply(this,arguments);}};apf.__PRESENTATION__=1<<9;apf.Presentation=function(){this.$init(true);};(function(){this.$regbase=this.$regbase|apf.__PRESENTATION__;this.$supportedProperties.push("skin");this.$propHandlers.skinset=this.$propHandlers.skin=function(j){if(!this.$amlLoaded){return;}if(!this.$skinTimer){var i=this;clearTimeout(this.$skinTimer);this.$skinTimer=$setTimeout(function(){a.call(i,j);delete i.$skinTimer;});}};this.$propHandlers.style=function(i){if(!this.styleAttrIsObj&&this.$amlLoaded){this.$ext.setAttribute("style",i);}};var c;this.$propHandlers["class"]=function(i){this.$setStyleClass(this.$ext,i,[c||""]);};this.$forceSkinChange=function(j,i){a.call(this,j,i);};function a(G,n){clearTimeout(this.$skinTimer);if(this.selectable){var u=this.getSelection();}var t=this.$ext,B=this.$int,E=t.nextSibling,o=this.$ext.getAttribute("id"),q=this.$baseCSSname;if(t.parentNode){t.parentNode.removeChild(t);}if(this.$destroy){this.$destroy(true);}this.skin=G;this.$loadSkin(n?n+":"+G:null);if(this.$draw){this.$draw(true);}if(o){this.$ext.setAttribute("id",o);}if(E){this.$ext.parentNode.insertBefore(this.$ext,E);}var A,z,C=[],w=(t.className||"").splitSafe("s+");for(A=0;A<w;A++){if(w[A]&&w[A]!=q){C.push(w[A].replace(q,this.$baseCSSname));}}apf.setStyleClass(this.$ext,C.join(" "));var m,D=apf.skins.events;for(A=0,z=D.length;A<z;A++){m=D[A];if(typeof t[m]=="function"&&!this.$ext[m]){this.$ext[m]=t[m];}}this.$ext.style.left=t.style.left;this.$ext.style.top=t.style.top;this.$ext.style.width=t.style.width;this.$ext.style.height=t.style.height;this.$ext.style.right=t.style.right;this.$ext.style.bottom=t.style.bottom;this.$ext.style.zIndex=t.style.zIndex;this.$ext.style.position=t.style.position;this.$ext.style.display=t.style.display;if(this.$loadAml){this.$loadAml(this.$aml);}if(this.$int&&this.$int!=B){var s,F=this.$int,j=B.childNodes;for(var A=j.length-1;A>=0;A--){if((s=j[A]).host){s.host.$pHtmlNode=F;if(s.host.$isLeechingSkin){d.call(s.host);}}F.insertBefore(s,F.firstChild);}this.$int.onresize=B.onresize;}if(this.hasFeature(apf.__DRAGDROP__)){if(document.elementFromPointAdd){document.elementFromPointRemove(t);document.elementFromPointAdd(this.$ext);}}if(this.disabled){this.$disable();}if(this.$focussable&&apf.document.activeElement==this){this.$focus();}if(this.hasFeature(apf.__DATABINDING__)&&this.xmlRoot){this.reload();}else{if(this.value){this.$propHandlers.value.call(this,this.value);}}this.dispatchEvent("$skinchange");if(this.hasFeature(apf.__MULTISELECT__)){if(this.selectable){this.selectList(u,true);}}if(this.hasFeature(apf.__ANCHORING__)){this.$recalcAnchoring();}if(this.hasFeature(apf.__ALIGNMENT__)){if(this.aData){this.aData.oHtml=this.$ext;}if(this.pData){this.pData.oHtml=this.$ext;this.pData.pHtml=this.$int;var j=this.pData.childNodes;for(A=0;A<j.length;A++){j[A].pHtml=this.$int;}}}if(this.draggable&&this.$propHandlers.draggable){this.$propHandlers.draggable.call(this,this.draggable);}if(this.resizable&&this.$propHandlers.resizable){this.$propHandlers.resizable.call(this,this.resizable);}apf.layout.forceResize(this.$ext);}this.$setStyleClass=apf.setStyleClass;function d(o){if(!this.$amlLoaded||o&&(o.$moveWithinParent||o.currentTarget!=this)){return;}this.$setInheritedAttribute(this,"skinset");if(this.attributes.getNamedItem("skin")){return;}var i,l=this.parentNode,j;if((i=this.$canLeechSkin.dataType==apf.STRING?this.$canLeechSkin:this.localName)&&l.$originalNodes&&(j=l.$originalNodes[i])&&j.getAttribute("inherit")){var m=j.getAttribute("link");this.$isLeechingSkin=true;if(m){this.$forceSkinChange(m);}else{var n=l.skinName.split(":");this.$forceSkinChange(n[1],n[0]);}}else{if(this.$isLeechingSkin){delete this.kin;this.$forceSkinChange();}}}this.$initSkin=function(i){if(this.$canLeechSkin){this.addEventListener("DOMNodeInserted",d);}if(!this.skin){this.skin=this.getAttribute("skin");}var j,m=this.parentNode,l;if(this.$canLeechSkin&&!this.skin&&(j=this.$canLeechSkin.dataType==apf.STRING?this.$canLeechSkin:this.localName)&&m.$originalNodes&&(l=m.$originalNodes[j])&&l.getAttribute("inherit")){var n=l.getAttribute("link");this.$isLeechingSkin=true;if(n){this.skin=n;this.$loadSkin();}else{this.$loadSkin(m.skinName);}}else{if(!this.skinset){this.skinset=this.getAttribute("skinset");}this.$loadSkin(null,this.$canLeechSkin);}};this.$loadSkin=function(l,j){this.baseSkin=l||(this.skinset||this.$setInheritedAttribute("skinset"))+":"+(this.skin||this.localName);clearTimeout(this.$skinTimer);if(this.skinName){this.$blur();this.$baseCSSname=null;}this.skinName=this.baseSkin;this.$pNodes={};this.$originalNodes=apf.skins.getTemplate(this.skinName,true);if(!this.$originalNodes){var m=this.skin;if(m){var i=this.skinName.split(":")[0];this.baseName=this.skinName="default:"+m;this.$originalNodes=apf.skins.getTemplate(this.skinName);if(!this.$originalNodes&&i!="default"){this.baseName=this.skinName=i+":"+this.localName;this.$originalNodes=apf.skins.getTemplate(this.skinName,true);}}if(!this.$originalNodes){this.baseName=this.skinName="default:"+this.localName;this.$originalNodes=apf.skins.getTemplate(this.skinName);}if(!this.$originalNodes){if(j){return(this.baseName=this.skinName=this.originalNode=null);}throw new Error(apf.formatErrorString(1077,this,"Presentation","Could not load skin: "+this.baseSkin));}}if(this.$originalNodes){apf.skins.setSkinPaths(this.skinName,this);}};this.$getNewContext=function(j,i){this.$pNodes[j]=this.$originalNodes[j].cloneNode(true);};this.$hasLayoutNode=function(i){return this.$originalNodes[i]?true:false;};this.$getLayoutNode=function(i,m,l){var j=this.$pNodes[i]||this.$originalNodes[i];if(!j){return false;}if(!m){return apf.getFirstElement(j);}var n=j.selectSingleNode("@"+m);if(!n){return null;}return(l?apf.queryNode(n.nodeValue,l):apf.getFirstElement(j).selectSingleNode(n.nodeValue));};this.$getOption=function(j,m){j=j.toLowerCase();var l=this.$pNodes[j]||this.$originalNodes[j];if(!m||!l){return l;}var i=l.selectSingleNode("@"+m);return i?i.nodeValue:"";};this.$getExternal=function(i,j,m,n){if(!j){j=this.$pHtmlNode;}if(!i){i="main";}i=i.toLowerCase();this.$getNewContext(i);var o=this.$getLayoutNode(i);var l;if(l=(n||this).getAttributeNode("style")){o.setAttribute("style",l.nodeValue);}if(l=(n||this).getAttributeNode("class")){this.$setStyleClass(o,(c=l.nodeValue));}if(m){m.call(this,o);}o=apf.insertHtmlNode(o,j);o.host=this;if(l=(n||this).getAttributeNode("bgimage")){o.style.backgroundImage="url("+apf.getAbsolutePath(this.mediaPath,l.nodeValue)+")";}if(!this.$baseCSSname){this.$baseCSSname=o.className.trim().split(" ")[0];}return o;};this.$focus=function(){if(!this.$ext){return;}this.$setStyleClass(this.oFocus||this.$ext,this.$baseCSSname+"Focus");};this.$blur=function(){if(this.renaming){this.stopRename(null,true);}if(!this.$ext){return;}this.$setStyleClass(this.oFocus||this.$ext,"",[this.$baseCSSname+"Focus"]);};this.$fixScrollBug=function(){if(this.$int!=this.$ext){this.oFocus=this.$int;}else{this.oFocus=this.$int=this.$ext.appendChild(document.createElement("div"));this.$int.style.height="100%";this.$int.className="focusbug";}};}).call(apf.Presentation.prototype=new apf.GuiElement());apf.config.$inheritProperties.skinset=1;apf.__VALIDATION__=1<<6;apf.validator={macro:{datatype:"apf.xsd.matchType(value, '",datatype_:"')",pattern:"value.match(",pattern_:")",custom:"(",custom_:")",min:"parseInt(value) >= ",max:"parseInt(value) <= ",maxlength:"value.toString().length <= ",minlength:"value.toString().length >= ",notnull:"value.toString().length > 0",checkequal:"!(temp = ",checkequal_:").isValid() || temp.getValue() == value"},compile:function(c){var a=this.macro,d=["var temp, valid = true;             if (!validityState)                 validityState = new apf.validator.validityState(); "];if(c.required){d.push("if (checkRequired && (!value || value.toString().trim().length == 0)) {                validityState.$reset();                validityState.valueMissing = true;                valid = false;            }");}d.push("validityState.$reset();            if (value) {");for(prop in c){if(!a[prop]){continue;}d.push("if (!(",a[prop],c[prop],a[prop+"_"]||"",")){                validityState.$set('",prop,"');                valid = false;            }");}d.push("};validityState.valid = valid; return validityState;");return new Function("value","checkRequired","validityState",d.join(""));}};apf.validator.validityState=function(){this.valueMissing=false,this.typeMismatch=false,this.patternMismatch=false,this.tooLong=false,this.rangeUnderflow=false,this.rangeOverflow=false,this.stepMismatch=false,this.customError=false,this.valid=true,this.$reset=function(){for(var a in this){if(a.substr(0,1)=="$"){continue;}this[a]=false;}this.valid=true;},this.$set=function(a){switch(a){case"min":this.rangeUnderflow=true;break;case"max":this.rangeOverflow=true;break;case"minlength":this.tooShort=true;break;case"maxlength":this.tooLong=true;break;case"pattern":this.patternMismatch=true;break;case"datatype":this.typeMismatch=true;break;case"notnull":this.typeMismatch=true;break;case"checkequal":this.typeMismatch=true;break;}};};apf.Validation=function(){this.$regbase=this.$regbase|apf.__VALIDATION__;this.isValid=function(c){if(!this.$vOptions){return true;}(this.$vOptions.isValid||(this.$vOptions.isValid=apf.validator.compile(this.$vOptions))).call(this,typeof this.getValue=="function"?this.getValue(null,true):null,c,this.validityState||(this.validityState=new apf.validator.validityState()));var a=this.validityState.valid;if(!a){this.dispatchEvent("invalid",this.validityState);}return a;};this.setCustomValidity=function(a){};this.showMe=function(){var a=this.parentNode;while(a){if(a.show){a.show();}a=a.parentNode;}};this.checkValidity=this.validate=function(a,d,c){if(c||!this.isValid(!a)&&!d){this.setError();return false;}else{this.clearError();return true;}};this.setError=function(c){if(!this.$validgroup){this.$propHandlers.validgroup.call(this,"vg"+this.parentNode.$uniqueId);}var a=this.$validgroup.getErrorBox(this);if(!this.$validgroup.allowMultipleErrors){this.$validgroup.hideAllErrors();}a.setMessage(this.invalidmsg);apf.setStyleClass(this.$ext,this.$baseCSSname+"Error");this.showMe();a.display(this);if(this.hasFeature(apf.__MULTISELECT__)&&this.validityState.$errorXml){this.select(this.validityState.$errorXml);}if(apf.document.activeElement&&apf.document.activeElement!=this){this.focus(null,{mouse:true});}};this.clearError=function(c){if(this.$setStyleClass){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Error"]);}if(this.$validgroup){var a=this.$validgroup.getErrorBox(null,true);if(!a||a.host!=this){return;}a.hide();}};this.addEventListener("DOMNodeRemovedFromDocument",function(a){if(this.$validgroup){this.$validgroup.unregister(this);}});this.addEventListener("DOMNodeInsertedIntoDocument",function(a){if(!this.validgroup){this.$setInheritedAttribute("validgroup");}});this.$attrExcludePropBind=apf.extend({pattern:1,validtest:3},this.$attrExcludePropBind);this.$booleanProperties.required=true;this.$supportedProperties.push("validgroup","required","datatype","pattern","min","max","maxlength","minlength","validtest","notnull","checkequal","invalidmsg","requiredmsg");this.$fValidate=function(){if(this.contenteditable){return;}if(!this.$validgroup){this.validate(true);}else{var a=this.$validgroup.getErrorBox(this);if(!a.visible||a.host!=this){this.validate(true);}}};this.addEventListener("blur",this.$fValidate);this.$propHandlers.validgroup=function(c){if(c){var a;if(typeof c!="string"){this.$validgroup=c.name;a=c;}else{a=apf.nameserver.get("validgroup",c);}this.$validgroup=a||new apf.ValidationGroup(c);this.$validgroup.register(this);}else{this.$validgroup.unregister(this);this.$validgroup=null;}};this.$propHandlers.pattern=function(a,c){if(a.substr(0,1)!="/"){a="/"+a+"/";}(this.$vOptions||(this.$vOptions={}))[c]=a;delete this.$vOptions.isValid;};this.$propHandlers.datatype=this.$propHandlers.required=this.$propHandlers.custom=this.$propHandlers.min=this.$propHandlers.max=this.$propHandlers.maxlength=this.$propHandlers.minlength=this.$propHandlers.notnull=this.$propHandlers.checkequal=function(a,c){(this.$vOptions||(this.$vOptions={}))[c]=a;delete this.$vOptions.isValid;};this.$propHandlers.validtest=function(d){var a=this,c={};this.removeValidationCache=function(){c={};};this.$checkRemoteValidation=function(){var i=this.getValue();if(typeof c[i]=="boolean"){return c[i];}if(c[i]==-1){return true;}c[i]=-1;apf.getData(this.validtest,{xmlNode:this.xmlRoot,value:this.getValue(),callback:function(n,m,j){if(m!=apf.SUCCESS){if(m==apf.TIMEOUT&&j.retries<apf.maxHttpRetries){return j.tpModule.retry(j.id);}else{var l=new Error(apf.formatErrorString(0,a,"Validating entry at remote source","Communication error: \n\n"+j.message));if(a.dispatchEvent("error",apf.extend({error:l,state:status},j))!==false){throw l;}return;}}c[i]=apf.isTrue(n);if(!c[i]){if(!a.hasFocus()){a.setError();}}else{a.clearError();}}});return true;};(this.$vOptions||(this.$vOptions={})).custom="apf.lookup("+this.$uniqueId+").$checkRemoteValidation()";delete this.$vOptions.isValid;};};apf.GuiElement.propHandlers.datatype=apf.GuiElement.propHandlers.required=apf.GuiElement.propHandlers.pattern=apf.GuiElement.propHandlers.min=apf.GuiElement.propHandlers.max=apf.GuiElement.propHandlers.maxlength=apf.GuiElement.propHandlers.minlength=apf.GuiElement.propHandlers.notnull=apf.GuiElement.propHandlers.checkequal=apf.GuiElement.propHandlers.validtest=function(a,c){this.implement(apf.Validation);this.$propHandlers[c].call(this,a,c);};apf.ValidationGroup=function(a){this.$init();this.childNodes=[];if(a){apf.setReference(a,this);}this.name=a||"validgroup"+this.$uniqueId;apf.nameserver.register("validgroup",this.name,this);};(function(){this.validateVisibleOnly=false;this.allowMultipleErrors=false;this.register=function(o){if(o.hasFeature(apf.__VALIDATION__)){this.childNodes.push(o);}};this.unregister=function(o){this.childNodes.remove(o);};this.toString=function(){return"[APF Validation Group]";};var errbox;this.getErrorBox=function(o,no_create){if(this.allowMultipleErrors||!errbox&&!no_create){errbox=new apf.errorbox();errbox.$pHtmlNode=o.$ext.parentNode;errbox.skinset=apf.getInheritedAttribute(o.parentNode,"skinset");errbox.dispatchEvent("DOMNodeInsertedIntoDocument");}return errbox;};this.hideAllErrors=function(){if(errbox&&errbox.host){errbox.host.clearError();}};function checkValidChildren(oParent,ignoreReq,nosetError){var found;for(var v,i=0;i<oParent.childNodes.length;i++){var oEl=oParent.childNodes[i];if(!oEl){continue;}if(!oEl.disabled&&(!this.validateVisibleOnly&&oEl.visible||!oEl.$ext||oEl.$ext.offsetHeight)&&(oEl.hasFeature(apf.__VALIDATION__)&&oEl.isValid&&!oEl.isValid(!ignoreReq))){if(!nosetError){if(!found){oEl.validate(true,null,true);found=true;if(!this.allowMultipleErrors){return true;}}else{if(oEl.errBox&&oEl.errBox.host==oEl){oEl.errBox.hide();}}}else{if(!this.allowMultipleErrors){return true;}}}if(oEl.canHaveChildren&&oEl.childNodes.length){found=checkValidChildren.call(this,oEl,ignoreReq,nosetError)||found;if(found&&!this.allowMultipleErrors){return true;}}}return found;}this.checkValidity=this.validate=this.isValid=function(ignoreReq,nosetError,page){var found=checkValidChildren.call(this,page||this,ignoreReq,nosetError);if(page){if(page.validation&&!eval(page.validation)){alert(page.invalidmsg);found=true;}}return !found;};}).call(apf.ValidationGroup.prototype=new apf.Class());apf.config.$inheritProperties.validgroup=1;apf.__DATABINDING__=1<<1;apf.DataBinding=function(){this.$init(true);this.$loadqueue=this.$dbTimer=null;this.$regbase=this.$regbase|apf.__DATABINDING__;this.$mainBind="value";this.$bindings=this.$cbindings=this.$attrBindings=false;this.$attrExcludePropBind=apf.extend({model:1,taverse:1,valuerule:1},this.$attrExcludePropBind);this.setQueryValue=function(i,m,j){var l=apf.createNodeFromXpath(this[j||"xmlRoot"],i);if(!l){return null;}apf.setNodeValue(l,m,true);return l;};this.queryValue=function(i,j){return apf.queryValue(this[j||"xmlRoot"],i);};this.queryValues=function(i,j){return apf.queryValues(this[j||"xmlRoot"],i);};this.queryNode=function(i,j){var l=this[j||"xmlRoot"];return l?l.selectSingleNode(i):null;};this.queryNodes=function(i,j){var l=this[j||"xmlRoot"];return l?l.selectNodes(i):[];};this.$checkLoadQueue=function(){if(this.$loadqueue){this.xmlRoot=null;var i=this.load(this.$loadqueue[0],{cacheId:this.$loadqueue[1]});if(!i||i.dataType!=apf.ARRAY||i!=this.$loadqueue){this.$loadqueue=null;}}};this.$execProperty=function(o,l){var j=this.$attrBindings[o];apf.$lm_has_lang=false;try{if(j.cvalue.asyncs){var i=this;return j.cvalue.call(this,l,function(q){i.setProperty(o,q,true);if(apf.$lm_has_lang){apf.language.addProperty(this,o,j.cvalue);}});}else{var m=j.cvalue.call(this,l);}}catch(n){apf.console.warn("[400] Could not execute binding for property "+o+"\n\n"+n.message);return;}this.setProperty(o,m,true);if(apf.$lm_has_lang){apf.language.addProperty(this,o,j.cvalue);}};this.$applyBindRule=function(j,l,i,n){var m=this.$attrBindings[j]&&this.$attrBindings[j].cvalue||this.$cbindings[j];return m?m.call(this,l,n):i||"";};this.$hasBindRule=function(i){return this.$attrBindings[i]||this.$bindings&&this.$bindings[i];};this.$getBindRule=function(i,j){return this.$attrBindings[i]||this.$bindings&&this.$bindings.getRule(i,j);};var c={drag:1,drop:1,dragcopy:1};this.$getDataNode=function(l,m,s,j,i){var o,q=this.$attrBindings[l];if(q){if(q.cvalue.type!=3){return false;}var n=q.cvalue2||q.compile("value",{xpathmode:i?4:3,parsecode:1,injectself:c[l]});if(n&&(o=n(m,s))){if(j){j.push(q);}return o;}return false;}return this.$bindings&&this.$bindings.getDataNode(l,m,s,j,i);};this.setModel=function(i){this.setAttribute("model",i,false,true);};this.getModel=function(i){if(i&&!this.$model){return this.dataParent?this.dataParent.parent.getModel(true):null;}return this.$model;};this.reload=function(){this.load(this.xmlRoot,{cacheId:this.cacheId,force:true});};this.load=function(j,i){if(i){var n=i.cacheId,m=i.force,o=i.noClearMsg;}if(n&&n==this.cacheId&&!m){return;}if(apf.popup.isShowing(this.$uniqueId)){apf.popup.forceHide();}if(j){if(typeof j=="string"){if(j.charAt(0)=="<"){j=apf.getXmlDom(j).documentElement;}else{return apf.model.prototype.$loadFrom.call(this,j,i);}}else{if(j.nodeType==9){j=j.documentElement;}else{if(j.nodeType==3||j.nodeType==4){j=j.parentNode;}else{if(j.nodeType==2){j=j.ownerElement||j.parentNode||j.selectSingleNode("..");}}}}}if(this.$preventDataLoad||!this.$canLoadData&&((!this.$bindings&&!this.$canLoadDataAttr)||!this.$amlLoaded)&&(!this.hasFeature(apf.__MULTISELECT__)||!(this.each||this.$template))||this.$canLoadData&&!this.$canLoadData()){this.xmlRoot=j;return this.$loadqueue=[j,n];}if(this.dataParent&&this.dataParent.xpath){this.dataParent.parent.signalXmlUpdate[this.$uniqueId]=!j;}if(!j&&(!n||!this.$isCached||!this.$isCached(n))){this.clear(o);if(apf.config.autoDisable&&this.$createModel===false){this.setProperty("disabled",true);}return;}var l=this.disabled;this.disabled=false;if(this.dispatchEvent("beforeload",{xmlNode:j})===false){return false;}if(this.caching&&!m&&j&&j==this.xmlRoot){return;}this.clear(true,true);this.cacheId=n;if(this.dispatchEvent("$load",{forceNoCache:m,xmlNode:j})===false){delete this.cacheId;return;}this.documentId=apf.xmldb.getXmlDocId(j);this.xmlRoot=j;this.setProperty("root",this.xmlRoot);apf.$lm_has_lang=false;this.$load(j);if(apf.$lm_has_lang){apf.language.addBinding(this);}else{apf.language.removeBinding(this);}this.$loadSubData(j);if(this.$createModel===false){this.disabled=true;this.setProperty("disabled",false);}else{this.disabled=l;}this.dispatchEvent("afterload",{xmlNode:j});};this.$loadSubData=function(i){if(this.$hasLoadStatus(i)){return;}var n,m=this.$getBindRule("load",i);if(m&&(!m[1]||m[1](i))){if(typeof apf.offline!="undefined"&&!apf.offline.onLine){apf.offline.transactions.actionNotAllowed();this.$loadedWhenOffline=true;if(this.$setClearMessage&&!this.getTraverseNodes().length){this.$setClearMessage(this["offline-message"],"offline");}return;}this.$setLoadStatus(i,"loading");if(this.$setClearMessage){this.$setClearMessage(this["loading-message"],"loading");}var l=this.getModel(true);var j=this;if(l.$insertFrom(m.getAttribute("get"),{xmlNode:n,insertPoint:i,amlNode:this,callback:function(){j.setProperty(j.hasFeature(apf.__MULTISELECT__)?"selected":"root",i);}})===false){this.clear(true);if(apf.config.autoDisable){this.setProperty("disabled",true);}}}};this.clear=function(l,n,j){if(!this.$int){return;}if(this.clearSelection){this.clearSelection(!n);}var m=this.$int.offsetHeight;if(this.dispatchEvent("$clear")!==false){this.$int.innerHTML="";}if(typeof l=="string"){var i=l;l=false;if(!this[i+"-message"]){this.$setInheritedAttribute(i+"-message");}}this.$lastClearType=i||null;if(!l&&this.$setClearMessage){this.$setClearMessage(i?this[i+"-message"]:this["empty-message"],i||"empty",m);}else{if(this.$removeClearMessage){this.$removeClearMessage();}}if(!j){this.documentId=this.xmlRoot=this.cacheId=null;}if(!l){if(this.hasFeature(apf.__MULTISELECT__)){this.setProperty("length",0);}}};this.clearMessage=function(i){this.customMsg=i;this.clear("custom");};this.$setLoadStatus=function(j,m,i){var l=j.getAttribute("a_loaded");l=l?l.replace(new RegExp("\\|\\w+\\:"+this.$uniqueId+"\\|","g"),""):"";if(!i){l+="|"+m+":"+this.$uniqueId+"|";}j.setAttribute("a_loaded",l);};this.$removeLoadStatus=function(i){this.$setLoadStatus(i,null,true);};this.$hasLoadStatus=function(i,l){var j=i.getAttribute("a_loaded");if(!j){return false;}return(j.indexOf((l||"")+":"+this.$uniqueId+"|")!=-1);};this.insert=function(l,i){if(typeof l=="string"){if(l.charAt(0)=="<"){l=apf.getXmlDom(l).documentElement;}else{if(!i.insertPoint){i.insertPoint=this.xmlRoot;}return apf.model.prototype.$insertFrom.call(this,l,i);}}var m=i.insertPoint||this.xmlRoot;if(this.dispatchEvent("beforeinsert",{xmlParentNode:m})===false){return false;}if(typeof i.copyAttributes=="undefined"){i.copyAttributes=true;}var j=apf.mergeXml(l,m,i);apf.xmldb.applyChanges("insert",m);if(this.selectable&&this.autoselect){if(this.xmlNode==j){this.$selectDefault(this.xmlNode);}}else{if(this.xmlNode==j){this.setProperty("root",this.xmlNode);}}if(this.$hasLoadStatus(m,"loading")){this.$setLoadStatus(m,"loaded");}this.dispatchEvent("afterinsert");};this.$booleanProperties["render-root"]=true;this.$supportedProperties.push("empty-message","loading-message","offline-message","render-root","smartbinding","bindings","actions");this.$propHandlers["render-root"]=function(i){this.renderRoot=i;};this.$propHandlers["empty-message"]=function(i){this["empty-message"]=i;if(this.$updateClearMessage){this.$updateClearMessage(this["empty-message"],"empty");}};this.$propHandlers["loading-message"]=function(i){this["loading-message"]=i;if(this.$updateClearMessage){this.$updateClearMessage(this["loading-message"],"loading");}};this.$propHandlers["offline-message"]=function(i){this["offline-message"]=i;if(this.$updateClearMessage){this.$updateClearMessage(this["offline-message"],"offline");}};this.$propHandlers.smartbinding=this.$propHandlers.actions=this.$propHandlers.bindings=function(j,l){var i="$"+l;if(this[i]){this[i].unregister(this);}if(!j){return;}apf.nameserver.get(l,j).register(this);if(l!="actions"){this.$checkLoadQueue();}};var d={caption:1,icon:1,select:1,css:1,sort:1,drop:2,drag:2,dragcopy:2,eachvalue:1};this.$addAttrBind=function(j,n,u){if(n.models){if(this.hasFeature(apf.__MULTISELECT__)){}}var o,s,z,q,A=n.xpaths,t={};for(o=0;o<A.length;o+=2){if(!t[(z=A[o])]){t[z]=1;}else{t[z]++;}}if(!this.$propsUsingMainModel){this.$propsUsingMainModel={};}var w=(this.$attrBindings||(this.$attrBindings={}))[j]={cvalue:n,value:u,compile:apf.BindingRule.prototype.$compile,models:[]};delete this.$propsUsingMainModel[j];for(s,o=0;o<A.length;o+=2){z=A[o];if(t[z]==-1){continue;}s=A[o+1];if(z=="#"||s=="#"){var l=(w.cvalue3||(w.cvalue3=apf.lm.compile(w.value,{xpathmode:5})))(this.xmlRoot);if(typeof l!="string"){q=l.model&&l.model.nodeFunc&&l.model;if(q){s=l.xpath;}else{q=apf.xmldb.findModel(l.model);s=apf.xmlToXpath(l.model,q.data)+(l.xpath?"/"+l.xpath:"");}}else{q=null;}}else{q=null;}if(!q){if(z){q=apf.nameserver.get("model",z)||apf.setReference(z,apf.nameserver.register("model",z,new apf.model()));}else{if(!this.$model&&!this.$initingModel){a.call(this);}q=this.$model;this.$propsUsingMainModel[j]={xpath:s,optimize:t[z]==1};}}if(q&&(!this.hasFeature(apf.__MULTISELECT__)&&d[j]!=2||!d[j])){q.$bindXmlProperty(this,j,s,t[z]==1,u.indexOf("*[")>-1);w.models.push(q);}t[z]=-1;}w.xpath=s;this.$canLoadDataAttr=d[j]==1;this.$checkLoadQueue();};this.$removeAttrBind=function(n){var l=this.$attrBindings[n];if(!l){return;}delete this.$attrBindings[n];var m=l.models;for(var j=0;j<m.length;j++){m[j].$unbindXmlProperty(this,n);}};this.$initingModel;function a(){this.$initingModel=true;this.$setInheritedAttribute("model");}this.addEventListener("DOMNodeInsertedIntoDocument",function(i){if(!this.model&&this.$setClearMessage&&!this.value){this.$setClearMessage(this["empty-message"],"empty");}this.$amlLoaded=true;this.$checkLoadQueue();});this.addEventListener("DOMNodeRemovedFromDocument",function(i){apf.language.removeBinding(this);});this.$propHandlers.model=function(o){if(!o&&!this.$modelParsed){if(this.$model){this.clear();this.$model.unregister(this);this.$model=null;this.lastModelId="";}else{if(this.dataParent){this.dataParent.parent=null;}}return;}this.$initingModel=true;var l;if((l=this.$modelParsed)&&l.type!=2){var n,m=l.props;if(this.dataParent){this.dataParent=null;}for(var q in m){if(typeof m[q]=="function"){continue;}this.dataParent={parent:self[q.split(".")[0]],xpath:null,model:this.$modelParsed.instruction};n=true;break;}if(n){if(this.dataParent&&!this.dataParent.signalXmlUpdate){this.dataParent.signalXmlUpdate={};}}this.$modelParsed=null;}var j;if(typeof o=="object"){if(o.dataType==apf.ARRAY){j=apf.nameserver.get("model",o[0]);j.register(this,o[1]);return;}else{if(o.nodeFunc){j=o;o=this.model=j.name;if(!o){j.setProperty("id",o=this.model="model"+j.$uniqueId);}}else{if(this.dataParent){this.model=this.dataParent.model;j=apf.xmldb.findModel(o);var i=apf.xmlToXpath(o,j.data,true)||".";j.register(this,i);return;}else{}}}}apf.setModel(o,this);};this.$propHandlers.viewport=function(i){if(i!="virtual"){return;}this.implement(apf.VirtualViewport);};};apf.DataBinding.prototype=apf.Presentation?new apf.Presentation():new apf.AmlElement();apf.config.$inheritProperties.model=1;apf.config.$inheritProperties["empty-message"]=1;apf.config.$inheritProperties["loading-message"]=1;apf.config.$inheritProperties["offline-message"]=1;apf.config.$inheritProperties.noloading=1;apf.Init.run("databinding");apf.MultiselectBinding=function(){if(!this.setQueryValue){this.implement(apf.DataBinding);}this.$init(function(){this.$selectTimer={};});};(function(){this.length=0;this.$attrExcludePropBind=apf.extend({caption:2,icon:2,eachvalue:2,select:2,css:2,sort:2,drag:2,drop:2,dragcopy:2,selected:2,each:1,selection:3,"selection-unique":3,"selection-constructor":3},this.$attrExcludePropBind);this.resort=function(j,d,i){if(!this.$sort){this.$sort=new apf.Sort();}this.$sort.set(j,d);if(this.clearAllCache){this.clearAllCache();}if(i){return;}var c=this;(function l(o,t){var q=c.$sort.apply(apf.getArrayFromNodelist(o.selectNodes(c.each)));for(var n=0;n<q.length;n++){if(c.$isTreeArch||c.$withContainer){var s=apf.xmldb.findHtmlNode(q[n],c);var m=c.$findContainer(s);t.appendChild(s);if(!apf.isChildOf(s,m,true)){t.appendChild(m);}l(q[n],m);}else{t.appendChild(apf.xmldb.findHtmlNode(q[n],c));}}})(this.xmlRoot,this.$int);return j;};this.toggleSortOrder=function(){return this.resort({ascending:!this.$sort.get().ascending}).ascending;};this.getSortSettings=function(){return this.$sort.get();};this.getTraverseNodes=function(d){if(this.$sort){var c=apf.getArrayFromNodelist((d||this.xmlRoot).selectNodes(this.each));return this.$sort.apply(c);}return(d||this.xmlRoot).selectNodes(this.each);};this.getFirstTraverseNode=function(d){if(this.$sort){var c=(d||this.xmlRoot).selectNodes(this.each);return this.$sort.apply(c)[0];}return(d||this.xmlRoot).selectSingleNode(this.each);};this.getLastTraverseNode=function(d){var c=this.getTraverseNodes(d||this.xmlRoot);return c[c.length-1];};this.isTraverseNode=function(j){var c=this.getTraverseNodes(this.getTraverseParent(j)||this.xmlRoot);for(var d=0;d<c.length;d++){if(c[d]==j){return true;}}return false;};this.getNextTraverseSelected=function(l,c,n){if(!l){l=this.selected;}if(!n){n=1;}var j=0;var d=this.getTraverseNodes(this.getTraverseParent(l)||this.xmlRoot);while(d[j]&&d[j]!=l){j++;}var m=(c==null)?d[j+n]||d[j-n]:(c?d[j+n]:d[j-n]);return m||n&&(j<n||(j+1)>Math.floor(d.length/n)*n)?m:(c?d[d.length-1]:d[0]);};this.getNextTraverse=function(l,c,m){if(!m){m=1;}if(!l){l=this.selected;}var j=0;var d=this.getTraverseNodes(this.getTraverseParent(l)||this.xmlRoot);while(d[j]&&d[j]!=l){j++;}return d[j+(c?-1*m:m)];};this.getTraverseParent=function(d){if(!d.parentNode||d==this.xmlRoot){return false;}var c,i=d.getAttribute(apf.xmldb.xmlIdTag);if(!i){d.setAttribute(apf.xmldb.xmlIdTag,"temp");i="temp";}c=d.selectSingleNode("ancestor::node()[(("+this.each+")/@"+apf.xmldb.xmlIdTag+")='"+i+"']");if(i=="temp"){d.removeAttribute(apf.xmldb.xmlIdTag);}return c;};if(!this.$findHtmlNode){this.$findHtmlNode=function(c){return this.$pHtmlDoc.getElementById(c);};}this.$setClearMessage=function(l,d,j){if(!this.$empty){if(!this.$hasLayoutNode("empty")){return;}this.$getNewContext("empty");var c=this.$getLayoutNode("empty");if(!c){return;}this.$empty=apf.insertHtmlNode(c,this.$int);}else{this.$int.appendChild(this.$empty);}var i=this.$getLayoutNode("empty","caption",this.$empty);if(i){apf.setNodeValue(i,l||"");}this.$empty.setAttribute("id","empty"+this.$uniqueId);apf.setStyleClass(this.$empty,d,["loading","empty","offline"]);this.$empty.style.height=(j&&!apf.getStyle(this.$ext,"height")&&d!="empty")?(Math.max(10,(j-apf.getHeightDiff(this.$empty)-apf.getHeightDiff(this.$ext)))+"px"):"";};this.$updateClearMessage=function(i,c){if(!this.$empty||this.$empty.parentNode!=this.$int||this.$empty.className.indexOf(c)==-1){return;}var d=this.$getLayoutNode("empty","caption",this.$empty);if(d){apf.setNodeValue(d,i||"");}};this.$removeClearMessage=function(){if(!this.$empty){this.$empty=document.getElementById("empty"+this.$uniqueId);}if(this.$empty&&this.$empty.parentNode){this.$empty.parentNode.removeChild(this.$empty);}};this.$load=function(q){apf.xmldb.addNodeListener(q,this);var j=this.getTraverseNodes(q).length;if(!this.renderRoot&&!j){return this.clear(null,null,true);}var c=this.$addNodes(q,null,null,this.renderRoot);this.$fill(c);if(this.selectable){var d,o=(typeof apf.offline!="undefined");if(!this.firstLoad&&o&&apf.offline.state.enabled&&apf.offline.state.realtime){d=apf.offline.state.get(this,"selection");this.firstLoad=true;}if(d){var l=apf.offline.state.get(this,"selstate");if(d.length==0){this.clearSelection();}else{for(var n=0;n<d.length;n++){d[n]=apf.xpathToXml(d[n],this.xmlRoot);}if(l[1]){var m=apf.remote.xpathToXml(l[1],this.xmlRoot);}this.selectList(d,null,m);}if(l[0]){this.setCaret(apf.remote.xpathToXml(l[0],this.xmlRoot));}}else{if(this.autoselect){if(!this.selected){if(this.renderRoot){this.select(q,null,null,null,true);}else{if(c.length){this.$selectDefault(q);}}}}else{this.clearSelection(true);var s=this.renderRoot?this.xmlRoot:this.getFirstTraverseNode();if(s){this.setCaret(s);}if(this.selected){this.setProperty("selected",null);}if(this.choosen){this.setProperty("choosen",null);}}}}if(this.focussable){apf.document.activeElement==this?this.$focus():this.$blur();}if(j!=this.length){this.setProperty("length",j);}};var a={insert:127,add:123,remove:46,"redo-remove":79,synchronize:127,"move-away":105,move:77};this.$xmlUpdate=function(E,j,s,A,D){if(!this.xmlRoot){return;}var w,m,c,t,I=j;if(!s){s=this.xmlRoot;}if(E=="redo-remove"){D.appendChild(j);var G=this.isTraverseNode(j);D.removeChild(j);if(!G){j=D;}}do{if(E=="add"&&this.isTraverseNode(j)&&I==j){break;}if(j.getAttribute(apf.xmldb.xmlIdTag)){t=this.$findHtmlNode(j.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);if(t&&(I!=j||j==this.xmlRoot)&&a[E]&1){E="update";}if(j==s){if(j==this.xmlRoot&&E!="insert"){this.dispatchEvent("xmlupdate",{action:E,xmlNode:j,UndoObj:A});return;}break;}if(t&&a[E]&2&&!this.isTraverseNode(j)){E="remove";}if(!t&&a[E]&4&&this.isTraverseNode(j)){E="add";break;}if(t||E=="move"){break;}}else{if(a[E]&8&&this.isTraverseNode(j)){E="add";break;}}if(j==s){break;}j=j.parentNode;}while(j&&j.nodeType!=9);apf.$lm_has_lang=false;if(this.hasFeature(apf.__VIRTUALVIEWPORT__)){if(!this.$isInViewport(j)){return;}}var i=j;if(j&&j.nodeType==9){j=I;}if(E=="replacechild"&&(A?A.args[0]==this.xmlRoot:!this.xmlRoot.parentNode)){return this.load(A?A.args[1]:s);}if(A&&j&&!A.xmlNode){A.xmlNode=j;}if(E=="move"&&i==I){var z=apf.isChildOf(this.xmlRoot,j.parentNode,true);var q=apf.isChildOf(this.xmlRoot,A.extra.parent,true);if(z&&q){this.$moveNode(j,t);}else{if(z){E="add";}else{if(q){E="remove";}}}}else{if(E=="move-away"){var B=apf.isChildOf(this.xmlRoot,A.extra.parent,true);if(!B){E="remove";}}}if(this.$removeClearMessage&&this.$setClearMessage){if(this.getFirstTraverseNode()){this.$removeClearMessage();}else{this.$setClearMessage(this["empty-message"],"empty");}}if(E=="insert"&&(this.$isTreeArch||j==this.xmlRoot)){if(!j){return;}if(this.$hasLoadStatus(j)&&this.$removeLoading){this.$removeLoading(t);}if(this.$int.firstChild&&!apf.xmldb.getNode(this.$int.firstChild)){this.$int.innerHTML="";if(!this.renderRoot){m=this.getTraverseNodes().length;if(!m){this.clear();}}}w=this.$addNodes(j,(this.$getParentNode?this.$getParentNode(t):t),true,false);this.$fill(w);if(this.selectable&&(m===0||!this.xmlRoot.selectSingleNode(this.each))){return;}}else{if(E=="add"){var F;c=this.getTraverseParent(j);if(c==this.xmlRoot){F=this.$int;}if(!F&&this.$isTreeArch){F=this.$findHtmlNode(c.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}if(!F&&this.getCacheItem){F=this.getCacheItem(c.getAttribute(apf.xmldb.xmlIdTag)||(c.getAttribute(apf.xmldb.xmlDocTag)?"doc"+c.getAttribute(apf.xmldb.xmlDocTag):false));}if(F||this.$isTreeArch&&apf.isChildOf(this.xmlRoot,j)){F=(this.$findContainer&&F?this.$findContainer(F):F)||this.$int;w=this.$addNodes(j,F,true,true,apf.xmldb.getHtmlNode(this.getNextTraverse(j),this));if(F){this.$fill(w);}}}else{if(E=="remove"){if(!j||I!=j){return;}if(t){this.$deInitNode(j,t);}else{if(j==this.xmlRoot){return this.load({noClearMsg:!this.dataParent||!this.dataParent.autoselect});}}}else{if(t){this.$updateNode(j,t);if(E=="replacechild"&&this.hasFeature(apf.__MULTISELECT__)&&this.selected&&j.getAttribute(apf.xmldb.xmlIdTag)==this.selected.getAttribute(apf.xmldb.xmlIdTag)){this.selected=j;}}else{if(E=="redo-remove"){var d=this.xmlRoot;while(d&&d.nodeType!=9){d=d.parentNode;}if(!d){var l=this.getModel(true);return l.$waitForXml(this);}}}}}}if(apf.$lm_has_lang){apf.language.addBinding(this);}c=j?j.parentNode:D;if(this.$isTreeArch&&c&&c.nodeType==1){do{t=this.$findHtmlNode(c.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);if(t){this.$updateNode(c,t);}}while((c=this.getTraverseParent(c))&&c.nodeType==1);}if(a[E]&32&&this.selectable&&I==j&&(E!="insert"||j==this.xmlRoot)){clearTimeout(this.$selectTimer.timer);if(E=="remove"&&apf.isChildOf(j,this.selected,true)||j==this.$selectTimer.nextNode){this.$selectTimer.nextNode=this.getDefaultNext(j,this.$isTreeArch);}var n=this;this.$selectTimer.timer=$setTimeout(function(){n.$checkSelection(n.$selectTimer.nextNode);n.$selectTimer.nextNode=null;});}if(a[E]&64){if(!m){m=this.xmlRoot.selectNodes(this.each).length;}if(m!=this.length){this.setProperty("length",m);}}if(this.signalXmlUpdate&&a[E]&16){var u;for(u in this.signalXmlUpdate){if(parseInt(u)!=u){continue;}var C=apf.lookup(u);if(!this.selected){continue;}j=this.selected.selectSingleNode(C.dataParent.xpath);if(!j){continue;}C.load(j);}}this.dispatchEvent("xmlupdate",{action:E,xmlNode:j,result:w,UndoObj:A});};this.$addNodes=function(w,u,l,j,o){var t,c;j=(j&&(this.renderRoot&&w==this.xmlRoot||this.isTraverseNode(w)));var d=j?[w]:this.getTraverseNodes(w);for(var m=0;m<d.length;m++){if(d[m].nodeType!=1){continue;}if(l){t=this.$findHtmlNode(d[m].getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}if(!t){var q=apf.xmldb.nodeConnect(this.documentId,d[m],null,this);var s=j?o:(c?c.nextSibling:null),n=this.$add(d[m],q,j?w.parentNode:w,s?u||this.$int:u,s,(!s&&m==d.length-1));if(n===false){break;}}if(l){c=t;}}return d;};this.$handleBindingRule=function(d,i){if(!d){this[i]=null;}if(i=="each"){if(d.indexOf("::")>-1){d=d.replace(/^\[|\]$/g,"").split("::");this.setProperty("model",d[0]);this.each=d[1];}else{this.each=d.replace(/^\[|\]$/g,"");}}if(false&&this.xmlRoot&&!this.$bindRuleTimer&&this.$amlLoaded){var c=this;apf.queue.add("reload"+this.$uniqueId,function(){c.reload();});}};this.$select=function(c){if(this.renaming){this.stopRename(null,true);}if(!c||!c.style){return;}return this.$setStyleClass(c,"selected");};this.$deselect=function(c){if(this.renaming){this.stopRename(null,true);if(this.ctrlselect){return false;}}if(!c){return;}return this.$setStyleClass(c,"",["selected","indicate"]);};this.$indicate=function(c){if(this.renaming){this.stopRename(null,true);}if(!c){return;}return this.$setStyleClass(c,"indicate");};this.$deindicate=function(c){if(this.renaming){this.stopRename(null,true);}if(!c){return;}return this.$setStyleClass(c,"",["indicate"]);};this.$propHandlers.each=this.$propHandlers.caption=this.$propHandlers.eachvalue=this.$propHandlers.icon=this.$propHandlers.tooltip=this.$handleBindingRule;this.$propHandlers.sort=function(c){if(c){this.$sort=new apf.Sort();this.$sort.set({getValue:apf.lm.compile(c)});}else{this.$sort=null;}};}).call(apf.MultiselectBinding.prototype=new apf.DataBinding());apf.StandardBinding=function(){this.$init(true);if(apf.Validation){this.implement(apf.Validation);}if(!this.setQueryValue){this.implement(apf.DataBinding);}if(!this.defaultValue){this.defaultValue="";}this.$load=function(c){apf.xmldb.addNodeListener(c,this);var a,j,l,i,m,d;if(a=this.$bindings){for(l in a){j=l.toLowerCase();if(this.$supportedProperties.indexOf(j)>-1){m=(i=a[j]).length==1?i[0]:this.$getBindRule(j,c);d=m.value||m.match;this.$clearDynamicProperty(j);if(d.indexOf("{")>-1||d.indexOf("[")>-1){this.$setDynamicProperty(j,d);}else{if(this.setProperty){this.setProperty(j,d,true);}}}}}if(this.errBox&&this.isValid&&this.isValid()){this.clearError();}};this.$xmlUpdate=function(i,u,a,n){if(i=="redo-remove"){var c=false,j=this.getModel(true);if(j){var m=j.getXpathByAmlNode(this);if(m){u=j.data.selectSingleNode(m);if(u!=this.xmlRoot){c=true;}}}if(c||this.xmlRoot==u){return j.$waitForXml(this);}}if(n&&!n.xmlNode){n.xmlNode=this.xmlRoot;}var q,d,o,s,l,t;if(q=this.$bindings){for(o in q){d=o.toLowerCase();if(this.$supportedProperties.indexOf(d)>-1){l=(s=q[d]).length==1?s[0]:this.$getBindRule(d,u);t=l.value||l.match;this.$clearDynamicProperty(d);if(t.indexOf("{")>-1||t.indexOf("[")>-1){this.$setDynamicProperty(d,t);}else{if(this.setProperty){this.setProperty(d,t);}}}}}if(this.errBox&&this.isValid&&this.isValid()){this.clearError();}this.dispatchEvent("xmlupdate",{action:i,xmlNode:u,UndoObj:n});};this.addEventListener("$clear",function(c,a){if(this.$propHandlers&&this.$propHandlers.value){this.value=-99999;this.$propHandlers.value.call(this,"");}});};apf.StandardBinding.prototype=new apf.DataBinding();apf.Init.run("standardbinding");apf.__MULTISELECT__=1<<8;apf.MultiSelect=function(){this.$init(function(){this.$valueList=[];this.$selectedList=[];});};(function(){this.$regbase=this.$regbase|apf.__MULTISELECT__;this.sellength=0;this.selected=null;this.$selected=null;this.caret=null;this.$caret=null;this.useindicator=true;this.remove=function(d){if(!d){d=this.$valueList;}if(d.nodeType){d=[d];}if(!d||!d.length){return;}var l=[];for(var j=0;j<d.length;j++){l.push({func:"removeNode",args:[d[j]]});}if(this.$actions.removegroup){return this.$executeAction("multicall",l,"removegroup",d[0]);}else{return this.$executeAction("multicall",l,"remove",d[0],null,null,d.length>1?d:null);}};this.add=function(u,w,t,d){var s;if(this.$actions){if(u&&u.nodeType){s=this.$actions.getRule("add",u);}else{if(typeof u=="string"){if(u.trim().charAt(0)=="<"){u=apf.getXml(u);s=this.$actions.getRule("add",u);}else{var A=this.$actions.add;for(var n=0,m=A.length;n<m;n++){if(A[n][2].getAttribute("type")==u){u=null;s=A[n];break;}}}}}if(!s){s=(this.$actions.add||{})[0];}}else{s=null;}var q=(typeof apf.offline!="undefined");if(q&&!apf.offline.canTransact()){return false;}if(q&&!apf.offline.onLine&&(!u||!s.get)){return false;}var o=this.$isTreeArch?this.selected||this.xmlRoot:this.xmlRoot,j=this,z=function(B,C,i){if(C!=apf.SUCCESS){var D;D=new Error(apf.formatErrorString(1032,j,"Loading xml data","Could not add data for control "+j.name+"["+j.tagName+"] \nUrl: "+i.url+"\nInfo: "+i.message+"\n\n"+u));if(i.tpModule.retryTimeout(i,C,j,D)===true){return true;}throw D;}if(typeof B!="object"){B=apf.getXmlDom(B).documentElement;}if(B.getAttribute(apf.xmldb.xmlIdTag)){B.setAttribute(apf.xmldb.xmlIdTag,"");}var l=j.$actions&&j.$actions.getRule("add",j.$isTreeArch?j.selected:j.xmlRoot);if(!w){if(l&&l.parent){w=(l.cparent||l.compile("parent",{xpathmode:2,injectself:true}))(j.$isTreeArch?j.selected||j.xmlRoot:j.xmlRoot);}else{w=j.$isTreeArch?j.selected||j.xmlRoot:j.xmlRoot;}}if(!w){w=j.xmlRoot;}if(apf.isWebkit&&w.ownerDocument!=B.ownerDocument){B=w.ownerDocument.importNode(B,true);}if(j.$executeAction("appendChild",[w,B,t],"add",B)!==false&&j.autoselect){j.select(B);}if(d){d.call(j,B);}return B;};if(u){return z(u,apf.SUCCESS);}else{if(s.get){return apf.getData(s.get,{xmlNode:o,callback:z});}else{}}return addXmlNode;};if(!this.setValue){this.setValue=function(i,d){noEvent=d;this.setProperty("value",i,false,true);noEvent=false;};}this.findXmlNodeByValue=function(m){var j=this.getTraverseNodes(),d=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";if(!d){return false;}for(var l=0;l<j.length;l++){if(this.$applyBindRule(d,j[l])==m){return j[l];}}};if(!this.getValue){this.getValue=function(i,d){return this.value;};}this.reselect=function(){if(this.selected){this.select(this.selected,null,this.ctrlselect,null,true);}};this.select=function(z,i,u,m,j,o){if(!this.selectable||this.disabled){return;}if(this.$skipSelect){this.$skipSelect=false;return;}if(this.ctrlselect&&!u){i=true;}if(!this.multiselect){i=u=false;}if(!this.xmlRoot){if(!this.$buffered){var q;this.addEventListener("afterload",q=function(){this.select.apply(this,this.$buffered);this.removeEventListener("afterload",q);delete this.$buffered;});}this.$buffered=Array.prototype.slice.call(arguments);return;}var w;if(!z){return false;}if(typeof z!="object"){var t=z;z=null;if(typeof z=="string"){z=apf.xmldb.getNodeById(t);}if(!z){z=this.findXmlNodeByValue(t);if(!z){this.clearSelection(o);return;}}}if(!z.style){w=this.$findHtmlNode(z.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}else{var d=(w=z).getAttribute(apf.xmldb.htmlIdTag);while(!d&&w.parentNode){d=(w=w.parentNode).getAttribute(apf.xmldb.htmlIdTag);}z=apf.xmldb.getNodeById(d);}if(this.dispatchEvent("beforeselect",{selected:z,htmlNode:w,ctrlKey:i,shiftKey:u,force:j,captureOnly:o})===false){return false;}var l=this.caret;this.caret=z;if(u){var n=this.$calcSelectRange(this.$valueList[0]||l,z);if(this.$caret){this.$deindicate(this.$caret);}this.selectList(n);this.$selected=this.$caret=this.$indicate(w);}else{if(i){if(this.$valueList.contains(z)){if(this.selected==z){this.$deselect(this.$findHtmlNode(this.selected.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId));this.$deindicate(this.$caret);if(this.$valueList.length&&!m){this.selected=this.$valueList[0];}}else{this.$deselect(w,z);}if(!m){this.$selectedList.remove(w);this.$valueList.remove(z);}if(w!=this.$caret){this.$deindicate(this.$caret);}this.$selected=this.$caret=this.$indicate(w);}else{if(this.$caret){this.$deindicate(this.$caret);}this.$caret=this.$indicate(w,z);this.$selected=this.$select(w,z);this.selected=z;if(!m){this.$selectedList.push(w);this.$valueList.push(z);}}}else{if(m&&w&&this.$selectedList.contains(w)){return;}else{if(!j&&!this.reselectable&&this.$valueList.length<=1&&this.$valueList.indexOf(z)>-1){return;}if(this.$selected){this.$deselect(this.$selected);}if(this.$caret){this.$deindicate(this.$caret);}if(this.selected){this.clearSelection(true);}this.$caret=this.$indicate(w,z);this.$selected=this.$select(w,z);this.selected=z;this.$selectedList.push(w);this.$valueList.push(z);}}}if(this.delayedselect&&(typeof i=="boolean")){var s=this;$setTimeout(function(){s.dispatchEvent("afterselect",{selection:s.$valueList,selected:z,caret:s.caret,captureOnly:o});},10);}else{this.dispatchEvent("afterselect",{selection:this.$valueList,selected:z,caret:this.caret,captureOnly:o});}return true;};this.choose=function(d){if(!this.selectable||this.disabled){return;}if(this.dispatchEvent("beforechoose",{xmlNode:d})===false){return false;}if(d&&!d.style){this.select(d);}if(this.hasFeature(apf.__DATABINDING__)&&this.dispatchEvent("afterchoose",{xmlNode:this.selected})!==false){this.setProperty("chosen",this.selected);}};this.clearSelection=function(j){if(!this.selectable||this.disabled||!this.$valueList.length){return;}if(!j){if(this.dispatchEvent("beforeselect",{selection:[],selected:null,caret:this.caret})===false){return false;}}var l;for(var d=this.$valueList.length-1;d>=0;d--){l=this.$findHtmlNode(this.$valueList[d].getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);this.$deselect(l);}this.$selectedList.length=0;this.$valueList.length=0;this.$selected=this.selected=null;if(this.caret){l=this.$findHtmlNode(this.caret.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);this.$caret=this.$indicate(l);}if(!j){this.dispatchEvent("afterselect",{selection:this.$valueList,selected:null,caret:this.caret});}};this.selectList=function(d,m,n){if(!this.selectable||this.disabled){return;}if(this.dispatchEvent("beforeselect",{selection:d,selected:n||d[0],caret:this.caret,captureOnly:m})===false){return false;}this.clearSelection(true);for(var q,l=0;l<d.length;l++){if(!d[l]||d[l].nodeType!=1){continue;}var o,j=d[l];if(typeof j!="object"){j=apf.xmldb.getNodeById(j);}if(!j.style){o=this.$pHtmlDoc.getElementById(j.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}else{o=j;j=apf.xmldb.getNodeById(o.getAttribute(apf.xmldb.htmlIdTag));}if(!j){continue;}if(o){if(!q&&n==o){q=o;}this.$select(o,j);this.$selectedList.push(o);}this.$valueList.push(j);}this.$selected=q||this.$selectedList[0];this.selected=n||this.$valueList[0];this.dispatchEvent("afterselect",{selection:this.$valueList,selected:this.selected,caret:this.caret,captureOnly:m});};this.setCaret=function(d){if(!d){if(this.$caret){this.$deindicate(this.$caret);}this.caret=this.$caret=null;return;}var i;if(typeof d!="object"){d=apf.xmldb.getNodeById(d);}if(!d.style){i=this.$findHtmlNode(d.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}else{var j=(i=d).getAttribute(apf.xmldb.htmlIdTag);while(!j&&i.parentNode){j=(i=i.parentNode).getAttribute(apf.xmldb.htmlIdTag);}d=apf.xmldb.getNodeById(j);}if(this.$caret){this.$deindicate(this.$caret);}this.$caret=this.$indicate(i);this.setProperty("caret",this.caret=d);};this.$setTempSelected=function(j,l,i,n){clearTimeout(this.timer);if(this.$bindings.selectable){while(j&&!this.$getDataNode("selectable",j)){j=this.getNextTraverseSelected(j,!n);}if(!j){return;}}if(!this.multiselect){l=i=false;}if(l||this.ctrlselect){if(this.$tempsel){this.select(this.$tempsel);this.$tempsel=null;}this.setCaret(j);}else{if(i){if(this.$tempsel){this.$selectTemp();this.$deselect(this.$tempsel);this.$tempsel=null;}this.select(j,null,i);}else{if(!this.bufferselect||this.$valueList.length>1){this.select(j);}else{var m=apf.xmldb.getID(j,this);this.$deselect(this.$tempsel||this.$selected);this.$deindicate(this.$tempsel||this.$caret);this.$tempsel=this.$indicate(document.getElementById(m));this.$select(this.$tempsel);var d=this;this.timer=$setTimeout(function(){d.$selectTemp();},400);}}}};this.$selectTemp=function(){if(!this.$tempsel){return;}clearTimeout(this.timer);this.select(this.$tempsel);this.$tempsel=null;this.timer=null;};this.selectAll=function(){if(!this.multiselect||!this.selectable||this.disabled||!this.xmlRoot){return;}var d=this.$isTreeArch?this.xmlRoot.selectNodes(".//"+this.each.split("|").join("|.//")):this.xmlRoot.selectNodes(this.each);this.selectList(d);};this.getSelection=function(d){var j,l;if(d){l=this.xmlRoot?this.xmlRoot.ownerDocument.createDocumentFragment():apf.getXmlDom().createDocumentFragment();for(j=0;j<this.$valueList.length;j++){apf.xmldb.cleanNode(l.appendChild(this.$valueList[j].cloneNode(true)));}}else{for(l=[],j=0;j<this.$valueList.length;j++){l.push(this.$valueList[j]);}}return l;};this.$getSelection=function(d){return d?this.$selectedList:this.$valueList;};this.defaultSelectNext=function(i,d){var j=this.getNextTraverseSelected(i);if(j||!d){this.select(j?j:this.getTraverseParent(i));}else{this.clearSelection(true);}};this.selectNext=function(){var d=this.getNextTraverse();if(d){this.select(d);}};this.selectPrevious=function(){var d=this.getNextTraverse(null,-1);if(d){this.select(d);}};this.getDefaultNext=function(i,d){var j=this.getNextTraverseSelected(i);return(j&&j!=i)?j:(d?this.getTraverseParent(i):null);};this.isSelected=function(j){if(!j){return false;}for(var d=0;d<this.$valueList.length;d++){if(this.$valueList[d]==j){return this.$valueList.length;}}return false;};this.$checkSelection=function(j){if(this.$valueList.length>1){for(var d=[],n=0,m=this.$valueList.length;n<m;n++){if(apf.isChildOf(this.xmlRoot,this.$valueList[n])){d.push(this.$valueList[n]);}}if(d.length>1){this.selectList(d);if(this.caret&&!apf.isChildOf(this.xmlRoot,this.caret)){this.setCaret(j||this.selected);}return;}else{if(d.length){j=d[0];}}}if(!j){if(this.selected&&!apf.isChildOf(this.xmlRoot,this.selected)){j=this.getFirstTraverseNode();}else{if(this.selected&&this.caret&&!apf.isChildOf(this.xmlRoot,this.caret)){this.setCaret(this.selected);}else{if(!this.selected){j=this.xmlRoot?this.getFirstTraverseNode():null;}else{return;}}}}if(j){if(this.autoselect){this.select(j);}else{if(!this.multiselect){this.clearSelection();}this.setCaret(j);}}else{this.clearSelection();}};this.selectable=true;if(typeof this.ctrlselect=="undefined"){this.ctrlselect=false;}if(typeof this.multiselect=="undefined"){this.multiselect=true;}if(typeof this.autoselect=="undefined"){this.autoselect=true;}if(typeof this.delayedselect=="undefined"){this.delayedselect=true;}if(typeof this.allowdeselect=="undefined"){this.allowdeselect=true;}this.reselectable=false;this.$booleanProperties.selectable=true;this.$booleanProperties.multiselect=true;this.$booleanProperties.autoselect=true;this.$booleanProperties.delayedselect=true;this.$booleanProperties.allowdeselect=true;this.$booleanProperties.reselectable=true;this.$supportedProperties.push("selectable","ctrlselect","multiselect","autoselect","delayedselect","allowdeselect","reselectable","selection","selected","default","value","caret");this.$propHandlers.value=function(d){if(this.$lastValue==d){delete this.$lastValue;return;}if(d||d===0||this["default"]){this.select(String(d)||this["default"]);}};this.$propHandlers.caret=function(d,i){if(d){this.setCaret(d);}};this.$propHandlers.selection=this.$propHandlers.selected=function(E,l){if(!E){E=this[l]=null;}if(l=="selected"&&typeof E!="string"&&E==this.selected){this.selected=null;return;}if(this.$isSelecting){this.selection=this.$valueList;return false;}var m,z,s,u,q,C,B;if(l=="selection"){if(typeof E=="object"&&E==this.$valueList){var F;if((C=this.$attrBindings[l])&&C.cvalue.models){this.$isSelecting=true;z=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";if(!z){throw new Error("Missing bind rule set: eachvalue, value or caption");}var n=this.$getDataNode(l,this.xmlRoot);m=E;s=(B=this.$attrBindings["selection-unique"])&&B.cvalue;if(n.length){F=n[0].parentNode;}else{var w=apf.nameserver.get("model",C.cvalue.xpaths[0]),G=C.cvalue.xpaths[1];if(!w.data){this.$isSelecting=false;return false;}F=w.queryNode(G.replace(/\/[^\/]+$|^[^\/]*$/,"")||".");if(!F){throw new Error("Missing parent node");}}remove_loop:for(u=0;u<n.length;u++){E=s?s(n[u]):this.$applyBindRule(z,n[u]);for(q=0;q<m.length;q++){if(this.$applyBindRule(z,m[q])==E){continue remove_loop;}}apf.xmldb.removeNode(n[u]);}add_loop:for(u=0;u<m.length;u++){E=this.$applyBindRule(z,m[u]);for(q=0;q<n.length;q++){if(s?s(n[q]):this.$applyBindRule(z,n[q])==E){continue add_loop;}}var o=this.$attrBindings["selection-constructor"]&&this.$getDataNode("selection-constructor",m[u])||apf.getCleanCopy(m[u]);apf.xmldb.appendChild(F,o);}this.$isSelecting=false;}return;}this.selection=this.$valueList;}else{this.selected=null;}if(!this.xmlRoot){if(!this.$buffered){var A;this.addEventListener("afterload",A=function(){this.removeEventListener("afterload",A);this.$propHandlers.selected.call(this,E,l);delete this.$buffered;});this.$buffered=true;}this[l]=null;return false;}if(!E||typeof E!="object"){if(this.$attrBindings[l]){m=this.$getDataNode(l,this.xmlRoot);if(m){this.setProperty("selection",m);}}else{if(!E){this.clearSelection();}else{this.select(E);}}return false;}else{if(typeof E.length=="number"){m=E;if(!m.length){this.selected=null;if(this.$valueList.length){this.clearSelection();return false;}else{return;}}if(this.isTraverseNode(m[0])&&apf.isChildOf(this.xmlRoot,m[0])){if(!this.multiselect){this.select(m[0]);}else{this.selectList(m);}return false;}if(this.$attrBindings[l]){z=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";if(!z){throw new Error("Missing bind rule set: eachvalue, value or caption");}var t=!this.each?this.getTraverseNodes():this.xmlRoot.selectNodes("//"+this.each.split("|").join("|//"));s=(C=this.$attrBindings["selection-unique"])&&C.cvalue;var D=[];for(u=0;u<m.length;u++){E=s?s(m[u]):this.$applyBindRule(z,m[u]);for(q=0;q<t.length;q++){if(this.$applyBindRule(z,t[q])==E){D.push(t[q]);}}}this.selectList(D);return false;}throw new Error("Show me which case this is");}else{if(this.$valueList.indexOf(E)==-1){this.select(E);}}}};this.$propHandlers.allowdeselect=function(i){if(i){var d=this;this.$int.onmousedown=function(l){if(!l){l=event;}if(l.ctrlKey||l.shiftKey){return;}var j=l.srcElement||l.target;if(d.allowdeselect&&(j==this||j.getAttribute(apf.xmldb.htmlIdTag))){d.clearSelection();}};}else{this.$int.onmousedown=null;}};this.$propHandlers.ctrlselect=function(d){if(d!="enter"){this.ctrlselect=apf.isTrue(d);}};function c(){this.selectAll();}this.$propHandlers.autoselect=function(d){if(d=="all"&&this.multiselect){this.addEventListener("afterload",c);}else{this.removeEventListener("afterload",c);}};this.$propHandlers.multiselect=function(d){if(!d&&this.$valueList.length>1){this.select(this.selected);}};this.addEventListener("beforeselect",function(d){if(this.$bindings.selectable&&!this.$getDataNode("selectable",d.selected)){return false;}},true);this.addEventListener("afterselect",function(o){var n=null;this.setProperty("caret",o.caret);if(this.sellength!=o.selection.length){this.setProperty("sellength",o.selection.length);}delete this.selection;this.setProperty("selection",o.selection);if(!o.selection.length){this.setProperty("selected",o.selected);if(this.value){this.setProperty("value","");}}else{this.$chained=true;if(!o.force&&(!this.dataParent||!this.dataParent.parent.$chained)){var d=this;$setTimeout(function(){d.setProperty("selected",n||o.selected);delete d.$chained;},10);}else{this.setProperty("selected",n||o.selected);delete this.$chained;}var j=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";if(j){this.$lastValue=this.$applyBindRule(j,o.selected);if(this.$lastValue!=(j!="value"&&(this.xmlRoot&&this.$applyBindRule("value",this.xmlRoot,null,true))||this.value)){if(j=="eachvalue"||this.xmlRoot!=this){this.change(this.$lastValue);}else{this.setProperty("value",this.$lastValue);}}delete this.$lastValue;}}if(typeof apf.offline!="undefined"&&apf.offline.state.enabled&&apf.offline.state.realtime){for(var m=[],l=0;l<o.selection.length;l++){m.push(apf.xmlToXpath(o.selection[l],null,true));}apf.offline.state.set(this,"selection",m);a.call(this);}},true);function a(){if(typeof apf.offline!="undefined"&&apf.offline.state.enabled&&apf.offline.state.realtime){apf.offline.state.set(this,"selstate",[this.caret?apf.xmlToXpath(this.caret,null,true):"",this.selected?apf.xmlToXpath(this.selected,null,true):""]);}}this.addEventListener("prop.caret",a);}).call(apf.MultiSelect.prototype=new apf.MultiselectBinding());apf.__CONTENTEDITABLE__=1<<23;apf.ContentEditable=function(){this.$regbase=this.$regbase|apf.__CONTENTEDITABLE__;this.implement(apf.DataAction);this.$activeDocument=document;this.$state=apf.ON;this.$selection=null;this.$buttons=["Bold","Italic","Underline"];this.$classToolbar="editor_Toolbar";this.$plugins={};this.$pluginsHooks={};this.$pluginsTypes={};this.$pluginsKeys=[];this.$pluginsActive=null;this.$pluginsOn=["pasteword","tablewizard"];this.$nativeCommands=["bold","italic","underline","strikethrough","justifyleft","justifycenter","justifyright","justifyfull","removeformat","cut","copy","paste","outdent","indent","undo","redo"];this.$supportedProperties.push("contenteditable","state","plugins","realtime","language");this.$booleanProperties.contenteditable=true;this.$booleanProperties.realtime=true;this.$propHandlers.contenteditable=function(s){var t=this.$edVars;if(apf.isTrue(s)){var q=this;apf.addListener(q.$ext,"mouseover",t.mouseOver=function(w){var u=w.srcElement||w.target;if(!u){return;}while(u&&(!u.className||u.className.indexOf("contentEditable")==-1)&&u!=q.$ext){u=u.parentNode;}if(!u||u==q.$ext||u==t.activeNode){return;}apf.setStyleClass(u,"contentEditable_over");});apf.addListener(q.$ext,"mouseout",t.mouseOut=function(w){var u=w.srcElement||w.target;if(!u){return;}while(u&&(!u.className||u.className.indexOf("contentEditable")==-1)&&u!=q.$ext){u=u.parentNode;}if(!u||u==q.$ext||u==t.activeNode){return;}apf.setStyleClass(u,null,["contentEditable_over"]);});apf.addListener(q.$ext,"mousedown",t.mouseDown=function(w){var u=w.srcElement||w.target;if(!u){return;}if(t.activeNode&&q.$selection&&apf.isChildOf(t.activeNode,u,true)){q.$selection.cache();}while(u&&(!u.className||u.className.indexOf("contentEditable")==-1)&&u!=q.$ext){u=u.parentNode;}if(!u||u==q.$ext){if(t.activeNode){l(t.activeNode,true);}return;}o(u);if(!t.lastTemplate){w.cancelBubble=true;apf.window.$mousedown({srcElement:t.activeNode});$setTimeout(function(){q.$selection.set();if(t.activeNode){t.activeNode.focus();}},10);}else{$setTimeout(function(){t.lastTemplate.childNodes[0].focus();},100);t.lastTemplate.childNodes[0].slideDown();}return false;});apf.addListener(q.$ext,"mouseup",t.mouseUp=function(w){var u=w.srcElement||w.target;if(t.activeNode&&q.$selection&&apf.isChildOf(t.activeNode,u,true)){q.$selection.cache();}});t.wasFocussable=[this.$focussable,typeof this.focussable=="undefined"?true:this.focussable];this.$focussable=true;this.setProperty("focussable",true);}else{apf.removeListener(this.$ext,"mouseover",t.mouseOver);apf.removeListener(this.$ext,"mouseout",t.mouseOut);apf.removeListener(this.$ext,"mousedown",t.mouseDown);apf.removeListener(this.$ext,"mouseup",t.mouseUp);if(t.docklet){t.docklet.hide();}t.activeNode=null;t.lastActiveNode=null;this.$focussable=t.wasFocussable[0];this.setProperty("focussable",t.wasFocussable[1]);}t.tabStack=null;this.reload();};this.$propHandlers.state=function(s){this.state=parseInt(s);var q=this;$setTimeout(function(){q.$notifyAllButtons(s);if(q.$pluginsActive=="code"){q.$notifyButton("code",apf.SELECTED);}});};this.$propHandlers.plugins=function(t){this.$pluginsOn=t&&t.splitSafe(t)||null;if(this.$pluginsOn&&this.$pluginsOn.length){for(var s=0,q=this.$pluginsOn.length;s<q;s++){this.$addPlugin(this.$pluginsOn[s]);}}};this.$propHandlers.language=function(q){};this.addEventListener("DOMNodeInsertedIntoDocument",function(q){if(typeof this.realtime=="undefined"){this.$setInheritedAttribute("realtime");}});this.$edVars={lastActiveNode:null,wasFocussable:null,skipFocusOnce:null,lastTemplate:null,lastValue:null,mouseOver:null,mouseOut:null,mouseDown:null,mouseUp:null,docklet:null,objectHandles:false,tableHandles:false,bStandalone:false,lastPos:0,activeNode:null,tabStack:null,changeTimer:null,keyupTimer:null,oButtons:{}};this.addEventListener("focus",function(s){var t=this.$edVars;if(!this.contenteditable||t.skipFocusOnce&&!(t.skipFocusOnce=false)){t.lastActiveNode=null;return;}this.setProperty("state",(this.$pluginsActive=="code")?apf.DISABLED:apf.OFF);if(t.lastActiveNode&&t.lastActiveNode.parentNode||typeof s.shiftKey=="boolean"){o(t.lastActiveNode||(t.tabStack||j())[s.shiftKey?t.tabStack.length-1:0]);if(t.lastActiveNode&&!t.lastTemplate){t.lastActiveNode.focus();}}t.lastActiveNode=null;if(t.lastTemplate){t.lastTemplate.childNodes[0].focus();}else{if(t.activeNode){var q=t.activeNode;$setTimeout(function(){this.$selection.set();if(q.parentNode){q.focus();}},10);}}});this.addEventListener("blur",function(s){if(!this.contenteditable){return;}var t=this.$edVars;t.lastActiveNode=t.activeNode||t.lastActiveNode;if(s.toElement&&(s.toElement==t.docklet||s.toElement.parentNode==t.lastTemplate)){return;}var q=apf.popup.last&&apf.lookup(apf.popup.last);if(q&&q.editor==this){apf.popup.forceHide();}if(this.$selection){this.$selection.cache();}l(t.activeNode,true);this.setProperty("state",apf.DISABLED);});this.addEventListener("load",function(){if(!this.contenteditable){return;}o(j()[0]);});this.addEventListener("xmlupdate",function(){this.$edVars.tabStack=null;});this.addEventListener("keydown",function(A){var u=this.$edVars;if(!this.contenteditable&&!u.bStandalone){return;}A=A||window.event;var F,G,t=A.which||A.keyCode;if(!u.activeNode&&!u.bStandalone){if(t==113){var E;if(this.$selected){var s=this.$selected.getElementsByTagName("*");for(var w=s.length-1;w>=0;w--){if((s[w].className||"").indexOf("contentEditable")>-1){E=s[w];break;}}}o(E||(u.tabStack||j())[0]);if(u.activeNode){u.activeNode.focus();this.$selection.selectNode(u.activeNode);this.$selection.collapse();try{this.$activeDocument.execCommand("SelectAll",false,true);}catch(A){}}}return;}if(apf.isIE){switch(t){case 66:case 98:case 105:case 73:case 117:case 85:if((A.ctrlKey||(apf.isMac&&A.metaKey))&&!A.shiftKey&&!A.altKey&&this.realtime){this.change(this.getValue());}break;case 8:G=false;if(this.$selection.getType()=="Control"){this.$selection.remove();G=true;}i.call(this,A,true);if(G){return false;}break;case 46:i.call(this,A,true);break;case 9:if(i.call(this,A)){return false;}break;}}else{this.$visualFocus();if((A.ctrlKey||(apf.isMac&&A.metaKey))&&!A.shiftKey&&!A.altKey){G=false;switch(t){case 66:case 98:this.$execCommand("Bold");G=true;break;case 105:case 73:this.$execCommand("Italic");G=true;break;case 117:case 85:this.$execCommand("Underline");G=true;break;case 86:case 118:if(!apf.isGecko){onPaste.call(this);}break;case 37:case 39:G=true;}if(G){apf.AbstractEvent.stop(A.htmlEvent||A);if(this.realtime){this.change(this.getValue());}}}}if(!u.bStandalone&&t==13){F=A.ctrlKey||(apf.isMac&&A.metaKey);if(!F){var z=this.getModel(true),D=this.xmlRoot.ownerDocument.selectSingleNode(u.activeNode.getAttribute("xpath")),C=z&&z.$validation&&z.$validation.getRule(D)||{multiline:false};F=!apf.isTrue(C.multiline);}A.returnValue=true;}this.$visualFocus();if(A.metaKey||A.ctrlKey||A.altKey||A.shiftKey){G=this.$notifyKeyBindings({code:t,control:A.ctrlKey,alt:A.altKey,shift:A.shiftKey,meta:A.metaKey});}if(t==9||F){if(u.bStandalone){if(i.call(this,A.htmlEvent||A)){apf.AbstractEvent.stop(A.htmlEvent||A);return false;}}else{var q=A.shiftKey,B=(u.tabStack||j()).indexOf(u.activeNode),E=l(u.activeNode,true)||j()[B];E=u.tabStack[u.tabStack.indexOf(E)+(q?-1:1)];if(E){o(E);if(u.lastTemplate){u.lastTemplate.childNodes[0].focus();}else{if(E.parentNode){E.focus();this.$selection.selectNode(E);this.$selection.collapse();try{this.$activeDocument.execCommand("SelectAll",false,true);}catch(A){}}}G=true;}}}else{if(!u.bStandalone&&t==27){l(u.activeNode);G=true;}else{if(t==8||t==46){i.call(this,A.htmlEvent||A,true);}}}if(!A.ctrlKey&&!A.altKey&&(t<112||t>122)&&(t<33&&t>31||t>42||t==8||t==13)){a();}if(G){if(A.preventDefault){A.preventDefault();}if(A.stopPropagation){A.stopPropagation();}A.returnValue=false;return false;}else{if(u.activeNode){A.returnValue=-1;}}},true);this.addEventListener("keyup",function(t){var q=this,u=this.$edVars;if(!this.contenteditable&&!u.bStandalone){return;}if(this.$selection){this.$selection.cache();}if(u.keyupTimer!=null){return;}t=t||window.event;function s(){clearTimeout(u.keyupTimer);if(q.state==apf.DISABLED){return;}q.$notifyAllButtons();q.dispatchEvent("typing",{editor:q,event:t});q.$notifyAllPlugins("typing",t.code);u.keyupTimer=null;}u.keyupTimer=window.setTimeout(s,200);},true);function o(E){var t=this.$edVars;if(!E||E.nodeType!=1||t.activeNode==E){return;}if(!this.$selection){this.$selection=new apf.selection(window,document);}if(t.activeNode){var B=j().indexOf(E);l(t.activeNode,true);E=j()[B];$setTimeout(function(){E.focus();},10);}var z=this;if(this.validityState&&!this.validityState.valid){E=j()[this.validityState.$lastPos];$setTimeout(function(){E.focus();z.$selection.selectNode(E);z.$selection.collapse();try{z.$activeDocument.execCommand("SelectAll",false,true);}catch(F){}z.getModel(true).validate(C,false,z.validityState,z);},10);}var C=apf.createNodeFromXpath(this.xmlRoot.ownerDocument,E.getAttribute("xpath")),D,A;if(D=this.getModel(true).$validation){A=D.getRule(C);}if(!this.hasFocus()){t.skipFocusOnce=true;}t.activeNode=E;apf.setStyleClass(E,"contentEditable_active",["contentEditable_over"]);if(A&&apf.isTrue(A.richtext)){t.lastValue=[];E.innerHTML=t.lastValue[0]=apf.htmlCleaner.prepare((t.lastValue[1]=E.innerHTML).replace(/<p[^>]*>/gi,"").replace(/<\/p>/gi,"<br _apf_marker='1' /><br _apf_marker='1' />"));this.$controlAgentBehavior(E);}else{t.lastValue=E.innerHTML;}if(A&&A.type=="custom"){if(!A.$template){var q=A.node.childNodes;A.$template=apf.document.appendChild(apf.document.createElement("template"));for(var w=0,u=q.length;w<u;w++){if(q[w].nodeType!=1){continue;}A.$template.appendChild(apf.document.createElement(q[w]));}}A.$lastHeight=E.style.height;A.$template.attach(E,null,true);E.style.height=(E.scrollHeight-apf.getHeightDiff(E)+2)+"px";A.$template.childNodes[0].onblur=function(F){if(F.toElement&&F.toElement!=z){z.dispatchEvent("blur");}else{if(F.toElement){t.skipFocusOnce=true;}else{z.dispatchEvent("blur");}z.focus(null,null,true);}};A.$template.childNodes[0].onafterchange=function(){};A.$template.childNodes[0].onkeydown=function(F){if(F.keyCode==9){F.currentTarget=null;z.dispatchEvent("keydown",F,true);return false;}};A.$template.childNodes[0].setValue(apf.queryValue(C));t.lastTemplate=A.$template;return;}if(apf.hasContentEditable){E.contentEditable=true;}else{document.body.setAttribute("spellcheck","false");document.designMode="on";}if(apf.isGecko){document.execCommand("insertBrOnReturn",false,true);document.execCommand("enableObjectResizing",false,t.objectHandles);document.execCommand("enableInlineTableEditing",false,t.tableHandles);}if(apf.hasFocusBug){apf.sanitizeTextbox(E);E.onselectstart=function(F){F=F||window.event;F.cancelBubble=true;};}var s=A&&apf.isTrue(A.richtext);if(s&&!t.docklet){this.$editable();}if(t.docklet){t.docklet.setProperty("visible",s);}this.setProperty("state",apf.OFF);}function l(D,s,C){var q=this.$edVars;if(!D){D=q.activeNode;}if(!D||D.nodeType!=1){return false;}var t=this.getModel(true),u=D.getAttribute("xpath"),A=this.xmlRoot.ownerDocument.selectSingleNode(u),B,z;if(B=t.$validation){z=B.getRule(A);}if(q.lastTemplate){if(q.lastTemplate.childNodes.indexOf(apf.document.activeElement)>-1){this.focus();}q.lastTemplate.detach();D.innerHTML=q.lastTemplate.childNodes[0].getValue();q.lastTemplate=null;D.style.height=z.$lastHeight;}else{this.$selection.collapse(true);if(apf.hasContentEditable){D.contentEditable=false;}else{document.designMode="off";}}q.activeNode=null;apf.setStyleClass(D,null,["contentEditable_over","contentEditable_active"]);if(q.docklet){q.docklet.setProperty("visible",false);}if(!s||q.lastValue&&D.innerHTML.toLowerCase().replace(/[\r\n]/g,"")==(q.lastValue.dataType==apf.ARRAY?q.lastValue[0]:q.lastValue).toLowerCase().replace(/[\r\n]/g,"")){D.innerHTML=q.lastValue.dataType==apf.ARRAY?q.lastValue[1]:q.lastValue;return false;}if(this.validityState){this.validityState.$reset();}if(apf.queryValue(this.xmlRoot.ownerDocument,u)!=D.innerHTML){var w=(q.tabStack||j()).indexOf(D);this.edit(A,z&&apf.isTrue(z.richtext)?apf.htmlCleaner.parse(D.innerHTML):D.innerHTML);if(B){(this.validityState||(this.validityState=new apf.validator.validityState())).$errorHtml=(q.tabStack||j())[w];this.validityState.$lastPos=w;if(z){this.invalidmsg=z.invalidmsg;}t.validate(A,false,this.validityState,this);}}if(C){$setTimeout(C);}}function j(){var u=this.$edVars;u.tabStack=[];var s=this.$ext.getElementsByTagName("*");for(var t=0,q=s.length;t<q&&s[t].nodeType==1;t++){if(s[t].className&&s[t].className.indexOf("contentEditable")!=-1){u.tabStack.push(s[t]);}}return u.tabStack;}function c(q){return(q.meta?2048:0)|(q.control?1024:0)|(q.alt?512:0)|(q.shift?256:0)|(q.key||"").charCodeAt(0);}function d(){apf.setStyleClass(this,"editor_enabled",["editor_selected","editor_disabled"]);this.disabled=false;}function n(){apf.setStyleClass(this,"editor_disabled",["editor_selected","editor_enabled"]);this.disabled=true;}function m(t,q){if(q){var s=this.$plugins[t];if(this.state==apf.DISABLED&&!s.noDisable){return apf.DISABLED;}return s.queryState?s.queryState(this):this.state;}if(this.state==apf.DISABLED){return apf.DISABLED;}return this.$queryCommandState(t);}function i(s,t){if(!this.$plugins.bullist||!this.$plugins.numlist){return false;}if(typeof s.shift!="undefined"){s.shiftKey=s.shift;}var q=this.$plugins.bullist.queryState(this)==apf.ON?this.$plugins.bullist:this.$plugins.numlist.queryState(this)==apf.ON?this.$plugins.numlist:null;if(!q){return false;}if(t===true){q.correctLists(this);}else{q.correctIndentation(this,s.shiftKey?"outdent":"indent");}return true;}function a(){var q=this.$edVars;if(!this.realtime||q.changeTimer!==null){return;}q.changeTimer=$setTimeout(function(){clearTimeout(q.changeTimer);this.change(this.getValue());q.changeTimer=null;},200);}this.$queryCommandState=function(q){if(apf.isGecko&&(q=="paste"||q=="copy"||q=="cut")){return apf.DISABLED;}try{if(!this.$activeDocument.queryCommandEnabled(q)){return apf.DISABLED;}else{return this.$activeDocument.queryCommandState(q)?apf.ON:apf.OFF;}}catch(s){return apf.OFF;}};this.$queryCommandValue=function(q){var t;if(typeof this.$activeDocument.queryCommand!="function"){return null;}try{t=this.$activeDocument.queryCommand(q);}catch(s){}return t||null;};this.$execCommand=function(s,u){if(this.$plugins[s]||this.state==apf.DISABLED){return;}this.$selection.set();this.$visualFocus();if(s.toLowerCase()=="removeformat"){var A=this.$selection.getContent(),B={FONT:1,SPAN:1,H1:1,H2:1,H3:1,H4:1,H5:1,H6:1,PRE:1,ADDRESS:1,BLOCKQUOTE:1,STRONG:1,B:1,U:1,I:1,EM:1,LI:1,OL:1,UL:1,DD:1,DL:1,DT:1};A=A.replace(/<\/?(\w+)(?:\s.*?|)>/g,function(F,E){return !B[E]?F:"";});if(apf.isIE){var C=this.$selection.setContent("<div>"+A+"</div>");this.$selection.selectNode(C);C.removeNode(false);return;}else{this.$selection.setContent(A);}}this.$activeDocument.execCommand(s,false,u);s=s.toLowerCase();var w=(s=="selectall");if(apf.isIE){if((s=="insertunorderedlist"||s=="insertorderedlist")&&this.$queryCommandState(s)==apf.OFF){w=true;}else{if(s=="outdent"){w=true;if(this.$plugins.bullist&&this.$plugins.numlist){if(this.$plugins.bullist.queryState(this)!=apf.OFF&&this.$plugins.numlist.queryState(this)!=apf.OFF){w=false;}}var D=this.$selection.getSelectedNode();if(w&&D&&D.tagName=="BLOCKQUOTE"){w=false;}}}if(w){var t=this.$edVars.bStandalone?this.$activeDocument.body:this.$edVars.activeNode;t.innerHTML=apf.htmlCleaner.prepare(t.innerHTML);this.$controlAgentBehavior(t);}var q=this.$selection.getRange();if(q){q.scrollIntoView();}}this.$notifyAllButtons();this.change(this.getValue());var z=this;$setTimeout(function(){if(!w){z.$selection.set();}z.$visualFocus();});};this.$addPlugin=function(s){if(this.$plugins[s]){return this.$plugins[s];}if(!apf.ContentEditable.plugin[s]){return null;}var q=new apf.ContentEditable.plugin[s](s);this.$plugins[q.name]=q;if(q.type){if(!this.$pluginsTypes[q.type]){this.$pluginsTypes[q.type]=[];}this.$pluginsTypes[q.type].push(q);}if(q.subType){if(!this.$pluginsTypes[q.subType]){this.$pluginsTypes[q.subType]=[];}this.$pluginsTypes[q.subType].push(q);}if(q.hook){q.hook=q.hook.toLowerCase();if(!this.$pluginsHooks[q.hook]){this.$pluginsHooks[q.hook]=[];}this.$pluginsHooks[q.hook].push(q);}if(typeof q.keyBinding=="string"){q.keyBinding={meta:(q.keyBinding.indexOf("meta")>-1),control:(q.keyBinding.indexOf("ctrl")>-1),alt:(q.keyBinding.indexOf("alt")>-1),shift:(q.keyBinding.indexOf("shift")>-1),key:q.keyBinding.charAt(q.keyBinding.length-1).toLowerCase()};q.keyHash=c(q.keyBinding);if(!this.$pluginsKeys[q.keyHash]){this.$pluginsKeys[q.keyHash]=[];}this.$pluginsKeys[q.keyHash].push(q);}return q;};this.$notifyPlugin=function(q,t){var s=this.$plugins[q];if(s&&s.hook==t&&!s.busy){return s.execute(this,arguments);}return null;};this.$notifyAllPlugins=function(u,w){var t=[];if(!this.$pluginsHooks){return t;}var s=this.$pluginsHooks[u];for(var q in s){if(!s[q].busy&&s[q].execute){t.push(s[q].execute(this,w));}}return t;};this.$notifyKeyBindings=function(w){var u=c(w);if(!this.$pluginsKeys[u]||!this.$pluginsKeys[u].length){return false;}var t=this.$pluginsKeys[u];for(var s=0,q=t.length;s<q;s++){t[s].execute(this,arguments);}return true;};this.$notifyButton=function(q,t){if(!this.$plugins){return;}var s=this.$edVars.oButtons[q];if(!s){return;}var w=this.$plugins[q];if(typeof t=="undefined"||t===null){if(w&&w.queryState){t=w.queryState(this);}else{t=this.$queryCommandState(q);}}if(s.state===t){return;}s.state=t;if(t==apf.DISABLED){n.call(s);}else{if(t==apf.HIDDEN){s.style.display="none";}else{if(t==apf.VISIBLE){s.style.display="";}else{if(s.style.display=="none"){s.style.display="";}if(s.disabled){d.call(s);}var u=(s.selected)?apf.ON:apf.OFF;if(t!=u){this.$buttonClick({state:t,isPlugin:w?true:false,_bogus:true},s);}}}}};this.$notifyAllButtons=function(s){var q,t=this.$edVars.oButtons;for(q in t){this.$notifyButton(q,s);}};this.$visualFocus=function(q){var t=(this.$pluginsActive=="code"),u=this.$edVars;if(u.bStandalone&&apf.document.activeElement==this&&!t){try{this.$oWin.focus();}catch(s){}}else{if(!u.bStandalone&&u.activeNode){u.activeNode.focus();}}if(t){this.$notifyAllButtons(apf.DISABLED);this.$notifyButton("code",apf.SELECTED);}else{if(q){this.$notifyAllButtons();}}};this.$buttonClick=function(t,s){if(this.$selection){this.$selection.cache();}apf.setStyleClass(s,"active");var q=s.getAttribute("type");if(!t._bogus){t.isPlugin=this.$plugins[q]?true:false;t.state=m.call(this,q,t.isPlugin);}if(t.state==apf.DISABLED){n.call(s);}else{if(this.disabled){d.call(s);}if(t.state==apf.ON){apf.setStyleClass(s,"editor_selected");s.selected=true;}else{apf.setStyleClass(s,"",["editor_selected"]);s.selected=false;}if(!t._bogus){if(t.isPlugin){this.$plugins[(this.$pluginsActive=q)].execute(this);}else{this.$execCommand(q);}t.state=m.call(this,q,t.isPlugin);}}apf.setStyleClass(s,"",["active"]);};this.$drawToolbars=function(O,s,u,w){var E,M,N,Q,P,D,F,K,R,T,U,B,t,A,I=this.$edVars,q=I.bStandalone?"button":"toolbarbutton",C=I.docklet.$getOption("toolbars"),G=this.$plugins;if(!s){s="toolbar";}for(Q=0,M=C.childNodes.length;Q<M;Q++){K=C.childNodes[Q];if(K.nodeType!=1||K[apf.TAGNAME]!=s){continue;}for(P=0,N=K.childNodes.length;P<N;P++){B=K.childNodes[P];R=B.nodeValue.splitSafe(",",-1,true);}if(!R||!R.length){continue;}I.docklet.$getNewContext("toolbar");E=w?apf.insertHtmlNode(I.docklet.$getLayoutNode("toolbar"),O):O.appendChild(I.docklet.$getLayoutNode("toolbar"));for(D=0,F=R.length;D<F;D++){U=R[D];if(U=="|"){I.docklet.$getNewContext("divider");if(w){apf.insertHtmlNode(I.docklet.$getLayoutNode("divider"),E);}else{E.appendChild(I.docklet.$getLayoutNode("divider"));}}else{I.docklet.$getNewContext(q);A=w?A=apf.insertHtmlNode(I.docklet.$getLayoutNode(q),E):A=E.appendChild(I.docklet.$getLayoutNode(q));T=false;if(s=="toolbar"&&!this.$nativeCommands.contains(U)){t=this.$addPlugin(U);T=true;}if(T){t=t||G[U];if(!t){continue;}if(!(t.type&apf.TOOLBARITEM)){continue;}I.docklet.$getLayoutNode(q,"label",A).setAttribute("class","editor_icon editor_"+t.icon);A.setAttribute("title",this.$translate(t.name));}else{I.docklet.$getLayoutNode(q,"label",A).setAttribute("class","editor_icon editor_"+U);A.setAttribute("title",this.$translate(U));}A.setAttribute("onmousedown",u||"apf.all["+this.$uniqueId+"].$buttonClick(event, this);");A.setAttribute("onmouseover","apf.setStyleClass(this, 'hover');");A.setAttribute("onmouseout","apf.setStyleClass(this, '', ['hover']);");A.setAttribute("type",U);}}R=null;}if(apf.isIE){var J=O.getElementsByTagName("*");for(Q=J.length-1;Q>=0;Q--){J[Q].setAttribute("unselectable","On");}}};this.$editable=function(D){if(this.getAttribute("plugins")){this.$propHandlers.plugins.call(this,this.getAttribute("plugins"));}if(this.getAttribute("language")){this.$propHandlers.language.call(this,this.getAttribute("language"));}var q=this.$edVars;if(!this.$ext){q.docklet=this;q.bStandalone=true;this.$ext=this.$getExternal("main",null,function(G){var F=this.$getLayoutNode("main","toolbar");this.$drawToolbars(F);});this.oToolbar=this.$getLayoutNode("main","toolbar",this.$ext);}else{if(!q.docklet&&!(apf.ContentEditable.toolwin=q.docklet)){q.docklet=apf.ContentEditable.toolwin=new apf.modalwindow("toolwindow",document.body,null,true);q.docklet.parentNode=apf.document.documentElement;q.docklet.implement(apf.AmlNode);q.docklet.$aml=apf.getXml("<toolwindow />");q.docklet.$loadSkin();q.docklet.$draw();q.docklet.setProperty("buttons","");q.docklet.setProperty("title","Formatting");q.docklet.setProperty("icon","application.png");q.docklet.setProperty("resizable","horizontal");q.docklet.setProperty("draggable",true);q.docklet.setProperty("focussable",true);var C=this;q.docklet.onfocus=function(){C.focus();};apf.AmlParser.parseLastPass();q.docklet.setProperty("left",500);q.docklet.setProperty("top",100);q.docklet.setProperty("width",400);q.docklet.setProperty("zindex",100000);var A,B=q.docklet.$ext.getElementsByTagName("div");for(var u=0,s=B.length;u<s&&!A;u++){if(B[u].className.indexOf("content")!=-1){A=B[u];}}this.$drawToolbars(this.oToolbar=A,"toolbar",null,true);this.oToolbar.innerHTML=this.oToolbar.innerHTML;}}if(D){D.call(this);}if(this.oToolbar){var t=this.oToolbar.getElementsByTagName("div");for(var E,z,w=t.length-1;w>=0;w--){E=t[w].getAttribute("type");if(!E){continue;}q.oButtons[E]=t[w];z=this.$plugins[E];if(!z){continue;}z.buttonNode=t[w];if(z.init){z.init(this);}}}};this.$getPluginOption=function(q){return this.$edVars.docklet.$getOption(q);};this.$showPopup=function(w,s,z,q,u){if(apf.popup.last&&apf.popup.last!=s){var t=apf.lookup(apf.popup.last);if(t){t.state=apf.OFF;this.$notifyPlugin(t.name,t.state);}}this.$selection.set();if(this.$visualFocus){this.$visualFocus();}w.state=apf.ON;this.$notifyPlugin(w.name,apf.ON);if(apf.popup.isShowing(s)){return;}$setTimeout(function(){apf.popup.show(s,{x:0,y:22,animate:false,ref:z,width:q,height:u,callback:function(A){if(A.onkeydown){return;}A.onkeydown=function(C){C=C||window.event;var B=C.which||C.keyCode;if(B==13&&typeof w.submit=="function"){return w.submit(new apf.AbstractEvent(C));}};}});});};this.$translate=function(s,q){return q?apf.ContentEditable.i18n[this.language]["plugins"][s]:apf.ContentEditable.i18n[this.language][s];};this.$insertHtml=function(t,s,u){if(!u){this.$selection.set();}this.$visualFocus(true);t=s?t:apf.htmlCleaner.prepare(t);this.$selection.setContent(t,true);this.change(this.getValue());if(u){return;}var q=this;$setTimeout(function(){q.$selection.set();q.$visualFocus();});};this.$controlAgentBehavior=function(z){if(apf.isGecko){var A;while(z.childNodes.length){A=z.firstChild;if(A.nodeType==1){if(A.nodeName=="BR"&&A.getAttribute("_moz_editor_bogus_node")=="TRUE"){this.$selection.selectNode(A);this.$selection.remove();this.$selection.collapse(false);break;}}z=A;}}else{if(apf.isWebkit){this.$activeDocument.designMode="on";}else{if(apf.isIE){var w,q=z.getElementsByTagName("a");for(var u=0,t=q.length;u<t;u++){w=q[u].getAttribute("_apf_href");if(w){q[u].href=(w.indexOf("http://")==-1?"http://":"")+w;}}}}}};this.language="en_GB";this.state=apf.OFF;this.edit=function(q,s){this.$executeSingleValue("edit","edit",q,s);};};apf.ON=1;apf.OFF=0;apf.DISABLED=-1;apf.VISIBLE=2;apf.HIDDEN=3;apf.SELECTED=4;apf.ContentEditable.i18n={en_GB:{cancel:"Cancel",insert:"Insert",bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",justifyleft:"Align text left",justifycenter:"Center",justifyright:"Align text right",justifyfull:"Justify",removeformat:"Clear formatting",cut:"Cut",copy:"Copy",paste:"Paste",outdent:"Decrease indent",indent:"Increase indent",undo:"Undo",redo:"Redo",anchor:"Insert anchor",blockquote:"Blockquote",charmap:"Character map",code:"HTML source view",listitem:"List item",nbsp:"Non-breaking space","break":"Linebreak",paragraph:"Paragraph",forecolor:"Font color",backcolor:"Highlight color",insertdate:"Insert current date",inserttime:"Insert current time",rtl:"Change text direction to right-to-left",ltr:"Change text direction to left-to-right",emotions:"Insert emotion",fonts:"Font",fontsize:"Font size",fontstyle:"Font style",blockformat:"Paragraph style",help:"Help",hr:"Insert horizontal rule",image:"Insert image",imagespecial:"Choose an image to insert",link:"Insert hyperlink",unlink:"Remove hyperlink",bullist:"Bullets",numlist:"Numbering",media:"Insert medium",pasteworddialog:"Paste from Word",pastetext:"Paste plaintext",paste_keyboardmsg:"Use %s on your keyboard to paste the text into the window.",print:"Print document",preview:"Preview document",scayt:"Turn spellcheck on/ off",search:"Search",replace:"Search and Replace",findnext:"Find next",doreplace:"Replace",replaceall:"Replace all",sub:"Subscript",sup:"Superscript",table:"Insert table",table_noun:"Table",visualaid:"Toggle visual aid on/ off"},nl_NL:{cancel:"Annuleren",insert:"Invoegen",bold:"Vet",italic:"Schuingedrukt",underline:"Onderstreept",strikethrough:"Doorgestreept",justifyleft:"Recht uitlijnen",justifycenter:"Centreren",justifyright:"Rechts uitlijnen",justifyfull:"Justify",removeformat:"Stijlen verwijderen",cut:"Knippen",copy:"Kopieren",paste:"Plakken",outdent:"Inspringen verkleinen",indent:"Inspringen vergroten",undo:"Ongedaan maken",redo:"Opnieuw",anchor:"Anchor invoegen",blockquote:"Blockquote",charmap:"Speciale tekens",code:"HTML broncode",listitem:"Lijst item",nbsp:"Niet-brekende spatie","break":"Regelafbreuk",paragraph:"Paragraaf",forecolor:"Tekstkleur",backcolor:"Markeerkleur",insertdate:"Huidige datum invoegen",inserttime:"Huidige tijd invoegen",rtl:"Verander tekstrichting naar rechts-naar-links",ltr:"Verander tekstrichting naar links-naar-rechts",emotions:"Emoticon invoegen",fonts:"Lettertype",fontsize:"Letter grootte",fontstyle:"Tekststijl",blockformat:"Paragraafstijl",help:"Hulp",hr:"Horizontale lijn invoegen",image:"Afbeelding invoegen",imagespecial:"Afbeelding kiezen",link:"Link invoegen",unlink:"Link verwijderen",bullist:"Ongenummerd",numlist:"Genummerd",media:"Medium invoegen",pasteworddialog:"Word Tekst Plakken",pastetext:"Tekst Plakken",paste_keyboardmsg:"Gebruik %s op uw toetsenbord om tekst in dit scherm te plakken.",print:"Printen",preview:"Voorbeeldvertoning",scayt:"Spellingscontrole aan/ uit",search:"Zoeken",replace:"Zoeken en vervangen",findnext:"Volgende",doreplace:"Vervangen",replaceall:"Vervang alle",sub:"Subscript",sup:"Superscript",table:"Tabel invoegen",table_noun:"Tabel",visualaid:"Visuele hulp aan/ uit"}};apf.TOOLBARITEM=1;apf.TOOLBARBUTTON=2;apf.TOOLBARPANEL=4;apf.TEXTMACRO=8;apf.CMDMACRO=16;apf.ContentEditable.plugin=function(c,a){apf.ContentEditable.plugin[c]=function(){this.$uniqueId=apf.all.push(this)-1;this.appendAmlNode=function(d,j){if(!d){return null;}var m=new apf.DOMParser(),i=this.editor.ownerDocument.createDocumentFragment();i.$int=j;var l=m.parseFromString(d,"text/xml",{doc:this.editor.ownerDocument,docFrag:i});return l.firstChild;};this.dispatchEvent=function(){var d=this;window.setTimeout(function(){if(d.type==apf.editor.CONTEXTPANEL&&d.queryState(d.editor)==apf.editor.ON){return;}d.state=apf.editor.OFF;if(d.editor){d.editor.$notifyButton(d.name,d.state);}apf.popup.hide();apf.popup.last=null;});return false;};this.$destroy=function(){apf.popup.forceHide();this.buttonNode=this.editor=null;delete this.buttonNode;delete this.editor;if(this.destroy){this.destroy();}};a.apply(this,arguments);};};apf.GuiElement.propHandlers.contenteditable=function(a){this.implement(apf.ContentEditable);if(!this.hasFeature(apf.__VALIDATION__)){this.implement(apf.Validation);}this.$propHandlers.contenteditable.apply(this,arguments);};apf.ContentEditable.plugin("link",function(){this.name="link";this.icon="link";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";this.keyBinding="ctrl+shift+l";this.state=apf.OFF;var a;this.init=function(i,d){this.buttonNode.className=this.buttonNode.className+" dropdown_small";var c=this.buttonNode.insertBefore(document.createElement("span"),this.buttonNode.getElementsByTagName("div")[0]);c.className="selectarrow";};this.execute=function(d){if(!a){this.editor=d;apf.popup.setContent(this.$uniqueId,this.createPanelBody());}d.dispatchEvent("pluginexecute",{name:this.name,plugin:this});this.oUrl.value="http://";this.editor.$showPopup(this,this.$uniqueId,this.buttonNode,218,95);if(a.style.visibility=="hidden"){a.style.visibility="visible";}var c=this;$setTimeout(function(){c.oUrl.focus();});return{id:this.name,action:null};};this.queryState=function(c){if(c.$selection.isCollapsed()||c.$selection.getSelectedNode().tagName=="A"){return apf.DISABLED;}return this.state;};this.submit=function(j){apf.popup.forceHide();if(!this.oUrl.value.replace("http://","")){return;}this.editor.$execCommand("CreateLink","javascript:apftmp(0);");var m,c=this.editor.$activeDocument.getElementsByTagName("a");for(var d=0;d<c.length&&!m;d++){if(c[d].href=="javascript:apftmp(0);"){m=c[d];}}if(m){var l=this.oUrl.value;m.href=(l.indexOf("http://")==-1?"http://":"")+l;m.target=this.oTarget.value;m.title=this.oTitle.value;}this.editor.$selection.collapse(false);this.editor.change(this.editor.getValue());if(j.stop){j.stop();}return false;};this.createPanelBody=function(){a=document.body.appendChild(document.createElement("div"));a.className="editor_popup";a.style.display="none";var j="editor_"+this.$uniqueId+"_link_url";var i="editor_"+this.$uniqueId+"_link_target";var c="editor_"+this.$uniqueId+"_link_title";var d="editor_"+this.$uniqueId+"_link_btns";a.innerHTML='<div class="editor_panelrow editor_panelrowinput">                <label for="'+j+'">Link URL</label>                <input type="text" id="'+j+'" name="'+j+'" class="editor_input" value="" />            </div>            <div class="editor_panelrow editor_panelrowinput">                <label for="'+i+'">Target</label>                <select id="'+i+'" name="'+i+'">                    <option value="_self">Open in this window/ frame</option>                    <option value="_blank">Open in new window (_blank)</option>                    <option value="_parent">Open in parent window/ frame (_parent)</option>                    <option value="_top">Open in top frame (replaces all frames) (_top)</option>                </select>            </div>            <div class="editor_panelrow editor_panelrowinput">                <label for="'+c+'">Title</label>                <input type="text" id="'+c+'" name="'+c+'" class="editor_input" value="" />            </div>            <div id="'+d+'" class="editor_panelrow editor_panelrowbtns"></div>';this.oUrl=document.getElementById(j);this.oTarget=document.getElementById(i);this.oTitle=document.getElementById(c);if(apf.hasFocusBug){apf.sanitizeTextbox(this.oUrl);apf.sanitizeTextbox(this.oTarget);apf.sanitizeTextbox(this.oTitle);this.oUrl.onselectstart=this.oTarget.onselectstart=this.oTitle.onselectstart=function(l){l=l||window.event;l.cancelBubble=true;};}new apf.toolbar({htmlNode:document.getElementById(d),skinset:apf.getInheritedAttribute(this.editor.parentNode,"skinset"),childNodes:[new apf.bar({childNodes:[new apf.button({caption:this.editor.$translate("insert"),onclick:"apf.lookup("+this.$uniqueId+").submit(event)"})]})]});return a;};this.destroy=function(){a=this.oUrl=this.oTarget=this.oTitle=null;delete a;delete this.oUrl;delete this.oTarget;delete this.oTitle;};});apf.ContentEditable.plugin("unlink",function(){this.name="unlink";this.icon="unlink";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";this.keyBinding="ctrl+shift+l";this.state=apf.OFF;this.execute=function(c){if(this.queryState(c)==apf.DISABLED){return;}if(apf.isIE){c.$execCommand("Unlink");}else{var d=c.$selection;d.set();var i=d.getSelectedNode();if(i.tagName=="A"){var a=i.innerHTML;d.selectNode(i);d.remove();d.collapse();c.$insertHtml(a);}}};this.queryState=function(a){if(!a.$selection){console.dir(a);}if(a.$selection.getSelectedNode().tagName=="A"){return apf.OFF;}return apf.DISABLED;};});apf.ContentEditable.subSupCommand=function(a){this.name=a;this.icon=a;this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";this.keyBinding=a=="sub"?"ctrl+alt+s":"ctrl+shift+s";this.state=apf.OFF;this.execute=function(d){var c=this.name=="sub"?"Superscript":"Subscript";if(d.$queryCommandState(c)==apf.ON){d.$execCommand(c);}d.$execCommand(this.name=="sub"?"Subscript":"Superscript");d.dispatchEvent("pluginexecute",{name:this.name,plugin:this});};this.queryState=function(c){return c.$queryCommandState(this.name=="sub"?"Subscript":"Superscript");};};apf.ContentEditable.plugin("sub",apf.ContentEditable.subSupCommand);apf.ContentEditable.plugin("sup",apf.ContentEditable.subSupCommand);apf.ContentEditable.plugin("fonts",function(){this.name="fonts";this.icon="fonts";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";this.buttonNode=null;this.state=apf.OFF;this.colspan=1;this.fontNames={};var a;this.init=function(n){this.buttonNode.className=this.buttonNode.className+" fontpicker";this.fontPreview=this.buttonNode.getElementsByTagName("span")[0];this.fontPreview.className+=" fontpreview";var c=this.buttonNode.insertBefore(document.createElement("span"),this.buttonNode.getElementsByTagName("div")[0]);c.className="selectarrow";this.editor=n;var d,m,i,s,o;var q=n.$getPluginOption("fonts").childNodes[0];while(q){s=q.nodeValue.splitSafe("(?:;|=)");if(s[0]){for(m=0,d=s.length;m<d;m++){this.fontNames[s[m]]=s[++m];}break;}q=q.nextSibling;}this.queryState(n);};this.execute=function(){if(!a){apf.popup.setContent(this.$uniqueId,this.createPanelBody());}this.editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});this.editor.$showPopup(this,this.$uniqueId,this.buttonNode,120);return{id:this.name,action:null};};this.queryState=function(d){this.state=d.$queryCommandState("FontName");var c=d.$queryCommandValue("FontName");if(!c||(this.fontNames[c]&&this.fontPreview.innerHTML!=c)){this.fontPreview.innerHTML=c?c:"Font";}};this.submit=function(i){i=new apf.AbstractEvent(i||window.event);while(i.target.tagName.toLowerCase()!="a"&&i.target.className!="editor_popup"){i.target=i.target.parentNode;}var d=i.target.getAttribute("rel");if(d){apf.popup.forceHide();if(apf.isIE){this.editor.$selection.set();if(this.editor.$selection.isCollapsed()){this.editor.$visualFocus();var c=this.editor.$selection.getRange();c.moveStart("character",-1);c.select();}}this.editor.$execCommand("FontName",d);if(apf.isIE){this.editor.$selection.collapse(false);}}};this.createPanelBody=function(){a=document.body.appendChild(document.createElement("div"));a.className="editor_popup";a.style.display="none";var c=[];for(var d in this.fontNames){c.push('<a class="editor_panelcell editor_font" style="font-family:',this.fontNames[d],';" rel="',d,'" href="javascript:;" onmouseup="apf.lookup(',this.$uniqueId,').submit(event);">',d,"</a>");}a.innerHTML=c.join("");return a;};this.destroy=function(){a=this.fontPreview=null;delete a;delete this.fontPreview;};});apf.ContentEditable.plugin("fontsize",function(){this.name="fontsize";this.icon="fontsize";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";this.buttonNode=null;this.state=apf.OFF;var c;var a={"1":"8","2":"10","3":"12","4":"14","5":"18","6":"24","7":"36"};this.init=function(d){this.buttonNode.className=this.buttonNode.className+" fontsizepicker";this.sizePreview=this.buttonNode.getElementsByTagName("span")[0];this.sizePreview.className+=" fontsizepreview";var i=this.buttonNode.insertBefore(document.createElement("span"),this.buttonNode.getElementsByTagName("div")[0]);i.className="selectarrow";this.queryState(d);};this.execute=function(j){if(!c){this.editor=j;var d,l,m=j.$getPluginOption("fontsizes");for(d=0;d<m.childNodes.length;d++){l=m.childNodes[d];if(l.nodeType==3||l.nodeType==4){this.fontSizes=l.nodeValue.splitSafe(",");}}apf.popup.setContent(this.$uniqueId,this.createPanelBody());}this.editor.$showPopup(this,this.$uniqueId,this.buttonNode,203);return{id:this.name,action:null};};this.queryState=function(i){this.state=i.$queryCommandState("FontSize");var d=i.$queryCommandValue("FontSize");if(!d||this.sizePreview.innerHTML!=d){this.sizePreview.innerHTML=d?d:"Size";}};this.submit=function(i){i=new apf.AbstractEvent(i||window.event);while(i.target.tagName.toLowerCase()!="a"&&i.target.className!="editor_popup"){i.target=i.target.parentNode;}var j=i.target.getAttribute("rel");if(j){apf.popup.forceHide();if(apf.isIE){this.editor.$selection.set();if(this.editor.$selection.isCollapsed()){this.editor.$visualFocus();var d=this.editor.$selection.getRange();d.moveStart("character",-1);d.select();}}this.editor.$execCommand("FontSize",j);if(apf.isIE){this.editor.$selection.collapse(false);}}i.stop();return false;};this.createPanelBody=function(){c=document.body.appendChild(document.createElement("div"));c.className="editor_popup";c.style.display="none";var d=[];var l=this.fontSizes;for(var j=0;j<l.length;j++){d.push('<a class="editor_panelcell editor_fontsize" style="font-size:',a[l[j]],"pt;height:",a[l[j]],"pt;line-height:",a[l[j]],'pt;" rel="',l[j],'" href="javascript:;" onmouseup="apf.lookup(',this.$uniqueId,').submit(event);">',l[j]," (",a[l[j]],"pt)</a>");}c.innerHTML=d.join("");return c;};this.destroy=function(){c=this.sizePreview=null;delete c;delete this.sizePreview;};});apf.ContentEditable.plugin("media",function(){this.name="media";this.icon="media";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";this.keyBinding="ctrl+m";this.state=apf.OFF;this.execute=function(a){a.dispatchEvent("pluginexecute",{name:this.name,plugin:this});};this.queryState=function(a){return this.state;};});apf.ContentEditable.listPlugin=function(i){this.name=i;this.icon=i;this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";this.keyBinding=i=="bullist"?"ctrl+shift+u":"ctrl+shift+o";this.state=apf.OFF;var c=apf.isIE?/^(&nbsp;)?<DIV[^>]*_apf_placeholder(="1">&nbsp;)?<\/DIV>$/gi:/^(&nbsp;)?<BR\/?>$/gi;this.execute=function(j){j.$execCommand(this.name=="bullist"?"InsertUnorderedList":"InsertOrderedList");this.correctLists(j);j.$visualFocus();j.dispatchEvent("pluginexecute",{name:this.name,plugin:this});};function d(q,o){var j,n,m,l=(this.name=="bullist")?"OL":"UL";for(j=q.childNodes.length;j>=0;j--){n=q.childNodes[j];if(!n){continue;}if(n.tagName==l){break;}if(!m){o.appendChild(n);}else{o.insertBefore(n,m);}m=n;}q.parentNode.removeChild(q);}function a(o){if(!o||o.nodeType!=1){return;}var q,l=o.getElementsByTagName("li");for(var n=0,m=l.length;n<m;n++){q=l[n].innerHTML.trim();if(q==""||q=="&nbsp;"||q.match(c)){return l[n];}}return null;}this.correctLists=function(m){m.$selection.set();var q=m.$selection.getSelectedNode();if(q.tagName!="LI"){q=a(q);if(!q||q.tagName!="LI"){return false;}}var o=q.parentNode,j=q.parentNode.previousSibling,n=null;if(!j){return false;}if(j&&j.tagName=="BR"){n=j;j=j.previousSibling;}var l=(j&&j.tagName==o.tagName)?j:null;if(!l){return;}if(n){o.removeChild(n);}d(o,l);m.$selection.selectNode(q);if(!apf.isIE){m.$selection.getRange().setStart(q,0);}m.$selection.collapse(!apf.isIE);m.$visualFocus();return true;};this.correctIndentation=function(l,j){l.$execCommand(j);this.correctLists(l);};this.queryState=function(j){var l=j.$queryCommandState(this.name=="bullist"?"InsertUnorderedList":"InsertOrderedList");if(l==apf.DISABLED){return apf.OFF;}return l;};};apf.ContentEditable.plugin("bullist",apf.ContentEditable.listPlugin);apf.ContentEditable.plugin("numlist",apf.ContentEditable.listPlugin);apf.ContentEditable.plugin("fontstyle",function(){this.name="fontstyle";this.icon="fontstyle";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";this.buttonNode=null;this.state=apf.OFF;var i,a=null,j=null;function d(t){if(!a){var n,o,w,u=t.$getPluginOption("fontstyles");for(var s=0,q=u.childNodes.length;s<q&&!a;s++){n=u.childNodes[s];if(n.nodeType==3||n.nodeType==4){a={};o=[];w=[];n.nodeValue.replace(/([\w ]+)\s*=\s*(([^\{]+?)\s*\{[\s\S]*?\})\s*/g,function(z,A,B,C){if(B.charAt(0)!="."){B="."+B;}B=B.trim().replace(/[\s]+/g,"");C=C.trim().replace(/\./,"");a[C]={caption:A.trim(),cname:C,css:B,node:null};o.push(B);w.push(".editor_fontstyle "+B);});}}if(o.length){apf.importCssString(w.join(""));apf.importCssString(o.join(""),t.$activeDocument);if(apf.isIE){var l=t.$activeDocument.getElementsByTagName("head")[0].childNodes,m=l.length-1;while(m){if(l[m].nodeType==3){l[m].parentNode.removeChild(l[m]);}m--;}}}}return a;}this.init=function(m){j=m;this.buttonNode.className=this.buttonNode.className+" fontstylepicker";this.stylePreview=this.buttonNode.getElementsByTagName("span")[0];this.stylePreview.className+=" fontstylepreview";var l=this.buttonNode.appendChild(document.createElement("span"));l.className="selectarrow";this.queryState(m);};this.execute=function(l){if(!i){j=l;apf.popup.setContent(this.$uniqueId,this.createPanelBody(l));}l.dispatchEvent("pluginexecute",{name:this.name,plugin:this});j.$showPopup(this,this.$uniqueId,this.buttonNode,203);return{id:this.name,action:null};};function c(){d(j);var o=j.$selection.getSelectedNode();while(o&&o.nodeType!=1){o=o.parentNode;}var n;while(!n&&o&&o.tagName!="BODY"){var m=o.className;for(var l in a){if(m.indexOf(l)>-1){n=a[l];n.node=o;}}o=o.parentNode;}return n;}this.submit=function(B,l){if(!l){B=new apf.AbstractEvent(B||window.event);while(B.target.tagName.toLowerCase()!="a"&&B.target.className!="editor_popup"){B.target=B.target.parentNode;}l=B.target.getAttribute("rel");}if(l){apf.popup.forceHide();var t=j.$selection;t.set();j.$visualFocus();var q=c(j);if(q&&l=="normal"){var u=q.node.childNodes,m=q.node.parentNode;while(u.length){m.insertBefore(u[0],q.node);}m.removeChild(q.node);this.queryState(j);}else{if(q&&(t.isCollapsed()||t.getContent("text")==q.node.innerHTML)&&apf.isChildOf(q.node,t.getSelectedNode(),true)){if(q.cname==l){return;}apf.setStyleClass(q.node,l,[q.cname]);}else{if(t.isCollapsed()){if(apf.isIE){var D=t.getRange().parentElement();var m=j.$activeDocument.createElement("span");m.className=l;m.innerHTML=D.innerHTML;if(D.tagName=="BODY"){D.innerHTML="";D.appendChild(m);}else{D.parentNode.insertBefore(m,D);D.parentNode.removeChild(D);}t.selectNode(m);}else{var w=t.getRange();var z=w.commonAncestorContainer;w.setStartBefore(z);w.setEndAfter(z);t.setRange(w);var C=t.setContent('<span class="'+l+'">'+t.getContent()+"</span>");t.selectNode(C);}}else{var E=t.getContent().trim();var A=E.substr(0,5)=="<SPAN";E=E.replace(/<SPAN class=.*?>|<\/SPAN>/gi,"");if(E.charAt(0)=="<"){E=E.replace(/<(normal|pre|p|address|h1|h2|h3|h4|h5|h6)(?:\s.*?|)>(.+?)<\/(normal|pre|p|address|h1|h2|h3|h4|h5|h6)>/gi,'<$1><span class="'+l+'">$2</span></$3>').replace(/^([\s\S]*?)(<(?:normal|pre|p|address|h1|h2|h3|h4|h5|h6)[\s\S]*<\/(?:normal|pre|p|address|h1|h2|h3|h4|h5|h6)>)([\s\S]*?)$/gi,function(n,F,s,o){return(F?'<span class="'+l+'">'+F+"</span>":"")+s+(o?'<span class="'+l+'">'+o+"</span>":"");}).replace(/^\s*<(?:normal|pre|p|address|h1|h2|h3|h4|h5|h6)(?:\s.*?|)>|<\/(?:normal|pre|p|address|h1|h2|h3|h4|h5|h6)>\s*$/gi,"");if(apf.isIE){E=E.replace(/<\/P>/,"");}}else{E='<span class="'+l+'">'+E+"</span>";}if(A){E="</SPAN>"+E.replace(/<\/SPAN>$/i,"");}var C=t.setContent(E,true);t.selectNode(C);}}}j.change(j.getValue());}};this.queryState=function(){var l=c();if(l){if(this.stylePreview.innerHTML!=l.caption){this.stylePreview.innerHTML=l.caption;}this.state=apf.ON;}else{this.stylePreview.innerHTML="Style";this.state=apf.OFF;}return this.state;};this.createPanelBody=function(n){i=document.body.appendChild(document.createElement("div"));i.className="editor_popup";i.style.display="none";d(n);var l=['<a class="editor_panelcell editor_fontstyle" rel="normal"             href="javascript:;" onmouseup="apf.lookup(',this.$uniqueId,').submit(event);"><span>Normal</span></a>'];for(var m in a){l.push('<a class="editor_panelcell editor_fontstyle" rel="',m,'" href="javascript:;" onmouseup="apf.lookup(',this.$uniqueId,').submit(event);"><span class="',m,'">',a[m].caption,"</span></a>");}i.innerHTML=l.join("");return i;};this.destroy=function(){i=this.stylePreview=j=null;delete i;delete this.stylePreview;delete j;};});apf.ContentEditable.plugin("blockformat",function(){this.name="blockformat";this.icon="blockformat";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";this.buttonNode=null;this.state=apf.OFF;this.node=null;var c,j,d={normal:"Normal",p:"Paragraph",pre:"Preformatted",address:"Address",h1:"Header 1",h2:"Header 2",h3:"Header 3",h4:"Header 4",h5:"Header 5",h6:"Header 6"},n,o,m,l,a;function i(u){if(!a){var t,s,w,z=u.$getPluginOption("blockformats");for(t=0,s=z.childNodes.length;t<s;t++){w=z.childNodes[t];if(w.nodeType==3||w.nodeType==4){a=w.nodeValue.splitSafe(",");}}var q="("+a.join("|")+")";n=new RegExp("^"+q+"$","gi");o=new RegExp("<\\/?"+q+">","gi");m=new RegExp("<\\/?("+a.join("|")+"|p)>","gi");l=new RegExp("^("+a.join("|")+"|p)$","gi");}return a;}this.init=function(q){j=q;this.buttonNode.className=this.buttonNode.className+" blockformatpicker";this.blockPreview=this.buttonNode.getElementsByTagName("span")[0];this.blockPreview.className+=" blockformatpreview";var s=this.buttonNode.appendChild(document.createElement("span"));s.className="selectarrow";this.queryState(q);};this.execute=function(q){if(!c){j=q;apf.popup.setContent(this.$uniqueId,this.createPanelBody(q));}j.$showPopup(this,this.$uniqueId,this.buttonNode,203);return{id:this.name,action:null};};this.queryState=function(){var u=j.$selection.getSelectedNode(),t=i(j),s=u.nodeType==1?u.tagName.toLowerCase():"";while(s&&!s.match(n)&&s!="body"){u=u.parentNode;s=(u.tagName||"").toLowerCase();}if(s.match(n)){var q=d[s];if(this.blockPreview.innerHTML!=q){this.blockPreview.innerHTML=q;}this.state=apf.ON;this.node=u;}else{this.blockPreview.innerHTML="Normal";this.state=apf.OFF;this.node=null;}return this.state;};this.submit=function(N,K){if(!K){N=new apf.AbstractEvent(N||window.event);while(N.target.tagName.toLowerCase()!="a"&&N.target.className!="editor_popup"){N.target=N.target.parentNode;}K=N.target.getAttribute("rel");}if(K){apf.popup.forceHide();var z,I=j.$selection;I.set();j.$visualFocus();var C=I.getContent();if(K=="normal"&&this.queryState(j)==apf.ON){var F=this.node.childNodes,E=this.node.parentNode;if(apf.isIE){var G=E.insertBefore(E.ownerDocument.createElement("p"),this.node);while(F.length){G.insertBefore(F[0],G.firstChild);}E.removeChild(this.node);I.selectNode(G);if(G.previousSibling&&G.previousSibling.tagName=="P"){if(G.previousSibling.innerHTML==""){G.parentNode.removeChild(G.previousSibling);}}}else{while(F.length){E.insertBefore(F[0],this.node);}E.removeChild(this.node);}this.state=apf.OFF;this.node=null;this.blockPreview.innerHTML="Normal";}else{if(I.isCollapsed()||C.trim()==""){if(apf.isIE){var O,z;z=O=I.getRange().parentElement();while(!z.tagName.match(l)&&z.tagName!="BODY"){z=z.parentNode;}if(z&&z.tagName=="BODY"){if(O!=z){z=O;}else{}}var E=j.$activeDocument.createElement(K);E.innerHTML=z.innerHTML;if(z.tagName=="BODY"){z.innerHTML="";z.appendChild(E);}else{z.parentNode.insertBefore(E,z);z.parentNode.removeChild(z);}I.selectNode(E);}else{j.$execCommand("FormatBlock",K);}this.blockPreview.innerHTML=d[K];}else{z=I.getSelectedNode();while(z.nodeType!=1){z=z.parentNode;}if(z.tagName.match(l)&&C.length==z[apf.hasInnerText?"innerText":"textContent"].length){var E=j.$activeDocument.createElement(K);E.innerHTML=z.innerHTML;z.parentNode.insertBefore(E,z);z.parentNode.removeChild(z);I.selectNode(E);}else{while(!z.tagName.match(l)&&z.tagName!="BODY"){z=z.parentNode;}if(z&&z.tagName!="BODY"){var q;if(z.tagName=="P"&&apf.isIE){q="<"+K+">"+C.trim().replace(m,"")+"</"+K+">";t=I.setContent(q);}else{q='<P __apf_placeholder="true">'+C+"</P>";I.setContent(q);var u=z.tagName;var B=[],w,A;var M=z.innerHTML.replace(q,function(s,P){return(P!=0?(w=true)&&"</"+u+">":"")+"<"+K+' __apf_placeholder="true">'+C.replace(m,"")+"</"+K+">"+(P<z.innerHTML.length-C.length?(A=true)&&"<"+u+">":"");});if(w){B.push("<"+u+">");}B.push(M);if(A){B.push("</"+u+">");}z.innerHTML=B.join("");var t,F=z.getElementsByTagName(K);for(var J=0;J<F.length;J++){if(F[J].getAttribute("__apf_placeholder")){F[J].removeAttribute("__apf_placeholder");t=F[J];break;}}F=z.childNodes,E=z.parentNode;while(F.length){E.insertBefore(F[0],z);}E.removeChild(z);}if(t){if(apf.isIE){var D=t.previousSibling;if(D&&D.tagName=="P"&&D.innerHTML=="&nbsp;"){D.parentNode.removeChild(D);}}I.selectNode(t);}}else{var t=I.setContent("<"+K+">"+C.replace(/<p>(.*?)<\/p>(.)/gi,"$1<br />$2").replace(m,"")+"</"+K+">");if(apf.isIE){var D=t.previousSibling;if(D&&D.tagName=="P"&&D.innerHTML=="&nbsp;"){D.parentNode.removeChild(D);}}I.selectNode(t);}}this.blockPreview.innerHTML=d[K];}}j.change(j.getValue());}};this.createPanelBody=function(u){c=document.body.appendChild(document.createElement("div"));c.className="editor_popup";c.style.display="none";var q=[],w=i(u);for(var t=0,s=w.length;t<s;t++){q.push('<a class="editor_panelcell editor_blockformat" rel="',w[t],'" href="javascript:;" onmouseup="apf.lookup(',this.$uniqueId,').submit(event);"><',w[t],">",d[w[t]],"</",w[t],"></a>");}c.innerHTML=q.join("");return c;};this.destroy=function(){c=j=this.blockPreview=this.node=null;delete c;delete j;delete this.blockPreview;delete this.node;};});apf.ContentEditable.plugin("hr",function(){this.name="hr";this.icon="hr";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";this.keyBinding="ctrl+h";this.state=apf.OFF;this.execute=function(a){if(apf.isGecko||apf.isIE){a.$insertHtml("<hr />",true);}else{a.$execCommand("InsertHorizontalRule");}a.dispatchEvent("pluginexecute",{name:this.name,plugin:this});};this.queryState=function(a){return this.state;};});apf.ContentEditable.plugin("table",function(){this.name="table";this.icon="table";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";this.keyBinding="ctrl+alt+shift+t";this.state=apf.OFF;var s,o,B,C,t,n,D,m=0,l=0,d=this;this.init=function(K,J){this.buttonNode.className=this.buttonNode.className+" dropdown_small";var I=this.buttonNode.insertBefore(document.createElement("span"),this.buttonNode.getElementsByTagName("div")[0]);I.className="selectarrow";};this.execute=function(I){if(!s){this.editor=I;D=I.useIframe?document:I.$activeDocument;apf.popup.setContent(this.$uniqueId,this.createPanelBody());}else{A();}I.dispatchEvent("pluginexecute",{name:this.name,plugin:this});this.editor.$showPopup(this,this.$uniqueId,this.buttonNode);window.setTimeout(function(){s.style.width=(o.offsetWidth+8)+"px";s.style.height=(o.offsetWidth+20)+"px";n=apf.getAbsolutePosition(C);});};this.queryState=function(I){return this.state;};this.submit=function(O){apf.popup.forceHide();if(O[0]<0||O[1]<0){return;}var M,K,J,I,N=['<table border="0" width="50%">'];for(M=0,K=O[0];M<K;M++){N.push("<tr>");for(J=0,I=O[1];J<I;J++){N.push("<td>",(apf.isIE?"":'&nbsp;<br _apf_placeholder="1" />'),"</td>");}N.push("</tr>");}N.push("</table>");this.editor.$insertHtml(N.join(""),true);this.editor.$selection.collapse(false);this.editor.$visualFocus();};var F=false,a,q,u;function G(I){F=true;a=I.client;q=u=0;document.onmousemove=function(J){if(!F){return;}J=new apf.AbstractEvent(J||window.event);if(J.client.x>n[0]+C.offsetWidth||J.client.y>n[1]+C.offsetHeight){w(J);}J.stop();return false;};document.onmouseup=function(J){J=new apf.AbstractEvent(J||window.event);E.call(d,J);J.stop();return false;};return false;}function E(I){if(F){F=false;a=document.onmousemove=document.onmouseup=null;q=u=0;}j.call(this,I);if(m>0&&l>0){this.submit([l,m]);}I.stop();return false;}function w(I){a=I.client;q=(Math.floor((a.x-n[0])/23)*23)+23;if(q>C.offsetWidth){s.style.width=(q+10)+"px";o.style.width=(q+4)+"px";C.style.width=(q)+"px";B.style.width=(q)+"px";}u=(Math.floor((a.y-n[1])/23)*23)+23;if(u>C.offsetHeight){s.style.height=(u+20)+"px";o.style.height=(u+4)+"px";C.style.height=(u)+"px";B.style.height=(u)+"px";}}function A(){o.style.width=o.style.height="164px";B.style.width=B.style.height="0px";C.style.width=C.style.height="160px";}var c="";function j(J){if(typeof n=="undefined"){return;}m=Math.ceil((J.page.x-n[0])/23);l=Math.ceil((J.page.y-n[1])/23);if(m>0&&l>0){B.style.width=Math.min((m*23),C.offsetWidth)+"px";B.style.height=Math.min((l*23),C.offsetHeight)+"px";var I=l+" x "+m+" "+d.editor.$translate("table_noun");if(c!=I){t.innerHTML=c=I;}}else{m=l=0;}}function i(I){if(F){return;}B.style.width=B.style.height="0px";m=l=0;t.innerHTML=c=d.editor.$translate("cancel");}function z(I){i.call(this,I);apf.popup.forceHide();}this.createPanelBody=function(){s=document.body.appendChild(document.createElement("div"));s.className="editor_popup editor_tablepopup";s.style.display="none";var M="editor_"+this.$uniqueId+"_tablecont";var K="editor_"+this.$uniqueId+"_tablesel";var J="editor_"+this.$uniqueId+"_table";var I="editor_"+this.$uniqueId+"_table_status";s.innerHTML='<div id="'+M+'" class="editor_paneltable_cont">                <div id="'+K+'" class="editor_paneltable_sel"></div>                <div id="'+J+'" class="editor_paneltable"></div>            </div>            <div id="'+I+'" class="editor_paneltablecancel">'+this.editor.$translate("cancel")+"</div>";o=document.getElementById(M);B=document.getElementById(K);C=document.getElementById(J);C.onmousedown=G.bindWithEvent(this);C.onmouseup=E.bindWithEvent(this);C.onmousemove=j.bindWithEvent(this);C.onmouseout=i.bindWithEvent(this);t=document.getElementById(I);t.onmousedown=z.bindWithEvent(this);s.onselectstart=function(){return false;};A();return s;};this.destroy=function(){s=o=B=C=t=n=D=null;delete s;delete o;delete B;delete C;delete t;delete n;delete D;};});apf.ContentEditable.plugin("tablewizard",function(){this.name="tablewizard";this.icon="tablewizard";this.type=apf.CONTEXTPANEL;this.hook="context";this.state=apf.OFF;this.oTable=null;this.oRow=null;this.oCell=null;var l,n,j=this;this.execute=function(q,s){if(this.queryState(q)!=apf.ON){return;}this.oTable=this.oRow=this.oCell=null;while(l.tagName!="TABLE"){if(l.tagName=="TD"){this.oCell=l;}else{if(l.tagName=="TR"){this.oRow=l;}}l=l.parentNode;}this.oTable=l;if(!this.editor){this.editor=q;}if(!apf.editor.oMenu){this.createContextMenu();}if(!n){n=q.useIframe?document:q.$activeDocument;}apf.editor.oMenu.tablePlugin=this;var t=apf.getAbsolutePosition(q.iframe);if(!s.client){s=new apf.AbstractEvent(s);}apf.editor.oMenu.display(s.client.x+t[0],s.client.y+t[1],true);s.stop();q.dispatchEvent("pluginexecute",{name:this.name,plugin:this});return false;};this.queryState=function(q){var s=q.$selection.getSelectedNode();while(s.nodeType!=1||s.tagName!="BODY"){if(s.tagName=="TABLE"||s.tagName=="TBODY"||s.tagName=="TR"||s.tagName=="TD"){l=s;return apf.ON;}s=s.parentNode;}return apf.OFF;};function o(t,z,w){t.rowSpan=1;var q=d(z,["TR"]);for(var u=1;u<w&&q;u++){var s=n.createElement("td");if(!apf.isIE){s.innerHTML='<br mce_bogus="1"/>';}if(apf.isIE){q.insertBefore(s,q.cells(t.cellIndex));}else{q.insertBefore(s,q.cells[t.cellIndex]);}q=d(q,["TR"]);}}function a(t){var s=t.getAttribute("colspan")||"";var q=t.getAttribute("rowspan")||"";return{colspan:s==""?1:parseInt(s),rowspan:q==""?1:parseInt(q)};}function c(C){var q=[],D=C.rows,A,z,t,u,B,s,w;for(z=0;z<D.length;z++){for(A=0;A<D[z].cells.length;A++){t=D[z].cells[A];u=a(t);for(B=A;q[z]&&q[z][B];B++){}for(w=z;w<z+u.rowspan;w++){if(!q[w]){q[w]=[];}for(s=B;s<B+u.colspan;s++){q[w][s]=t;}}}}return q;}function i(t,u){for(var s=0;s<t.length;s++){for(var q=0;q<t[s].length;q++){if(t[s][q]==u){return{cellindex:q,rowindex:s};}}}return null;}function m(s,t,q){if(s[t]&&s[t][q]){return s[t][q];}return null;}function d(s,t){while((s=s.nextSibling)!=null){for(var q=0;q<t.length;q++){if(s.nodeName.toLowerCase()==t[q].toLowerCase()){return s;}}}return null;}this.createContextMenu=function(){var s="editor_"+this.$uniqueId+"_menu";this.appendAmlNode('            <a:menu xmlns:a="'+apf.ns.aml+'" id="'+s+'">                <a:item value="rowbefore">Insert row before</a:item>                <a:item value="rowbefore">Insert row after</a:item>                <a:item value="deleterow">Delete row</a:item>                <a:divider />                <a:item value="colbefore">Insert column before</a:item>                <a:item value="colafter">Insert column after</a:item>                <a:item value="deletecol">Delete column</a:item>                <a:divider />                <a:item value="splitcells">Split merged table cells</a:item>                <a:item value="mergecells">Merge table cells</a:item>            </a:menu>',document.body);var q=apf.editor.oMenu=self[s];q.addEventListener("onitemclick",function(ah){if(this.tablePlugin!=j){return;}var T,af,ae,aj=0;if(j.oCell){for(af=0,ae=j.oRow.cells.length;af<ae;af++){if(j.oRow.cells[af]==j.oCell){aj=af;}}}j.editor.$selection.set();switch(ah.value){case"rowbefore":T=n.createElement("tr");j.oRow.parentNode.insertBefore(T,j.oRow);for(af=0,ae=j.oRow.cells.length;af<ae;af++){T.insertCell(0);}break;case"rowafter":T=n.createElement("tr");j.oRow.parentNode.insertBefore(T,j.oRow.nextSibling);for(af=0,ae=j.oRow.cells.length;af<ae;af++){T.insertCell(0);}break;case"deleterow":if(!j.oRow||!j.oRow.parentNode){return;}j.oRow.parentNode.removeChild(j.oRow);break;case"colbefore":if(!j.oCell){return;}for(af=0,ae=j.oTable.rows.length;af<ae;af++){j.oTable.rows[af].insertCell(aj);}break;case"colafter":if(!j.oCell){return;}aj+=1;for(af=0,ae=j.oTable.rows.length;af<ae;af++){j.oTable.rows[af].insertCell(aj);}break;case"deletecol":if(!j.oCell||j.oTable.rows[0].cells.length==1){return;}for(af=0,ae=j.oTable.rows.length;af<ae;af++){if(j.oTable.rows[af].cells[aj]){j.oTable.rows[af].deleteCell(aj);}}break;case"splitcells":if(!j.oRow||!j.oCell){return true;}var w=a(j.oCell);var F=w.colspan;var I=w.rowspan;if(F>1||I>1){j.oCol.colSpan=1;for(af=1;af<F;af++){var J=n.createElement("td");if(!apf.isIE){J.innerHTML='<br _apf_placeholder="1"/>';}j.oRow.insertBefore(J,d(j.oCell,["TD","TH"]));if(I>1){o(J,j.oRow,I);}}o(j.oCell,j.oRow,I);}break;case"mergecells":var ag=[],E=[],ac=j.editor.$selection.get(),Z=c(j.oTable),u,z,U,Y,W,ad;if(apf.isIE||ac.rangeCount==1){var V=1;var t=1;u=i(Z,j.oCell);z=j.oTable.rows;for(af=u.rowindex;af<Z.length;af++){U=[];for(ae=u.cellindex;ae<Z[af].length;ae++){W=m(Z,af,ae);if(W&&!ag.contains(W)&&!U.contains(W)){var O=i(Z,W);if(O.cellindex<u.cellindex+t&&O.rowindex<u.rowindex+V){U[U.length]=W;}}}if(U.length>0){ag[ag.length]=U;}W=m(Z,u.rowindex,u.cellindex);Y=W.getElementsByTagName("br");if(Y.length>1){for(ae=Y.length;ae>=1;ae--){if(Y[ae].getAttribute("_apf_placeholder")){Y[ae].parentNode.removeChild(Y[ae]);}}}}}else{var D=-1,al=-1,C,ak;if(ac.rangeCount<2){return true;}for(af=0;af<ac.rangeCount;af++){var ab=ac.getRangeAt(af);j.oCell=ab.startContainer.childNodes[ab.startOffset];if(!j.oCell){break;}if(j.oCell.nodeName=="TD"||j.oCell.nodeName=="TH"){E.push(j.oCell);}}z=j.oTable.rows;for(af=0;af<z.length;af++){U=[];for(ae=0;ae<z[af].cells.length;ae++){W=z[af].cells[ae];for(ad=0;ad<E.length;ad++){if(W!=E[ad]){continue;}U.push(W);}}if(U.length>0){ag.push(U);}}for(af=0;af<Z.length;af++){for(ae=0;ae<Z[af].length;ae++){Z[af][ae]._selected=false;for(ad=0;ad<E.length;ad++){if(Z[af][ae]!=E[ad]){continue;}if(D==-1){D=ae;al=af;}C=ae;ak=af;Z[af][ae]._selected=true;}}}for(af=al;af<=ak;af++){for(ae=D;ae<=C;ae++){if(!Z[af][ae]._selected){alert("Invalid selection for merge.");return true;}}}}var B=1,A=1;var G,R=-1;for(af=0;af<ag.length;af++){var K=0;for(ae=0,ad=ag[af].length;ae<ad;ae++){G=a(ag[af][ae]);K+=G.colspan;if(R!=-1&&G.rowspan!=R){alert("Invalid selection for merge.");return true;}R=G.rowspan;}if(K>A){A=K;}R=-1;}var Q=-1;for(ae=0;ae<ag[0].length;ae++){var N=0;for(af=0;af<ag.length;af++){G=a(ag[af][ae]);N+=G.rowspan;if(Q!=-1&&G.colspan!=Q){alert("Invalid selection for merge.");return true;}Q=G.colspan;}if(N>B){B=N;}Q=-1;}j.oCell=ag[0][0];j.oCell.rowSpan=B;j.oCell.colSpan=A;for(af=0;af<ag.length;af++){for(ae=0;ae<ag[af].length;ae++){var P=ag[af][ae].innerHTML;var M=P.replace(/[ \t\r\n]/g,"");if(M!="<br/>"&&M!='<br _apf_placeholder="1"/>'&&(ae+af>0)){j.oCell.innerHTML+=P;}if(ag[af][ae]==j.oCell&&ag[af][ae]._deleted){continue;}u=i(Z,ag[af][ae]);var ai=ag[af][ae].parentNode;ai.removeChild(ag[af][ae]);ag[af][ae]._deleted=true;if(ai.hasChildNodes()){continue;}ai.parentNode.removeChild(ai);var aa,X=null;for(ad=0;aa=m(Z,u.rowindex,ad);ad++){if(aa!=X&&aa.rowSpan>1){aa.rowSpan--;}X=aa;}if(j.oCell.rowSpan>1){j.oCell.rowSpan--;}}}Y=j.oCell.getElementsByTagName("br");if(Y.length>1){for(af=Y.length;af>=1;af--){if(Y[af]&&Y[af].getAttribute("_apf_placeholder")){Y[af].parentNode.removeChild(Y[af]);}}}break;}j.editor.change(j.editor.getValue());});};});apf.ContentEditable.plugin("help",function(){this.name="help";this.icon="help";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";this.keyBinding="ctrl+h";this.state=apf.OFF;this.execute=function(a){a.dispatchEvent("pluginexecute",{name:this.name,plugin:this});};this.queryState=function(a){return this.state;};});apf.ContentEditable.plugin("charmap",function(){this.name="charmap";this.icon="charmap";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";this.buttonNode=null;this.state=apf.OFF;this.colspan=20;var c;this.init=function(j,i){this.buttonNode.className=this.buttonNode.className+" dropdown_small";var d=this.buttonNode.insertBefore(document.createElement("span"),this.buttonNode.getElementsByTagName("div")[0]);d.className="selectarrow";};this.execute=function(d){if(!c){this.editor=d;apf.popup.setContent(this.$uniqueId,this.createPanelBody());}d.dispatchEvent("pluginexecute",{name:this.name,plugin:this});this.editor.$showPopup(this,this.$uniqueId,this.buttonNode,apf.isIE6?469:466,318);return{id:this.name,action:null};};this.queryState=function(){return this.state;};var a=["!","&#34;","#","$","%","&#38;","\\'","(",")","*","+","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";","&#60;","=","&#62;","?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~","&#161;","&#162;","&#163;","&#164;","&#165;","&#166;","&#167;","&#168;","&#169;","&#170;","&#171;","&#172;","&#174;","&#175;","&#176;","&#177;","&#178;","&#179;","&#180;","&#181;","&#182;","&#183;","&#184;","&#185;","&#186;","&#187;","&#188;","&#189;","&#190;","&#191;","&#192;","&#193;","&#194;","&#195;","&#196;","&#197;","&#198;","&#199;","&#200;","&#201;","&#202;","&#203;","&#204;","&#205;","&#206;","&#207;","&#208;","&#209;","&#210;","&#211;","&#212;","&#213;","&#214;","&#215;","&#216;","&#217;","&#218;","&#219;","&#220;","&#221;","&#222;","&#223;","&#224;","&#225;","&#226;","&#227;","&#228;","&#229;","&#230;","&#231;","&#232;","&#233;","&#234;","&#235;","&#236;","&#237;","&#238;","&#239;","&#241;","&#242;","&#243;","&#244;","&#245;","&#246;","&#247;","&#248;","&#249;","&#250;","&#251;","&#252;","&#253;","&#254;","&#255;","&#338;","&#339;","&#352;","&#353;","&#376;","&#402;","&#710;","&#732;","&#913;","&#914;","&#915;","&#916;","&#917;","&#918;","&#919;","&#920;","&#921;","&#922;","&#923;","&#924;","&#925;","&#926;","&#927;","&#928;","&#929;","&#931;","&#932;","&#933;","&#934;","&#935;","&#936;","&#937;","&#945;","&#946;","&#947;","&#948;","&#949;","&#950;","&#951;","&#952;","&#953;","&#954;","&#955;","&#956;","&#957;","&#958;","&#959;","&#960;","&#961;","&#962;","&#963;","&#964;","&#965;","&#966;","&#967;","&#968;","&#969;","&#977;","&#978;","&#982;","&#8201;","&#8211;","&#8212;","&#8216;","&#8217;","&#8218;","&#8220;","&#8221;","&#8222;","&#8224;","&#8225;","&#8226;","&#8230;","&#8240;","&#8242;","&#8243;","&#8249;","&#8250;","&#8254;","&#8260;","&#8364;","&#8465;","&#8472;","&#8476;","&#8482;","&#8501;","&#8592;","&#8593;","&#8594;","&#8595;","&#8596;","&#8629;","&#8656;","&#8657;","&#8658;","&#8659;","&#8660;","&#8704;","&#8706;","&#8707;","&#8709;","&#8711;","&#8712;","&#8713;","&#8715;","&#8719;","&#8721;","&#8722;","&#8727;","&#8730;","&#8733;","&#8734;","&#8736;","&#8743;","&#8744;","&#8745;","&#8746;","&#8747;","&#8756;","&#8764;","&#8773;","&#8776;","&#8800;","&#8801;","&#8804;","&#8805;","&#8834;","&#8835;","&#8836;","&#8838;","&#8839;","&#8853;","&#8855;","&#8869;","&#8901;","&#8968;","&#8969;","&#8970;","&#8971;","&#9001;","&#9002;","&#9674;","&#9824;","&#9827;","&#9829;","&#9830;"];this.submit=function(j){j=new apf.AbstractEvent(j||window.event);while(j.target.tagName.toLowerCase()!="a"&&j.target.className!="editor_popup"){j.target=j.target.parentNode;}var i=j.target.getAttribute("rel");if(i){apf.popup.forceHide();this.editor.$insertHtml(i,true);var d=this;$setTimeout(function(){d.editor.change(d.editor.getValue());});}};this.createPanelBody=function(){c=document.body.appendChild(document.createElement("div"));c.className="editor_popup";c.style.display="none";var d=[];var l=this.colspan-1;for(var j=0;j<a.length;j++){if(j%this.colspan==0){d.push('<div class="editor_panelrow">');}d.push('<a class="editor_panelcell editor_largecell" style="background-color:#',a[j],';" rel="',a[j],'" href="javascript:;" onmousedown="apf.lookup(',this.$uniqueId,').submit(event);">                <span>',a[j],"</span>                </a>");if(j%this.colspan==l){d.push("</div>");}}c.innerHTML=d.join("");return c;};this.destroy=function(){c=null;delete c;};});apf.ContentEditable.plugin("blockquote",function(){this.name="blockquote";this.icon="blockquote";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";this.keyBinding="ctrl+shift+b";this.buttonBuilt=false;this.state=apf.OFF;this.execute=function(a){a.$execCommand("FormatBlock","BLOCKQUOTE");a.dispatchEvent("pluginexecute",{name:this.name,plugin:this});};this.queryState=function(a){return a.$queryCommandState("FormatBlock");};});apf.ContentEditable.pasteDialog=function(c){this.name=c;this.icon=c=="pasteworddialog"?"pasteword":c;this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";this.keyBinding=c=="pastetext"?"ctrl+shift+v":"ctrl+shift+w";this.state=apf.OFF;var a;this.init=function(){this.buttonNode.className=this.buttonNode.className+" dropdown_small";this.buttonNode.insertBefore(document.createElement("span"),this.buttonNode.getElementsByTagName("div")[0]).className="selectarrow";};this.execute=function(i){if(!a){this.editor=i;apf.popup.setContent(this.$uniqueId,this.createPanelBody());}i.dispatchEvent("pluginexecute",{name:this.name,plugin:this});this.editor.$showPopup(this,this.$uniqueId,this.buttonNode,300,270);if(a.style.visibility=="hidden"){a.style.visibility="visible";}var d=this;$setTimeout(function(){d.oArea.focus();},100);return{id:this.name,action:null};};this.queryState=function(d){return this.state;};this.submit=function(i){apf.popup.forceHide();var d=this.oArea.value;if(!d||d.length==0){return;}if(this.name=="pastetext"){var j=["\u2122","<sup>TM</sup>","\u2026","...","\u201c|\u201d",'"',"\u2019,'","\u2013|\u2014|\u2015|\u2212","-"];d=d.replace(/\u2122/gi,"<sup>TM</sup>").replace(/\u2026/gi,"...").replace(/\u201c|\u201d/gi,'"').replace(/\u2019,'/gi,"'").replace(/\u2013|\u2014|\u2015|\u2212/gi,"-").replace(/\r\n/g,"<br />").replace(/\r/g,"<br />").replace(/\n/g,"<br />");}else{d=this.editor.$plugins.pasteword.parse(d);}this.editor.$insertHtml(d);if(i.stop){i.stop();}else{i.cancelBubble=true;}return false;};this.createPanelBody=function(){a=document.body.appendChild(document.createElement("div"));a.className="editor_popup";a.style.display="none";var i="editor_"+this.$uniqueId+"_input",d="editor_"+this.$uniqueId+"_btns";a.innerHTML='<label for="'+i+'">'+this.editor.$translate("paste_keyboardmsg").sprintf(apf.isMac?"CMD+V":"CTRL+V")+'</label>            <textarea id="'+i+'" name="'+i+'"  wrap="soft" dir="ltr"               cols="60" rows="10" class="editor_textarea"></textarea>            <div class="editor_panelrow" style="position:absolute;bottom:0;width:100%" id="'+d+'"></div>';this.oArea=document.getElementById(i);apf.sanitizeTextbox(this.oArea);if(apf.isIE){this.oArea.onselectstart=this.oArea.onpaste=function(j){j=j||window.event;j.cancelBubble=true;};}new apf.toolbar({htmlNode:document.getElementById(d),skinset:apf.getInheritedAttribute(this.editor.parentNode,"skinset"),childNodes:[new apf.bar({childNodes:[new apf.button({caption:this.editor.$translate("insert"),onclick:"apf.lookup("+this.$uniqueId+").submit(event)"})]})]});return a;};this.destroy=function(){a=this.oArea=null;delete a;delete this.oArea;};};apf.ContentEditable.plugin("pasteworddialog",apf.ContentEditable.pasteDialog);apf.ContentEditable.plugin("pastetext",apf.ContentEditable.pasteDialog);apf.ContentEditable.plugin("pasteword",function(){this.name="pasteword";this.icon="pasteword";this.type=apf.CMDMACRO;this.hook="onpaste";this.keyBinding="ctrl+shift+v";this.state=apf.OFF;this.parse=function(a){var d=String.fromCharCode(8226),c=String.fromCharCode(183);a=a.replace(new RegExp("<p class=MsoHeading.*?>(.*?)</p>","gi"),"<p><b>$1</b></p>").replace(new RegExp('tab-stops: list [0-9]+.0pt">',"gi"),'">--list--').replace(new RegExp(d+"(.*?)<BR>","gi"),"<p>"+c+"$1</p>").replace(new RegExp('<SPAN style="mso-list: Ignore">',"gi"),"<span>"+d).replace(new RegExp('<br style="page-break-before: always;.*>',"gi"),"-- page break --").replace(/<o:p>\s*<\/o:p>/g,"").replace(/<o:p>[\s\S]*?<\/o:p>/g,"&nbsp;").replace(/\s*mso-[^:]+:[^;"]+;?/gi,"").replace(/\s*MARGIN: 0(?:cm|in) 0(?:cm|in) 0pt\s*;/gi,"").replace(/\s*MARGIN: 0(?:cm|in) 0(?:cm|in) 0pt\s*"/gi,'"').replace(/\s*TEXT-INDENT: 0cm\s*;/gi,"").replace(/\s*TEXT-INDENT: 0cm\s*"/gi,'"').replace(/\s*TEXT-ALIGN: [^\s;]+;?"/gi,'"').replace(/\s*PAGE-BREAK-BEFORE: [^\s;]+;?"/gi,'"').replace(/\s*FONT-VARIANT: [^\s;]+;?"/gi,'"').replace(/\s*tab-stops:[^;"]*;?/gi,"").replace(/\s*tab-stops:[^"]*/gi,"").replace(/<(\w[^>]*) class=([^ |>]*)([^>]*)/gi,"<$1$3").replace(/-- page break --\s*<p>&nbsp;<\/p>/gi,"").replace(/-- page break --/gi,"").replace(/<\/p>/gi,"<br /><br />").replace(/<TABLE[^>]*cellPadding=[^>]*>/gi,'<table border="0">').replace(/<td[^>]*vAlign=[^>]*>/gi,"<td>");if(true){a=a.replace(/\s*face="[^"]*"/gi,"").replace(/\s*face=[^ >]*/gi,"").replace(/\s*FONT-FAMILY:[^;"]*;?/gi,"");}if(true){a=a.replace(/<(\w[^>]*) style="([^\"]*)"([^>]*)/gi,"<$1$3");}a=a.replace(/<STYLE[^>]*>[\s\S]*?<\/STYLE[^>]*>/gi,"").replace(/<(?:META|LINK)[^>]*>\s*/gi,"").replace(/\s*style="\s*"/gi,"").replace(/<SPAN\s*[^>]*>\s*&nbsp;\s*<\/SPAN>/gi,"&nbsp;").replace(/<SPAN\s*[^>]*><\/SPAN>/gi,"").replace(/<(\w[^>]*) lang=([^ |>]*)([^>]*)/gi,"<$1$3").replace(/<SPAN\s*>([\s\S]*?)<\/SPAN>/gi,"$1").replace(/<FONT\s*>([\s\S]*?)<\/FONT>/gi,"$1").replace(/<\\?\?xml[^>]*>/gi,"").replace(/<w:[^>]*>[\s\S]*?<\/w:[^>]*>/gi,"").replace(/<\/?\w+:[^>]*>/gi,"").replace(/<(U|I|STRIKE)>&nbsp;<\/\1>/g,"&nbsp;").replace(/<H\d>\s*<\/H\d>/gi,"").replace(/<(\w+)[^>]*\sstyle="[^"]*DISPLAY\s?:\s?none[\s\S]*?<\/\1>/ig,"").replace(/<(\w[^>]*) language=([^ |>]*)([^>]*)/gi,"<$1$3").replace(/<(\w[^>]*) onmouseover="([^\"]*)"([^>]*)/gi,"<$1$3").replace(/<(\w[^>]*) onmouseout="([^\"]*)"([^>]*)/gi,"<$1$3").replace(/<H(\d)([^>]*)>/gi,"<h$1>").replace(/<(H\d)><FONT[^>]*>([\s\S]*?)<\/FONT><\/\1>/gi,"<$1>$2</$1>").replace(/<(H\d)><EM>([\s\S]*?)<\/EM><\/\1>/gi,"<$1>$2</$1>");var i=document.createElement("div");i.innerHTML=a;while(this._convertMiddots(i,"--list--")){}while(this._convertMiddots(i,c,"unIndentedList")){}while(this._convertMiddots(i,d)){}a=i.innerHTML;return a.replace(/--list--/gi,"");};this._convertMiddots=function(a,w,l){var q=String.fromCharCode(183),o=String.fromCharCode(8226),c,j,m,d,n,u,t,s;c=a.getElementsByTagName("p");for(m=0;m<c.length;m++){d=c[m];if(d.innerHTML.indexOf(w)!=0){continue;}n=document.createElement("ul");if(l){n.className=l;}u=document.createElement("li");u.innerHTML=d.innerHTML.replace(new RegExp(""+q+"|"+o+"|--list--|&nbsp;","gi"),"");n.appendChild(u);t=d.nextSibling;while(t){if(t.nodeType==3&&new RegExp("^\\s$","m").test(t.nodeValue)){t=t.nextSibling;continue;}if(w==q){if(t.nodeType==1&&new RegExp("^o(\\s+|&nbsp;)").test(t.innerHTML)){if(!j){j=n;n=document.createElement("ul");j.appendChild(n);}t.innerHTML=t.innerHTML.replace(/^o/,"");}else{if(j){n=j;j=null;}if(t.nodeType!=1||t.innerHTML.indexOf(w)!=0){break;}}}else{if(t.nodeType!=1||t.innerHTML.indexOf(w)!=0){break;}}s=t.nextSibling;u=document.createElement("li");u.innerHTML=t.innerHTML.replace(new RegExp(""+q+"|"+o+"|--list--|&nbsp;","gi"),"");t.parentNode.removeChild(t);n.appendChild(u);t=s;}d.parentNode.replaceChild(n,d);return true;}return false;};});apf.ContentEditable.dateTimePlugin=function(a){this.name=a;this.icon=a;this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";this.keyBinding=a=="insertdate"?"ctrl+shift+d":"ctrl+shift+t";this.state=apf.OFF;this.i18n={date_format:"%Y-%m-%d",time_format:"%H:%M:%S",months_long:"January,February,March,April,May,June,July,August,September,October,November,December",months_short:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",days_long:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday",days_short:"Sun,Mon,Tue,Wed,Thu,Fri,Sat,Sun"};this.execute=function(i){if(typeof this.i18n.months_long=="string"){this.i18n.months_long=this.i18n.months_long.split(",");this.i18n.months_short=this.i18n.months_short.split(",");this.i18n.days_long=this.i18n.days_long.split(",");this.i18n.days_short=this.i18n.days_short.split(",");}var j=new Date();var c=(this.name=="insertdate")?this.i18n.date_format:this.i18n.time_format;c=c.replace("%D","%m/%d/%y").replace("%r","%I:%M:%S %p").replace("%Y",""+j.getFullYear()).replace("%y",""+j.getYear()).replace("%m",(""+j.getMonth()+1).pad(2,"0")).replace("%d",(""+j.getDate()).pad(2,"0")).replace("%H",(""+j.getHours()).pad(2,"0")).replace("%M",(""+j.getMinutes()).pad(2,"0")).replace("%S",(""+j.getSeconds()).pad(2,"0")).replace("%I",""+(j.getHours()+11)%12+1).replace("%p",""+(j.getHours()<12?"AM":"PM")).replace("%B",""+this.i18n.months_long[j.getMonth()]).replace("%b",""+this.i18n.months_short[j.getMonth()]).replace("%A",""+this.i18n.days_long[j.getDay()]).replace("%a",""+this.i18n.days_short[j.getDay()]).replace("%%","%");i.$insertHtml(c,true);i.dispatchEvent("pluginexecute",{name:this.name,plugin:this});};this.queryState=function(){return this.state;};};apf.ContentEditable.plugin("insertdate",apf.ContentEditable.dateTimePlugin);apf.ContentEditable.plugin("inserttime",apf.ContentEditable.dateTimePlugin);apf.ContentEditable.plugin("code",function(){this.name="code";this.icon="code";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";this.keyBinding="ctrl+shift+h";this.state=apf.OFF;this.noDisable=true;this.regex=null;var t,q,j={},n,A,i,u=this;this.execute=function(B){if(!n){this.drawPreview(B);}if(t.style.display=="none"){B.$selection.cache();this.update(B);B.$pluginsActive=this.name;B.setProperty("state",apf.DISABLED);this.setSize(B);t.style.display="";n.focus();}else{B.$pluginsActive=null;t.style.display="none";B.setProperty("state",apf.OFF);d();$setTimeout(function(){B.$selection.set();B.$visualFocus();});}B.$notifyButton("code",this.queryState(B));B.dispatchEvent("pluginexecute",{name:this.name,plugin:this});};this.update=function(B,C){if(z){i=C;return;}n.value=w.call(this,C?apf.htmlCleaner.parse(C):(i=B.getValue()));};this.getValue=function(){return n.value;};function d(){var B=apf.htmlCleaner.parse(n.value.replace(/<\/p>/gi,"</p><p></p>").replace(/\n/g,""));try{apf.getXml("<source>"+B.replace(/&.{3,5};/g,"")+"</source>");}catch(C){if(confirm("Er zit een fout in de html. Klik op OK om deze                          te corrigeren, of op Cancel om door te gaan")){return false;}}if(i==n.value||u.editor.$value.replace(/[\r\n]/g,"")==B.replace(/[\r\n]/g,"")){u.editor.$value="";u.editor.$propHandlers.value.call(u.editor,B);}else{u.editor.change(B);}return true;}var z=null;function c(){if(!u.editor.realtime||z!==null){return;}z=$setTimeout(function(){clearTimeout(z);u.editor.change(n.value);z=null;},200);}function m(C){C=C||window.event;var B=C.which||C.keyCode;if(!C.ctrlKey&&!C.altKey&&(B<112||B>122)&&(B==32||B>42||B==8||B==13)){c();}}this.drawPreview=function(C){this.editor=C;t=C.$getExternal("code",C.$ext);q=t.getElementsByTagName("div")[0];this.editor.$drawToolbars(q,"codetoolbar","apf.all["+this.$uniqueId+"].$buttonClick(event, this);",true);q.innerHTML=q.innerHTML;var E=q.getElementsByTagName("div");for(var D,B=E.length-1;B>=0;B--){D=E[B].getAttribute("type");if(!D){continue;}j[D]=E[B];apf.setStyleClass(E[B],"editor_enabled",["editor_selected","editor_disabled"]);E[B].disabled=false;}n=t.getElementsByTagName("textarea")[0];if(apf.isIE){n.onselectstart=function(F){F=F||window.event;F.cancelBubble=true;};}n.onkeydown=m;this.setSize(C);t.style.display="none";apf.sanitizeTextbox(n);};this.setSize=function(D){if(!n||!D){return;}var B=D.$ext.offsetWidth-2;var C=D.$ext.offsetHeight-D.oToolbar.offsetHeight-4;t.style.top=D.oToolbar.offsetHeight+"px";t.style.width=q.style.width=B+"px";n.style.width=B-(apf.isIE?2:0)+"px";t.style.height=C+(apf.isIE?2:3)+"px";n.style.height=C-(apf.isIE?26:24)+"px";};var a={bullist:["<ul>","</ul>"],numlist:["<ol>","</ol>"],listitem:["<li>","</li>"],nbsp:["&nbsp;",null],"break":["<br />",null],paragraph:["<p>","</p>"]};this.$buttonClick=function(D,C){apf.setStyleClass(C,"active");var B=C.getAttribute("type");if(a[B]){s.apply(this,a[B]);}this.editor.$visualFocus();n.focus();apf.setStyleClass(C,"",["active"]);};function s(D,E){if(!D){return;}var C,F,B;if(!E){if(apf.hasMsRangeObject){C=document.selection.createRange();C.collapse();C.text=D;C.moveEnd("character",D.length);C.collapse();if(apf.document.activeElement==this.editor){C.select();}}else{F=n.value;B=n.selectionEnd;n.selectionStart=B;n.value=F.substr(0,B)+D+F.substr(B);n.selectionStart=n.selectionEnd=B+D.length;}}else{if(apf.hasMsRangeObject){C=document.selection.createRange();F=C.text;C.text=D+F+E;C.moveStart("character",-(F.length+E.length));C.moveEnd("character",-E.length);if(apf.document.activeElement==this.editor){C.select();}}else{var G=n.selectionStart;F=n.value;B=n.selectionEnd;n.value=F.substr(0,G)+D+F.substr(G,B-G)+E+F.substr(B);n.selectionStart=G+D.length;n.selectionEnd=B+E.length-1;}}}function l(B,C,D,E){return C+"apf.___JPFpd___"+A.push(D)+E;}function w(I){if(!this.regex){o.call(this);}A=[];var F=I.replace(this.regex.protectedTags,l);F=F.replace(this.regex.blocksOpener,"\n$&").replace(this.regex.blocksCloser,"$&\n").replace(this.regex.newLineTags,"$&\n").replace(this.regex.mainTags,"\n$&\n");var E,D,G="",C=F.split(this.regex.lineSplitter);F="";for(E=0,D=C.length;E<D;E++){var J=C[E];if(J.length==0){continue;}if(this.regex.decreaseIndent.test(J)){G=G.replace(this.regex.formatIndentatorRemove,"");}F+=G+J+"\n";if(this.regex.increaseIndent.test(J)){G+="    ";}}for(E=0,D=A.length;E<D;E++){var B=new RegExp("apf.___JPFpd___"+E);F=F.replace(B,A[E].replace(/\$/g,"$$$$"));}return F.trim();}function o(){this.regex={blocksOpener:/\<(P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|TITLE|META|LINK|BASE|SCRIPT|LINK|TD|TH|AREA|OPTION)[^\>]*\>/gi,blocksCloser:/\<\/(P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|TITLE|META|LINK|BASE|SCRIPT|LINK|TD|TH|AREA|OPTION)[^\>]*\>/gi,newLineTags:/\<(BR|HR)[^\>]*\>/gi,mainTags:/\<\/?(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR)[^\>]*\>/gi,lineSplitter:/\s*\n+\s*/g,increaseIndent:/^\<(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR|UL|OL)[ \/\>]/i,decreaseIndent:/^\<\/(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR|UL|OL)[ \>]/i,protectedTags:/(<PRE[^>]*>)([\s\S]*?)(<\/PRE>)/gi,formatIndentatorRemove:/^    /};}this.queryState=function(B){if(B.$pluginsActive==this.name){return apf.SELECTED;}return apf.OFF;};this.destroy=function(){n=this.regex=null;delete n;delete this.regex;};});apf.ContentEditable.colorPlugin=function(j){this.name=j;this.icon=j;this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";this.buttonNode=null;this.state=apf.OFF;this.colspan=18;var d;var l=["00","33","66","99","CC","FF"];function a(){apf.ContentEditable.colorPlugin.palette=[];var q,o,m,n;for(q=0;q<l.length;q++){for(o=0;o<l.length;o++){n=(q%3)*6+o;for(m=0;m<l.length;m++){if(!apf.ContentEditable.colorPlugin.palette[n]){apf.ContentEditable.colorPlugin.palette[n]=[];}apf.ContentEditable.colorPlugin.palette[n][(q<3?0:6)+m]={red:l[q],green:l[o],blue:l[m]};}}}}function c(q){if(typeof q=="string"&&q.length>0){var o=[];var n=q.charAt(0);var m=q.charAt(4);o[0]=m;o[4]=n;n=q.charAt(1);m=q.charAt(5);o[1]=m;o[5]=n;return o[0]+o[1]+q.charAt(2)+q.charAt(3)+o[4]+o[5];}return q;}function i(n){var m=(n&16777215).toString(16);return("000000").substring(0,6-m.length)+m;}this.init=function(q,o){this.buttonNode.className=this.buttonNode.className+" dropdown_small";var n=this.buttonNode.getElementsByTagName("div")[0];this.colorPreview=this.buttonNode.insertBefore(document.createElement("div"),n);this.colorPreview.className="colorpreview";var m=this.buttonNode.insertBefore(document.createElement("span"),n);m.className="selectarrow";};this.execute=function(m){if(!d){this.editor=m;apf.popup.setContent(this.$uniqueId,this.createPanelBody());}m.dispatchEvent("pluginexecute",{name:this.name,plugin:this});this.editor.$showPopup(this,this.$uniqueId,this.buttonNode,apf.isIE6?296:292,167);return{id:this.name,action:null};};this.setStyleMethod=function(m){if(typeof m=="undefined"){m=true;}try{this.editor.$activeDocument.execCommand("styleWithCSS",false,m);}catch(n){this.editor.$activeDocument.execCommand("useCSS",false,!m);}};this.queryState=function(q){var n=this.name=="forecolor"?"ForeColor":apf.isIE?"BackColor":"HiliteColor";this.state=q.$queryCommandState(n);var m="";try{m=q.$queryCommandValue(n);}catch(o){}if(apf.isIE){m="#"+c(i(m));}if(m!=this.colorPreview.style.backgroundColor){this.colorPreview.style.backgroundColor=m;}};this.submit=function(n){n=new apf.AbstractEvent(n||window.event);while(n.target.tagName.toLowerCase()!="a"&&n.target.className!="editor_popup"){n.target=n.target.parentNode;}var m=n.target.getAttribute("rel");if(m){apf.popup.forceHide();this.editor.$execCommand(this.name=="forecolor"?"ForeColor":apf.isIE?"BackColor":"HiliteColor","#"+m);}};this.createPanelBody=function(){if(!apf.ContentEditable.colorPlugin.palette){a();}d=document.body.appendChild(document.createElement("div"));d.className="editor_popup";d.style.display="none";var m=[];var s,q,o,n=apf.ContentEditable.colorPlugin.palette;for(s=0;s<n[0].length;s++){m.push('<div class="editor_panelrow">');for(q=0;q<n.length;q++){o=n[q][s].red+n[q][s].green+n[q][s].blue;m.push('<a class="editor_smallcell editor_panelcell" style="background-color:#',o,';" rel="',o,'" href="javascript:;" onmousedown="apf.lookup(',this.$uniqueId,').submit(event);">                    &nbsp;</a>');}m.push("</div>");}d.innerHTML=m.join("");return d;};this.destroy=function(){d=this.colorPreview=null;delete d;delete this.colorPreview;};};apf.ContentEditable.colorPlugin.palette=null;apf.ContentEditable.plugin("forecolor",apf.ContentEditable.colorPlugin);apf.ContentEditable.plugin("backcolor",apf.ContentEditable.colorPlugin);apf.ContentEditable.plugin("print",function(){this.name="print";this.icon="print";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";this.keyBinding="ctrl+p";this.state=apf.OFF;this.execute=function(a){if(apf.print){apf.print(a.getValue());}a.dispatchEvent("pluginexecute",{name:this.name,plugin:this});};this.queryState=function(){return this.state;};});apf.ContentEditable.plugin("preview",function(){this.name="preview";this.icon="preview";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";this.keyBinding="ctrl+shift+p";this.state=apf.OFF;this.execute=function(a){if(apf.printer){apf.printer.preview(a.getValue());}a.dispatchEvent("pluginexecute",{name:this.name,plugin:this});};this.queryState=function(){return this.state;};});apf.ContentEditable.plugin("anchor",function(){this.name="anchor";this.icon="anchor";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";this.keyBinding="ctrl+shift+a";this.state=apf.OFF;this.editor=null;var a;this.init=function(i,d){this.editor=i;this.buttonNode.className=this.buttonNode.className+" dropdown_small";var c=this.buttonNode.insertBefore(document.createElement("span"),this.buttonNode.getElementsByTagName("div")[0]);c.className="selectarrow";};this.execute=function(d){if(!a){this.editor=d;apf.popup.setContent(this.$uniqueId,this.createPanelBody());}this.editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});this.editor.$showPopup(this,this.$uniqueId,this.buttonNode,218,47);if(a.style.visibility=="hidden"){a.style.visibility="visible";}var c=this;$setTimeout(function(){c.oName.focus();});return{id:this.name,action:null};};this.queryState=function(){var c=this.editor.$selection.getSelectedNode();if(c.tagName=="A"&&c.getAttribute("name")){return apf.ON;}return this.state;};this.submit=function(c){apf.popup.forceHide();if(!this.oName.value){return;}this.editor.$insertHtml('<a name="'+this.oName.value+'" class="itemAnchor" />');this.editor.$selection.collapse(false);};this.createPanelBody=function(){a=document.body.appendChild(document.createElement("div"));a.className="editor_popup";a.style.display="none";var c="editor_"+this.$uniqueId+"_anchor_url",d="editor_"+this.$uniqueId+"_anchor_button";a.innerHTML='<div class="editor_panelrow editor_panelrowinput">                <label for="'+c+'">Anchor name</label>                <input type="text" id="'+c+'" name="'+c+'" class="editor_input" value="" />            </div>            <div id="'+d+'" class="editor_panelrow editor_panelrowbtns"></div>';new apf.toolbar({htmlNode:document.getElementById(d),skinset:apf.getInheritedAttribute(this.editor.parentNode,"skinset"),childNodes:[new apf.bar({childNodes:[new apf.button({caption:this.editor.$translate("insert"),onclick:"apf.lookup("+this.$uniqueId+").submit(event)"})]})]});this.oName=document.getElementById(c);apf.sanitizeTextbox(this.oName);return a;};this.destroy=function(){a=this.editor=this.oName=null;delete a;delete this.editor;delete this.oName;};});apf.ContentEditable.plugin("scayt",function(){this.name="scayt";this.icon="scayt";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";this.keyBinding="ctrl+h";this.state=apf.OFF;this.execute=function(a){apf.oHttp.get(function(){},{});a.dispatchEvent("pluginexecute",{name:this.name,plugin:this});};this.queryState=function(a){return this.state;};});apf.ContentEditable.searchPlugin=function(c){this.name=c;this.icon=c;this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";this.keyBinding=this.name=="search"?"ctrl+f":"ctrl+shift+f";this.state=apf.OFF;var a;this.init=function(j,i){this.buttonNode.className=this.buttonNode.className+" dropdown_small";var d=this.buttonNode.insertBefore(document.createElement("span"),this.buttonNode.getElementsByTagName("div")[0]);d.className="selectarrow";};this.execute=function(i){if(!a){this.editor=i;apf.popup.setContent(this.$uniqueId,this.createPanelBody());}i.dispatchEvent("pluginexecute",{name:this.name,plugin:this});this.editor.$showPopup(this,this.$uniqueId,this.buttonNode,218,this.name=="search"?71:95);this.oSearch.value=this.editor.$selection.getContent();var d=this;$setTimeout(function(){d.oSearch.focus();});return{id:this.name,action:null};};this.queryState=function(d){return this.state;};this.submit=function(o){var q=this.oSearch.value,i=this.oCase.checked,j=0;if(!q){return;}if(apf.isIE){this.editor.$selection.set();}this.editor.$selection.collapse(false);this.editor.$visualFocus();if(i){j=j|4;}var n=false;if(apf.isIE){var m=this.editor.$selection;var l=m.getRange();if(!(n=l.findText(q,1,j))){this.editor.$activeDocument.execCommand("SelectAll");m.collapse(true);l=m.getRange();n=l.findText(q,1,j);}if(n){l.scrollIntoView();l.select();}m.cache();}else{if(this.editor.oWin.find(q,i,false,true,false,false,false)){n=true;}}if(this.oReplBtn){this.oReplBtn[!n?"disable":"enable"]();}if(!n){if(this.oReplBtn){this.oReplBtn.disable();}alert("No occurences found for '"+q+"'");}else{if(this.oReplBtn){this.oReplBtn.enable();}}if(o.stop){o.stop();}else{o.cancelBubble=true;}if(!apf.isIE){var d=this;$setTimeout(function(){d.oSearch.focus();});}return false;};this.onDoReplClick=function(d){this.replace();};this.onReplAllClick=function(n){var o=this.oSearch.value,d=this.oCase.checked,i=0,l=this.editor;if(!o){return;}this.editor.$execCommand("SelectAll");this.editor.$selection.collapse(true);this.editor.$visualFocus();var j=this.editor.$selection.getRange(),m=0;if(d){i=i|4;}if(apf.isIE){while(j.findText(o,1,i)){j.scrollIntoView();j.select();this.replace();m++;}this.editor.$selection.cache();}else{while(this.editor.oWin.find(o,d,false,false,false,false,false)){this.replace();m++;}}if(m>0){alert(m+" occurences found and replaced with '"+this.oReplace.value+"'");}else{alert("No occurences found for '"+o+"'");}};this.replace=function(){var d=this.oReplace.value;if(apf.isIE){this.editor.$selection.getRange().duplicate().pasteHTML(d);}else{this.editor.$activeDocument.execCommand("InsertHTML",false,d);}};this.createPanelBody=function(){a=document.body.appendChild(document.createElement("div"));a.className="editor_popup";a.style.display="none";var j="editor_"+this.$uniqueId+"_input",i="editor_"+this.$uniqueId+"_replace",d="editor_"+this.$uniqueId+"_case",m="editor_"+this.$uniqueId+"_btns";a.innerHTML='<div class="editor_panelrow editor_panelrowinput">                <label for="'+j+'">Find what</label>                <textarea type="text" id="'+j+'" class="editor_input" name="'+j+'" value="">                </textarea>            </div>'+(this.name=="replace"?'<div class="editor_panelrow editor_panelrowinput">                <label for="'+i+'">Replace with</label>                <input type="text" id="'+i+'" class="editor_input" name="'+i+'" value="" />            </div>':"")+'<div class="editor_panelrow editor_panelrowinput">                <label for="'+d+'">Match case</label>                <input type="checkbox" id="'+d+'" name="'+d+'" class="editor_checkbox" value="" />            </div>            <div id="'+m+'" class="editor_panelrow editor_panelrowbtns"></div>';this.oSearch=document.getElementById(j);this.oCase=document.getElementById(d);new apf.toolbar({htmlNode:document.getElementById(m),skinset:apf.getInheritedAttribute(this.editor.parentNode,"skinset"),childNodes:[new apf.bar({childNodes:this.name=="search"?[new apf.button({caption:this.editor.$translate("findnext"),onclick:"apf.lookup("+this.$uniqueId+").submit(event)"})]:[new apf.button({caption:this.editor.$translate("findnext"),onclick:"apf.lookup("+this.$uniqueId+").submit(event)"}),(this.oReplBtn=new apf.button({caption:this.editor.$translate("doreplace"),onclick:"apf.lookup("+this.$uniqueId+").onDoReplClick(event)"})),(this.oReplAllBtn=new apf.button({caption:this.editor.$translate("replaceall"),onclick:"apf.lookup("+this.$uniqueId+").onReplAllClick(event)"}))]})]});if(this.name=="replace"){this.oReplace=document.getElementById(i);this.oReplBtn.disable();}if(apf.hasFocusBug){var l=function(n){n=n||window.event;n.cancelBubble=true;};apf.sanitizeTextbox(this.oSearch);this.oSearch.onselectstart=l;if(this.oReplace){apf.sanitizeTextbox(this.oReplace);this.oReplace.onselectstart=l;}apf.sanitizeTextbox(this.oCase);}return a;};this.destroy=function(){a=this.oSearch=this.oCase=null;delete a;delete this.oSearch;delete this.oCase;if(this.oReplace){this.oReplace=this.oReplBtn=this.oReplAllBtn=null;delete this.oReplace;delete this.oReplBtn;delete this.oReplAllBtn;}};};apf.ContentEditable.plugin("search",apf.ContentEditable.searchPlugin);apf.ContentEditable.plugin("replace",apf.ContentEditable.searchPlugin);apf.ContentEditable.plugin("emotions",function(){this.name="emotions";this.icon="emotions";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";this.buttonNode=null;this.state=apf.OFF;this.colspan=4;this.emotions=[];var a;this.init=function(i,d){this.buttonNode.className=this.buttonNode.className+" dropdown_small";var c=this.buttonNode.insertBefore(document.createElement("span"),this.buttonNode.getElementsByTagName("div")[0]);c.className="selectarrow";};this.execute=function(d){if(!a){this.editor=d;this.emotionsPath=d.$getPluginOption("emotions","path");var c,j,l=d.$getPluginOption("emotions");for(c=0;c<l.childNodes.length;c++){j=l.childNodes[c];if(j.nodeType==3||j.nodeType==4){this.emotions=j.nodeValue.splitSafe(",");}}apf.popup.setContent(this.$uniqueId,this.createPanelBody());}d.dispatchEvent("pluginexecute",{name:this.name,plugin:this});this.editor.$showPopup(this,this.$uniqueId,this.buttonNode,123,110);return{id:this.name,action:null};};this.queryState=function(){return this.state;};this.submit=function(d){d=new apf.AbstractEvent(d||window.event);this.editor.$visualFocus();var c=d.target.getAttribute("rel");if(!c||c==null){c=d.target.parentNode.getAttribute("rel");}if(!c){return;}apf.popup.forceHide();this.editor.$insertHtml('<img src="'+this.emotionsPath+"/smiley-"+c+'.gif" alt="" border="0" />',true);};this.createPanelBody=function(){a=document.body.appendChild(document.createElement("div"));a.className="editor_popup";a.style.display="none";var c=[];var j=this.emotions;var m=this.emotionsPath;var l=this.colspan-1;for(var d=0;d<j.length;d++){if(d%this.colspan==0){c.push('<div class="editor_panelrow">');}c.push('<a class="editor_panelcell editor_largestcell" rel="',j[d],'" href="javascript:;" onmousedown="apf.lookup(',this.$uniqueId,').submit(event);">                <img border="0" src="',m,"/smiley-",j[d],'.gif" />                </a>');if(d%this.colspan==l){c.push("</div>");}}a.innerHTML=c.join("");return a;};this.destroy=function(){a=null;delete a;};});apf.ContentEditable.directionPlugin=function(a){this.name=a;this.icon=a;this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";this.state=apf.OFF;this.execute=function(c){c.dispatchEvent("pluginexecute",{name:this.name,plugin:this});};this.queryState=function(c){return this.state;};};apf.ContentEditable.plugin("ltr",apf.ContentEditable.directionPlugin);apf.ContentEditable.plugin("rtl",apf.ContentEditable.directionPlugin);apf.ContentEditable.plugin("image",function(){this.name="image";this.icon="image";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";this.keyBinding="ctrl+alt+i";this.state=apf.OFF;var a;this.init=function(d){this.buttonNode.className=this.buttonNode.className+" dropdown_small";var c=this.buttonNode.insertBefore(document.createElement("span"),this.buttonNode.getElementsByTagName("div")[0]);c.className="selectarrow";};this.execute=function(d){if(!a){this.editor=d;apf.popup.setContent(this.$uniqueId,this.createPanelBody());}d.dispatchEvent("pluginexecute",{name:this.name,plugin:this});this.editor.$showPopup(this,this.$uniqueId,this.buttonNode,218,47);var c=this;$setTimeout(function(){c.oUrl.focus();});return{id:this.name,action:null};};this.queryState=function(c){return this.state;};this.submit=function(i){var c=this.oUrl.value;if(c){apf.popup.forceHide();var d=new apf.url(c);if(!d.protocol||!d.host||!d.file){alert("Please enter a valid URL");}else{this.editor.$insertHtml('<img src="'+c+'" border="0" />',true);}}};this.createPanelBody=function(){a=document.body.appendChild(document.createElement("div"));a.className="editor_popup";a.style.display="none";var d="editor_"+this.$uniqueId+"_input";var c="editor_"+this.$uniqueId+"_btns";a.innerHTML='<div class="editor_panelrow editor_panelrowinput">                <label for="'+d+'">Image URL</label>                <input type="text" id="'+d+'" class="editor_input" name="'+d+'" value="" />            </div>            <div id="'+c+'" class="editor_panelrow editor_panelrowbtns"></div>';this.oUrl=document.getElementById(d);this.appendAmlNode('<a:toolbar xmlns:a="'+apf.ns.aml+'"><a:bar>             <a:button caption="Insert"               onclick="apf.lookup('+this.$uniqueId+').submit(event)" />             </a:bar></a:toolbar>',document.getElementById(c));if(apf.hasFocusBug){apf.sanitizeTextbox(this.oUrl);this.oUrl.onselectstart=function(i){i=i||window.event;i.cancelBubble=true;};}return a;};this.destroy=function(){a=this.oUrl=null;delete a;delete this.oUrl;};});apf.ContentEditable.plugin("imagespecial",function(){this.name="imagespecial";this.icon="image";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";this.keyBinding="ctrl+alt+j";this.state=apf.OFF;var a;this.execute=function(d){if(!a){var c=(d.getAttribute("imagewindow")||"").trim();if(c){a=self[c];}}if(a&&a.show){a.show();}d.dispatchEvent("pluginexecute",{name:this.name,plugin:this});};this.queryState=function(c){return this.state;};});apf.ContentEditable.plugin("visualaid",function(){this.name="visualaid";this.icon="visualaid";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";this.keyBinding="ctrl+shift+v";this.state=apf.OFF;this.execute=function(a){var c=this.queryState(a);a.$activeDocument.body.className=(c==apf.ON)?"":"visualAid";a.$notifyButton(this.name);apf.dispatchEvent("pluginexecute",{name:this.name,plugin:this});};this.queryState=function(a){this.state=apf[a.$activeDocument.body.className=="visualAid"?"ON":"OFF"];return this.state;};});apf.__CHILDVALUE__=1<<27;apf.ChildValue=function(){if(!this.$childProperty){this.$childProperty="value";}this.$regbase=this.$regbase|apf.__CHILDVALUE__;var a;this.addEventListener("DOMCharacterDataModified",a=function(i){if(i.currentTarget==this){return;}var c=this.serialize().match(/^[\s\S]*?>([\s\S]*)<[\s\S]*?$/),d=c&&c[1]||"";if(d.indexOf("{")>-1||d.indexOf("[")>-1){this.$setDynamicProperty(this.$childProperty,d);}else{this.setProperty(this.$childProperty,d);}});this.addEventListener("DOMNodeInserted",a);this.addEventListener("DOMNodeRemoved",a);this.addEventListener("DOMNodeInsertedIntoDocument",function(i){if(!this.getElementsByTagNameNS(this.namespaceURI,"*").length&&(this.childNodes.length>1||this.firstChild&&(this.firstChild.nodeType==1||this.firstChild.nodeType!=7&&this.firstChild.nodeValue.trim().length))){var c=(this.$aml&&this.$aml.xml||this.serialize()).match(/^[\s\S]*?>([\s\S]*)<[\s\S]*?$/),d=c&&c[1]||"";if(d.indexOf("{")>-1||d.indexOf("[")>-1){this.$setDynamicProperty(this.$childProperty,d);}else{this.setProperty(this.$childProperty,d);}}else{if(typeof this[this.$childProperty]=="undefined"){this.$propHandlers[this.$childProperty].call(this,"");}}});};apf.__DATAACTION__=1<<25;apf.DataAction=function(){this.$regbase=this.$regbase|apf.__DATAACTION__;this.getActionTracker=function(i){if(!apf.AmlNode){return apf.window.$at;}var c=this,d=i?null:this.$at;if(!d&&this.dataParent){d=this.dataParent.parent.$at;}while(!d){if(!c.parentNode){var a;return(a=this.getModel&&this.getModel(true))&&a.$at||apf.window.$at;}d=(c=c.parentNode).$at;}return d;};this.$lock={};this.$actionsLog={};this.$actions=false;this.$startAction=function(i,l,n){if(this.disabled||this.contenteditable&&i!="edit"){return false;}var j=this.$actions&&this.$actions.getRule(i,l);if(!j&&apf.config.autoDisableActions&&this.$actions){return false;}var c=typeof apf.offline!="undefined";if(c&&!apf.offline.canTransact()){return false;}if(this.dispatchEvent(i+"start",{xmlContext:l})===false){return false;}if(this.$lock[i]&&!this.$lock[i].stopped){this.$stopAction();}var m=j?j.lock:null;if((c&&(!apf.offline.enabled||!apf.offline.onLine))&&m){var d=this.$lock[i]={start:c&&!apf.offline.onLine?apf.offline.offlineTime:new Date().getTime(),stopped:false,xmlContext:l,instr:m,rollback:n},a=this;apf.saveData(m,{xmlNode:l,unlock:false,callback:function(s,q,o){if(q==apf.TIMEOUT&&o.retries<apf.maxHttpRetries){return o.tpModule.retry(o.id);}if(q==apf.SUCCESS){a.dispatchEvent("locksuccess",apf.extend({state:o.http.status,bubbles:true},o));d.retrieved=true;if(d.stopped){a.$stopAction(i,true,d);}}else{if(d.stopped){return;}n.call(a,l);a.dispatchEvent("lockfailed",apf.extend({state:o.http.status,bubbles:true},o));}}});}this.$actionsLog[i]=l;return true;};this.addEventListener("xmlupdate",function(c){if(apf.xmldb.disableRSB!=2){return;}for(var a in this.$actionsLog){if(apf.isChildOf(this.$actionsLog[a],c.xmlNode,true)){this.$actionsLog[a].rollback.call(this,this.$actionsLog[a].xmlContext);}}});this.$stopAction=function(d,i,c){delete this.$actionsLog[d];if(!c){c=this.$lock[d];}if(c&&!c.stopped){c.stopped=true;if(i&&c.retrieved){var a=this;apf.saveData(c.instr,{xmlNode:c.xmlContext,unlock:true,callback:function(m,l,j){if(l==apf.TIMEOUT&&j.retries<apf.maxHttpRetries){return j.tpModule.retry(j.id);}a.dispatchEvent((l==apf.SUCCESS?"unlocksuccess":"unlockfailed"),apf.extend({state:j.http.status,bubbles:true},j));}});}}return c;};this.$executeAction=function(t,j,c,q,l,d,u){if(this.disabled||this.contenteditable&&c!="edit"){return;}if(typeof apf.offline!="undefined"&&!apf.offline.canTransact()){return false;}var n=this.$actions&&this.$actions.getRule(c,q);if(!n&&this.$actions&&apf.config.autoDisableActions&&"action|change".indexOf(c)==-1){apf.console.warn("Could not execute action '"+c+"'.               No valid action rule was found and auto-disable-actions is enabled");return false;}var s=this.$stopAction(c);var o;if(u){o=[];for(var a=u.length-1;a>=0;a--){o.unshift({xmlActionNode:n&&n[4],amlNode:this,selNode:u[a],xmlNode:u[a]});}}var m=new apf.AmlEvent("before"+c.toLowerCase(),{action:t,args:j,xmlActionNode:n,amlNode:this,selNode:d,multiple:o||false,timestamp:s?s.start:new Date().getTime()});if(!l){if(this.dispatchEvent(m.name,null,m)===false){return false;}}var i=this.getActionTracker().execute(m);m.xmlNode=i.xmlNode;m.undoObj=i;if(!l){m.name="after"+c.toLowerCase();m.cancelBubble=false;delete m.returnValue;this.dispatchEvent(m.name,null,m);}return i;};this.$executeSingleValue=function(a,o,w,u){var n,q,t=this.$getBindRule(o,w);var s=t.cvalue||t.cmatch;var z,c=s.xpaths,j=false;if(c[0]=="#"||c[1]=="#"){var i=(t.cvalue3||(t.cvalue3=apf.lm.compile(t.value,{xpathmode:5})))(w);var l=i.model&&i.model.nodeFunc&&i.model;if(l){var d=l.queryNode(i.xpath);w=l.data;}else{l=apf.xmldb.findModel(i.model);var d=i.model.selectSingleNode(i.xpath);w=i.model;}c[1]=i.xpath;}else{var l=c[0]&&apf.nameserver.get("model",c[0])||this.$model,d=l?l.queryNode(c[1]):(w||this.xmlRoot).selectSingleNode(c[1]);}if(d){if(apf.queryValue(d)==u){return;}z=(d.nodeType==1||d.nodeType==3||d.nodeType==4)?"setTextNode":"setAttribute";q=(d.nodeType==1)?[d,u]:(d.nodeType==3||d.nodeType==4?[d.parentNode,u]:[d.ownerElement||d.selectSingleNode(".."),d.nodeName,u]);}else{if(!this.$createModel){return false;}z="setValueByXpath";n=c[1];if(!w){if(!l){l=this.getModel();}if(l){if(!l.data){l.load("<data />");}n=(l.getXpathByAmlNode(this)||".")+(n&&n!="."?"/"+n:"");w=l.data;}else{if(!this.dataParent){return false;}w=this.dataParent.parent.selected||this.dataParent.parent.xmlRoot;if(!w){return false;}n=(this.dataParent.xpath||".")+(n&&n!="."?"/"+n:"");j=true;}}q=[w,u,n];}this.$executeAction(z,q,a,w);if(j){this.load(w.selectSingleNode(n));}};this.change=function(d,c){if(this.errBox&&this.errBox.visible&&this.isValid&&this.isValid()){this.clearError();}if(!this.xmlRoot&&!this.$createModel||!(this.$mainBind=="value"&&this.hasFeature(apf.__MULTISELECT__)?this.$attrBindings.value:this.$hasBindRule(this.$mainBind))){if(!c&&d===this.value||this.dispatchEvent("beforechange",{value:d})===false){return false;}this.setProperty("value",d);return this.dispatchEvent("afterchange",{value:d});}var a=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";if(d==(a!="value"&&(this.xmlRoot&&this.$applyBindRule("value",this.xmlRoot,null,true))||this.value)){return false;}this.$executeSingleValue("change",this.$mainBind,this.xmlRoot,d);};this.$booleanProperties["render-root"]=true;this.$supportedProperties.push("create-model","actions");this.$propHandlers["create-model"]=function(a){this.$createModel=a;};this.addEventListener("DOMNodeInsertedIntoDocument",function(a){if(typeof this["create-model"]=="undefined"&&!this.$setInheritedAttribute("create-model")){this.$createModel=true;}});};apf.config.$inheritProperties["create-model"]=1;apf.__CACHE__=1<<2;apf.Cache=function(){this.cache={};this.subTreeCacheContext=null;this.caching=true;this.$regbase=this.$regbase|apf.__CACHE__;this.addEventListener("$load",function(j){if(!this.caching||j.forceNoCache){return;}if(!this.cacheId){this.cacheId=j.xmlNode.getAttribute(apf.xmldb.xmlIdTag)||apf.xmldb.nodeConnect(apf.xmldb.getXmlDocId(j.xmlNode),j.xmlNode);}var i=c.call(this,this.cacheId,j.xmlNode);if(i){if(i==-1){return false;}var d=this.getTraverseNodes();if(d.length&&this.autoselect){this.select(d[0],null,null,null,true);}else{this.clearSelection();}if(!d.length){this.$removeClearMessage();this.$setClearMessage(this["empty-message"],"empty");}if(d.length!=this.length){this.setProperty("length",d.length);}return false;}});this.addEventListener("$clear",function(){if(!this.caching){return;}if(this.hasFeature(apf.__MULTISELECT__)&&this.subTreeCacheContext&&this.subTreeCacheContext.oHtml){if(this.renderRoot){this.subTreeCacheContext.parentNode.insertBefore(this.subTreeCacheContext.oHtml,this.subTreeCacheContext.beforeNode);}else{while(this.$int.childNodes.length){this.subTreeCacheContext.oHtml.appendChild(this.$int.childNodes[0]);}}this.documentId=this.xmlRoot=this.cacheId=this.subTreeCacheContext=null;}else{if(this.$loadedWhenOffline){this.$loadedWhenOffline=false;}else{var d=this.$getCurrentFragment();if(!d){return;}d.documentId=this.documentId;d.xmlRoot=this.xmlRoot;if(this.cacheId||this.xmlRoot){a.call(this,this.cacheId||this.xmlRoot.getAttribute(apf.xmldb.xmlIdTag)||"doc"+this.xmlRoot.getAttribute(apf.xmldb.xmlDocTag),d);}}}});function c(q,l){if(l&&this.hasFeature(apf.__MULTISELECT__)&&this.$isTreeArch){var d,i=l.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId,m=this.$pHtmlDoc.getElementById(i);if(m){d=getId?false:this.$int;}else{for(var o in this.cache){if(this.cache[o]&&this.cache[o].nodeType){m=this.cache[o].getElementById(i);if(m){d=getId?o:this.cache[o];break;}}}}if(d&&!this.cache[q]){var n=this.$findHtmlNode(l.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);this.subTreeCacheContext={oHtml:n,parentNode:n.parentNode,beforeNode:n.nextSibling,cacheItem:d};this.documentId=apf.xmldb.getXmlDocId(l);this.cacheId=q;this.xmlRoot=l;if(this.renderRoot){this.$int.appendChild(n);}else{while(n.childNodes.length){this.$int.appendChild(n.childNodes[0]);}}return true;}}if(!this.cache[q]){return false;}var j=this.cache[q];this.documentId=j.documentId;this.cacheId=q;this.xmlRoot=j.xmlRoot;this.clearCacheItem(q);this.$setCurrentFragment(j);return true;}function a(i,d){if(!this.caching){return;}this.cache[i]=d;}this.$findHtmlNode=function(j){var d=this.$pHtmlDoc.getElementById(j);if(d){return d;}for(var i in this.cache){if(this.cache[i]&&this.cache[i].nodeType){d=this.cache[i].getElementById(j);if(d){return d;}}}return null;};this.clearCacheItem=function(i,d){this.cache[i].documentId=this.cache[i].cacheId=this.cache[i].xmlRoot=null;if(d){apf.destroyHtmlNode(this.cache[i]);}this.cache[i]=null;};this.clearAllCache=function(){for(var d in this.cache){if(this.cache[d]){this.clearCacheItem(d,true);}}};this.getCacheItem=function(d){return this.cache[d];};this.$isCached=function(d){return this.cache[d]||this.cacheId==d?true:false;};if(!this.$getCurrentFragment){this.$getCurrentFragment=function(){var d=this.$int.ownerDocument.createDocumentFragment();while(this.$int.childNodes.length){d.appendChild(this.$int.childNodes[0]);}return d;};this.$setCurrentFragment=function(d){this.$int.appendChild(d);if(!apf.window.hasFocus(this)){this.blur();}};}this.$booleanProperties.caching=true;this.$supportedProperties.push("caching");this.addEventListener("DOMNodeRemovedFromDocument",function(d){this.clearAllCache();});};apf.GuiElement.propHandlers.caching=function(a){if(!apf.isTrue(a)){return;}if(!this.hasFeature(apf.__CACHE__)){this.implement(apf.Cache);}};apf.__DOCKING__=1<<18;apf.Docking=function(){this.$regbase=this.$regbase|apf.__DOCKING__;this.startDocking=function(a){apf.DockServer.start(this.aData,this,a);};};apf.DockServer={edge:30,inited:false,init:function(){if(this.inited){return;}this.inited=true;if(!this.nextPositionMarker){this.nextPositionMarker=document.body.appendChild(document.createElement("div"));this.nextPositionMarker.style.border="4px solid #555";this.nextPositionMarker.style.position="absolute";this.nextPositionMarker.style.zIndex=10000;this.nextPositionMarker.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=50);";this.nextPositionMarker.style.opacity=0.5;apf.setUniqueHtmlId(this.nextPositionMarker);}},start:function(i,a,d){if(!this.inited){apf.DockServer.init();}this.dragdata={item:i,amlNode:a,x:d.offsetX||d.layerX,y:d.offsetY||d.layerY};apf.dragMode=true;document.onmousemove=this.onmousemove;document.onmouseup=this.onmouseup;apf.plane.show(this.nextPositionMarker);var j=apf.getAbsolutePosition(i.oHtml),c=apf.getDiff(this.nextPositionMarker);this.nextPositionMarker.style.left=j[0]+"px";this.nextPositionMarker.style.top=j[1]+"px";this.nextPositionMarker.style.width=(i.oHtml.offsetWidth-c[0])+"px";this.nextPositionMarker.style.height=(i.oHtml.offsetHeight-c[1])+"px";this.nextPositionMarker.style.display="block";apf.layout.pause(i.oHtml.parentNode);},floatElement:function(a){this.dragdata.item.setPosition(a.clientX-this.dragdata.x,a.clientY-this.dragdata.y);if(this.dragdata.item.hidden!=3){this.dragdata.item.setFloat();this.dragdata.amlNode.$purgeAlignment();}else{apf.layout.play(this.dragdata.item.oHtml.parentNode);}},setPosition:function(c){var a=apf.getDiff(this.nextPositionMarker);this.nextPositionMarker.style.left=(c.clientX-this.dragdata.x)+"px";this.nextPositionMarker.style.top=(c.clientY-this.dragdata.y)+"px";this.nextPositionMarker.style.width=(this.dragdata.item.size[0]-a[0])+"px";this.nextPositionMarker.style.height=((this.dragdata.item.state<0?this.dragdata.item.size[1]:this.dragdata.item.fheight)-a[1])+"px";document.body.style.cursor="default";},onmousemove:function(M){if(!M){M=event;}if(apf.isIE&&M.button<1){return false;}apf.plane.hide();apf.DockServer.nextPositionMarker.style.top="10000px";var c=document.elementFromPoint(M.clientX+document.documentElement.scrollLeft,M.clientY+document.documentElement.scrollTop);apf.plane.show(apf.DockServer.nextPositionMarker);var G=c;while(G&&!G.host&&G.parentNode){G=G.parentNode;}var I=G&&G.host?G.host:false,s=I.$ext;if(!I.aData||!I.dock){document.body.style.cursor="";apf.setStyleClass(document.body,"same",["south","east","north","west"]);return apf.DockServer.setPosition(M);}if(apf.DockServer.dragdata.item==I.aData&&I.aData.hidden==3){return apf.DockServer.setPosition(M);}var i=I.aData.calcData,m=apf.getAbsolutePosition(s),K=M.clientX-m[0],B=M.clientY-m[1],C=apf.getDiff(apf.DockServer.nextPositionMarker),a=C[1],j=C[0],n=Math.min(apf.DockServer.edge,s.offsetHeight/2),J=Math.min(apf.DockServer.edge,s.offsetWidth/2),D=s.offsetWidth-K,O=s.offsetHeight-B,d,F=O/n,E=K/J,u=B/n,A=D/J;if(F<Math.min(E,A,u)){if(O<=n){d="south";}}else{if(A<Math.min(F,u,E)){if(D<=J){d="east";}}else{if(E<Math.min(F,u,A)){if(K<=J){d="west";}}else{if(u<Math.min(E,A,F)){if(B<=n){d="north";}}}}}if(apf.DockServer.dragdata.item==I.aData){d="same";}if(!d){return apf.DockServer.setPosition(M);}var N=apf.DockServer.nextPositionMarker;if(d=="west"){N.style.left=m[0]+"px";N.style.top=m[1]+"px";N.style.width=((s.offsetWidth/2)-j)+"px";N.style.height=(s.offsetHeight-a)+"px";}else{if(d=="north"){N.style.left=m[0]+"px";N.style.top=m[1]+"px";N.style.width=(s.offsetWidth-j)+"px";N.style.height=(Math.ceil(s.offsetHeight/2)-a)+"px";}else{if(d=="east"){N.style.left=(m[0]+Math.ceil(s.offsetWidth/2))+"px";N.style.top=m[1]+"px";N.style.width=((s.offsetWidth/2)-j)+"px";N.style.height=(s.offsetHeight-a)+"px";}else{if(d=="south"){N.style.left=m[0]+"px";N.style.top=(m[1]+Math.ceil(s.offsetHeight/2))+"px";N.style.width=(s.offsetWidth-j)+"px";N.style.height=(Math.ceil(s.offsetHeight/2)-a)+"px";}else{if(d=="same"){N.style.left=m[0]+"px";N.style.top=m[1]+"px";N.style.width=(s.offsetWidth-j)+"px";N.style.height=(s.offsetHeight-a)+"px";}}}}}document.body.style.cursor="";apf.setStyleClass(document.body,d,["same","south","east","north","west"]);},onmouseup:function(W){if(!W){W=event;}if(apf.isIE&&W.button<1){return false;}apf.plane.hide();apf.dragMode=false;document.onmousemove=document.onmouseup=null;apf.DockServer.nextPositionMarker.style.display="none";document.body.className="";var c=document.elementFromPoint(W.clientX+document.documentElement.scrollLeft,W.clientY+document.documentElement.scrollTop),N=c;while(N&&!N.host&&N.parentNode){N=N.parentNode;}var Q=N&&N.host?N.host:false,C=Q.$ext,a=Q.aData;if(!Q.aData||!Q.dock||apf.DockServer.dragdata.item==Q.aData&&Q.aData.hidden==3){return apf.DockServer.floatElement(W);}if(apf.DockServer.dragdata.item==Q.aData){return apf.layout.play(C.parentNode);}var A=apf.getAbsolutePosition(C),U=W.clientX-A[0],I=W.clientY-A[1],i,B=Math.min(apf.DockServer.edge,C.offsetHeight/2),R=Math.min(apf.DockServer.edge,C.offsetWidth/2),J=C.offsetWidth-U,X=C.offsetHeight-I,M=X/B,K=U/R,D=I/B,G=J/R;if(M<Math.min(K,G,D)){if(X<=B){i="b";}}else{if(G<Math.min(M,D,K)){if(J<=R){i="r";}}else{if(K<Math.min(M,D,G)){if(U<=R){i="l";}}else{if(D<Math.min(K,G,M)){if(I<=B){i="t";}}}}}if(!i){return apf.DockServer.floatElement(W);}var n=C.parentNode;U=apf.layout.layouts[n.getAttribute("id")];if(!U){return false;}var T=U.root;var P=a;if(apf.DockServer.dragdata.item.hidden==3){apf.DockServer.dragdata.item.unfloat();}var u=apf.DockServer.dragdata.item,m=u.parent;if(m.children.length==2){var F=m.children[(u.stackId==0)?1:0];F.parent=m.parent;F.stackId=m.stackId;F.parent.children[F.stackId]=F;F.weight=m.weight;F.fwidth=m.fwidth;F.fheight=m.fheight;}else{var O=m.children;for(var V=u.stackId;V<O.length;V++){O[V]=O[V+1];if(O[V]){O[V].stackId=V;}}O.length--;}var d=(i=="l"||i=="r")?"hbox":"vbox",E=P.parent,s=apf.layout.getData(d,U.layout);s.splitter=P.splitter;s.edgeMargin=P.edgeMargin;s.id=apf.layout.metadata.push(s)-1;s.parent=E;E.children[P.stackId]=s;s.stackId=P.stackId;s.children=(i=="b"||i=="r")?[P,u]:[u,P];P.parent=u.parent=s;P.stackId=(i=="b"||i=="r")?0:1;u.stackId=(i=="b"||i=="r")?1:0;s.fwidth=P.fwidth;s.fheight=P.fheight;u.weight=P.weight=1;P.fwidth=P.fheight=null;var T=T.copy();U.layout.compile(T);U.layout.reset();apf.layout.activateRules(U.layout.parentNode);}};apf.BaseButton=function(){this.$init(true);};(function(){this.implement(apf.ChildValue);this.refKeyDown=this.refMouseDown=0;this.mouseOver=this.mouseLeft=false;this.$propHandlers.background=function(c){var d=this.$getLayoutNode("main","background",this.$ext);if(!d){return;}if(c){var a=c.split("|");this.$background=a.concat(["vertical",2,16].slice(a.length-1));d.style.backgroundImage="url("+this.mediaPath+a[0]+")";d.style.backgroundRepeat="no-repeat";}else{d.style.backgroundImage="";d.style.backgroundRepeat="";this.$background=null;}};this.addEventListener("keydown",function(c){var a=c.keyCode;switch(a){case 13:if(this.localName!="checkbox"){this.$ext.onmouseup(c.htmlEvent,true);}break;case 32:if(!c.htmlEvent.repeat){this.refKeyDown++;this.$updateState(c.htmlEvent);}return false;}},true);this.addEventListener("keyup",function(c){var a=c.keyCode;switch(a){case 32:this.refKeyDown--;if(this.refKeyDown<0){this.refKeyDown=0;return false;}if(this.refKeyDown+this.refMouseDown==0&&!this.disabled){this.$ext.onmouseup(c,true);}this.$updateState(c);return false;}},true);this.states={Out:1,Over:2,Down:3};this.$updateState=function(c,a){if(this.disabled||c.reset){this.refKeyDown=0;this.refMouseDown=0;this.mouseOver=false;return false;}if(this.refKeyDown>0||(this.refMouseDown>0&&this.mouseOver)||(this.isBoolean&&this.value)){this.$setState("Down",c,a);}else{if(this.mouseOver){this.$setState("Over",c,a);}else{this.$setState("Out",c,a);}}};this.$setupEvents=function(){var a=this;this.$ext.onmousedown=function(c){c=c||window.event;if(a.$notfromext&&(c.srcElement||c.target)==this){return;}a.refMouseDown=1;a.mouseLeft=false;a.$updateState(c,"mousedown");};this.$ext.onmouseup=function(d,c){d=d||window.event;if(!c&&(!a.mouseOver||!a.refMouseDown)){return;}a.refMouseDown=0;a.$updateState(d,"mouseup");if(a.disabled||(d&&d.type=="click"&&a.mouseLeft==true)){return false;}if(a.refMouseDown+a.refKeyDown){return false;}if(a.$clickHandler&&a.$clickHandler()){a.$updateState(d||event,"click");}else{a.dispatchEvent("click",{htmlEvent:d});}return false;};this.$ext.onmousemove=function(c){if(!a.mouseOver){c=c||window.event;if(a.$notfromext&&(c.srcElement||c.target)==this){return;}a.mouseOver=true;a.$updateState(c,"mouseover");}};this.$ext.onmouseout=function(d){d=d||window.event;var c=d.explicitOriginalTarget||d.toElement;if(this==c||apf.isChildOf(this,c)){return;}a.mouseOver=false;a.refMouseDown=0;a.mouseLeft=true;a.$updateState(d,"mouseout");};if(apf.isIphone){apf.iphone.linkEvents(this.$ext,true);}if(apf.hasClickFastBug){this.$ext.ondblclick=this.$ext.onmouseup;}};this.$doBgSwitch=function(c){if(this.bgswitch&&(this.$background[2]>=c||c==4)){if(c==4){c=this.$background[2]+1;}var a=this.$background[1]=="vertical"?"0 -"+(parseInt(this.$background[3])*(c-1))+"px":"-"+(parseInt(this.$background[3])*(c-1))+"px 0";this.$getLayoutNode("main","background",this.$ext).style.backgroundPosition=a;}};this.$focus=function(){if(!this.$ext){return;}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");};this.$blur=function(a){if(!this.$ext){return;}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);if(a){this.$updateState(a);}};this.$destroy=function(a){if(!a&&this.$ext){this.$ext.onmousedown=this.$ext.onmouseup=this.$ext.onmouseover=this.$ext.onmouseout=this.$ext.onclick=this.$ext.ondblclick=null;}};}).call(apf.BaseButton.prototype=new apf.StandardBinding());apf.BaseTab=function(){this.$init(true);};(function(){this.isPaged=true;this.$focussable=apf.KEYBOARD;this.length=0;this.isLoading={};this.inited=this.ready=false;this.set=function(D,E,C){if(C||this.src&&!this.$findPage(D,{})){return this.$propHandlers.activepage.call(this,D,null,null,E,C);}if(E&&this.activepage==D){return E();}this.$lastCallback=E;this.setProperty("activepage",D);};this.$supportedProperties.push("activepage","activepagenr","length","src","loading");this.$propHandlers.activepagenr=this.$propHandlers.activepage=function(F,C,D,M,G){if(!this.inited||apf.isNot(F)){return;}if(!M){M=this.$lastCallback;delete this.$lastCallback;}var I,E={};I=this.$findPage(F,E);if(!I){if(this.src){if(this.isLoading[F]){return;}if(this.$findPage("loading",{})){this.$propHandlers.activepage.call(this,"loading");}this.setProperty("loading",true);this.isLoading[F]=true;I=this.ownerDocument.createElementNS(apf.ns.apf,"page");I.setAttribute("id",F);this.appendChild(I);var J=this;I.insertMarkup(this.src,{page:F,callback:function(N){if(!N.xmlNode){var O=new Error(apf.formatErrorString(0,null,"Loading new page","Could not load new page: "+J.src));J.setProperty("loading",false);if(this.dispatchEvent("error",apf.extend({error:O,bubbles:true},N))===false){return true;}throw O;}else{J.setProperty("activepage",F);if(M){M();}J.setProperty("loading",false);}}});return;}return false;}if(I.parentNode!=this){return false;}if(!I.visible||I.disabled){return false;}if(F.tagName){F=E.position;this.activepage=I.name||F;}if(!G){var K={previous:this.activepage,previousId:this.activepagenr,previousPage:this.$activepage,next:F,nextId:E.position,nextpage:I};if(this.dispatchEvent("beforeswitch",K)===false){if(this.hideLoader){this.hideLoader();}return false;}}this.activepagenr=E.position;this.setProperty("activepagenr",E.position);if(this.$activepage){this.$activepage.$deactivate();}I.$activate();this.$activepage=I;this.scrollIntoView(I);if(this.hideLoader){if(I.$rendered!==false){this.hideLoader();}else{I.addEventListener("afterrender",function(){this.parentNode.hideLoader();});}}if(!G){if(I.$rendered!==false){this.dispatchEvent("afterswitch",K);}else{I.addEventListener("afterrender",function(){this.parentNode.dispatchEvent("afterswitch",K);});}}if(typeof M=="function"){M();}return true;};this.getPages=function(){var F=[],D=this.childNodes;for(var E=0,C=D.length;E<C;E++){if("page|case".indexOf(D[E].localName)>-1){F.push(D[E]);}}return F;};this.getPage=function(C){if(apf.isNot(C)){return this.$activepage;}else{return this.$findPage(C);}};this.add=function(C,D,E){var F=apf.document.createElement(E||"page");if(D){F.setAttribute("id",D);}if(C){F.setAttribute("caption",C);}this.appendChild(F);this.scrollIntoView(F);return F;};this.remove=function(C){var D=this.$findPage(C);if(!D){return false;}D.removeNode();this.setScrollerState();return D;};var d={scrollOn:false,steps:15,interval:10,size:0,left:0,control:{stop:false},stopHandle:function(){l=false;}},z=1,t=2,B=4,A=8,o=z,u=z,i=1,a=2,s=4,l=false,m=null,q=false,c=i;function n(){var D="cache_"+this.$buttons.childNodes.length;if(d[D]){return d[D];}var F=0;for(var E=0,C=this.$buttons.childNodes.length;E<C;E++){if(typeof this.$buttons.childNodes[E].offsetWidth!="undefined"){F+=this.$buttons.childNodes[E].offsetWidth;}}return d[D]=F;}function j(C,E){var D=C&s;if(D){C=i;}var F=this[C&i?"oLeftScroll":"oRightScroll"];if(!(E&A)){if(C&i){o=E;}else{u=E;}}if(E&z){apf.setStyleClass(F,"",["disabled","hover","down"]);}else{if(E&t){apf.setStyleClass(F,"hover",["disabled","down"]);}else{if(E&B){apf.setStyleClass(F,"down",["disabled","hover"]);}else{if(E&A){apf.setStyleClass(F,"disabled",["hover","down"]);}}}}if(D){j(a,E);}}this.setScrollerState=function(E,D){if(!this.ready||!this.$hasButtons||!this.oScroller){return;}if(typeof E=="undefined"){var C=this.oScroller.offsetWidth||parseInt(apf.getStyle(this.oScroller,"width").replace(/(px|em|%)/,""));E=((n.call(this)+C)>this.$ext.offsetWidth);D=s;}if(D&s&&E!==d.scrollOn){d.scrollOn=E;if(!E){this.$buttons.style.left=d.left+"px";this.oScroller.style.display="none";}}else{this.oScroller.style.display="";}this.oScroller.style.display=(D&s&&!E)?"none":"";if(typeof D=="undefined"){D=s;}if(!E){if((D&i)||(D&s)){j.call(this,i,A);}if((D&a)||(D&s)){j.call(this,a,A);}}};this.correctScrollState=function(){if(!this.ready||!this.$hasButtons||!this.oScroller){return;}this.setScrollerState();};function w(D,C){if(d.size<=0){d.left=this.$buttons.offsetLeft;d.size=Math.round(this.firstChild.$button.offsetWidth);}if(D&i){return d.left;}else{if(D&a){var E=this.$buttons.childNodes[this.$buttons.childNodes.length-1];return this.$ext.offsetWidth-(E.offsetLeft+E.offsetWidth+(this.oScroller.offsetWidth+4));}}}this.scroll=function(J,F){if(!this.ready||!this.$hasButtons||!this.oScroller){return;}if(!J){J=window.event;}if(typeof J.type=="unknown"){J={type:"click"};}if(l&&J.type!="dblclick"){return;}l=true;if(typeof F=="undefined"){F=i;}var D=this.$buttons.offsetLeft,I=J.delta?Math.round(J.delta*36):d.size,G=w.call(this,F),C=this;if(F&i){j(i,B);j(a,z);if(D===G){this.setScrollerState(false,i);return apf.tween.single(this.$buttons,{steps:d.steps,interval:20,from:D,to:D+12,type:"left",anim:apf.tween.EASEOUT,onstop:d.stopHandle,onfinish:function(K){apf.tween.single(K,{steps:d.steps,interval:d.interval,from:D+12,to:D,type:"left",anim:apf.tween.EASEIN,onstop:d.stopHandle,onfinish:function(){l=false;if(J.name=="mousescroll"){j(i,z);}}});}});}var E=D+(J.type=="dblclick"?I*3:I);if(E>G){E=G;}if(E===G){this.setScrollerState(false,i);}this.setScrollerState(true,a);apf.tween.single(this.$buttons,{steps:d.steps,interval:d.interval,control:d.control,from:D,to:E,type:"left",anim:apf.tween.NORMAL,onstop:d.stopHandle,onfinish:function(){l=false;if(J.name=="mousescroll"){j(i,z);}if(q){C.scroll(J,c);}}});}else{if(F&a){this.setScrollerState(true);j(a,B);j(i,z);if(D===G){this.setScrollerState(false,a);return apf.tween.single(this.$buttons,{steps:d.steps,interval:20,from:D,to:D-24,type:"left",anim:apf.tween.EASEOUT,onstop:d.stopHandle,onfinish:function(M,K){apf.tween.single(M,{steps:d.steps,interval:d.interval,from:D-24,to:D,type:"left",anim:apf.tween.EASEIN,onstop:d.stopHandle,onfinish:function(){l=false;if(J.name=="mousescroll"){j(a,z);}}});}});}var E=D-(J.type=="dblclick"?I*3:I);if(E<G){E=G;}apf.tween.single(this.$buttons,{steps:d.steps,interval:d.interval,control:d.control,from:D,to:E,type:"left",anim:apf.tween.NORMAL,onstop:d.stopHandle,onfinish:function(){l=false;if(J.name=="mousescroll"){j(a,z);}if(q){C.scroll(J,c);}}});}}};this.scrollIntoView=function(G){l=false;if(!this.ready||!this.$hasButtons||!this.oScroller||!G.$drawn){return;}l=true;if(this.$buttons.offsetWidth<this.$ext.offsetWidth){return this.setScrollerState(false);}var J=G.$button.offsetLeft,M=G.$button.offsetWidth,I=this.$buttons.offsetLeft;if(d.size<=0){d.left=this.$buttons.offsetLeft;var E=this.firstChild;while(!E.$button){E=E.nextSibling;}d.size=Math.round(E.$button.offsetWidth);}this.$buttons.style.left=I;var C=this.$ext.offsetWidth,D=this.oScroller.offsetWidth+4,K=null,F;if((J+M)>((C-D)-I)){K=(-(J-d.left)+(C-M-D));F=a;}else{if((I+J)<d.left){K=d.left-J;F=i;}}if(K!==null){this.setScrollerState(true);j(a,F&a?B:z);j(i,F&i?B:z);apf.tween.clearQueue(this.$buttons,true);apf.tween.single(this.$buttons,{steps:d.steps,interval:d.interval,from:I,to:K,type:"left",anim:apf.tween.NORMAL,onstop:d.stopHandle,onfinish:function(){l=false;j(a,z);j(i,z);}});}else{l=false;}};this.addEventListener("DOMNodeRemoved",function(D){var C=D.currentTarget;if(D.$doOnlyAdmin||D.relatedNode!=this||C.localName!="page"){return;}if(this.firstChild==C&&C.nextSibling){C.nextSibling.$first();}if(this.lastChild==C&&C.previousSibling){C.previousSibling.$last();}if(this.$activepage==C){if(C.nextSibling||C.previousSibling){this.set(C.nextSibling||C.previousSibling);}else{this.setScrollerState();this.$activepage=this.activepage=this.activepagenr=null;}}else{this.setScrollerState();}this.setProperty("length",this.childNodes.length);});this.addEventListener("DOMNodeInserted",function(F){var C=F.currentTarget;if(C.localName!="page"||F.relatedNode!=this){return;}if(!F.$beforeNode){var D;if(D=this.lastChild){if(D.nodeType!=1){D=D.previousSibling;}if(D){D.$last(true);}}C.$last();}if(!this.firstChild||F.$beforeNode==this.firstChild){if(this.firstChild){this.firstChild.$first(true);}C.$first();}if(this.$activepage){var E={};this.$findPage(this.$activepage,E);if(this.activepagenr!=E.position){if(parseInt(this.activepage)==this.activepage){this.activepage=E.position;this.setProperty("activepage",E.position);}this.activepagenr=E.position;this.setProperty("activepagenr",E.position);}}else{if(!this.$activepage){this.set(C);}}this.setProperty("length",this.childNodes.length);});this.$findPage=function(I,J){var G,D=this.childNodes;for(var F=0,E=0,C=D.length;E<C;E++){G=D[E];if("page|case".indexOf(G.localName)>-1&&(F++==I||(I.localName&&G||G.name)==I)){if(J){J.position=F-1;}return G;}}return null;};this.$enable=function(){var D=this.childNodes;for(var E=0,C=D.length;E<C;E++){if(D[E].enable){D[E].enable();}}};this.$disable=function(){var D=this.childNodes;for(var E=0,C=D.length;E<C;E++){if(D[E].disable){D[E].disable();}}};this.addEventListener("keydown",function(E){if(!this.$hasButtons){return;}var D,C=E.keyCode;switch(C){case 9:break;case 13:break;case 32:break;case 37:D=this.getPage().previousSibling;while(D&&(D.nodeType!=1||"page|case".indexOf(D.localName)==-1||!D.visible)){D=D.previousSibling;}if(D){this.setProperty("activepage",D);}break;case 39:D=this.getPage().nextSibling;while(D&&(D.nodeType!=1||"page|case".indexOf(D.localName)==-1||!D.visible)){D=D.nextSibling;}if(D){this.setProperty("activepage",D);}break;default:return;}},true);this.$loadChildren=function(N){var K=false,M=this,J,G,E,D,C;this.inited=true;if(this.$hasButtons){this.$buttons=this.$getLayoutNode("main","buttons",this.$ext);this.$buttons.setAttribute("id",this.$uniqueId+"_buttons");}this.oPages=this.$getLayoutNode("main","pages",this.$ext);this.oScroller=this.$getLayoutNode("main","scroller",this.oPages);if(this.oScroller){function I(P,O){clearTimeout(m);c=O;m=$setTimeout(function(){q=true;M.scroll(P,O);},500);}function F(){clearTimeout(m);q=false;}this.oScroller.onmouseout=function(O){d.control.stop=true;j(s,z);};this.oLeftScroll=apf.getNode(this.oScroller,[0]);this.oRightScroll=apf.getNode(this.oScroller,[1]);["oLeftScroll","oRightScroll"].forEach(function(Q){var O=Q=="oLeftScroll"?i:a,P=Q=="oLeftScroll"?a:i;M[Q].ondbclick=M[Q].onmousedown=function(T){d.control.stop=false;var R=O&i?o:u;if(this.className.indexOf("disabled")!=-1||R&B){return;}T=T||event;M.scroll(T,O);I(T,O);if(!apf.isSafariOld){this.onmouseout();}};M[Q].onmouseover=function(){d.control.stop=false;var R=O&i?o:u;if(this.className.indexOf("disabled")!=-1||R&B){return;}j(O,t);j(P,z);c=O;};M[Q].onmouseout=function(){var R=O&i?o:u;if(this.className.indexOf("disabled")!=-1||R&B){return;}j(O,z);};M[Q].onmouseup=function(){if(this.className.indexOf("disabled")==-1){j(O,z);}F();d.control.stop=true;};});}apf.layout.setRules(this.$ext,this.$uniqueId+"_tabscroller","var o = apf.all["+this.$uniqueId+"]; o && o.correctScrollState()");apf.layout.queue(this.$ext);if(this.$int){this.$int=this.oPages;K=true;C=this.childNodes;for(J=0;J<C.length;J++){D=C[J];if(D.nodeType!=1){continue;}D.$draw(true);if(D.$skinchange){D.$skinchange();}D.$loadAml();}}else{this.$int=this.oPages;C=this.childNodes;for(G=0,J=0,E=C.length;J<E;J++){if("page|case".indexOf((D=C[J]).localName)>-1){if(G++==0){D.$first();}if(G==E){D.$last();}}}}if(D){this.activepage=(typeof this.activepage!="undefined"?this.activepage:this.activepagenr)||0;K=this.getPage(this.activepage);if(K.render!="runtime"||K.$rendered){this.$propHandlers.activepage.call(this,this.activepage);}}else{this.isPages=false;}this.setProperty("length",G);this.ready=true;window.setTimeout(function(){M.setScrollerState();},0);if(!this.activepage&&this.getAttribute("src")){this.src=this.getAttribute("src");this.$propHandlers.activepage.call(this);}};this.$destroy=function(C){if(C||!this.oScroller){return;}apf.layout.removeRule(this.$ext,this.$uniqueId+"_tabscroller");[this.oLeftScroll,this.oRightScroll].forEach(function(D){D.onmousedown=D.ondblclick=D.onmouseover=D.onmouseout=D.onmouseup=null;});};}).call(apf.BaseTab.prototype=new apf.Presentation());apf.__CONTENTEDITABLE__=1<<24;apf.ContentEditable2=function(){this.$regbase=this.$regbase|apf.__CONTENTEDITABLE__;var a=this;if(!apf.ContentEditable2.resize){apf.ContentEditable2.resize=new apf.Resize();}this.$propHandlers.editable=function(c,d){apf.ContentEditable2.resize.initElement(this);this.isEditable=true;};this.addEventListener("DOMNodeInsertedIntoDocument",function(n){var c=this.$aml;var j=this.childNodes;for(var m=0,d=j.length;m<d;m++){if(typeof j[m].editable=="undefined"){if(j[m].nodeFunc==apf.NODE_VISIBLE&&j[m].localName!="page"){j[m].setAttribute("editable",true);}else{j[m].isEditable=true;arguments.callee.apply(j[m],arguments);}}}if(!this.parentNode.isEditable){$setTimeout(function(){apf.ContentEditable2.resize.grab(a);});}});this.addEventListener("DOMNodeRemovedFromDocument",function(c){});};apf.ContentEditable2.setMode=function(c,a){this.mode=c;if(!this.pointer){this.pointer=new apf.ElementDrawer();}if(c=="add"){this.pointer.activate();}else{this.pointer.deactivate();}this.addType=a;};apf.ContentEditable2.actions={transaction:[],undostack:[],redostack:[]};apf.ContentEditable2.execCommand=function(m,d,D){if(!d){d={};}var w=d.sel||this.resize.getSelected();if(this.started&&m!="commit"&&m!="rollback"&&!D){apf.ContentEditable2.actions.transaction.push([m,d]);return;}var A,C,u;switch(m){case"add":if(D){apf.ContentEditable2.execCommand("remove",{sel:d.addedNode,maintenance:true});}else{var c=apf.document.createElementNS(apf.ns.apf,this.addType),q=d.htmlNode,s=d.parentNode;if(!s){s=(this.resize.getSelected()||apf.document.documentElement);if(s.getPage){s=s.getPage();}else{while(!s.canHaveChildren){s=s.parentNode;}}d.parentNode=s;}var n=apf.getAbsolutePosition(s.$int);c.setAttribute("left",q.offsetLeft-n[0]);c.setAttribute("top",q.offsetTop-n[1]);s.appendChild(c);var o=c.minwidth||parseInt(c.$getOption("main","minwidth"))||0,B=c.minheight||parseInt(c.$getOption("main","minheight"))||0,t=c.maxwidth||parseInt(c.$getOption("main","maxwidth"))||10000,j=c.maxheight||parseInt(c.$getOption("main","maxheight"))||10000;c.setAttribute("width",Math.min(t,Math.max(o,q.offsetWidth)));c.setAttribute("height",Math.min(j,Math.max(B,q.offsetHeight)));c.setAttribute("editable",true);apf.layout.processQueue();this.resize.grab(c);d.addedNode=c;}break;case"remove":if(D){d.removedNode[1].insertBefore(d.removedNode[0],d.removedNode[2]);this.resize.grab(d.removedNode[0]);}else{var a=w.parentNode;d.removedNode=[w,a,w.nextSibling];w.removeNode();this.resize.grab(apf.document.activeElement&&apf.document.activeElement.editable?apf.document.activeElement:(a.editable?a:a.firstChild));}break;case"property":if(D){w.setAttribute(d.name,d.prevValue);}else{d.prevValue=w[d.name];w.setAttribute(d.name,d.value);}break;case"undo":var l=apf.ContentEditable2.actions.undostack;if(!l.length){return false;}C=l.pop();apf.ContentEditable2.actions.redostack.push(C);C[1].maintenance=true;apf.ContentEditable2.execCommand(C[0],C[1],true);return true;case"redo":var z=apf.ContentEditable2.actions.redostack;if(!z.length){return false;}C=z.pop();apf.ContentEditable2.actions.undostack.push(C);C[1].maintenance=true;apf.ContentEditable2.execCommand(C[0],C[1]);return true;case"begin":this.started=true;return;case"commit":if(D){u=d;for(A=0;A<u.length;A++){apf.ContentEditable2.execCommand(u[A][0],u[A][1],true);}}else{if(this.started){this.started=false;u=apf.ContentEditable2.actions.transaction;apf.ContentEditable2.actions.transaction=[];apf.ContentEditable2.actions.undostack.push([m,u]);}else{u=d;}for(A=0;A<u.length;A++){u[A][1].maintenance=true;if(!u[A][1].sel){u[A][1].sel=w;}apf.ContentEditable2.execCommand(u[A][0],u[A][1]);}}apf.layout.processQueue();this.resize.regrab();return;case"rollback":this.started=false;apf.ContentEditable2.actions.transaction=[];return;}if(!d||!d.maintenance){apf.ContentEditable2.actions.undostack.push([m,d]);}};apf.Resize=function(){this.$init();this.$propHandlers=[];this.implement(apf.Interactive);this.draggable=true;this.resizable=true;this.dragOutline=true;this.dragSelection=true;var n=this,i=[],o=["n","ne","e","se","s","sw","w","nw"],c;while(i.length!=8){c=document.body.appendChild(document.createElement("div"));c.className="idegrabber";c.style.display="none";c.onmousedown=j;i.push(c);i[(c.type=o.pop())]=c;}this.getSelected=function(){return m;};this.initElement=function(s){s.$ext.onmousedown=function(t){n.grab(s);n.left=s.left;n.top=s.top;n.right=s.right;n.bottom=s.bottom;(t||event).cancelBubble=true;};this.$propHandlers.draggable.call({$ext:s.$ext},true);};var m,d,q=8,l=1;this.grab=function(t,s){if(this.$ext){apf.layout.removeRule(this.$ext,"contenteditable");apf.layout.activateRules(t);}if(!t){this.hide();return;}if(t.nodeFunc){m=t;d=t.$anchors&&t.$anchors.length?t.$anchors:[t.top,t.right,t.bottom,t.left];t=t.$ext;this.$ext=t;}this.regrab();for(var u=0;u<8;u++){i[u].style.display="block";}if(d){apf.setStyleClass(i.n,d[0]?"idegrabber_selected":"",["idegrabber_selected"]);apf.setStyleClass(i.e,d[1]?"idegrabber_selected":"",["idegrabber_selected"]);apf.setStyleClass(i.s,d[2]?"idegrabber_selected":"",["idegrabber_selected"]);apf.setStyleClass(i.w,d[3]?"idegrabber_selected":"",["idegrabber_selected"]);}apf.layout.setRules(t,"contenteditable","apf.all["+this.$uniqueId+"].regrab()",true);apf.layout.queue(t);n.onresize=function(){apf.ContentEditable2.execCommand("commit");};n.ondrag=function(w){apf.ContentEditable2.execCommand("commit");};};this.regrab=function(){var s=this.$ext;var t=apf.getAbsolutePosition(s);t.push(s.offsetWidth,s.offsetHeight);i.s.style.left=i.n.style.left=(t[0]+(t[2]-q)/2)+"px";i.e.style.top=i.w.style.top=(t[1]+(t[3]-q)/2)+"px";i.nw.style.top=i.ne.style.top=i.n.style.top=(t[1]-q-l)+"px";i.sw.style.left=i.nw.style.left=i.w.style.left=(t[0]-q-l)+"px";i.ne.style.left=i.se.style.left=i.e.style.left=(t[0]+t[2]+l)+"px";i.se.style.top=i.sw.style.top=i.s.style.top=(t[1]+t[3]+l)+"px";};this.show=function(){for(var s=0;s<8;s++){i[s].style.display="block";}};this.hide=function(){for(var s=0;s<8;s++){i[s].style.display="none";}};this.setProperty=function(s,t){if(!apf.ContentEditable2.started){apf.ContentEditable2.execCommand("begin");}apf.ContentEditable2.execCommand("property",{name:s,value:t});return t;};var a={e:"right",w:"left",n:"top",s:"bottom"};function j(t){if(!t){t=event;}if(t.ctrlKey&&this.type.length==1){apf.ContentEditable2.execCommand("begin");if(m.$anchors&&m.$anchors.length){var s=m.$anchors;n.setProperty("anchors",null);n.setProperty("top",s[0]);n.setProperty("right",s[1]);n.setProperty("bottom",s[2]);n.setProperty("left",s[3]);}apf.setStyleClass(this,!m[a[this.type]]?"idegrabber_selected":"",["idegrabber_selected"]);var w=a[this.type];if(m[w]){if(w=="right"&&!this.left){n.setProperty("left",m.$ext.offsetLeft);}else{if(w=="bottom"&&!this.top){n.setProperty("top",m.$ext.offsetTop);}}n.setProperty(w,null);}else{var u=m.$ext.offsetParent;if(u.tagName=="BODY"){u=document.documentElement;}switch(this.type){case"e":n.setProperty("right",u.offsetWidth-m.$ext.offsetLeft-m.$ext.offsetWidth);break;case"w":n.setProperty("left",m.$ext.offsetLeft);break;case"n":n.setProperty("top",m.$ext.offsetTop);break;case"s":n.setProperty("bottom",u.offsetHeight-m.$ext.offsetTop-m.$ext.offsetHeight);break;}}n.setProperty("width",!this.left||!this.right?m.$ext.offsetWidth:null);n.setProperty("height",!this.top||!this.bottom?m.$ext.offsetHeight:null);apf.ContentEditable2.execCommand("commit");}else{n.left=m.left;n.top=m.top;n.right=m.right;n.bottom=m.bottom;n.minwidth=m.minwidth||parseInt(m.$getOption("main","minwidth"))||0;n.minheight=m.minheight||parseInt(m.$getOption("main","minheight"))||0;n.maxwidth=m.maxwidth||parseInt(m.$getOption("main","maxwidth"))||10000;n.maxheight=m.maxheight||parseInt(m.$getOption("main","maxheight"))||10000;n.$resizeStart(t||event,{resizeType:this.type,nocursor:true});}}};apf.Resize.prototype=new apf.Class();apf.ElementDrawer=function(){var l=document.body.appendChild(document.createElement("div")),j=document.body.appendChild(document.createElement("div")),i=document.body.appendChild(document.createElement("div")),c=this,d,a;l.className="pointer_left";j.className="pointer_right";i.className="new_element";this.activate=function(){document.onmousemove=function(q){if(!q){q=event;}l.style.width=(Math.abs(q.clientX)||1)+"px";l.style.height=(Math.abs(q.clientY)||1)+"px";j.style.width=(Math.abs(document.documentElement.offsetWidth-q.clientX-5)||1)+"px";j.style.height=(Math.abs(document.documentElement.offsetHeight-q.clientY-5)||1)+"px";if(i.style.display=="block"){var m=q.clientX-d-1,n=q.clientY-a-1,o=Math.min(m,n);if(q.shiftKey){m=n=o;}i.style.width=(m<0?-1*(m-1):(m||1))+"px";i.style.height=(n<0?-1*(n-1):(n||1))+"px";i.style.left=m<0?"":(d)+"px";i.style.right=m<0?(document.documentElement.offsetWidth-d-4)+"px":"";i.style.bottom=n<0?(document.documentElement.offsetHeight-a-4)+"px":"";i.style.top=n<0?"":(a)+"px";}};document.onmousedown=function(m){if(!m){m=event;}i.style.display="block";i.style.left=(d=event.clientX)+"px";i.style.top=(a=event.clientY)+"px";i.style.width=(i.style.height=1)+"px";};document.onmouseup=function(){if(i.offsetWidth>10&&i.offsetHeight>10){apf.ContentEditable2.execCommand("add",{htmlNode:i});c.deactivate();}i.style.display="none";d=false;a=false;};l.style.display=j.style.display="block";document.body.style.cursor=document.documentElement.style.cursor="crosshair";};this.deactivate=function(){document.onmousemove=null;document.onmousedown=null;document.onmouseup=null;l.style.display=j.style.display="none";document.body.style.cursor=document.documentElement.style.cursor="";};};apf.Selection=function(){};apf.__XFORMS__=1<<17;apf.__FOCUSSABLE__=1<<26;apf.Focussable=function(){this.$regbase=this.$regbase|apf.__FOCUSSABLE__;this.setTabIndex=function(a){apf.window.$removeFocus(this);apf.window.$addFocus(this,a);return this;};this.focus=function(a,d,c){if(!a){if(this.$isWindowContainer){apf.window.$focusLast(this,d,true);}else{apf.window.$focus(this,d);if(!c&&apf.hasFocusBug){apf.window.$focusfix();}}return this;}if(this.$focus){this.$focus(d);}this.dispatchEvent("focus",apf.extend({srcElement:this,bubbles:true},d));return this;};this.blur=function(a,c){if(apf.popup.isShowing(this.$uniqueId)){apf.popup.forceHide();}if(this.$blur){this.$blur(c);}if(!a){apf.window.$blur(this);}this.dispatchEvent("blur",apf.extend({srcElement:this,bubbles:!c||!c.cancelBubble},c));return this;};this.hasFocus=function(){return apf.document.activeElement==this||this.$isWindowContainer&&(apf.document.activeElement||{}).$focusParent==this;};};apf.__MEDIA__=1<<20;apf.Media=function(){this.$init(true);};(function(){this.$regbase=this.$regbase|apf.__MEDIA__;this.muted=false;this.$booleanProperties.paused=true;this.$booleanProperties.muted=true;this.$booleanProperties.seeking=true;this.$booleanProperties.autoplay=true;this.$booleanProperties.controls=true;this.$booleanProperties.ready=true;this.$supportedProperties.push("position","networkState","readyState","progress","buffered","bufferedBytes","totalBytes","currentTime","paused","seeking","volume","type","src","autoplay","controls");this.$mainBind="src";this.$sources=[];this.$nomedia=null;this.$amlTimer=null;this.$loadTimer=null;this.$posTimer=null;this.$volTimer=null;this.$propHandlers.readyState=function(d){if(this.readyState!==d){this.readyState=d;}if(d==apf.Media.HAVE_NOTHING){var i=this.MediaError("Unable to open medium with URL '"+this.src+"'. Please check if the URL you entered as src is pointing to                    a valid resource.");if(this.dispatchEvent("havenothing",{error:i,bubbles:true})===false){throw i;}}else{if(d==apf.Media.HAVE_CURRENT_DATA){this.dispatchEvent("havecurrentdata");}else{if(d==apf.Media.HAVE_FUTURE_DATA){this.dispatchEvent("havefuturedata");}else{if(d==apf.Media.HAVE_ENOUGH_DATA){this.dispatchEvent("haveenoughdata");this.setProperty("ready",true);}}}}};this.$propHandlers.bufferedBytes=function(d){this.setProperty("progress",this.totalBytes?d.end/this.totalBytes:0);};this.$propHandlers.position=function(i){clearTimeout(this.$posTimer);if(this.duration<=0||!this.seek){return;}var d=this;this.$posTimer=$setTimeout(function(){if(i>=d.progress){i=d.progress-0.05;}var j=!d.paused;if(j){d.pause();}if(i<0){i=0;}else{if(i>1){i=1;}}d.seek(Math.round(i*d.duration));d.setProperty("paused",!j);});};this.$propHandlers.currentTime=function(d){if(d>=0&&this.seek){this.seek(d);}};this.$propHandlers.volume=function(d){if(!this.player){return;}if(d<1&&d>0){d=d*100;}if(this.setVolume){this.setVolume(d);}if(d>0&&this.muted){this.setProperty("muted",false);}};this.oldVolume=null;this.$propHandlers.muted=function(d){if(!this.player||!this.setVolume){return;}if(d){this.oldVolume=this.volume;this.setVolume(0);}else{this.setVolume(this.oldVolume||20);}};this.$propHandlers.paused=function(d){if(!this.player){return;}this.paused=apf.isTrue(d);if(this.paused){this.player.pause();}else{this.player.play();}};this.$propHandlers.type=function(i){if(this.$loadTimer){return;}var d=this;this.$loadTimer=window.setTimeout(function(){a.call(d);});};this.$propHandlers.src=function(l){if(this.$loadTimer||!l){return;}var j=new apf.url(l);this.src=j.uri;if(this.src!=this.currentSrc&&this.networkState!==apf.Media.LOADING){var i=this.$guessType(this.src);if(i==this.type){c.call(this);this.loadMedia();}else{this.type=i;var d=this;this.$loadTimer=window.setTimeout(function(){a.call(d);});}}};this.$propHandlers.ID3=function(d){if(!this.player){return;}if(typeof this.player.setID3=="function"){this.player.setID3(d);}};this.addEventListener("AMLRemove",function(d){c.call(this);});this.addEventListener("AMLReparent",function(d,j,i){if(!this.$amlLoaded){return;}this.$draw();a.call(this,true);});function c(){this.setProperty("networkState",apf.Media.NETWORK_EMPTY);this.setProperty("ready",false);this.buffered={start:0,end:0,length:0};this.bufferedBytes={start:0,end:0,length:0};this.totalBytes=0;this.setProperty("progress",0);this.setProperty("seeking",false);this.setProperty("paused",true);this.setProperty("position",0);this.currentTime=this.duration=0;this.played=this.seekable=null;this.ended=false;this.start=this.end=this.loopStart=this.loopEnd=this.playCount=this.currentLoop=0;this.controls=this.muted=false;}function a(d){window.clearTimeout(this.$loadTimer);this.$loadTimer=null;if(!d){c.call(this);}this.$destroy(true);this.playerType=this.$getPlayerType(this.type);if(!this.playerType||!this.$isSupported()){this.$ext.innerHTML=this.notSupported;return;}this.$initPlayer();}this.MediaError=function(d){return new Error(apf.formatErrorString(0,this,"Media",d));};this.src=this.currentSrc=null;this.networkState=apf.Media.NETWORK_EMPTY;this.bufferingRate=0;this.bufferingThrottled=false;this.buffered={start:0,end:0,length:0};this.bufferedBytes={start:0,end:0,length:0};this.totalBytes=0;this.volume=100;this.loadMedia=function(){};this.readyState=apf.Media.HAVE_NOTHING;this.seeking=false;this.currentTime=this.duration=0;this.paused=true;this.defaultPlaybackRate=this.playbackRate=0;this.played=null;this.seekable=null;this.ended=this.autoplay=false;this.canPlayType=function(i){if(this.$getPlayerType){var d=this.$getPlayerType(i);if(!d||!this.$isSupported(d)){return"no";}if(d.indexOf("Wmp")!=-1){return"maybe";}return"probably";}return"no";};this.play=function(){this.setProperty("paused",false);};this.pause=function(){this.setProperty("paused",true);};this.start=this.end=this.loopStart=this.loopEnd=this.playCount=this.currentLoop=0;this.addCueRange=function(j,m,i,d,o,n,l){};this.removeCueRanges=function(d){};this.getCounter=function(l,i,n){if(n){l=l-this.duration;}var d=Math.round(Math.abs(l/1000)),m=String(Math.round(Math.abs(d/60/60))).pad(2,"0"),j=String(Math.round(Math.abs(d/60))).pad(2,"0"),q=String(d).pad(2,"0"),o=String(Math.round(Math.abs(l%1000))).pad(3,"0");return(n?"- ":"")+i.replace(/\%T/g,"%H:%M:%S").replace(/\%[a-zA-Z\%]/g,function(s){switch(s){case"%H":return m;case"%M":return j;case"%S":return q;case"%Q":return o;case"%n":return"\n";case"%t":return"\t";case"%%":return"%";}});};this.setSource=function(){if(!this.src){var o,n,d=this.$sources;for(var m=0,l=d.length;m<l;m++){o=d[m].src;if(!o){continue;}n=d[m].type;if(!n){n=this.$guessType(o);}if(this.canPlayType(n)!="no"){this.src=o;this.type=n;break;}}}else{if(!this.type){this.type=this.$guessType(this.src);if(this.canPlayType(this.type)=="no"){return false;}}}return(this.src&&this.type);};this.$addSource=function(i){clearTimeout(this.$amlTimer);if(i.localName!="source"){return false;}this.$sources.pushUnique(i);var d=this;this.$amlTimer=$setTimeout(function(){clearTimeout(d.$amlTimer);d.dispatchEvent("AMLMediaReady");});};this.$removeSource=function(d){this.$sources.remove(d);};this.addEventListener("DOMNodeInserted",function(i){var d=i.currentTarget;if(d.parentNode!=this){return;}this.$addSource(d);});this.addEventListener("DOMNodeRemoved",function(i){var d=i.currentTarget;if(!(d.parentNode==this||d.parentNode.parentNode==this)){return;}this.$removeSource(d);});}).call(apf.Media.prototype=new apf.StandardBinding());apf.nomedia=function(c,a){this.$init(a||"nomedia",apf.NODE_HIDDEN,c);};(function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(){this.parentNode.notSupported=apf.getXmlString(this.$aml).replace(/<\/?a:nomedia[^>]*>/g,"");});}).call(apf.nomedia.prototype=new apf.AmlElement());apf.aml.setElement("nomedia",apf.nomedia);apf.Media.NETWORK_EMPTY=0;apf.Media.NETWORK_IDLE=1;apf.Media.NETWORK_LOADING=2;apf.Media.NETWORK_LOADED=3;apf.Media.HAVE_NOTHING=0;apf.Media.HAVE_METADATA=1;apf.Media.HAVE_SOME_DATA=2;apf.Media.HAVE_CURRENT_DATA=3;apf.Media.HAVE_FUTURE_DATA=4;apf.Media.HAVE_ENOUGH_DATA=5;apf.BaseSimple=function(){this.$init(true);};(function(){this.implement(apf.DataAction);this.getValue=function(){return this.value;};}).call(apf.BaseSimple.prototype=new apf.StandardBinding());apf.__ALIGNMENT__=1<<29;apf.A11y=function(){this.setRole=function(c,a){if(!c){throw new Error();}if(!apf.A11y.ROLES[a]){throw new Error();}c.setAttribute("role",a);};this.setWidgetAttr=function(i,d,c){var a=apf.A11y.ATTR_WIDGETS[d];if(!a){throw new Error("attr does not exist");}if((typeof a=="boolean"&&typeof c!="boolean")||(typeof a=="number"&&typeof c!="number")||((typeof a=="string"||apf.isArray(a))&&typeof c!="string")){throw new Error("invalid type");}i.setAttribute("aria-"+d,c);};this.updateLiveRegion=function(i,d,c){var a=apf.A11y.ATTR_LIVEREGION[d];if(!a){throw new Error("attr does not exist");}if((typeof a=="boolean"&&typeof c!="boolean")||(apf.isArray(a)&&typeof c!="string")){throw new Error("invalid type");}if(i){i.setAttribute("aria-"+d,c);}else{}};this.setDragDropAttr=function(i,d,c){var a=apf.A11y.ATTR_LIVEREGION[d];if(!a){throw new Error("attr does not exist");}if((typeof a=="boolean"&&typeof c!="boolean")||(apf.isArray(a)&&typeof c!="string")){throw new Error("invalid type");}i.setAttribute("aria-"+d,c);};this.setRelationAttr=function(){var c=Array.prototype.slice.call(arguments),i=c.shift(),d=c.shift(),a=c.join(" ");if(!apf.A11y.ATTR_RELATIONS[d]){throw new Error();}i.setAttribute("aria-"+d,a);};};apf.A11y.ROLES={alert:1,alertdialog:1,application:1,article:1,banner:1,button:1,checkbox:1,columnheader:1,combobox:1,complementary:1,contentinfo:1,definition:1,dialog:1,directory:1,grid:1,gridcell:1,"group:":1,heading:1,img:1,link:1,list:1,listbox:1,listitem:1,log:1,main:1,marquee:1,math:1,menu:1,menubar:1,menuitem:1,menuitemcheckbox:1,menuitemradio:1,navigation:1,note:1,option:1,presentation:1,progressbar:1,radio:1,radiogroup:1,region:1,row:1,rowheader:1,search:1,seperator:1,slider:1,slinbutton:1,status:1,tab:1,tablist:1,tabpanel:1,textbox:1,timer:1,toolbar:1,tooltip:1,tree:1,treegrid:1,treeitem:1};apf.A11y.ATTR_WIDGETS={autocomplete:true,checked:true,disabled:true,expanded:true,haspopup:true,hidden:true,invalid:["grammar","false","spelling","true"],level:1,multiline:true,multiselectable:true,pressed:["true","false","pressed"],readonly:true,required:true,selected:true,sort:["ascending","descending","none","other"],valuemax:1,valuemin:1,valuenow:1,valuetext:"string"};apf.A11y.ATTR_LIVEREGION={atomic:true,busy:true,live:["off","polite","assertive"],relevant:["additions","removals","text","all","additions text"]};apf.A11y.ATTR_DRAGDROP={dropeffect:["copy","move","reference","execute","popup","none"],grabbed:true};apf.A11y.ATTR_RELATIONS={activedescendant:{},controls:{},describedby:{},flowto:{},label:"1",labelledby:{},owns:{},posinset:1,setsize:1};apf.__TRANSACTION__=1<<3;apf.Transaction=function(){this.$regbase=this.$regbase|apf.__TRANSACTION__;this.$addParent=this.$transactionNode=this.$transactionSubject=this.$originalNode=this.$inTransaction=this.$lastAction=null;this.$supportedProperties.push("autoshow");this.$booleanProperties.autoshow=true;this.commit=function(d){if(!this.$inTransaction){return false;}if(!this.$validgroup&&this.validgroup){this.$validgroup=self[this.validgroup];}if(this.$validgroup&&!this.$validgroup.isValid()){return false;}var c=true;if(!this.$at.undolength){if(d){return false;}this.$at.purge();this.$inTransaction=false;this.load(this.$originalNode);this.$helperModel.reset();c=false;}else{this.$at.reset();this.$inTransaction=false;this.$transactionNode.removeAttribute(apf.xmldb.xmlListenTag);if(this.$lastAction=="add"){if(this.$transactionSubject.$executeAction("appendChild",[this.$addParent,this.$transactionNode],"add",this.$transactionNode)&&this.$transactionSubject.hasFeature(apf.__MULTISELECT__)){this.$transactionSubject.select(this.$transactionNode);}this.$transactionSubject=null;}else{var a=this.$at;this.$at=this.dataParent?this.dataParent.parent.getActionTracker():null;this.$transactionSubject.$executeAction("replaceNode",[this.$originalNode,this.$transactionNode],"update",this.$transactionNode);this.$at=a;}}this.$transactionNode=null;this.$addParent=null;this.$originalNode=null;if(this.autoshow){if(this.autoshow==-1){this.autoshow=true;}else{this.hide();}}return c;};this.rollback=function(a){if(!this.$inTransaction){return;}if(this.$at){if(this.rpcMode=="realtime"){this.$at.undo(-1);}this.$at.reset();}this.$transactionNode=null;this.$addParent=null;if(!a){this.load(this.$originalNode);}this.$helperModel.reset();this.$stopAction(this.$lastAction,true);this.$originalNode=null;this.$inTransaction=false;if(this.autoshow){if(this.autoshow==-1){this.autoshow=true;}else{this.hide();}}};this.begin=function(d,w,m,u){if(this.$inTransaction){if(this.autoshow){this.autoshow=-1;}this.rollback();}var s=this;this.$lastAction=d;if(!this.$lastAction){this.$lastAction=this.xmlRoot&&"update"||"add";}if(u){this.$setDynamicProperty("model","["+u.id+".selected]");}if(w&&this.$lastAction=="update"){this.xmlRoot=w;}if(!this.$at){this.$at=new apf.actiontracker();var q=function(i){s.setProperty(i.prop,i.value);};this.$at.addEventListener("prop.undolength",q);this.setProperty("undolength",0);this.$at.addEventListener("prop.redolength",q);this.setProperty("redolength",0);}if(!this.$helperModel){this.$helperModel=new apf.model();this.$helperModel["save-original"]=true;this.$helperModel.load("<data />");}this.$transactionNode=null;this.$addParent=null;this.$originalNode=this.xmlRoot;if(typeof apf.offline!="undefined"&&!apf.offline.canTransact()){return false;}this.$inTransaction=true;function c(){this.$inTransaction=-1;this.$helperModel.data.appendChild(this.$transactionNode);this.load(this.$helperModel.data.firstChild);this.$inTransaction=true;if(this.disabled){this.enable();}if(this.autoshow){if(this.autoshow==-1){this.autoshow=true;}else{this.show();}}}u=this.dataParent&&this.dataParent.parent;if(!u||!u.$actions||!u.$actions[this.$lastAction]){u=this;}if(this.$lastAction=="add"){var t,a=u.$actions;if(a){if(w&&w.nodeType){t=a.getRule("add",w);}else{if(typeof w=="string"){if(w.trim().charAt(0)=="<"){w=apf.getXml(w);t=a.getRule("add",w);}else{var A=a.$rules.add;for(var n=0,j=A.length;n<j;n++){if(A[n].getAttribute("type")==w){w=null;t=A[n];break;}}}}}if(!t){t=(u.$actions.add||{})[0];}}else{t=null;}if(typeof apf.offline!="undefined"&&!apf.offline.onLine&&!t.get){return false;}var o=this.$isTreeArch?this.selected||this.xmlRoot:this.xmlRoot;var z=function(B,C,i){if(C!=apf.SUCCESS){var D;D=new Error(apf.formatErrorString(1032,u,"Loading xml data","Could not add data for control "+u.name+"["+u.tagName+"] \nUrl: "+i.url+"\nInfo: "+i.message+"\n\n"+w));if(i.tpModule.retryTimeout(i,C,u,D)===true){return true;}throw D;}if(typeof B!="object"){B=apf.getXmlDom(B).documentElement;}if(B.getAttribute(apf.xmldb.xmlIdTag)){B.setAttribute(apf.xmldb.xmlIdTag,"");}if(!u.$startAction("add",B,s.rollback)){return false;}var l=(u.$actions&&u.$actions.getRule("add",u.$isTreeArch?u.selected:u.xmlRoot)||{})[2];if(m){s.$addParent=m;}else{if(l&&l.getAttribute("parent")){s.$addParent=u.xmlRoot.selectSingleNode(l.getAttribute("parent"));}else{s.$addParent=u.$isTreeArch?u.selected||u.xmlRoot:u.xmlRoot;}}if(!s.$addParent){s.$addParent=u.xmlRoot||u.getModel(true).data;}if(apf.isWebkit&&s.$addParent.ownerDocument!=B.ownerDocument){B=s.$addParent.ownerDocument.importNode(B,true);}s.$transactionNode=B;s.$transactionSubject=u;c.call(s);};if(w){return z(w,apf.SUCCESS);}else{if(t&&t.get){return apf.getData(t.get,{xmlNode:o,callback:z});}else{}}}else{if(!u.$startAction(this.$lastAction,this.xmlRoot,this.rollback)){return false;}this.$transactionSubject=u;this.$transactionNode=this.$originalNode.cloneNode(true);c.call(this);}};this.$canLoadData=function(){return true;};this.addEventListener("prop.model",function(a){return false;});this.clear=function(){this.documentId=this.xmlRoot=this.cacheId=null;};this.addEventListener("beforeload",function(c){var a=c.xmlNode;if(this.$inTransaction==-1){return;}if(this.$inTransaction){if(this.$transactionNode&&a!=this.$transactionNode){if(this.autoshow){this.autoshow=-1;}this.rollback(true);}else{return;}}if(this.autoshow){this.autoshow=-1;}if(this.begin("update",a)!==false){return false;}});};apf.GuiElement.propHandlers.transaction=function(c){if(!(this.transaction=apf.isTrue(c))){return;}if(!this.hasFeature(apf.__DATABINDING__)){this.implement(apf.StandardBinding);}if(!this.hasFeature(apf.__DATAACTION__)){this.implement(apf.DataAction);if(this.actions){this.$propHandlers.actions.call(this,this.actions,"actions");}}if(!this.hasFeature(apf.__TRANSACTION__)){this.implement(apf.Transaction);if(!this.validgroup){this.$validgroup=new apf.ValidationGroup();this.$validgroup.register(this);}if(!this.id){this.setProperty("id",this.localName+"_"+this.$uniqueId);}var a=this.attributes.getNamedItem("model");if(!a){this.attributes.push(a=new apf.AmlAttr(this,"model",null));}a.inheritedValue="{"+this.id+".root}";if(typeof this.autoshow=="undefined"&&(this.localName=="modalwindow"||this.localName=="window")){this.autoshow=true;}}};apf.BaseList=function(){this.$init(true);this.dynCssClasses=[];this.listNodes=[];};(function(){this.implement(apf.Cache,apf.DataAction);this.$focussable=true;this.multiselect=true;this.mode="normal";this.$propHandlers.fill=function(a){if(a){this.loadFillData(this.getAttribute("fill"));}else{this.clear();}};this.$propHandlers.template=function(d){this.$template=typeof d=="object"?d:apf.nameserver.get("template",d);if(!this.$template){var c;apf.addEventListener("parsestop",c=function(){_self.$propHandlers.template.call(_self,d);apf.removeEventListener("parsestop",c);});return;}this.$deInitNode=function(j,l){var i=j.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId;this.$template.destroyInstance(i);if(l){l.parentNode.removeChild(l);}};this.$updateNode=function(i,l,j){};this.$moveNode=function(i,j){};var a=document.createDocumentFragment();this.$add=function(l,j,m,o,i){var n=document.createElement("div");n.setAttribute("id",j);a.appendChild(n);this.$template.getNewInstance(this.$getLayoutNode("item","container",n),j,l,true);};this.$fill=function(){this.$int.appendChild(a);apf.queue.empty();};this.$checkLoadQueue();};this.$keyHandler=function(q){var B=q.keyCode,c=q.ctrlKey,u=q.shiftKey,t=this.$selected||this.$caret;if(q.returnValue==-1||!t||this.renaming){return;}var z=this.caret||this.selected,d=this.$ext,j,l,s,C,w,o,n;switch(B){case 13:if(this.$tempsel){this.$selectTemp();}if(this.ctrlselect=="enter"){this.select(this.caret,true);}this.choose(this.selected);break;case 32:if(c||this.mode!="normal"||!this.isSelected(this.caret)){this.select(this.caret,c);}break;case 109:case 46:if(this.disableremove){return;}if(this.$tempsel){this.$selectTemp();}this.remove(this.mode!="normal"?this.caret:null);break;case 36:if(this.hasFeature(apf.__VIRTUALVIEWPORT__)){this.viewport.change(0,null,true,true);}this.select(this.getFirstTraverseNode(),false,u);this.$int.scrollTop=0;break;case 35:if(this.hasFeature(apf.__VIRTUALVIEWPORT__)){this.viewport.change(this.viewport.length,null,true,true);}this.select(this.getLastTraverseNode(),false,u);this.$int.scrollTop=this.$int.scrollHeight;break;case 107:if(this.more){this.startMore();}break;case 37:if(!z&&!this.$tempsel){return;}j=this.$tempsel?apf.xmldb.getNode(this.$tempsel):z;l=apf.getBox(apf.getStyle(t,"margin"));s=t.offsetWidth?Math.floor((d.offsetWidth-(w?15:0))/(t.offsetWidth+l[1]+l[3])):1;l=apf.getBox(apf.getStyle(t,"margin"));j=this.getNextTraverseSelected(j,false);if(j){this.$setTempSelected(j,c,u,true);}else{return;}t=apf.xmldb.findHtmlNode(j,this);if(t.offsetTop<d.scrollTop){d.scrollTop=Array.prototype.indexOf.call(this.getTraverseNodes(),j)<s?0:t.offsetTop-l[0];}break;case 38:if(!z&&!this.$tempsel){return;}j=this.$tempsel?apf.xmldb.getNode(this.$tempsel):z;l=apf.getBox(apf.getStyle(t,"margin"));w=d.scrollHeight>d.offsetHeight;s=t.offsetWidth?Math.floor((d.offsetWidth-(w?15:0))/(t.offsetWidth+l[1]+l[3])):1;j=this.getNextTraverseSelected(j,false,s);if(j){this.$setTempSelected(j,c,u,true);}else{return;}t=apf.xmldb.findHtmlNode(j,this);if(t.offsetTop<d.scrollTop){d.scrollTop=Array.prototype.indexOf.call(this.getTraverseNodes(),j)<s?0:t.offsetTop-l[0];}break;case 39:if(!z&&!this.$tempsel){return;}j=this.$tempsel?apf.xmldb.getNode(this.$tempsel):z;l=apf.getBox(apf.getStyle(t,"margin"));j=this.getNextTraverseSelected(j,true);if(j){this.$setTempSelected(j,c,u);}else{return;}t=apf.xmldb.findHtmlNode(j,this);if(t.offsetTop+t.offsetHeight>d.scrollTop+d.offsetHeight){d.scrollTop=t.offsetTop-d.offsetHeight+t.offsetHeight+l[0];}break;case 40:if(!z&&!this.$tempsel){return;}j=this.$tempsel?apf.xmldb.getNode(this.$tempsel):z;l=apf.getBox(apf.getStyle(t,"margin"));w=d.scrollHeight>d.offsetHeight;s=t.offsetWidth?Math.floor((d.offsetWidth-(w?15:0))/(t.offsetWidth+l[1]+l[3])):1;j=this.getNextTraverseSelected(j,true,s);if(j){this.$setTempSelected(j,c,u);}else{return;}t=apf.xmldb.findHtmlNode(j,this);if(t.offsetTop+t.offsetHeight>d.scrollTop+d.offsetHeight){d.scrollTop=t.offsetTop-d.offsetHeight+t.offsetHeight+l[0];}break;case 33:if(!z&&!this.$tempsel){return;}j=this.$tempsel?apf.xmldb.getNode(this.$tempsel):z;l=apf.getBox(apf.getStyle(t,"margin"));n=d.scrollHeight>d.offsetHeight;o=d.scrollWidth>d.offsetWidth;s=Math.floor((d.offsetWidth-(n?15:0))/(t.offsetWidth+l[1]+l[3]));C=Math.floor((d.offsetHeight-(o?15:0))/(t.offsetHeight+l[0]+l[2]));j=this.getNextTraverseSelected(j,false,s*C);if(!j){j=this.getFirstTraverseNode();}if(j){this.$setTempSelected(j,c,u,true);}else{return;}t=apf.xmldb.findHtmlNode(j,this);if(t.offsetTop<d.scrollTop){d.scrollTop=Array.prototype.indexOf.call(this.getTraverseNodes(),j)<s?0:t.offsetTop-l[0];}break;case 34:if(!z&&!this.$tempsel){return;}j=this.$tempsel?apf.xmldb.getNode(this.$tempsel):z;l=apf.getBox(apf.getStyle(t,"margin"));n=d.scrollHeight>d.offsetHeight;o=d.scrollWidth>d.offsetWidth;s=Math.floor((d.offsetWidth-(n?15:0))/(t.offsetWidth+l[1]+l[3]));C=Math.floor((d.offsetHeight-(o?15:0))/(t.offsetHeight+l[0]+l[2]));j=this.getNextTraverseSelected(z,true,s*C);if(!j){j=this.getLastTraverseNode();}if(j){this.$setTempSelected(j,c,u);}else{return;}t=apf.xmldb.findHtmlNode(j,this);if(t.offsetTop+t.offsetHeight>d.scrollTop+d.offsetHeight){d.scrollTop=t.offsetTop-d.offsetHeight+t.offsetHeight+l[0];}break;default:if(B==65&&c){this.selectAll();}else{if(this.$hasBindRule("caption")){if(!this.xmlRoot||this.autorename){return;}if(!this.lookup||new Date().getTime()-this.lookup.date.getTime()>300){this.lookup={str:"",date:new Date()};}this.lookup.str+=String.fromCharCode(B);var a=this.getTraverseNodes();for(var A,m=0;m<a.length;m++){A=this.$applyBindRule("caption",a[m]);if(A&&A.substr(0,this.lookup.str.length).toUpperCase()==this.lookup.str){if(!this.isSelected(a[m])){if(this.mode=="check"){this.setCaret(a[m]);}else{this.select(a[m]);}}if(t){this.$int.scrollTop=t.offsetTop-(this.$int.offsetHeight-t.offsetHeight)/2;}return;}}return;}}break;}this.lookup=null;return false;};this.$deInitNode=function(a,c){if(!c){return;}c.parentNode.removeChild(c);};this.$updateNode=function(d,l,i){var c=this.$getLayoutNode("item","icon",l);if(c){if(c.nodeType==1){c.style.backgroundImage="url("+apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",d))+")";}else{c.nodeValue=apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",d));}}else{var j=this.$getLayoutNode("item","image",l);if(j){if(j.nodeType==1){j.style.backgroundImage="url("+apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",d))+")";}else{j.nodeValue=apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",d));}}}var m=this.$getLayoutNode("item","caption",l);if(m){if(m.nodeType==1){m.innerHTML=this.$applyBindRule("caption",d);}else{m.nodeValue=this.$applyBindRule("caption",d);}}l.title=this.$applyBindRule("title",d)||"";var a=this.$applyBindRule("css",d);if(a||this.dynCssClasses.length){this.$setStyleClass(l,a,this.dynCssClasses);if(a&&!this.dynCssClasses.contains(a)){this.dynCssClasses.push(a);}}if(!i&&this.$updateModifier){this.$updateModifier(d,l);}};this.$moveNode=function(i,j){if(!j){return;}var a=j.parentNode;var d=this.getNextTraverse(i);var c=d?apf.xmldb.findHtmlNode(d,this):null;a.insertBefore(j,c);};this.$add=function(s,l,n,t,o){this.$getNewContext("item");var j=this.$getLayoutNode("item"),d=this.$getLayoutNode("item","select"),m=this.$getLayoutNode("item","icon"),a=this.$getLayoutNode("item","image"),q=this.$getLayoutNode("item","caption");j.setAttribute("id",l);d.setAttribute("onmouseover","apf.setStyleClass(this, 'hover');");d.setAttribute("onselectstart","return false;");d.setAttribute("style",(d.getAttribute("style")||"")+";user-select:none;-moz-user-select:none;-webkit-user-select:none;");if(this.hasFeature(apf.__RENAME__)||this.hasFeature(apf.__DRAGDROP__)){d.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+"); o.stopRename(); o.choose()");d.setAttribute("onmouseout","apf.setStyleClass(this, '', ['hover']);                this.hasPassedDown = false;");d.setAttribute(this.itemSelectEvent||"onmousedown","var o = apf.lookup("+this.$uniqueId+');                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 this.hasPassedDown = true;                 if (!o.renaming && o.hasFocus() && isSelected == 1)                     this.dorename = true;                 if (!o.hasFeature(apf.__DRAGDROP__) || o.mode != "normal" || !isSelected && !event.ctrlKey)                     o.select(this, event.ctrlKey, event.shiftKey)');d.setAttribute("onmouseup","if (!this.hasPassedDown) return;                var o = apf.lookup("+this.$uniqueId+');if (o.hasFeature(apf.__RENAME__) && this.dorename && o.mode == "normal")                    o.startDelayedRename(event);this.dorename = false;                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 if (o.mode == "normal" && o.hasFeature(apf.__DRAGDROP__))                     o.select(this, event.ctrlKey, event.shiftKey)');}else{d.setAttribute("onmouseout","apf.setStyleClass(this, '', ['hover']);");d.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+"); o.choose()");d.setAttribute(this.itemSelectEvent||"onmousedown","var o = apf.lookup("+this.$uniqueId+"); o.select(this, event.ctrlKey, event.shiftKey)");}if(m){if(m.nodeType==1){m.setAttribute("style","background-image:url("+apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",s))+")");}else{m.nodeValue=apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",s));}}else{if(a){if(a.nodeType==1){a.setAttribute("style","background-image:url("+apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",s))+")");}else{if(apf.isSafariOld){var c=a.ownerElement.parentNode,i=c.appendChild(c.ownerDocument.createElement("img"));i.setAttribute("src",apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",s)));}else{a.nodeValue=apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",s));}}}}if(q){apf.setNodeValue(q,this.$applyBindRule("caption",s));}j.setAttribute("title",this.$applyBindRule("tooltip",s)||"");var u=this.$applyBindRule("css",s);if(u){this.$setStyleClass(j,u);if(u){this.dynCssClasses.push(u);}}if(this.$addModifier){this.$addModifier(s,j);}if(t){apf.insertHtmlNode(j,t,o);}else{this.listNodes.push(j);}};this.$fill=function(){if(this.more&&!this.moreItem){this.$getNewContext("item");var c=this.$getLayoutNode("item"),d=this.$getLayoutNode("item","caption"),a=this.$getLayoutNode("item","select");c.setAttribute("class","more");a.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+');o.clearSelection();o.$setStyleClass(this, "more_down");');a.setAttribute("onmouseout","apf.lookup("+this.$uniqueId+').$setStyleClass(this, "", ["more_down"]);');a.setAttribute("onmouseup","apf.lookup("+this.$uniqueId+").startMore(this)");if(d){apf.setNodeValue(d,this.more.match(/caption:(.*)(;|$)/i)[1]);}this.listNodes.push(c);}apf.insertHtmlNodes(this.listNodes,this.$int);this.listNodes.length=0;if(this.more&&!this.moreItem){this.moreItem=this.$int.lastChild;}};this.startMore=function(c){this.$setStyleClass(c,"",["more_down"]);var a;if(!this.$actions.add){if(this.each&&!this.each.match(/[\/\[]/)){a="<"+this.each+(this.each.match(/^a:/)?" xmlns:a='"+apf.ns.aml+"'":"")+" custom='1' />";}else{return false;}}this.add(a,null,null,function(d){this.select(d,null,null,null,null,true);this.$int.appendChild(this.moreItem);var i=function(){this.getActionTracker().undo(this.autoselect?2:1);this.removeEventListener("stoprename",i);this.removeEventListener("beforerename",l);this.removeEventListener("afterrename",j);};var j=function(){this.removeEventListener("afterrename",j);};var l=function(n){this.removeEventListener("stoprename",i);this.removeEventListener("beforerename",l);var m=this.findXmlNodeByValue(n.args[1]);if(m||!n.args[1]){if(n.args[1]&&this.dispatchEvent("notunique",{value:n.args[1]})===false){this.startRename();this.addEventListener("stoprename",i);this.addEventListener("beforerename",l);}else{this.removeEventListener("afterrename",j);this.getActionTracker().undo();if(!this.isSelected(m)){this.select(m);}}return false;}};this.addEventListener("stoprename",i);this.addEventListener("beforerename",l);this.addEventListener("afterrename",j);this.startDelayedRename({},1);});};this.$calcSelectRange=function(d,a){var l=[],c=this.hasFeature(apf.__VIRTUALVIEWPORT__)?this.xmlRoot.selectNodes(this.each):this.getTraverseNodes(),m,j;for(m=false,j=0;j<c.length;j++){if(c[j]==d){m=true;}if(m){l.push(c[j]);}if(c[j]==a){m=false;}}if(!l.length||m){l=[];for(m=false,j=c.length-1;j>=0;j--){if(c[j]==d){m=true;}if(m){l.push(c[j]);}if(c[j]==a){m=false;}}}return l;};this.$selectDefault=function(a){this.select(this.getTraverseNodes()[0],null,null,null,true);};this.loadFillData=function(t){var s,a,l,n=t.splitSafe(","),q=[];for(var c,d,o=0;o<n.length;o++){if((d=n[o]).match(/^\d+-\d+$/)){c=d.split("-");a=parseInt(c[0]);l=parseInt(c[1]);if(c[0].length==c[1].length){s=Math.max(c[0].length,c[1].length);for(var m=a;m<l+1;m++){q.push("<item>"+(m+"").pad(s,"0")+"</item>");}}else{for(var m=a;m<l+1;m++){q.push("<item>"+m+"</item>");}}}else{q.push("<item>"+d+"</item>");}}this.$initingModel=true;this.each="item";this.$setDynamicProperty("caption","[label/text()|@caption|text()]");this.$setDynamicProperty("eachvalue","[value/text()|@value|text()]");this.$canLoadDataAttr=false;this.load("<data>"+q.join("")+"</data>");};}).call(apf.BaseList.prototype=new apf.MultiSelect());apf.__VIRTUALVIEWPORT__=1<<19;apf.VirtualViewport=function(){this.$init(true);this.$regbase=this.$regbase|apf.__VIRTUALVIEWPORT__;this.virtualVTimer=null;this._xmlUpdate=this.$xmlUpdate;apf.setStyleClass(this.$ext,"virtual");this.$deInitNode=function(j,l){this.viewport.redraw();};this.$moveNode=function(j,l){this.viewport.redraw();};this.emptyNode=apf.xmldb.getXml("<empty />");this.$addEmpty=this.$add;this.$add=function(m,l,n,q,j){var o=this.$pHtmlDoc.getElementById(l);if(!o){return;}this.$updateNode(m,o);};this.$fill=function(){};this.addEventListener("$load",function(){if(!this.viewport.limit){this.viewport.limit=1;}});this.clear=function(l,j){if(this.clearSelection){this.clearSelection(!j);}this.documentId=this.xmlRoot=this.cacheId=null;if(!l){this.viewport.offset=0;this.viewport.length=0;this.viewport.resize(0);this.viewport.sb.update();this.$setClearMessage(this["empty-message"]);}else{if(this.$removeClearMessage){this.$removeClearMessage();}}this.viewport.cache=null;};var a=this;this.viewport={offset:0,limit:2,length:0,sb:new apf.scrollbar(),host:this,cache:null,inited:false,draw:function(){this.inited=true;var j=this.limit;this.limit=0;this.resize(j,true);},redraw:function(){this.change(this.offset);},prepare:function(){if(!this.inited){this.draw();}var n=a.getTraverseNodes();if(!n){return;}var s=apf.xmldb.getXmlDocId(a.xmlRoot),t=a.$int.childNodes;for(var o=0,q=0,m=t.length;q<m;q++){if(t[q].nodeType!=1){continue;}t[q].style.display=(o>=n.length)?"none":"block";apf.xmldb.nodeConnect(s,n[o],t[q],a);o++;}},resize:function(j,n){this.cache=null;var m;if(j<this.limit){var l=a.$int.childNodes;for(m=l.length-1;m>=0;m--){if(l[m].nodeType!=1){continue;}a.$int.removeChild(l[m]);if(--this.limit==j){break;}}}else{if(j>this.limit){for(m=this.limit;m<j;m++){a.$addEmpty(a.emptyNode,"",a.xmlRoot,a.$int);}}else{return;}}this.limit=j;if(n){this.sb.update(this.$int);}},findNewLimit:function(s){var q=a.$int;if(!s){s=q.scrollTop;}if(!a.xmlRoot||q.lastChild&&q.lastChild.style.display=="none"){return;}if(!q.lastChild||q.lastChild.offsetTop+q.lastChild.offsetHeight<=q.offsetHeight+s){var l,m,j,o=a.$getSelection();while(this.limit<this.length-1&&(!q.lastChild||q.lastChild.offsetTop+q.lastChild.offsetHeight<=q.offsetHeight+s)){this.limit++;j=a.getTraverseNodes();if(j.length<this.limit){this.limit=j.length;break;}m=j[j.length-1];l=apf.xmldb.nodeConnect(a.documentId,m,null,a);a.$addEmpty(m,l,a.xmlRoot,q);if(o.indexOf(m)>-1){a.$select(q.lastChild);}else{a.$deselect(q.lastChild);}}}else{if(q.lastChild&&q.lastChild.offsetTop>q.offsetHeight+s){var n;while(this.limit>2&&(n=q.lastChild).offsetTop>q.offsetHeight+s){a.$int.removeChild(n);this.limit--;}}}if(!this.initialLimit){this.initialLimit=this.limit;}},change:function(q,J,A,o){var l;if(q<0){q=0;}if(q>this.length-this.limit-1){l=Math.floor(this.length-this.limit-1);}else{l=Math.floor(q);}if(!J){J=this.limit;}this.cache=null;var u=l-this.offset,G=this.limit;if(u*u>=this.limit*this.limit){u=false;}this.offset=l;if(u>0){var s=a.$int.lastChild;if(s.nodeType!=1){s=s.previousSibling;}}if(A){this.sb.$curValue=this.offset/(this.length-this.limit-1);this.sb.updatePos();}var z=a.getTraverseNodes();if(!z){return;}if(z.length<this.limit){if(q>0){alert("shouldnt get here");}else{this.resize(z.length);}}var D=apf.xmldb.getXmlDocId(a.xmlRoot),w=a.$int.childNodes,n,t,B,C,I,E,F;if(u>0){B=G-u;I=w.length,C=a.$getSelection();for(E=0,F=0;E<u&&F<I;F++){t=a.$int.firstChild;if(t.nodeType==1){E++;n=z[B++];if(n){apf.xmldb.nodeConnect(D,n,t,a);a.$updateNode(n,t);if(C.indexOf(n)>-1){a.$select(t);}else{a.$deselect(t);}t.style.display="block";}else{t.style.display="none";}}a.$int.appendChild(t);}}else{if(u<0){u=u*-1;B=0;C=a.$getSelection();for(E=0,F=w.length-1;E<u&&F>=0;F++){t=a.$int.lastChild;if(t.nodeType==1){E++;n=z[B++];apf.xmldb.nodeConnect(D,n,t,a);a.$updateNode(n,t);if(C.indexOf(n)>-1){a.$select(t);}else{a.$deselect(t);}t.style.display="block";}a.$int.insertBefore(t,a.$int.firstChild);}}else{if(u===false){I=w.length;C=a.$getSelection();for(E=0,F=0;F<I;F++){t=w[F];if(t.nodeType==1){n=z[E++];apf.xmldb.nodeConnect(D,n,t,a);a.$updateNode(n,t);if(C.indexOf(n)>-1){a.$select(t);}else{a.$deselect(t);}}}}}}if(!o){if(q>=this.length-this.initialLimit){u=q-(this.length-this.initialLimit)+2;a.$int.scrollTop=(a.$int.scrollHeight-a.$int.offsetHeight)*(u/2);}else{var m=(q%1)*a.$int.firstChild.offsetHeight;this.findNewLimit(m);a.$int.scrollTop=m;}if(A){this.sb.update();}return;}}};this.viewport.sb.parentNode=new apf.Class().$init();this.viewport.sb.parentNode.$int=this.$pHtmlNode;this.viewport.sb.dispatchEvent("DOMNodeInsertedIntoDocument");this.viewport.sb.attach(this.$int,this.viewport,function(n,o){var m=a.viewport;if(m.sb.realtime||!n){var j=m.length-m.initialLimit;if(j==0){a.$int.scrollTop=o*(a.$int.scrollHeight-a.$int.offsetHeight);}else{m.change(j*o,m.limit,false);}}else{clearTimeout(this.virtualVTimer);this.virtualVTimer=$setTimeout(function(){m.change(Math.round((m.length-m.initialLimit)*o),m.limit,false);},300);}});apf.layout.setRules(this.$int,"scrollbar","        var s = apf.all["+this.viewport.sb.$uniqueId+"];        s.update();    ",true);apf.layout.queue(this.$int);this.$isInViewport=function(o,q){var m=this.getTraverseNodes();for(var n=0,j=m.length;n<j;n++){if(m[n]==o){return true;}}return false;};this.scrollTo=function(l,m){var j={};this.$isInViewport(l,j);this.viewport.change(j.position+(m?this.viewport.limit-1:0));};this.getFirstTraverseNode=function(j){return this.getTraverseNodes(j)[0];};this.$clearVirtualDataset=function(j){var l=j.childNodes;for(var m=l.length-1;m>=0;m--){j.removeChild(l[m]);}};this.$createVirtualDataset=function(m,n,l){var j=m.selectSingleNode("a_marker")||m.appendChild(m.ownerDocument.createElement("a_marker"));j.setAttribute("start","0");if(n){j.setAttribute("end",n);j.setAttribute("reserved",++this.nodeCount[l]);this.nodeCount[l]+=n;}};this.$xmlUpdate=function(){this.viewport.cache=null;this.viewport.length=this.xmlRoot.selectNodes(this.each).length;this.viewport.sb.update(this.$int);this._xmlUpdate.apply(this,arguments);};this.$load=function(j){apf.xmldb.addNodeListener(j,this);if(!this.renderRoot&&!this.getTraverseNodes(j).length){return this.clear("loading");}if(this.$hasBindRule("load")){this.$createVirtualDataset(j);}this.viewport.cache=null;this.viewport.length=this.xmlRoot.selectNodes(this.each).length+1;this.viewport.prepare();var l=this.$addNodes(j,null,null,this.renderRoot);this.viewport.sb.update(this.$int);if(this.selectable){if(this.autoselect){if(l.length){this.$selectDefault(j);}else{this.setProperty("selected",null);}}else{this.clearSelection(true);var m=this.getFirstTraverseNode();if(m){this.setCaret(m);}this.setProperty("selected",null);this.setProperty("chosen",null);}}if(this.$focussable){apf.window.hasFocus(this)?this.$focus():this.$blur();}};this.$loadSubData=function(){};this.$loadPartialData=function(j,q,l){var o,n=this.$getBindRule("load",xmlRootNode);if(n&&(!n[1]||n[1](xmlRootNode))){this.$setLoadStatus(xmlRootNode,"loading");var m=this.getModel(true);m.$insertFrom(n.getAttribute("get"),{ascending:this.$sort?this.$sort.get().ascending:true,xmlNode:o,documentId:this.documentId,marker:j,start:q,length:l,insertPoint:this.xmlRoot,amlNode:this,callback:function(s){a.setProperty("root",a.xmlRoot);var t=parseInt(apf.queryValue(s,n.getAttribute("total")));if(a.viewport.length!=t){a.viewport.length=t;this.$createVirtualDataset(a.xmlRoot,a.viewport.length,a.documentId);}}});}};function c(j,m,n){for(var l=0;l<j;l++){m.push(a.documentId+"|"+(n+l));}}function d(o,w,j,u){var s,l,n,A=this.viewport.limit,z=[];if(w==-1){l=u.selectNodes(a.each);n=0;s=o[0];}else{if(j<0){c(Math.abs(j),z,parseInt(s.getAttribute("reserved"))+parseInt(s.getAttribute("end"))-parseInt(s.getAttribute("start"))+j);j=0;a.$loadPartialData(s);if(z.length==A){return z;}}l=o[w].selectNodes("following-sibling::"+this.each.split("|").join("following-sibling::"));n=o[w].getAttribute("end");s=o[++w];}do{var t=Math.min(s.getAttribute("start")-n,A);for(var q=j;q<t;q++){z.push(l[q]);}if(z.length==A){break;}var m=parseInt(s.getAttribute("end"))-parseInt(s.getAttribute("start"));c(Math.min(m,A-z.length),z,parseInt(s.getAttribute("reserved")));a.$loadPartialData(s);n=parseInt(s.getAttribute("end"));s=o[++w];j=0;}while(z.length<A&&s);a.viewport.cache=z;return z;}this.getTraverseNodes=function(m){if(!this.xmlRoot){return;}if(this.viewport.cache){return this.viewport.cache;}var q=this.viewport.offset+1,j=q+this.viewport.limit;var o=(m||this.xmlRoot).selectNodes("a_marker");if(!o.length){var n=(m||this.xmlRoot).selectNodes("("+this.each+")[position() >= "+q+" and position() < "+(j)+"]");return this.$sort?this.$sort.apply(n):n;}for(var l=0;l<o.length;l++){if(o[l].getAttribute("end")<q){if(l==o.length-1){return d(o,l,q-o[l].getAttribute("end"),(m||this.xmlRoot));}continue;}if(o[l].getAttribute("start")-j<=0&&q>=o[l].getAttribute("start")){return d(o,l,q-o[l].getAttribute("end"),(m||this.xmlRoot));}else{if(o[l-1]){return d(o,l-1,q-o[l-1].getAttribute("end"),(m||this.xmlRoot));}else{return d(o,-1,q,(m||this.xmlRoot));}}}};var i=this.getNextTraverseSelected;this.getNextTraverseSelected=function(n,j,q){if(!n){n=this.selected;}if(!q){q=1;}var o=i.call(this,n,j,q);if(o&&o!=n){return o;}var l=this.getTraverseNodes(),m=0;while(l[m]&&l[m]!=n){m++;}if(j){m=-1*(l.length-m-1);}this.viewport.change(Math.max(0,this.viewport.offset+m+(j?q:-1*q)),null,true,true);l=this.getTraverseNodes();return l[j?l.length-1:0];};this.caching=false;};apf.BaseStateButtons=function(){this.state="normal";this.edit=false;this.animate=true;var l={min:["minimized","minimize","restore"],max:["maximized","maximize","restore"],edit:["edit","edit","closeedit"],close:["closed","close","show"]};this.$lastheight=null;this.$lastpos=null;this.$lastzindex=null;this.$lastState={normal:true};this.$booleanProperties.animate=true;this.$supportedProperties.push("buttons","animate","state");this.close=function(){this.setProperty("state",this.state.split("|").pushUnique("closed").join("|"),false,true);return this;};this.minimize=function(){this.setProperty("state",this.state.split("|").remove("maximized").remove("normal").pushUnique("minimized").join("|"),false,true);return this;};this.maximize=function(){this.setProperty("state",this.state.split("|").remove("minimized").remove("normal").pushUnique("maximized").join("|"),false,true);return this;};this.restore=function(){this.setProperty("state",this.state.split("|").remove("minimized").remove("maximized").pushUnique("normal").join("|"),false,true);return this;};this.edit=function(m){this.setProperty("state",this.state.split("|").pushUnique("edit").join("|"),false,true);return this;};this.closeedit=function(m){this.setProperty("state",this.state.split("|").remove("edit").join("|"),false,true);return this;};this.$toggle=function(m){var n=l[m][0];this[l[m][this.state.indexOf(n)>-1?2:1]]();};this.$propHandlers.refparent=function(m){if(typeof m=="string"){this.$refParent=self[m]&&self[m].$ext||document.getElementById(m);}else{this.$refParent=m;}};this.$propHandlers.state=function(D,E,M,u){var n=this;if(!this.$amlLoaded){apf.queue.add("state"+this.$uniqueId,function(){n.$propHandlers.state.call(n,D,E);});return;}var J,m,O,F,A,C={},B=D.split("|"),I=this.$lastState,z=[];for(J=0;J<B.length;J++){C[B[J]]=true;}C.value=D;if(!C.maximized&&!C.minimized){C.normal=true;}if(!u&&this.dispatchEvent("beforestatechange",{from:I,to:C})===false){this.state=I.value;return false;}if(C.closed==this.visible){this.setProperty("visible",!C.closed);}if(C.normal!=I.normal||!C.normal&&(C.minimized!=I.minimized||C.maximized!=I.maximized)){if(this.$lastheight){this.$ext.style.height=this.$lastheight;}if(this.$lastpos){if(this.animate&&!E){var w=this.$ext;O=apf.getStyle(w,"position");if(O!="absolute"){F=parseInt(apf.getStyle(w,"left"))||0;A=parseInt(apf.getStyle(w,"top"))||0;}else{F=w.offsetLeft;A=w.offsetTop;}this.animstate=1;apf.tween.multi(w,{steps:5,interval:10,tweens:[{type:"left",from:F,to:this.$lastpos.px[0]},{type:"top",from:A,to:this.$lastpos.px[1]},{type:"width",from:this.$ext.offsetWidth-j,to:this.$lastpos.px[2]},{type:"height",from:this.$ext.offsetHeight-c,to:this.$lastpos.px[3]}],oneach:function(){if(apf.hasSingleRszEvent){apf.layout.forceResize(n.$int);}},onfinish:function(){n.$propHandlers.state.call(n,D,true,null,true);}});return;}this.$ext.style.left=this.$lastpos.css[0];this.$ext.style.top=this.$lastpos.css[1];this.$ext.style.width=this.$lastpos.css[2];this.$ext.style.height=this.$lastpos.css[3];m=this.$lastpos.parentNode;m.style.width=this.$lastpos.parent[0];m.style.height=this.$lastpos.parent[1];m.style.overflow=this.$lastpos.parent[2];}if(this.aData&&this.aData.restore){this.aData.restore();}if(apf.layout){apf.layout.play(this.$pHtmlNode);}if(this.$lastzindex){this.$ext.style.zIndex=this.$lastzindex[0];if(this.oCover){this.oCover.style.zIndex=this.$lastzindex[1];}}this.$lastheight=this.$lastpos=this.$lastzindex=null;if(C.normal){z.push("",this.$baseCSSname+"Max",this.$baseCSSname+"Min");}}if(C.minimized!=I.minimized){if(C.minimized){z.unshift(this.$baseCSSname+"Min",this.$baseCSSname+"Max",this.$baseCSSname+"Edit");if(this.aData&&this.aData.minimize){this.aData.minimize(this.collapsedHeight);}if(!this.aData||!this.aData.minimize){this.$lastheight=apf.getStyle(this.$ext,"height");this.$ext.style.height=Math.max(0,this.collapsedHeight-apf.getHeightDiff(this.$ext))+"px";}if(this.hasFocus()){apf.window.moveNext(null,this,true);}}else{z.push(this.$baseCSSname+"Min");$setTimeout(function(){apf.window.$focusLast(n);});}}if(C.maximized!=I.maximized){if(C.maximized){z.unshift(this.$baseCSSname+"Max",this.$baseCSSname+"Min",this.$baseCSSname+"Edit");m=this.$refParent;if(!m){m=(this.$ext.offsetParent==document.body?document.documentElement:this.$ext.parentNode);}n.animstate=0;var N=false,w=this.$ext;var O=apf.getStyle(w,"position");if(O=="absolute"){m.style.overflow="hidden";F=w.offsetLeft;A=w.offsetTop;}else{var q=apf.getAbsolutePosition(w,m);F=q[0];A=q[1];}this.$lastpos={css:[this.$ext.style.left,this.$ext.style.top,this.$ext.style.width,this.$ext.style.height],px:[F,A,this.$ext.offsetWidth-j,this.$ext.offsetHeight-c],parent:[m.style.width,m.style.height,m.style.overflow],parentNode:m};var G=[w.offsetWidth,w.offsetHeight];function K(){var o=!apf.isIE&&m==document.documentElement?window.innerWidth:m.offsetWidth,s=!apf.isIE&&m==document.documentElement?window.innerHeight:m.offsetHeight;if(O!="absolute"){var Q=apf.getDiff(m);o-=Q[0]+(!n.$refParent&&apf.isIE8?4:0);s-=Q[0]+(!n.$refParent&&apf.isIE8?4:0);}else{if(!n.$refParent&&apf.isIE8){o-=4;s-=4;}}var P=n.$refParent?[0,0,0,0]:i,R=m!=w.offsetParent?apf.getAbsolutePosition(m,w.offsetParent):[0,0],t=apf.getDiff(m);m.style.width=(m.offsetWidth-t[0])+"px";m.style.height=(m.offsetHeight-t[1])+"px";if(n.animate&&!N){n.animstate=1;N=true;apf.tween.multi(w,{steps:5,interval:10,tweens:[{type:"left",from:F,to:R[0]-P[3]},{type:"top",from:A,to:R[1]-P[0]},{type:"width",from:G[0]-j,to:(o-j+P[1]+P[3])},{type:"height",from:G[1]-c,to:(s-c+P[0]+P[2])}],oneach:function(){if(apf.hasSingleRszEvent){apf.layout.forceResize(n.$int);}},onfinish:function(){n.animstate=0;n.dispatchEvent("afterstatechange",{from:I,to:C});}});}else{if(!n.animstate){w.style.left=(R[0]-P[3])+"px";w.style.top=(R[1]-P[0])+"px";w.style.width=(o-j+P[1]+P[3])+"px";w.style.height=(s-c+P[0]+P[2])+"px";}}}if(apf.layout){apf.layout.pause(this.$pHtmlNode,K);}this.$lastzindex=[this.$ext.style.zIndex||1,this.oCover&&this.oCover.style.zIndex||1];if(this.oCover){this.oCover.style.zIndex=apf.WinServer.count+1;}this.$ext.style.zIndex=apf.WinServer.count+2;}else{z.push(this.$baseCSSname+"Max");}}if(C.edit!=I.edit){if(C.edit){z.unshift(this.$baseCSSname+"Edit",this.$baseCSSname+"Max",this.$baseCSSname+"Min");if(this.btnedit){d.edit.innerHTML="close";}this.dispatchEvent("editstart");}else{if(this.dispatchEvent("editstop")===false){return false;}z.push(this.$baseCSSname+"Edit");if(z.length==1){z.unshift("");}if(this.btnedit){d.edit.innerHTML="edit";}}}if(z.length||C.closed!=I.closed){if(z.length){this.$setStyleClass(this.$ext,z.shift(),z);}if(C.edit){this.dispatchEvent("prop.visible",{value:true});if(n.oSettings){apf.layout.forceResize(n.oSettings);}}if(!C.maximized||I.maximized&&n.animate){n.dispatchEvent("afterstatechange",{from:I,to:C});}this.$lastState=C;if(this.aData&&!C.maximized){this.$purgeAlignment();}if(!this.animate&&apf.hasSingleRszEvent&&apf.layout){apf.layout.forceResize(n.$int);}}};var i,j,c,d={};this.$propHandlers.buttons=function(t){if(apf.isIphone){return;}if(!this.$hasLayoutNode("button")){return;}var q=t&&(t=t.replace(/(\|)\||\|$/,"$1")).split("|")||[],m=this.$buttons.childNodes,w=t&&new RegExp("("+t+")"),z={},u=[];for(var o=0;o<m.length;o++){if(m[o].nodeType!=1||m[o].tagName!="DIV"){continue;}if(m[o].getAttribute("button")&&(!t||!m[o].className||!m[o].className.match(w))){m[o].style.display="none";this.$setStyleClass(m[o],"",["min","max","close","edit"]);u.push(m[o]);}else{z[RegExp.$1]=m[o];}}for(o=0;o<q.length;o++){if(!q[o]){continue;}if(z[q[o]]){this.$buttons.insertBefore(z[q[o]],this.$buttons.firstChild);continue;}var n=u.pop();if(!n){this.$getNewContext("button");n=this.$getLayoutNode("button");n.setAttribute("button","button");a(n);n=apf.insertHtmlNode(n,this.$buttons);}this.$setStyleClass(n,q[o],["min","max","close","edit"]);n.onclick=new Function("apf.lookup("+this.$uniqueId+").$toggle('"+q[o]+"')");n.style.display="block";d[q[o]]=n;this.$buttons.insertBefore(n,this.$buttons.firstChild);}var s=apf.getDiff(this.$ext);j=s[0];c=s[1];i=apf.getBox(apf.getStyle(this.$ext,"borderWidth"));};function a(m){m.setAttribute("onmousedown","apf.setStyleClass(this, 'down');             event.cancelBubble = true;              var o = apf.findHost(this).$ext;             if (o.onmousedown) o.onmousedown(event);             apf.window.$mousedown(event);");m.setAttribute("onmouseup","apf.setStyleClass(this, '', ['down'])");m.setAttribute("onmouseover","apf.setStyleClass(this, 'hover')");m.setAttribute("onmouseout","apf.setStyleClass(this, '', ['hover', 'down'])");}this.$initButtons=function(s){this.collapsedHeight=this.$getOption("Main","collapsed-height");var q=this.$getLayoutNode("main","buttons",s);if(!q||apf.isIphone||!this.getAttribute("buttons")||!this.$hasLayoutNode("button")){return;}var m=(this.getAttribute("buttons")||"").split("|").length;for(var o,n=0;n<m;n++){this.$getNewContext("button");o=q.appendChild(this.$getLayoutNode("button"));o.setAttribute("button","button");a(o);}};this.addEventListener("DOMNodeRemovedFromDocument",function(n){for(var m in d){d[m].onclick=null;}});};apf.Teleport=function(){this.$init(true);};apf.__TELEPORT__=1<<28;(function(){this.$parsePrio="002";this.$regbase=this.$regbase|apf.__TELEPORT__;this.$booleanProperties.autoroute=true;this.$supportedProperties.push("url","timeout","protocol","route-server","autoroute");this.$propHandlers.url=function(c){var a=new apf.url(c);if(!a.protocol){throw new Error(apf.formatErrorString(0,this,"Communication (Teleport) initialization error","Invalid server url provided."));}this.$domain=a.host;this.$rootPath=a.path;this.$server=c.replace(new RegExp(this.$rootPath+"$"),"");};this.$propHandlers.timeout=function(a){this.timeout=parseInt(a)||10000;};this.$propHandlers.protocol=function(c){var a=c.toLowerCase();if(!apf[a]){throw new Error(apf.formatErrorString(1025,null,"Teleport baseclass","Could not find Ajax.org Teleport RPC Component '"+a+"'",this));}this.implement(apf[a]);};this.toString=function(){return"[Ajax.org Teleport Component : "+(this.name||"")+" ("+this.type+")]";};this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(!apf.http){throw new Error(apf.formatErrorString(1024,null,"Teleport baseclass","Could not find Ajax.org Teleport HTTP Component",this.$aml));}this.implement(apf.http);if(this.id){apf.$asyncObjects[this.id]=1;}});}).call(apf.Teleport.prototype=new apf.AmlElement());apf.Init.run("teleport");apf.__INTERACTIVE__=1<<21;apf.Interactive=function(){var q,o,ab,Z,c,M=null,aa,T,F,U,aj,u,O,ad,d,af,a,A,j,E,R,Q,ac,s=this,ae,Y,X,J,V,z,i;this.$regbase=this.$regbase|apf.__INTERACTIVE__;this.$propHandlers.draggable=function(t){if(apf.isFalse(t)){this.draggable=t=false;}else{if(apf.isTrue(t)){this.draggable=t=true;}}var w=this.oDrag||this.$ext;if(w.interactive&1){return;}var l=w.onmousedown;w.onmousedown=function(){if(l&&l.apply(this,arguments)===false){return;}m.apply(this,arguments);};w.interactive=(w.interactive||0)+1;};this.$propHandlers.resizable=function(w){if(apf.isFalse(w)){this.resizable=w=false;}else{if(apf.isTrue(w)){this.resizable=w=true;}}var ak=this.oResize||this.$ext;if(ak.interactive&2){return;}var l=ak.onmousedown;var t=ak.onmousemove;ak.onmousedown=function(){if(l&&l.apply(this,arguments)===false){return;}K.apply(this,arguments);};ak.onmousemove=function(){if(t&&t.apply(this,arguments)===false){return;}D.apply(this,arguments);};ak.interactive=(ak.interactive||0)+2;j=this.$getOption&&parseInt(this.$getOption("Main","resize-border"))||3;E=this.$getOption&&parseInt(this.$getOption("Main","resize-corner"))||12;R=apf.getBox(apf.getStyle(this.$ext,apf.isIE?"borderWidth":"border-width"));};function m(t){if(!t){t=event;}if(!s.draggable||apf.dragMode){return;}V=s.dragOutline==true||apf.config.dragOutline;apf.dragMode=true;J=false;apf.popup.forceHide();ae="absolute|fixed".indexOf(apf.getStyle(s.$ext,"position"))>-1;if(!ae){s.$ext.style.position=(ae=s.dragSelection)?"absolute":"relative";}if(ae&&!s.aData){apf.plane.show(V?N:s.$ext);}var w=ae?apf.getAbsolutePosition(s.$ext,s.$ext.offsetParent):[parseInt(apf.getStyle(s.$ext,"left"))||0,parseInt(apf.getStyle(s.$ext,"top"))||0];q=w[0]-(Y=t.clientX);o=w[1]-(X=t.clientY);if(ae&&V){N.className="drag";var l=apf.getDiff(N);s.$ext.parentNode.appendChild(N);N.style.left=w[0]+"px";N.style.top=w[1]+"px";N.style.width=(s.$ext.offsetWidth-l[0])+"px";N.style.height=(s.$ext.offsetHeight-l[1])+"px";if(s.dragSelection){N.style.display="block";}}document.onmousemove=n;document.onmouseup=function(){document.onmousemove=document.onmouseup=null;if(ae&&!s.aData){apf.plane.hide();}var ak=V?N:s.$ext;if(J){if(s.setProperty){if(s.right||s.bottom){var al=s.$ext.offsetParent;if(al.tagName=="BODY"){al=document.documentElement;}}if(s.right){s.setProperty("right",al.offsetWidth-ak.offsetLeft-ak.offsetWidth);}if(s.bottom){s.setProperty("bottom",al.offsetHeight-ak.offsetTop-ak.offsetHeight);}if(aa&&(!s.right||s.left)){s.setProperty("left",aa);}if(T&&(!s.bottom||s.top)){s.setProperty("top",T);}}else{if(V){s.$ext.style.left=aa+"px";s.$ext.style.top=T+"px";}}}aa=T=O=ad=null;if(!ae){s.$ext.style.position="relative";}if(s.showdragging){apf.setStyleClass(s.$ext,"",["dragging"]);}if(ae&&V){N.style.display="none";}apf.dragMode=false;if(s.dispatchEvent){s.dispatchEvent("drag",{htmlNode:ak});}};if(apf.isIE){apf.window.$mousedown(t);}return false;}function n(ak){if(!ak){ak=event;}if(s.dragSelection){J=true;}if(!J&&s.showdragging){apf.setStyleClass(s.$ext,"dragging");}var t=ak.clientX-Y,l=ak.clientY-X,al;if(!J&&(al=t*t>l*l?t:l)*al<2){return;}else{if(!J&&V&&N.style.display!="block"){N.style.display="block";}}var w=V?N:s.$ext;w.style.left=(aa=ak.clientX+q)+"px";w.style.top=(T=ak.clientY+o)+"px";J=true;}this.$resizeStart=K;function K(w,ap){if(!w){w=event;}if(!s.resizable){return;}z=!(s.resizeOutline==false||!apf.config.resizeOutline);if(!z){var ao=apf.getDiff(s.$ext);ac=ao[0];Q=ao[1];}c=apf.getAbsolutePosition(s.$ext);c.push(s.$ext.offsetWidth);c.push(s.$ext.offsetHeight);i=apf.getAbsolutePosition(s.$ext,s.$ext.offsetParent);var ak=0,am=0,an=(Y=w.clientX)-c[0]+ak+document.documentElement.scrollLeft,al=(X=w.clientY)-c[1]+am+document.documentElement.scrollTop,t;if(ap&&ap.resizeType){ae="absolute|fixed".indexOf(apf.getStyle(s.$ext,"position"))>-1;t=ap.resizeType;}else{t=P.call(s.$ext,an,al);}ab=an;Z=al;if(!t){return;}if(s.dispatchEvent&&s.dispatchEvent("resizestart",{type:t})===false){return;}apf.popup.forceHide();if(s.$ext.style.right){s.$ext.style.left=s.$ext.offsetLeft+"px";s.$ext.style.right="";}if(s.$ext.style.bottom){s.$ext.style.top=s.$ext.offsetTop+"px";s.$ext.style.bottom="";}apf.dragMode=true;J=false;d=t.indexOf("w")>-1;af=t.indexOf("n")>-1;a=t.indexOf("e")>-1;A=t.indexOf("s")>-1;if(!s.minwidth){s.minwidth=0;}if(!s.minheight){s.minheight=0;}if(!s.maxwidth){s.maxwidth=10000;}if(!s.maxheight){s.maxheight=10000;}if(ae){F=c[0]+c[2]-s.minwidth;U=c[1]+c[3]-s.minheight;aj=c[0]+c[2]-s.maxwidth;u=c[1]+c[3]-s.maxheight;}if(ae){apf.plane.show(z?N:s.$ext);}if(z){N.className="resize";var l=apf.getDiff(N);ac=l[0];Q=l[1];N.style.left=c[0]+"px";N.style.top=c[1]+"px";N.style.width=(s.$ext.offsetWidth-ac)+"px";N.style.height=(s.$ext.offsetHeight-Q)+"px";N.style.display="block";}if(!ap||!ap.nocursor){if(M===null){M=document.body.style.cursor;}document.body.style.cursor=t+"-resize";}document.onmousemove=B;document.onmouseup=function(ar){document.onmousemove=document.onmouseup=null;if(ae){apf.plane.hide();}if(z){var aq=apf.getDiff(s.$ext);ac=aq[0];Q=aq[1];}ah(ar||event,true);if(s.setProperty){W();}aa=T=O=ad=null;document.body.style.cursor=M;M=null;if(z){N.style.display="none";}apf.dragMode=false;if(s.dispatchEvent){s.dispatchEvent("resize");}};if(apf.isIE){apf.window.$mousedown(w);}return false;}function W(){if(ae){var l=s.$ext;if(s.right||s.bottom){var t=l.offsetParent;if(t.tagName=="BODY"){t=document.documentElement;}}if(s.right&&s.right!=s.setProperty("right",t.offsetWidth-l.offsetLeft-l.offsetWidth)){l.style.left="";}if(s.bottom&&s.bottom!=s.setProperty("bottom",t.offsetHeight-l.offsetTop-l.offsetHeight)){l.style.top="";}if(aa&&(!s.right||s.left)){s.setProperty("left",aa);}if(T&&(!s.bottom||s.top)){s.setProperty("top",T);}}if(O&&(!s.left||!s.right)){s.setProperty("width",O+ac);}if(ad&&(!s.top||!s.bottom)){s.setProperty("height",ad+Q);}}var ag=Math.min,C=Math.max,ai;function B(l){if(!l){l=event;}if(ai&&new Date().getTime()-ai<(z?6:apf.mouseEventBuffer)){return;}ai=new Date().getTime();ah(l);}function ah(al,ak){var w=z&&!ak?N:s.$ext;var t=document.documentElement.scrollLeft,l=document.documentElement.scrollTop;if(d){w.style.left=(aa=C(aj,ag(F,i[0]+al.clientX-Y+t)))+"px";w.style.width=(O=ag(s.maxwidth-ac,C(ac,s.minwidth,c[2]-(al.clientX-Y)+t)-ac))+"px";}if(af){w.style.top=(T=C(u,ag(U,i[1]+al.clientY-X+l)))+"px";w.style.height=(ad=ag(s.maxheight-Q,C(Q,s.minheight,c[3]-(al.clientY-X)+l)-Q))+"px";}if(a){w.style.width=(O=ag(s.maxwidth-ac,C(ac,s.minwidth,al.clientX-c[0]+(c[2]-ab)+t)-ac))+"px";}if(A){w.style.height=(ad=ag(s.maxheight-Q,C(Q,s.minheight,al.clientY-c[1]+(c[3]-Z)+l)-Q))+"px";}if(s.parentNode.localName=="table"){W();apf.layout.processQueue();}if(apf.hasSingleRszEvent){apf.layout.forceResize(s.$int);}}function P(l,ak){var w="",t="";ae="absolute|fixed".indexOf(apf.getStyle(s.$ext,"position"))>-1;if(s.resizable==true||s.resizable=="vertical"){if(ak<j+R[0]){w=ae?"n":"";}else{if(ak>this.offsetHeight-j){w="s";}else{if(ak>this.offsetHeight-E){t="s";}}}}if(s.resizable==true||s.resizable=="horizontal"){if(l<(w?E:j)+R[0]){w+=t+(ae?"w":"");}else{if(l>this.offsetWidth-(w||t?E:j)){w+=t+"e";}}}return w;}var G;function D(ak){if(!ak){ak=event;}if(!s.resizable||document.onmousemove){return;}var an=apf.getAbsolutePosition(s.$ext),w=0,t=0,l=ak.clientX-an[0]+w+document.documentElement.scrollLeft,am=ak.clientY-an[1]+t+document.documentElement.scrollTop;if(!G){G=apf.getStyle(this,"cursor");}var al=P.call(s.$ext,l,am);this.style.cursor=al?al+"-resize":G||"default";}var N;function I(l){N=this.$pHtmlDoc.getElementById("apf_outline");if(!N){N=this.$pHtmlDoc.body.appendChild(this.$pHtmlDoc.createElement("div"));N.refCount=0;N.setAttribute("id","apf_outline");N.style.position="absolute";N.style.display="none";N.style.zIndex=2000000;}N.refCount++;}if(this.addEventListener&&this.hasFeature(apf.__AMLNODE__)){this.addEventListener("DOMNodeInsertedIntoDocument",I);}else{this.$pHtmlDoc=document;I.call(this);}};apf.GuiElement.propHandlers.resizable=function(a){this.implement(apf.Interactive);this.$propHandlers.resizable.apply(this,arguments);};apf.GuiElement.propHandlers.draggable=function(a){this.implement(apf.Interactive);this.$propHandlers.draggable.apply(this,arguments);};apf.__DELAYEDRENDER__=1<<11;apf.DelayedRender=function(){this.$regbase=this.$regbase|apf.__DELAYEDRENDER__;this.$rendered=false;this.$render=function(c){if(this.$rendered){return;}if(this.dispatchEvent("beforerender")===false){return;}if(this["render-delay"]||c){$setTimeout("apf.lookup("+this.$uniqueId+").$renderparse()",10);}else{this.$renderparse();}};this.$renderparse=function(){if(this.$rendered){return;}var c=this.ownerDocument.$domParser;c.parseFromXml(this.$aml,{amlNode:this,doc:this.ownerDocument,delayedRender:true});c.$continueParsing(this);this.$rendered=true;this.dispatchEvent("afterrender");};var a;this.addEventListener("prop.visible",a=function(){if(arguments[0].value){this.$render();this.removeEventListener("prop.visible",a);}});};apf.GuiElement.propHandlers.render=function(a){if(!this.hasFeature(apf.__DELAYEDRENDER__)&&a=="runtime"){this.implement(apf.DelayedRender);if(this.localName!="page"){this.visible=false;this.$ext.style.display="none";}if(typeof this["render-delay"]=="undefined"){this.$setInheritedAttribute("render-delay");}}};apf.config.$inheritProperties["render-delay"]=1;apf.__RENAME__=1<<10;apf.Rename=function(){this.$regbase=this.$regbase|apf.__RENAME__;this.canrename=true;this.renameSubject=this.renameTimer=this.lastCursor=null;this.$booleanProperties.canrename=true;this.$booleanProperties.autorename=true;this.$supportedProperties.push("canrename","autorename");this.$propHandlers.autorename=function(d){if(d){this.reselectable=true;this.bufferselect=false;this.addEventListener("afterselect",a);this.addEventListener("keydown",c);}else{this.removeEventListener("afterselect",a);this.removeEventListener("keydown",c);}};function a(){var d=this;$setTimeout(function(){if(d.hasFocus()){d.startRename();}},20);}function c(d){if(!this.renaming&&apf.isCharacter(d.keyCode)){this.startRename();}}this.$isContentEditable=function(d){if(this.renaming&&this.autorename){return true;}};this.rename=function(d,i){if(!d){d=this.caret||this.selected;}if(!d){return;}this.$executeSingleValue("rename","caption",d,i);};this.startDelayedRename=function(i,d){if(i&&(i.button==2||i.ctrlKey||i.shiftKey)){return;}clearTimeout(this.renameTimer);this.renameTimer=$setTimeout("apf.lookup("+this.$uniqueId+").startRename()",d||400);};this.startRename=function(l,d){if(!l&&(this.renaming||!this.canrename||!this.$startAction("rename",this.caret||this.selected,this.stopRename))){return false;}if(!this.hasFocus()){this.focus(null,null,true);}clearTimeout(this.renameTimer);var o=this.$getCaptionElement?this.$getCaptionElement():this.$caret||this.$selected;if(!o){return this.stopRename();}this.renaming=true;this.renameSubject=this.caret||this.selected;var i=o.offsetWidth;this.lastCursor=o.style.cursor;o.style.cursor="text";o.parentNode.replaceChild(this.oTxt,o);o.host=this;if(apf.isTrue(this.$getOption("main","scalerename"))){var n=apf.getWidthDiff(this.oTxt);this.oTxt.style.width=(i-n-3)+"px";}this.replacedNode=o;var j=this.$getCaptionXml?this.$getCaptionXml(this.renameSubject):this.$getDataNode("caption",this.renameSubject);this.oTxt[apf.hasContentEditable?"innerHTML":"value"]=d||!j?"":(j.nodeType>=2&&j.nodeType<=4?unescape(decodeURI(j.nodeValue)):(apf.isOnlyChild(j.firstChild,[3,4])?apf.queryValue(j):this.$applyBindRule("caption",this.renameSubject)))||"";this.oTxt.unselectable="Off";this.oTxt.host=this;try{this.oTxt.focus();this.oTxt.select();}catch(m){}};this.stopRename=function(d,i){clearTimeout(this.renameTimer);if(!this.renaming||d&&d!=this.renameSubject||!this.replacedNode){return false;}if(this.oTxt.parentNode&&this.oTxt.parentNode.nodeType==1){if(apf.isIE8||apf.isIE7Emulate){this.oTxt.blur();}this.oTxt.parentNode.replaceChild(this.replacedNode,this.oTxt);}this.renaming=false;if(this.replacedNode){this.replacedNode.style.cursor=this.lastCursor||"";this.replacedNode.host=null;}if(!i){this.dispatchEvent("stoprename");this.$stopAction("rename");}else{if(this.replacedNode){this.replacedNode.innerHTML=this.oTxt[apf.hasContentEditable?"innerText":"value"];}this.rename(this.renameSubject,this.oTxt[apf.hasContentEditable?"innerText":"value"].replace(/<.*?nobr>/gi,""));}if(!this.renaming){this.renameSubject=null;this.replacedNode=null;this.oTxt.style.width="";}return true;};this.addEventListener("keydown",function(i){var d=i.keyCode;if(this.renaming){if(d==27||d==13){this.stopRename(null,d==13&&!this.$autocomplete);i.cancelBubble=true;return false;}return;}if(d==113){if(this.$tempsel){this.$selectTemp();}if(this.caret!=this.selected){if(this.multiselect||this.isSelected(this.caret)){this.selected=this.caret;this.$selected=this.$caret;}else{this.select(this.caret,true);}}this.startRename();return false;}},true);this.addEventListener("DOMNodeRemovedFromDocument",function(d){this.oTxt.refCount--;if(!this.oTxt.refCount){this.oTxt.host=this.oTxt.onmouseover=this.oTxt.onmousedown=this.oTxt.select=this.oTxt.onfocus=this.oTxt.onblur=null;}});this.$init(function(){if(!(this.oTxt=document.getElementById("txt_rename"))){if(apf.hasContentEditable){this.oTxt=document.createElement("DIV");this.oTxt.contentEditable=true;if(apf.isIE6){this.oTxt.style.width="1px";}}else{this.oTxt=document.createElement("input");this.oTxt.id="txt_rename";this.oTxt.autocomplete=false;}if(apf.hasFocusBug){apf.sanitizeTextbox(this.oTxt);}this.oTxt.refCount=0;this.oTxt.id="txt_rename";this.oTxt.style.whiteSpace="nowrap";this.oTxt.onselectstart=function(d){(d||event).cancelBubble=true;};apf.sanitizeTextbox(this.oTxt);this.oTxt.onmouseover=this.oTxt.onmouseout=this.oTxt.oncontextmenu=this.oTxt.onmousedown=function(d){(d||event).cancelBubble=true;};this.oTxt.onkeyup=function(){if(!this.host.$autocomplete){return;}this.host.$lookup(this[apf.hasContentEditable?"innerHTML":"value"]);};this.oTxt.select=function(){if(!apf.hasMsRangeObject){return this.focus();}var d=document.selection.createRange();try{d.moveToElementText(this);if(apf.isFalse(this.host.$getOption("main","selectrename"))||typeof this.host.$renameStartCollapse!="undefined"){d.collapse(this.host.$renameStartCollapse);}}catch(i){}d.select();};if(apf.hasFocusBug){this.oTxt.onfocus=function(){if(apf.window){apf.window.$focusfix2();}};}this.oTxt.onblur=function(){if(apf.isGecko){return;}if(apf.hasFocusBug){apf.window.$blurfix();}if(this.host.$autocomplete){return;}this.host.stopRename(null,true);};}this.oTxt.refCount++;});};apf.__DRAGDROP__=1<<5;apf.DragDrop=function(){this.$regbase=this.$regbase|apf.__DRAGDROP__;this.$dragInited=false;this.copy=function(n,q,m,j){if(n.nodeType){n=[n];}var d,s=[],o=0,c=n.length;for(;o<c;o++){s.push({func:j?"moveNode":"appendChild",args:[q,j?n[o]:n[o]=n[o].cloneNode(true),m]});}if(this.$actions[(j?"movegroup":"copygroup")]){d=this.$executeAction("multicall",s,(j?"movegroup":"copygroup"),n[0]);}else{d=this.$executeAction("multicall",s,(j?"move":"copy"),n[0],null,null,n.length>1?n:null);}if(d!==false){return n;}return false;};this.move=function(d,i,c){return this.copy(d,i,c,true);};this.isDragAllowed=function(i,o){if(typeof apf.offline!="undefined"&&!apf.offline.canTransact()){return false;}if(this.disabled||!i||!i.length||!i[0]){return false;}if(this.drag||this.dragcopy){if(o){o.merge(i);}return true;}var q,c=[],n=0,m=i.length;for(;n<m;n++){q=this.$getDataNode("drag",i[n],null,c);if(!q){return false;}if(o){o.push(q);}}return c.length?c:false;};this.isDropAllowed=function(w,s){if(typeof apf.offline!="undefined"&&!apf.offline.canTransact()){return false;}if(this.disabled||!w||!w.length||!s){return false;}var o,d,q=this.$attrBindings&&this.$attrBindings.drop;if(this.drop&&(!q||q.value=="true")){this.$setDynamicProperty("drop",this.hasFeature(apf.__MULTISELECT__)?"["+this.each+"]":"[node()]");q=true;}if(q){for(var m=0,c=w.length;m<c;m++){o=this.$getDataNode("drop",w[m]);if(!o){break;}}if(m==c&&s&&!apf.isChildOf(o,s,true)){return[s,null];}}var A=this.$bindings.drop;if(!A||!A.length){return false;}var u,z,n=0,t=A.length;for(;n<t;n++){u=this.$bindings.getRuleIndex("drop",n);for(var m=0,c=w.length;m<c;m++){o=u.cvalue?u.cvalue(w[m]):u.cmatch(w[m]);if(!o){break;}}if(m!=c){continue;}z=u.target;if(!z||z=="."){d=s;}else{d=(u.ctarget||u.compile("target"))(s);}if(d&&!apf.isChildOf(o,d,true)){return[d,u];}}return false;};this.$dragDrop=function(C,j,z,A,u,B,c){if(q=="tree-append"&&u){return false;}var q=z&&z.action;if(q){q=(z.caction||z.compile("action"))(j[0]);}else{q=A;}var d={internal:apf.DragServer.dragdata.host==this,ctrlKey:c.ctrlKey,keyCode:c.keyCode},t=z&&z.copy;if(t){t=!apf.isFalse((z.ccopy||z.compile("copy"))(j[0],d));}else{if(typeof this.dragcopy=="boolean"||typeof this.dropcopy=="boolean"){if(this.dropcopy){t=this.dropcopy;}else{if(this.dragcopy){t=c.ctrlKey;}else{var n=this.$attrBindings&&this.$attrBindings.dragcopy;if(n){t=!apf.isFalse((n.cvalue2||n.compile("value",{withopt:true}))(j[0],d));}}}}}if(!t){for(var s=0,m=B.length;s<m;s++){t=typeof B[s]=="object"&&B[s].copy?!apf.isFalse((B[s].ccopy||B[s].compile("copy"))(j[0],d)):c.ctrlKey;if(t){break;}}}var w,D=t?"copy":"move",o=z?z.getAttribute("parent"):null;switch(q){case"list-append":C=(u?C:this.getTraverseParent(C));if(o){if(C.selectSingleNode(o)){C=C.selectSingleNode(o);}else{C.appendChild(C.ownerDocument.createElement(o));C=C.selectSingleNode(o);}}w=this[D](j,C);break;case"insert-before":w=u?this[D](j,C):this[D](j,C.parentNode,C);break;case"tree-append":if(o){if(C.selectSingleNode(o)){C=C.selectSingleNode(o);}else{C.appendChild(C.ownerDocument.createElement(o));C=C.selectSingleNode(o);}}w=this[D](j,C);break;}if(this.selectable&&w){this.selectList(w);this.setCaret(w[0]);this.focus();}return w;};this.enableDragDrop=function(){this.icoAllowed="";this.icoDenied="";this.$ext.dragdrop=false;var c=this;this.$ext[apf.isIphone?"ontouchstart":"onmousedown"]=function(n){n=n||window.event;if(apf.isIphone){if(n.touches.length==1){return;}var m=n;n=n.touches[0];var o=apf.getAbsolutePosition(n.target,this);n.offsetX=o[0];n.offsetY=o[1];}var l,i=n.originalTarget||n.srcElement||n.target,d=c.hasFeature(apf.__MULTISELECT__);if(d&&i==c.$int){return;}c.dragging=0;if(!apf.isIphone&&c.allowdeselect&&(i==this||i.getAttribute(apf.xmldb.htmlIdTag))){return c.clearSelection();}if(c.$findValueNode){l=c.$findValueNode(i);}var j=(l?apf.xmldb.getNode(l):apf.xmldb.findXmlNode(i));if(d&&(!c.selected||!j||j==c.xmlRoot)){return;}if(c.isDragAllowed(d?c.$getSelection():j)){if(apf.isIphone){m.preventDefault();}apf.DragServer.start(c,i,n);}};this.$ext[apf.isIphone?"ontouchmove":"onmousemove"]=function(d){if(this.host.dragging!=1){return;}};if(apf.isIphone){this.$ext.ontouchend=this.$ext.ontouchcancel=function(){this.host.dragging=0;};}else{this.$ext.onmouseup=function(){this.host.dragging=0;};this.$ext.ondragcopy=this.$ext.ondragstart=function(){return false;};}if(document.elementFromPointAdd){document.elementFromPointAdd(this.$ext);}if(this.$initDragDrop&&!this.$dragInited){this.$initDragDrop();this.$dragInited=2;}else{this.$dragInited=true;}};function a(){this.$dragInited=false;if(apf.isIphone){this.$ext.ontouchstart=this.$ext.ontouchmove=this.$ext.ontouchend=this.$ext.ontouchcancel=null;}else{this.$ext.onmousedown=this.$ext.onmousemove=this.$ext.onmouseup=null;}if(document.elementFromPointRemove){document.elementFromPointRemove(this.$ext);}}this.implement(this.hasFeature(apf.__MULTISELECT__)?apf.MultiselectDragDrop:apf.StandardDragDrop);this.$supportedProperties.push("drop","drag","dragcopy");this.$propHandlers.dragcopy=this.$propHandlers.dropcopy=this.$propHandlers.drag=this.$propHandlers.drop=function(c,d){this[d]=apf.isTrue(c);if(this.$dragInited&&d=="drag"&&c&&this.$dragInited!=2){this.$initDragDrop();this.$dragInited=2;return;}if(d=="dragcopy"||d=="dropcopy"){return;}if(!c&&!this.drag&&!this.drop&&!this.$bindings&&(this.$attrBindings&&(!this.$attrBindings.drag||!this.$attrBindings.drop))){a.call(this);}else{if(c&&!this.$dragInited){this.enableDragDrop();}}};this.addEventListener("DOMNodeRemovedFromDocument",function(c){a.call(this);if(this.oDrag){apf.destroyHtmlNode(this.oDrag);this.oDrag=null;}});};apf.GuiElement.propHandlers.dragcopy=apf.GuiElement.propHandlers.dropcopy=apf.GuiElement.propHandlers.drop=apf.GuiElement.propHandlers.drag=function(a,c){if(!apf.isFalse(a)){if(!this.hasFeature(apf.__DRAGDROP__)){this.implement(apf.DragDrop);this.enableDragDrop();}this[c]=apf.isTrue(a);}};apf.DragServer={Init:function(){if(apf.isIphone){this.ontouchmove=this.onmousemove;this.ontouchend=this.ontouchcancel=this.onmouseup;}apf.addEventListener("hotkey",function(a){if(apf.window.dragging&&a.keyCode==27){if(document.body.lastHost&&document.body.lastHost.dragOut){document.body.lastHost.dragOut(apf.dragHost);}return apf.DragServer.stopdrag();}});},start:function(m,c,o){if(document.elementFromPointReset){document.elementFromPointReset();}m.dragging=1;var q=window.document;q=(!q.compatMode||q.compatMode=="CSS1Compat")?q.html||q.documentElement:q.body;var w=(apf.isIE?q.scrollLeft:window.pageXOffset),u=(apf.isIE?q.scrollTop:window.pageYOffset),a=m.$ext.offsetParent,s;while(a&&a!=q&&a.tagName!="BODY"){w-=a.scrollLeft;u-=a.scrollTop;a=a.offsetParent;}var l=c,j;while(l&&l.nodeType==1&&!(j=l.getAttribute(apf.xmldb.htmlIdTag))){l=l.parentNode;}if(!j){return;}s=apf.getAbsolutePosition(l);apf.DragServer.coordinates={srcElement:c,doc:q,scrollX:w,scrollY:u,offsetX:o.clientX-s[0],offsetY:o.clientY-s[1],clientX:o.pageX?o.pageX-window.pageXOffset:o.clientX,clientY:o.pageY?o.pageY-window.pageYOffset:o.clientY};var t=m.hasFeature(apf.__MULTISELECT__)?m.getSelection():[m.xmlRoot],n=[],i=m.isDragAllowed(t,n);if(!i){return;}if(m.hasEventListener("dragdata")){n=m.dispatchEvent("dragdata",{data:n});}this.dragdata={rules:i,selection:t,data:n,indicator:m.$showDragIndicator(t,this.coordinates),host:m};if(m.dispatchEvent("dragstart",this.dragdata)===false){return false;}m.dragging=2;apf.dragMode=true;document.onmousemove=this.onmousemove;document.onmouseup=this.onmouseup;},stop:function(a,c){if(this.last){this.dragout();}this.dragdata.host.dragging=0;this.dragdata.host.$hideDragIndicator(c);apf.dragMode=false;document.onmousemove=document.onmouseup=null;this.dragdata=null;},dragover:function(l,d,j){j=j||window.event;var i;if(l.$findValueNode){i=l.$findValueNode(d);}if(this.lastFel&&this.lastFel==i||!this.lastFel&&this.last==l){return;}var m=(i?apf.xmldb.getNode(i):apf.xmldb.findXmlNode(d)),a=l.isDropAllowed&&l.xmlRoot?l.isDropAllowed(this.dragdata.data,m||l.xmlRoot):apf.isTrue(apf.getInheritedAttribute(l,"",function(n){if(n.drop){l=n;if(l==apf.DragServer.last){return false;}return true;}}));if(this.last&&this.last!=l){this.dragout(this.last);}if(!a){return;}if(l.dispatchEvent("dragover",this.dragdata)===false){a=false;}var c=j.originalTarget||j.srcElement||j.target;if(l&&l.$dragover){l.$dragover(d,this.dragdata,a);}this.last=l;this.lastFel=i;},dragout:function(a){this.lastFel=null;if(a){a.dispatchEvent("dragout",this.dragdata);}if(this.last&&this.last.$dragout){this.last.$dragout(null,this.dragdata);}this.last=null;},dragdrop:function(a,c,u,q){var n,t,j=(a.$findValueNode?apf.xmldb.getNode(a.$findValueNode(c)):apf.xmldb.findXmlNode(c)),d=(a.isDropAllowed&&a.xmlRoot)?a.isDropAllowed(this.dragdata.data,j||a.xmlRoot):false;if(this.dragdata.indicator){t=this.dragdata.indicator.style.top;this.dragdata.indicator.style.top="10000px";}if(!d){d=apf.isTrue(apf.getInheritedAttribute(a,"",function(m){if(m.drop){a=m;return true;}}));}if(d){if(a.dispatchEvent("dragdrop",apf.extend({candrop:d,htmlEvent:q,top:t},this.dragdata))===false){d=false;}else{if(!a.xmlRoot){var i=a.getModel?a.getModel(true):apf.nameserver.get("model",a.model);if(i){i.load(this.dragdata.data[0]);}return true;}else{var l=d[1]&&d[1].action||(a.$isTreeArch?"tree-append":"list-append");if(l=="list-append"&&(!a.$isTreeArch&&a==this.dragdata.host)){d=false;}}}}if(this.dragdata.indicator){this.dragdata.indicator.style.top=t;}if(!d){this.dragout(a);return false;}if(a.$dragDrop){var s=a.$dragDrop(d[0],this.dragdata.data,d[1],l,n||d[0]==a.xmlRoot,this.dragdata.rules,q);this.dragdata.resultNode=s;}if(a.$dragdrop){a.$dragdrop(c,apf.extend({htmlEvent:q,xmlNode:s},this.dragdata),d);}this.last=null;this.lastFel=null;return true;},onmousemove:function(l){if(!apf.DragServer.dragdata){return;}l=l||window.event;if(apf.isIphone){l.preventDefault();if(!l.touches){return apf.DragServer.stop(true);}l=l.touches[0];}var d=apf.DragServer.dragdata,m={clientX:l.pageX?l.pageX-window.pageXOffset:l.clientX,clientY:l.pageY?l.pageY-window.pageYOffset:l.clientY};if(!d.started&&Math.abs(apf.DragServer.coordinates.clientX-m.clientX)<6&&Math.abs(apf.DragServer.coordinates.clientY-m.clientY)<6){return;}if(!d.started){if(d.host.$dragstart){d.host.$dragstart(null,d);}d.started=true;}var a=d.indicator.style.top;d.indicator.style.display="block";if(d.indicator){d.indicator.style.top="10000px";}apf.DragServer.dragdata.x=l.pageX?l.pageX-(apf.isGecko?window.pageXOffset:0):m.clientX;apf.DragServer.dragdata.y=l.pageY?l.pageY-(apf.isGecko?window.pageYOffset:0):m.clientY;var i=document.elementFromPoint(apf.DragServer.dragdata.x,apf.DragServer.dragdata.y);d.indicator.style.top=a;d.host.$moveDragIndicator(m);var j=apf.findHost(i);if(j){apf.DragServer.dragover(j,i,l);}else{if(apf.DragServer.last){apf.DragServer.dragout(apf.DragServer.last);}}apf.DragServer.lastTime=new Date().getTime();},onmouseup:function(l){l=l||window.event;if(apf.isIphone){l.preventDefault();if(!l.changedTouches){return apf.DragServer.stop(true);}l=l.changedTouches[0];}var n={clientX:l.pageX?l.pageX-window.pageXOffset:l.clientX,clientY:l.pageY?l.pageY-window.pageYOffset:l.clientY};if(!apf.DragServer.dragdata.started&&Math.abs(apf.DragServer.coordinates.clientX-n.clientX)<6&&Math.abs(apf.DragServer.coordinates.clientY-n.clientY)<6){apf.DragServer.stop(true);return;}var d=apf.DragServer.dragdata.indicator,a=d.style.top;if(d){d.style.top="10000px";}apf.DragServer.dragdata.x=l.pageX?l.pageX-(apf.isGecko?window.pageXOffset:0):n.clientX;apf.DragServer.dragdata.y=l.pageY?l.pageY-(apf.isGecko?window.pageYOffset:0):n.clientY;var i=document.elementFromPoint(apf.DragServer.dragdata.x,apf.DragServer.dragdata.y);d.style.top=a;var j=apf.findHost(i);if(apf.DragServer.host&&j!=apf.DragServer.host){apf.DragServer.dragout(apf.DragServer.host);}var m=apf.DragServer.dragdrop(j,i,apf.DragServer.dragdata.host,l);apf.DragServer.stop(true,m);}};apf.MultiselectDragDrop=function(){this.diffX=this.diffY=0;this.multiple=false;this.lastDragNode=null;this.lastel=null;this.$showDragIndicator=function(j,n){this.multiple=j.length>1;if(this.multiple){this.diffX=n.scrollX;this.diffY=n.scrollY;}else{this.diffX=-1*n.offsetX;this.diffY=-1*n.offsetY;}var d=this.oDrag.className.split(" ")[0];this.$setStyleClass(this.oDrag,this.multiple?d+"_multiple":"",[d+"_multiple"]);if(this.multiple){document.body.appendChild(this.oDrag);return this.oDrag;}else{if(this.localName=="datagrid"){if(this.lastDragNode){apf.destroyHtmlNode(this.lastDragNode);}j=this.$selected||this.$caret;var m=j.cloneNode(true);m.removeAttribute("onmousedown");m.onmousedown=null;m.removeAttribute("onmouseup");m.onmouseup=null;m.removeAttribute("onmouseout");m.onmouseout=null;m.removeAttribute("ondblclick");m.ondblclick=null;document.body.appendChild(m);m.style.position="absolute";m.style.width=j.offsetWidth+"px";m.style.display="none";m.style.zIndex=10000000;m.removeAttribute("id");this.$setStyleClass(m,"draggrid");var a=j.childNodes;var l=m.childNodes;for(var c=a.length-1;c>=0;c--){if(l[c].nodeType==1){l[c].style.width=apf.getStyle(a[c],"width");}}return(this.lastDragNode=m);}else{this.$updateNode(this.selected,this.oDrag);}}return this.oDrag;};this.$hideDragIndicator=function(d){var c=this.lastDragNode||this.oDrag,a=this;if(!this.multiple&&!d&&c.style.display=="block"){var i=apf.getAbsolutePosition(this.$selected||this.$caret);apf.tween.multi(c,{anim:apf.tween.EASEIN,steps:15,interval:10,tweens:[{type:"left",from:c.offsetLeft,to:i[0]},{type:"top",from:c.offsetTop,to:i[1]}],onfinish:function(){if(a.lastDragNode){apf.destroyHtmlNode(a.lastDragNode);a.lastDragNode=null;}else{a.oDrag.style.display="none";}}});}else{if(this.lastDragNode){apf.destroyHtmlNode(this.lastDragNode);this.lastDragNode=null;}else{this.oDrag.style.display="none";}}};this.$moveDragIndicator=function(c){var a=this.lastDragNode||this.oDrag;a.style.left=(c.clientX+this.diffX)+"px";a.style.top=(c.clientY+this.diffY+(this.multiple?15:0))+"px";};this.$initDragDrop=function(){if(!this.$hasLayoutNode("dragindicator")){return;}this.oDrag=apf.insertHtmlNode(this.$getLayoutNode("dragindicator"),document.body);this.oDrag.style.zIndex=1000000;this.oDrag.style.position="absolute";this.oDrag.style.cursor="default";this.oDrag.style.display="none";};this.$findValueNode=function(a){if(!a){return null;}while(a&&a.nodeType==1&&!a.getAttribute(apf.xmldb.htmlIdTag)){if(this.$isTreeArch&&a.previousSibling&&a.previousSibling.nodeType==1){a=a.previousSibling;}else{a=a.parentNode;}}return(a&&a.nodeType==1&&a.getAttribute(apf.xmldb.htmlIdTag))?a:null;};this.$dragout=function(m,c,a){if(this.lastel){this.$setStyleClass(this.lastel,"",["dragDenied","dragInsert","dragAppend","selected","indicate"]);}var n=this.$getSelection(true);for(var j=0,d=n.length;j<d;j++){this.$setStyleClass(n[j],"selected",["dragDenied","dragInsert","dragAppend","indicate"]);}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Drop"]);this.lastel=null;};if(!this.$dragdrop){this.$dragdrop=this.$dragout;}this.$dragover=function(m,c,a){this.$setStyleClass(this.$ext,this.$baseCSSname+"Drop");var q=this.$getSelection(true);for(var j=0,d=q.length;j<d;j++){this.$setStyleClass(q[j],"",["dragDenied","dragInsert","dragAppend","selected","indicate"]);}if(this.lastel){this.$setStyleClass(this.lastel,"",["dragDenied","dragInsert","dragAppend","selected","indicate"]);}var o=a[1]&&a[1].action;this.lastel=this.$findValueNode(m);if(this.$isTreeArch&&o=="list-append"){var n=apf.xmldb.findHtmlNode(this.getTraverseParent(apf.xmldb.getNode(this.lastel)),this);this.lastel=n?this.$getLayoutNode("item","container",n):this.$int;this.$setStyleClass(this.lastel,"dragInsert");}else{this.$setStyleClass(this.lastel,a?(o=="insert-before"?"dragInsert":"dragAppend"):"dragDenied");}};};apf.StandardDragDrop=function(){this.$showDragIndicator=function(d,i){var a=i.offsetX+22,j=i.offsetY;this.oDrag.startX=a;this.oDrag.startY=j;document.body.appendChild(this.oDrag);var c=this.$getLayoutNode("main","caption",this.oDrag);if(c.nodeType!=1){c=c.parentNode;}c.innerHTML=this.$applyBindRule("caption",this.xmlRoot)||"";return this.oDrag;};this.$hideDragIndicator=function(){this.oDrag.style.display="none";};this.$moveDragIndicator=function(a){this.oDrag.style.left=(a.clientX-this.oDrag.startX+document.documentElement.scrollLeft)+"px";this.oDrag.style.top=(a.clientY-this.oDrag.startY+document.documentElement.scrollTop)+"px";};this.$initDragDrop=function(){if(!this.getAttribute("drag")){return;}this.oDrag=document.body.appendChild(this.$ext.cloneNode(true));this.oDrag.style.zIndex=1000000;this.oDrag.style.position="absolute";this.oDrag.style.cursor="default";this.oDrag.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=50)";this.oDrag.style.MozOpacity=0.5;this.oDrag.style.opacity=0.5;this.oDrag.style.display="none";};};apf.DragServer.Init();apf.__MULTICHECK__=1<<22;apf.MultiCheck=function(){this.$regbase=this.$regbase|apf.__MULTICHECK__;this.multicheck=true;this.checklength=0;this.checkedList=[];this.check=function(j){if(this.disabled||this.checkedList.indexOf(j)>-1){return;}if(this.dispatchEvent("beforecheck",{xmlNode:j})===false){return false;}if(!this.multicheck&&this.checkedList.length){this.clearChecked(true);}this.checkedList.push(j);if(this.$isTreeArch){var a=j.selectNodes(".//"+this.each.split("|").join("|.//"));this.checkList(a,null,true,true);var l,d=this.getTraverseParent(j);while(d&&d!=this.xmlRoot){a=this.getTraverseNodes(d);l=true;for(var c=0;c<a.length;c++){if(this.checkedList.indexOf(a[c])==-1){l=false;break;}}apf.setStyleClass(apf.xmldb.getHtmlNode(d,this),l?"checked":"partial",["partial","checked"]);if(l){this.checkedList.push(d);}d=this.getTraverseParent(d);}}this.$setStyleClass(apf.xmldb.getHtmlNode(j,this),"checked",["partial"]);this.dispatchEvent("aftercheck",{list:this.checkedList,xmlNode:j});};this.uncheck=function(a){if(this.disabled||this.checkedList.indexOf(a)==-1){return;}if(this.$isTreeArch){return this.checkList([a],true,true);}if(this.dispatchEvent("beforeuncheck",{xmlNode:a})===false){return false;}this.checkedList.remove(a);this.$setStyleClass(apf.xmldb.getHtmlNode(a,this),"",["checked","partial"]);this.dispatchEvent("afteruncheck",{list:this.checkedList,xmlNode:a});};this.checkToggle=function(a){if(a.style){var c=a,d=c.getAttribute(apf.xmldb.htmlIdTag);while(!d&&c.parentNode){d=(c=c.parentNode).getAttribute(apf.xmldb.htmlIdTag);}a=apf.xmldb.getNode(c);}if(this.checkedList.indexOf(a)>-1){this.uncheck(a);}else{this.check(a);}};this.checkList=function(c,d,n,l){if(!c.indexOf){c=apf.getArrayFromNodelist(c);}if(this.disabled){return;}if(!l&&this.dispatchEvent("beforecheck",{list:c})===false){return false;}if(!d&&!n){this.clearChecked(true);}if(!this.multicheck){c=[c[0]];}var j;if(d){for(j=c.length-1;j>=0;j--){this.checkedList.remove(c[j]);this.$setStyleClass(apf.xmldb.getHtmlNode(c[j],this),"",["checked"]);}}else{for(j=c.length-1;j>=0;j--){this.checkedList.push(c[j]);this.$setStyleClass(apf.xmldb.getHtmlNode(c[j],this),"checked");}}if(!l&&this.$isTreeArch){var a=this;function m(C,o){var q=a.getTraverseNodes(C);if(!q.length){if(o){if(d){a.checkedList.remove(C);a.$setStyleClass(apf.xmldb.getHtmlNode(C,a),"",["checked"]);return 0;}else{if(a.checkedList.indexOf(C)==-1){a.checkedList.push(C);a.$setStyleClass(apf.xmldb.getHtmlNode(C,a),"checked");}return 1;}}return a.checkedList.indexOf(C)>-1?1:0;}var t=a.checkedList.indexOf(C)!=-1,s=o||c.indexOf(C)>-1&&(d?!t:t),B=true,A=true,z=false,u;for(var w=q.length-1;w>=0;w--){u=m(q[w],s);if(u){A=false;if(!z&&u==2){z=true;}}else{B=false;}if(!B&&!A){z=true;}}if(C==a.xmlRoot){return;}if(B){if(!t){a.checkedList.push(C);apf.setStyleClass(apf.xmldb.getHtmlNode(C,a),"checked",["partial"]);}}else{if(t){a.checkedList.remove(C);}apf.setStyleClass(apf.xmldb.getHtmlNode(C,a),z?"partial":"",["partial","checked"]);}return B?1:(A?0:2);}m(this.xmlRoot);}if(!l){this.dispatchEvent("aftercheck",{list:c});}};this.clearChecked=function(c){if(!c&&this.dispatchEvent("beforeuncheck",{xmlNode:this.checkedList})===false){return false;}for(var a=this.checkedList.length-1;a>=0;a--){this.$setStyleClass(apf.xmldb.getHtmlNode(this.checkedList[a],this),"",["checked"]);}this.checkedList.length=0;if(!c){this.dispatchEvent("afteruncheck",{list:this.checkedList});}};this.isChecked=function(a){return this.checkedList.indexOf(a)>-1;};this.getChecked=function(a){var c,d;if(a){d=this.xmlRoot?this.xmlRoot.ownerDocument.createDocumentFragment():apf.getXmlDom().createDocumentFragment();for(c=0;c<this.checkedList.length;c++){apf.xmldb.cleanNode(d.appendChild(this.checkedList[c].cloneNode(true)));}}else{for(d=[],c=0;c<this.checkedList.length;c++){d.push(this.checkedList[c]);}}return d;};this.checkAll=function(){if(!this.multicheck||this.disabled||!this.xmlRoot){return;}var a=this.$isTreeArch?this.xmlRoot.selectNodes(".//"+this.each.split("|").join("|.//")):this.getTraverseNodes();this.checkList(a);};this.addEventListener("aftercheck",function(){if(this.checklength!=this.checkedList.length){this.setProperty("checklength",this.checkedList.length);}});this.addEventListener("afteruncheck",function(){if(this.checklength!=this.checkedList.length){this.setProperty("checklength",this.checkedList.length);}});};apf.window=function(){this.$uniqueId=apf.all.push(this);this.apf=apf;this.toString=function(){return"[APF Component : "+(this.name||"")+" (apf.window)]";};this.getActionTracker=function(){return this.$at;};this.loadCodeFile=function(B){if(self[B]){apf.importClass(self[B],true,this.win);}else{apf.include(B);}};this.flash=function(){if(apf.window.hasFocus()||apf.isIphone){return;}if(apf.isDeskrun){l.Flash();}else{if(apf.isIE){if(!this.popup){this.popup=window.createPopup();}if(apf.window.stopFlash){return;}d+="x";function B(D){if(apf.window.hasFocus()){return;}window.focus();function C(){if(apf.window.hasFocus()){return;}this.popup.hide();this.popup.show(0,0,0,0,document.body);this.popup.document.write("<body><script>                        document.p = window.createPopup();                        document.p.show(0, 0, 0, 0, document.body);                        <\/script></body>");this.popup.document.focus();clearInterval(this.flashTimer);this.flashTimer=setInterval(function(){if(!apf.window.popup.isOpen||!apf.window.popup.document.p.isOpen){clearInterval(apf.window.flashTimer);if(!apf.window.hasFocus()){apf.window.popup.hide();document.body.focus();d="d";c();}}},10);}if(D){$setTimeout(function(){C.call(apf.window);},10);}else{C.call(apf.window);}}if("TEXTAREA|INPUT|SELECT".indexOf(document.activeElement.tagName)>-1){document.activeElement.blur();document.body.focus();apf.window.stopFlash=true;$setTimeout(function(){B.call(apf.window,true);apf.window.stopFlash=false;},10);}else{B.call(apf.window);}}}};this.show=function(){if(apf.isDeskrun){l.Show();}};this.hide=function(){if(apf.isDeskrun){l.Hide();}else{this.loaded=false;if(this.win){this.win.close();}}};this.focus=function(){if(apf.isDeskrun){l.SetFocus();}else{window.focus();}};this.setIcon=function(B){if(apf.isDeskrun){l.icon=parseInt(B)==B?parseInt(B):B;}};this.setTitle=function(B){this.title=B||"";if(apf.isDeskrun){l.caption=B;}else{document.title=(B||"");}};this.loadAml=function(B){if(B[apf.TAGNAME]=="deskrun"){this.loadDeskRun(B);}else{}};var l=apf.isDeskrun?window.external:null,s=apf.isDeskrun?l.shell:null;this.loadDeskRun=function(G){l.style=G.getAttribute("style")||"ismain|taskbar|btn-close|btn-max|btn-min|resizable";apf.config.drRegName=G.getAttribute("record");if(G.getAttribute("minwidth")){l.setMin(G.getAttribute("minwidth"),G.getAttribute("minheight"));}if(G.getAttribute("record")&&s.RegGet(apf.config.drRegName+"/window")){var F=s.RegGet(apf.config.drRegName+"/window");if(F){F=F.split(",");window.external.width=Math.max(G.getAttribute("minwidth"),Math.min(parseInt(F[2]),window.external.shell.GetSysValue("deskwidth")));window.external.height=Math.max(G.getAttribute("minheight"),Math.min(parseInt(F[3]),window.external.shell.GetSysValue("deskheight")));window.external.left=Math.max(0,Math.min(parseInt(F[0]),screen.width-window.external.width));window.external.top=Math.max(0,Math.min(parseInt(F[1]),screen.height-window.external.height));}}else{l.left=G.getAttribute("left")||200;l.top=G.getAttribute("top")||200;l.width=G.getAttribute("width")||800;l.height=G.getAttribute("height")||600;}l.caption=G.getAttribute("caption")||"DeskRun";l.icon=G.getAttribute("icon")||100;var D=$xmlns(G,"context",apf.ns.aml);if(D.length){D=D[0];if(!apf.config.tray){apf.config.tray=window.external.CreateWidget("trayicon");}var E=apf.config.tray;E.icon=G.getAttribute("tray")||100;E.tip=G.getAttribute("tooltip")||"DeskRun";E.PopupClear();E.PopupItemAdd("Exit",3);E.PopupItemAdd("SEP",function(){});var B=D.childNodes;for(var C=B.length-1;C>=0;C--){if(B[C].nodeType!=1){continue;}if(B[C][apf.TAGNAME]=="divider"){E.PopupItemAdd("SEP",function(){});}else{E.PopupItemAdd(apf.queryValue(B[C],"."),B[C].getAttribute("href")?new Function("window.open('"+B[C].getAttribute("href")+"')"):new Function(B[C].getAttribute("onclick")));}}}l.shell.debug=apf.debug?7:0;l.Show();l.SetFocus();};this.$tabList=[];this.$addFocus=function(C,D,B){if(!B){C.addEventListener("DOMNodeInserted",A);C.addEventListener("DOMNodeRemoved",o);if(C.$isWindowContainer>-2){C.addEventListener("focus",z);C.addEventListener("blur",z);C.$focusParent=C;if(C.$isWindowContainer>-1){if(!C.$tabList){C.$tabList=[C];}this.$tabList.push(C);return;}else{C.$tabList=[C];}}}var E=u(C),F=E.$tabList;if(!C.$isWindowContainer){C.$focusParent=E;}if(F[D]){F.insertIndex(C,D);}else{F.push(C);}};this.$removeFocus=function(B){if(!B.$focusParent){return;}B.$focusParent.$tabList.remove(B);if(!B.$isWindowContainer){B.removeEventListener("DOMNodeInserted",A);B.removeEventListener("DOMNodeRemoved",o);}if(B.$isWindowContainer>-2){B.removeEventListener("focus",z);B.removeEventListener("blur",z);}};var a;this.$focus=function(C,E,D){var B=this.document.activeElement;if(B==C&&!D){return;}this.$settingFocus=C;if(!E){E={};}if(B&&B!=C&&a!=B){a=B;E.toElement=C;E.fromElement=B;B.blur(true,E);if(a!=B){return false;}}(apf.activeElement=this.document.activeElement=C).focus(true,E);this.$settingFocus=null;apf.dispatchEvent("movefocus",{toElement:C});if(typeof apf.offline!="undefined"&&apf.offline.state.enabled&&apf.offline.state.realtime){apf.offline.state.set(this,"focus",C.name||C.$uniqueId);}};this.$blur=function(C){var B=this.document.activeElement;if(B!=C){return false;}B.$focusParent.$lastFocussed=null;apf.activeElement=this.document.activeElement=null;apf.dispatchEvent("movefocus",{fromElement:C});};var n;this.$focusDefault=function(B,D){var C=u(B);this.$focusLast(C,D);};this.$focusRoot=function(B){var C=apf.document.documentElement;if(this.$focusLast(C,B)===false){}};this.$focusLast=function(D,I,C){var B=D.$lastFocussed;if(B&&B.parentNode&&B.$focussable===true&&(C||B.$ext.offsetHeight)){this.$focus(B,I,true);}else{var E,G=D,F;while(G){if(!F&&G.focussable!==false&&G.$focussable===true&&!G.$tabList&&(C||G.$ext.offsetHeight)&&!G.disabled){this.$focus(G,I,true);break;}if((E=!F&&G.firstChild||!(F=false)&&G.nextSibling)){G=E;if(G.$isWindowContainer>0){F=true;}}else{if(G==D){if(G.$isWindowContainer){this.$focus(G,I,true);}return;}else{do{G=G.parentNode;}while(G&&!G.nextSibling&&G!=D&&!G.$isWindowContainer);if(G==D){return;}if(G){if(G.$isWindowContainer){this.$focus(G,I,true);break;}G=G.nextSibling;}}}}if(!G){this.$focus(apf.document.documentElement);}}};function z(B){if(B.name=="blur"){if(B.srcElement!=this&&this.$blur){this.$blur();}return;}if(B.srcElement!=this&&this.$focus){this.$focus();}if(B.srcElement==this||B.trackedChild){B.trackedChild=true;return;}this.$lastFocussed=B.srcElement;if(this.localName.indexOf("window")>-1){B.trackedChild=true;}}function u(B){var C=B;do{C=C.parentNode;}while(C&&!C.$isWindowContainer);return C||apf.document.documentElement;}function A(B){if(B&&B.currentTarget!=this){return;}if(this.$isWindowContainer){apf.window.$tabList.pushUnique(this);}else{apf.window.$addFocus(this,this.tabindex,true);}}function o(B){if(B&&B.currentTarget!=this){return;}if(this.$isWindowContainer){apf.window.$tabList.remove(this);return;}if(!this.$focusParent){return;}this.$focusParent.$tabList.remove(this);}this.hasFocus=function(B){return this.document.activeElement==B;};this.moveNext=function(N,E,B,M){if(B&&apf.document.activeElement){var D=apf.document.activeElement.$focusParent;if(D.visible&&D.modal){return false;}}var G,C,J,F=E||apf.document.activeElement,I=F?(B&&F.$isWindowContainer>0?apf.window:F.$focusParent):apf.document.documentElement,K=I.$tabList;if(F&&(B||F!=apf.document.documentElement)){C=(K||[]).indexOf(F);if(C==-1){return;}}else{C=-1;}if(this.document.activeElement&&this.document.activeElement==F&&K.length==1||K.length==0){return false;}G=(N?-1:1);J=C;if(C<0){C=0;}do{J+=G;if(J>=K.length){J=0;}else{if(J<0){J=K.length-1;}}if(C==J&&F){return false;}F=K[J];}while(!F||F.disabled||F==apf.document.activeElement||(B?!F.visible:F.$ext&&!F.$ext.offsetHeight)||F.focussable===false||B&&!F.$tabList.length);if(I==apf.window){this.$focusLast(F,{mouse:true},B);}else{(M||(M={})).shiftKey=N;this.$focus(F,M);}};this.focusDefault=function(){if(typeof apf.offline!="undefined"&&apf.offline.state.enabled){var B,C=apf.offline.state.get(this,"focus");if(C==-1){return this.$focusRoot();}if(C){B=self[C]||apf.lookup(C);}if(B){if(!B.$focussable){apf.offline.clear();apf.offline.reboot();}else{this.$focus(B);return;}}}if(this.moveNext()===false){this.moveNext(null,apf.document.documentElement,true);}};apf.addListener(window,"beforeunload",function(){return apf.dispatchEvent("exit");});apf.addListener(window,"unload",function(){if(!apf){return;}apf.window.isExiting=true;apf.window.destroy();});var i,d="",t="";this.$focusfix=function(){if(apf.isIphone){return;}d+="a";clearTimeout(i);$setTimeout("window.focus();");i=$setTimeout(c);};this.$focusfix2=function(){if(apf.isIphone){return;}d+="b";clearTimeout(i);i=$setTimeout(c);};this.$blurfix=function(){if(apf.isIphone){return;}d+="c";clearTimeout(i);i=$setTimeout(c);};function c(){clearTimeout(i);if(d=="e"||d=="c"||d.charAt(0)=="x"&&!d.match(/eb$/)||d=="ce"||d=="de"){if(t!="blur"){t="blur";apf.window.dispatchEvent("blur");}}else{if(t!="focus"){t="focus";apf.window.dispatchEvent("focus");}}d="";i=null;}apf.addListener(window,"focus",this.$focusevent=function(){if(apf.isIphone){return apf.window.dispatchEvent("focus");}if(apf.hasFocusBug){d+="d";clearTimeout(i);i=$setTimeout(c);}else{clearTimeout(w);j.newState="focus";w=$setTimeout(j,10);}});apf.addListener(window,"blur",this.$blurevent=function(){if(!apf){return;}if(apf.isIphone){return apf.window.dispatchEvent("blur");}if(apf.hasFocusBug){d+="e";clearTimeout(i);i=$setTimeout(c);}else{clearTimeout(w);j.newState="blur";w=$setTimeout(j,10);}});var w;function j(){clearTimeout(w);var B=j.newState;if(t==B){return;}t=B;apf.dispatchEvent(t);}this.hasFocus=function(){return(t=="focus");};apf.addListener(document,"contextmenu",function(D){if(!D){D=event;}var E,C,B=apf.findHost(D.srcElement||D.target)||apf.document.activeElement||apf.document&&apf.document.documentElement;if(B&&B.localName=="menu"){return false;}if(apf.contextMenuKeyboard){if(B){E=B.selected?apf.getAbsolutePosition(B.$selected):apf.getAbsolutePosition(B.$ext||B.$pHtmlNode);}else{E=[0,0];}C={x:E[0]+10+document.documentElement.scrollLeft,y:E[1]+10+document.documentElement.scrollTop,htmlEvent:D};}else{if(D.htmlEvent){C=D;}else{C={x:D.clientX+document.documentElement.scrollLeft,y:D.clientY+document.documentElement.scrollTop,htmlEvent:D};}}C.bubbles=true;apf.contextMenuKeyboard=null;if((B||apf).dispatchEvent("contextmenu",C)===false||C.returnValue===false){if(D.preventDefault){D.preventDefault();}return false;}if(apf.config.disableRightClick){if(D.preventDefault){D.preventDefault();}return false;}});var m={INPUT:1,TEXTAREA:1,SELECT:1};apf.addListener(document,"mousedown",this.$mousedown=function(G){G=G||window.event;var F,D=apf.findHost(G.srcElement||G.target),C=D&&D.$editable||(D&&D.hasFeature(apf.__CONTENTEDITABLE__));if(apf.popup.last&&(!D||apf.popup.last!=D.$uniqueId)){apf.popup.forceHide();}if((!D||!D.$focussable||D.focussable===false)&&apf.config.allowBlur&&D.canHaveChildren!=2){n=null;if(apf.document.activeElement){apf.document.activeElement.blur();}}else{if(D){if((F=apf.document.activeElement&&apf.document.activeElement.$focusParent||n)&&F.visible&&F.modal&&D.$focusParent!=F){apf.window.$focusLast(F,{mouse:true});}else{if(!D&&apf.document.activeElement){apf.window.$focusRoot();}else{if(D.$isWindowContainer==-1){if(D.$tabList.length){apf.window.moveNext(null,D.$tabList[0],null,{mouse:true});}else{apf.window.$focus(D);}}else{if(!D.disabled&&D.focussable!==false){if(D.$focussable===apf.KEYBOARD_MOUSE){apf.window.$focus(D,{mouse:true});}else{if(D.canHaveChildren==2){if(!apf.config.allowBlur||!apf.document.activeElement||apf.document.activeElement.$focusParent!=D){apf.window.$focusLast(D,{mouse:true});}}else{apf.window.$focusDefault(D,{mouse:true});}}}else{apf.window.$focusDefault(D,{mouse:true});}}}}if(apf.hasFocusBug){var B=m[(G.srcElement||G.target).tagName]&&!(G.srcElement||G.target).disabled||(G.srcElement&&G.srcElement.isContentEditable)||D.$isContentEditable&&D.$isContentEditable(G)&&!D.disabled;if(!D||!B){apf.window.$focusfix();}}else{if(!t){apf.window.$focusevent();}}}}apf.dispatchEvent("mousedown",{htmlEvent:G,amlNode:D||apf.document.documentElement});var E=!(!apf.isIphone&&!apf.isIE&&(apf.document&&!apf.config.allowSelect&&(!apf.isParsingPartial||D)||apf.dragMode)&&!m[G.target.tagName]);if(E){D=apf.findHost(G.target);if(D){var B=m[(G.srcElement||G.target).tagName]&&!(G.srcElement||G.target).disabled||(G.srcElement&&G.srcElement.isContentEditable)||D.$isContentEditable&&D.$isContentEditable(G)&&!D.disabled;if(!B&&D.nodeType!=D.NODE_PROCESSING_INSTRUCTION&&!D.$allowSelect&&!D.getElementsByTagNameNS(apf.ns.xhtml,"*").length){E=false;}}}if(!E&&!C){if(G.preventDefault){G.preventDefault();}return false;}});apf.addListener(document,"selectstart",function(D){if(!D){D=event;}var C=!(apf.document&&!apf.config.allowSelect||apf.dragMode);if(C){var B=apf.findHost(D.srcElement);if(B&&B.nodeType!=B.NODE_PROCESSING_INSTRUCTION&&!B.$allowSelect&&!B.getElementsByTagNameNS(apf.ns.xhtml,"*").length){C=false;}}if(!C){D.returnValue=false;return false;}});apf.addListener(document,"keyup",this.$keyup=function(B){if(!B){B=event;}if(apf.document&&apf.document.activeElement&&!apf.document.activeElement.disableKeyboard&&apf.document.activeElement.dispatchEvent("keyup",{keyCode:B.keyCode,ctrlKey:B.ctrlKey,shiftKey:B.shiftKey,altKey:B.altkey,htmlEvent:B})===false){B.returnValue=false;return false;}apf.dispatchEvent("keyup",null,B);});function q(F){if(!F){F=event;}var I=null;if(F.wheelDelta){I=F.wheelDelta/120;if(apf.isOpera){I*=-1;}}else{if(F.detail){I=-F.detail/3;}}if(I!==null){if(apf.isIE){var D=F.srcElement||F.target;while(D&&D.scrollHeight<=D.offsetHeight){D=D.parentNode;}if(!D){return;}if(D.nodeType==9){D=D.documentElement;}if(D&&D.tagName=="BODY"&&"auto|scroll".indexOf(apf.getStyle(D,"overflowY"))==-1){D=document.documentElement;}if(D&&"auto|scroll".indexOf(apf.getStyle(D,"overflowY"))>-1){var B,G=0.35*D.offsetHeight*I;if(I<0){if(D&&D.scrollTop>=(B=D.scrollHeight-D.offsetHeight+apf.getVerBorders(D))+G){D.scrollTop=B;F.returnValue=false;}}else{if(D&&D.scrollTop<=G){D.scrollTop=0;F.returnValue=false;}}}}var E={delta:I,target:F.target||F.srcElement},C=apf.dispatchEvent("mousescroll",E);if(C===false||E.returnValue===false){if(F.preventDefault){F.preventDefault();}F.returnValue=false;}}}if(document.addEventListener){document.addEventListener("DOMMouseScroll",q,false);}window.onmousewheel=document.onmousewheel=q;apf.addListener(document,"keydown",this.$keydown=function(F){F=F||event;if(F.keyCode==93){apf.contextMenuKeyboard=true;}var E=apf.findHost(F.srcElement||F.target),K=m[(F.explicitOriginalTarget||F.srcElement||F.target).tagName]||(F.srcElement&&F.srcElement.isContentEditable)||(E&&E.hasFeature(apf.__CONTENTEDITABLE__));var D,C=apf.isMac?F.metaKey:F.ctrlKey;if(!K&&apf.config.undokeys&&C){if(F.keyCode==90){D=apf.document.activeElement;while(D&&!D.getActionTracker&&!D.$at){D=D.parentNode;}if(!D){D=apf.window;}(D.$at||D.getActionTracker()).undo();}else{if(F.keyCode==89){D=apf.document.activeElement;while(D&&!D.getActionTracker&&!D.$at){D=D.parentNode;}if(!D){D=apf.window;}(D.$at||D.getActionTracker()).redo();}}}var G={ctrlKey:F.ctrlKey,metaKey:F.metaKey,shiftKey:F.shiftKey,altKey:F.altKey,keyCode:F.keyCode,htmlEvent:F,bubbles:true};if(apf.dispatchEvent("hotkey",G)===false||G.returnValue===false){F.returnValue=false;F.cancelBubble=true;if(F.stopPropagation){F.stopPropagation();}if(apf.canDisableKeyCodes){try{F.keyCode=0;}catch(F){}}if(F.preventDefault){F.preventDefault();}return false;}var J=[];if(F.altKey){J.push("Alt");}if(F.ctrlKey){J.push("Ctrl");}if(F.shiftKey){J.push("Shift");}if(F.metaKey){J.push("Meta");}if(apf.keyNames[F.keyCode]){J.push(apf.keyNames[F.keyCode]);}if(J.length){if(F.keyCode>46){J.push(String.fromCharCode(F.keyCode));}apf.setProperty("hotkey",J.join("-"));}if(apf.document.activeElement&&!apf.document.activeElement.disableKeyboard&&apf.document.activeElement.dispatchEvent("keydown",G)===false){F.returnValue=false;F.cancelBubble=true;if(apf.canDisableKeyCodes){try{F.keyCode=0;}catch(F){}}if(F.preventDefault){F.preventDefault();}return false;}else{if((!apf.config.disableTabbing||apf.document.activeElement)&&F.keyCode==9){if(F.ctrlKey&&apf.document.activeElement){var I=apf.document.activeElement.$focusParent;if(I.modal){if(F.preventDefault){F.preventDefault();}return false;}apf.window.moveNext(F.shiftKey,apf.document.activeElement.$focusParent,true);I=apf.document.activeElement.$focusParent;if(I&&I.bringToFront){I.bringToFront();}}else{if(!apf.document.activeElement||apf.document.activeElement.tagName!="menu"){apf.window.moveNext(F.shiftKey);}}if(F.preventDefault){F.preventDefault();}return false;}}var B=apf.isMac?F.metaKey:F.altKey;if(apf.config.disableBackspace&&F.keyCode==8&&!K){if(apf.canDisableKeyCodes){try{F.keyCode=0;}catch(F){}}F.returnValue=false;}if(apf.config.disableF5&&(F.keyCode==116||F.keyCode==117)){if(apf.canDisableKeyCodes){try{F.keyCode=0;}catch(F){}}else{F.preventDefault();F.stopPropagation();}}if(F.keyCode==27){F.returnValue=false;}if(!apf.config.allowSelect&&F.shiftKey&&(F.keyCode>32&&F.keyCode<41)&&!K){F.returnValue=false;}if(F.returnValue===false&&F.preventDefault){F.preventDefault();}return F.returnValue;});apf.document={};this.init=function(B){if(apf.actiontracker){this.$at=new apf.actiontracker();this.$at.name="default";apf.nameserver.register("actiontracker","default",this.$at);}this.$domParser=new apf.DOMParser();this.document=apf.document=this.$domParser.parseFromString(B,"text/xml",{timeout:apf.config.initdelay,callback:function(D){if(apf.parsed!=2){var C=apf.parsed;apf.parsed=2;apf.dispatchEvent("parse",{initial:C});apf.parsed=true;}if(!apf.loaded){if(apf.isDeskrun){apf.window.deskrun.Show();}if(!apf.document.activeElement&&!apf.config.allowBlur){apf.window.focusDefault();}apf.loaded=true;$setTimeout(function(){apf.dispatchEvent("load");});}}});this.addEventListener("focus",function(C){if(!apf.document.activeElement&&n&&!apf.isIphone){if(n.$isWindowContainer==-1){if(n.$tabList.length){apf.window.moveNext(null,n.$tabList[0]);}else{apf.window.$focus(n);}}else{apf.window.$focusLast(n);}}});this.addEventListener("blur",function(C){if(!apf.document.activeElement||apf.isIphone){return;}apf.document.activeElement.blur(true,{srcElement:this});n=apf.document.activeElement.$focusParent;apf.activeElement=apf.document.activeElement=null;});};this.destroy=function(){this.$at=null;apf.unload(this);apf=this.win=this.window=this.document=null;window.onfocus=window.onerror=window.onunload=window.onbeforeunload=window.onbeforeprint=window.onafterprint=window.onmousewheel=window.onblur=null;document.oncontextmenu=document.onmousedown=document.onmousemove=document.onmouseup=document.onselectstart=document.onmousewheel=document.onkeyup=document.onkeydown=null;if(document.body){document.body.onmousedown=document.body.onmousemove=document.body.onmouseup=null;document.body.innerHTML="";}};};apf.window.prototype=new apf.Class().$init();apf.window=new apf.window();apf.sanitizeTextbox=function(a){a.onfocus=function(){if(apf.window){apf.window.$focusfix2();}};a.onblur=function(){if(apf.window){apf.window.$blurfix();}};};apf.runGecko=function(){if(apf.runNonIe){apf.runNonIe();}HTMLDocument.prototype.selectNodes=XMLDocument.prototype.selectNodes=function(j,d){try{var o=this.evaluate(j,(d||this),this.createNSResolver(this.documentElement),7,null);}catch(n){var q=n.message;if(n.code==n.INVALID_EXPRESSION_ERR){q=q.replace(/the expression/i,"'"+j+"'");}throw new c(n.lineNumber,"XPath error: "+q);}var l=new Array(o.snapshotLength);l.expr=j;for(var m=l.length-1;m>=0;m--){l[m]=o.snapshotItem(m);}return l;};Text.prototype.selectNodes=Element.prototype.selectNodes=function(d){return this.ownerDocument.selectNodes(d,this);};HTMLDocument.prototype.selectSingleNode=XMLDocument.prototype.selectSingleNode=function(i,d){var j=this.selectNodes(i+"[1]",d||null);return j[0]||null;};Text.prototype.selectSingleNode=Element.prototype.selectSingleNode=function(d){return this.ownerDocument.selectSingleNode(d,this);};var a=new XMLSerializer();apf.insertHtmlNodes=function(m,s,j){var t=document.createElement("div"),u=document.createDocumentFragment(),n=m.length-1,d,q;for(;n>=0;n--){q=m[n];u.insertBefore(q,u.firstChild);}t.innerHTML=apf.html_entity_decode(a.serializeToString(u)).replace(/<([^>]+)\/>/g,"<$1></$1>");u=document.createDocumentFragment();for(n=0,d=t.childNodes.length;n<d;n++){q=t.childNodes[0];u.appendChild(q);}if(j){s.insertBefore(u,j);}s.appendChild(u);};apf.insertHtmlNode=function(i,l,d,j){var m=document.createElement("div");if(!j){j=apf.html_entity_decode(i.serialize?i.serialize(true):((i.nodeType==3||i.nodeType==4||i.nodeType==2)?i.nodeValue:a.serializeToString(i)));}m.innerHTML=j.replace(/<([^>]+)\/>/g,"<$1></$1>");if(d){l.insertBefore(m.firstChild,d);}l.appendChild(m.firstChild);return d?d.previousSibling:l.lastChild;};function c(d,i){this.message=i;this.nr=d;}};apf.initGears=function(){var a,c;var i=apf.nameserver.get("google","gears");if(i){return i;}if(typeof GearsFactory!="undefined"){a=new GearsFactory();}else{if(apf.isIE){try{a=new ActiveXObject("Gears.Factory");}catch(d){}}else{if(navigator.mimeTypes["application/x-googlegears"]){a=document.createElement("object");a.setAttribute("type","application/x-googlegears");a.setAttribute("width",0);a.setAttribute("height",0);a.style.display="none";document.documentElement.appendChild(a);}}}if(!a){return null;}return apf.nameserver.register("google","gears",a);};apf.runIphone=function(){if(!apf.isIphone){return;}$setTimeout(function(){apf.importCssString('html, body {                margin: 0;                font-family: Helvetica;                background: #fff;                color: #000000;                overflow-x: hidden;                -webkit-user-select: none;                -webkit-text-size-adjust: none;                -webkit-touch-callout: none;            }            body > *:not(.toolbar) {                min-height: 372px;            }            body[orient="landscape"] > *:not(.toolbar) {                min-height: 268px;            }            body > *[selected="true"] {                display: block;            }',"screen");var o=document.getElementsByTagName("head")[0];if(apf.config.iphoneIcon){var q=document.createElement("link");q.setAttribute("rel","apple-touch-icon"+(apf.config.iphoneIconIsGlossy?"":"-precomposed"));q.setAttribute("href","apf.config.iphoneIcon");o.appendChild(q);}function s(t,u){var w=document.createElement("meta");w.setAttribute("name",t);w.setAttribute("content",u);o.appendChild(w);}if(apf.config.iphoneFixedViewport){s("viewport","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;");}if(apf.config.iphoneFullScreen){s("apple-mobile-web-app-capable","yes");if(apf.config.iphoneStatusBar){s("apple-mobile-web-app-status-bar-style","apf.config.iphoneStatusBar");}}});var a=false,d=0,l="portrait",i="landscape",j=null;apf.addDomLoadEvent(function(){$setTimeout(c,0);j=setInterval(c,300);});function n(){switch(window.orientation){case 0:m(l);break;case 90:case -90:m(i);break;}}if(typeof window.onorientationchange=="object"){window.onorientationchange=n;a=true;$setTimeout(n,0);}function c(){if(!a){if(window.innerWidth!=d){d=window.innerWidth;var o=d==320?l:i;m(o);}}}function m(o){document.body.setAttribute("orient",o);$setTimeout("scrollTo(0,1)",100);}["gesturestart","gesturechange","gestureend","orientationchange"].forEach(function(o){document["on"+o]=function(q){if(apf.dispatchEvent){apf.dispatchEvent(o,q);}};});apf.iphone={titleNode:null,linkEvents:function(s,q){return;s[q?"onclick":"ontouchstart"]=function(t){if(!t.touches||t.touches.length!=1){return;}var u=t.touches[0];if(typeof this.onmousedown=="function"){this.onmousedown(u);if(this!=document){return false;}}};s.ontouchmove=function(t){if(!t.touches||t.touches.length!=1){return;}var u=t.touches[0];if(typeof this.onmousemove=="function"){this.onmousemove(u);if(this!=document){return false;}}};var o=false;s.ontouchend=s.ontouchcancel=function(t){if(o){return;}var u=t.touches&&t.touches.length?t.touches[0]:t.changedTouches[0];if(!u){return;}o=true;$setTimeout(function(){o=false;});if(typeof this.onmouseup=="function"){this.onmouseup(u);if(this!=document){return false;}}};return this;},nav:{sections:null,active:null,def:"home",divideChar:"/",levelTwoChar:"-",go:function(z,u){var w,q,A=apf.iphone.nav;A.update();if(!(q=A.sections[z.page])){return;}scrollTo(0,1);apf.dispatchEvent("pagechange",z);var C=q.getAttribute("title");if(apf.iphone.titleNode&&C){apf.iphone.titleNode.innerHTML=C;}if(u){for(w in A.sections){A.sections[w].hide();}q.show();}else{for(w in A.sections){if(!A.sections[w].visible||w==z.page){continue;}var B=A.sections[w];B.setProperty("zindex",0);apf.tween.single(B.$ext,{steps:5,interval:10,from:B.$ext.offsetLeft,to:(z.index<0)?1000:-1000,type:"left",anim:apf.tween.EASEOUT,onfinish:function(){B.setProperty("visible",false);}});}var t=10,s=q.$ext,o=(z.index<0)?-(s.offsetWidth)-t:window.innerWidth+s.offsetLeft+t;q.setProperty("visible",true);q.setProperty("zindex",apf.all.length+1);apf.tween.single(s,{steps:5,interval:10,from:o,to:0,type:"left",anim:apf.tween.EASEIN});}},update:function(q){if(this.sections&&!q){return;}this.sections={};for(var o in window){if(window[o]&&window[o]["tagName"]&&window[o].tagName=="section"){this.sections[o]=window[o];}}}}};$setTimeout(function(){apf.addEventListener("hashchange",apf.iphone.nav.go);if(location.href.match(/#(.*)$/)){apf.history.init(decodeURI(RegExp.$1));}else{if(apf._GET.page){apf.history.init(apf._GET.page);}else{apf.history.init();}}});document.ontouchstart=function(o){if(!o.touches||o.touches.length!=1){return;}var t=o.touches[0],s=t.target,q=apf.findHost(t.target);if(!q){return;}while(typeof s.onmousedown!="function"&&s!=document.body){s=s.parentNode;}if(typeof s.onmousedown=="function"){if(typeof s.onmouseover=="function"){s.onmouseover(t);}else{if(typeof s.onmousemove=="function"){s.onmousemove(t);}}s.onmousedown(t);return false;}};document.ontouchmove=function(o){if(!o.touches||o.touches.length!=1){return;}var t=o.touches[0],s=t.target,q=apf.findHost(t.target);if(!q){return;}while(typeof s.onmousemove!="function"&&s!=document.body){s=s.parentNode;}if(typeof s.onmousemove=="function"){s.onmousemove(t);return false;}else{if(typeof document.onmousemove=="function"){return document.onmousemove(t);}}};document.ontouchend=document.ontouchcancel=function(o){var t=o.touches&&o.touches.length?o.touches[0]:o.changedTouches[0];if(!t){return;}var s=t.target,q=apf.findHost(t.target);if(!q){return;}while(typeof s.onmouseup!="function"&&s!=document.body){s=s.parentNode;}if(typeof s.onmouseup=="function"){if(typeof s.onmouseout=="function"){s.onmouseout(t);}s.onmouseup(t,true);return false;}else{if(typeof document.onmouseup=="function"){return document.onmouseup(t);}}};};apf.runIE=function(){var a=false,d=false;if(self.XMLHttpRequest){try{new XMLHttpRequest();}catch(c){a=true;}}try{new ActiveXObject("microsoft.XMLHTTP");}catch(c){d=true;}if(d){apf.importClass(runTpIframe,true,self);}apf.getHttpReq=d?function(){if(apf.availHTTP.length){return apf.availHTTP.pop();}return new XMLHttpRequest();}:function(){if(apf.availHTTP.length){return apf.availHTTP.pop();}return new ActiveXObject("microsoft.XMLHTTP");};apf.getXmlDom=d?function(l,i){var j=getDOMParser(l,i);return j;}:function(m,i,l){var j=new ActiveXObject("microsoft.XMLDOM");j.setProperty("SelectionLanguage","XPath");if(l){j.preserveWhiteSpace=true;}if(m){if(apf.cantParseXmlDefinition){m=m.replace(/\] \]/g,"] ]").replace(/^<\?[^>]*\?>/,"");}j.loadXML(m);if(j.parseError!=0&&apf.xmldb&&apf.isJson(m)){try{j=apf.json2Xml(m,i);}catch(n){throw new Error(apf.formatErrorString(1051,null,"JSON to XML conversion error occurred."+n.message,"\nSource Text : "+m.replace(/\t/gi," ")));}}else{if(!i){this.xmlParseError(j);}}}return j;};apf.xmlParseError=function(j){var i=j.parseError;if(i!=0){throw new Error(apf.formatErrorString(1050,null,"XML Parse error on line "+i.line,i.reason+"Source Text:\n"+i.srcText.replace(/\t/gi," ")));}return j;};apf.getStyle=function(i,j){return i.currentStyle[j];};apf.insertHtmlNodes=function(o,s,n){for(var u=[],q=0,m=o.length;q<m;q++){u[q]=o[q].xml;}u=apf.html_entity_decode(u.join(""));if(apf.isIE<7){u=u.replace(/style="background-image:([^"]*)"/g,"find='$1' style='background-image:$1'");}try{(n||s).insertAdjacentHTML(n?"beforebegin":"beforeend",u);}catch(t){document.body.insertAdjacentHTML("beforeend","<table><tr>"+u+"</tr></table>");var j=document.body.lastChild.firstChild.firstChild;for(q=j.childNodes.length-1;q>=0;q--){s.appendChild(j.childNodes[apf.hasDynamicItemList?0:q]);}}if(apf.isIE<7){$setTimeout(function(){var z=s.getElementsByTagName("*");for(var B,A=0,w=z.length;A<w;A++){if(B=z[A].getAttribute("find")){z[A].style.backgroundImage=B.trim();}}});}};apf.insertHtmlNode=function(l,m,i,o){if(m.nodeType!=11&&!m.style){return m.appendChild(l);}var j=i||m;if(!o){o=apf.html_entity_decode(l.serialize?l.serialize(true):l.xml||l.outerHTML||l.nodeValue);}try{j.insertAdjacentHTML(i?"beforeBegin":"beforeEnd",o);}catch(n){j.insertAdjacentHTML("afterEnd",o);return j.nextSibling;}return i?i.previousSibling:m.lastChild;};apf.getHorBorders=function(i){return Math.max(0,(parseInt(i.currentStyle.borderLeftWidth)||0)+(parseInt(i.currentStyle.borderRightWidth)||0));};apf.getVerBorders=function(i){return Math.max(0,(parseInt(i.currentStyle.borderTopWidth)||0)+(parseInt(i.currentStyle.borderBottomWidth)||0));};apf.getWidthDiff=function(i){return Math.max(0,(parseInt(i.currentStyle.paddingLeft)||0)+(parseInt(i.currentStyle.paddingRight)||0)+(parseInt(i.currentStyle.borderLeftWidth)||0)+(parseInt(i.currentStyle.borderRightWidth)||0));};apf.getHeightDiff=function(i){return Math.max(0,(parseInt(i.currentStyle.paddingTop)||0)+(parseInt(i.currentStyle.paddingBottom)||0)+(parseInt(i.currentStyle.borderTopWidth)||0)+(parseInt(i.currentStyle.borderBottomWidth)||0));};apf.getDiff=function(i){return[Math.max(0,(parseInt(i.currentStyle.paddingLeft)||0)+(parseInt(i.currentStyle.paddingRight)||0)+(parseInt(i.currentStyle.borderLeftWidth)||0)+(parseInt(i.currentStyle.borderRightWidth)||0)),Math.max(0,(parseInt(i.currentStyle.paddingTop)||0)+(parseInt(i.currentStyle.paddingBottom)||0)+(parseInt(i.currentStyle.borderTopWidth)||0)+(parseInt(i.currentStyle.borderBottomWidth)||0))];};apf.getMargin=function(i){return[Math.max(0,(parseInt(i.currentStyle.marginLeft)||0)+(parseInt(i.currentStyle.marginRight)||0)),Math.max(0,(parseInt(i.currentStyle.marginTop)||0)+(parseInt(i.currentStyle.marginBottom)||0))];};apf.popup2={cache:{},setContent:function(n,m,l,j,i){if(!this.popup){this.init();}this.cache[n]={content:m,style:l,width:j,height:i};if(m.parentNode){m.parentNode.removeChild(m);}if(l){apf.importCssString(l,this.popup.document);}return this.popup.document;},removeContent:function(i){this.cache[i]=null;delete this.cache[i];},init:function(){this.popup=window.createPopup();this.popup.document.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                <html xmlns="http://www.w3.org/1999/xhtml" xmlns:a='+apf.ns.aml+' xmlns:xsl="http://www.w3.org/1999/XSL/Transform">                <head>                    <script>                    var apf = {                        all: [],                        lookup:function(uniqueId){                            return this.all[uniqueId] || {                                $setStyleClass:function(){}                            };                        }                    };                    function destroy(){                        apf.all=null;                    }                    <\/script>                    <style>                    HTML{border:0;overflow:hidden;margin:0}                    BODY{margin:0}                    </style>                </head>                <body onmouseover="if(!self.apf) return;if(this.c){apf.all = this.c.all;this.c.Popup.parentDoc=self;}"></body>                </html>');var i=apf;this.popup.document.body.onmousemove=function(){this.c=i;};},show:function(C,w,u,m,q,l,B,A){if(!this.popup){this.init();}var n=this.cache[C];this.popup.document.body.innerHTML=n.content.outerHTML;if(m){var z,t=7,s=0,j=this.popup;z=setInterval(function(){var i=++s*((B||n.height)/t);j.show(w,u,l||n.width,i,q);j.document.body.firstChild.style.marginTop=(s-t-1)*((B||n.height)/t);if(s>t){clearInterval(z);A(j.document.body.firstChild);}},10);}else{this.popup.show(w,u,l||n.width,B||n.height,q);}this.last=C;},hide:function(){if(this.popup){this.popup.hide();}},forceHide:function(){if(this.last){apf.lookup(this.last).dispatchEvent("popuphide");}},destroy:function(){if(!this.popup){return;}this.popup.document.body.c=null;this.popup.document.body.onmouseover=null;}};apf.importClass(apf.runXpath,true,self);};apf.runNonIe=function(){DocumentFragment.prototype.getElementById=function(n){return this.childNodes.length?this.childNodes[0].ownerDocument.getElementById(n):null;};if(XMLDocument.prototype.__defineGetter__){XMLDocument.prototype.__defineGetter__("xml",function(){return(new XMLSerializer()).serializeToString(this);});XMLDocument.prototype.__defineSetter__("xml",function(){throw new Error(apf.formatErrorString(1042,null,"XML serializer","Invalid assignment on read-only property 'xml'."));});Node.prototype.__defineGetter__("xml",function(){if(this.nodeType==3||this.nodeType==4||this.nodeType==2){return this.nodeValue;}return(new XMLSerializer()).serializeToString(this);});Element.prototype.__defineGetter__("xml",function(){return(new XMLSerializer()).serializeToString(this);});}if(typeof HTMLElement!="undefined"){if(!HTMLElement.prototype.insertAdjacentElement){Text.prototype.insertAdjacentElement=HTMLElement.prototype.insertAdjacentElement=function(n,o){switch(n.toLowerCase()){case"beforebegin":this.parentNode.insertBefore(o,this);break;case"afterbegin":this.insertBefore(o,this.firstChild);break;case"beforeend":this.appendChild(o);break;case"afterend":if(this.nextSibling){this.parentNode.insertBefore(o,this.nextSibling);}else{this.parentNode.appendChild(o);}break;}};}if(!HTMLElement.prototype.insertAdjacentHTML){Text.prototype.insertAdjacentHTML=HTMLElement.prototype.insertAdjacentHTML=function(o,s){var q=this.ownerDocument.createRange();q.setStartBefore(apf.isWebkit?document.body:(self.document?document.body:this));var n=q.createContextualFragment(s);this.insertAdjacentElement(o,n);};}if(!HTMLBodyElement.prototype.insertAdjacentHTML){HTMLBodyElement.prototype.insertAdjacentHTML=HTMLElement.prototype.insertAdjacentHTML;}if(!HTMLElement.prototype.insertAdjacentText){Text.prototype.insertAdjacentText=HTMLElement.prototype.insertAdjacentText=function(o,q){var n=document.createTextNode(q);this.insertAdjacentElement(o,n);};}HTMLElement.prototype.removeNode=function(){if(!this.parentNode){return;}this.parentNode.removeChild(this);};if(HTMLElement.prototype.__defineSetter__){HTMLElement.prototype.__defineSetter__("innerText",function(n){var o=""+n;this.innerHTML=o.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");});HTMLElement.prototype.__defineGetter__("innerText",function(){return this.innerHTML.replace(/<[^>]+>/g,"").replace(/\s\s+/g," ").replace(/^\s*|\s*$/g," ");});HTMLElement.prototype.__defineGetter__("outerHTML",function(){return(new XMLSerializer()).serializeToString(this);});}}var d=false;try{XMLDocument.prototype.async=true;d=true;}catch(l){}Document.prototype.onreadystatechange=null;Document.prototype.parseError=0;Array.prototype.item=function(n){return this[n];};Array.prototype.expr="";try{XMLDocument.prototype.readyState=0;}catch(l){}XMLDocument.prototype.$clearDOM=function(){while(this.hasChildNodes()){this.removeChild(this.firstChild);}};XMLDocument.prototype.$copyDOM=function(n){this.$clearDOM();if(n.nodeType==9||n.nodeType==11){var q=n.childNodes;for(var o=0;o<q.length;o++){this.appendChild(this.importNode(q[o],true));}}else{if(n.nodeType==1){this.appendChild(this.importNode(n,true));}}};XMLDocument.prototype.loadXML=function(q){apf.xmldb.setReadyState(this,1);var o=this.xml||this.serialize();var n=(new DOMParser()).parseFromString(q,"text/xml");apf.xmldb.setReadyState(this,2);this.$copyDOM(n);apf.xmldb.setReadyState(this,3);apf.xmldb.loadHandler(this);return o;};Node.prototype.getElementById=function(n){};HTMLElement.prototype.replaceNode=Element.prototype.replaceNode=function(n){if(!this.parentNode){return;}this.parentNode.insertBefore(n,this);this.parentNode.removeChild(this);};XMLDocument.prototype.$load=XMLDocument.prototype.load;XMLDocument.prototype.load=function(s){var n=document.implementation.createDocument("","",null);n.$copyDOM(this);this.parseError=0;apf.xmldb.setReadyState(this,1);try{if(this.async==false&&d){var o=new XMLHttpRequest();o.open("GET",s,false);o.overrideMimeType("text/xml");o.send(null);apf.xmldb.setReadyState(this,2);this.$copyDOM(o.responseXML);apf.xmldb.setReadyState(this,3);}else{this.$load(s);}}catch(q){this.parseError=-1;}finally{apf.xmldb.loadHandler(this);}return n;};Element.prototype.transformNodeToObject=function(q,o){var n=document.implementation.createDocument("","",null);n.$copyDOM(this);n.transformNodeToObject(q,o);};Document.prototype.transformNodeToObject=function(t,o){var n=null;try{n=new XSLTProcessor();if(n.reset){t=apf.getXmlDom(t.xml||t.serialize());n.importStylesheet(t);var q=n.transformToFragment(this,o);o.$copyDOM(q);}else{n.transformDocument(this,t,o,null);}}catch(s){if(t&&o){throw new Error(apf.formatErrorString(1043,null,"XSLT Transformation","Failed to transform document. \nInfo : "+s));}else{if(!t){throw new Error(apf.formatErrorString(1044,null,"XSLT Transformation","No Stylesheet Document was provided. \nInfo : "+s));}else{if(!o){throw new Error(apf.formatErrorString(1045,null,"XSLT Transformation","No Result Document was provided. \nInfo : "+s));}else{if(n==null){throw new Error(apf.formatErrorString(1046,null,"XSLT Transformation","Could not instantiate an XSLTProcessor object. \nInfo : "+s));}else{throw s;}}}}}};Element.prototype.transformNode=function(n){return apf.getXmlDom(this.xml||this.serialize()).transformNode(n);};Document.prototype.transformNode=function(q){var n=new XSLTProcessor();q=apf.getXmlDom(q.xml||q.serialize());n.importStylesheet(q);var o=n.transformToFragment(this,document.implementation.createDocument("","",null));return o.xml||o.serialize();};apf.getStyle=function(n,o){return window.getComputedStyle(n,"").getPropertyValue(o);};HTMLDocument.prototype.setProperty=XMLDocument.prototype.setProperty=function(n,o){};apf.getHttpReq=function(){if(apf.availHTTP.length){return apf.availHTTP.pop();}return new XMLHttpRequest();};apf.getXmlDom=function(q,n){var o;if(q){o=new DOMParser();o=o.parseFromString(q,"text/xml");if(o.documentElement.tagName=="parsererror"&&apf.xmldb&&apf.isJson(q)){try{o=apf.json2Xml(q,n);}catch(s){throw new Error(apf.formatErrorString(1051,null,"JSON to XML conversion error occurred.","\nSource Text : "+q.replace(/\t/gi," ")));}}else{if(!n){this.xmlParseError(o);}}}else{o=document.implementation.createDocument("","",null);}return o;};apf.xmlParseError=function(o){if(o.documentElement.tagName=="parsererror"){var t=o.documentElement.firstChild.nodeValue.split("\n"),q=t[2].match(/\w+ (\d+)/)[1],s=t[0].replace(/\w+ \w+ \w+: (.*)/,"$1"),n=o.documentElement.lastChild.firstChild.nodeValue.split("\n")[0];throw new Error(apf.formatErrorString(1050,null,"XML Parse Error on line "+q,s+"\nSource Text : "+n.replace(/\t/gi," ")));}return o;};apf.xmldb.setReadyState=function(n,o){n.readyState=o;if(n.onreadystatechange!=null&&typeof n.onreadystatechange=="function"){n.onreadystatechange();}};apf.xmldb.loadHandler=function(n){if(!n.documentElement||n.documentElement.tagName=="parsererror"){n.parseError=-1;}apf.xmldb.setReadyState(n,4);};apf.Init.add(function(){var o,n=document.getElementsByTagName("form");for(o=0;o<n.length;o++){n[o].removeNode();}n=document.getElementsByTagName("xml");for(o=0;o<n.length;o++){n[o].removeNode();}n=null;});if(document.body){document.body.focus=function(){};}if(!document.elementFromPoint){Document.prototype.elementFromPointRemove=function(n){if(!this.RegElements){return;}this.RegElements.remove(n);};Document.prototype.elementFromPointAdd=function(n){if(!this.RegElements){this.RegElements=[];}this.RegElements.push(n);};Document.prototype.elementFromPointReset=function(n){FoundValue=[];FoundNode=null;LastFoundAbs=document.documentElement;};Document.prototype.elementFromPoint=function(D,A){document.elementFromPointReset();if(this.RegElements){var E=-1,s,q,o,C,B,u,t,w;for(E=-1,q,s=0;s<this.RegElements.length;s++){o=this.RegElements[s];if(a(o,"display")=="none"){continue;}C=m(o);B=j(o);u=C+o.offsetWidth;t=B+o.offsetHeight;if(D>C&&D<u&&A>B&&A<t){w=i(o);if(w>E){q=[o,D,A,C,B];E=w;}}}if(q){c(q[0],q[1],q[2],0,FoundValue,q[3],q[4]);if(!FoundNode){FoundNode=q[0];LastFoundAbs=q[0];FoundValue=[E];}}}if(!this.RegElements||!this.RegElements.length){c(document.body,D,A,0,[],m(document.body),j(document.body));}return FoundNode;};function a(n,o){return document.defaultView.getComputedStyle(n,"").getPropertyValue(o);}function c(I,u,t,w,O,B,A){var P=O,E=w,G=I.childNodes,F,J,s,D,C,N,M,K,o,q;for(F,J=0;J<I.childNodes.length;J++){F=I.childNodes[J];if(F.nodeType==1&&a(F,"display")!="none"&&F.offsetParent){D=B+F.offsetLeft-F.offsetParent.scrollLeft;C=A+F.offsetTop-F.offsetParent.scrollTop;N=D+F.offsetWidth;M=C+F.offsetHeight;K=a(F,"position");K=(K=="absolute")||(K=="relative");o=a(F,"overflow")=="hidden";q=(u>D&&u<N&&t>C&&t<M);if(K&&o&&!q){continue;}w=E;O=P.copy();s=parseInt(a(F,"z-index"))||0;if(K&&(s||s==0)||o){if(!K){s=0;}if(s>=(FoundValue[w]||0)){if(s>(O[w]||0)){O[w]=s;}w++;if(q&&w>=FoundValue.length){FoundNode=F;FoundValue=O;LastFoundAbs=F;}}else{continue;}}else{if(q&&w>=FoundValue.length){FoundNode=F;FoundValue=O;}}c(F,u,t,w,O,K?D:B,K?C:A);}}}function j(n){return n.offsetTop+parseInt(apf.getStyle(n,"border-top-width"))+(n.offsetParent?j(n.offsetParent):0);}function m(n){return n.offsetLeft+parseInt(apf.getStyle(n,"border-left-width"))+(n.offsetParent?m(n.offsetParent):0);}function i(s){var q=0,t,o=s;while(o&&o.nodeType==1){q=Math.max(q,parseInt(a(o,"z-index"))||-1);o=o.parentNode;}return q;}}apf.getHorBorders=function(n){return Math.max(0,(parseInt(apf.getStyle(n,"border-left-width"))||0)+(parseInt(apf.getStyle(n,"border-right-width"))||0));};apf.getVerBorders=function(n){return Math.max(0,(parseInt(apf.getStyle(n,"border-top-width"))||0)+(parseInt(apf.getStyle(n,"border-bottom-width"))||0));};apf.getWidthDiff=function(n){return Math.max(0,(parseInt(apf.getStyle(n,"padding-left"))||0)+(parseInt(apf.getStyle(n,"padding-right"))||0)+(parseInt(apf.getStyle(n,"border-left-width"))||0)+(parseInt(apf.getStyle(n,"border-right-width"))||0));};apf.getHeightDiff=function(n){return Math.max(0,(parseInt(apf.getStyle(n,"padding-top"))||0)+(parseInt(apf.getStyle(n,"padding-bottom"))||0)+(parseInt(apf.getStyle(n,"border-top-width"))||0)+(parseInt(apf.getStyle(n,"border-bottom-width"))||0));};apf.getDiff=function(n){return[Math.max(0,parseInt(apf.getStyle(n,"padding-left"))+parseInt(apf.getStyle(n,"padding-right"))+parseInt(apf.getStyle(n,"border-left-width"))+parseInt(apf.getStyle(n,"border-right-width"))||0),Math.max(0,parseInt(apf.getStyle(n,"padding-top"))+parseInt(apf.getStyle(n,"padding-bottom"))+parseInt(apf.getStyle(n,"border-top-width"))+parseInt(apf.getStyle(n,"border-bottom-width"))||0)];};apf.getMargin=function(n){return[Math.max(0,(parseInt(apf.getStyle(n,"margin-left"))||0)+(parseInt(apf.getStyle(n,"margin-right"))||0)),Math.max(0,(parseInt(apf.getStyle(n,"margin-top"))||0)+(parseInt(apf.getStyle(n,"margin-bottom"))||0))];};};apf.runOpera=function(){if(apf.runNonIe){apf.runNonIe();}Document.prototype.selectNodes=XMLDocument.prototype.selectNodes=HTMLDocument.prototype.selectNodes=function(d,c){var m=this.evaluate(d,(c?c:this),this.createNSResolver(this.documentElement),XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);var j=new Array(m.snapshotLength);j.expr=d;for(var l=0;l<j.length;l++){j[l]=m.snapshotItem(l);}return j;};Text.prototype.selectNodes=Element.prototype.selectNodes=function(c){var d=this.ownerDocument;if(!d.selectSingleNode){d.selectSingleNode=HTMLDocument.prototype.selectSingleNode;d.selectNodes=HTMLDocument.prototype.selectNodes;}if(d.selectNodes){return d.selectNodes(c,this);}else{throw new Error(apf.formatErrorString(1047,null,"XPath Selection","Method selectNodes is only supported by XML Nodes"));}};Document.prototype.selectSingleNode=XMLDocument.prototype.selectSingleNode=HTMLDocument.prototype.selectSingleNode=function(d,c){var i=this.selectNodes(d+"[1]",c?c:null);return i.length>0?i[0]:null;};Text.prototype.selectSingleNode=Element.prototype.selectSingleNode=function(c){var d=this.ownerDocument;if(!d.selectSingleNode){d.selectSingleNode=HTMLDocument.prototype.selectSingleNode;d.selectNodes=HTMLDocument.prototype.selectNodes;}if(d.selectSingleNode){return d.selectSingleNode(c,this);}else{throw new Error(apf.formatErrorString(1048,null,"XPath Selection","Method selectSingleNode is only supported by XML Nodes. \nInfo : "+e));}};var a=new XMLSerializer();apf.insertHtmlNodes=function(j,o,d){var n,q=document.createDocumentFragment(),m=0,c=j.length;for(;m<c;m++){if(!(n=j[m])){continue;}q.appendChild(n);}(d||o).insertAdjacentHTML(d?"beforebegin":"beforeend",apf.html_entity_decode(a.serializeToString(q)).replace(/<([^>]+)\/>/g,"<$1></$1>"));};apf.insertHtmlNode=function(d,j,c,i){if(!i){i=apf.html_entity_decode(d.serialize?d.serialize(true):((d.nodeType==3||d.nodeType==4||d.nodeType==2)?d.nodeValue:a.serializeToString(d)));}(c||j).insertAdjacentHTML(c?"beforebegin":"beforeend",i.replace(/<([^>]+)\/>/g,"<$1></$1>"));return c?c.previousSibling:j.lastChild;};};apf.runWebkit=function(){if(!apf.isChrome){var c=window.setTimeout;self.lookupSafariCall=[];$setTimeout=function(i,j){if(typeof i=="string"){return c(i,j);}return c("self.lookupSafariCall["+(self.lookupSafariCall.push(i)-1)+"]()",j);};if(apf.isSafariOld){HTMLHtmlElement=document.createElement("html").constructor;Node=HTMLElement={};HTMLElement.prototype=HTMLHtmlElement.apf.__proto__.apf.__proto__;HTMLDocument=Document=document.constructor;var a=new DOMParser();XMLDocument=a.constructor;Element=a.parseFromString("<Single />","text/xml").documentElement.constructor;a=null;}if(!XMLDocument.prototype.__defineGetter__){Document.prototype.serialize=Node.prototype.serialize=XMLDocument.prototype.serialize=function(){return(new XMLSerializer()).serializeToString(this);};}}HTMLDocument.prototype.selectNodes=XMLDocument.prototype.selectNodes=function(l,j){if(l.substr(0,2)=="//"){l="."+l;}try{var q=this.evaluate(l,(j||this),this.createNSResolver(this.documentElement),7,null);}catch(o){try{var q=this.evaluate("child::"+l,(j||this),this.createNSResolver(this.documentElement),7,null);}catch(o){throw new Error("XPath error: "+o.message+"\nLine: "+o.lineNumber+"\nExpression: '"+l+"'");}}var m=new Array(q.snapshotLength);m.expr=l;for(var n=m.length-1;n>=0;n--){m[n]=q.snapshotItem(n);}return m;};Text.prototype.selectNodes=Element.prototype.selectNodes=function(i){return this.ownerDocument.selectNodes(i,this);};HTMLDocument.prototype.selectSingleNode=XMLDocument.prototype.selectSingleNode=function(j,i){var l=this.selectNodes(j,i||null);return l[0]||null;};Text.prototype.selectSingleNode=Element.prototype.selectSingleNode=function(i){return this.ownerDocument.selectSingleNode(i,this);};var d=new XMLSerializer();apf.insertHtmlNodes=function(o,t,n){var s,u=document.createDocumentFragment(),m=[],q=0,j=o.length;for(;q<j;q++){if(!(s=o[q])){continue;}u.appendChild(s);}(n||t).insertAdjacentHTML(n?"beforebegin":"beforeend",apf.html_entity_decode(d.serializeToString(u)).replace(/<([^>]+)\/>/g,"<$1></$1>"));};apf.insertHtmlNode=function(j,m,i,l){if(!l){l=apf.html_entity_decode(j.serialize?j.serialize(true):((j.nodeType==3||j.nodeType==4||j.nodeType==2)?j.nodeValue:d.serializeToString(j)));}(i||m).insertAdjacentHTML(i?"beforebegin":"beforeend",l.replace(/<([^>]+)\/>/g,"<$1></$1>"));return i?i.previousSibling:m.lastChild;};if(apf.runNonIe){apf.runNonIe();}};apf.crypto.BigInt=(function(){var am=2;var R=16;var t=R;var ab=1<<16;var i=ab>>>1;var X=ab*ab;var ae=ab-1;var aj=9999999999999998;var af;var ak;var s,c;function C(ap){af=ap;ak=new Array(af);for(var ao=0;ao<ak.length;ao++){ak[ao]=0;}s=new a();c=new a();c.digits[0]=1;}C(20);var U=15;var W=w(1000000000000000);function a(ao){if(typeof ao=="boolean"&&ao==true){this.digits=null;}else{this.digits=ak.slice(0);}this.isNeg=false;}function z(at){var ar=at.charAt(0)=="-";var aq=ar?1:0;var ao;while(aq<at.length&&at.charAt(aq)=="0"){++aq;}if(aq==at.length){ao=new a();}else{var ap=at.length-aq;var au=ap%U;if(au==0){au=U;}ao=w(Number(at.substr(aq,au)));aq+=au;while(aq<at.length){ao=l(an(ao,W),w(Number(at.substr(aq,U))));aq+=U;}ao.isNeg=ar;}return ao;}function aa(ap){var ao=new a(true);ao.digits=ap.digits.slice(0);ao.isNeg=ap.isNeg;return ao;}function w(aq){var ao=new a();ao.isNeg=aq<0;aq=Math.abs(aq);var ap=0;while(aq>0){ao.digits[ap++]=aq&ae;aq=Math.floor(aq/ab);}return ao;}function F(aq){var ao="";for(var ap=aq.length-1;ap>-1;--ap){ao+=aq.charAt(ap);}return ao;}var d=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z");function Z(aq,at){var ap=new a();ap.digits[0]=at;var au,ar=E(aq,ap),ao=d[ar[1].digits[0]];while(j(ar[0],s)==1){ar=E(ar[0],ap);au=ar[1].digits[0];ao+=d[ar[1].digits[0]];}return(aq.isNeg?"-":"")+F(ao);}function al(aq){var ap=new a();ap.digits[0]=10;var ar=E(aq,ap);var ao=String(ar[1].digits[0]);while(j(ar[0],s)==1){ar=E(ar[0],ap);ao+=String(ar[1].digits[0]);}return(aq.isNeg?"-":"")+F(ao);}var q=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");function ac(ar){var aq,ap=15,ao="";for(aq=0;aq<4;++aq){ao+=q[ar&ap];ar>>>=4;}return F(ao);}function K(ap){var ao="";var ar=ag(ap);for(var aq=ag(ap);aq>-1;--aq){ao+=ac(ap.digits[aq]);}return ao;}function J(aw){var aq=48;var ap=aq+9;var ar=97;var av=ar+25;var au=65;var at=65+25;var ao;if(aw>=aq&&aw<=ap){ao=aw-aq;}else{if(aw>=au&&aw<=at){ao=10+aw-au;}else{if(aw>=ar&&aw<=av){ao=10+aw-ar;}else{ao=0;}}}return ao;}function V(ar){var ap=0;var ao=Math.min(ar.length,4);for(var aq=0;aq<ao;++aq){ap<<=4;ap|=J(ar.charCodeAt(aq));}return ap;}function ah(at){var ap=new a();var ao=at.length;for(var ar=ao,aq=0;ar>0;ar-=4,++aq){ap.digits[aq]=V(at.substr(Math.max(ar-4,0),Math.min(ar,4)));}return ap;}function M(ax,aw){var ao=ax.charAt(0)=="-";var ar=ao?1:0;var ay=new a();var ap=new a();ap.digits[0]=1;for(var aq=ax.length-1;aq>=ar;aq--){var at=ax.charCodeAt(aq);var au=J(at);var av=n(ap,au);ay=l(ay,av);ap=n(ap,aw);}ay.isNeg=ao;return ay;}function N(ao){return(ao.isNeg?"-":"")+ao.digits.join(" ");}function l(ap,au){var ao;if(ap.isNeg!=au.isNeg){au.isNeg=!au.isNeg;ao=ad(ap,au);au.isNeg=!au.isNeg;}else{ao=new a();var at=0;var ar;for(var aq=0;aq<ap.digits.length;++aq){ar=ap.digits[aq]+au.digits[aq]+at;ao.digits[aq]=ar%ab;at=Number(ar>=ab);}ao.isNeg=ap.isNeg;}return ao;}function ad(ap,au){var ao;if(ap.isNeg!=au.isNeg){au.isNeg=!au.isNeg;ao=l(ap,au);au.isNeg=!au.isNeg;}else{ao=new a();var at,ar;ar=0;for(var aq=0;aq<ap.digits.length;++aq){at=ap.digits[aq]-au.digits[aq]+ar;ao.digits[aq]=at%ab;if(ao.digits[aq]<0){ao.digits[aq]+=ab;}ar=0-Number(at<0);}if(ar==-1){ar=0;for(var aq=0;aq<ap.digits.length;++aq){at=0-ao.digits[aq]+ar;ao.digits[aq]=at%ab;if(ao.digits[aq]<0){ao.digits[aq]+=ab;}ar=0-Number(at<0);}ao.isNeg=!ap.isNeg;}else{ao.isNeg=ap.isNeg;}}return ao;}function ag(ap){var ao=ap.digits.length-1;while(ao>0&&ap.digits[ao]==0){--ao;}return ao;}function T(aq){var at=ag(aq);var ar=aq.digits[at];var ap=(at+1)*t;var ao;for(ao=ap;ao>ap-t;--ao){if((ar&32768)!=0){break;}ar<<=1;}return ao;}function an(aw,av){var az=new a();var au;var ap=ag(aw);var ay=ag(av);var ax,ao,aq,at,ar;for(at=0;at<=ay;++at){au=0;aq=at;for(ar=0;ar<=ap;++ar,++aq){ao=az.digits[aq]+aw.digits[ar]*av.digits[at]+au;az.digits[aq]=ao&ae;au=ao>>>R;}az.digits[at+ap+1]=au;}az.isNeg=aw.isNeg!=av.isNeg;return az;}function n(ap,av){var au,at,ar,ao=new a();au=ag(ap);at=0;for(var aq=0;aq<=au;++aq){ar=ao.digits[aq]+ap.digits[aq]*av+at;ao.digits[aq]=ar&ae;at=ar>>>R;}ao.digits[1+au]=at;return ao;}function D(at,aw,aq,av,au){var ao=Math.min(aw+au,at.length);for(var ar=aw,ap=av;ar<ao;++ar,++ap){aq[ap]=at[ar];}}var u=new Array(0,32768,49152,57344,61440,63488,64512,65024,65280,65408,65472,65504,65520,65528,65532,65534,65535);function B(ap,aw){var ar=Math.floor(aw/t);var ao=new a();D(ap.digits,0,ao.digits,ar,ao.digits.length-ar);var av=aw%t;var aq=t-av;for(var at=ao.digits.length-1,au=at-1;at>0;--at,--au){ao.digits[at]=((ao.digits[at]<<av)&ae)|((ao.digits[au]&u[av])>>>(aq));}ao.digits[0]=((ao.digits[at]<<av)&ae);ao.isNeg=ap.isNeg;return ao;}var O=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535);function o(ap,aw){var aq=Math.floor(aw/t);var ao=new a();D(ap.digits,aq,ao.digits,0,ap.digits.length-aq);var au=aw%t;var av=t-au;for(var ar=0,at=ar+1;ar<ao.digits.length-1;++ar,++at){ao.digits[ar]=(ao.digits[ar]>>>au)|((ao.digits[at]&O[au])<<av);}ao.digits[ao.digits.length-1]>>>=au;ao.isNeg=ap.isNeg;return ao;}function G(ap,aq){var ao=new a();D(ap.digits,0,ao.digits,aq,ao.digits.length-aq);return ao;}function m(ap,aq){var ao=new a();D(ap.digits,aq,ao.digits,0,ao.digits.length-aq);return ao;}function Y(ap,aq){var ao=new a();D(ap.digits,0,ao.digits,0,aq);return ao;}function j(ao,aq){if(ao.isNeg!=aq.isNeg){return 1-2*Number(ao.isNeg);}for(var ap=ao.digits.length-1;ap>=0;--ap){if(ao.digits[ap]!=aq.digits[ap]){if(ao.isNeg){return 1-2*Number(ao.digits[ap]>aq.digits[ap]);}else{return 1-2*Number(ao.digits[ap]<aq.digits[ap]);}}}return 0;}function E(au,at){var ao=T(au);var ar=T(at);var aq=at.isNeg;var az,ay;if(ao<ar){if(au.isNeg){az=aa(c);az.isNeg=!at.isNeg;au.isNeg=false;at.isNeg=false;ay=ad(at,au);au.isNeg=true;at.isNeg=aq;}else{az=new a();ay=aa(au);}return new Array(az,ay);}az=new a();ay=au;var aw=Math.ceil(ar/t)-1;var av=0;while(at.digits[aw]<i){at=B(at,1);++av;++ar;aw=Math.ceil(ar/t)-1;}ay=B(ay,av);ao+=av;var aC=Math.ceil(ao/t)-1;var aH=G(at,aC-aw);while(j(ay,aH)!=-1){++az.digits[aC-aw];ay=ad(ay,aH);}for(var aF=aC;aF>aw;--aF){var ax=(aF>=ay.digits.length)?0:ay.digits[aF];var aG=(aF-1>=ay.digits.length)?0:ay.digits[aF-1];var aE=(aF-2>=ay.digits.length)?0:ay.digits[aF-2];var aD=(aw>=at.digits.length)?0:at.digits[aw];var ap=(aw-1>=at.digits.length)?0:at.digits[aw-1];if(ax==aD){az.digits[aF-aw-1]=ae;}else{az.digits[aF-aw-1]=Math.floor((ax*ab+aG)/aD);}var aB=az.digits[aF-aw-1]*((aD*ab)+ap);var aA=(ax*X)+((aG*ab)+aE);while(aB>aA){--az.digits[aF-aw-1];aB=az.digits[aF-aw-1]*((aD*ab)|ap);aA=(ax*ab*ab)+((aG*ab)+aE);}aH=G(at,aF-aw-1);ay=ad(ay,n(aH,az.digits[aF-aw-1]));if(ay.isNeg){ay=l(ay,aH);--az.digits[aF-aw-1];}}ay=o(ay,av);az.isNeg=au.isNeg!=aq;if(au.isNeg){if(aq){az=l(az,c);}else{az=ad(az,c);}at=o(at,av);ay=ad(at,ay);}if(ay.digits[0]==0&&ag(ay)==0){ay.isNeg=false;}return new Array(az,ay);}function ai(ao,ap){return E(ao,ap)[0];}function I(ao,ap){return E(ao,ap)[1];}function A(ap,aq,ao){return I(an(ap,aq),ao);}function Q(ap,ar){var ao=c;var aq=ap;while(true){if((ar&1)!=0){ao=an(ao,aq);}ar>>=1;if(ar==0){break;}aq=an(aq,aq);}return ao;}function P(aq,au,ap){var ao=c;var ar=aq;var at=au;while(true){if((at.digits[0]&1)!=0){ao=A(ao,ar,ap);}at=o(at,1);if(at.digits[0]==0&&ag(at)==0){break;}ar=A(ar,ar,ap);}return ao;}return{construct:a,setMaxDigits:C,fromDecimal:z,copy:aa,fromNumber:w,toString:Z,toDecimal:al,toHex:K,fromHex:ah,fromString:M,dump:N,add:l,subtract:ad,highIndex:ag,numBits:T,multiply:an,shiftLeft:B,shiftRight:o,compare:j,pow:Q,powMod:P,divide:ai,divideByRadixPower:m,moduloByRadixPower:Y};})();(function(c){function a(l,j){var i=(l<<j)|(l>>>(32-j));return i;}function d(n){var m="";var l;var j;for(l=7;l>=0;l--){j=(n>>>(l*4))&15;m+=j.toString(16);}return m;}c.SHA1=function(K){var q,N,M,m=new Array(80),w=1732584193,t=4023233417,s=2562383102,o=271733878,n=3285377520,J,I,G,F,z,O;K=apf.crypto.UTF8.encode(K);var l=K.length,u=[];for(N=0;N<l-3;N+=4){M=K.charCodeAt(N)<<24|K.charCodeAt(N+1)<<16|K.charCodeAt(N+2)<<8|K.charCodeAt(N+3);u.push(M);}switch(l%4){case 0:N=2147483648;break;case 1:N=K.charCodeAt(l-1)<<24|8388608;break;case 2:N=K.charCodeAt(l-2)<<24|K.charCodeAt(l-1)<<16|32768;break;case 3:N=K.charCodeAt(l-3)<<24|K.charCodeAt(l-2)<<16|K.charCodeAt(l-1)<<8|128;break;}u.push(N);while((u.length%16)!=14){u.push(0);}u.push(l>>>29);u.push((l<<3)&4294967295);for(q=0;q<u.length;q+=16){for(N=0;N<16;N++){m[N]=u[q+N];}for(N=16;N<=79;N++){m[N]=a(m[N-3]^m[N-8]^m[N-14]^m[N-16],1);}J=w;I=t;G=s;F=o;z=n;for(N=0;N<=19;N++){O=(a(J,5)+((I&G)|(~I&F))+z+m[N]+1518500249)&4294967295;z=F;F=G;G=a(I,30);I=J;J=O;}for(N=20;N<=39;N++){O=(a(J,5)+(I^G^F)+z+m[N]+1859775393)&4294967295;z=F;F=G;G=a(I,30);I=J;J=O;}for(N=40;N<=59;N++){O=(a(J,5)+((I&G)|(I&F)|(G&F))+z+m[N]+2400959708)&4294967295;z=F;F=G;G=a(I,30);I=J;J=O;}for(N=60;N<=79;N++){O=(a(J,5)+(I^G^F)+z+m[N]+3395469782)&4294967295;z=F;F=G;G=a(I,30);I=J;J=O;}w=(w+J)&4294967295;t=(t+I)&4294967295;s=(s+G)&4294967295;o=(o+F)&4294967295;n=(n+z)&4294967295;}O=d(w)+d(t)+d(s)+d(o)+d(n);return O.toLowerCase();};})(apf.crypto);apf.crypto.Base64=(function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function c(s){var m,l,j,z,w,u,t,A,q=0,B=0,o="",n=[];if(!s){return s;}s=apf.crypto.UTF8.encode(s+"");do{m=s.charCodeAt(q++);l=s.charCodeAt(q++);j=s.charCodeAt(q++);A=m<<16|l<<8|j;z=A>>18&63;w=A>>12&63;u=A>>6&63;t=A&63;n[B++]=a.charAt(z)+a.charAt(w)+a.charAt(u)+a.charAt(t);}while(q<s.length);o=n.join("");switch(s.length%3){case 1:o=o.slice(0,-2)+"==";break;case 2:o=o.slice(0,-1)+"=";break;}return o;}function d(q){var m,l,j,w,u,t,s,z,o=0,A=0,n=[];if(!q){return q;}q+="";do{w=a.indexOf(q.charAt(o++));u=a.indexOf(q.charAt(o++));t=a.indexOf(q.charAt(o++));s=a.indexOf(q.charAt(o++));z=w<<18|u<<12|t<<6|s;m=z>>16&255;l=z>>8&255;j=z&255;if(t==64){n[A++]=String.fromCharCode(m);}else{if(s==64){n[A++]=String.fromCharCode(m,l);}else{n[A++]=String.fromCharCode(m,l,j);}}}while(o<q.length);return apf.crypto.UTF8.decode(n.join(""));}return{decode:d,encode:c};})();apf.crypto.UTF8={encode:function(j){j=(j+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n");var i=[],q=0,c=0,m,d;for(var o=0,a=j.length;o<a;o++){m=j.charCodeAt(o);d=null;if(m<128){c++;}else{if((m>127)&&(m<2048)){d=String.fromCharCode((m>>6)|192)+String.fromCharCode((m&63)|128);}else{d=String.fromCharCode((m>>12)|224)+String.fromCharCode(((m>>6)&63)|128)+String.fromCharCode((m&63)|128);}}if(d!==null){if(c>q){i.push(j.substring(q,c));}i.push(d);q=c=o+1;}}if(c>q){i.push(j.substring(q,j.length));}return i.join("");},decode:function(a){var d=[],l=0,n=0,m=0,j=0,c=0;a+="";while(l<a.length){m=a.charCodeAt(l);if(m<128){d[n++]=String.fromCharCode(m);l++;}else{if((m>191)&&(m<224)){j=a.charCodeAt(l+1);d[n++]=String.fromCharCode(((m&31)<<6)|(j&63));l+=2;}else{j=a.charCodeAt(l+1);c=a.charCodeAt(l+2);d[n++]=String.fromCharCode(((m&15)<<12)|((j&63)<<6)|(c&63));l+=3;}}}return d.join("");}};apf.crypto.RSA=(function(){function d(l,m,j){this.e=apf.crypto.BigInt.fromHex(l);this.d=apf.crypto.BigInt.fromHex(m);this.m=apf.crypto.BigInt.fromHex(j);this.digitSize=2*apf.crypto.BigInt.highIndex(this.m)+2;this.chunkSize=this.digitSize-11;this.radix=16;this.barrett=new apf.crypto.Barrett(this.m);}function a(j){return(j<10?"0":"")+String(j);}function i(C,F){if(C.chunkSize>C.digitSize-11){return"Error";}var B=new Array();var l=F.length;var q=0;while(q<l){B[q]=F.charCodeAt(q);q++;}var t=B.length;var G="";var o,n,m;for(q=0;q<t;q+=C.chunkSize){m=new apf.crypto.BigInt.construct();o=0;var A;var z=(q+C.chunkSize)>t?t%C.chunkSize:C.chunkSize;var u=new Array();for(A=0;A<z;A++){u[A]=B[q+z-1-A];}u[z]=0;var w=Math.max(8,C.digitSize-3-z);for(A=0;A<w;A++){u[z+1+A]=Math.floor(Math.random()*254)+1;}u[C.digitSize-2]=2;u[C.digitSize-1]=0;for(n=0;n<C.digitSize;++o){m.digits[o]=u[n++];m.digits[o]+=u[n++]<<8;}var E=C.barrett.powMod(m,C.e);var D=C.radix==16?apf.crypto.BigInt.toHex(E):apf.crypto.BigInt.toString(E,C.radix);G+=D+" ";}return G.substring(0,G.length-1);}function c(q,t){var w=t.split(" ");var l="";var o,n,u;for(o=0;o<w.length;++o){var m;if(q.radix==16){m=apf.crypto.BigInt.fromHex(w[o]);}else{m=apf.crypto.BigInt.fromString(w[o],q.radix);}u=q.barrett.powMod(m,q.d);for(n=0;n<=apf.crypto.BigInt.highIndex(u);++n){l+=String.fromCharCode(u.digits[n]&255,u.digits[n]>>8);}}if(l.charCodeAt(l.length-1)==0){l=l.substring(0,l.length-1);}return l;}return{F4:"10001",E3:"3",getKeyPair:d,twoDigit:a,encrypt:i,decrypt:c};})();apf.crypto.MD5={hexcase:0,b64pad:"",chrsz:8,hex_md5:function(a){return this.binl2hex(this.core_md5(this.str2binl(a),a.length*this.chrsz));},b64_md5:function(a){return this.binl2b64(this.core_md5(this.str2binl(a),a.length*this.chrsz));},str_md5:function(a){return this.binl2str(this.core_md5(this.str2binl(a),a.length*this.chrsz));},hex_hmac_md5:function(a,c){return this.binl2hex(this.core_hmac_md5(a,c));},b64_hmac_md5:function(a,c){return this.binl2b64(this.core_hmac_md5(a,c));},str_hmac_md5:function(a,c){return this.binl2str(this.core_hmac_md5(a,c));},core_md5:function(z,q){z[q>>5]|=128<<((q)%32);z[(((q+64)>>>9)<<4)+14]=q;var w=1732584193,u=-271733879,t=-1732584194,s=271733878;for(var m=0;m<z.length;m+=16){var o=w,n=u,l=t,j=s;w=this.md5_ff(w,u,t,s,z[m+0],7,-680876936);s=this.md5_ff(s,w,u,t,z[m+1],12,-389564586);t=this.md5_ff(t,s,w,u,z[m+2],17,606105819);u=this.md5_ff(u,t,s,w,z[m+3],22,-1044525330);w=this.md5_ff(w,u,t,s,z[m+4],7,-176418897);s=this.md5_ff(s,w,u,t,z[m+5],12,1200080426);t=this.md5_ff(t,s,w,u,z[m+6],17,-1473231341);u=this.md5_ff(u,t,s,w,z[m+7],22,-45705983);w=this.md5_ff(w,u,t,s,z[m+8],7,1770035416);s=this.md5_ff(s,w,u,t,z[m+9],12,-1958414417);t=this.md5_ff(t,s,w,u,z[m+10],17,-42063);u=this.md5_ff(u,t,s,w,z[m+11],22,-1990404162);w=this.md5_ff(w,u,t,s,z[m+12],7,1804603682);s=this.md5_ff(s,w,u,t,z[m+13],12,-40341101);t=this.md5_ff(t,s,w,u,z[m+14],17,-1502002290);u=this.md5_ff(u,t,s,w,z[m+15],22,1236535329);w=this.md5_gg(w,u,t,s,z[m+1],5,-165796510);s=this.md5_gg(s,w,u,t,z[m+6],9,-1069501632);t=this.md5_gg(t,s,w,u,z[m+11],14,643717713);u=this.md5_gg(u,t,s,w,z[m+0],20,-373897302);w=this.md5_gg(w,u,t,s,z[m+5],5,-701558691);s=this.md5_gg(s,w,u,t,z[m+10],9,38016083);t=this.md5_gg(t,s,w,u,z[m+15],14,-660478335);u=this.md5_gg(u,t,s,w,z[m+4],20,-405537848);w=this.md5_gg(w,u,t,s,z[m+9],5,568446438);s=this.md5_gg(s,w,u,t,z[m+14],9,-1019803690);t=this.md5_gg(t,s,w,u,z[m+3],14,-187363961);u=this.md5_gg(u,t,s,w,z[m+8],20,1163531501);w=this.md5_gg(w,u,t,s,z[m+13],5,-1444681467);s=this.md5_gg(s,w,u,t,z[m+2],9,-51403784);t=this.md5_gg(t,s,w,u,z[m+7],14,1735328473);u=this.md5_gg(u,t,s,w,z[m+12],20,-1926607734);w=this.md5_hh(w,u,t,s,z[m+5],4,-378558);s=this.md5_hh(s,w,u,t,z[m+8],11,-2022574463);t=this.md5_hh(t,s,w,u,z[m+11],16,1839030562);u=this.md5_hh(u,t,s,w,z[m+14],23,-35309556);w=this.md5_hh(w,u,t,s,z[m+1],4,-1530992060);s=this.md5_hh(s,w,u,t,z[m+4],11,1272893353);t=this.md5_hh(t,s,w,u,z[m+7],16,-155497632);u=this.md5_hh(u,t,s,w,z[m+10],23,-1094730640);w=this.md5_hh(w,u,t,s,z[m+13],4,681279174);s=this.md5_hh(s,w,u,t,z[m+0],11,-358537222);t=this.md5_hh(t,s,w,u,z[m+3],16,-722521979);u=this.md5_hh(u,t,s,w,z[m+6],23,76029189);w=this.md5_hh(w,u,t,s,z[m+9],4,-640364487);s=this.md5_hh(s,w,u,t,z[m+12],11,-421815835);t=this.md5_hh(t,s,w,u,z[m+15],16,530742520);u=this.md5_hh(u,t,s,w,z[m+2],23,-995338651);w=this.md5_ii(w,u,t,s,z[m+0],6,-198630844);s=this.md5_ii(s,w,u,t,z[m+7],10,1126891415);t=this.md5_ii(t,s,w,u,z[m+14],15,-1416354905);u=this.md5_ii(u,t,s,w,z[m+5],21,-57434055);w=this.md5_ii(w,u,t,s,z[m+12],6,1700485571);s=this.md5_ii(s,w,u,t,z[m+3],10,-1894986606);t=this.md5_ii(t,s,w,u,z[m+10],15,-1051523);u=this.md5_ii(u,t,s,w,z[m+1],21,-2054922799);w=this.md5_ii(w,u,t,s,z[m+8],6,1873313359);s=this.md5_ii(s,w,u,t,z[m+15],10,-30611744);t=this.md5_ii(t,s,w,u,z[m+6],15,-1560198380);u=this.md5_ii(u,t,s,w,z[m+13],21,1309151649);w=this.md5_ii(w,u,t,s,z[m+4],6,-145523070);s=this.md5_ii(s,w,u,t,z[m+11],10,-1120210379);t=this.md5_ii(t,s,w,u,z[m+2],15,718787259);u=this.md5_ii(u,t,s,w,z[m+9],21,-343485551);w=this.safe_add(w,o);u=this.safe_add(u,n);t=this.safe_add(t,l);s=this.safe_add(s,j);}return[w,u,t,s];},md5_cmn:function(m,i,d,c,l,j){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(i,m),this.safe_add(c,j)),l),d);},md5_ff:function(l,j,q,o,i,n,m){return this.md5_cmn((j&q)|((~j)&o),l,j,i,n,m);},md5_gg:function(l,j,q,o,i,n,m){return this.md5_cmn((j&o)|(q&(~o)),l,j,i,n,m);},md5_hh:function(l,j,q,o,i,n,m){return this.md5_cmn(j^q^o,l,j,i,n,m);},md5_ii:function(l,j,q,o,i,n,m){return this.md5_cmn(q^(j|(~o)),l,j,i,n,m);},core_hmac_md5:function(d,m){var l=this.str2binl(d),a=Array(16),j=Array(16);if(l.length>16){l=this.core_md5(l,d.length*this.chrsz);}for(var c=0;c<16;c++){a[c]=l[c]^909522486;j[c]=l[c]^1549556828;}return this.core_md5(j.concat(this.core_md5(a.concat(this.str2binl(m)),512+m.length*this.chrsz)),512+128);},safe_add:function(a,i){var d=(a&65535)+(i&65535),c=(a>>16)+(i>>16)+(d>>16);return(c<<16)|(d&65535);},bit_rol:function(a,c){return(a<<c)|(a>>>(32-c));},str2binl:function(j){var d=[],c,a=(1<<this.chrsz)-1;for(c=0;c<j.length*this.chrsz;c+=this.chrsz){d[c>>5]|=(j.charCodeAt(c/this.chrsz)&a)<<(c%32);}return d;},binl2str:function(d){var j=[],c,a=(1<<this.chrsz)-1;for(c=0;c<d.length*32;c+=this.chrsz){j.push(String.fromCharCode((d[c>>5]>>>(c%32))&a));}return j.join("");},binl2hex:function(d){var c=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",j=[],a;for(a=0;a<d.length*4;a++){j.push(c.charAt((d[a>>2]>>((a%4)*8+4))&15)+c.charAt((d[a>>2]>>((a%4)*8))&15));}return j.join("");},binl2b64:function(l){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=[],c;for(c=0;c<l.length*4;c+=3){var m=(((l[c>>2]>>8*(c%4))&255)<<16)|(((l[c+1>>2]>>8*((c+1)%4))&255)<<8)|((l[c+2>>2]>>8*((c+2)%4))&255);for(var a=0;a<4;a++){if(c*8+a*6>l.length*32){n.push(this.b64pad);}else{n.push(d.charAt((m>>6*(3-a))&63));}}}return n.join("");}};apf.crypto.MD4={hexcase:0,b64pad:"",chrsz:8,hex_md4:function(a){return this.binl2hex(this.core_md4(this.str2binl(a),a.length*this.chrsz));},b64_md4:function(a){return this.binl2b64(this.core_md4(this.str2binl(a),a.length*this.chrsz));},str_md4:function(a){return this.binl2str(this.core_md4(this.str2binl(a),a.length*this.chrsz));},hex_hmac_md4:function(a,c){return this.binl2hex(this.core_hmac_md4(a,c));},b64_hmac_md4:function(a,c){return this.binl2b64(this.core_hmac_md4(a,c));},str_hmac_md4:function(a,c){return this.binl2str(this.core_hmac_md4(a,c));},md4_vm_test:function(){return this.hex_md4("abc")=="a448017aaf21d8525fc10ae87aa6729d";},core_md4:function(z,q){z[q>>5]|=128<<(q%32);z[(((q+64)>>>9)<<4)+14]=q;var w=1732584193;var u=-271733879;var t=-1732584194;var s=271733878;for(var m=0;m<z.length;m+=16){var o=w;var n=u;var l=t;var j=s;w=this.md4_ff(w,u,t,s,z[m+0],3);s=this.md4_ff(s,w,u,t,z[m+1],7);t=this.md4_ff(t,s,w,u,z[m+2],11);u=this.md4_ff(u,t,s,w,z[m+3],19);w=this.md4_ff(w,u,t,s,z[m+4],3);s=this.md4_ff(s,w,u,t,z[m+5],7);t=this.md4_ff(t,s,w,u,z[m+6],11);u=this.md4_ff(u,t,s,w,z[m+7],19);w=this.md4_ff(w,u,t,s,z[m+8],3);s=this.md4_ff(s,w,u,t,z[m+9],7);t=this.md4_ff(t,s,w,u,z[m+10],11);u=this.md4_ff(u,t,s,w,z[m+11],19);w=this.md4_ff(w,u,t,s,z[m+12],3);s=this.md4_ff(s,w,u,t,z[m+13],7);t=this.md4_ff(t,s,w,u,z[m+14],11);u=this.md4_ff(u,t,s,w,z[m+15],19);w=this.md4_gg(w,u,t,s,z[m+0],3);s=this.md4_gg(s,w,u,t,z[m+4],5);t=this.md4_gg(t,s,w,u,z[m+8],9);u=this.md4_gg(u,t,s,w,z[m+12],13);w=this.md4_gg(w,u,t,s,z[m+1],3);s=this.md4_gg(s,w,u,t,z[m+5],5);t=this.md4_gg(t,s,w,u,z[m+9],9);u=this.md4_gg(u,t,s,w,z[m+13],13);w=this.md4_gg(w,u,t,s,z[m+2],3);s=this.md4_gg(s,w,u,t,z[m+6],5);t=this.md4_gg(t,s,w,u,z[m+10],9);u=this.md4_gg(u,t,s,w,z[m+14],13);w=this.md4_gg(w,u,t,s,z[m+3],3);s=this.md4_gg(s,w,u,t,z[m+7],5);t=this.md4_gg(t,s,w,u,z[m+11],9);u=this.md4_gg(u,t,s,w,z[m+15],13);w=this.md4_hh(w,u,t,s,z[m+0],3);s=this.md4_hh(s,w,u,t,z[m+8],9);t=this.md4_hh(t,s,w,u,z[m+4],11);u=this.md4_hh(u,t,s,w,z[m+12],15);w=this.md4_hh(w,u,t,s,z[m+2],3);s=this.md4_hh(s,w,u,t,z[m+10],9);t=this.md4_hh(t,s,w,u,z[m+6],11);u=this.md4_hh(u,t,s,w,z[m+14],15);w=this.md4_hh(w,u,t,s,z[m+1],3);s=this.md4_hh(s,w,u,t,z[m+9],9);t=this.md4_hh(t,s,w,u,z[m+5],11);u=this.md4_hh(u,t,s,w,z[m+13],15);w=this.md4_hh(w,u,t,s,z[m+3],3);s=this.md4_hh(s,w,u,t,z[m+11],9);t=this.md4_hh(t,s,w,u,z[m+7],11);u=this.md4_hh(u,t,s,w,z[m+15],15);w=this.safe_add(w,o);u=this.safe_add(u,n);t=this.safe_add(t,l);s=this.safe_add(s,j);}return Array(w,u,t,s);},md4_cmn:function(m,i,d,c,l,j){return this.safe_add(rol(this.safe_add(this.safe_add(i,m),this.safe_add(c,j)),l),d);},md4_ff:function(l,j,o,n,i,m){return this.md4_cmn((j&o)|((~j)&n),l,0,i,m,0);},md4_gg:function(l,j,o,n,i,m){return this.md4_cmn((j&o)|(j&n)|(o&n),l,0,i,m,1518500249);},md4_hh:function(l,j,o,n,i,m){return this.md4_cmn(j^o^n,l,0,i,m,1859775393);},core_hmac_md4:function(d,m){var l=this.str2binl(d);if(l.length>16){l=this.core_md4(l,d.length*this.chrsz);}var a=Array(16),j=Array(16);for(var c=0;c<16;c++){a[c]=l[c]^909522486;j[c]=l[c]^1549556828;}var n=this.core_md4(a.concat(this.str2binl(m)),512+m.length*this.chrsz);return this.core_md4(j.concat(n),512+128);},safe_add:function(a,i){var d=(a&65535)+(i&65535);var c=(a>>16)+(i>>16)+(d>>16);return(c<<16)|(d&65535);},rol:function(a,c){return(a<<c)|(a>>>(32-c));},str2binl:function(j){var d=Array();var a=(1<<this.chrsz)-1;for(var c=0;c<j.length*this.chrsz;c+=this.chrsz){d[c>>5]|=(j.charCodeAt(c/this.chrsz)&a)<<(c%32);}return d;},binl2str:function(d){var j="";var a=(1<<this.chrsz)-1;for(var c=0;c<d.length*32;c+=this.chrsz){j+=String.fromCharCode((d[c>>5]>>>(c%32))&a);}return j;},binl2hex:function(d){var c=this.hexcase?"0123456789ABCDEF":"0123456789abcdef";var j="";for(var a=0;a<d.length*4;a++){j+=c.charAt((d[a>>2]>>((a%4)*8+4))&15)+c.charAt((d[a>>2]>>((a%4)*8))&15);}return j;},binl2b64:function(l){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var n="";for(var c=0;c<l.length*4;c+=3){var m=(((l[c>>2]>>8*(c%4))&255)<<16)|(((l[c+1>>2]>>8*((c+1)%4))&255)<<8)|((l[c+2>>2]>>8*((c+2)%4))&255);for(var a=0;a<4;a++){if(c*8+a*6>l.length*32){n+=this.b64pad;}else{n+=d.charAt((m>>6*(3-a))&63);}}}return n;}};(function(c){if(typeof apf.crypto=="undefined"){apf.crypto={};}function j(l){var o=[];var m,n;for(m=0;m<l.length;m++){n=l.charCodeAt(m);o[m>>2]|=n<<(3-m%4)*8;}return o;}function i(n){var l=new String();for(var m=0;m<n.length;m++){l+=String.fromCharCode(n[m]>>>24,(n[m]>>>16)&255,(n[m]>>>8)&255,n[m]&255);}return l;}function d(m){var l,n=0;var o=[];while(n<m.length*6){l=m.charCodeAt(n/6);if(l>47&&l<58){l-=48;}if(l>62&&l<91){l-=53;}if(l>96&&l<123){l-=59;}switch(n&31){case 0:o[n>>5]=l;n+=6;break;case 28:o[n>>5]=(o[n>>5]<<4)|(l>>2);n+=4;o[n>>5]=l&3;n+=2;break;case 30:o[n>>5]=(o[n>>5]<<2)|(l>>4);n+=2;o[n>>5]=l&15;n+=4;break;default:o[n>>5]=(o[n>>5]<<6)|l;n+=6;}}return o;}function a(s){var n,l,o=0,m="",q="0123456789?@ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";while(o<s.length){for(l=0;l<2;l++){n=s[o]>>>26;m+=q.charAt(n);n=(s[o]>>>20)&63;m+=q.charAt(n);n=(s[o]>>>14)&63;m+=q.charAt(n);n=(s[o]>>>8)&63;m+=q.charAt(n);n=(s[o]>>>2)&63;m+=q.charAt(n);n=(s[o++]&3)<<4;n=n|(s[o]>>>28);m+=q.charAt(n);n=(s[o]>>>22)&63;m+=q.charAt(n);n=(s[o]>>>16)&63;m+=q.charAt(n);n=(s[o]>>>10)&63;m+=q.charAt(n);n=(s[o]>>>4)&63;m+=q.charAt(n);n=(s[o++]&15)<<2;n=n|(s[o]>>>30);m+=q.charAt(n);n=(s[o]>>>24)&63;m+=q.charAt(n);n=(s[o]>>>18)&63;m+=q.charAt(n);n=(s[o]>>>12)&63;m+=q.charAt(n);n=(s[o]>>>6)&63;m+=q.charAt(n);n=s[o++]&63;m+=q.charAt(n);}}return m;}apf.crypto.Blowfish=function(){this.init.apply(this,arguments);};apf.crypto.Blowfish.prototype={init:function(l){this.P;this.S;this.previous_xHi=0;this.previous_xLo=0;},encode:function(s,o){var q=new String(""),n=new Array(),l;for(l=0;l<4;l++){if(typeof(this.customRand)=="function"){n[l]=this.customRand();}else{n[l]=Math.floor(Math.random()*4294967295);}}var m=this.passtokey(o,n[2],n[3],n[4]);n[4]=m[14];n[5]=m[15];this.initialise(m,n);var t=j(s);this.encipher_array(t);return{code:a(t),init:a(n)};},decode:function(q,o,s){var n=d(s);var m=this.passtokey(o,n[2],n[3]);if((n[4]==m[14])&&(n[5]==m[15])){this.initialise(m,n);var l=d(q);this.decipher(l);return i(l);}return null;},setConstants:function(){var o=[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946];var n=[1266315497,3048417604,3681880366,3289982499,2909710000,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055];var m=[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504];var l=[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409000,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462];this.S=[o,n,m,l];this.P=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731];},encipher:function(m){var o=m[0];var l=m[1];var n=0;o^=this.P[0];while(n<16){l^=(((this.S[0][o>>>24]+this.S[1][(o>>>16)&255])^this.S[2][(o>>>8)&255])+this.S[3][o&255])^this.P[++n];o^=(((this.S[0][l>>>24]+this.S[1][(l>>>16)&255])^this.S[2][(l>>>8)&255])+this.S[3][l&255])^this.P[++n];}l^=this.P[16+1];m[0]=l;m[1]=o;},encipher_array:function(m){var o,q,t,l,s,n;for(o=0;(o<m.length)||(m.length%6);o+=2){t=m[o];l=m[o+1];t^=this.previous_xHi;l^=this.previous_xLo;t^=this.P[0];s=0;while(s<16){l^=(((this.S[0][t>>>24]+this.S[1][(t>>>16)&255])^this.S[2][(t>>>8)&255])+this.S[3][t&255])^this.P[++s];t^=(((this.S[0][l>>>24]+this.S[1][(l>>>16)&255])^this.S[2][(l>>>8)&255])+this.S[3][l&255])^this.P[++s];}l^=this.P[17];this.previous_xHi=l;this.previous_xLo=t;m[o+1]=t;m[o]=l;}},decipher:function(m){var o,s,l,q,n;for(o=0;o<m.length;o+=2){s=m[o];l=m[o+1];s^=this.P[17];q=16;while(q>0){l^=(((this.S[0][s>>>24]+this.S[1][(s>>>16)&255])^this.S[2][(s>>>8)&255])+this.S[3][s&255])^this.P[q--];s^=(((this.S[0][l>>>24]+this.S[1][(l>>>16)&255])^this.S[2][(l>>>8)&255])+this.S[3][l&255])^this.P[q--];}l^=this.P[0];n=m[o];m[o]=l^this.previous_xHi;this.previous_xHi=n;n=m[o+1];m[o+1]=s^this.previous_xLo;this.previous_xLo=n;}},initialise:function(q,o){var n,m,l,s;var t=new Array(2);this.previous_xHi=o[0];this.previous_xLo=o[1];this.setConstants();for(m=0,n=0;n<16+2;++n){this.P[n]=this.P[n]^q[m];m=(m+1)%14;}for(n=0;n<16+2;n+=2){this.encipher(t);this.P[n]=t[0];this.P[n+1]=t[1];}for(n=0;n<4;++n){for(m=0;m<256;m+=2){this.encipher(t);this.S[n][m]=t[0];this.S[n][m+1]=t[1];}}},passtokey:function(s,q,m){var u=j(s);var t=new Array(2);var o=new Array(16);var n=0,l;t[0]=q;t[1]=m;do{this.initialise(o,t,16);for(l=0;l<16;){t[0]^=u[n];this.encipher(t);o[l++]^=t[0];o[l++]^=t[1];}}while(++n<u.length);return o;}};})(this);apf.crypto.Barrett=function(){this.init.apply(this,arguments);};apf.crypto.Barrett.prototype={init:function(a){this.modulus=apf.crypto.BigInt.copy(a);this.k=apf.crypto.BigInt.highIndex(this.modulus)+1;var c=new apf.crypto.BigInt.construct();c.digits[2*this.k]=1;this.mu=apf.crypto.BigInt.divide(c,this.modulus);this.bkplus1=new apf.crypto.BigInt.construct();this.bkplus1.digits[this.k+1]=1;},modulo:function(n){var m=apf.crypto.BigInt.divideByRadixPower(n,this.k-1);var j=apf.crypto.BigInt.multiply(m,this.mu);var i=apf.crypto.BigInt.divideByRadixPower(j,this.k+1);var d=apf.crypto.BigInt.moduloByRadixPower(n,this.k+1);var o=apf.crypto.BigInt.multiply(i,this.modulus);var c=apf.crypto.BigInt.moduloByRadixPower(o,this.k+1);var a=apf.crypto.BigInt.subtract(d,c);if(a.isNeg){a=apf.crypto.BigInt.add(a,this.bkplus1);}var l=apf.crypto.BigInt.compare(a,this.modulus)>=0;while(l){a=apf.crypto.BigInt.subtract(a,this.modulus);l=apf.crypto.BigInt.compare(a,this.modulus)>=0;}return a;},multiplyMod:function(a,d){var c=apf.crypto.BigInt.multiply(a,d);return this.modulo(c);},powMod:function(d,l){var c=new apf.crypto.BigInt.construct();c.digits[0]=1;var i=d;var j=l;while(true){if((j.digits[0]&1)!=0){c=this.multiplyMod(c,i);}j=apf.crypto.BigInt.shiftRight(j,1);if(j.digits[0]==0&&apf.crypto.BigInt.highIndex(j)==0){break;}i=this.multiplyMod(i,i);}return c;}};apf.JSImplementation=function(){var a=["[","{","(","text","xpath","word","sep","ws","semi","sh","op","col","str","regex","comment"];var d=["]","}",")"];var c=new RegExp();c.compile("([\\w_\\.]+)|([\\s]*,[\\s]*)|([\\s]*;[\\s]*)|(\\/\\*)|(\\*\\/)|(\\/\\/)|([\\r\\n])|((?:[\\s]*)[\\$\\@\\#\\%\\^\\&\\*\\?\\!](?:[\\s]*))|([\\s]*[\\+\\-\\<\\>\\|\\=]+[\\s]*)|(\\s*\\:\\s*)|(\\s+)|(\\\\[\\\\\\{\\}\\[\\]\\\"\\'\\/])|(\\[)|(\\])|([\\s]*\\([\\s]*)|([\\s]*\\)[\\s]*)|([\\s]*\\{[\\s]*)|([\\s]*\\}[\\s]*)|(\\')|(\\\")|(\\/)","g");this.dump_tree=function(z,u,l){for(var q=0;q<z.length;q++){var j=z[q],o=j[0];if(o<3){u.push(l+a[o]);this.dump_tree(j[1],u,"  "+l);u.push(d[o]);u.push("\n");}else{u.push(l+a[o]+": "+j[1]+"\n");}}return u;};this.parse=function(B,n){var s=[];var D=[];var C=[];var o=D;var m=0,w=0;var q=0,l=0;var A=0;var z=[0,0,0];B.replace(c,function(Z,ab,U,ac,Y,W,V,F,ad,Q,J,E,M,af,I,aa,j,O,T,R,P,X,K){function N(ah){var ag=n?B.substr(w,K-w).replace(/[\r\n]\s*/,"").replace(/^\s*[\r\n]/,"").replace(/[\r\n\t]/g,""):B.substr(w,K-w).replace(/[\r\n\t]/g,"");if(ag.length>0){o[o.length]=[ah,ag,w,K];}}function ae(ag,ah){o[o.length]=[ag,ah,K];}function G(ag){z[ag]++;var ah=[];o[o.length]=[ag,ah,K];C[C.length]=o;o=ah;}function i(ag){z[ag]--;if(C.length==0){s[s.length]=["extra "+d[ag],K];}else{o=C.pop();var ah=o[o.length-1][0];if(ah!=ag){s[s.length]=["scope mismatch "+a[ah]+" with "+a[ag],K];}}}if(!q){if(ab){ae(5,Z);if(Z=="macro"){A=1;}else{if(A){macros[Z]=1,A=0;}}}if(U){ae(6,",");}if(E){ae(7,Z);}if(ac){ae(8,Z);}if(ad){ae(9,Z);}if(Q){ae(10,Z);}if(J){ae(11,Z);}if(af){G(0);}if(I){i(0);}if(O){G(1);}if(T){i(1);}if(aa){G(2);}if(j){i(2);}}if(V){if(q==0){q=5;w=K+2;}}if(F){if(q==5){q=0;K+=1;N(14);}}if(R){if(q==0){q=1;w=K;}else{if(q==1){q=0;K+=1;N(12);}}}if(P){if(q==0){q=2;w=K;}else{if(q==2){q=0;K+=1;N(12);}}}if(Y){if(q==0){q=4;w=K+2;}}if(W){if(q==4){q=0;N(14);}}if(X){if(q==0){if(o.length==0||o[o.length-1][0]==6){q=3;w=K;}else{ae(10,Z);}}else{if(q==3){q=0;K+=1;N(13);}}}return Z;});if(C.length>0){for(var u=C.length-1;u>=0;u--){var t=C[u][C[u].length-1];s[s.length]=["unclosed tag "+a[t[0]],t[2]];}}return{tree:D,stack:C,err:s,count:z};};};apf.JavascriptParser=new apf.JSImplementation();apf.lm=new (function(){var bD={"var":1,"for":1,"while":1,"do":1,"if":1,"else":1,"switch":1,"case":1,"break":1,"continue":1,"default":1,"function":2,"return":1,"try":1,"catch":1,"throw":1,"debugger":1,alert:1,"delete":1,"export":1,"import":1,label:1,foreach:1,each:1,node:1,local:1,yield:1,let:1,"finally":1,"delete":1},aE={"\n":1,"\r\n":1,"==":2,"++":2,"--":2,'"':5,"'":5,"<!--":6,"-->":6,"/*":6,"//":6,"*/":6,"{":7,"}":8,"[":9,"]":10,"(":11,")":12,"<":13,">":14,"+=":2,"-=":2,"/=":2,"*=":2},aV={"{":"}","[":"]","(":")","{{":"}"},aY={ancestor:1,"ancestor-or-self":1,attribute:1,child:1,descendant:1,"descendant-or-self":1,following:1,"following-sibling":1,namespace:1,parent:1,preceding:1,self:1},a6={";":1,",":2,"^":3,"=":4,"+=":4,"-=":4,"/=":4,"*=":4,"/":5,":":6},aX={"~":"_val(_n,","%":"_nod(_n,","*":"_nods(_n,","#":"_cnt(_n,","$":"_lng("},q={"~":"_val(_n,","%":"_xml(_n,","*":"_xmls(_n,","#":"_cnt(_n,","$":"_lng("},bj={"~":"_val(_n,","%":"_val(_n,","*":"_val(_n,","#":"_cnt(_n,","$":"_lng("},bK,J={"~":"_val(_n,","%":"_xml(_n,","*":"_xmls(_n,","#":"_cnt(_n,","$":"_lng("},au={"~":"_val(_n,","%":"_xml(_n,","*":"_xmls(_n,","#":"_cnt(_n,","$":"_lnged("},n={"[":1,"(":1,",":1,"=":1,"return":1,"throw":1},aj={"else":1,"return":1,"delete":1},aI={"do":1,"else":1,"try":1},bb={"=":"_asn(","+=":"_add(","-=":"_sub(","/=":"_div(","*=":"_mul("},aK={"+":1,"%":1,"-":1,"/":1,"=":1,"(":1,"?":1,"|":1,"^":1,"[":1,"&":1,"*":1,"!":1,":":1,"<":1,",":1},aZ={"{":1,"} ":1,")":1,")   ":1,";":1,"\n":1,"else":1},U={"{":1,";":1,"\n":1,"else":1},B={"} ":1,")   ":1,"(":1,")":1,";":1,"&":1,"^":1,"|":1,",":1,'"':1,"'":1,"=":1,"+=":2,"-=":2,"/=":2,"*=":2,"?":1,"{":1,"}":1,">":1,"[":1,"]":1,"+":1,":":1,"else":1,"return":1},N={'"':1,"'":1,">":1,"]":1,"}":1},bA={'\\"':'"',"\\'":"'","\\{":"{","\\}":"}","\\[":"[","\\]":"]","\\(":"(","\\)":")","\\\\":"\\"},bG={alert:1,confirm:1,setTimeout:1,setInterval:1,"switch":1,call:1,"return":1,"throw":1,"case":1,"catch":1},w={" ":1,"\n":1},a9={"{":1,";":1,"(":1,"\n":1},bq={"\\{":"{","\\}":"}","\\[":"[","\\]":"]","\\(":"(","\\)":")"},I={"\\{":"{","\\}":"}","\\[":"[","\\]":"]","\\(":"(","\\)":")","\\\\":"\\\\\\\\","\\":"\\\\","\\<":"<","\\>":">"},aA={lte:"<=",gte:">=",lt:"<",gt:">",and:"&&",or:"||",andbin:"&",orbin:"|",LTE:"<=",GTE:">=",LT:"<",GT:">",AND:"&&",OR:"||",ANDBIN:"&",ORBIN:"|"},X={0:"_val(_n,",1:"_valcr(_n,_cr,",2:"_nod(_n,",3:"_nodcr(_n,_cr,",4:"_nods(_n,",5:"_xpt(_n,",6:"_valst(_n,",7:"_valed(_n,",foreach:"_nods(_n,",each:"_nods(_n,",local:"_nod(_n,",tagName:"_nod(_n,",localName:"_nod(_n,",xml:"_xmlq(",_call:"_val(_n,"},a7={"_val(_n,":"_valm(","_valcr(_n,_cr,":"_valcr(0,_cr,","_nod(_n,":"_nodm(","_nodcr(_n,_cr,":"_nodcr(0,_cr,","_nods(_n,":"_nodsm(","_xml(_n,":"_xml(0,","_xmls(_n,":"_xmls(0,","_cnt(_n,":"_cntm(","_xpt(_n,":"_xptm(","_valst(_n,":"_valm(","_valed(_n,":"_valed(0,","_lng(":"_lng(","_lnged(":"_lnged(","_nod_del(_n,":"_nod_del(0,","_nods_del(_n,":"_nods_del(0,"},ak={"=":{"_val(_n,":"_nod_asn(_n,","_valm(":"_nod_asn(0,","_valcr(_n,_cr,":"_nod_asn(_n,","_valcr(0,_cr,":"_nod_asn(0,","_nod(_n,":"_nod_asn(_n,","_nodm(":"_nod_asn(0,","_nodcr(_n,_cr,":"_nod_asn(_n,","_nodcr(0,_cr,":"_nod_asn(0,","_nods(_n,":"_nods_asn(_n,","_nodsm(":"_nods_asn(0,"},"+=":{"_val(_n,":"_nod_add(_n,","_valm(":"_nod_add(0,","_valcr(_n,_cr,":"_nod_add(_n,","_valcr(0,_cr,":"_nod_add(0,","_nod(_n,":"_nod_add(_n,","_nodm(":"_nod_add(0,","_nodcr(_n,_cr,":"_nod_add(_n,","_nodcr(0,_cr,":"_nod_add(0,","_nods(_n,":"_nods_add(_n,","_nodsm(":"_nods_add(0,"}},z={"_cnt(_n,":"_nod_del(_n,","_xpt(_n,":"_nod_del(_n,","_val(_n,":"_nod_del(_n,","_valcr(_n,":"_nod_del(_n,","_nod(_n,":"_nod_del(_n,","_nodcr(_n,_cr,":"_nod_del(_n,","_nods(_n,":"_nods_del(_n,"},an=/(\r?[\n]|\/\*|\*\/|\/\/|\<\!\-\-|\-\-\>|[=+\/\*-]=|\+\+|\-\-|["'{(\[\])}\]\<\>]|$)|([ \t]+)|([a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF.$_][\w.$_]*)|(\d[x\d.]*)|(\\?[\w._?,:;!=+-\\\/^&|*"'[\]{}()%$#@~`<>]?)/g,ap=/(^|\|)(?!\@|text\(\)|\.\.|[\w\-\:]+?\:\:)/g,aG={},aL={},aH={},bB=apf.$asyncObjects||{comm:1,rpc:1,http:1},aN,bI,aO,m,aw,ax,am,bm,aP,bL,bJ,ab,ao=[],bl,aC=[],aD=[],bv,bd,A,bw,bN,O,aJ,bs,av,F,by,aR,ah,a0,at,aQ,bi,bu,T;aG["if"]="if(",aL["if"]=")",aG["while"]="while(",aL["while"]=")",aG["for"]="for(",aL["for"]=")",aG["switch"]="switch(",aL["switch"]=")",aG["catch"]="catch(",aL["catch"]=")",aL["function"]=")  ";aG.foreach=aG.each="\nfor(var _t=_t||[],_t=(_t.push(_n,0,(";aL.foreach=aL.each=")||[]),_t);(_n=_t[_t.length-1][_t[_t.length-2]++])||(_t.length-=2,_n=_t.pop(),0);)";aG.local="\nfor(var _t=_t||[],_t=(_t.push(_n,((_n=_local(";aL.local=")),1)),_t);(_t[_t.length-1]--&&_n)||(_t.length--,_n=_t.pop(),0);)";aG.localName="_localName(_n",aL.localName=")";aG.output="_o.join(''",aL.output=")";aG.reset="(_o=[],l=0",aL.reset=")";aG.item="(_t[_t.length-1][_t[_t.length-2]-1]",aL.item=")",aG.first="(_t[_t.length-2]==1",aL.first=")",aG.last="(_t[_t.length-2]==_t[_t.length-1].length",aL.last=")",aG.total="(_t[_t.length-1].length",aL.total=")",aG.pos="(_t[_t.length-2]-1",aL.pos=")",aG.tagName="_tagName(_n",aL.tagName=")";aG._nodeValue="_nodeValue(_n",aL._nodeValue=")";aL.async="])";aL.precall="])";aL._call=")";var W={_call:".call(_n",localName:aG.localName,tagName:aG.tagName,nodeValue:aG.nodeValue},E="(function(){var _o=[],_l=0;",R=";return _l==1?_o[0]:_o.join('');})()",D="_async(_n,_c,_a,_w,_f,this,",G="',_a[++_a.i]||[",M="_r=",al,az="_o[_l++]=",bF="",aW="{var _o=[],_l=0,_n=this;",a8=";\nreturn _l==1?_o[0]:_o.join('');}",a5="(_a=_a||{}).i=0;try{",bg="}catch(_e){if(_e.x)return;throw(_e);}",a4="(_a=_a||{}).i=0;try{_pc(_w);",bf="}catch(_e){if(_e.x)return;throw(_e);}",bh="with(_w){",bp="}",bC="var _o=[],_l=0;_o[_l++]=",ac="var _o=[],_l=0;",bM=";\nreturn _ret(_l==1?_o[0]:_o.join(''));",Z=";\n_c(_ret(_l==1?_o[0]:_o.join('')),apf.SUCCESS,apf.$lmx);apf.$lmx=null;",ar="return _ret(",aB=");",ba="_c(_ret(",bk="),apf.SUCCESS,apf.$lmx);apf.$lmx=null;",K="var _r=",u="var _r;",V=";\nreturn _r;",d=";\n_c(_r,apf.SUCCESS,apf.$lmx);apf.$lmx=null;",c=";\n_c(0,apf.SUCCESS,apf.$lmx);apf.$lmx=null;;",a3="return ",be="",aU="_c(",a2=",apf.SUCCESS);",bc="var _f=function(_n,_c,_w,_a){",i="var _f=function(_n,_w){",l="var _f=function(_n){",ag="var _f=function(_n,_c,_w,_cr,_a){",j="var _f=function(_n,_w,_cr,){",aq="var _f=function(_n,_cr){",ad="var _f=function(event,_c,_w,_a,_n){",bn="var _f=function(event,_w,_n){",af="var _f=function(event,_n){",C="}",Y="var _f=function(_m){",Q=";\nif(_n=_r){if(!_n.nodeType)_n=_m;",ay=";\nif(_n=",aF="){if(!_n.nodeType)_n=_m;",bo="\nreturn ",aT="\nreturn _ret(",a1=");",a="\nreturn _n;",bx="\nreturn (_r = (",bH="))?(_r.nodeType?_r:_n):(_r===null?null:_n);",br="var _r, _n = _m;",P=";\n_n = _m;",t="\nreturn _ret(_nodeValue(_n));",aS="\nreturn _n;",bE="\n}";function ae(o){var bt,s;if(aw[bd-1]=="{{"){bt=bd-1;}else{for(s=bl-2,bt=0;s>=0&&aw[bt=(ao[s]&268435455)-1]!="{{";s-=2){}}if(!o&&ax>bt+1){aw[bt]=E+az;}else{aw[bt]=E;}bv=1;}function aM(bV,bP,s,bO,o,bt,bR){var bU,bT,bS,bQ=bP?aE[bP]:(s?0:(bO?3:(o?4:(bV?2:15))));switch(bv){case 0:case 1:switch(bQ){case 0:if((F==3&&av!="$")||F==4){aw[ax++]=" ";}else{if(aX[av]){F=0;}}break;case 1:aJ++,bi=bR;if(aw[ax-1]!="\n"&&!a9[av]){aw[ax++]="\n";}if(aX[av]){F=0;}break;case 2:if(bT=a6[bV]){switch(bT){case 1:if(!ao[bl-1]){aw[ax++]=")",bl-=2;}if(!bv){if(aw[ax-1]!="\n"&&av!="{"&&av!=";"){aw[ax++]="\n";}}else{if(!bl||ao[bl-1]){aw[ax++]=";";}}break;case 2:if(!ao[bl-1]){aw[ax++]=")",bl-=2;}aw[ax++]=",";break;case 3:if(aw[ax-1]=="\n"||aw[ax-1]==";"||av=="{"||av=="} "||ax==bd){if(!bv){ae();}aw[ax++]="  ";}else{aw[ax++]="^";}break;case 4:if(av!="<"&&av!=">"){if(!bv){ae(true);}aw[ax++]=bV;for(bT=ax;bT>=bd&&!bD[aw[bT]]&&!((aw[bT]=="  "||aw[bT]==(bs?az:al))&&(aw[bT]="",1));bT--){}if(F==3&&by>0&&av.charAt(0)!="."){ax-=2;while(w[aw[ax]]){ax--;}bS=av;aw[ax++]=bb[bV],aw[ax++]=bS.slice(0,by),aw[ax++]=",'",aw[ax++]=bS.slice(by+1),aw[ax++]="',",ao[bl++]=bd|(bv<<28),ao[bl++]="";}else{if(aw[bT=ax-2]==") "){if(!(bU=ak[bV])||!(bU=bU[aw[bS=ao[bl]&268435455]])){throw {t:"Invalid xpath assign",p:bR};}aw[bS]=bU,aw[bT]=",",aw[bT+1]="",aw[bT+2]="";ao[bl++]=bd|(bv<<28),ao[bl++]="";}}}else{aw[ax++]=bV;}break;case 5:if(n[av]){ao[bl++]=bd|(bv<<28);ao[bl++]=aw[ax++]=bV;bd=A=ax-1;bs++,bv=5,bw=bV;}else{aw[ax++]="/";}break;case 6:if(bl>2&&ao[bl-1]=="{{"&&(ax<bd+4&&F==5)||(ax<bd+3&&(F==3||F==4))){aw[bd-1]=ao[bl-1]="{";bv=(bT=ao[bl-2])>>28;ao[bl-2]=bT&268435455,bs--;}else{if(aw[ax-3]=="case"||(F==5&&T=="case")){bV=";";}}aw[ax++]=":";break;}}else{aw[ax++]=bA[bV]||bV;}break;case 3:case 4:bT=bU=bS=0;by=(T=bV).lastIndexOf(".");if(bV.charAt(0)!="."&&((bT=(bU=((aZ[av]||aw[ax-1]=="\n")&&!aK[av]))&&!ao[bl-1].indexOf("{")&&ax>bd)||(bS=bD[bV]))&&!bv){if(bS==2&&ao[bl-1].indexOf("{")){bS=0;}ae(bS);}if(bU&&!ao[bl-1]){aw[ax-1]=="\n"&&(aw[ax-1]=""),aw[ax++]=")",aw[ax++]="\n",bT=1,bl-=2;}if(bT&&bv&&!bD[bV]){aw[ax++]=(bs?az:al);}if(by>0&&bV.charAt(0)!="."){aP[aw[ax++]=ah=bV]=1;}else{aw[ax++]=aA[bV]||bV;}break;case 5:if((bT=(bU=((aZ[av]||aw[ax-1]=="\n")&&!aK[av]))&&!ao[bl-1].indexOf("{")&&ax>bd)&&!bv){ae();}if(bU&&!ao[bl-1]){aw[ax-1]=="\n"&&(aw[ax-1]=""),aw[ax++]=")",aw[ax++]="\n",bT=1,bl-=2;}if(bT){aw[ax++]=(aw[ax-2]!="\n"&&N[av])?"+":(bs?az:al);}else{if(N[av]){aw[ax++]="+";}}ao[bl++]=bd|(bv<<28),ao[bl++]=aw[ax++]=bV;bd=A=ax-1,bs++,bv=5,bw=bV;break;case 6:if(bV=="*/"||bV=="-->"){throw {t:"Unmatched comment "+bV,p:bR};}a0=bv,at=av,aQ=F,bv=6,bw=bV;break;case 7:if(aw[ax-1]==")  "||(aw[ax-2]==")  "&&ax--)){if(ao[bl-1]!="("&&ao[bl-1]!="["){ao[bl++]=bd|(bv<<28),ao[bl++]="{{",aw[ax++]=aW,bd=ax,bv=1,bs++,aw[ax++]="";}else{ao[bl++]=bd,ao[bl++]=aw[ax++]=bV,bd=ax;bv=1;}}else{if((aG[ao[bl+1]]&&av==")   ")||aI[av]){ao[bl++]=bd,ao[bl++]=aw[ax++]=bV,bd=ax;aw[ax++]="";}else{if((bT=(bU=((aZ[av]||aw[ax-1]=="\n")&&!aK[av]))&&!ao[bl-1].indexOf("{")&&ax>bd)&&!bv){ae();}if(bU&&!ao[bl-1]){aw[ax-1]=="\n"&&(aw[ax-1]=""),aw[ax++]=")",aw[ax++]="\n",bT=1,bl-=2;}if(bT){aw[ax++]=(aw[ax-2]!="\n"&&N[av])?"+''+":(bs?az:al);}else{if(N[av]){aw[ax++]=(av=="}")?"+''+":"+";}}ao[bl++]=bd|(bv<<28),ao[bl++]=aw[ax++]="{{";if(!bs&&bd!=ax){bL++;}bs++,A=bd=ax,bv=0;}}break;case 8:if(!ao[bl-1]){aw[ax++]=")",aw[ax++]="\n",bl-=2;}if(aV[bT=ao[--bl]]!=(aw[ax++]=bV)){throw {t:"Cannot close "+bT+" with "+bV,p:bR};}if(bT=="{{"){if(bd==ax-1){if((ao[bl-1]>>28)<=1){aw[bd-1]="{",aw[ax-1]="}";}else{aw[bd-1]=aw[ax-1]="'";}}else{if(!bv){aw[bd-1]="(",aw[ax-1]=")";}else{if(aw[bd-1]==aW){if(bd==ax-2){aw[bd-1]="{",aw[ax-1]="}";}else{aw[ax-1]=a8;}}else{aw[ax-1]=R;}}}bv=(bT=ao[--bl])>>28,bd=bT&268435455;A=ax,bs--;if(!bs){bL++;}if(bv==7){aw[ax++]='+"\\"',bv=4;}}else{bd=ao[--bl];}break;case 9:if(((F==3&&!aj[av]&&av!="$")||av==")"||av=="]")&&aw[ax-1]!="\n"){aw[ax++]="[",ao[bl++]=bd|(bv<<28),ao[bl++]=bV,A=bd=ax;}else{aR=null;if((bS=aX[av])){ax--,av=aw[ax-1];if(aw[ax-1]=="delete"||(aw[ax-2]=="delete"&&ax--)){bS=z[bS],ax--;}}else{bS=X[ao[bl-1]]||X[bs?0:aN];if(av=="delete"){bS=z[bS],ax-=2;}}if((bT=(bU=((aZ[av]||aw[ax-1]=="\n")&&!aK[av]))&&!ao[bl-1].indexOf("{")&&(ax>bd||ao[bl-1].length==1))&&!bv){ae();}if(bU&&!ao[bl-1]){aw[ax-1]=="\n"&&(aw[ax-1]=""),aw[ax++]=")",aw[ax++]="\n",bT=1,bl-=2;}if(bT){aw[ax++]=(aw[ax-2]!="\n"&&N[av])?"+":(bs?az:al);}else{if(N[av]){aw[ax++]="+";}}if(!bs&&ax!=bd){bL++;}bs++,ao[bl++]=bd|(bv<<28),ao[bl++]=aw[ax++]=bS,A=bd=ax,aC[bd]=bR,bv=3;}break;case 10:if(!ao[bl-1]){aw[ax++]=")",bl-=2;}if(aV[bT=ao[--bl]]!=(aw[ax++]=bV)){throw {t:"Cannot close "+bT+" with "+bV,p:bR};}bd=ao[--bl]&268435455;break;case 11:if(((bT=(bU=((U[av]||aw[ax-1]=="\n")&&!aK[av]))&&!ao[bl-1].indexOf("{")&&ax>bd))&&!bv){ae();}if(bU&&!ao[bl-1]){aw[ax-1]=="\n"&&(aw[ax-1]=""),aw[ax++]=")",aw[ax++]="\n",bT=1,bl-=2;}if(bT&&bv){aw[ax++]=(bs?az:al),F=0;}if(bS=aG[av]){if(aw[ax-1]==" "){ax--;}aw[ax-1]=bS,ao[bl++]=bd,ao[bl++]=av,bd=A=ax;}else{if(F==3){if(by<0){bT=0;if(av=="function"||aw[ax-3]=="function"||aw[ax-4]=="function"){ao[bl++]=bd,ao[bl++]="function",aw[ax++]="(",bd=A=ax;}else{if(!bG[av]&&aw[ax-3]!="new"){aw[ax++]=".call(_n",ao[bl++]=bd,ao[bl++]="_call",bd=A=ax;}else{ao[bl++]=bd,ao[bl++]=aw[ax++]=bV,bd=A=ax;}}}else{if(by>1&&bB[bT=av.substring(0,by)]){if(aw[--ax]==" "){ax--;}aw[ax++]=D,aw[ax++]=bT,aw[ax++]=",'";aw[ax++]=av.slice(by+1);aw[ax++]=G,ao[bl++]=bd,ao[bl++]="async",bd=A=ax,am++;}else{ao[bl++]=bd,ao[bl++]=aw[ax++]=bV,bd=A=ax;}}}else{ao[bl++]=bd,ao[bl++]=aw[ax++]=bV,bd=A=ax;}if(av==ah){delete aP[av];}}break;case 12:if(!ao[bl-1]){aw[ax-1]=="\n"&&(aw[ax-1]=""),aw[ax++]=")",aw[ax++]="\n",bT=1,bl-=2;}if(bS=aL[bT=ao[--bl]]){if(bT!="_call"){bV=")   ";}if((bU=W[bT])&&bU!=aw[ax-1]){aw[bd-1]=bU+",";}aw[ax++]=bS;}else{if(aV[bT]!=(aw[ax++]=bV)){throw {t:"Cannot close "+bT+" with "+bV,p:bR};}}bd=ao[--bl]&268435455;break;case 13:if(ax==bd||B[av]||aw[ax-1]=="\n"){if((bT=(bU=((aZ[av]||aw[ax-1]=="\n")&&!aK[av]))&&!ao[bl-1].indexOf("{")&&ax>bd)&&!bv){ae();}if(bU&&!ao[bl-1]){aw[ax-1]=="\n"&&(aw[ax-1]=""),aw[ax++]=")",aw[ax++]="\n",bT=1,bl-=2;}if(bT){aw[ax++]=(aw[ax-2]!="\n"&&N[av])?"+''+":(bs?az:al);}else{if(N[av]){aw[ax++]="+";}}bu=null,aw[ax++]='"',aw[ax++]="<",bs++,ao[bl++]=bd|(bv<<28),bl+=3,ao[bl-2]=ao[bl-1]=0;A=bd=ax-1,bv=4;}else{aw[ax++]="<";}break;case 14:aw[ax++]=">";break;case 15:if(bl&&!ao[bl-1]){aw[ax-1]=="\n"&&(aw[ax-1]=""),aw[ax++]=")",aw[ax++]="\n",bT=1,bl-=2;}break;}break;case 2:switch(bQ){case 1:aJ++,bi=bR;if(ax!=bd&&ax!=A){aw[ax++]="\\n";}break;case 2:if(ax==A){aw[ax]=(ax++==bd)?'"':'+"';}aw[ax++]=I[bV]||bV;break;case 3:if(ax==A){aw[ax]=(ax++==bd)?'"':'+"';}if(bV.charAt(bV.length-1)=="$"){aw[ax++]=bV.slice(0,-1);aw[ax++]=bV="$";}else{aw[ax++]=bV;}break;case 5:if(ax==A){aw[ax]=(ax++==bd)?'"':'+"';}aw[ax++]=(bV=='"')?'\\"':"'";break;case 7:if(ax==A){if(ax!=bd){aw[ax++]="+";}}else{aw[ax++]='"+',bs||bL++;}ao[bl++]=bd|536870912,ao[bl++]=aw[ax++]="{{",bs++,A=bd=ax,bv=0;break;case 9:aR=null;if((bS=q[av])&&aw[ax-1]==av){if(--ax-1==bd){ax--;}}else{bS=X[(bs||bd!=ax)?0:aN];}if(ax!=bd){aw[ax]=(ax++==A)?"+":(bs||bL++,'"+');if(!bs){bL++;}}ao[bl++]=bd|536870912,ao[bl++]=aw[ax++]=bS,A=bd=ax,bs++,bv=3;break;case 15:if(bl){throw {t:"Unclosed "+ao[bl-1]+" found at end in textmode",p:bR};}if(ax!=bd&&ax!=A){aw[ax++]='"',bs||bL++;}break;default:if(ax==A){aw[ax]=(ax++==bd)?'"':'+"';}aw[ax++]=bV;}break;case 3:switch(bQ){case 0:if(ax!=bd){if(ax==A){aw[ax++]='+"';}aw[ax++]=bV;}break;case 1:aJ++,bi=bR;break;case 2:if(bV==":"&&av==":"&&!aY[bS=aw[ax-2]]&&((bT=ao[bl-2])>>28)!=6){if(aw[ax-2]=='+"'){aw[ax-2]=aw[ax-1]="",aR="#";}else{aw[ax-1]='"';if(A==bd){aR=aw.slice(A+1,ax-1).join("");}else{aR="#";}}if(!(bS=a7[aw[bd-1]])){throw {t:"Invalid model found for: "+aw[bd-1],p:bR};}aw[bd-1]=bS,aw[ax++]=",",A=bd=ax;}else{if(bV==","&&(bT=(ao[bl-2]>>28))<=1){ax=bd-1,bU=bN.slice(aC[bd]+1,bR+1);F=9,bv=bT,aw[ax++]=av="[";ao[bl-2]=(ao[bl-2]&268435455)|(bv<<28),ao[bl-1]=av,A=bd=ax,bs--;if(!bs){bJ--;}if(bU.length>1){aD.push(bN);(bN=bU).replace(an,aM);bN=aD.pop();}}else{if(ax==A){aw[ax]=(ax++==bd)?'"':'+"';}aw[ax++]=bA[bV]||bV;}}break;case 3:if(ax==A){aw[ax]=(ax++==bd)?'"':'+"';}if(bV.charAt(bV.length-1)=="$"){aw[ax++]=bV.slice(0,-1);aw[ax++]=bV="$";}else{aw[ax++]=bV;}break;case 5:if(ax==A){aw[ax]=(ax++==bd)?'"':'+"';}if(ao[bl-1]=="["){ao[bl-1]=bV;}else{if(ao[bl-1]==bV){ao[bl-1]="[";}}if(bV=='"'){aw[ax++]="\\";}aw[ax++]=bV;break;case 7:if(ax==A){if(ax!=bd){aw[ax++]="+''+";}}else{aw[ax++]='"+';}ao[bl++]=bd|805306368,ao[bl++]=aw[ax++]="{{",bs++,A=bd=ax,bv=0;if(aR&&ao[bl-3]!=q["$"]){bm.push(aR,"#");aR=null,ab++;}break;case 9:if(ao[bl-1]=="'"||ao[bl-1]=='"'||((F!=3||av=="$")&&av!=")")){if(aR){bm.push(aR,"#"),ab++;}aR=null;if((bS=q[av])&&aw[ax-1]==av){ax--;}else{bS=X[0];}if(ax==A){if(ax!=bd){aw[ax++]="+";}}else{aw[ax++]='"+';}ao[bl++]=bd|805306368,ao[bl++]=aw[ax++]=bS,bs++,A=bd=ax,bv=3;}else{if(ax==A){aw[ax]=(ax++==bd)?'"':'+"';}ao[bl++]=bd|1610612736,ao[bl++]=aw[ax++]="[";}break;case 10:bl--,bv=(bU=ao[--bl])>>28,bU=bU&268435455;if(bv==6){if(ao[bl+1]!="["){throw {t:"In xpath, cannot close "+ao[bl+1]+" with "+bV,p:bR};}if(ax==A){aw[ax]=(ax++==bd)?'"':'+"';}aw[ax++]="]";bv=3;}else{if(ax==bd){if((ao[bl]>>28)<=1){aw[bd-1]="[",aw[ax++]="]";}else{aw[bd-1]=aw[ax++]='"';}A=ax;}else{if(ax!=A){aw[ax++]='"';}if(A==bd){bT=aw.slice(A+1,ax-1).join("");if(m&&aw[bd-1]!=","&&bT!=(bU=bT.replace(ap,"$1self::"))&&ao[bl+1]!=q["$"]){aw[bd+1]=bT=bU;for(bU=bd+2;bU<ax-1;bU++){aw[bU]="";}}}else{if((bU=aw[bd-1])!=","){bT="#";if(m){aw[bd-1]=bU+"_injself(",aw[ax++]=")";}}else{bT="";}}if(ao[bl+1]!=q["$"]&&bT){bm.push(aR,bT);if(aR){ab++;}}aw[ax++]=") ",A=ax;if(bv==7){aw[ax++]='+"\\"',bv=4;}}bs--,aR=null;if(!bs){bL++,bJ++;}}bd=bU;break;case 11:if(ax==A){aw[ax]=(ax++==bd)?'"':'+"';}ao[bl++]=bd|805306368,ao[bl++]=aw[ax++]="(";break;case 12:if(ax==A){aw[ax]=(ax++==bd)?'"':'+"';}if(aV[bT=ao[--bl]]!=(aw[ax++]=bV)){throw {t:"Cannot close "+bT+" with "+bV,p:bR};}bd=ao[--bl]&268435455;break;case 15:throw {t:"Unexpected end whilst parsing xpath",p:bR};break;default:if(ax==A){aw[ax]=(ax++==bd)?'"':'+"';}aw[ax++]=bV;break;}break;case 4:switch(bQ){case 0:if(ax==A){aw[ax++]='+"';}aw[ax++]=" ",F=0;break;case 1:if(ax==A){aw[ax++]='+"';}aJ++,bi=bR,aw[ax++]="\\n",F=1;break;case 2:if(ax==A){aw[ax++]='+"';}if(bV=="/"&&av=="<"){bl-=4;if(ao[bl]||ao[bl+2]){throw {t:"Unexpected closing tag whilst parsing xml",p:bR};}}else{if(bV==":"&&F==3&&aw[ax-2]=="<"){bu=av;}}aw[ax++]=I[bV]||bV;break;case 3:if(ax==A){aw[ax++]='+"';}if(bV.charAt(bV.length-1)=="$"){aw[ax++]=bV.slice(0,-1);aw[ax++]=bV="$";}else{aw[ax++]=bV;}break;case 5:if(ax==A){aw[ax++]='+"';}if(bV=='"'){aw[ax++]="\\";}aw[ax++]=bV;break;case 6:if(bV=="//"&&!ao[bl-1]){if(ax==A){aw[ax++]='+"';}aw[ax++]=bV;}else{if(bV=="*/"){throw {t:"Unmatched comment "+bV,p:bR};}a0=bv,at=av,aQ=F,bv=6,bw=bV;}break;case 13:bu=null;if(ax==A){aw[ax++]='+"';}aw[ax++]=bV,ao[bl]=ao[bl+2]=0,bl+=4,ao[bl-1]=0;break;case 14:if(ax==A){aw[ax++]='+"';}aw[ax++]=bV;if(av!="<"){if(av=="/"){bl-=4;if(ao[bl+2]){throw {t:"Unexpected / whilst parsing xml",p:bR};}if(aw[ax-3]=="<"){ax-=2,aw[ax-1]="";}}else{bl-=2;}if(ao[bl]){bs--,aw[ax++]='"',bd=ao[bl],A=ax,bv=bd>>28,bd=bd&268435455;}else{ao[bl-1]=1;}}else{ax--,aw[ax-1]="";}break;case 9:aR=null;if(av=="!"&&aw[ax-2]=="<"&&!ao[bl-1]){aw[ax++]=bV,ao[bl++]=bd|(bv<<28);ao[bl++]="]]>",bd=A=ax-1;bs++,bv=5;}else{if(ao[bl-1]){if((bT=bK[av])){ax--;}else{bT=X[bu?bI:0];}ao[bl++]=bd|1073741824;}else{ao[bl++]=bd|1073741824;if((bT=bj[av])){ax--;if(aw[ax-1]=="="){av="=";}}else{bT=X[bu?aO:0];}if(av=="="){aw[ax++]='\\"',ao[bl-1]=bd|1879048192;}}aw[ax]=(ax++==A)?"+''+":'"+';bs++,ao[bl++]=aw[ax++]=bT,A=bd=ax,bv=3;}break;case 7:if(av=="="){aw[ax++]='\\"',ao[bl++]=bd|1879048192;}else{ao[bl++]=bd|1073741824;}aw[ax]=(ax++==A)?"+''+":'"+';ao[bl++]=aw[ax++]="{{",bs++;A=bd=ax,bv=0;break;default:if(ax==A){aw[ax++]='+"';}aw[ax++]=bV;break;case 15:throw {t:"Unexpected end whilst parsing xml",p:bR};break;}break;case 5:switch(bQ){case 1:aJ++,bi=bR;if(ax==A){aw[ax]=(ax++==bd)?'"':'+"';}aw[ax++]="\\n";break;case 2:if(bV=="/"&&ao[bl-1]=="/"){aw[ax++]="/",bd=ao[bl-=2],A=ax,bv=bd>>28,bd=bd&268435455,bs--;}else{if(ax==A){aw[ax]=(ax++==bd)?'"':'+"';}aw[ax++]=(ao[bl-1]!="/"&&bq[bV])||bV;}break;case 3:if(ax==A){aw[ax]=(ax++==bd)?"":'+"';}if(bV.charAt(bV.length-1)=="$"){aw[ax++]=bV.slice(0,-1);aw[ax++]=bV="$";}else{aw[ax++]=bV;}break;case 5:if(ao[bl-1]==bV){if(bd!=A){aw[ax]=(ax++!=A)?(bV+")"):")";}else{aw[ax++]=bV;}bd=ao[bl-=2],A=ax,bv=bd>>28;bd=bd&268435455,bs--;}else{if(ax==A){aw[ax]=(ax++==bd)?'"':'+"';}aw[ax++]=bV=='"'?'\\"':bV;}break;case 6:if(ao[bl-1]=="/"&&bV=="*/"){aw[ax++]="*/",bd=ao[bl-=2],A=ax,bv=bd>>28,bd=bd&268435455,bs--;}else{if(ax==A){aw[ax]=(ax++==bd)?"":'+"';}aw[ax++]=bV;}break;case 7:if(ao[bl-1]!="'"&&ao[bl-1]!="/"){if(ao[bl-1]=='"'){aw[bd]='("';}if(ax==A){if(ax!=bd){aw[ax++]="+";}}else{aw[ax++]='"+';}ao[bl++]=bd|1342177280,aw[ax++]=ao[bl++]="{{",bs++,A=bd=ax,bv=0;}else{aw[ax++]=bV;}break;case 9:if(ao[bl-1]!="'"&&ao[bl-1]!="/"&&(ao[bl-1]=='"'&&(aw[bd]='("')||ax!=bd+2||av!="CDATA")){aR=null;if((bS=q[av])&&aw[ax-1]==av){ax--;}else{bS=X[0];}if(ax!=bd){aw[ax]=(ax++==A)?"+":'"+';}ao[bl++]=bd|1342177280,ao[bl++]=aw[ax++]=bS,A=bd=ax,bs++,bv=3;}else{aw[ax++]=bV;}break;case 14:if(ax==A){aw[ax]=(ax++==bd)?"":'+"';}aw[ax++]=bV;if(ao[bl-1]=="]]>"&&av=="]"&&aw[ax-3]=="]"){bd=ao[bl-=2],bv=bd>>28;bd=bd&268435455,bs--;bl-=4;if(ao[bl]){bs--,aw[ax++]='"',bd=ao[bl],A=ax,bv=bd>>28,bd=bd&268435455;}else{ao[bl-1]=1;}}break;case 15:throw {t:"Unexpected end whilst parsing string",p:bR};break;default:if(ax==A){aw[ax]=(ax++==bd)?"":'+"';}aw[ax++]=bV;break;}break;case 6:switch(bQ){case 1:aJ++,bi=bR;if(bw=="//"){bv=a0,bV=av=at,bQ=F=aQ;}break;case 6:if((bw=="/*"&&bV=="*/")||(bw=="<!--"&&bV=="-->")){bv=a0,bV=av=at,bQ=F=aQ;}break;case 15:throw {t:"Unexpected end whilst parsing comment",p:bR};break;}break;}if(bQ>1){av=bV,F=bQ;}}this.lastCode=function(){if(typeof(aw)=="object"){return aw.join("");}return aw;};function bz(bt,o,s){if(bt.t){throw new Error(apf.formatErrorString(0,null,"Parsing live markup source","Error whilst parsing: "+bt.t+" on line:"+aJ+" col:"+(bt.p-o-2)+(s?(" part: "+s):"")+"\n"+bN));}else{throw new Error(apf.formatErrorString(0,null,"Compiling live markup function","Error whilst compiling: "+bt.message+"\nInput:\n"+bN+"\nGenerated:\n"+apf.lm.lastCode()));}}var ai={},aa={};this.resetCache=function(){ai={};};this.compile=function(s,o){if(!o){o=aa;}if(s==null||!s.length){return o.nostring?function(){return s;}:{type:2,str:s};}var bQ,bO,bt=(o.xpathmode|(o.withopt&&16)|(o.precall&&32)|(o.alwayscb&&64)|(o.nostring&&128)|(o.parsecode&&256)|(o.nostate&&512)|(o.editable&&1024)|(o.langedit&&2048)|(o.injectself&&4096)|(o.event&&8192))+s;if(bQ=ai[bt]){return bQ;}m=o.injectself,aN=o.xpathmode||0,aO=o.nostate?0:6,bI=o.editable?7:0;bK=o.langedit?au:J;aP={},bm=[],ao=[],aw=["","","",""],bN=s,O=bN.length;ax=bd=A=aw.length,bL=bJ=am=ab=bs=aJ=F=bi=0;if(o.parsecode){bv=0,bl=2,ao[0]=ax,ao[1]="{{",av="{",al=o.event?"":(aN<=1?az:M);}else{bv=2,bl=av=0,al=az;}if(o.nothrow){bN.replace(an,aM);}else{try{bN.replace(an,aM);}catch(bP){bz(bP,bi);return null;}}if(o.parsecode){if(bs||ao[bl-1].length==1){bz({t:"Unclosed "+ao[bl-1]+" found at end in codemode",p:O},bi);}if(A!=ax){bL++;}}if(!o.nostring&&(bv==2&&A==4||ax==4)){return{type:2,str:aw.slice(5,-1).join("").replace(/\\n/g,"\n").replace(/\\"/g,'"')};}if(am||o.alwayscb){if(o.event){if(bv==1){aw[3]="";}aw[ax++]=c;}else{if(aN){if(bv==1){aw[3]=(aw[3]!=E)?K:u,aw[ax++]=d;}else{aw[3]=aU,aw[ax++]=a2;}}else{if(bv==1){aw[3]=(aw[3]!=E)?bC:ac,aw[ax++]=Z;}else{aw[3]=ba,aw[ax++]=bk;}}}if(o.withopt){aw[2]=bh,aw[ax++]=bp;}if(am){if(o.precall){aw[1]=a4,aw[ax++]=bf;}else{aw[1]=a5,aw[ax++]=bg;}}aw[0]=o.event?ad:((aN==1||aN==3)?ag:bc);aw[ax++]=C;}else{if(o.event){if(bv==1){aw[3]="";}}else{if(aN){if(bv==1){aw[3]=(aw[3]!=E)?K:u,aw[ax++]=V;}else{aw[3]=a3,aw[ax++]=be;}}else{if(bv==1){aw[3]=(aw[3]!=E)?bC:ac,aw[ax++]=bM;}else{aw[3]=ar,aw[ax++]=aB;}}}if(o.withopt){aw[2]=bh,aw[ax++]=bp;}aw[0]=o.event?(o.withopt?bn:af):(o.withopt?((aN==1||aN==3)?j:i):((aN==1||aN==3)?aq:l));aw[ax++]=C;}if(o.nothrow){bO=apf.lm_exec.compile(aw.join(""));}else{try{bO=apf.lm_exec.compile(aw.join(""));}catch(bP){bz(bP,bi);return null;}}bO.type=(bL==1&&bJ==1)?3:1;bO.xpaths=bm,bO.models=ab,bO.props=aP,bO.asyncs=am;ai[bt]=bO;return bO;};this.compileMatch=function(bQ,o){if(!o){o=aa;}aP={},bm=[],aw=[Y,br],ao=[],bs=0,ax=aw.length,bK=J;for(var bO,s,bP=0,bt=bQ.length;bP<bt;bP+=2){if(bN=bQ[bP]){O=ao.length,aN=2;if(bP){aw[ax++]=P;}aw[ax++]="";ao[0]=s=ax=bd=A=aw.length,al=M;aJ=F=bL=bJ=am=bv=bi=0;bl=2,ao[1]="{{",av="{";m=1;if(o.nothrow){bN.replace(an,aM);}else{try{bN.replace(an,aM);}catch(bS){bz(bS,bi);return null;}}if(bs||ao[bl-1].length==1){bz({t:"Unclosed "+ao[bl-1]+" found at end in codemode",p:O});}if(am){bz({t:"Asynchronous calls not supported in match/value"});}if(bv==1){aw[s-1]=(aw[s-1]!=E)?al:"",aw[ax++]=Q;}else{aw[s-1]=ay,aw[ax++]=aF;}}if(bN=bQ[bP+1]){O=ao.length;if(!bQ[bP]&&bP){aw[ax++]=P;}aw[ax++]="";s=ax=bd=A=aw.length,al=az;aN=m=av=bl=aJ=bL=bJ=F=am=bi=0;if(o.node){aN=2;}bv=2,m=0;if(o.nothrow){bN.replace(an,aM);}else{try{bN.replace(an,aM);}catch(bS){bz(bS,bi);return null;}}if(am){bz({t:"Asynchronous calls not supported in match/value"});}if(o.node){if(bv==2&&A==s||ax==s){aw[s-1]=a;}else{aw[s-1]=bx,aw[ax++]=bH;}}else{if(bv==2&&A==s||ax==s){aw[s-1]=bo;}else{aw[s-1]=aT,aw[ax++]=a1;}}if(bQ[bP]){aw[ax++]=bE;}else{break;}}else{if(!bQ[bP]){bz({t:"Both match and value are empty"});}if(o.node){aw[ax++]=aS;}else{aw[ax++]=t;}aN=2;aw[ax++]=bE;}}aw[ax++]=C;var bR;if(o.nothrow){bR=apf.lm_exec.compile(aw.join(""));}else{try{bR=apf.lm_exec.compile(aw.join(""));}catch(bS){bz(bS,bi);return null;}}bR.type=1,bR.xpaths=bm,bR.props=aP,bR.asyncs=am;return bR;};this.setWarnLevel=function(o){apf.lm_exec.setWarnLevel(o);};})();apf.lm_exec=new (function(){var wlvl=3;this.setWarnLevel=function(lvl){wlvl=lvl;};function wxpath(x,t){apf.console.warn("Live Markup warning in "+t+", no results for xpath: '"+x+"'");}function wnode(x,t){apf.console.warn("Live Markup warning in "+t+", xpath on null node: '"+x+"'");}function wmodel(m,x,t){apf.console.warn("Live Markup warning in "+t+", xpath on empty model: '"+m+"' xpath: '"+x+"'");}function wlang(x,t){apf.console.warn("Live Markup warning in "+t+", language symbol not found: '"+x+"'");}function xmlParse(str){var n=apf.getXmlDom("<_apflmlist_>"+str+"</_apflmlist_>");if(!n||!(n=n.documentElement)){return null;}return(n.firstChild==n.lastChild)?n.firstChild:n;}function __val(n,x){if(!n){return("");}return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||("");}function __valm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return("");}return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||("");}function __nod(n,x){return n?n.selectSingleNode(x):(null);}function _nods(n,x){return n?n.selectNodes(x):([]);}function __nodm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(null);}return n.selectSingleNode(x);}function _nodsm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return([]);}return n.selectNodes(x);}function __cnt(n,x){return n?n.selectNodes(x).length:(0);}function __cntm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(0);}return n.selectNodes(x).length;}function _xpt(n,x){return{xpath:x,toString:function(){return"LM Xpath object: "+this.x;}};}function _xptm(m,x){return{model:m,xpath:x,toString:function(){return"LM Xpath object with model: "+this.x;}};}function _xml(n,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return("");}}return(n&&(n=n.selectSingleNode(x)))&&n.xml||("");}function _xmls(n,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return("");}}for(var i=0,j=((n=n.selectNodes(x))).length,o=[];i<j;i++){o[i]=n[i].xml;}return o.join("");}function _valcr(n,cr,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return("");}}if(cr){apf.createNodeFromXpath(ni,x);}else{if(n=ni.selectSingleNode(x)){return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||"";}}return("");}function _nodcr(n,cr,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(null);}}return n.selectSingleNode(x)||(cr&&apf.createNodeFromXpath(n,x));}function _valst(n,x){var m=apf.xmldb.findModel(n);if(!m){return("");}return"["+m.id+"::"+apf.xmlToXpath(n,m.data,true)+"/"+x+"]";}function _valed(n,m,x){if(n){x=m;}return"<div contenteditable='true' class='contenteditable'>CONTENT_EDITABLE_TODO</div>";}function _nod_del(n,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(null);}}if(!(n=n.selectSingleNode(x))){return(null);}apf.xmldb.removeNode(n);}function _nods_del(n,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(null);}}if(!(n=n.selectNodes(x))){return;}apf.xmldb.removeNodeList(n);}function _nod_asn(n,m,x,v){if(n){v=x,x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign to nonresolving model:"+m+"\nxpath:"+x+"\nvalue:"+v));}}if(!n||(x&&!(n=apf.createNodeFromXpath(n,x)))){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign could not resolve \nxpath:"+x+"\nvalue:"+v));}var c;if(!v||(v.charAt&&(c=v.charAt(0)!="<"))||typeof(v)=="number"){apf.setNodeValue(n,v,true);return v;}if(!c){if(n.nodeType!=1){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign to a non-element node\nxpath:"+x+"\nvalue:"+v));}if(!(c=xmlParse(v))){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot append broken XML.\nxpath:"+x+"\nvalue:"+v));}if(c.tagName!="_apflmlist_"){return apf.xmldb.replaceNode(c,n);}else{c=c.childNodes;apf.xmldb.replaceNode(n=c[0],n);for(var i=0,j=c.length;i<j;i++){n=apf.xmldb.appendChild(n.parentNode,c[0],n.nextSibling);}return n;}}else{if(v.length){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Assign of xpath nodelists not yet supported\nxpath:"+x+"\nvalue:"+v));}else{if(!v.selectNodes){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign non-element node\nxpath:"+x+"\nvalue:"+v));}if(v.nodeType==2){if(n.nodeType!=2){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign attribute node to replace non attribute, use += xpath:"+x+"\nvalue:"+v));}apf.xmldb.removeAttribute(c=n.ownerElement||n.selectSingleNode(".."),n.nodeName);apf.xmldb.setAttribute(c,v.nodeName,v.nodeValue);c.getAttributeNode(v.nodeName);}else{apf.xmldb.replaceNode(v,n);}}}return v;}function _nods_asn(n,m,x,v){if(n){v=x,x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign to nonresolving model:"+m+"\nxpath:"+x+"\nvalue:"+v));}}for(var i=0,j=(n=n.selectNodes(x)).length;i<j;i++){_nod_asn(n[i],null,v);}return v;}function _nod_add(n,m,x,v){if(n){v=x,x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot append to nonresolving model:"+m+"\nxpath:"+x+"\nvalue:"+v));}}if(!n||(x&&!(n=n.selectSingleNode(x)))){return _nod_asn(n,0,x,v);}var c;if(!v||(v.charAt&&(c=v.charAt(0)!="<"))||typeof(v)=="number"){apf.setNodeValue(n,v=((n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||"")+v,true);return v;}if(!c){if(n.nodeType!=1){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot append to a non-element node\nxpath:"+x+"\nvalue:"+v));}if(!(c=xmlParse(v))){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot append broken XML.\nxpath:"+x+"\nvalue:"+v));}if(c.tagName!="_apflmlist_"){return apf.xmldb.appendChild(n.parentNode,xmlParse(v),n.nextSibling);}else{c=c.childNodes;for(var i=0,j=c.length;i<j;i++){n=apf.xmldb.appendChild(n.parentNode,c[0],n.nextSibling);}return n;}}else{if(v.length){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Nodelists not yet supported\nxpath:"+x+"\nvalue:"+v));}else{if(!v.selectNodes){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot assign non-element node\nxpath:"+x+"\nvalue:"+v));}if(v.nodeType==2){if(n.nodeType!=1){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot append attribute to anything but element node"));}apf.xmldb.setAttribute(c=n.ownerElement||n.selectSingleNode(".."),v.nodeName,v.nodeValue);apf.xmldb.removeAttribute(v.ownerElement||v.selectSingleNode(".."),v.nodeName);return c.getAttributeNode(v.nodeName);}else{return apf.xmldb.appendChild(n.parentNode,v,n.nextSibling);}}}}function _nods_add(n,m,x,v){if(n){v=x,x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot append to nonresolving model:"+m+"\nxpath:"+x+"\nvalue:"+v));}}for(var i=0,j=(n=n.selectNodes(x)).length;i<j;i++){_nod_add(n[i],null,v);}return v;}function _asn(o,p,v){if(!o||typeof(o)!="object"){throw new Error(apf.formatErrorString(0,0,"LM Property Assign","Cannot assign property on non object, property:"+p));}if(o.setAttribute){o.setAttribute(p,v);}else{o[p]=v;}return v;}function _add(o,p,v){return _asn(o,p,o&&o[p]+v);}function _sub(o,p,v){return _asn(o,p,o&&o[p]-v);}function _div(o,p,v){return _asn(o,p,o&&o[p]/v);}function _mul(o,p,v){return _asn(o,p,o&&o[p]*v);}function _local(n){if(n&&n.charAt&&n.charAt(0)=="<"){return apf.getXmlDom(n).documentElement;}return n;}function _tagName(n1,n2){return(n2&&n2.tagName)||(n1&&n1.tagName);}function _localName(n1,n2){return(n2&&n2[apf.TAGNAME])||(n1&&n1[apf.TAGNAME]);}function _nodeValue(n,n2){if(n2){n=n2;}return(n=(n.nodeType!=1&&n||(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||"";}var langrx=/(\\*)\$\[(.*?)\]/g;var lang=apf.language;apf.$lm_has_lang=0;function _lngrx(tok,esc,x){apf.$lm_has_lang=1;if(esc){return"$["+x+"]";}return lang.words[x]||("");}function __ret(r){if(r&&r.indexOf&&r.indexOf("$[")!=-1){return r.replace(langrx,_lngrx);}return r;}function __lng(x,x2){apf.$lm_has_lang=1;return lang.words[x]||("");}function _lnged(x,x2){apf.$lm_has_lang=1;return lang.words[x]||("");}function _injself(s){return s.charAt?s.replace(selfrx,"$1self::"):s;}apf.$lmx=null;function _async(_n,_c,_a,_w,_f,_this,obj,func,args){var i=_a.i,v;if(!_a.ret){_a.ret=[];}if(_a[i]){return _a.ret[i];}_a[i]=true;if(!obj.exec){return _a.ret[i]=(func)?obj[func].apply(obj,args):obj.apply(obj,args);}if(_w&&_w._pc){_w._pc={obj:obj,func:func,args:args,_c:_c};}else{obj.exec(func,args,function(data,state,extra){if(state!=apf.SUCCESS){_c(null,state,extra);}else{apf.$lmx=extra;_a.ret[i]=data;if(_w){_f.call(_this,_n,_c,_w,_a);}else{_f.call(_this,_n,_c,_a);}}});}throw ({x:1});}function _pc(_w){var o;if(typeof(o=_w._pc)!="object"||!o){return;}o.obj.exec(o.func,o.args,o._c);throw ({x:1});}this.compile=function(code){var _ret=__ret,_val=__val,_valm=__valm,_nod=__nod,_nodm=__nodm,_cnt=__cnt,_cntm=__cntm,_lng=__lng;eval(code);return _f;};})();apf.url=function(n){var j;if(n.indexOf(":")==-1&&(j=location.toString()).indexOf(":")!=-1){j=new apf.url(j);n=apf.getAbsolutePath(j.protocol+"://"+j.host+"/"+(j.directory.charAt(j.directory.length-1)=="/"?j.directory:j.directory+"/"),n).replace(/\/\/\/\//,"///");}var l=apf.url.options,c=l.parser[l.strictMode?"strict":"loose"].exec(n),d=14;this.uri=n.toString();while(d--){this[l.key[d]]=c[d]||"";}this[l.q.name]={};var a=this;this[l.key[12]].replace(l.q.parser,function(m,i,o){if(i){a[l.q.name][i]=o;}});this.isSameLocation=function(){if(this.uri.length&&this.uri.charAt(0)=="#"){return false;}if(!this.protocol&&!this.port&&!this.host){return true;}if(!this.protocol&&this.host&&this.port&&window.location.hostname==this.host&&window.location.port==this.port){return true;}if(!this.protocol&&this.host&&!this.port&&window.location.hostname==this.host&&window.location.port==80){return true;}return window.location.protocol==(this.protocol+":")&&window.location.hostname==this.host&&(window.location.port==this.port||!window.location.port&&!this.port);};};apf.url.options={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};apf.runXpath=function(){apf.XPath={cache:{},getSelf:function(htmlNode,tagName,info,count,num,sResult){var numfound=0,result=null,data=info[count];if(data){data[0](htmlNode,data[1],info,count+1,numfound++,sResult);}else{sResult.push(htmlNode);}},getChildNode:function(htmlNode,tagName,info,count,num,sResult){var numfound=0,result=null,data=info[count];var nodes=htmlNode.childNodes;if(!nodes){return;}for(var i=0;i<nodes.length;i++){if(tagName&&(tagName!=nodes[i].tagName)&&(nodes[i].style?nodes[i].tagName.toLowerCase():nodes[i].tagName)!=tagName){continue;}htmlNode=nodes[i];if(data){data[0](nodes[i],data[1],info,count+1,numfound++,sResult);}else{sResult.push(nodes[i]);}}},doQuery:function(htmlNode,qData,info,count,num,sResult){var result=null,data=info[count];var query=qData[0];var returnResult=qData[1];try{var qResult=eval(query);}catch(e){return;}if(returnResult){return sResult.push(qResult);}if(!qResult||qResult.dataType==apf.ARRAY&&!qResult.length){return;}if(data){data[0](htmlNode,data[1],info,count+1,0,sResult);}else{sResult.push(htmlNode);}},getTextNode:function(htmlNode,empty,info,count,num,sResult){var data=info[count],nodes=htmlNode.childNodes;for(var i=0;i<nodes.length;i++){if(nodes[i].nodeType!=3&&nodes[i].nodeType!=4){continue;}if(data){data[0](nodes[i],data[1],info,count+1,i,sResult);}else{sResult.push(nodes[i]);}}},getAnyNode:function(htmlNode,empty,info,count,num,sResult){var data=info[count],nodes=htmlNode.getElementsByTagName("*");for(var i=0;i<nodes.length;i++){if(data){data[0](nodes[i],data[1],info,count+1,i,sResult);}else{sResult.push(nodes[i]);}}},getAttributeNode:function(htmlNode,attrName,info,count,num,sResult){if(!htmlNode||htmlNode.nodeType!=1){return;}if(attrName=="*"){var nodes=htmlNode.attributes;for(var i=0;i<nodes.length;i++){arguments.callee.call(this,htmlNode,nodes[i].nodeName,info,count,i,sResult);}return;}var data=info[count],value=htmlNode.getAttributeNode(attrName);if(data){data[0](value,data[1],info,count+1,0,sResult);}else{if(value){sResult.push(value);}}},getAllNodes:function(htmlNode,x,info,count,num,sResult){var data=info[count],tagName=x[0],inclSelf=x[1],prefix=x[2],nodes,i,l;if(inclSelf&&(htmlNode.tagName==tagName||tagName=="*")){if(data){data[0](htmlNode,data[1],info,count+1,0,sResult);}else{sResult.push(htmlNode);}}if(tagName=="node()"){tagName="*";prefix="";if(apf.isIE){nodes=htmlNode.getElementsByTagName("*");}else{nodes=[];(function recur(x){for(var n,i=0;i<x.childNodes.length;i++){n=x.childNodes[i];if(n.nodeType!=1){continue;}nodes.push(n);recur(n);}})(htmlNode);}}else{nodes=htmlNode.getElementsByTagName((prefix&&(apf.isGecko||apf.isOpera||htmlNode.nodeFunc)?prefix+":":"")+tagName);}for(i=0,l=nodes.length;i<l;i++){if(data){data[0](nodes[i],data[1],info,count+1,i,sResult);}else{sResult.push(nodes[i]);}}},getAllAncestorNodes:function(htmlNode,x,info,count,num,sResult){var data=info[count],tagName=x[0],inclSelf=x[1],i=0,s=inclSelf?htmlNode:htmlNode.parentNode;while(s&&s.nodeType==1){if(s.tagName==tagName||tagName=="*"||tagName=="node()"){if(data){data[0](s,data[1],info,count+1,++i,sResult);}else{sResult.push(s);}}s=s.parentNode;}},getParentNode:function(htmlNode,empty,info,count,num,sResult){var data=info[count],node=htmlNode.parentNode;if(data){data[0](node,data[1],info,count+1,0,sResult);}else{if(node){sResult.push(node);}}},getPrecedingSibling:function(htmlNode,tagName,info,count,num,sResult){var data=info[count],node=htmlNode.previousSibling;while(node){if(tagName!="node()"&&(node.style?node.tagName.toLowerCase():node.tagName)!=tagName){node=node.previousSibling;continue;}if(data){data[0](node,data[1],info,count+1,0,sResult);}else{if(node){sResult.push(node);break;}}}},getFollowingSibling:function(htmlNode,tagName,info,count,num,sResult){var result=null,data=info[count];var node=htmlNode.nextSibling;while(node){if(tagName!="node()"&&(node.style?node.tagName.toLowerCase():node.tagName)!=tagName){node=node.nextSibling;continue;}if(data){data[0](node,data[1],info,count+1,0,sResult);}else{if(node){sResult.push(node);break;}}}},multiXpaths:function(contextNode,list,info,count,num,sResult){for(var i=0;i<list.length;i++){info=list[i][0];var rootNode=(info[3]?contextNode.ownerDocument.documentElement:contextNode);info[0](rootNode,info[1],list[i],1,0,sResult);}sResult.makeUnique();},compile:function(sExpr){var isAbsolute=sExpr.match(/^\//);sExpr=sExpr.replace(/\[(\d+)\]/g,"/##$1").replace(/\|\|(\d+)\|\|\d+/g,"##$1").replace(/\.\|\|\d+/g,".").replace(/\[([^\]]*)\]/g,function(match,m1){return"/##"+m1.replace(/\|/g,"_@_");});if(sExpr=="/"||sExpr=="."){return sExpr;}return this.processXpath(sExpr.replace(/\/\//g,"descendant::"),isAbsolute);},processXpath:function(sExpr,isAbsolute){var results=[],i,l,m,query;sExpr=sExpr.replace(/'[^']*'/g,function(m){return m.replace("|","_@_");});sExpr=sExpr.split("|");for(i=0,l=sExpr.length;i<l;i++){sExpr[i]=sExpr[i].replace(/_\@\_/g,"|");}if(sExpr.length==1){sExpr=sExpr[0];}else{for(i=0,l=sExpr.length;i<l;i++){sExpr[i]=this.processXpath(sExpr[i]);}results.push([this.multiXpaths,sExpr]);return results;}var sections=sExpr.split("/");for(i=0,l=sections.length;i<l;i++){if(sections[i]=="."||sections[i]==""){continue;}else{if(sections[i]==".."){results.push([this.getParentNode,null]);}else{if(sections[i].match(/^[\w-_\.]+(?:\:[\w-_\.]+){0,1}$/)){results.push([this.getChildNode,sections[i]]);}else{if(sections[i].match(/^\#\#(\d+)$/)){results.push([this.doQuery,["num+1 == "+parseInt(RegExp.$1)]]);}else{if(sections[i].match(/^\#\#(.*)$/)){query=RegExp.$1;m=[query.match(/\(/g),query.match(/\)/g)];if(m[0]||m[1]){while(!m[0]&&m[1]||m[0]&&!m[1]||m[0].length!=m[1].length){if(!sections[++i]){break;}query+="/"+sections[i];m=[query.match(/\(/g),query.match(/\)/g)];}}results.push([this.doQuery,[this.compileQuery(query)]]);}else{if(sections[i]=="*"){results.push([this.getChildNode,null]);}else{if(sections[i].substr(0,2)=="[]"){results.push([this.getAllNodes,["*",false]]);}else{if(sections[i].match(/descendant-or-self::node\(\)$/)){results.push([this.getAllNodes,["*",true]]);}else{if(sections[i].match(/descendant-or-self::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllNodes,[RegExp.$2||RegExp.$1,true,RegExp.$1]]);}else{if(sections[i].match(/descendant::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllNodes,[RegExp.$2||RegExp.$1,false,RegExp.$1]]);}else{if(sections[i].match(/ancestor-or-self::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllAncestorNodes,[RegExp.$2||RegExp.$1,true,RegExp.$1]]);}else{if(sections[i].match(/ancestor::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllAncestorNodes,[RegExp.$2||RegExp.$1,false,RegExp.$1]]);}else{if(sections[i].match(/^\@(.*)$/)){results.push([this.getAttributeNode,RegExp.$1]);}else{if(sections[i]=="text()"){results.push([this.getTextNode,null]);}else{if(sections[i]=="node()"){results.push([this.getChildNode,null]);}else{if(sections[i].match(/following-sibling::(.*)$/)){results.push([this.getFollowingSibling,RegExp.$1.toLowerCase()]);}else{if(sections[i].match(/preceding-sibling::(.*)$/)){results.push([this.getPrecedingSibling,RegExp.$1.toLowerCase()]);}else{if(sections[i]=="self::node()"){results.push([this.getSelf,null]);}else{if(sections[i].match(/self::(.*)$/)){results.push([this.doQuery,["apf.XPath.doXpathFunc(htmlNode, 'local-name') == '"+RegExp.$1+"'"]]);}else{query=sections[i];m=[query.match(/\(/g),query.match(/\)/g)];if(m[0]||m[1]){while(!m[0]&&m[1]||m[0]&&!m[1]||m[0].length!=m[1].length){if(!sections[++i]){break;}query+="/"+sections[i];m=[query.match(/\(/g),query.match(/\)/g)];}}results.push([this.doQuery,[this.compileQuery(query),true]]);}}}}}}}}}}}}}}}}}}}}results[0][3]=isAbsolute;return results;},compileQuery:function(code){return new apf.CodeCompilation(code).compile();},doXpathFunc:function(contextNode,type,nodelist,arg2,arg3,xmlNode){if(!nodelist||nodelist.length==0){nodelist="";}if(type=="not"){return !nodelist;}var arg1,i,l;if(typeof nodelist=="object"||nodelist.dataType==apf.ARRAY){if(nodelist&&!nodelist.length){nodelist=[nodelist];}var res=false,value;for(i=0,l=nodelist.length;i<l;i++){xmlNode=nodelist[i];if(!xmlNode||typeof xmlNode=="string"){value=xmlNode;}else{if(xmlNode.nodeType==1&&xmlNode.firstChild&&xmlNode.firstChild.nodeType!=1){xmlNode=xmlNode.firstChild;}value=xmlNode.nodeValue;}if(res=arguments.callee.call(this,contextNode,type,value,arg2,arg3,xmlNode)){return res;}}return res;}else{arg1=nodelist;}switch(type){case"position":return apf.getChildNumber(contextNode)+1;case"format-number":return apf.formatNumber(arg1);case"floor":return Math.floor(arg1);case"ceiling":return Math.ceil(arg1);case"starts-with":return arg1?arg1.substr(0,arg2.length)==arg2:false;case"string-length":return arg1?arg1.length:0;case"count":return arg1?arg1.length:0;case"last":return arg1?arg1[arg1.length-1]:null;case"local-name":return(xmlNode?xmlNode.tagName:contextNode.tagName).split(":").pop();case"substring":return arg1&&arg2?arg1.substring(arg2,arg3||0):"";case"contains":return arg1&&arg2?arg1.indexOf(arg2)>-1:false;case"concat":var str="";for(i=1,l=arguments.length;i<l;i++){if(typeof arguments[i]=="object"){str+=getNodeValue(arguments[i][0]);continue;}str+=arguments[i];}return str;case"translate":for(i=0,l=arg2.length;i<l;i++){arg1=arg1.replace(arg2.substr(i,1),arg3.substr(i,1));}return arg1;}},selectNodeExtended:function(sExpr,contextNode,match){var sResult=this.selectNodes(sExpr,contextNode);if(sResult.length==0){return null;}if(!match){return sResult;}for(var i=0,l=sResult.length;i<l;i++){if(getNodeValue(sResult[i])==match){return[sResult[i]];}}return null;},getRoot:function(xmlNode){while(xmlNode.parentNode&&xmlNode.parentNode.nodeType==1){xmlNode=xmlNode.parentNode;}return xmlNode;},selectNodes:function(sExpr,contextNode){if(!this.cache[sExpr]){this.cache[sExpr]=this.compile(sExpr);}if(typeof this.cache[sExpr]=="string"){if(this.cache[sExpr]=="."){return[contextNode];}if(this.cache[sExpr]=="/"){return[(contextNode.nodeType==9?contextNode.documentElement:this.getRoot(contextNode))];}}if(typeof this.cache[sExpr]=="string"&&this.cache[sExpr]=="."){return[contextNode];}var info=this.cache[sExpr][0],rootNode=(info[3]?(contextNode.nodeType==9?contextNode.documentElement:this.getRoot(contextNode)):contextNode),sResult=[];info[0](rootNode,info[1],this.cache[sExpr],1,0,sResult);return sResult;}};function getNodeValue(sResult){if(sResult.nodeType==1){return sResult.firstChild?sResult.firstChild.nodeValue:"";}if(sResult.nodeType>1||sResult.nodeType<5){return sResult.nodeValue;}return sResult;}apf.CodeCompilation=function(code){this.data={F:[],S:[],I:[],X:[]};this.compile=function(){code=code.replace(/ or /g," || ").replace(/ and /g," && ").replace(/!=/g,"{}").replace(/=/g,"==").replace(/\{\}/g,"!=");this.tokenize();this.insert();code=code.replace(/, \)/g,", htmlNode)");return code;};this.tokenize=function(){var data=this.data.F;code=code.replace(/(translate|format-number|contains|substring|local-name|last|position|round|starts-with|string|string-length|sum|floor|ceiling|concat|count|not)\s*\(/g,function(d,match){return(data.push(match)-1)+"F_";});data=this.data.S;code=code.replace(/'([^']*)'/g,function(d,match){return(data.push(match)-1)+"S_";}).replace(/"([^"]*)"/g,function(d,match){return(data.push(match)-1)+"S_";});data=this.data.X;code=code.replace(/(^|\W|\_)([\@\.\/A-Za-z\*][\*\.\@\/\w\-]*(?:\(\)){0,1})/g,function(d,m1,m2){return m1+(data.push(m2)-1)+"X_";}).replace(/(\.[\.\@\/\w]*)/g,function(d,m1,m2){return(data.push(m1)-1)+"X_";});data=this.data.I;code=code.replace(/(\d+)(\W)/g,function(d,m1,m2){return(data.push(m1)-1)+"I_"+m2;});};this.insert=function(){var data=this.data;code=code.replace(/(\d+)X_\s*==\s*(\d+S_)/g,function(d,nr,str){return"apf.XPath.selectNodeExtended('"+data.X[nr].replace(/'/g,"\\'")+"', htmlNode, "+str+")";}).replace(/(\d+)([FISX])_/g,function(d,nr,type){var value=data[type][nr];if(type=="F"){return"apf.XPath.doXpathFunc(htmlNode, '"+value+"', ";}else{if(type=="S"){return"'"+value+"'";}else{if(type=="I"){return value;}else{if(type=="X"){return"apf.XPath.selectNodeExtended('"+value.replace(/'/g,"\\'")+"', htmlNode)";}}}}}).replace(/, \)/g,")");};};};apf.BindingRule=function(c,a){this.$init(a||true,apf.NODE_HIDDEN,c);};(function(){this.$bindingRule=true;this.compile=function(a){return(this["c"+a]=apf.lm.compile(this[a],{xpathmode:3,injectself:true}));};this.$compile=function(c,a){return(this["c"+c+"2"]=apf.lm.compile(this[c],a));};this.$attrExcludePropBind=apf.extend({value:1,match:1},this.$attrExcludePropBind);this.$propHandlers.value=this.$propHandlers.match=function(c,d){delete this["c"+d];if(this.$amlLoaded){var a=this;while(a&&a.$bindingRule){a=a.parentNode;}if(!a){return;}apf.queue.add("reload"+a.$uniqueId,function(){a.reload();});if(a.$bindings.$isCompiled){a.$bindings.$compiled=a.$bindings.compile(this.localName!="each"&&this.localName);}}};this.addEventListener("DOMNodeInserted",function(c){var a=this;while(a.$bindingRule){a=a.parentNode;}apf.queue.add("reload"+a.$uniqueId,function(){a.reload();});if(c.currentTarget==this){(a.$bindings[this.localName]||(a.$bindings[this.localName]=[])).push(this);}else{if(!this.attributes.getNamedItem("value")){this.value=apf.serializeChildren(this);}else{return;}}if(a.$bindings.$isCompiled){a.$bindings.$compiled=a.$bindings.compile(this.localName!="each"&&this.localName);}});this.addEventListener("DOMNodeRemoved",function(c){var d,a=this;while(a&&a.$bindingRule){a=a.parentNode;}if(!a){return;}if(c.currentTarget==this){if(a.$bindings&&a.$bindings[this.localName]){a.$bindings[this.localName].remove(this);}else{return;}}else{if(!this.attributes.getNamedItem("value")&&(d=this.firstChild)){if(d.nodeType==this.NODE_PROCESSING_INSTRUCTION){if(d.target=="lm"){this.value="{"+d.nodeValue+"}";}else{this.value=d.nodeValue;}}else{this.value=apf.serializeChildren(this).trim();}}else{return;}}apf.queue.add("reload"+a.$uniqueId,function(){a.reload();});if(a.$bindings.$isCompiled){a.$bindings.$compiled=a.$bindings.compile(this.localName!="each"&&this.localName);}});this.addEventListener("DOMNodeInsertedIntoDocument",function(d){var i;if(!this.value&&(i=this.$aml&&this.$aml.firstChild||this.firstChild)){if(i.nodeType==this.NODE_PROCESSING_INSTRUCTION){if(i.target=="lm"){this.value="{"+i.nodeValue+"}";}else{this.value=i.nodeValue;}}else{this.value=apf.serializeChildren(this.$aml).trim();}}var a=this.parentNode;while(a.$bindingRule){a=a.parentNode;}var j=a.$bindings||(a.$bindings=new apf.ruleList());(j[this.localName]||(j[this.localName]=[])).push(this);if(a.localName!="bindings"&&(this.localName!="each"||!this.childNodes.length)){var c=this;while((c=c.nextSibling)&&c.nodeType!=1){}if(!c||!c.$bindingRule){a.$cbindings=a.$bindings.compile(a.$bindings.$isCompiled?this.localName:null);a.dispatchEvent("bindingsload",{bindings:a.$bindings,compiled:a.$cbindings});a.$checkLoadQueue();}}});}).call(apf.BindingRule.prototype=new apf.AmlElement());apf.aml.setElement("icon",apf.BindingRule);apf.aml.setElement("image",apf.BindingRule);apf.aml.setElement("caption",apf.BindingRule);apf.aml.setElement("css",apf.BindingRule);apf.aml.setElement("selectable",apf.BindingRule);apf.aml.setElement("value",apf.BindingRule);apf.aml.setElement("src",apf.BindingRule);apf.aml.setElement("collapsed",apf.BindingRule);apf.aml.setElement("empty",apf.BindingRule);apf.toc=function(c,a){this.$init(a||"toc",apf.NODE_VISIBLE,c);};(function(){this.$supportedProperties.push("represent");this.$propHandlers.represent=function(c){var a=this;$setTimeout(function(){var d=a.$represent=self[c];d.addEventListener("afterswitch",function(i){a.$setActivePage(i.nextId);});if(d.$drawn){a.$createReflection();}else{d.$amlLoaders.push(function(){toc.$createReflection();});}});};this.gotoPage=function(l){if(this.disabled){return false;}if(this.$represent.isValid&&!this.$represent.testing){var j,m,d=this.$represent.getPages(),c=this.$represent.activepagenr;for(j=c;j<l;j++){d[j].$ext.style.position="absolute";d[j].$ext.style.top="-10000px";d[j].$ext.style.display="block";m=!this.$represent.isValid||this.$represent.isValid(j<c,j<c,d[j]);d[j].$ext.style.display="";d[j].$ext.style.position="";d[j].$ext.style.top="";d[j].$ext.style.left="";d[j].$ext.style.width="1px";d[j].$ext.style.width="";if(!m){return this.$represent.set(j);}}}if(this.$represent.showLoader){this.$represent.showLoader(true,l);}var a=this;$setTimeout(function(){a.$represent.set(l);},1);};this.$setActivePage=function(l){if(this.disabled){return false;}if(!this.pagelookup[l]){var j,d,m;for(j in this.pagelookup){if(j<l){d=j;}if(j>l){m=true;}}if(!d||!m){return;}l=d;}for(var c=true,a=0;a<this.pages.length;a++){if(this.pagelookup[l]==this.pages[a]){this.$setStyleClass(this.pages[a],"present",["future","past","hover"]);c=false;}else{if(c){this.$setStyleClass(this.pages[a],"past",["future","present",]);}else{this.$setStyleClass(this.pages[a],"future",["past","present"]);}}if(a==this.pages.length-1){this.$setStyleClass(this.pages[a],"last");}}};this.$createReflection=function(){var n,m,q,d={},c=this.$represent.getPages(),a=c.length,o=[];for(n=0;n<a;n++){this.$getNewContext("page");m=this.$getLayoutNode("page","caption");q=this.$getLayoutNode("page");this.$setStyleClass(q,"page"+n);q.setAttribute("onmouseover","apf.lookup("+this.$uniqueId+').$setStyleClass(this, "hover", null);');q.setAttribute("onmouseout","apf.lookup("+this.$uniqueId+').$setStyleClass(this, "", ["hover"]);');if(!c[n].getAttribute("caption")){}else{apf.setNodeValue(m,c[n].getAttribute("caption")||"");}q.setAttribute("onmousedown","setTimeout(function(){                    apf.lookup("+this.$uniqueId+").gotoPage("+n+");                });");o.push(apf.insertHtmlNode(q,this.$int));d[n]=o[o.length-1];}this.pages=o;this.pagelookup=d;this.$setActivePage(0);if(apf.isGecko){var j=this;$setTimeout(function(){j.$ext.style.height=j.$ext.offsetHeight+1+"px";j.$ext.style.height=j.$ext.offsetHeight-1+"px";},10);}};this.$draw=function(){this.$ext=this.$getExternal();this.oCaption=this.$getLayoutNode("main","caption",this.$ext);this.$int=this.$getLayoutNode("main","container",this.$ext);};}).call(apf.toc.prototype=new apf.Presentation());apf.aml.setElement("toc",apf.toc);apf.portal=function(c,a){this.$init(a||"portal",apf.NODE_VISIBLE,c);this.$columns=[];};(function(){this.implement(apf.DataAction);this.$focussable=false;this.buttons="edit|min|close";this.$deInitNode=function(n,o){l.call(this,apf.findHost(o));};this.$updateNode=function(o,q){var n=apf.findHost(q);n.setProperty("buttons",this.$applyBindRule("buttons",o)||"");n.draggable=this.$applyBindRule("draggable",o);};this.$moveNode=function(n,o){if(!o){return;}};this.select=function(){};this.findColumnNr=function(n,q){var o=document.elementFromPoint(n,q);while(!o.isColumn&&o.parentNode){o=o.parentNode;}return o.isColumn&&this.$columns.indexOf(o)||0;};this.$moveDocklet=function(n){var q=this.$columns.indexOf(n.$ext.parentNode)||0;var s=n.dataNode;s.setAttribute("column",q);var t=apf.xmldb.getChildNumber(n.oExt),o=s.selectNodes("../node()[@column='"+q+"']");if(o[t]!=s){var u=apf.findHost(n.oExt.nextSibling);s.parentNode.insertBefore(s,u&&u.dataNode||null);}this.dispatchEvent("widgetmove");};this.columns="33.33%,33.33%,33.33%";this.$columnWidths=this.columns.splitSafe(",");this.$propHandlers.columns=function(z){if(!z){return;}this.$columnWidths=z.splitSafe(",");var q,o,n,t,s;while(this.$columns.length>this.$columnWidths.length){q=this.$columns.pop();q.host=null;o=q.childNodes;n=this.$columns[0];for(var u=o.length-1;u>=0;u--){if((s=o[u]).nodeType!=1){continue;}n.appendChild(s);t=apf.findHost(s);t.$pHtmlNode=n;t.dataNode.setAttribute("column",0);}apf.destroyHtmlNode(q);}for(var A,q,B,u=0;u<this.$columnWidths.length;u++){B=this.$columnWidths[u];if(!this.$columns[u]){this.$getNewContext("column");q=apf.insertHtmlNode(this.$getLayoutNode("column"),this.$int,this.$int.lastChild);this.$columns.push(q);q.isColumn=true;q.host=this;}else{q=this.$columns[u];this.oInt.insertBefore(q,this.oInt.lastChild);}this.$setStyleClass(q,(A=(u==this.$columnWidths.length-1))?"collast":"",["collast"]);B.match(/(%|px|pt)/);var w=RegExp.$1||"px";q.style.width=(parseInt(B)-(apf.isIE&&apf.isIE<8&&A?1:0))+w;}};this.addEventListener("keydown",function(s){var o=s.keyCode;var t=s.ctrlKey;var n=s.shiftKey;var q=s.altKey;if(!this.selected){return;}switch(o){default:break;}},true);function l(n){var w=n.$srcUrl;if(!w){throw new Error("Something went terribly wrong");}if(n.$dockletClass.$unload){n.$dockletClass.$unload();}var u=[],s,t=m[w];if(n.oSettings){var o=n.oSettings.childNodes;while(o.length){s=apf.findHost(t.fragSettings.appendChild(o[0]));if(s){u.push(s.removeNode(null,true));}}}var o=n.$int.childNodes;while(o.length){s=apf.findHost(t.fragInt.appendChild(o[0]));if(s){u.push(s.removeNode(null,true));}}var o=n.childNodes;for(var q=o.length-1;q>=0;q--){u.push(o[q].removeNode(null,true));}t.amlNodes=u;n.oSettings=n.$int=null;n.childNodes=[];j.push(n);n.parentNode=null;n.$ext.parentNode.removeChild(n.$ext);return w;}this.$getCurrentFragment=function(){var o,t,s=[];for(var u=0,n=this.$columns.length;u<n;u++){t=this.$columns[u];for(var q=t.childNodes.length-1;q>=0;q--){if(t.childNodes[q].nodeType!=1){continue;}s.push(l.call(this,apf.findHost(t.childNodes[q])));}}return s;};this.$setCurrentFragment=function(t){var s,z,w,n,q=this.getTraverseNodes();for(var u=0,o=q.length;u<o;u++){s=q[u];z=this.$columns[this.$applyBindRule("column",s)||0];w=this.$applyBindRule("src",s)||"file:"+this.$applyBindRule("url",s);n=i.call(this,s,z);d.call(this,w,null,n,s);}};var c;this.$setClearMessage=function(q){if(!c){if(!this.$hasLayoutNode("empty")){return;}this.$getNewContext("empty");var n=this.$getLayoutNode("empty");if(!n){return;}c=apf.insertHtmlNode(n,this.$int);}else{this.$int.appendChild(c);}var o=this.$getLayoutNode("empty","caption",c);if(o){apf.setNodeValue(o,q||"");}if(c){c.setAttribute("id","empty"+this.$uniqueId);}};this.$removeClearMessage=function(){var n=document.getElementById("empty"+this.$uniqueId);if(n){n.parentNode.removeChild(n);}};var m={};function d(z,E,F,s){var w;while(w=m[z]){if(!w.fragInt.childNodes.length){z+="_";}else{break;}}if(!w&&!E){z="error";w=m.error;}F.$getLayoutNode("main","container",F.$ext).innerHTML="";F.$srcUrl=z;if(w){var D=w.xmlNode;if(D.getAttribute("width")){F.setProperty("width",D.getAttribute("width"));}else{F.$ext.style.width="auto";}F.oSettings=F.$getLayoutNode("main","settings_content",F.$ext);F.$int=F.$getLayoutNode("main","container",F.$ext);F.$int.appendChild(w.fragInt);if(F.oSettings){F.oSettings.appendChild(w.fragSettings);}var C=w.amlNodes||[];for(var u=0,q=C.length;u<q;u++){if(C[u].hasFeature){F.appendChild(C[u],null,true);}}F.$dockletClass=w.dockletClass;if(w.dockletClass.load){w.dockletClass.load(s,F);}}else{var A=apf.all.length;var o=[];E=E.replace(/\b(id|actiontracker|group)="([^"]*)"|\b(id|actiontracker|group)='([^']*)''/g,function(G,M,K,J,I){var N=K||I;o.push(N);if(K){return M+'="'+N+"_"+A+'"';}if(I){return J+"='"+N+"_"+A+"'";}});if(o.length){E=E.replace(new RegExp("\\b("+o.join("|")+")\\b","g"),function(G,I){return I+"_"+A;});}var B=this.ownerDocument.$domParser.parseFromString(E,"text/xml",{docFrag:F,doc:F.ownerDocument,htmlNode:F.$int}).firstChild;var n=B.name;if(B.width){F.setProperty("width",B.width);}else{F.$ext.style.width="auto";}if(!self[n]){throw new Error("could not find docklet class '"+n+"'");}var t=new self[n]().$init();this.docklets.push(t);t.create(s,F,this);if(t.load){t.load(s,F);}F.$dockletClass=t;m[z]={srcUrl:z,xmlNode:B.$aml,fragInt:document.createDocumentFragment(),fragSettings:document.createDocumentFragment(),dockletClass:t};}F.$refParent=this.$int;}var j=[];function i(o,t){var n;var q=this.$applyBindRule("columns",this.xmlRoot);if(q!=this.columns){this.setProperty("columns",q);t=this.$columns[this.$applyBindRule("column",o)||0];}if(n=j.pop()){n.parentNode=this;t.appendChild(n.$ext);n.$pHtmlNode=t;var s=this.$applyBindRule("dockskin",o)||"docklet";if(n.skin!=s){n.$forceSkinChange(n.skin=s);}n.show();}else{n=new apf.modalwindow({htmlNode:t,skinset:apf.getInheritedAttribute(this.parentNode,"skinset"),skin:this.$applyBindRule("dockskin",o)||"docklet",draggable:true,visible:true});n.implement(apf.modalwindow.widget);n.parentNode=this;n.$create();n.addEventListener("beforestatechange",function(u){if(u.to.maximized){n.$ext.parentNode.style.zIndex=100000;}return this.$dockletClass.dispatchEvent("beforestatechange",u);});n.addEventListener("afterstatechange",function(u){if(u.from.maximized){n.$ext.parentNode.style.zIndex=1;}this.$dockletClass.dispatchEvent("afterstatechange",u);if(u.to.closed){this.remove(this.dataNode);}});}n.dataNode=o;apf.xmldb.nodeConnect(apf.xmldb.getXmlDocId(o),o,n.$ext,this);if(this.$hasBindRule("buttons")){n.setProperty("buttons",this.$applyBindRule("buttons",o)||this.buttons);}n.setProperty("state",this.$applyBindRule("state",o)||"normal");n.setProperty("title",this.$applyBindRule("caption",o));n.setProperty("icon",this.$applyBindRule("icon",o));n.show();return n;}this.$clear=function(){};this.docklets=[];var a={};this.$add=function(o,t,z,C,A){var n=this.$columns[this.$applyBindRule("column",o)||0];var s=this.$applyBindRule("src",o)||"file:"+this.$applyBindRule("url",o);if(!n){var w=this.$applyBindRule("columns",this.xmlRoot);if(w&&w!=this.columns){this.setProperty("columns",w);}n=this.$columns[this.$applyBindRule("column",o)||0];if(!n){throw new Error(apf.formatErrorString(0,this,"Building docklet","Cannot find column to hook docklet on. Seems like a timing error"));}}var D=i.call(this,o,n);if(a[s]){var B=a[s];d.call(this,s,B,D,o);}else{D.$getLayoutNode("main","container",D.$ext).innerHTML="<div class='loading'>Loading...</div>";var q=new apf.model(),u=this;q.$loadFrom(s,{callback:function(G,F,E){if(!G||F!=apf.SUCCESS){d.call(u,"error","<a:docklet xmlns:a='"+apf.ns.apf+"' name='dockerror'>                        <a:script><![CDATA[                            function dockerror(){                                this.init = this.load = function(x,d){                                    d.setAttribute('buttons', '');                                    d.setAttribute('icon', '');                                    d.setAttribute('title', 'Error')                                }                            }                        ]]></a:script>                        <a:body>                            <a:label style='margin:0 auto 0 auto'>Error loading this widget</a:label>                        </a:body>                    </a:docklet>",D,o);return true;}var I=G;if(apf.isSafariOld){I=I.replace(/name/,"name='"+xmlNode.getAttribute("name")+"'");a[s]=I;}else{a[s]=I;}d.call(u,s,I,D,o);this.isLoaded=true;}});}};this.$fill=function(){};this.addEventListener("beforeload",function(o){if(!this.$columns.length){var n=this.$applyBindRule("columns",o.xmlNode);if(n&&n!=this.columns){this.setProperty("columns",n);}}});this.addEventListener("xmlupdate",function(o){var n=this.$applyBindRule("columns",this.xmlRoot);if(n&&n!=this.columns){this.setProperty("columns",n);}});this.$selectDefault=function(q){if(this.select(this.getFirstTraverseNode(q),null,null,null,true)){return true;}else{var n=this.getTraverseNodes(q);for(var o=0;o<n.length;o++){if(this.$selectDefault(n[o])){return true;}}}};this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);};this.$loadAml=function(n){if(document.elementFromPointAdd){document.elementFromPointAdd(this.$ext);}};}).call(apf.portal.prototype=new apf.MultiSelect());apf.aml.setElement("portal",apf.portal);apf.aml.setElement("src",apf.BindingRule);apf.aml.setElement("column",apf.BindingRule);apf.aml.setElement("draggable",apf.BindingRule);apf.aml.setElement("dockskin",apf.BindingRule);apf.aml.setElement("buttons",apf.BindingRule);apf.aml.setElement("caption",apf.BindingRule);apf.aml.setElement("traverse",apf.BindingRule);apf.portal.Docklet=function(){};apf.portal.Docklet.prototype=new apf.Class();apf.portal.Docklet.prototype.create=function(d,a,c){this.xmlSettings=d;this.oWidget=a;if(this.$create){this.$create(d,a,c);}};apf.audio=function(c,a){this.$init(a||"audio",apf.NODE_VISIBLE,c);};(function(){this.$supportedProperties.push("waveform","peak","EQ","ID3");this.$mainBind="src";this.loadMedia=function(){if(!this.player){return this;}this.setProperty("currentSrc",this.src);this.setProperty("networkState",apf.Media.NETWORK_LOADING);this.player.load(this.src);return this;};this.seek=function(a){if(this.player&&a>=0&&a<=this.duration){this.player.seek(a);}};this.setVolume=function(a){if(this.player){this.player.setVolume(a);}};this.$guessType=function(d){var c=d.substr(d.lastIndexOf(".")+1),a="";if(apf.hasAudio&&((c=="ogg"||c=="wav")||(c=="mp3"&&apf.isWebkit))){a="audio/ogg";}else{if(c=="mp3"){a="audio/flash";}}return a;};this.$getPlayerType=function(m){if(!m){return null;}var j=null;var d=m.splitSafe(",");if(d.length==1){d=d[0].splitSafe(";");}for(var c=0,a=d.length;c<a;c++){if(m.indexOf("ogg")>-1){j="TypeNative";}if(m.indexOf("flash")>-1){j="TypeFlash";}else{if(m.indexOf("quicktime")>-1){j="TypeQT";}else{if(m.indexOf("wmv")>-1){j=apf.isMac?"TypeQT":"TypeWmp";}else{if(m.indexOf("silverlight")>-1){j="TypeSilverlight";}}}}if(this.$isSupported(j)){return j;}}return j;};this.$isSupported=function(a){a=a||this.playerType;return(apf.audio[a]&&apf.audio[a].isSupported());};this.$initPlayer=function(){this.player=new apf.audio[this.playerType](this,this.$ext,{src:this.src,width:this.width,height:this.height,autoLoad:true,autoPlay:this.autoplay,showControls:this.controls,volume:this.volume,mimeType:this.type});return this;};this.$initHook=function(a){if(a.error){var c=this.MediaError(a.error);if(this.dispatchEvent("error",{error:c,bubbles:true})===false){throw c;}}this.loadMedia();};this.$cuePointHook=function(){};this.$playheadUpdateHook=function(){};this.$errorHook=function(a){apf.console.log("Error: <audio>");apf.console.error(a.error);};this.$progressHook=function(c){this.setProperty("bufferedBytes",{start:0,end:c.bytesLoaded,length:c.bytesLoaded});this.setProperty("totalBytes",c.totalBytes);var a=Math.abs(c.bytesLoaded-c.totalBytes);if(a<=20){this.setProperty("readyState",apf.Media.HAVE_ENOUGH_DATA);}};this.$stateChangeHook=function(a){if(a.state=="connectionError"){this.networkState=apf.Media.HAVE_NOTHING;this.$propHandlers.readyState.call(this,this.networkState);}};this.$changeHook=function(a){if(typeof a.volume!="undefined"){this.volume=a.volume;this.muted=(a.volume>0);this.setProperty("volume",a.volume);}else{this.duration=this.player.getTotalTime();this.position=a.playheadTime/this.duration;if(isNaN(this.position)){return;}this.setProperty("position",this.position);this.currentTime=a.playheadTime;this.setProperty("currentTime",this.currentTime);}};this.$completeHook=function(a){this.paused=true;this.setProperty("paused",true);};this.$readyHook=function(a){this.setProperty("networkState",apf.Media.NETWORK_LOADED);this.setProperty("readyState",apf.Media.HAVE_FUTURE_DATA);this.setProperty("duration",this.player.getTotalTime());this.seeking=false;this.seekable=true;this.setProperty("seeking",false);if(this.autoplay){this.play();}return this;};this.$metadataHook=function(a){this.oVideo.setProperty("readyState",apf.Media.HAVE_METADATA);if(a.waveData){this.setProperty("waveform",a.waveData);}if(a.peakData){this.setProperty("peak",a.peakData);}if(a.eqData){this.setProperty("EQ",a.eqData);}if(a.id3Data){this.setProperty("ID3",a.id3Data);}};this.$draw=function(){this.$ext=this.$pHtmlNode.appendChild(document.createElement("div"));this.$ext.className="apf_audio "+(this.getAttributeNode("class")||"");this.$int=this.$ext;};this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(this.setSource()){this.$propHandlers.type.call(this,this.type);}});this.$destroy=function(a){if(this.player&&this.player.$detroy){this.player.$destroy();}delete this.player;this.player=null;if(a){this.$ext.innerHTML="";}};}).call(apf.audio.prototype=new apf.Media());apf.aml.setElement("audio",apf.audio);apf.audio.TypeInterface={properties:["src","volume","showControls","autoPlay","totalTime","mimeType"],setOptions:function(a){if(a==null){return this;}var d=this.properties;for(var c=0;c<d.length;c++){var j=d[c];if(a[j]==null){continue;}this[j]=a[j];}return this;},getElement:function(a){return apf.flash.getElement(a);}};apf.ActionRule=function(c,a){this.$init(a||true,apf.NODE_HIDDEN,c);};(function(){this.$actionRule=true;this.compile=function(c,a){return(this["c"+c]=apf.lm.compile(this[c],a||{xpathmode:2}));};this.$attrExcludePropBind=apf.extend({set:1,get:1,undo:1,lock:1,match:1,parent:1},this.$attrExcludePropBind);this.$propHandlers.set=this.$propHandlers.get=this.$propHandlers.parent=this.$propHandlers.match=function(a,c){delete this["c"+c];};this.addEventListener("DOMNodeInserted",function(c){if(c.currentTarget==this){var a=this.parentNode;if(!a.$actions){a.$actions=new apf.ruleList();}(a.$actions[this.localName]||(a.$actions[this.localName]=[])).push(this);}else{if(this.attributes.getNamedItem("value")){return;}this.value=apf.serializeChildren(this);}});this.addEventListener("DOMNodeRemoved",function(a){if(a.currentTarget==this){this.parentNode.$actions[this.localName].remove(this);}else{if(this.attributes.getNamedItem("value")){return;}this.value=apf.serializeChildren(this);}});this.addEventListener("DOMNodeInsertedIntoDocument",function(a){if(!this.get){this.get=apf.serializeChildren(this.$aml).trim();}var c=this.parentNode.$actions||(this.parentNode.$actions=new apf.ruleList());(c[this.localName]||(c[this.localName]=[])).push(this);});}).call(apf.ActionRule.prototype=new apf.AmlElement());apf.aml.setElement("rename",apf.ActionRule);apf.aml.setElement("remove",apf.ActionRule);apf.aml.setElement("add",apf.ActionRule);apf.aml.setElement("update",apf.ActionRule);apf.aml.setElement("copy",apf.ActionRule);apf.aml.setElement("move",apf.ActionRule);apf.flowchart=function(c,a){this.$init(a||"flowchart",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction,apf.Cache,apf.MultiSelect,apf.Rename);this.objCanvas=null;this.nodes=[];this.snap=false;this.gridW=48;this.gridH=48;this.$flowVars={lastBlockId:0,template:null,resizeManager:null,xmlBlocks:{},objBlocks:{},xmlConnections:{},connToPaint:[]};this.$init(function(){var a=this;var d=function(o){o=(o||event);var u=o.keyCode,j=o.ctrlKey,q=o.shiftKey,m=this.getSelection(),s=this.snap?((u==37||u==39?this.gridW:(u==38||u==40?this.gridH:0))*(j?2:(q?3:1))):(j?10:(q?100:1)),n=a.objCanvas.disableremove;if(!m||n){return;}switch(u){case 37:this.moveTo(m,-s,0);break;case 38:this.moveTo(m,0,-s);break;case 39:this.moveTo(m,s,0);break;case 40:this.moveTo(m,0,s);break;case 46:a.$flowVars.resizeManager.hide();switch(a.objCanvas.mode){case"normal":this.removeBlocks(m);break;case"connection-change":var t=[],l=a.objCanvas.htmlConnectors;for(var i in l){if(l[i].selected){t.push(l[i].other.xmlNode);l[i].destroy();}}a.removeConnectors(t);a.objCanvas.mode="normal";break;}break;}return false;};this.addEventListener("keydown",d,true);apf.addEventListener("contextmenu",function(){return false;});function c(){a.objCanvas.disableremove=false;}this.addEventListener("afterrename",c);this.addEventListener("stoprename",c);});this.$propHandlers.snap=function(c){var a=parseInt(c)>0?true:false;this.snap=this.objCanvas.snap=c=="true"||a?true:false;if(a){this.gridW=this.objCanvas.gridW=parseInt(c);this.gridH=this.objCanvas.gridH=parseInt(c);}};this.$propHandlers["grid-width"]=function(a){this.gridW=this.objCanvas.gridW=parseInt(a);};this.$propHandlers["grid-height"]=function(a){this.gridH=this.objCanvas.gridH=parseInt(a);};this.$getCaptionElement=function(){var a=this.$flowVars.objBlocks[this.$applyBindRule("id",this.selected)];if(!a){return;}return a.caption;};this.$beforeRename=function(i){i=i||event;var d=i.srcElement||i.target;this.$selectCaption(d);this.objCanvas.disableremove=true;this.$deselectCaption(d);this.startRename();var a=this.$pHtmlDoc.getElementById("txt_rename");this.$setStyleClass(a,d.className);var j=a;if((d.className||"").indexOf("inside")!=-1){if(j.offsetHeight!==0){j.style.marginTop="-"+(Math.ceil(j.offsetHeight/2))+"px";}}return false;};this.$selectCaption=function(a){if(!a||a.nodeType!=1){return;}this.$setStyleClass(a,"selected");};this.$deselectCaption=function(a){if(!a||a.nodeType!=1){return;}this.$setStyleClass(a,"",["selected"]);};this.$select=function(c){if(!c){return;}var a=apf.flow.isBlock(c);if(a){if(this.$flowVars.resizeManager){var d=a.other;if(d.lock==1){return;}this.$flowVars.resizeManager.grab(c,{scalex:d.scalex,scaley:d.scaley,scaleratio:d.scaleratio,dwidth:d.dwidth,dheight:d.dheight,ratio:d.ratio,snap:this.snap,gridH:this.gridH,gridW:this.gridW});}this.$setStyleClass(c,"selected");if(a.other.capPos!=="inside"){this.$selectCaption(a.caption);}}};this.$deselect=function(c){if(!c){return;}this.$setStyleClass(c,"",["selected"]);var a=apf.flow.isBlock(c);if(!a){return;}this.$deselectCaption(a.caption);this.$flowVars.resizeManager.hide();};this.moveTo=function(t,s,c){if(!t){return;}if(!t.length){t=[t];}var w=[],a=["top","left"],d,z,q,n,o;for(q=0,n=t.length;q<n;q++){for(o=0;o<a.length;o++){d=this.$getDataNode(a[o],t[q],this.$createModel);z=(a[o]=="left"?s:c)+(parseInt(this.$applyBindRule(a[o],t[q]))||0);if(this.snap){var m=a[o]=="top"?this.gridH:this.gridW;z=Math.round(z/m)*m;}if(d){var A=d.nodeType==1||d.nodeType==3||d.nodeType==4?"setTextNode":"setAttribute";var u=d.nodeType==1?[d,z]:(d.nodeType==3||d.nodeType==4?[d.parentNode,z]:[d.ownerElement||d.selectSingleNode(".."),d.nodeName,z]);w.push({func:A,args:u});}}}this.$executeAction("multicall",w,"moveTo",t);};this.setZindex=function(a,c){this.$executeSingleValue("setzindex","zindex",a,c);};this.setMode=function(a){this.objCanvas.setMode(a);};this.getMode=function(){return this.objCanvas.getMode();};this.setLock=function(a,c){this.$executeSingleValue("setlock","lock",a,String(c));};this.rotate=function(m,o){var j=this.$applyBindRule("flipv",m)=="true"?true:false,a=this.$applyBindRule("fliph",m)=="true"?true:false,d=parseInt(this.$applyBindRule("rotation",m))||0,i=["fliph","flipv","rotation"],n;if(j&&a){n=["false","false",(o+180)%360];}else{n=[String(a),String(j),o];if(Math.abs(o-d)%180!==0){var l=parseInt(this.$applyBindRule("width",m))||0,c=parseInt(this.$applyBindRule("height",m))||0;i.push("width","height");n.push(c,l);}}this.$executeMulticallAction("rotate",i,m,n);};this.flipVertical=function(d,i){var j=this.$applyBindRule("fliph",d)=="true"?true:false,c=this.$applyBindRule("rotation",d)?parseInt(this.$applyBindRule("rotation",d)):0;var a=j&&i?["false","false",(c+180)%360]:[String(j),String(i),c];this.$executeMulticallAction("verticalFlip",["fliph","flipv","rotation"],d,a);};this.flipHorizontal=function(d,j){var i=this.$applyBindRule("flipv",d)=="true"?true:false,c=this.$applyBindRule("rotation",d)?parseInt(this.$applyBindRule("rotation",d)):0;var a=i&&j?["false","false",(c+180)%360]:[String(j),String(i),c];this.$executeMulticallAction("horizontalFlip",["fliph","flipv","rotation"],d,a);};this.resize=function(d,j,a,c,i){this.$executeMulticallAction("resize",["top","left","width","height"],d,[c,i,j,a]);};this.$executeMulticallAction=function(a,c,s,t){var m,d,q,u,n,o=[],j=c.length;for(m=0;m<j;m++){d=this.$getDataNode(c[m],s,this.$createModel);q=t[m];if(d){u=d.nodeType==1||d.nodeType==3||d.nodeType==4?"setTextNode":"setAttribute";n=d.nodeType==1?[d,q]:(d.nodeType==3||d.nodeType==4?[d.parentNode,q]:[d.ownerElement||d.selectSingleNode(".."),d.nodeName,q]);o.push({func:u,args:n});}}this.$executeAction("multicall",o,a,s);};this.addConnector=function(a,d,i,j){var c=this.xmlRoot.ownerDocument.createElement("connection");c.setAttribute("ref",this.$applyBindRule("id",i));c.setAttribute("output",d);c.setAttribute("input",j);this.$executeAction("appendChild",[a,c],"addConnector",a);};this.removeConnectors=function(j){var d=[],c=0,a=j.length;for(;c<a;c++){d.push({func:"removeNode",args:[j[c]]});}this.$executeAction("multicall",d,"removeConnectors",j[0]);};this.addBlock=function(i,l,j,a){if(!i){return;}var d=this.$flowVars.template.selectSingleNode("//element[@type='"+i+"']");if(!d){return;}var c=this.xmlRoot.ownerDocument.createElement("block");c.setAttribute("id","b"+(this.$flowVars.lastBlockId+1));c.setAttribute("left",l||20);c.setAttribute("top",j||20);c.setAttribute("width",d.getAttribute("dwidth"));c.setAttribute("height",d.getAttribute("dheight"));c.setAttribute("type",i);c.setAttribute("caption",a);this.$executeAction("appendChild",[this.xmlRoot,c],"addBlock",this.xmlRoot);};this.removeBlocks=function(q){var c,t,n,m,s=[],a=[],o=0,d=q.length;for(;o<d;o++){c=this.$applyBindRule("id",q[o]);a.push(c);s.push({func:"removeNode",args:[q[o]]});}for(t in this.$flowVars.xmlConnections){for(n=this.$flowVars.xmlConnections[t].length-1;n>=0;n--){for(m=0,d=a.length;m<d;m++){if(this.$flowVars.xmlConnections[t][n].ref==a[m]){s.push({func:"removeNode",args:[this.$flowVars.xmlConnections[t][n].xmlNode]});}}}}this.$executeAction("multicall",s,"removeBlocksWithConnections",q);};this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);this.objCanvas=new apf.flow.getCanvas(this.$int);apf.flow.init();};this.$deInitNode=function(a,c){var d=this.$applyBindRule("id",a);this.$flowVars.objBlocks[d].destroy();delete this.$flowVars.objBlocks[d];delete this.$flowVars.xmlBlocks[d];c.parentNode.removeChild(c);this.$flowVars.resizeManager.hide();};this.addEventListener("dragdrop",function(c){var d=apf.getAbsolutePosition(c.indicator),a=apf.getAbsolutePosition(this.objCanvas.htmlElement);apf.setNodeValue(this.$getDataNode("top",c.data[0],true),parseInt(c.top)-a[1]);apf.setNodeValue(this.$getDataNode("left",c.data[0],true),d[0]-a[0]);});this.$updateModifier=function(c,s){apf.console.info("UPDATE");var n=this.$flowVars,a=this.$applyBindRule("id",c),F=n.objBlocks[a],D=parseInt(this.$applyBindRule("top",c))?this.$applyBindRule("top",c):parseInt(F.htmlElement.style.top),G=parseInt(this.$applyBindRule("left",c))?this.$applyBindRule("left",c):parseInt(F.htmlElement.style.left);F.moveTo(D,G);var A=parseInt(this.$applyBindRule("width",c))?this.$applyBindRule("width",c):F.other.dwidth,N=parseInt(this.$applyBindRule("height",c))?this.$applyBindRule("height",c):F.other.dheight;F.resize(A,N);F.setCaption(this.$applyBindRule("caption",c));var O=this.$applyBindRule("lock",c)=="true"?true:false;F.setLock(O);F.changeRotation(this.$applyBindRule("rotation",c),this.$applyBindRule("fliph",c),this.$applyBindRule("flipv",c));var K,I,C,o,z,B,u,m,J=this.$getDataNode("connection",c,null,null,true),d=n.xmlConnections[a]||[],M=0;G=d.length;if(d.length){for(;M<G;M++){for(K=0,C=false,I=J.length;K<I;K++){if(d[M].xmlNode==J[K]){C=true;break;}}if(!C){if(n.objBlocks[a]&&n.objBlocks[d[M].ref]){var q=apf.flow.findConnector(n.objBlocks[a],d[M].output,n.objBlocks[d[M].ref],d[M].input);if(q){apf.flow.removeConnector(q.connector.htmlElement);}n.xmlConnections[a].removeIndex(M);}}}}else{delete n.xmlConnections[a];}for(M=0,G=J.length;M<G;M++){C=false;if(d){for(K=0,I=d.length;K<I;K++){if(d[K].xmlNode==J[M]){C=true;break;}}}if(!C){o=this.$applyBindRule("ref",J[M]),z=this.$applyBindRule("blockoutput",J[M]),B=this.$applyBindRule("blockinput",J[M]),u=this.$applyBindRule("blocklabel",J[M]),m=this.$applyBindRule("type",J[M]);if(n.xmlBlocks[o]){var E=n.xmlConnections[a]||[];E.push({ref:o,output:z,input:B,label:u,type:m,xmlNode:J[M]});new apf.flow.addConnector(this.objCanvas,n.objBlocks[a],n.objBlocks[o],{output:z,input:B,label:u,type:m,xmlNode:J[M]});n.xmlConnections[a]=E;}else{apf.console.info("Destination block doesn't exist.");}}}if(n.resizeManager&&c==this.selected&&!O){n.resizeManager.show();}else{n.resizeManager.hide();}F.updateOutputs();F.onMove();};this.$add=function(c,N,a,B,M){this.$flowVars.lastBlockId++;apf.console.info("ADD");this.$getNewContext("item");var t=this.$getLayoutNode("item"),D=this.$getLayoutNode("item","select"),E=this.$getLayoutNode("item","image"),O=this.$getLayoutNode("item","imagecontainer"),z=this.$getLayoutNode("item","caption");if(z){z.setAttribute("ondblclick","apf.lookup("+this.$uniqueId+").$beforeRename(event); return false;");}this.nodes.push(t);var V=[],U=[],s,Q,P,m=this.$applyBindRule("left",c)||0,G=this.$applyBindRule("top",c)||0,q=this.$applyBindRule("zindex",c)||1001;if(this.snap){m=Math.round(m/this.gridW)*this.gridW;G=Math.round(G/this.gridH)*this.gridH;}V.push("z-index:"+q);V.push("left:"+m+"px");V.push("top:"+G+"px");if(this.$flowVars.template){var n=this.$flowVars.template.selectSingleNode("//element[@type='"+this.$applyBindRule("type",c)+"']");if(n){var o=n.getAttribute("css");if(o){o=o.split(";");for(Q=0,P=o.length;Q<P;Q++){s=o[Q].trim();if(s!==""){if(s.substr(0,5)=="color"&&z){z.setAttribute("style",[s].join(";"));}else{V.push(s);}}}}var A=n.getAttribute("dwidth"),T=n.getAttribute("dheight");}}if(this.$applyBindRule("id",c)){var d=this.$applyBindRule("id",c).substr(1);if(d>this.$flowVars.lastBlockId){this.$flowVars.lastBlockId=d;}}var J=this.$applyBindRule("id",c)||"b"+this.$flowVars.lastBlockId,K=this.$applyBindRule("width",c)||A||56,I=this.$applyBindRule("height",c)||T||56,W=this.$applyBindRule("lock",c)||"false",j=this.$applyBindRule("cap-pos",c)||"outside";V.push("width:"+K+"px");V.push("height:"+I+"px");t.setAttribute("style",V.join(";"));U.push("width:"+K+"px");U.push("height:"+I+"px");E.setAttribute("style",U.join(";"));O.setAttribute("style",U.join(";"));c.setAttribute("id",J);c.setAttribute("width",K);c.setAttribute("height",I);c.setAttribute("lock",W);c.setAttribute("left",m);c.setAttribute("top",G);c.setAttribute("zindex",q);c.setAttribute("cap-pos",j);if(z){this.$setStyleClass(z,j);}D.setAttribute(this.itemSelectEvent||"onmousedown","var o = apf.lookup("+this.$uniqueId+"); o.select(this, event.ctrlKey, event.shiftKey)");apf.xmldb.nodeConnect(this.documentId,c,t,this);this.$flowVars.xmlBlocks[J]=c;var F=[],R,C=this.$getDataNode("connection",c,null,null,true);for(R=0,P=C.length;R<P;R++){F.push({ref:this.$applyBindRule("ref",C[R]),output:this.$applyBindRule("blockoutput",C[R]),input:this.$applyBindRule("blockinput",C[R]),label:this.$applyBindRule("blocklabel",C[R]),type:this.$applyBindRule("type",C[R]),xmlNode:C[R]});}var u=this.$applyBindRule("css",c);if(u){this.$setStyleClass(t,u);if(u){this.dynCssClasses.push(u);}}if(F.length>0){this.$flowVars.xmlConnections[J]=F;}};this.$fill=function(){apf.insertHtmlNodes(this.nodes,this.$int);apf.console.info("FILL");var d,q,n,o=this.$flowVars;for(d in o.xmlBlocks){var A=o.xmlBlocks[d],m=apf.xmldb.findHtmlNode(A,this),z=this.$flowVars.xmlBlocks[d].getAttribute("type")||null,j={};if(z){if(o.template){var C=o.template.selectSingleNode("element[@type='"+this.$applyBindRule("type",A)+"']");if(C){var s=C.selectNodes("input");if(s){for(q=0,n=s.length;q<n;q++){j[parseInt(s[q].getAttribute("name"))]={x:parseInt(s[q].getAttribute("x")),y:parseInt(s[q].getAttribute("y")),position:s[q].getAttribute("position")};}}}}}var B=this.$applyBindRule("lock",A)=="true"?true:false;var t={};t.lock=B;t.flipv=this.$applyBindRule("flipv",A)=="true"?true:false;t.fliph=this.$applyBindRule("fliph",A)=="true"?true:false;t.rotation=parseInt(this.$applyBindRule("rotation",A))||0;t.inputList=j;t.type=z;t.picture=z&&o.template&&C?C.getAttribute("picture"):null;t.dwidth=z&&o.template&&C?parseInt(C.getAttribute("dwidth")):56;t.dheight=z&&o.template&&C?parseInt(C.getAttribute("dheight")):56;t.scalex=z&&o.template&&C?(C.getAttribute("scalex")=="true"?true:false):true;t.scaley=z&&o.template&&C?(C.getAttribute("scaley")=="true"?true:false):true;t.scaleratio=z&&o.template&&C?(C.getAttribute("scaleratio")=="true"?true:false):false;t.xmlNode=A;t.caption=this.$applyBindRule("caption",A);t.capPos=this.$applyBindRule("cap-pos",A);var D=apf.flow.isBlock(m);var w=this;if(D){this.$setStyleClass(m,"",["empty"]);D.other=t;D.initBlock();}else{D=apf.flow.addBlock(m,this.objCanvas,t);if(D){D.oncreateconnection=function(c,i,l,E){w.addConnector(c,i,l,E);};D.onremoveconnection=function(c){w.removeConnectors(c);};o.objBlocks[d]=D;}}}for(d in o.xmlBlocks){var u=o.xmlConnections[d]||[];for(q=0,n=u.length;q<n;q++){var a=apf.flow.findConnector(o.objBlocks[d],u[q].output,o.objBlocks[u[q].ref],u[q].input);if(!a){if(o.objBlocks[d]&&o.objBlocks[u[q].ref]){o.objBlocks[d].onMove();new apf.flow.addConnector(this.objCanvas,o.objBlocks[d],o.objBlocks[u[q].ref],{output:u[q].output,input:u[q].input,label:u[q].label,type:u[q].type,xmlNode:u[q].xmlNode});}else{o.connToPaint.push({id:d,id2:u[q].ref,output:u[q].output,input:u[q].input,label:u[q].label,type:u[q].type,xmlNode:u[q].xmlNode});}}else{a.connector.other={output:u[q].output,input:u[q].input,label:u[q].label,type:u[q].type,xmlNode:u[q].xmlNode};a.connector.activateInputs();a.connector.draw();}}}for(q=o.connToPaint.length-1;q>=0;q--){if(o.objBlocks[o.connToPaint[q].id]&&o.objBlocks[o.connToPaint[q].id2]){new apf.flow.addConnector(this.objCanvas,o.objBlocks[o.connToPaint[q].id],o.objBlocks[o.connToPaint[q].id2],{output:o.connToPaint[q].output,input:o.connToPaint[q].input,label:o.connToPaint[q].label,type:o.connToPaint[q].type,xmlNode:o.connToPaint[q].xmlNode});o.connToPaint.removeIndex(q);}}this.nodes=[];if(!this.objCanvas.scrollPointer){this.objCanvas.addScrollPointer();}};this.$destroy=function(){};this.$loadAml=function(c){apf.getData(this.getAttribute("template"),{callback:function(l,j,i){if(j==apf.SUCCESS){a.loadTemplate(l);}else{apf.console.info("An error has occurred: "+i.message,2);return;}}});var a=this,d=this.$flowVars;d.resizeManager=new apf.resize();d.resizeManager.onresizedone=function(j,n,m,i){a.resize(a.selected,j,n,m,i);};d.resizeManager.onresize=function(q,n,j,i,o){if(!q){return;}var m=apf.flow.isBlock(q);m.moveTo(n,j);m.resize(i,o);m.updateOutputs();m.onMove();};apf.flow.onaftermove=function(j,i){a.moveTo(a.selected,i,j);};apf.flow.onblockmove=function(){d.resizeManager.show();};};this.loadTemplate=function(a){if(typeof a!="object"){a=apf.getXmlDom(a);}if(a.nodeType==9){a=a.documentElement;}if(a.nodeType==3||a.nodeType==4){a=a.parentNode;}if(a.nodeType==2){a=a.ownerElement||a.parentNode||a.selectSingleNode("..");}this.$flowVars.template=a;this.$checkLoadQueue();};this.$canLoadData=function(){return this.$flowVars.template?true:false;};}).call(apf.flowchart.prototype=new apf.BaseList());apf.aml.setElement("flowchart",apf.flowchart);apf.aml.setElement("resize",apf.BindingRule);apf.aml.setElement("left",apf.BindingRule);apf.aml.setElement("top",apf.BindingRule);apf.aml.setElement("id",apf.BindingRule);apf.aml.setElement("width",apf.BindingRule);apf.aml.setElement("height",apf.BindingRule);apf.aml.setElement("flipv",apf.BindingRule);apf.aml.setElement("fliph",apf.BindingRule);apf.aml.setElement("rotation",apf.BindingRule);apf.aml.setElement("lock",apf.BindingRule);apf.aml.setElement("type",apf.BindingRule);apf.aml.setElement("cap-pos",apf.BindingRule);apf.aml.setElement("zindex",apf.BindingRule);apf.aml.setElement("connection",apf.BindingRule);apf.aml.setElement("ref",apf.BindingRule);apf.aml.setElement("blockoutput",apf.BindingRule);apf.aml.setElement("blockinput",apf.BindingRule);apf.aml.setElement("blocklabel",apf.BindingRule);apf.Graph=function(c,a){this.$init(a||"graph",apf.NODE_VISIBLE,c);};apf.aml.setElement("graph",apf.Graph);(function(){this.$focussable=false;this.$drawCode=0;this.$_style=null;this.$docompile=true;this.$doinit=true;this.style="";this.$microtime=0;this.$datasource=null;this.$datamode=null;this.$datatype=null;this.dataslice="1X";this.steps=100;this.$data=null;this.$tilex=0;this.$tiley=0;this.m={x:0,y:0};this.nc=0;this.$styletag="";this.$propHandlers.left=this.$propHandlers.top=this.$propHandlers.width=this.$propHandlers.height=function(a){};this.$propHandlers.series=function(O){var q=this.v_yval=[];var ac=this.v_xval=[];var z=this.v_zval=[];var B=this.v_time=[];var E=this.v_caption=[];var ab=this.v_class=[];var P=this.v_state=[];this.v_stateresolve=false;var G,D,M,R,Q,F=(new Date()).getTime()*0.001,C;var A,K,Z,X,o,d,u,J;if(typeof O=="string"){A=O;K=",";Z=" ";C="#";X=null;}else{A=O.series;K=O.split;X=O.caption;Z=O.delim;C=O.css;d=O.formula;u=O.length;}if(!A){return;}if(d){var a=this.getModel();if(!a.v_yval){var W=new Function("length","v_yval",apf.draw.baseMacro(["for(v = 0;v<length;v++){","v_yval[v] = ",[d],";","}"]));W(u,q);a.v_yval=q;}else{q=a.v_yval;}if(this.mipstep>1){var w=this.mipstep;var aa=this.v_yvalmip=[q];var I=[],s=q,V,U,D,M,N,Y;switch(this.mipset){case"avg":while(s.length>10){aa.push(I);for(U=0,M=0,N=s.length;M<N;M++){if(!(M%w)){if(M){I[U++]=D/w;}D=s[M];}else{D+=s[M];}}s=I,I=[];}break;case"add":while(s.length>10){aa.push(I);for(U=0,M=0,N=s.length;M<N;M++){if(!(M%w)){if(M){I[U++]=D;}D=s[M];}else{D+=s[M];}}s=I,I=[];}break;case"min":while(s.length>10){aa.push(I);for(U=0,M=0,N=s.length;M<N;M++){if(!(M%w)){if(M){I[U++]=D;}D=s[M];}else{if(D>(Y=s[M])){D=Y;}}}s=I,I=[];}break;case"max":while(s.length>10){aa.push(I);for(U=0,M=0,N=s.length;M<N;M++){if(!(M%w)){if(M){I[U++]=D;}D=s[M];}else{if(D<(Y=s[M])){D=Y;}}}s=I,I=[];}break;}this.$datamode="series";}}else{G=A.split(Z);for(D=0;D<G.length;D++){this.v_time[D]=F;M=G[D].split(C);this.v_state[D]=0;if(M.length>1){this.v_class[D]=M[1];}if(X){R=M[0].split(X);if(R.length>1){E[D]=R[1];}R=R[0].split(K);}else{R=M[0].split(K);}var T=1;if((Q=R.length)>0){if(Q==1){q[D]=parseFloat(R[0]);}else{if(Q>=2){ac[D]=parseFloat(R[0]);q[D]=parseFloat(R[1]);if(Q>=3){z[D]=parseFloat(R[2]);}}}}}this.$datamode="series";}};this.$propHandlers.formula=function(a){this.pformula=apf.draw.parseJSS(a);this.$datamode="math";this.$docompile=true;};this.$propHandlers.mode=function(a){this.$regenerate();};this.$propHandlers.style=function(a){this.$regenerate();};this.$propHandlers.a=this.$propHandlers.b=this.$propHandlers.c=this.$propHandlers.d=function(a){this.$redraw();};this.$redraw=function(c,a){if(this.$parentChart){this.$parentChart.$redraw(c,a);}};this.$regenerate=function(){this.$_style=null;this.$docompile=true;};this.$drawGraph=function(q,l){if(this.$doinit){this.$doinit=false;this.$parentAxis.$copySubPos(this);apf.draw.initLayer(this,this.$parentChart);}else{if(l){this.$parentAxis.$copySubPos(this);apf.draw.resizeLayer(this,this.$parentChart);}}if(this.$docompile){if(!this.$datamode){return this.$redraw();}this.$docompile=false;var a={};var n=this.mode+this.$parentAxis.mode;if(!this.$_style){this.$_style=apf.draw.parseStyle(apf.chart_draw["_"+n],this.style+this.$styletag,a);}if(this.$_style.graph&&this.$_style.graph.$clslist&&this.v_class){for(var u,o=this.v_class,w=this.v_state,m=0,d=o.length;m<d;m++){if(u=o[m]){w[m]=this.$_style.graph.$clslist[u];}}}this.$datatype=apf.chart_draw["dt_"+this.$datamode+this.dataslice](this);this.$drawCode=apf.chart_draw[n](this,this.$datatype,this.$_style);}if(this.$drawCode){this.$drawCode(this,q);if(this._anim){this.$redraw();}}};this.$drawBalloons=function(q,l){if(this.$doinit){this.$doinit=false;apf.draw.initLayer(this,this.$parentChart);}else{if(l){this.$parentAxis.$copySubPos(this);apf.draw.resizeLayer(this,this.$parentChart);}}if(this.$docompile){if(!this.$datamode){return this.$redraw();}this.$docompile=false;var a={};var n=this.mode+this.$parentAxis.mode;if(!this.$_style){this.$_style=apf.draw.parseStyle(apf.chart_draw["_"+n],this.style+this.$styletag,a);}if(this.$_style.graph.$clslist&&this.v_class){for(var u,o=this.v_class,w=this.v_state,m=0,d=o.length;m<d;m++){if(u=o[m]){w[m]=this.$_style.graph.$clslist[u];}}}this.$datatype=apf.chart_draw["dt_"+this.$datamode+this.dataslice](this);this.$drawCode=apf.chart_draw[n](this,this.$datatype,this.$_style);}if(this.$drawCode){this.$drawCode(this,q);if(this._anim){this.$redraw();}}};this.$mouseDown=function(a,d,c){};this.$mouseUp=function(a,c){};this.lastOver=-1;this.$mouseMove=function(z,w,K,u,q,n,d){if(!this.$drawCode){return;}var F=this.m;F.x=n*this.ds,F.y=d*this.ds;var D=this.$drawCode(this,this.parentNode,this.m),G,c;var B=(new Date()).getTime()*0.001;var j=this;function A(M,m,O){var N,P,o,l,t;N=(l=j.v_state[M])&4294901760,P=l&65535;o=Math.min(1,(B-j.v_time[M])*(j.$_style.graph.$speedlut?(j.$_style.graph.$speedlut[l]||1):1));j.v_state[M]=t=P|m;if(j.$_style.graph.notransit==1||j.$_style.graph.nogap==1){o=1;}j.v_time[M]=N==O?(B-(1-o)/(j.$_style.graph.$speedlut?(j.$_style.graph.$speedlut[t]||1):1)):B;}function E(O,o,N,l){var P,Q,m,M;P=(m=j.v_state[O])&4294901760,Q=m&65535;j.v_state[O]=M=Q|o,j.v_time[O]=(N-(1-l)/(this.$_style.graph.$speedlut?(this.$_style.graph.$speedlut[M]||1):1));}if(D!=(G=this.lastOver)){var a=apf.draw.stateBit;if(G>=0){A(G,a.hoverout,a.hoverin);if(this.$_style.graph.nogap==1&&B-this.lasttime<0.3){if(B-this.lasttime==0){}var C=this.lastOut,J=G;if(C>J){for(var I=C;I>J;I--){E(I,a.hoverout,B-(B-this.lasttime)*(1-(C-I)/(C-J)),1);}}else{for(var I=C;I<J;I++){E(I,a.hoverout,B-(B-this.lasttime)*((J-I)/(J-C)),1);}}}this.lasttime=B,this.lastOut=G,this.lastMicro=this.$microtime;}if(D>=0){A(D,a.hoverin,a.hoverout);}this.lastOver=D;this.$redraw();}};this.$load=function(m){apf.xmldb.addNodeListener(m,this);var d=this.v_yval=[];var E=this.v_xval=[];var j=this.v_zval=[];var o=this.v_time=[];var s=this.v_caption=[];var A=this.v_state=[];if(this.$hasBindRule("series")){var l=(this.$getBindRule("series",m)||{})[4];this.setProperty("series",{series:this.$applyBindRule("series",m),split:l.getAttribute("split")||",",datatype:l.getAttribute("datatype")||"1X",caption:l.getAttribute("caption")||null,cls:l.getAttribute("class")||null,delim:l.getAttribute("delimeter")||" ",formula:l.getAttribute("formula")||null,length:l.getAttribute("length")||null,mip:l.getAttribute("mip")||null});}else{if(this.$hasBindRule("formula")){this.setProperty("formula",this.$applyBindRule("formula",m));}else{var c=this.v_nodes=this.getTraverseNodes(m);var z,w,q,B,i,u=(new Date()).getTime()*0.001;if(!this.$hasBindRule("y")){apf.console.warn("No y binding rule found for graph "+this.name+" ["+this.localName+"]");}else{var C=this.$hasBindRule("z")?true:false,D=this.$hasBindRule("x")?true:false;for(q=0,i=c.length;q<i;q++){z=c[q];this.v_time[q]=u;d[q]=parseFloat(this.$applyBindRule("y",z));if(D){E[q]=parseFloat(this.$applyBindRule("x",z));if(C){j[q]=parseFloat(this.$applyBindRule("z",z));}}var a=this.$applyBindRule("css",z);s[q]=this.$applyBindRule("caption",z);A[q]=0;}this.$sourcetype="seriesX";}if(i!=this.length){this.setProperty("length",i);}}}};this.$xmlUpdate=function(F,d,m,z){if(F=="redo-remove"){var J=false,l=this.getModel(true);if(l){var B=l.getXpathByAmlNode(this);if(B){var d=l.data.selectSingleNode(B);if(d!=this.xmlRoot){J=true;}}}if(J||this.xmlRoot==d){return l.$waitForXml(this);}}if(this.$hasBindRule("series")||this.$hasBindRule("formula")){if(z&&!z.xmlNode){z.xmlNode=this.xmlRoot;}}else{var i=this.v_yval=[];var K=this.v_xval=[];var o=this.v_zval=[];var q=this.v_time=[];var w=this.v_caption=[];var D=this.v_state=[];var c=this.v_nodes=this.getTraverseNodes(this.xmlRoot);var C,A,s,E,j,u=(new Date()).getTime()*0.001;if(!this.$hasBindRule("y")){apf.console.warn("No y binding rule found for graph "+this.name+" ["+this.localName+"]");}else{var G=this.$hasBindRule("z")?true:false,I=this.$hasBindRule("x")?true:false;for(s=0,j=c.length;s<j;s++){C=c[s];this.v_time[s]=u;i[s]=parseFloat(this.$applyBindRule("y",C));if(I){K[s]=parseFloat(this.$applyBindRule("x",C));if(G){o[s]=parseFloat(this.$applyBindRule("z",C));}}var a=this.$applyBindRule("css",C);w[s]=this.$applyBindRule("caption",C);D[s]=0;}this.$sourcetype="seriesX";}if(j!=this.length){this.setProperty("length",j);}this.$redraw();}};this.addEventListener("DOMNodeInsertedIntoDocument",function(a){this.$parentAxis=this.parentNode;this.$parentChart=this.$parentAxis.parentNode;var c=this.getElementsByTagNameNS(apf.ns.apf,"style");if(c.length>0){this.$styletag=c[0].firstChild.nodeValue;}});}).call(apf.Graph.prototype=new apf.AmlElement());apf.remote=function(c,a){this.$init(a||"remote",apf.NODE_HIDDEN,c);};(function(){this.lookup={};this.select=[];this.models=[];this.rsbQueue={};this.queueTimer=null;this.discardBefore=null;this.$attrExcludePropBind=apf.extend({match:1},this.$attrExcludePropBind);this.sendChange=function(d,c){if(apf.xmldb.disableRSB){return;}clearTimeout(this.queueTimer);this.queueMessage(d,c,this);if(!apf.isO3){var a=this;this.queueTimer=$setTimeout(function(){a.processQueue(a);});}else{this.processQueue(this);}};this.buildMessage=function(d,c){for(var j=0,a=d.length;j<a;j++){if(d[j]&&d[j].nodeType){d[j]=this.xmlToXpath(d[j],c.data);}}return{model:c.name,args:d,timestamp:new Date().toGMTString()};};this.queueMessage=function(c,a,d){if(!a.id){a.setAttribute("id","rmtRsbGen".appendRandomNumber(5));}if(!d.rsbQueue){d.rsbQueue={};}if(!d.rsbQueue[a.id]){d.rsbQueue[a.id]=[];d.rsbModel=a;}d.rsbQueue[a.id].push(this.buildMessage(c,a));};this.processQueue=function(c){if(c===this){clearTimeout(this.queueTimer);}if(apf.xmldb.disableRSB){return;}for(var a in c.rsbQueue){if(!c.rsbQueue[a].length){continue;}this.transport.sendRSB(apf.serialize(c.rsbQueue[a]));}c.rsbQueue={};};this.receiveChange=function(j){if(apf.xmldb.disableRSB){return;}if(apf.offline&&apf.offline.inProcess==2){queue.push(j);return;}if(j.timestamp<this.discardBefore){return;}var d=apf.nameserver.get("model",j.model),l=j.args;var i=this.xpathToXml(l[1],d.data);if(!i){return;}var m=apf.xmldb.disableRSB,c;apf.xmldb.disableRSB=2;switch(l[0]){case"setTextNode":apf.xmldb.setTextNode(i,l[2],l[3]);break;case"setAttribute":apf.xmldb.setAttribute(i,l[2],l[3],l[4]);break;case"addChildNode":apf.xmldb.addChildNode(i,l[2],l[3],this.xpathToXml(l[4],d.data),l[5]);break;case"appendChild":c=(l[3]?this.xpathToXml(l[3],d.data):null);if(typeof l[2]=="string"){l[2]=apf.getXml(l[2]);}apf.xmldb.appendChild(i,apf.xmldb.cleanNode(l[2]),c,l[4],l[5]);break;case"moveNode":c=(l[3]?this.xpathToXml(l[3],d.data):null);var a=this.xpathToXml(l[2],d.data);apf.xmldb.appendChild(i,a,c,l[4],l[5]);break;case"removeNode":apf.xmldb.removeNode(i,l[2]);break;}apf.xmldb.disableRSB=m;};this.xmlToXpath=apf.xmlToXpath;this.xpathToXml=apf.xpathToXml;this.addEventListener("DOMNodeInsertedIntoDocument",function(d){var c=this;if(apf.offline&&apf.offline.enabled){var a=[];apf.offline.addEventListener("afteronline",function(){for(var m=0,j=a.length;m<j;m++){c.receiveChange(a[m]);}a.length=0;});}this.transport=self[this["transport"]];this.transport.addEventListener("datachange",function(o){var n=apf.unserialize(o.data),m=0,j=n.length;for(;m<j;m++){c.receiveChange(n[m]);}});});}).call(apf.remote.prototype=new apf.AmlElement());apf.aml.setElement("remote",apf.remote);apf.aml.setElement("unique",apf.BindingRule);apf.auth=function(c,a){this.$init(a||"auth",apf.NODE_HIDDEN,c);this.$services={};this.$cache={};this.$queue=[];this.$credentials=null;};apf.aml.setElement("auth",apf.auth);(function(){this.$retry=true;this.$loggedIn=false;this.$needsLogin=false;this.$autoStart=true;this.$hasHost=false;this.inProcess=0;this.$attrExcludePropBind=apf.extend({login:1,logout:1},this.$attrExcludePropBind);this.$booleanProperties.autostart=true;this.$booleanProperties.remember=true;this.$supportedProperties.push("login","logout","fail-state","error-state","login-state","logout-state","waiting-state","window","autostart","remember");this.$propHandlers.login=this.$propHandlers["login-state"]=function(c){this.$services["default"]=c?this:null;this.$needsLogin=c?true:false;};this.register=function(c){this.$services[c.name]=c;this.$needsLogin=true;};this.unregister=function(c){var d;delete this.$services[c.name];if(!(d in this.$services)){this.$needsLogin=false;}};this.addEventListener("DOMNodeInsertedIntoDocument",function(d){this.inited=true;if(this.parentNode&&this.parentNode.$setAuth){this.parentNode.$setAuth(this);this.$hasHost=true;}if(this.$autoStart&&!this.$hasHost){var c=this;apf.addEventListener("load",function(){c.authRequired();apf.removeEventListener("load",arguments.callee);});}});this.addEventListener("authrequired",function(){if(self[this.window]){this.win=self[this.window];if(this.win){this.win.show();return false;}}});this.addEventListener("beforelogin",function(){if(self[this["waiting-state"]]){this.state=self[this["waiting-state"]];if(this.state){this.state.activate();}}});function a(d){var c=(d.state==apf.TIMEOUT?self[this["error-state"]]:self[this["fail-state"]])||self[this["fail-state"]];if(c){this.state=c;if(this.state){this.state.activate();return false;}}}this.addEventListener("loginfail",a);this.addEventListener("logoutfail",a);this.addEventListener("logoutsuccess",function(){if(self[this["logout-state"]]){this.state=self[this["logout-state"]];if(this.state){this.state.activate();}}});this.addEventListener("loginsuccess",function(c){if(self[this.window]){this.win=self[this.window];if(this.win){this.win.hide();}}if(self[this["login-state"]]){this.state=self[this["login-state"]];if(this.state){this.state.activate();}}if(c.data&&this.model){this.model=apf.nameserver.get("model",this.model);if(this.model){this.model.load(c.data);}}});this.loginFn=function(i,n,o,t){if(!t){t={};}t.username=i;t.password=n;if(this.dispatchEvent("beforelogin",t)===false){return false;}this.inProcess=1;var m=0,j=0,l=this,d=function(){if(j!=++m){return;}l.inProcess=0;l.$loggedIn=true;l.clearQueue();if(o){o();}};if(this.$hasHost){this.$credentials=t;o=this.$hostCallback;this.$hostCallback=null;j=1;d();this.dispatchEvent("loginsuccess",{state:1,data:null,bubbles:true});if(!this.remember){this.$credentials=null;}}else{if(!t.service){var q=t.$services||this.$services;for(var c in q){j++;this.$do(c,t,"in",null,d);}}else{if(t.service){j=1;this.$do(t.service,t,"in",null,d);}}}};this.relogin=function(){if(this.dispatchEvent("beforerelogin")===false){return false;}var j,l=0,d=0,c=this,i=function(){if(d!=++l){return;}c.inProcess=0;c.$loggedIn=true;c.clearQueue();};for(j in this.$services){if(!this.$cache[j]){return false;}d++;this.$do(j,this.$cache[j],"in",true,i);}return true;};this.$do=function(d,i,l,m,n){var j=this.$services[d],c=i.userdata=this;i.ignoreOffline=true;i.callback=function(z,w,s){if(w==apf.TIMEOUT&&s.retries<apf.maxHttpRetries){return s.tpModule.retry(s.id);}var q=c.dispatchEvent("log"+l+"check",apf.extend({state:w,data:z,service:d,bubbles:true},s)),t=typeof q=="boolean"?!q:!(w==apf.SUCCESS||l=="out"&&s.http.status==401);if(t){c.inProcess=0;if(m){return c.authRequired();}var u=new Error(apf.formatErrorString(0,null,"Logging "+l,"Error logging in: "+s.message));if(c.dispatchEvent("log"+l+"fail",apf.extend({error:u,service:d,state:w,data:z,bubbles:true},s))!==false){throw u;}return;}if(l=="in"){if(!m&&c.$retry){var o={};for(var A in i){if("object|array".indexOf(typeof i[A])==-1){o[A]=i[A];}}c.$cache[d||"default"]=o;}}else{if(c.$cache[d||"default"]){c.$cache[d||"default"]=null;}c.authRequired();}if(n){n();}c.dispatchEvent("log"+l+"success",apf.extend({state:w,service:d,data:z,bubbles:true},s));};apf.saveData(j.getAttribute("log"+l),i);};this.clearQueue=function(){if(!this.$loggedIn){return;}var c=this.$queue.slice();this.$queue.length=0;for(var d=0;d<c.length;d++){var j=c[d];if(!this.$loggedIn){this.$queue.push(j);continue;}if(j.retry){j.$retry.call(j.object);}else{if(j.id){j.tpModule.retry(j.id);}}}if(this.$queue.length){this.clearQueue();}};this.logoutFn=function(i,d){if(!d){d={};}if(this.dispatchEvent("beforelogout",d)===false){return;}this.$loggedIn=false;if(!d.service){for(var c in this.$services){this.$do(c,d,"out",null,i);}}else{if(d.service){this.$do(d.service,d,"out",null,i);}}};this.authRequired=function(d,i){if(d&&d.userdata==this){return;}if(this.$loggedIn&&!i&&this.$retry&&this.relogin()){var c=false;}else{if(this.inProcess!=1){if(this.$hasHost&&typeof d=="function"){if(this.$credentials){return d();}this.$hostCallback=d;}var c=this.dispatchEvent("authrequired",apf.extend({bubbles:true,data:d&&d.data},d));}}this.$loggedIn=false;if(c===false){if(d){this.$queue.push(d);}return true;}};}).call(apf.auth.prototype=new apf.AmlElement());apf.template=function(c,a){this.$init(a||"template",apf.NODE_HIDDEN,c);};(function(){this.$focussable=false;this.$frags={};this.getNewInstance=function(l,n,i,j){if(this.$frags[n]){var m=this.$frags[n];}else{var d,c,a,m=this.$frags[n]=this.cloneNode(true);m.$int=l;if(i){d=apf.xmldb.findModel(i);c=apf.xmlToXpath(i,d.data,true)||".";m.attributes.push(a=new apf.AmlAttr(m,"model",""));a.inheritedValue=[d.name,c];}m.ownerDocument.$domParser.$continueParsing(m,{delay:true});}return m;};this.destroyInstance=function(c){var a=this.$frags[c];delete this.$frags[c];a.destroy(true);};}).call(apf.template.prototype=new apf.AmlElement());apf.aml.setElement("template",apf.template);apf.radio=function(c,a){this.$init(a||"radio",apf.NODE_HIDDEN,c);};apf.check=function(c,a){this.$init(a||"check",apf.NODE_HIDDEN,c);};apf.item=function(c,a){this.$init(a||"item",apf.NODE_HIDDEN,c);};(function(){this.$focussable=false;this.$childProperty="caption";this.$canLeechSkin="item";this.implement(apf.ChildValue);this.$attrExcludePropBind=apf.extend({match:1},this.$attrExcludePropBind);this.$supportedProperties.push("submenu","value","match","group","icon","checked","selected","disabled","caption");this.$propHandlers.submenu=function(c){apf.setStyleClass(this.$ext,"submenu");};this.$propHandlers.select=function(c){this.select=c?"self::"+c.split("|").join("|self::"):c;};this.$propHandlers.hotkey=function(d){if(this.$hotkey){apf.setNodeValue(this.$hotkey,d);}if(this.$lastHotkey){apf.removeHotkey(this.$lastHotkey);}if(d){this.$lastHotkey=d;var c=this;apf.registerHotkey(d,function(){var m=apf.document.getElementsByTagNameNS(apf.ns.aml,"button");for(var l=0;l<m.length;l++){if(m[l].submenu==c.parentNode.name){var j=m[l];j.$setState("Over",{});$setTimeout(function(){j.$setState("Out",{});},200);break;}}c.$down();c.$up();c.$click();});}};this.$propHandlers.icon=function(c){if(this.$icon){apf.skins.setIcon(this.$icon,c,this.parentNode.iconPath);}};this.$propHandlers.caption=function(c){if(this.$caption){apf.setNodeValue(this.$caption,c);}};this.$propHandlers.checked=function(c){if(this.localName!="check"){return;}if(apf.isTrue(c)){apf.setStyleClass(this.$ext,"checked");}else{apf.setStyleClass(this.$ext,"",["checked"]);}};this.$propHandlers.selected=function(c){if(this.localName!="radio"){return;}if(apf.isTrue(c)){apf.setStyleClass(this.$ext,"selected");}else{apf.setStyleClass(this.$ext,"",["selected"]);}};this.$propHandlers.disabled=function(c){if(apf.isTrue(c)){apf.setStyleClass(this.$ext,"disabled");}else{apf.setStyleClass(this.$ext,"",["disabled"]);}};this.enable=function(c){apf.setStyleClass(this.$ext,this.parentNode.$baseCSSname+"Disabled");};this.disable=function(c){apf.setStyleClass(this.$ext,null,[this.parentNode.$baseCSSname+"Disabled"]);};this.show=function(){this.$ext.style.display="block";};this.hide=function(){this.$ext.style.display="none";};this.addEventListener("AMLReparent",function(c,i,d){if(!this.$amlLoaded){return;}if(!d&&this.skinName!=i.skinName){this.loadAml();}});this.$down=function(){};this.$up=function(){if(this.localName=="radio"){this.parentNode.select(this.group,this.value||this.caption);}else{if(this.localName=="check"){this.$handlePropSet("checked",!this.checked);}}if(this.submenu){this.$over(null,true);return;}this.parentNode.$hideTree=true;this.parentNode.hide();this.parentNode.dispatchEvent("itemclick",{value:this.value||this.caption});};this.$click=function(){this.dispatchEvent("click",{xmlContext:this.parentNode.xmlReference,opener:this.parentNode.opener});};var a;this.$out=function(d){if(apf.isChildOf(this.$ext,d.toElement||d.explicitOriginalTarget)||apf.isChildOf(this.$ext,d.srcElement||d.target)){return;}clearTimeout(a);if(!this.submenu||this.$submenu(true)){apf.setStyleClass(this.$ext,"",["hover"]);var c=this.parentNode.$selected;if(c&&c!=this){apf.setStyleClass(c.$ext,"",["hover"]);}this.parentNode.$selected=null;}};this.$over=function(i,d){if(this.parentNode.$selected==this){return;}if(this.parentNode.$selected){apf.setStyleClass(this.parentNode.$selected.$ext,"",["hover"]);}apf.setStyleClass(this.$ext,"hover");this.parentNode.$selected=this;if(!d&&(apf.isChildOf(this.$ext,i.toElement||i.explicitOriginalTarget)||apf.isChildOf(this.$ext,i.fromElement||i.target))){return;}var j=this.parentNode.$showingSubMenu;if(j){if(j.name==this.submenu){return;}j.hide();this.parentNode.$showingSubMenu=null;}if(this.submenu){if(d){this.$submenu();}else{var c=this;clearTimeout(a);a=$setTimeout(function(){c.$submenu();a=null;},200);}}};this.$submenu=function(c,d){if(!this.submenu){return true;}var i=self[this.submenu];if(!i){return;}if(!c){this.parentNode.$showingSubMenu=i;var j=apf.getAbsolutePosition(this.$ext,this.parentNode.$ext.offsetParent);i.display(j[0]+this.$ext.offsetWidth-3,j[1]+3,false,this,this.parentNode.xmlReference,this.parentNode.$uniqueId);i.setAttribute("zindex",(this.parentNode.zindex||1)+1);}else{if(i.visible&&!d){return false;}if(this.parentNode.$showingSubMenu){this.parentNode.$showingSubMenu=null;}apf.setStyleClass(this.$ext,"",["hover"]);i.hide();return true;}};this.$draw=function(d){var j=this.parentNode;while(j.$canLeechSkin=="item"){j=j.parentNode;}if(j.hasFeature(apf.__MULTISELECT__)){var c=this;if(!this.$hasSetSkinListener){var i;this.parentNode.addEventListener("$skinchange",i=function(){if(c.$amlDestroyed){return;}if(c.$ext.parentNode){this.$deInitNode(c,c.$ext);}var n=j==c.parentNode?j.$int:c.parentNode.$int;var m=n.lastChild;j.$add(c,c.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId,c.parentNode,n!=j.$int&&n,null);j.$fill();if(j.$isTreeArch){c.$int=j.$getLayoutNode("item","container",c.$ext=m&&m.nextSibling||n.firstChild);}else{c.$ext=m&&m.nextSibling||n.firstChild;}var l=c;while((l=l.nextSibling)&&l.nodeType!=1){}if(!l||l.$canLeechSkin!="item"){j.dispatchEvent("afterload");}});this.addEventListener("DOMNodeRemoved",function(l){this.parentNode.removeEventListener("$skinchange",i);});this.$hasSetSkinListener=true;}if(!j.$itemInited){j.canrename=false;j.$removeClearMessage();j.$itemInited=[j.getTraverseNodes,j.getFirstTraverseNode,j.getTraverseParent];j.getTraverseNodes=function(l){return(l||j).getElementsByTagNameNS(apf.ns.apf,"item");};j.getFirstTraverseNode=function(l){return(l||j).getElementsByTagNameNS(apf.ns.apf,"item")[0];};j.getTraverseParent=function(l){return l&&l.parentNode;};j.each=(this.prefix?this.prefix+":":"")+"item";j.$preventDataLoad=true;j.$initingModel=true;j.$setDynamicProperty("icon","[@icon]");j.$setDynamicProperty("image","[@image]");j.$setDynamicProperty("caption","[label/text()|@caption|text()]");j.$setDynamicProperty("eachvalue","[value/text()|@value|text()]");j.$canLoadDataAttr=false;if(!j.xmlRoot){j.xmlRoot=j;}}this.$loadAml=function(){if(!this.getAttribute("caption")){this.setAttribute("caption",this.caption);}var n=j==this.parentNode?j.$int:this.parentNode.$int;var m=n.lastChild;if(!j.documentId){j.documentId=apf.xmldb.getXmlDocId(this);}j.$add(this,apf.xmldb.nodeConnect(j.documentId,this,null,j),this.parentNode,n!=j.$int&&n,null);j.$fill();if(j.$isTreeArch){this.$int=j.$getLayoutNode("item","container",this.$ext=m&&m.nextSibling||n.firstChild);}else{this.$ext=m&&m.nextSibling||n.firstChild;}var l=this;while((l=l.nextSibling)&&l.nodeType!=1){}if(!l||l.$canLeechSkin!="item"){j.dispatchEvent("afterload");if(j.autoselect){j.$selectDefault(this.parentNode);}}};return;}this.$ext=this.$getExternal(this.$isLeechingSkin?"item":"main",null,function(l){var m="apf.lookup("+this.$uniqueId+")";l.setAttribute("onmouseup",m+".$up(event)");l.setAttribute("onmousemove",m+".$over(event)");l.setAttribute("onmouseout",m+".$out(event)");l.setAttribute("onmousedown",m+".$down()");l.setAttribute("onclick",m+".$click()");});apf.setStyleClass(this.$ext,this.localName);this.$caption=this.$getLayoutNode("item","caption",this.$ext);this.$icon=this.$getLayoutNode("item","icon",this.$ext);this.$hotkey=this.$getLayoutNode("item","hotkey",this.$ext);if(!d&&this.nextSibling&&this.nextSibling.$ext){this.$ext.parentNode.insertBefore(this.$ext,this.nextSibling.$ext);}};this.addEventListener("DOMNodeInsertedIntoDocument",function(d){var c=this.$ext?true:false;if(c){if(typeof this.checked!=="undefined"){this.$handlePropSet("checked",this.checked);}else{if(typeof this.selected!=="undefined"){this.$handlePropSet("selected",this.selected);}}if(this.disabled){this.$handlePropSet("disabled",this.disabled);}if(this.caption){this.$handlePropSet("caption",this.caption);}}});}).call(apf.item.prototype=new apf.Presentation());apf.radio.prototype=apf.check.prototype=apf.item.prototype;apf.aml.setElement("radio",apf.radio);apf.aml.setElement("check",apf.check);apf.aml.setElement("item",apf.item);apf.WinServer={count:9000,wins:[],setTop:function(d,c){if(d.$opened){if(d.$opened.visible){return;}else{delete d.$opened;}}var a;if(!c&&this.wins.length){var a=this.wins[this.wins.length-1];if(a==d){return;}if(!a.modal||!a.visible){a=null;}else{if(a&&d.modal){d.$opener=a;a.$opened=d;a=null;}}}this.count+=2;d.setProperty("zindex",this.count);this.wins.remove(d);this.wins.push(d);if(a){this.setTop(a,true);}return d;},setNext:function(){if(this.wins.length<2){return;}var a,c=this.wins.shift();do{if(this.setTop(a||c).visible){break;}a=this.wins.shift();}while(c!=a);},setPrevious:function(){if(this.wins.length<2){return;}this.wins.unshift(this.wins.pop());var a,c=this.wins.pop();do{if(this.setTop(a||c).visible){break;}a=this.wins.pop();}while(c!=a);},remove:function(a){this.wins.remove(a);}};apf.toolwindow=function(c,a){this.$init(a||"toolwindow",apf.NODE_VISIBLE,c);};apf.modalwindow=function(c,a){this.$init(a||"modalwindow",apf.NODE_VISIBLE,c);};apf.AmlWindow=function(c,a){this.$init(a||"window",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.Docking,apf.BaseStateButtons);this.$isWindowContainer=true;this.collapsedHeight=30;this.canHaveChildren=2;this.visible=false;this.showdragging=false;this.kbclose=false;this.$focussable=apf.KEYBOARD;this.setTitle=function(d){this.setProperty("title",d,false,true);return this;};this.setIcon=function(d){this.setProperty("icon",d,false,true);return this;};this.show=function(d){this.execAction=d;this.setProperty("visible",true,false,true);return this;};this.slideIn=function(m,j){if(!m){m="bottom";}var q=this.center;this.center=false;this.setProperty("visible",true);this.center=q;var i=0,u=0,o=(apf.isIE?this.$ext.offsetParent.offsetWidth:window.innerWidth),l=(apf.isIE?this.$ext.offsetParent.offsetHeight:window.innerHeight),t=Math.max(0,((o-this.$ext.offsetWidth)/2)),s=Math.max(0,((l-this.$ext.offsetHeight)/3)),d="top",n=10;switch(m){case"top":i=-(this.$ext.offsetHeight)-n;u=j?0:s;break;case"left":i=-(this.$ext.offsetWidth)-n;u=j?0:t;d="left";break;case"bottom":i=l+this.$ext.offsetHeight+n;u=j?l-this.$ext.offsetHeight:s;break;case"right":i=o+this.$ext.offsetLeft+n;u=j?o-this.$ext.offsetWidth:t;d="left";break;}apf.tween.single(this.$ext,{steps:apf.isIphone?5:30,interval:10,from:i,to:u,type:d,anim:apf.tween.EASEIN});return this;};this.slideOut=function(i){if(!i){i="bottom";}var n=0,m=0,l="top",j=10;switch(i){case"top":n=this.$ext.offsetTop;m=-(this.$ext.offsetHeight)-j;break;case"left":n=this.$ext.offsetLeft;m=-(this.$ext.offsetWidth)-j;l="left";break;case"bottom":n=this.$ext.offsetTop;m=(apf.isIE?this.$ext.offsetParent.offsetHeight:window.innerHeight)+this.$ext.offsetHeight+j;break;case"right":n=this.$ext.offsetLeft;m=(apf.isIE?this.$ext.offsetParent.offsetWidth:window.innerWidth)+this.$ext.offsetLeft+j;l="left";break;}var d=this;apf.tween.single(this.$ext,{steps:apf.isIphone?5:30,interval:10,from:n,to:m,type:l,anim:apf.tween.EASEOUT,onfinish:function(){d.setProperty("visible",false);}});return this;};this.bringToFront=function(){apf.WinServer.setTop(this);return this;};this.syncAlignment=function(d){if(d.hidden==3){apf.WinServer.setTop(this);}if(d.state>0){this.$setStyleClass(this.$ext,this.$baseCSSname+"Min",[this.$baseCSSname+"Edit",this.$baseCSSname+"Max"]);}else{this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Min",this.$baseCSSname+"Edit",this.$baseCSSname+"Max"]);}};this.$booleanProperties.modal=true;this.$booleanProperties.center=true;this.$booleanProperties.transaction=true;this.$booleanProperties.hideselects=true;this.$booleanProperties.showdragging=true;this.$booleanProperties.kbclose=true;this.$supportedProperties.push("title","icon","modal","minwidth","minheight","hideselects","center","kbclose","maxwidth","maxheight","showdragging","transaction");this.$propHandlers.modal=function(i){if(i&&!this.oCover){var d=this.$getLayoutNode("cover");if(d){this.oCover=apf.insertHtmlNode(d,this.$pHtmlNode);if(!this.visible){this.oCover.style.display="none";}if(this.zindex){this.oCover.style.zIndex=this.zindex;}}}if(!i&&this.oCover){this.oCover.style.display="none";}};this.$propHandlers.center=function(d){this.$ext.style.position="absolute";};this.$propHandlers.title=function(d){if(this.oTitle){this.oTitle.nodeValue=d;}};this.$propHandlers.icon=function(d){if(!this.oIcon){return;}this.oIcon.style.display=d?"block":"none";apf.skins.setIcon(this.oIcon,d,this.iconPath);};var c=[],a;this.$propHandlers.visible=function(q){if(apf.isTrue(q)){if(this.oCover){if(this.oCover.offsetParent){this.oCover.style.height=Math.max(this.oCover.offsetParent.scrollHeight,document.documentElement.offsetHeight)+"px";this.oCover.style.width=this.oCover.offsetParent.scrollWidth+"px";}this.oCover.style.display="block";}this.state=this.state.split("|").remove("closed").join("|");this.$ext.style.display="block";if(apf.layout&&this.$int){apf.layout.forceResize(this.$int);}if(this.center){var o=!this.$ext.offsetParent||this.$ext.offsetParent.tagName=="BODY"?[apf.getWindowWidth(),apf.getWindowHeight()]:[this.$ext.offsetParent.offsetWidth,this.$ext.offsetParent.offsetHeight,0,0];if(o.length==2){o.push(document.documentElement.scrollLeft,document.documentElement.scrollTop);}this.$ext.style.left=(Math.max(0,((o[0]-parseInt(this.width))/2))+o[2])+"px";this.$ext.style.top=(Math.max(0,((o[1]-parseInt(this.height))/3))+o[3])+"px";}if(!apf.canHaveHtmlOverSelects&&this.hideselects){c=[];var m=document.getElementsByTagName("select");for(var n=0;n<m.length;n++){var l=apf.getStyle(m[n],"display");c.push([m[n],l]);m[n].style.display="none";}}if(this.modal){this.bringToFront();}if(!this.$rendered){this.addEventListener("afterrender",function(){if(this.$amlLoaded&&(this.model||(!this.dockable||!this.aData)&&!this.$isWidget&&this.localName!="toolwindow")){this.focus(false,{mouse:true});}});}else{if(this.$amlLoaded&&(this.model||(!this.dockable||!this.aData)&&!this.$isWidget&&this.localName!="toolwindow")){this.focus(false,{mouse:true});}}if(apf.isIE){var j=this.$ext.className;this.$ext.className="rnd"+Math.random();this.$ext.className=j;}var d=this;$setTimeout(function(){d.dispatchEvent("show");});}else{if(this.oCover){this.oCover.style.display="none";}this.$ext.style.display="none";if(!apf.canHaveHtmlOverSelects&&this.hideselects){for(var n=0;n<c.length;n++){c[n][0].style.display=c[n][1];}}if(this.hasFocus()){apf.window.moveNext(true,this,true);}this.dispatchEvent("close");this.visible=false;}a=q;};this.$propHandlers.zindex=function(d){this.$ext.style.zIndex=d+1;if(this.oCover){this.oCover.style.zIndex=d;}};if(!apf.isIphone){this.addEventListener("keydown",function(j){var i=j.keyCode;var m=j.ctrlKey;var d=j.shiftKey;var l=false;switch(i){case 38:if(d&&this.resizable){this.setProperty("height",Math.max(this.minheight||0,this.$ext.offsetHeight-(m?50:10)));}else{if(this.draggable){this.setProperty("top",this.$ext.offsetTop-(m?50:10));}}break;case 37:if(d&&this.resizable){this.setProperty("width",Math.max(this.minwidth||0,this.$ext.offsetWidth-(m?50:10)));}else{if(this.draggable){this.setProperty("left",this.$ext.offsetLeft-(m?50:10));}}break;case 39:if(d&&this.resizable){this.setProperty("width",Math.min(this.maxwidth||10000,this.$ext.offsetWidth+(m?50:10)));}else{if(this.draggable){this.setProperty("left",this.$ext.offsetLeft+(m?50:10));}}break;case 40:if(d&&this.resizable){this.setProperty("height",Math.min(this.maxheight||10000,this.$ext.offsetHeight+(m?50:10)));}else{if(this.draggable){this.setProperty("top",this.$ext.offsetTop+(m?50:10));}}break;default:l=null;return;}if(apf.hasSingleRszEvent){apf.layout.forceResize(this.$int);}return l;},true);this.addEventListener("keydown",function(d){if(d.keyCode==27&&this.buttons.indexOf("close")>-1&&(!this.dockable||!this.aData)&&this.kbclose){this.close();}});}this.$draw=function(){this.popout=apf.isTrue(this.getAttribute("popout"));if(this.popout){this.$pHtmlNode=document.body;}this.$ext=this.$getExternal(null,null,function(i){this.$initButtons(i);});this.oTitle=this.$getLayoutNode("main","title",this.$ext);this.oIcon=this.$getLayoutNode("main","icon",this.$ext);this.oDrag=this.$getLayoutNode("main","drag",this.$ext);this.$buttons=this.$getLayoutNode("main","buttons",this.$ext);this.oDrag.host=this;if(this.popout){this.$ext.style.position="absolute";}if(this.oIcon){this.oIcon.style.display="none";}if(!apf.isIphone){var d=this;this.oDrag.onmousedown=function(i){if(!i){i=event;}if(!d.$isWidget&&(!d.aData||!d.dockable||d.aData.hidden==3)){apf.WinServer.setTop(d);}if(d.$lastState.maximized){return false;}if(d.aData&&d.dockable){if(d.$lastState.normal){d.startDocking(i);}return false;}};this.$ext.onmousedown=function(){var i=apf.document.activeElement;if(i&&i.$focusParent!=d&&i.$focusParent.modal){return false;}if(!d.$isWidget&&(!d.aData||!d.dockable||d.aData.hidden==3)){apf.WinServer.setTop(d);}if(!d.$lastState.normal){return false;}};this.$ext.onmousemove=function(){if(!d.$lastState.normal){return false;}};}};this.$loadAml=function(i){apf.WinServer.setTop(this);this.$int=this.$getLayoutNode("main","container",this.$ext);if(!apf.isIphone){if(this.oTitle){var d=this;(this.oTitle.nodeType!=1?this.oTitle.parentNode:this.oTitle).ondblclick=function(j){if(d.state.indexOf("normal")==-1){d.restore();}else{if(d.buttons.indexOf("max")>-1){d.maximize();}else{if(d.buttons.indexOf("min")>-1){d.minimize();}}}};}if(typeof this.draggable=="undefined"){(this.$propHandlers.draggable||apf.GuiElement.propHandlers.draggable).call(this,true);this.draggable=true;}if(typeof this.buttons=="undefined"){this.buttons="";}}if(this.modal===undefined&&this.oCover){this.$propHandlers.modal.call(this,true);this.modal=true;}if(!this.visible){this.$ext.style.display="none";if(this.oCover){this.oCover.style.display="none";}}else{if(this.modal){var d=this;apf.queue.add("focus",function(){d.focus(false,{mouse:true});});}}if(this.minwidth===undefined){this.minwidth=this.$getOption("Main","min-width");}if(this.minheight===undefined){this.minheight=this.$getOption("Main","min-height");}if(this.maxwidth===undefined){this.maxwidth=this.$getOption("Main","max-width");}if(this.maxheight===undefined){this.maxheight=this.$getOption("Main","max-height");}if(this.center&&this.visible){this.visible=false;this.$ext.style.display="none";var d=this;$setTimeout(function(){d.setProperty("visible",true);});}};this.addEventListener("$skinchange",function(){if(this.title){this.$propHandlers.title.call(this,this.title);}if(this.icon){this.$propHandlers.icon.call(this,this.icon);}});this.$destroy=function(d){if(this.oDrag){this.oDrag.host=null;this.oDrag.onmousedown=null;apf.destroyHtmlNode(this.oDrag);this.oDrag=null;}this.oTitle=this.oIcon=this.oCover=null;if(this.$ext&&!d){this.$ext.onmousedown=null;this.$ext.onmousemove=null;}};}).call(apf.modalwindow.prototype=new apf.Presentation());apf.AmlWindow.prototype=apf.toolwindow.prototype=apf.modalwindow.prototype;apf.aml.setElement("toolwindow",apf.toolwindow);apf.aml.setElement("modalwindow",apf.modalwindow);apf.aml.setElement("window",apf.modalwindow);apf.xmpp=function(c,a){this.$init(a||"xmpp",apf.NODE_HIDDEN,c);this.$serverVars={};this.$reqCount=0;this.$reqStack=[];this.$listening=false;this.$listener=null;this.$sAJAX_ID=this.$makeUnique("ajaxRSB");this.$retryCount=0;this.$RID=null;};(function(){this.$server=null;this.timeout=10000;this.maxrequests=2;this.useHTTP=true;this.method="POST";this.$model=null;this.$modelContent=null;this.$xmppMethod=apf.xmpp.CONN_BOSH;this.$isPoll=false;this.$pollTimeout=2000;this.$autoRegister=false;this.$autoConfirm=true;this.$autoDeny=false;this.$canMuc=false;this.$modelContent={roster:true,chat:true,typing:true};var t="SID",w="JID",D="connected",n="roster";this.$booleanProperties["auto-register"]=true;this.$booleanProperties["auto-confirm"]=true;this.$booleanProperties["auto-deny"]=true;this.$supportedProperties.push("poll-timeout","resource","auto-register","auto-confirm","auto-deny","model","model-contents","muc-domain","muc-model");this.$propHandlers.type=function(W){this.$xmppMethod=(W=="polling")?apf.xmpp.CONN_POLL:apf.xmpp.CONN_BOSH;this.$isPoll=Boolean(this.$xmppMethod&apf.xmpp.CONN_POLL);};this.$propHandlers["poll-timeout"]=function(W){this.$pollTimeout=parseInt(W)||2000;};this.$propHandlers.resource=function(W){this.resource=W||apf.config.name||"apf".appendRandomNumber(5);};this.$propHandlers["auto-register"]=function(W){this.$autoRegister=W;};this.$propHandlers["auto-confirm"]=function(W){this.$autoConfirm=W;};this.$propHandlers["auto-deny"]=function(W){this.$autoDeny=W;};this.$propHandlers.model=function(W){if(!W){return;}this.$model=apf.setReference(W,apf.nameserver.register("model",W,new apf.model()));this.$model.id=this.$model.name=W;this.$model.load("<xmpp/>");};this.$propHandlers["model-contents"]=function(Y){var Z=(Y||"all").splitSafe("\\|",0,true),X=0,W=Z.length;this.$modelContent={roster:Z[0]=="all",chat:Z[0]=="all",typing:Z[0]=="all"};for(;X<W;X++){Z[X]=Z[X].trim();if(!this.$modelContent[Z[X]]){this.$modelContent[Z[X]]=true;}}};this.$propHandlers["muc-model"]=function(W){this.$mucDomain=this["muc-domain"]||"conference."+this.$domain;if(W){this.$canMuc=true;this.$mucModel=apf.setReference(W,apf.nameserver.register("model",W,new apf.model()));this.$mucModel.id=this.$mucModel.name=W;this.$mucModel.load("<xmpp_muc/>");this.implement(apf.xmpp_muc);}};function G(W){if(typeof W!="string"){throw new Error("Dependencies not met, please provide a string");}return(W+"_").appendRandomNumber(5);}function j(W,Z){var X,Y=["<body "];for(X in W){if(W[X]==null){continue;}Y.push(X,"='",W[X],"' ");}Y.push(">",Z||"","</body>");return Y.join("");}function z(W,Z){if(!W){W={};}var Y=[this.$serverVars[t]||"0",","];if(W.doOpen){Y.push("<stream:stream");for(var X in W){if(X=="doOpen"||X=="doClose"||W[X]==null){continue;}Y.push(" ",X,"='",W[X],"'");}Y.push(">");}Y.push(Z||"");if(W.doClose){Y.push("</stream:stream>");}return Y.join("");}function B(Y){var Z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",X,W="";for(X=0;X<Y;X++){W+=Z.charAt(apf.randomGenerator.generate(0,61));}return W;}function M(Z){var W,X=[];for(W in Z){if(Z[W]==null){continue;}X.push(W,'="',Z[W],'",');}var Y=X.join("").replace(/,$/,"");return"<response xmlns='"+apf.xmpp.NS.sasl+"'>"+apf.crypto.Base64.encode(Y)+"</response>";}function Q(Z,Y){var W,X=["<iq "];for(W in Z){if(Z[W]==null){continue;}X.push(W,"='",Z[W],"' ");}X.push(">",Y||"","</iq>");return X.join("");}function u(W,Y){var X=["<presence xmlns='",apf.xmpp.NS.jabber,"'"];if(W.type){X.push(" type='",W.type,"'");}if(W.to){X.push(" to='",W.to,"'");}if(W.from){X.push(" from='",W.from,"'");}X.push(">");if(W.status){X.push("<show>",W.status,"</show>");}if(W.custom){X.push("<status>",W.custom,"</status>");}X.push(Y||"");X.push("</presence>");return X.join("");}function T(X,W){var Y=["<message xmlns='",apf.xmpp.NS.jabber,"' from='",this.$serverVars[w],"' to='",X.to,"' id='message_",++this.$serverVars.mess_count,"' xml:lang='",X["xml:lang"],"'"];if(X.type){Y.push(" type='",X.type,"'");}Y.push(">");if(X.subject){Y.push("<subject>",X.subject,"</subject>");}if(X.thread){Y.push("<thread>",X.thread,"</thread>");}Y.push("<body>",W,"</body></message>");return Y.join("");}this.$getRID=function(){if(this.$RID===null){this.$RID=parseInt("".appendRandomNumber(10));}return this.$RID++;};this.$makeUnique=G;this.$createBodyElement=j;this.$createStreamElement=z;this.$createIqBlock=Q;this.$createPresenceBlock=u;this.$createMessageBlock=T;this.$doXmlRequest=function(X,Y){if(X&&Y){this.$reqStack.push({callback:X,body:Y});}if(this.$reqCount>=this.maxrequests){return null;}var W=this,Z=this.$reqStack.shift();++this.$reqCount;return this.get(this.url,{callback:function(ac,ab,aa){--W.$reqCount;if(W.$reqStack.length){W.$doXmlRequest();}if(W.$isPoll){if(!ac||ac.replace(/^[\s\n\r]+|[\s\n\r]+$/g,"")==""){}else{if(ac.indexOf("<stream:stream")>-1&&ac.indexOf("</stream:stream>")==-1){ac=ac+"</stream:stream>";}ac=apf.getXmlDom(ac);if(!apf.supportNamespaces){ac.setProperty("SelectionLanguage","XPath");}}}if(ab!=apf.SUCCESS){var ad;ad=new Error(apf.formatErrorString(0,W,"XMPP Communication error","Url: "+aa.url+"\nInfo: "+aa.message));if(typeof Z.callback=="function"){Z.callback.call(W,ac,ab,aa);return true;}else{if(aa.tpModule.retryTimeout(aa,ab,W,ad)===true){return true;}}s.call(W,apf.xmpp.ERROR_CONN,aa.message,ab);throw ad;}if(typeof Z.callback=="function"){Z.callback.call(W,ac,ab,aa);}},nocache:true,useXML:!this.$isPoll,ignoreOffline:true,data:Z.body||""});};function s(Z,Y,aa){if(Z&apf.xmpp.ERROR_CONN){if(this.$retryCount==3){this.$retryCount=0;clearTimeout(this.$listener);this.$listener=null;return this.connect(this.$serverVars.username,this.$serverVars.password,this.$serverVars.login_callback,this.$serverVars.register||this.$autoRegister);}this.$retryCount++;}else{this.$retryCount=0;}var ac=Z&apf.xmpp.ERROR_AUTH,ab=Z&apf.xmpp.ERROR_CONN;clearTimeout(this.$listener);this.$listener=null;var X={username:this.$serverVars.username,server:this.url,message:Y||(ac?"Access denied. Please check your username or password.":ab?"Could not connect to server, please contact your System Administrator.":"Could not register for a new user account")},W=this.$serverVars.login_callback;if(W){delete this.$serverVars.login_callback;return W(null,aa||apf.ERROR,X);}return this.dispatchEvent(ac?"authfailure":ab?"connectionerror":"registererror",X);}this.connect=function(Z,W,Y,X){this.reset();this.$serverVars.username=Z;this.$serverVars.password=W;this.$serverVars.login_callback=Y;this.$serverVars.register=X||this.$autoRegister;this.$serverVars.previousMsg=[];this.$serverVars[n].registerAccount(Z,this.$domain);if(this.$canMuc){this.$mucRoster.registerAccount(Z,this.$domain);}this.$doXmlRequest(N,this.$isPoll?z.call(this,null,{doOpen:true,to:this.$domain,xmlns:apf.xmpp.NS.jabber,"xmlns:stream":apf.xmpp.NS.stream,version:"1.0"}):j({content:"text/xml; charset=utf-8",hold:"1",rid:this.$getRID(),to:this.$domain,route:"xmpp:jabber.org:9999",secure:"true",wait:"120",ver:"1.6","xml:lang":"en","xmpp:version":"1.0",xmlns:apf.xmpp.NS.httpbind,"xmlns:xmpp":apf.xmpp.NS.bosh}));};this.disconnect=function(W){if(this.$serverVars[D]){if(W){this.$serverVars.logout_callback=W;}if(this.$canMuc){this.leaveAllRooms();}this.$doXmlRequest(I,this.$isPoll?z.call(this,null,{doClose:true}):j({pause:120,rid:this.$getRID(),sid:this.$serverVars[t],xmlns:apf.xmpp.NS.httpbind}));}else{this.reset();if(W){W(null,apf.SUCCESS);}}};this.reset=function(){var W=this.$serverVars[n];if(W){W.reset();}if(this.$canMuc&&this.$mucRoster){this.$mucRoster.reset();}for(var X in this.$serverVars){delete this.$serverVars[X];}this.$RID=null;this.$serverVars.cnonce=B(14);this.$serverVars.nc="00000001";this.$serverVars[D]=false;this.$serverVars[n]=new apf.xmpp_roster(this.$model,this.$modelContent,this.resource);this.$serverVars.bind_count=0;this.$serverVars.mess_count=0;};function N(ac,W,Y){if(W!=apf.SUCCESS){return s.call(this,apf.xmpp.ERROR_CONN,Y.message,W);}this.$retryCount=0;if(!this.$isPoll){this.$serverVars[t]=ac.getAttribute("sid");this.$serverVars.AUTH_ID=ac.getAttribute("authid");}else{var ag=Y.http.getResponseHeader("Set-Cookie").splitSafe(";");this.$serverVars[t]=ag[0].splitSafe("=")[1];this.$serverVars.AUTH_ID=ac.firstChild.getAttribute("id");}var X=ac.getElementsByTagName("mechanisms")[0],aa=X.getAttribute("xmlns");this.$serverVars.AUTH_SASL=apf.isO3||(aa&&aa==apf.xmpp.NS.sasl);var ad=ac.getElementsByTagName("mechanism"),ab=0,Z=ad.length,af=false,ae;for(;ab<Z&&!af;ab++){ae=ad[ab].firstChild.nodeValue;if(ae=="DIGEST-MD5"||ae=="PLAIN"){this.$serverVars.AUTH_TYPE=ae;af=true;}}ad=ac.getElementsByTagName("register");for(ab=0,Z=ad.length;ab<Z;ab++){this.$serverVars.AUTH_REG=(ad[ab].getAttribute("xmlns")==apf.xmpp.NS.feature_reg);}if(!af){return s.call(this,apf.xmpp.ERROR_AUTH,"No supported authentication protocol found. We cannot continue!");}return(this.$serverVars.AUTH_REG&&this.$serverVars.register)?R.call(this):c.call(this);}function R(){var X=Q({type:"set",id:G("reg")},"<query xmlns='"+apf.xmpp.NS.register+"'><username>"+this.$serverVars.username+"</username><password>"+this.$serverVars.password+"</password></query>"),W=this;this.$doXmlRequest(function(Y){if(Y&&Y.nodeType){var Z=Y.getElementsByTagName("iq")[0];if((Z&&Z.getAttribute("type")=="error")||Y.getElementsByTagName("error").length){s.call(W,apf.xmpp.ERROR_REG,"New account registration for account '"+this.$serverVars.username+" failed.");}c.call(W);}},W.$isPoll?z.call(this,null,null,X):j({rid:this.$getRID(),sid:this.$serverVars[t],xmlns:apf.xmpp.NS.httpbind},X));}function c(){if(this.$serverVars.AUTH_SASL){var Y=this.$serverVars.AUTH_TYPE,W="<auth xmlns='"+apf.xmpp.NS.sasl+"' mechanism='"+Y+(Y=="PLAIN"?"'>"+this.$serverVars.username+"@"+this.$domain+String.fromCharCode(0)+this.$serverVars.username+String.fromCharCode(0)+this.$serverVars.password+"</auth>":"'/>");this.$doXmlRequest((Y=="ANONYMOUS"||Y=="PLAIN")?m:P,this.$isPoll?z.call(this,null,null,W):j({rid:this.$getRID(),sid:this.$serverVars[t],xmlns:apf.xmpp.NS.httpbind},W));}else{var X=Q({type:"get",id:G("auth")},"<query xmlns='"+apf.xmpp.NS.auth+"'><username>"+this.$serverVars.username+"</username></query>");this.$doXmlRequest(P,this.$isPoll?z.call(this,null,null,X):j({rid:this.$getRID(),sid:this.$serverVars[t],xmlns:apf.xmpp.NS.httpbind},X));}}function I(Z,Y,X){var W=this.$serverVars.logout_callback;this.reset();if(W){W(Z,Y,X);}}function K(ac){if(!ac||ac.getElementsByTagName("failure").length){return false;}var ab=ac.getElementsByTagName("challenge");if(ab.length&&(ab=ab[0])){var Z,W,X,Y=ab.firstChild.nodeValue,aa=apf.crypto.Base64.decode(Y).split(",");for(Z=0,W=aa.length;Z<W;Z++){X=aa[Z].split("=");this.$serverVars[X[0]]=X[1].trim().replace(/[\"\']/g,"");}}return true;}function P(aa){if(this.$serverVars.AUTH_SASL){if(!K.call(this,aa)){return s.call(this,apf.xmpp.ERROR_AUTH);}var ab=this.$serverVars.realm,ac=apf.crypto.MD5;if(!ab){this.$serverVars.realm=ab=this.$domain;}if(ab){this.$serverVars["digest-uri"]="xmpp/"+ab;}var X=ac.str_md5(this.$serverVars.username+":"+this.$domain+":"+this.$serverVars.password)+":"+this.$serverVars.nonce+":"+this.$serverVars.cnonce,W="AUTHENTICATE:"+this.$serverVars["digest-uri"],af=ac.hex_md5(ac.hex_md5(X)+":"+this.$serverVars.nonce+":"+this.$serverVars.nc+":"+this.$serverVars.cnonce+":"+this.$serverVars.qop+":"+ac.hex_md5(W));var ad=M({username:this.$serverVars.username,realm:ab,nonce:this.$serverVars.nonce,cnonce:this.$serverVars.cnonce,nc:this.$serverVars.nc,qop:this.$serverVars.qop,"digest-uri":this.$serverVars["digest-uri"],response:af,charset:this.$serverVars.charset});this.$doXmlRequest(V,this.$isPoll?z.call(this,null,null,ad):j({rid:this.$getRID(),sid:this.$serverVars[t],xmlns:apf.xmpp.NS.httpbind},ad));}else{if(aa&&aa.nodeType){var Z=aa.getElementsByTagName("iq")[0];if((Z&&Z.getAttribute("type")=="error")||aa.getElementsByTagName("error").length){return s.call(this,apf.xmpp.ERROR_AUTH);}var Y,ag=(Y=aa.getElementsByTagName("digest")&&Y[0]),ae=Q({type:"set",id:G("auth")},"<query xmlns='"+apf.xmpp.NS.auth+"'><username>"+this.$serverVars.username+"</username><resource>"+this.resource+"</resource>"+(ag?"<digest xmlns='"+apf.xmpp.NS.auth+">"+apf.crypto.SHA1(this.$serverVars.AUTH_ID+this.$serverVars.password)+"</digest>":"<password xmlns='"+apf.xmpp.NS.auth+"'>"+this.$serverVars.password+"</password>")+"</query>");this.$doXmlRequest(m,this.$isPoll?z.call(this,null,null,ae):j({rid:this.$getRID(),sid:this.$serverVars[t],xmlns:apf.xmpp.NS.httpbind},ae));}}}function V(X){if(!K.call(this,X)){return s.call(this,apf.xmpp.ERROR_AUTH);}var W=M({});this.$doXmlRequest(m,this.$isPoll?z.call(this,null,null,W):j({rid:this.$getRID(),sid:this.$serverVars[t],xmlns:apf.xmpp.NS.httpbind},W));}function m(X){if(this.$serverVars.AUTH_SASL){if(!K.call(this,X)){return s.call(this,apf.xmpp.ERROR_AUTH);}}else{if(X&&X.nodeType){var Y=X.getElementsByTagName("iq")[0];if((Y&&Y.getAttribute("type")=="error")||X.getElementsByTagName("error").length){return s.call(this,apf.xmpp.ERROR_AUTH);}delete this.$serverVars.password;}}var W=this;this.$doXmlRequest(function(Z){if(W.$isPoll||Z.getElementsByTagName("bind").length){W.bind();}},this.$isPoll?z.call(this,null,{doOpen:true,to:this.$domain,xmlns:apf.xmpp.NS.jabber,"xmlns:stream":apf.xmpp.NS.stream,version:"1.0"}):j({rid:this.$getRID(),sid:this.$serverVars[t],to:this.$domain,"xml:lang":"en","xmpp:restart":"true",xmlns:apf.xmpp.NS.httpbind,"xmlns:xmpp":apf.xmpp.NS.bosh}));}this.bind=function(){var W=Q({id:"bind_"+ ++this.$serverVars.bind_count,type:"set",xmlns:this.$isPoll?null:apf.xmpp.NS.jabber},"<bind xmlns='"+apf.xmpp.NS.bind+"'><resource>"+this.resource+"</resource></bind>");this.$doXmlRequest(l,this.$isPoll?z.call(this,null,null,W):j({rid:this.$getRID(),sid:this.$serverVars[t],xmlns:apf.xmpp.NS.httpbind},W));};function l(Y){var Z=Y.getElementsByTagName("jid")[0];if(Z){this.$serverVars[w]=Z.firstChild.nodeValue;var X=Q({from:this.$serverVars[w],id:this.$sAJAX_ID,to:this.$domain,type:"set",xmlns:apf.xmpp.NS.jabber},"<session xmlns='"+apf.xmpp.NS.session+"'/>"),W=this;this.$doXmlRequest(function(aa){i.call(W,aa);q.call(W);},this.$isPoll?z.call(this,null,null,X):j({rid:this.$getRID(),sid:this.$serverVars[t],xmlns:apf.xmpp.NS.httpbind},X));}else{s.call(this,apf.xmpp.ERROR_AUTH);}}function q(){var X=u({type:apf.xmpp.TYPE_AVAILABLE}),W=this;this.$doXmlRequest(function(Y){i.call(W,Y);F.call(W);},this.$isPoll?z.call(this,null,null,X):j({rid:this.$getRID(),sid:this.$serverVars[t],xmlns:apf.xmpp.NS.httpbind},X));}function F(){var X=Q({from:this.$serverVars[w],type:"get",id:G("roster")},"<query xmlns='"+apf.xmpp.NS.roster+"'/>"),W=this,Y=this.$serverVars;this.$doXmlRequest(function(ac){i.call(W,ac);W.$listen();var Z=Y.login_callback,ad=Y.previousMsg;if(Z){Z(null,apf.SUCCESS,{username:Y.username});delete Y.login_callback;}if(ad&&ad.length){for(var ab=0,aa=ad.length;ab<aa;ab++){W.sendMessage.apply(W,ad[ab]);}delete ad;Y.previousMsg=[];}Y[D]=true;W.dispatchEvent(D,{username:Y.username});},this.$isPoll?z.call(this,null,null,X):j({rid:this.$getRID(),sid:this.$serverVars[t],xmlns:apf.xmpp.NS.httpbind},X));}this.$listen=function(){if(this.$listening===true){return;}this.$listening=true;this.$doXmlRequest(A,this.$isPoll?z.call(this):j({rid:this.$getRID(),sid:this.$serverVars[t],xmlns:apf.xmpp.NS.httpbind},""));};function a(Z,Y,X){clearTimeout(this.$listener);this.$listener=null;if(Z||Y){if(Y!=apf.SUCCESS){return s.call(this,apf.xmpp.ERROR_CONN,X.message,Y);}else{i.call(this,Z);}}if(this.$serverVars[D]&&!this.$listening){var W=this;this.$listener=$setTimeout(function(){W.$listen();},this.$pollTimeout||0);}}this.$restartListener=a;function A(Z,Y){clearTimeout(this.$listener);this.$listener=null;i.call(this,Z);var X=(this.$listening===false);this.$listening=false;if(this.$serverVars[D]&&!X){var W=this;this.$listener=$setTimeout(function(){W.$listen();},this.$pollTimeout||0);}}function i(Y){if(Y&&Y.nodeType){this.$serverVars.previousMsg=[];var Z=Y.getElementsByTagName("message");if(Z.length){d.call(this,Z);}var X=Y.getElementsByTagName("presence");if(X.length){O.call(this,X);}var W=Y.getElementsByTagName("iq");if(W.length){U.call(this,W);}}}this.$parseData=i;function J(aa){var Y,Z=[],X=0,W=aa.childNodes.length;for(X=0;X<W;X++){if((Y=aa.childNodes[X])&&Y.nodeType==3){Z.push(Y.nodeValue);}}return Z.join("").replace(/\&quot;/g,'"');}function d(ac){var X,aa,ab,Y,ad,Z=0,W=ac.length;for(;Z<W;Z++){ab=ac[Z].getAttribute("from");ad=(ac[Z].getAttribute("type")=="groupchat");if(ab&&!ad){this.$serverVars[n].getEntityByJID(ab);}if(ac[Z].getAttribute("type")=="chat"||ad){Y=ac[Z].getElementsByTagName("body")[0];if(!(Y&&Y.childNodes.length)){continue;}aa=ac[Z].getAttribute("from");X=J(Y);if(ad&&aa==this.$mucRoster.fullJID){return;}if((ad?this.$mucRoster:this.$serverVars[n]).updateMessageHistory(aa,X)){this.dispatchEvent("receivechat",{from:aa,message:X});}}else{if(ac[Z].getAttribute("type")=="normal"){Y=ac[Z].getElementsByTagName("body")[0];if(!(Y&&Y.childNodes.length)){continue;}X=J(Y);this.dispatchEvent("datachange",{data:X});}}}}function O(Y){for(var af=0,ac=Y.length;af<ac;af++){var ag=Y[af].getAttribute("from"),ae=Y[af].getElementsByTagName("x"),aa=(ag.indexOf(this.$mucDomain)>-1);if(ae.length){for(var Z,ad=0,ab=ae.length;ad<ab;ad++){switch(ae[ad].getAttribute("xmlns")){case apf.xmpp.NS.muc_user:if(this.$getStatusCode(ae[ad],201)){this.$mucSignal(apf.xmpp_muc.ROOM_CREATE,ag);break;}if(!this.$isRoom(ag)||this.$getStatusCode(ae[ad],110)){break;}Z=ae[ad].getElementsByTagName("item")[0];if(!Z){break;}this.$mucRoster.getEntityByJID(ag,{roomJID:Z.getAttribute("jid"),affiliation:Z.getAttribute("affiliation"),role:Z.getAttribute("role"),status:Y[af].getAttribute("type")||apf.xmpp.TYPE_AVAILABLE});break;}}}if(ag&&!aa){var ah=this.$serverVars[n],X=ah.getEntityByJID(ag),W=Y[af].getAttribute("type");if(W==apf.xmpp.TYPE_SUBSCRIBE){E.call(this,Y[af].getAttribute("from"));}if(X){ah.update(X,W||apf.xmpp.TYPE_AVAILABLE);}}}}function U(ao){for(var al=0,ag=ao.length;al<ag;al++){if(ao[al].getAttribute("type")!="result"&&ao[al].getAttribute("type")!="error"){continue;}var Y=ao[al].getElementsByTagName("query"),an=ao[al].getAttribute("from");for(var aj=0,ah=Y.length;aj<ah;aj++){var ad,ai,ae;switch(Y[aj].getAttribute("xmlns")){case apf.xmpp.NS.roster:ad=Y[aj].getElementsByTagName("item");var aa=this.$serverVars[n],ac=[];for(ai=0,ae=ad.length;ai<ae;ai++){var am=ad[ai].getAttribute("subscription"),ak=(ad[ai].childNodes.length>0)?ad[ai].firstChild.firstChild.nodeValue:"",af=ad[ai].getAttribute("jid");var X=aa.getEntityByJID(af,{subscription:am,group:ak});if(am==apf.xmpp.SUBSCR_TO||am==apf.xmpp.SUBSCR_BOTH){ac.push(X);}else{if(X.subscription==apf.xmpp.TYPE_SUBSCRIBED){C.call(this,X);}}}if(ac.length){this.requestPresence(ac);}break;case apf.xmpp.NS.disco_items:if(!this.$canMuc){break;}var W=ao[al].getElementsByTagName("error");if(W.length&&parseInt(W[0].getAttribute("code"))==404){this.$mucSignal(apf.xmpp_muc.ROOM_NOTFOUND,an);break;}ad=Y[aj].getElementsByTagName("item");var ab=this.$addRoom(an,an.split("@")[0]),Z;this.$mucSignal(apf.xmpp_muc.ROOM_EXISTS,an);for(ai=0,ae=ad.length;ai<ae;ai++){Z=ad[ai].getAttribute("jid");if(Z.indexOf("/")!=-1){this.$addRoomOccupant(Z);}else{if(ad[ai].hasAttribute("name")){ab.subscription=ad[ai].getAttribute("name");}}}break;case apf.xmpp.NS.muc_user:break;case apf.xmpp.NS.muc_owner:this.$mucSignal(apf.xmpp_muc.ROOM_CREATE,an);break;default:break;}}}}this.setPresence=function(X,W,Y){if(!this.$serverVars[D]){return false;}this.$doXmlRequest(restartlistener,j({rid:this.$getRID(),sid:this.$serverVars[t],xmlns:apf.xmpp.NS.httpbind},u({type:X||apf.xmpp.TYPE_AVAILABLE,status:W,custom:Y})));};this.requestPresence=function(ab){if(!this.$serverVars[D]){return false;}var X=this.$serverVars[n];if(typeof ab=="string"){ab=X.getEntityByJID(ab);}if(!ab){return false;}var Y,aa=[];if(apf.isArray(ab)){for(var Z=0,W=ab.length;Z<W;Z++){aa.push(u({type:apf.xmpp.TYPE_PROBE,to:ab[Z].fullJID,from:X.fullJID}));}}else{aa.push(u({type:apf.xmpp.TYPE_PROBE,to:ab.fullJID,from:X.fullJID}));}Y=aa.join("");this.$doXmlRequest(a,this.$isPoll?z.call(this,null,null,Y):j({rid:this.$getRID(),sid:this.$serverVars[t],xmlns:apf.xmpp.NS.httpbind},Y));};this.addContact=function(aa,ab){if(typeof aa!="string"){return false;}var Z=this.$serverVars[n],X=Z.getEntityByJID(aa);if(X&&(X.subscription==apf.xmpp.SUBSCR_TO||X.subscription==apf.xmpp.SUBSCR_BOTH)){return this.requestPresence(X);}var Y=Q({type:"set",id:G("set")},"<query xmlns='"+apf.xmpp.NS.roster+"'><item jid='"+aa+"' /></query>"),W=this;this.$doXmlRequest(function(ad){i.call(W,ad);W.$listen();var ac=u({type:apf.xmpp.TYPE_SUBSCRIBE,to:aa});W.$doXmlRequest(function(af){if(!af||!af.nodeType){return !W.$isPoll?s.call(W,apf.xmpp.ERROR_CONN,null,apf.OFFLINE):null;}W.$listen();var ae=af.getElementsByTagName("presence")[0];if(ae.getAttribute("error")){ac=u({type:apf.xmpp.TYPE_UNSUBSCRIBE,to:aa});W.$doXmlRequest(function(ai,ah,ag){if(ab){ab.call(W,ai,ah,ag);}a.call(W,ai,ah,ag);},W.$isPoll?z.call(this,null,null,ac):j({rid:this.$getRID(),sid:this.$serverVars[t],xmlns:apf.xmpp.NS.httpbind},ac));}},W.$isPoll?z.call(W,null,null,ac):j({rid:W.$getRID(),sid:W.$serverVars[t],xmlns:apf.xmpp.NS.httpbind},ac));},this.$isPoll?z.call(this,null,null,Y):j({rid:this.$getRID(),sid:this.$serverVars[t],xmlns:apf.xmpp.NS.httpbind},Y));};function E(Y){if(this.$autoConfirm){var W=Q({from:this.$serverVars[w],type:"get",id:G("roster")},"<query xmlns='"+apf.xmpp.NS.roster+"'><item jid='"+Y+"' /></query>")+u({type:apf.xmpp.TYPE_SUBSCRIBED,to:Y});this.$doXmlRequest(a,this.$isPoll?z.call(this,null,null,W):j({rid:this.$getRID(),sid:this.$serverVars[t],xmlns:apf.xmpp.NS.httpbind},W));}if(this.$autoDeny){var X=u({type:apf.xmpp.TYPE_UNSUBSCRIBED,to:Y});this.$doXmlRequest(a,this.$isPoll?z.call(this,null,null,X):j({rid:this.$getRID(),sid:this.$serverVars[t],xmlns:apf.xmpp.NS.httpbind},X));}}function C(W){var X=u({type:apf.xmpp.TYPE_SUBSCRIBED,to:W.jid});this.$doXmlRequest(a,this.$isPoll?z.call(this,null,null,X):j({rid:this.$getRID(),sid:this.$serverVars[t],xmlns:apf.xmpp.NS.httpbind},X));}var o={online:apf.xmpp.STATUS_ONLINE,offline:apf.xmpp.STATUS_OFFLINE,away:apf.xmpp.STATUS_AWAY,xa:apf.xmpp.STATUS_XA,extendedaway:apf.xmpp.STATUS_XA,onvacation:apf.xmpp.STATUS_XA,dnd:apf.xmpp.STATUS_DND,donotdisturb:apf.xmpp.STATUS_DND,invisible:apf.xmpp.STATUS_INVISIBLE,ffc:apf.xmpp.STATUS_FFC,chatty:apf.xmpp.STATUS_FFC,freeforchat:apf.xmpp.STATUS_FFC};this.setStatus=function(W){W=o[W]||apf.xmpp.STATUS_ONLINE;return this.setPresence(W,W);};this.sendMessage=function(ad,ag,aa,ab,af){if(!ag){return false;}var ac=this;if(typeof apf.offline!="undefined"&&!apf.offline.onLine){if(apf.offline.queue.enabled){var X={to:ad,message:ag,thread:aa,callback:af,type:ab,retry:function(){ac.sendMessage(this.to,this.message,this.thread,this.type,this.callback);},$object:[this.name,"new apf.xmpp()"],$retry:"this.object.sendMessage(this.to, this.message,                         this.thread, this.type, this.callback)"};apf.offline.queue.add(X);return true;}}if(!this.$serverVars[D]){return false;}var ae=(this.$canMuc&&ab=="groupchat"),Z=Array.prototype.slice.call(arguments),W;if(!ae){W=this.$serverVars[n].getEntityByJID(ad);}if(!W){return false;}var Y=T.call(this,{type:ab||apf.xmpp.MSG_CHAT,to:ad,thread:aa,"xml:lang":"en"},"<![CDATA["+ag+"]]>");this.$doXmlRequest(function(aj,ai,ah){if(af){af.call(ac,aj,ai,ah);}ac.$serverVars.previousMsg=Z;a.call(ac,aj,ai,ah);},this.$isPoll?z.call(this,null,null,Y):j({rid:this.$getRID(),sid:this.$serverVars[t],xmlns:apf.xmpp.NS.httpbind},Y));};this.sendRSB=function(Z){var X=this.$serverVars[n];if(!X){return;}var aa=X.getAllEntities(apf.xmpp.TYPE_AVAILABLE),Y=0,W=aa.length;for(;Y<W;Y++){this.sendMessage(aa[Y].bareJID,Z,null,apf.xmpp.MSG_NORMAL);}};this.$headerHook=function(W){W.setRequestHeader("Host",this.$domain);W.setRequestHeader("Content-Type",this.$isPoll?"application/x-www-form-urlencoded":"text/xml; charset=utf-8");};this.addEventListener("DOMNodeRemovedFromDocument",function(){this.disconnect();});this.exec=function(Y,W,X){switch(Y){case"login":this.connect(W[0],W[1],X);break;case"logout":break;case"notify":this.sendMessage(W[1],W[0],W[2],W[3],X);break;default:break;}};}).call(apf.xmpp.prototype=new apf.Teleport());apf.aml.setElement("xmpp",apf.xmpp);apf.xmpp.NS={sasl:"urn:ietf:params:xml:ns:xmpp-sasl",httpbind:"http://jabber.org/protocol/httpbind",feature_reg:"http://jabber.org/features/iq-register",bosh:"urn:xmpp:xbosh",jabber:"jabber:client",bind:"urn:ietf:params:xml:ns:xmpp-bind",session:"urn:ietf:params:xml:ns:xmpp-session",auth:"jabber:iq:auth",roster:"jabber:iq:roster",register:"jabber:iq:register",data:"jabber:x:data",stream:"http://etherx.jabber.org/streams",disco_info:"http://jabber.org/protocol/disco#info",disco_items:"http://jabber.org/protocol/disco#items",muc:"http://jabber.org/protocol/muc",muc_user:"http://jabber.org/protocol/muc#user",muc_owner:"http://jabber.org/protocol/muc#owner"};apf.xmpp.CONN_POLL=1;apf.xmpp.CONN_BOSH=2;apf.xmpp.ERROR_AUTH=4;apf.xmpp.ERROR_CONN=8;apf.xmpp.ERROR_MUC=16;apf.xmpp.ERROR_REG=17;apf.xmpp.SUBSCR_FROM="from";apf.xmpp.SUBSCR_TO="to";apf.xmpp.SUBSCR_BOTH="both";apf.xmpp.SUBSCR_NONE="none";apf.xmpp.TYPE_AVAILABLE="";apf.xmpp.TYPE_UNAVAILABLE="unavailable";apf.xmpp.TYPE_PROBE="probe";apf.xmpp.TYPE_SUBSCRIBED="subscribed";apf.xmpp.TYPE_SUBSCRIBE="subscribe";apf.xmpp.TYPE_UNSUBSCRIBE="unsubscribe";apf.xmpp.TYPE_UNSUBSCRIBED="unsubscribed";apf.xmpp.STATUS_ONLINE="online";apf.xmpp.STATUS_OFFLINE="offline";apf.xmpp.STATUS_SHOW="show";apf.xmpp.STATUS_AWAY="away";apf.xmpp.STATUS_XA="xa";apf.xmpp.STATUS_DND="dnd";apf.xmpp.STATUS_INVISIBLE="invisible";apf.xmpp.STATUS_FFC="chat";apf.xmpp.MSG_CHAT="chat";apf.xmpp.MSG_GROUPCHAT="groupchat";apf.xmpp.MSG_ERROR="error";apf.xmpp.MSG_HEADLINE="headline";apf.xmpp.MSG_NORMAL="normal";apf.actiontracker=function(c,a){this.$init(a||"actiontracker",apf.NODE_HIDDEN,c);this.$stackDone=[];this.$stackUndone=[];this.$execStack=[];};(function(){this.$lastExecStackItem=null;this.realtime=true;this.undolength=0;this.redolength=0;this.$booleanProperties={};this.$booleanProperties.realtime=true;this.$supportedProperties=["realtime","undolength","redolength","alias"];this.$handlePropSet=function(i,d,c){switch(i){case"undolength":this.undolength=this.$stackDone.length;break;case"redolength":this.redolength=this.$stackUndone.length;break;default:this[i]=d;}};this.addEventListener("DOMNodeInsertedIntoDocument",function(c){if(this.parentNode){this.parentNode.$at=this;}});this.define=function(d,c){apf.actiontracker.actions[d]=c;};this.getParent=function(){return this.parentNode&&this.parentNode.getActionTracker?this.parentNode.getActionTracker(true):(apf.window.$at!=this?apf.window.$at:null);};this.execute=function(c){if(this.dispatchEvent("beforechange",c)===false){return;}var i=new apf.UndoData(c,this);if(c.action){apf.actiontracker.actions[c.action](i,false,this);}i.id=this.$stackDone.push(i)-1;this.setProperty("undolength",this.$stackDone.length);if(typeof apf.offline!="undefined"){var d=apf.offline.transactions;if(d.doStateSync){d.addAction(this,i,"undo");d.clearActions(this,"redo");}}if(i.multiple){this.$addToQueue(i.multiple,false,true);}else{this.$addToQueue(i,false);}this.$stackUndone.length=0;this.setProperty("redolength",this.$stackUndone.length);this.dispatchEvent("afterchange",{action:"do"});return i;};this.$addActionGroup=function(c,i){var d=new apf.UndoData("group",null,[apf.copyArray(c,UndoData),apf.copyArray(i,UndoData)]);this.$stackDone.push(d);this.setProperty("undolength",this.$stackDone.length);this.dispatchEvent("afterchange",{action:"group",done:c});};this.purge=function(d,c){if(true){if(this.$execStack.length){this.$execStack[0].undoObj.saveChange(this.$execStack[0].undo,this);this.$lastExecStackItem=this.$execStack[this.$execStack.length-1];}}else{if(parent){this.reset();}}};this.reset=function(){this.$stackDone.length=this.$stackUndone.length=0;this.setProperty("undolength",0);this.setProperty("redolength",0);this.dispatchEvent("afterchange",{action:"reset"});};this.undo=function(i,d,c){a.call(this,i,d,true,c);};this.redo=function(i,d,c){a.call(this,i,d,false,c);};function a(c,o,m,n){var l=m?this.$stackDone:this.$stackUndone,q=m?this.$stackUndone:this.$stackDone;if(!l.length){return;}if(o){var j=l[c];if(!j){return;}l.length--;q.push(j);if(typeof apf.offline!="undefined"&&apf.offline.transactions.doStateSync){apf.offline.transactions.removeAction(this,true,m?"undo":"redo");apf.offline.transactions.addAction(this,j,m?"redo":"undo");}if(j.action){apf.actiontracker.actions[j.action](j,m,this);}if(!n){if(j.multiple){this.$addToQueue(j.multiple,m,true);}else{this.$addToQueue(j,m);}}this.setProperty("undolength",this.$stackDone.length);this.setProperty("redolength",this.$stackUndone.length);return j;}if(this.dispatchEvent("beforechange")===false){return;}if(c==-1){c=l.length;}if(!c){c=1;}var d=0;while(d<c&&l.length>0){if(!l[l.length-1]){l.length--;this.$stackDone=[];this.$stackUndone=[];if(typeof apf.offline!="undefined"){var s=apf.offline.transactions;if(s.doStateSync){s.clear("undo|redo");}}return false;}else{a.call(this,l.length-1,true,m,n);d++;}}this.dispatchEvent("afterchange",{action:m?"undo":"redo",rollback:n});}this.$receive=function(j,i,c,d,m){if(i==apf.TIMEOUT&&c.tpModule.retryTimeout(c,i,this)===true){return true;}if(i!=apf.SUCCESS){if(this.dispatchEvent("actionfail",apf.extend(c,{state:i,message:"Could not sent Action RPC request for control "+this.name+"["+this.localName+"] \n\n"+c.message,bubbles:true}))===false){return true;}if(typeof apf.offline!="undefined"&&!apf.offline.reloading){this.undo(d.id,c.userdata,true);}if(m){m(!c.userdata);}if(!c.userdata){this.$execStack=[];var l=new Error(apf.formatErrorString(0,this,"Executing action","Error sending action to the server:\n"+(c.url?"Url:"+c.url+"\n\n":"")+c.message));if((d&&d.xmlActionNode||c.amlNode||apf).dispatchEvent("error",apf.extend({error:l,state:i,bubbles:true},c))===false){return;}throw l;}}else{this.dispatchEvent("actionsuccess",apf.extend(c,{state:i,bubbles:true},c));d.processRsbQueue();if(m){m();}}this.$queueNext(d,m);};this.$addToQueue=function(j,c,n){if(!n&&this.$execStack.length&&!j.state&&this.$execStack[this.$execStack.length-1].undoObj==j){this.$execStack.length--;if(typeof apf.offline!="undefined"&&apf.offline.transactions.enabled){apf.offline.transactions.removeAction(this,true,"queue");}j.clearRsbQueue();return;}if(n){var l,m=this.$execStack.shift();for(var d=0;d<j.length;d++){l=j[d];this.$execStack.unshift({undoObj:(l.tagName?l:new apf.UndoData(l,this)).preparse(c,this),undo:c});}if(m){this.$execStack.unshift(m);}return;}var m={undoObj:j.preparse(c,this),undo:c};this.$execStack.push(m)-1;if(typeof apf.offline!="undefined"&&apf.offline.transactions.enabled){apf.offline.transactions.addAction(this,m,"queue");}if(this.$execStack.length==1&&this.realtime){j.saveChange(c,this);}};this.$queueNext=function(d,i){if(!this.$execStack[0]||this.$execStack[0].undoObj!=d){throw new Error(apf.formatErrorString(0,this,"Executing Next                 action in queue","The execution stack was corrupted. This is                 a fatal error. The application should be restarted. You will                 lose all your changes. Please contact the administrator."));}d.state=null;var c=this.$execStack.shift();if(typeof apf.offline!="undefined"&&apf.offline.transactions.enabled){apf.offline.transactions.removeAction(this,null,"queue");}if(!this.$execStack[0]||c==this.$lastExecStackItem){return;}this.$execStack[0].undoObj.saveChange(this.$execStack[0].undo,this,i);};this.$loadQueue=function(c,d){if(d=="queue"){this.$execStack=c;}else{if(d=="undo"){this.$stackDone=c;}else{if(d=="redo"){this.$stackUndone=c;}}}};this.$getQueueLength=function(){return this.$execStack.length;};this.$startQueue=function(c){if(!this.$execStack[0]||this.$execStack[0].undoObj.state){return false;}this.$execStack[0].undoObj.saveChange(this.$execStack[0].undo,this,c);};}).call(apf.actiontracker.prototype=new apf.AmlElement());apf.aml.setElement("actiontracker",apf.actiontracker);apf.UndoData=function(j,c){this.localName="UndoData";this.extra={};this.rsbQueue={};apf.extend(this,j);if(c){this.at=c;}else{if(j&&j.tagName=="UndoData"){this.args=j.args.slice();this.rsbArgs=j.rsbArgs.slice();}else{this.selNode=this.selNode||(this.action=="removeNode"?this.args[0]:(this.amlNode?this.amlNode.selected:null));}}var i,a=this;var d;this.$export=function(){if(d){return d;}d={action:this.action,rsbModel:this.rsbModel?this.rsbModel.name:null,rsbQueue:this.rsbQueue,at:this.at.name,timestamp:this.timestamp,parsed:i?i.parsed:null,userdata:i?i.userdata:null,extra:{}};var q=this.rsbModel?this.rsbModel.rsb:apf.remote;var t=(typeof apf.offline!="undefined"&&apf.offline.sLookup)?apf.offline.sLookup:(apf.offline.sLookup={});if(!t.count){t.count=0;}var w,u,s=this.args.slice();for(var n=0;n<s.length;n++){if(s[n]&&s[n].nodeType){if(!d.argsModel){var o=apf.nameserver.get("model",apf.xmldb.getXmlDocId(s[n]));if(o){d.argsModel=o.name||o.$uniqueId;}}s[n]=m(s[n]);}}var z,l;for(l in this.extra){z=this.extra[l];d.extra[l]=z&&z.nodeType?m(z):z;}d.args=s;return d;function m(B){if(B.nodeType==2||apf.isChildOf(o.data,B,true)){u=B.getAttribute(apf.xmldb.xmlIdTag);return{xpath:q.xmlToXpath(B,o.data,true),lookup:u};}else{var A=B;while(A.parentNode&&A.parentNode.nodeType==1){A=B.parentNode;}u=A.getAttribute(apf.xmldb.xmlIdTag);if(!u){u="serialize"+t.count++;A.setAttribute(apf.xmldb.xmlIdTag,u);}var C={xpath:q.xmlToXpath(B,A,true),lookup:u};if(!t[u]){A.setAttribute(apf.xmldb.xmlDocTag,apf.xmldb.getXmlDocId(A));t[u]=A;C.xml=A.xml||A.serialize();}return C;}}};this.$import=function(){if(this.rsbModel){this.rsbModel=apf.nameserver.get("model",this.rsbModel);}if(this.argsModel){var s=apf.nameserver.get("model",this.argsModel)||apf.lookup(this.argsModel);var w=(typeof apf.offline!="undefined"&&apf.offline.sLookup)?apf.offline.sLookup:(apf.offline.sLookup={});if(!w.count){w.count=0;}var u=this.args,t=this.rsbModel?this.rsbModel.rsb:apf.remote,z,o,n,A,m;for(o=0,n=u.length;o<n;o++){if(u[o]&&u[o].xpath){u[o]=q(u[o],s);}}for(m in this.extra){A=this.extra[m];if(A&&A.xpath){this.extra[m]=q(A,s);}}this.args=u;}i={undoObj:this,userdata:this.userdata,parsed:this.parsed};if(this.timestamp){i.actionstart=this.timestamp;i.headers={"X-JPF-ActionStart":this.timestamp};}return this;function q(B,l){if(B.xml){z=apf.xmldb.getXml(B.xml);w[z.getAttribute(apf.xmldb.xmlIdTag)]=z;}else{if(B.lookup){z=w[B.lookup];}else{z=null;}}return t.xpathToXml(B.xpath,z||l.data);}};this.processRsbQueue=function(){if(this.rsbModel){this.rsbModel.rsb.processQueue(this);}};this.clearRsbQueue=function(){this.rsbQueue=this.rsbModel=null;};this.saveChange=function(m,l,q){if(this.action=="group"){var o=this.args[1];l.$addToQueue(o,m,true);return l.$queueNext(this);}var n;if(this.xmlActionNode){n=this.xmlActionNode.getAttribute(m?"undo":"set");if(m&&!n){n=this.xmlActionNode.getAttribute("set");}}if(!n){this.processRsbQueue();return l.$queueNext(this);}this.state=m?"restoring":"saving";if(i._pc==-2){return l.$receive(null,apf.SUCCESS,{amlNode:this.amlNode},this,q);}i.callback=function(u,t,s){s.amlNode=a.amlNode;return l.$receive(u,t,s,a,q);};i.ignoreOffline=true;apf.saveData(n,i);};this.preparse=function(m,l,n){var o;if(this.xmlActionNode){o=this.xmlActionNode.getAttribute(m?"undo":"set");if(m&&!o){o=this.xmlActionNode.getAttribute("set");}}if(!o){return this;}i=apf.extend({xmlNode:this.action=="multicall"?this.args[0].xmlNode:this.selNode||this.xmlNode,userdata:apf.isTrue(this.xmlActionNode.getAttribute("ignore-fail")),multicall:n,undo:m,_pc:true,callback:function(t,s,q){i._pc=-2;}},this.extra);if(this.timestamp){i.actionstart=this.timestamp;i.headers={"X-JPF-ActionStart":this.timestamp};}apf.saveData(o,i);if(i._pc===true){i._pc=-1;}return this;};};apf.actiontracker.actions={setTextNode:function(d,a){var c=d.args;if(!a){apf.xmldb.setTextNode(c[0],c[1],c[2],d);}else{apf.xmldb.setTextNode(c[0],d.extra.oldValue,c[2]);}},setAttribute:function(d,a){var c=d.args;if(!a){d.extra.name=c[1];d.extra.oldValue=c[0].getAttribute(c[1]);apf.xmldb.setAttribute(c[0],c[1],c[2],c[3],d);}else{if(!d.extra.oldValue){apf.xmldb.removeAttribute(c[0],c[1]);}else{apf.xmldb.setAttribute(c[0],c[1],d.extra.oldValue,c[3]);}}},removeAttribute:function(d,a){var c=d.args;if(!a){d.extra.name=c[1];d.extra.oldValue=c[0].getAttribute(c[1]);apf.xmldb.removeAttribute(c[0],c[1],c[2],d);}else{apf.xmldb.setAttribute(c[0],c[1],d.extra.oldValue,c[2]);}},setAttributes:function(i,c){var j,d=i.args;if(!c){var a={};for(j in d[1]){a[j]=d[0].getAttribute(j);d[0].setAttribute(j,d[1][j]);}i.extra.oldValues=a;apf.xmldb.applyChanges("attribute",d[0],i);}else{for(j in i.oldValues){if(!i.extra.oldValues[j]){d[0].removeAttribute(j);}else{d[0].setAttribute(j,i.extra.oldValues[j]);}}apf.xmldb.applyChanges("attribute",d[0],i);}},replaceNode:function(d,a){var c=d.args;if(!a){apf.xmldb.replaceNode(c[1],c[0],c[2],d);}else{apf.xmldb.replaceNode(c[0],c[1],c[2],d);}},addChildNode:function(d,a){var c=d.args;if(!a){apf.xmldb.addChildNode(c[0],c[1],c[2],c[3],d);}else{apf.xmldb.removeNode(d.extra.addedNode);}},appendChild:function(d,a){var c=d.args;if(!a){apf.xmldb.appendChild(c[0],c[1],c[2],c[3],c[4],d);}else{apf.xmldb.removeNode(d.xmlNode);}},moveNode:function(d,a){var c=d.args;if(!a){apf.xmldb.moveNode(c[0],c[1],c[2],c[3],d);}else{apf.xmldb.moveNode(d.extra.oldParent,c[1],d.extra.beforeNode,c[3]);}},removeNode:function(d,a){var c=d.args;if(!a){apf.xmldb.removeNode(c[0],c[1],d);}else{apf.xmldb.appendChild(d.extra.parent,d.extra.removedNode,d.extra.beforeNode);}},removeNodeList:function(j,a){if(a){var l=j.extra.removeList;for(var c=l.length-1;c>=0;c--){apf.xmldb.appendChild(l[c].pNode,l[c].removedNode,l[c].beforeNode);}}else{apf.xmldb.removeNodeList(j.args,j);}},setUndoObject:function(d,a){var c=d.args;d.xmlNode=c[0];},group:function(i,d,a){if(!i.$stackDone){var c=i.args[0];i.$stackDone=c;i.$stackUndone=[];}a[d?"undo":"redo"](i.$stackDone.length,false,i.$stackDone,i.$stackUndone);},setProperty:function(d,a){var c=d.args;if(!a){d.extra.oldValue=c[0][c[1]];c[0].setProperty(c[1],c[2],c[3],c[4]);}else{c[0].setProperty(c[1],d.extra.oldValue);}},setValueByXpath:function(i,a){var d=i.args;if(!a){if(i.extra.newNode){apf.xmldb.appendChild(i.extra.parentNode,i.extra.newNode);}else{var c=[];apf.setNodeValue(d[0],d[1],true,{undoObj:i,xpath:d[2],newNodes:c,forceNew:d[3]});i.extra.newNode=c[0];}}else{if(i.extra.newNode){i.extra.parentNode=i.extra.newNode.parentNode;apf.xmldb.removeNode(i.extra.newNode);}else{apf.setNodeValue(i.extra.appliedNode,i.extra.oldValue,true);}}},multicall:function(m,c,a){var l=m.args;var j=apf.xmldb.delayUpdate;apf.xmldb.delayUpdate=true;if(!c){for(var d=0;d<l.length;d++){if(!l[d].extra){l[d].extra={};}if(l[0].rsbModel){l[d].rsbQueue=l[0].rsbQueue;}apf.actiontracker.actions[l[d].func](l[d],false,a);}if(l[0].rsbModel){m.rsbModel=l[0].rsbModel;m.rsbQueue=l[0].rsbQueue;}}else{for(var d=l.length-1;d>=0;d--){apf.actiontracker.actions[l[d].func](l[d],true,a);}}apf.xmldb.delayUpdate=j;},addRemoveNodes:function(j,a){var d=j.args;if(!a){for(var c=0;c<d[1].length;c++){apf.xmldb.appendChild(d[0],d[1][c],null,null,null,j);}for(var c=0;c<d[2].length;c++){apf.xmldb.removeNode(d[2][c],null,j);}}else{for(var c=0;c<d[2].length;c++){apf.xmldb.appendChild(d[0],d[2][c]);}for(var c=0;c<d[1].length;c++){apf.xmldb.removeNode(d[1][c]);}}}};apf.param=function(c,a){this.$init(a||"param",apf.NODE_HIDDEN,c);};apf.param.prototype=new apf.AmlElement();apf.param.prototype.$parsePrio="002";apf.aml.setElement("variable",apf.param);apf.aml.setElement("param",apf.param);apf.spinner=function(c,a){this.$init(a||"spinner",apf.NODE_VISIBLE,c);this.max=64000;this.min=-64000;this.focused=false;this.value=0;};(function(){this.implement(apf.DataAction);this.$supportedProperties.push("width","value","max","min","caption");this.$propHandlers.value=function(a){a=parseInt(a)||0;this.value=this.oInput.value=(a>this.max?this.max:(a<this.min?this.min:a));};this.$propHandlers.min=function(a){if(!(a=parseInt(a))){return;}this.min=a;if(a>this.value){this.change(a);}};this.$propHandlers.max=function(a){if(!(a=parseInt(a))){return;}this.max=a;if(a<this.value){this.change(a);}};this.setValue=function(a){this.setProperty("value",a,false,true);};this.getValue=function(){return this.value;};this.$enable=function(){this.oInput.disabled=false;this.$setStyleClass(this.oInput,"",["inputDisabled"]);};this.$disable=function(){this.oInput.disabled=true;this.$setStyleClass(this.oInput,"inputDisabled");};this.$focus=function(a){if(!this.$ext||this.disabled||this.focused){return;}if(apf.hasFocusBug){apf.sanitizeTextbox(this.oInput);}this.focused=true;this.$setStyleClass(this.oInput,"focus");this.$setStyleClass(this.$buttonPlus,"plusFocus");this.$setStyleClass(this.$buttonMinus,"minusFocus");if(this.oLeft){this.$setStyleClass(this.oLeft,"leftFocus");}};this.$blur=function(a){if(!this.$ext&&!this.focused){return;}this.$setStyleClass(this.oInput,"",["focus"]);this.$setStyleClass(this.$buttonPlus,"",["plusFocus"]);this.$setStyleClass(this.$buttonMinus,"",["minusFocus"]);if(this.oLeft){this.$setStyleClass(this.oLeft,""["leftFocus"]);}this.focused=false;};this.addEventListener("keydown",function(d){var a=d.keyCode,c=(a<8||(a>8&&a<37&&a!==12)||(a>40&&a<46)||(a>46&&a<48)||(a>57&&a<96)||(a>105&&a<109)||(a>109&&a!==189));if(c){return false;}},true);this.addEventListener("keyup",function(a){this.setValue(this.oInput.value);},true);this.$draw=function(){var a=this;this.$ext=this.$getExternal(null,null,function(l){l.setAttribute("onmousedown",'this.host.dispatchEvent("mousedown", {htmlEvent : event});');l.setAttribute("onmouseup",'this.host.dispatchEvent("mouseup", {htmlEvent : event});');l.setAttribute("onclick",'this.host.dispatchEvent("click", {htmlEvent : event});');});this.$int=this.$getLayoutNode("main","container",this.$ext);this.oInput=this.$getLayoutNode("main","input",this.$ext);this.$buttonPlus=this.$getLayoutNode("main","buttonplus",this.$ext);this.$buttonMinus=this.$getLayoutNode("main","buttonminus",this.$ext);this.oLeft=this.$getLayoutNode("main","left",this.$ext);apf.sanitizeTextbox(this.oInput);var j,d=(!document.compatMode||document.compatMode=="CSS1Compat")?document.html:document.body,i=0;this.oInput.value=this.value;this.oInput.onmousedown=function(t){if(a.disabled){return;}t=t||window.event;clearTimeout(j);var l,z=parseInt(this.value)||0,m=0,q=t.clientY,s=a.$int.offsetTop,u=a.$int.offsetLeft,n=a.$int.offsetWidth,A=a.$int.offsetHeight,o=function(){clearTimeout(j);j=$setTimeout(o,10);if(!m){return;}l=z+m;if(l<=a.max&&l>=a.min){z+=m;a.oInput.value=Math.round(z);}else{a.oInput.value=m<0?a.min:a.max;}};o();function w(D){D=D||window.event;var B=D.pageX||D.clientX+(d?d.scrollLeft:0),E=D.pageY||D.clientY+(d?d.scrollTop:0),C=q-E;if((E>s&&B>u)&&(E<s+A&&B<u+n)){m=0;return;}m=Math.pow(Math.min(200,Math.abs(C))/10,2)/10;if(C<0){m=-1*m;}}document.onmousemove=w;document.onmouseup=function(C){clearTimeout(j);var B=parseInt(a.oInput.value);if(B!=a.value){a.change(B);}document.onmousemove=document.onmouseup=null;};};var c=false;this.$buttonPlus.onmousedown=function(n){if(a.disabled){return;}n=n||window.event;c=true;var m=(parseInt(a.oInput.value)||0)+1,l=function(){clearTimeout(j);j=$setTimeout(l,50);i++;m+=Math.pow(Math.min(200,i)/10,2)/10;m=Math.round(m);a.oInput.value=m<=a.max?m:a.max;};apf.setStyleClass(this,"plusDown",["plusHover"]);l();};this.$buttonMinus.onmousedown=function(n){if(a.disabled){return;}n=n||window.event;c=true;var m=(parseInt(a.oInput.value)||0)-1,l=function(){clearTimeout(j);j=$setTimeout(l,50);i++;m-=Math.pow(Math.min(200,i)/10,2)/10;m=Math.round(m);a.oInput.value=m>=a.min?m:a.min;};apf.setStyleClass(this,"minusDown",["minusHover"]);l();};this.$buttonMinus.onmouseout=function(m){if(a.disabled){return;}clearTimeout(j);i=0;var l=parseInt(a.oInput.value);if(l!=a.value){a.change(l);}apf.setStyleClass(this,"",["minusHover"]);if(!a.focused){a.$blur(m);}};this.$buttonPlus.onmouseout=function(m){if(a.disabled){return;}clearTimeout(j);i=0;var l=parseInt(a.oInput.value);if(l!=a.value){a.change(l);}apf.setStyleClass(this,"",["plusHover"]);if(!a.focused){a.$blur(m);}};this.$buttonMinus.onmouseover=function(l){if(a.disabled){return;}apf.setStyleClass(this,"minusHover");};this.$buttonPlus.onmouseover=function(l){if(a.disabled){return;}apf.setStyleClass(this,"plusHover");};this.$buttonPlus.onmouseup=function(m){if(a.disabled){return;}m=m||event;m.cancelBubble=true;apf.setStyleClass(this,"plusHover",["plusDown"]);clearTimeout(j);i=0;var l=parseInt(a.oInput.value);if(!c){l++;a.oInput.value=l;}else{c=false;}if(l!=a.value){a.change(l);}};this.$buttonMinus.onmouseup=function(m){if(a.disabled){return;}m=m||event;m.cancelBubble=true;apf.setStyleClass(this,"minusHover",["minusDown"]);clearTimeout(j);i=0;var l=parseInt(a.oInput.value);if(!c){l--;a.oInput.value=l;}else{c=false;}if(l!=a.value){a.change(l);}};this.oInput.onselectstart=function(l){l=l||event;l.cancelBubble=true;};this.oInput.host=this;};this.$destroy=function(){this.oInput.onkeypress=this.oInput.onmousedown=this.oInput.onkeydown=this.oInput.onkeyup=this.oInput.onselectstart=this.$buttonPlus.onmouseover=this.$buttonPlus.onmouseout=this.$buttonPlus.onmousedown=this.$buttonPlus.onmouseup=this.$buttonMinus.onmouseover=this.$buttonMinus.onmouseout=this.$buttonMinus.onmousedown=this.$buttonMinus.onmouseup=null;};}).call(apf.spinner.prototype=new apf.StandardBinding());apf.aml.setElement("spinner",apf.spinner);apf.spreadsheet=function(c,a){this.$init(a||"spreadsheet",apf.NODE_VISIBLE,c);};apf.datagrid=function(c,a){this.$init(a||"datagrid",apf.NODE_VISIBLE,c);};(function(){this.$init(function(){this.$headings=[],this.$cssRules=[];this.$nodes=[];this.$lastOpened={};this.$editors={};this.dynCssClasses=[];});this.implement(apf.Cache,apf.DataAction);this.$focussable=true;this.multiselect=true;this.bufferselect=false;this.startClosed=true;this.$animType=apf.tween.NORMAL;this.$animSteps=3;this.$animSpeed=20;this.$curBtn=null;this.$useTable=false;this.$widthdiff=0;this.$defaultwidth=0;this.$useiframe=0;this.$renameStartCollapse=false;this.$init(function(){this.addEventListener("keydown",c,true);});this.$booleanProperties.iframe=true;function a(l,m){for(var j=0;j<l.length;j++){if(!l[j][1]){continue;}if(apf.isIE){(m||window).document.styleSheets[0].addRule(l[j][0],l[j][1]);}else{(m||window).document.styleSheets[0].insertRule(l[j][0]+" {"+l[j][1]+"}",0);}}}function d(){var i=(this.current||this.$selected),j=this.$int;j.scrollTop=(i.offsetTop)-21;}function c(t){var E=t.keyCode,l=t.ctrlKey,A=t.shiftKey,z=this.$selected||this.$caret;if(!t.force&&(!z||this.renaming)){return;}var C=this.caret||this.selected,u=this.$useiframe?this.oDoc.documentElement:this.$int,n,m,B,s,q,w,F;switch(E){case 13:if(this.$tempsel){this.$selectTemp();}this.choose(z);break;case 32:if(l||!this.isSelected(this.caret)){this.select(this.caret,true);}return false;case 109:case 46:if(this.disableremove){return;}if(this.celledit){this.rename(this.caret||this.selected,"");return;}if(this.$tempsel){this.$selectTemp();}this.remove(this.mode?this.caret:null);break;case 36:this.$setTempSelected(this.getFirstTraverseNode(),false,A);this.$int.scrollTop=0;return false;case 35:this.$setTempSelected(this.getLastTraverseNode(),false,A);this.$int.scrollTop=this.$int.scrollHeight;return false;case 107:if(this.more){this.startMore();}break;case 37:if(this.$tempsel){this.$selectTemp();}if(this.cellselect){if(this.$lastcell){if(this.$lastcell.previousSibling){this.selectCell({target:this.$lastcell.previousSibling},this.$selected);}}else{this.selectCell({target:this.$selected.firstChild},this.$selected);}}else{if(this.$withContainer){this.slideToggle(this.$caret||this.$selected,2);}}return false;case 107:case 39:if(this.$tempsel){this.$selectTemp();}if(this.cellselect){if(this.$lastcell){if(this.$lastcell.nextSibling){this.selectCell({target:this.$lastcell.nextSibling},this.$selected);}}else{this.selectCell({target:this.$selected.firstChild},this.$selected);}}else{if(this.$withContainer){this.slideToggle(this.$caret||this.$selected,1);}}return false;case 38:if(!C&&!this.$tempsel){return false;}m=this.$tempsel?apf.xmldb.getNode(this.$tempsel):C;n=apf.getBox(apf.getStyle(z,"margin"));B=u.scrollHeight>u.offsetHeight;w=Math.floor((u.offsetWidth-(B?15:0))/(z.offsetWidth+n[1]+n[3]));m=this.getNextTraverseSelected(m,false,w);if(m){this.$setTempSelected(m,l,A);}else{return false;}z=apf.xmldb.findHtmlNode(m,this);if(z.offsetTop<=u.scrollTop){u.scrollTop=(Array.prototype.indexOf.call(this.getTraverseNodes(),m)<w?0:z.offsetTop-n[0])-parseInt(apf.getStyle(u,apf.isIE?"paddingTop":"padding-top"));}return false;case 40:if(!C&&!this.$tempsel){return false;}m=this.$tempsel?apf.xmldb.getNode(this.$tempsel):C;n=apf.getBox(apf.getStyle(z,"margin"));B=u.scrollHeight>u.offsetHeight;w=Math.floor((u.offsetWidth-(B?15:0))/(z.offsetWidth+n[1]+n[3]));m=this.getNextTraverseSelected(m,true,w);if(m){this.$setTempSelected(m,l,A);}else{return false;}z=apf.xmldb.findHtmlNode(m,this);if(z.offsetTop+z.offsetHeight>u.scrollTop+u.offsetHeight){u.scrollTop=z.offsetTop-u.offsetHeight+z.offsetHeight+n[0];}return false;case 33:if(!C&&!this.$tempsel){return false;}m=this.$tempsel?apf.xmldb.getNode(this.$tempsel):C;n=apf.getBox(apf.getStyle(z,"margin"));q=u.scrollHeight>u.offsetHeight;s=u.scrollWidth>u.offsetWidth;w=Math.floor((u.offsetWidth-(q?15:0))/(z.offsetWidth+n[1]+n[3]))||1;F=Math.floor((u.offsetHeight-(s?15:0))/(z.offsetHeight+n[0]+n[2]));m=this.getNextTraverseSelected(m,false,w*F);if(!m){m=this.getFirstTraverseNode();}if(m){this.$setTempSelected(m,l,A);}else{return false;}z=apf.xmldb.findHtmlNode(m,this);if(z.offsetTop<u.scrollTop){u.scrollTop=(Array.prototype.indexOf.call(this.getTraverseNodes(),m)<w?0:z.offsetTop-n[0])-parseInt(apf.getStyle(u,apf.isIE?"paddingTop":"padding-top"));}return false;case 34:if(!C&&!this.$tempsel){return false;}m=this.$tempsel?apf.xmldb.getNode(this.$tempsel):C;n=apf.getBox(apf.getStyle(z,"margin"));q=u.scrollHeight>u.offsetHeight;s=u.scrollWidth>u.offsetWidth;w=Math.floor((u.offsetWidth-(q?15:0))/(z.offsetWidth+n[1]+n[3]))||1;F=Math.floor((u.offsetHeight-(s?15:0))/(z.offsetHeight+n[0]+n[2]));m=this.getNextTraverseSelected(C,true,w*F);if(!m){m=this.getLastTraverseNode();}if(m){this.$setTempSelected(m,l,A);}else{return false;}z=apf.xmldb.findHtmlNode(m,this);if(z.offsetTop+z.offsetHeight>u.scrollTop+u.offsetHeight){u.scrollTop=z.offsetTop-u.offsetHeight+z.offsetHeight+n[0];}return false;default:if(this.celledit){if(!l&&!t.altKey&&(E>46&&E<112||E>123)){this.startRename(null,true);}return;}else{if(E==65&&l){this.selectAll();return false;}else{if(this.caption||(this.bindingRules||{})["caption"]){if(!this.xmlRoot){return;}if(!this.lookup||new Date().getTime()-this.lookup.date.getTime()>300){this.lookup={str:"",date:new Date()};}this.lookup.str+=String.fromCharCode(E);var j=this.getTraverseNodes();for(var D,o=0;o<j.length;o++){D=this.$applyBindRule("caption",j[o]);if(D&&D.substr(0,this.lookup.str.length).toUpperCase()==this.lookup.str){if(!this.isSelected(j[o])){if(this.mode=="check"){this.setCaret(j[o]);}else{this.select(j[o]);}}if(z){this.$int.scrollTop=z.offsetTop-(this.$int.offsetHeight-z.offsetHeight)/2;}return;}}return;}}}break;}this.lookup=null;}this.$focus=function(){if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;}this.$setStyleClass(this.oFocus||this.$ext,this.$baseCSSname+"Focus");if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");}};this.$blur=function(){if(this.renaming){this.stopRename(null,true);}if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;}this.$setStyleClass(this.oFocus||this.$ext,"",[this.$baseCSSname+"Focus"]);if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,"",[this.$baseCSSname+"Focus"]);}};this.$calcSelectRange=function(m,j){var o=[],l=this.hasFeature(apf.__VIRTUALVIEWPORT__)?this.xmlRoot.selectNodes(this.each):this.getTraverseNodes(),q,n;for(q=false,n=0;n<l.length;n++){if(l[n]==m){q=true;}if(q){o.push(l[n]);}if(l[n]==j){q=false;}}if(!o.length||q){o=[];for(q=false,n=l.length-1;n>=0;n--){if(l[n]==m){q=true;}if(q){o.push(l[n]);}if(l[n]==j){q=false;}}}return o;};this.slideToggle=function(l,j){if(this.noCollapse){return;}var i=l.nextSibling;if(apf.getStyle(i,"display")=="block"){if(j==1){return;}l.className=l.className.replace(/min/,"plus");this.slideClose(i,apf.xmldb.getNode(l));}else{if(j==2){return;}l.className=l.className.replace(/plus/,"min");this.slideOpen(i,apf.xmldb.getNode(l));}};this.slideOpen=function(j,m){var n=apf.xmldb.findHtmlNode(m,this);if(!j){j=n.nextSibling;}if(this.singleopen){var l=this.getTraverseParent(m),o=(l||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);if(this.$lastOpened[o]&&this.$lastOpened[o][1]!=m&&this.getTraverseParent(this.$lastOpened[o][1])==l){this.slideToggle(this.$lastOpened[o][0],2);}this.$lastOpened[o]=[n,m];}j.style.display="block";var i=this;apf.tween.single(j,{type:"scrollheight",from:0,to:j.scrollHeight,anim:this.$animType,steps:this.$animSteps,interval:this.$animSpeed,onfinish:function(q){if(m&&i.$hasLoadStatus(m,"potential")){$setTimeout(function(){i.$extend(m,q);});q.style.height="auto";}else{q.style.height="auto";}}});};this.slideClose=function(i,j){if(this.noCollapse){return;}if(this.singleopen){var l=(this.getTraverseParent(j)||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);this.$lastOpened[l]=null;}i.style.height=i.offsetHeight;i.style.overflow="hidden";apf.tween.single(i,{type:"scrollheight",from:i.scrollHeight,to:0,anim:this.$animType,steps:this.$animSteps,interval:this.$animSpeed,onfinish:function(m,n){m.style.display="none";}});};this.$findContainer=function(j){var i=j.nextSibling;if(!i){return j;}return i.nodeType==1?i:i.nextSibling;};this.addEventListener("bindingsload",this.$loaddatabinding=function(s){var u=s.bindings.column;if(!u||!u.length){return;}this.$headings=u;var o=0,q=false;for(var n,m=0,j=u.length;m<j;m++){n=u[m];if(!n.$isPercentage){o+=parseFloat(n.$width)||0;}else{q=true;}}if(!q){this.$isFixedGrid=true;this.$setStyleClass(this.$ext,"fixed");if(this.$useiframe){this.$setStyleClass(this.oDoc.documentElement,"fixed");}}else{}if(o>0&&!this.$isFixedGrid){var t=o+5;this.$cssRules.push(["."+this.$baseCSSname+" .row"+this.$uniqueId,"padding-right:"+t+"px;margin-right:-"+t+"px"]);this.$int.style.paddingRight=this.$head.style.paddingRight=t+"px";}this.$fixed=o;this.$first=0;this.$withContainer=s.bindings.description?true:false;a(this.$cssRules,window);if(this.$useiframe){a(this.$cssRules,this.oWin);}});this.$add=function(z,t,u,B,w){this.$getNewContext("row");var j=this.$getLayoutNode("row");j.setAttribute("id",t);j.setAttribute("class","row"+this.$uniqueId);j.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+");o.choose();"+(this.$withContainer?"o.slideToggle(this);":"")+(this.celledit&&!this.namevalue?"o.startRename();":""));if(this.hasFeature(apf.__DRAGDROP__)){j.setAttribute("onmouseout","this.hasPassedDown = false;");j.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 this.hasPassedDown = true;                 if (!o.hasFeature(apf.__DRAGDROP__) || !isSelected && !event.ctrlKey)                     o.select(this, event.ctrlKey, event.shiftKey);"+(this.cellselect||this.namevalue?"o.selectCell(event, this, isSelected);":""));j.setAttribute("onmouseup","if (!this.hasPassedDown) return;                var o = apf.lookup("+this.$uniqueId+");                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 if (o.hasFeature(apf.__DRAGDROP__))                     o.select(this, event.ctrlKey, event.shiftKey);");}else{j.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                var wasSelected = o.$selected == this;                o.select(this, event.ctrlKey, event.shiftKey);"+(this.cellselect||this.namevalue?"o.selectCell(event, this, wasSelected);":""));}for(var A,o,n=0;n<this.$headings.length;n++){o=this.$headings[n];this.$getNewContext("cell");A=this.$getLayoutNode("cell");apf.setStyleClass(A,o.$className);if(o.css){apf.setStyleClass(A,(apf.lm.compile(o.css))(z));}if(o.type=="icon"){var m=this.$getLayoutNode("cell","caption",j.appendChild(A));if(apf.isIE){apf.setNodeValue(m,"&nbsp;");}(m.nodeType==1&&m||m.parentNode).setAttribute("style","background-image:url("+apf.getAbsolutePath(this.iconPath,((o.cvalue2||o.$compile("value",{nostring:true}))(z)||""))+")");}else{apf.setNodeValue(this.$getLayoutNode("cell","caption",j.appendChild(A)),(o.cvalue2||o.$compile("value",{nostring:true}))(z)||"");}}if(this.$bindings&&this.$bindings.color){var s=this.$getDataNode("color",z);this.$setStyleClass(j,s?"highlight":null,s?["highlight"]:null);}var C=this.$applyBindRule("css",z);if(C){this.$setStyleClass(j,C);if(C){this.dynCssClasses.push(C);}}if(B){apf.insertHtmlNode(j,B,w);}else{this.$nodes.push(j);}if(this.$withContainer){var q=this.$applyBindRule("description",z);this.$getNewContext("container");var l=this.$getLayoutNode("container");apf.setNodeValue(this.$getLayoutNode("container","container",l),q);l.setAttribute("class",(l.getAttribute("class")||"")+" row"+this.$uniqueId);if(B){apf.insertHtmlNode(l,B,w);}else{this.$nodes.push(l);}}};this.$fill=function(i){if(this.$useiframe){this.$pHtmlDoc=this.oDoc;}if(this.$useTable){apf.insertHtmlNodes(this.$nodes,this.$int,null,"<table class='records' cellpadding='0' cellspacing='0'><tbody>","</tbody></table>");}else{apf.insertHtmlNodes(this.$nodes,this.$int);}this.$nodes.length=0;};this.$deInitNode=function(i,j){if(this.$withContainer){j.parentNode.removeChild(j.nextSibling);}j.parentNode.removeChild(j);};this.$updateNode=function(A,z){if(!z){return;}var j=this.$head.childNodes,q=z.childNodes,n,m;if(!this.namevalue&&this.$curBtn){m=this.$curBtn.parentNode;}for(var t,u,s=this.namevalue?1:0,o=j.length;s<o;s++){u=apf.all[j[s].getAttribute("hid")];t=q[s];while(t&&t.nodeType!=1){t=t.nextSibling;}n=this.$getLayoutNode("cell","caption",t)||t;if(u.type=="icon"){(n.nodeType==1&&n||n.parentNode).style.backgroundImage="url("+apf.getAbsolutePath(this.iconPath,((u.cvalue2||u.$compile("value",{nostring:true}))(A)||""))+")";}else{n.innerHTML=(u.cvalue2||u.$compile("value",{nostring:true}))(A)||"";}}if(!this.namevalue&&m){m.appendChild(this.$curBtn);}if(this.$bindings&&this.$bindings.color){var w=this.$getDataNode("color",A);this.$setStyleClass(z,w?"highlight":null,w?["highlight"]:null);}var B=this.$applyBindRule("css",A);if(B||this.dynCssClasses.length){this.$setStyleClass(z,B,this.dynCssClasses);if(B&&!this.dynCssClasses.contains(B)){this.dynCssClasses.push(B);}}if(this.$withContainer){z.nextSibling.innerHTML=this.$applyBindRule("description",A)||"";}};this.$moveNode=function(l,m){if(!m){return;}var i=m.parentNode;var j=l.nextSibling?apf.xmldb.findHtmlNode(this.getNextTraverse(l),this):null;i.insertBefore(m,j);};this.$selectDefault=function(i){this.select(i.selectSingleNode(this.each),null,null,null,true);};this.getColumn=function(i){return this.$headings[i||this.$lastcol||0];};this.resizeColumn=function(l,j){var i=this.$headings[l];i.resize(j);};this.hideColumn=function(j){var i=this.$headings[j];i.hide();};this.showColumn=function(j){var i=this.$headings[j];i.show();};this.sortColumn=function(i){var j=this.$headings[nr];j.sort();};this.moveColumn=function(l,j){var i=this.$headings[nr];i.move(j);};this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","body",this.$ext);this.$head=this.$getLayoutNode("main","head",this.$ext);this.$pointer=this.$getLayoutNode("main","pointer",this.$ext);if(this.$head.firstChild){this.$head.removeChild(this.$head.firstChild);}if(this.$int.firstChild){this.$int.removeChild(this.$int.firstChild);}var l=this.$widthdiff=this.$getOption("main","widthdiff")||0;this.$defaultwidth=this.$getOption("main","defaultwidth")||"100";this.$useiframe=apf.isIE&&(apf.isTrue(this.$getOption("main","iframe"))||this.iframe);var i=this;if(this.$useiframe&&!this.oIframe){var m=this.$int.className;this.oIframe=this.$int.appendChild(document.createElement(apf.isIE?"<iframe frameborder='0'></iframe>":"iframe"));this.oIframe.frameBorder=0;this.oWin=this.oIframe.contentWindow;this.oDoc=this.oWin.document;this.oDoc.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                <html xmlns="http://www.w3.org/1999/xhtml">                    <head><script>                        apf = {                            lookup : function(uid){                                return window.parent.apf.lookup(uid);                            },                            Init : {add:function(){},run:function(){}}                        };<\/script>                    </head>                    <body></body>                </html>');this.$int=this.oDoc.body;this.$int.className=m;this.oDoc.documentElement.className=this.$ext.className;apf.skins.loadCssInWindow(this.skinName,this.oWin,this.mediaPath,this.iconPath);if(apf.isIE){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");}apf.convertIframe(this.oIframe,true);this.oDoc.body.insertAdjacentHTML("beforeend",this.oTxt.outerHTML);var j=this.oTxt;j.refCount--;this.oTxt=this.oDoc.body.lastChild;this.oTxt.parentNode.removeChild(this.oTxt);this.oTxt.select=j.select;this.oTxt.ondblclick=this.oTxt.onselectstart=this.oTxt.onmouseover=this.oTxt.onmouseout=this.oTxt.oncontextmenu=this.oTxt.onmousedown=function(n){(n||(i.oWin||window).event).cancelBubble=true;};this.oTxt.onfocus=j.onfocus;this.oTxt.onblur=j.onblur;this.oTxt.onkeyup=j.onkeyup;this.oTxt.refCount=1;if(apf.getStyle(this.oDoc.documentElement,apf.isIE?"overflowY":"overflow-y")=="auto"){this.oIframe.onresize=function(){i.$head.style.marginRight=i.oDoc.documentElement.scrollHeight>i.oDoc.documentElement.offsetHeight?"16px":"0";};this.addEventListener("afterload",this.oIframe.onresize);this.addEventListener("xmlupdate",this.oIframe.onresize);}this.oDoc.documentElement.onmousedown=function(n){if(!n){n=i.oWin.event;}if((n.srcElement||n.target).tagName=="HTML"){apf.popup.forceHide();}};this.oDoc.documentElement.onscroll=function(){if(i.$isFixedGrid){i.$head.scrollLeft=i.oDoc.documentElement.scrollLeft;}};}else{if(apf.getStyle(this.$int,apf.isIE?"overflowY":"overflow-y")=="auto"){this.$resize=function(){i.$head.style.marginRight=i.$int.scrollHeight>i.$int.offsetHeight?"16px":"0";};apf.layout.setRules(this.$ext,this.$uniqueId+"_datagrid","var o = apf.all["+this.$uniqueId+"];                     if (o) o.$resize()");apf.layout.queue(this.$ext);this.addEventListener("afterload",this.$resize);this.addEventListener("xmlupdate",this.$resize);}this.$int.onmousedown=function(n){if(!n){n=event;}if((n.srcElement||n.target)==this){apf.popup.forceHide();}};this.$int.onscroll=function(){if(i.$isFixedGrid){i.$head.scrollLeft=i.$int.scrollLeft;}};}};this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);this.$ext.onclick=this.$int.onresize=null;apf.layout.removeRule(this.$int,"dg"+this.$uniqueId);apf.layout.activateRules(this.$int);};}).call(apf.datagrid.prototype=new apf.MultiSelect());apf.spreadsheet.prototype=apf.datagrid.prototype;apf.aml.setElement("spreadsheet",apf.spreadsheet);apf.aml.setElement("datagrid",apf.datagrid);apf.aml.setElement("description",apf.BindingRule);apf.aml.setElement("color",apf.BindingRule);apf.aml.setElement("contents",apf.BindingRule);apf.skin=function(c,a){this.$init(a||"skin",apf.NODE_HIDDEN,c);};apf.aml.setElement("skin",apf.skin);(function(){this.$parsePrio="002";this.$propHandlers.src=function(l){this.$path=apf.getAbsolutePath(apf.hostPath,l);a.call(this,this.$path);};this.$propHandlers.name=function(l){if(!this.attributes.getNamedItem("src")){this.$path=apf.getAbsolutePath(apf.hostPath,l)+"/index.xml";a.call(this,this.$path);}};function j(n){if(!n.ownerDocument.documentElement){return false;}var l=n.ownerDocument.documentElement.attributes;for(var o=false,m=0;m<l.length;m++){if(l[m].nodeValue==apf.ns.aml){o=true;break;}}return o;}function a(l){var n=this.ownerDocument.$domParser;if(!apf.skins.$first){apf.skins.$first=this;}var m=this.attributes.getNamedItem("defer");if(!m||!apf.isTrue(m.nodeValue)){n.$shouldWait++;this.$parseContext=n.$parseContext||[this.ownerDocument.documentElement];}d.call(this,l);}function i(l){if(l){apf.skins.Init(l,this,this.$path);}if(!this.defer){var m=this.ownerDocument.$domParser;m.$continueParsing.apply(m,this.$parseContext);}}function c(n,m,o){var l=this;apf.getData(apf.getAbsolutePath(o,n.getAttribute("src")),{callback:function(A,w,q){if(w!=apf.SUCCESS){throw new Error("Could not load skin include");}var s=apf.getXml('<a:skin xmlns:a="http://ajax.org/2005/aml">'+A+"</a:skin>");apf.mergeXml(s,m,{beforeNode:n});n.parentNode.removeChild(n);var u=$xmlns(s,"include",apf.ns.aml);if(u.length){var z=apf.getDirname(q.url);for(var t=0;t<u.length;t++){c.call(l,u[t],m,z);}}else{if(!$xmlns(m,"include",apf.ns.aml).length){i.call(l,m);}}}});}function d(m){var l=this;apf.getData(m,{callback:function(w,t,n){if(t!=apf.SUCCESS){var z=new Error(apf.formatErrorString(1007,l,"Loading skin file","Could not load skin file '"+(u||l.src)+"'\nReason: "+n.message));if(n.tpModule.retryTimeout(n,t,null,z)===true){return true;}if(this.autoload){apf.console.warn("Could not autload skin.");return i.call(l);}throw z;}w=w.replace(/\<\!DOCTYPE[^>]*>/,"").replace(/&nbsp;/g," ").replace(/^[\r\n\s]*/,"").replace(/xmlns\=\"[^"]*\"/g,"");if(!w){throw new Error(apf.formatErrorString(0,l,"Loading skin","Empty skin file. Maybe the file does not exist?",l));}var q=apf.getXml(w);if(!q){throw new Error(apf.formatErrorString(0,l,"Loading skin","Could not parse skin. Maybe the file does not exist?",l));}q.setAttribute("filename",n.url);var s=$xmlns(q,"include",apf.ns.aml);if(s.length){var u=apf.getDirname(n.url);for(var o=0;o<s.length;o++){c.call(l,s[o],q,u);}return;}else{i.call(l,q);}},async:true,ignoreOffline:true});}this.addEventListener("DOMNodeInsertedIntoDocument",function(l){if(this.src||this.name){return;}apf.skins.Init(this);});}).call(apf.skin.prototype=new apf.AmlElement());apf.video=function(c,a){this.$init(a||"video",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction);this.$booleanProperties.fullscreen=true;var a=null;this.$propHandlers.fullscreen=function(s){if(!this.player){return;}if(typeof this.player.setFullscreen=="function"){this.player.setFullscreen(s);}else{if(this.parentNode&&this.parentNode.tagName!="application"&&this.parentNode.setWidth){var o,q,t=this.parentNode.$ext;if(s){a={width:this.parentNode.getWidth(),height:this.parentNode.getHeight(),top:this.parentNode.getTop(),left:this.parentNode.getLeft(),position:apf.getStyle(t,"position"),zIndex:apf.getStyle(t,"z-index"),resizable:this.parentNode.resizable,nodes:[]};if(t!=document.body){while(t.parentNode!=document.body){var q=t.parentNode;o=a.nodes.push({pos:apf.getSyle(q,"position")||"",top:apf.getSyle(q,"top")||q.offsetTop+"px",left:apf.getSyle(q,"left")||q.offsetLeft+"px",node:q})-1;q.style.position="absolute";q.style.top="0";q.style.left="0";}}this.parentNode.$ext.style.position="absolute";this.parentNode.$ext.style.zIndex="1000000";this.parentNode.setWidth("100%");this.parentNode.setHeight("100%");this.parentNode.setTop("0");this.parentNode.setLeft("0");if(this.parentNode.resizable){this.parentNode.setAttribute("resizable",false);}}else{if(a){var n;if(a.nodes.length){for(o=a.nodes.length-1;o>=0;o--){n=a.nodes[o];q=n.node;q.style.position=n.pos;q.style.top=n.top;q.style.left=n.left;}}this.parentNode.$ext.style.zIndex=a.zIndex;this.parentNode.$ext.style.position=a.position;this.parentNode.setWidth(a.width);this.parentNode.setHeight(a.height);this.parentNode.setTop(a.top);this.parentNode.setLeft(a.left);if(a.resizable){this.parentNode.setAttribute("resizable",true);}a=null;delete a;}}if(this.player.onAfterFullscreen){this.player.onAfterFullscreen(s);}var m=this;window.setTimeout(function(){apf.layout.forceResize(m.parentNode.$ext);},100);}}};this.addEventListener("keydown",function(m){switch(m.keyCode){case 13&&(m.ctrlKey||m.altKey):case 70:this.setPropery("fullscreen",true);return false;break;case 80:this.setProperty("paused",!this.paused);return false;break;case 27:this.setProperty("fullscreen",false);return false;break;default:break;}},true);this.$mainBind="src";this.loadMedia=function(){if(this.player){this.setProperty("currentSrc",this.src);this.setProperty("networkState",apf.Media.NETWORK_LOADING);this.player.load(this.src);}return this;};this.seek=function(m){if(this.player&&m>=0&&m<=this.duration){this.player.seek(m);}};this.setVolume=function(m){if(this.player){this.player.setVolume(m);}};var j="mov",d="flv",l="asf|asx|avi|wmv",i="ogg",c="3gp|3gpp|3g2|3gpp2|divx|mp4|mpg4|mpg|mpeg|mpe|ogg|vob";this.$guessType=function(o){var n=o.substr(o.lastIndexOf(".")+1),m="";if(j.indexOf(n)!=-1){m="video/quicktime";}else{if(d.indexOf(n)!=-1){m="video/flv";}else{if(l.indexOf(n)!=-1){m="video/wmv";}else{if(i.indexOf(n)!=-1&&apf.hasVideo){m="video/ogg";}else{if(c.indexOf(n)!=-1){m="video/vlc";}}}}}if(n=="mpg"||n=="mpeg"||n=="mpe"){m=apf.isMac?"video/quicktime":"video/wmv";}if(!apf.isWin&&!apf.isMac&&m=="video/wmv"){m="video/vlc";}return m;};this.$getPlayerType=function(q){if(!q){return null;}var o=null;var n=q.splitSafe(",");if(n.length==1){n=n[0].splitSafe(";");}for(var m=0;m<n.length;m++){q=n[m];if(q.indexOf("ogg")>-1){o="TypeNative";}else{if(q.indexOf("flv")>-1){o="TypeFlv";}else{if(q.indexOf("quicktime")>-1){o="TypeQT";}else{if(q.indexOf("wmv")>-1){o="TypeWmp";}else{if(q.indexOf("silverlight")>-1){o="TypeSilverlight";}else{if(q.indexOf("vlc")>-1){o="TypeVlc";}}}}}}if(o=="TypeWmp"){if(!apf.isIE&&typeof apf.video.TypeVlc!="undefined"&&apf.video.TypeVlc.isSupported()){o="TypeVlc";}else{if(apf.isMac){o="TypeQT";}}}if(o&&apf.video[o]&&apf.video[o].isSupported()){this.$lastMimeType=m;return o;}}this.$lastMimeType=-1;return null;};this.$isSupported=function(m){m=m||this.playerType;return(apf.video[m]&&apf.video[m].isSupported());};this.$initPlayer=function(){this.player=new apf.video[this.playerType](this,this.$ext,{src:this.src.splitSafe(",")[this.$lastMimeType]||this.src,width:this.width,height:this.height,autoLoad:true,autoPlay:this.autoplay,showControls:this.controls,volume:this.volume,mimeType:this.type});return this;};this.$initHook=function(){this.loadMedia();};this.$cuePointHook=function(){};this.$playheadUpdateHook=function(){};this.$errorHook=function(m){apf.console.error(m.error);};this.$progressHook=function(n){this.setProperty("bufferedBytes",{start:0,end:n.bytesLoaded});this.setProperty("totalBytes",n.totalBytes);var m=Math.abs(n.bytesLoaded-n.totalBytes);if(m<=20){this.setProperty("readyState",apf.Media.HAVE_ENOUGH_DATA);}};this.$stateChangeHook=function(m){if(m.state=="loading"){this.setProperty("networkState",this.networkState=apf.Media.NETWORK_LOADING);}else{if(m.state=="connectionError"){this.$propHandlers.readyState.call(this,this.networkState=apf.Media.HAVE_NOTHING);}else{if(m.state=="playing"||m.state=="paused"){if(m.state=="playing"){this.$readyHook({type:"ready"});}this.paused=Boolean(m.state=="paused");this.setProperty("paused",this.paused);}else{if(m.state=="seeking"){this.seeking=true;this.setProperty("seeking",true);}}}}};this.$changeHook=function(m){if(typeof m.volume!="undefined"){this.volume=m.volume;if(!this.muted){this.setProperty("volume",this.volume);}}else{this.duration=this.player.getTotalTime();this.position=m.playheadTime/this.duration;if(isNaN(this.position)){return;}this.setProperty("position",this.position);this.currentTime=m.playheadTime;this.setProperty("currentTime",this.currentTime);}};this.$completeHook=function(m){this.paused=true;this.setProperty("paused",true);};this.$readyHook=function(m){this.setProperty("networkState",apf.Media.NETWORK_LOADED);this.setProperty("readyState",apf.Media.HAVE_FUTURE_DATA);this.setProperty("duration",this.player.getTotalTime());this.seeking=false;this.seekable=true;this.setProperty("seeking",false);return this;};this.$metadataHook=function(m){this.oVideo.setProperty("readyState",apf.Media.HAVE_METADATA);};this.stopListening=function(){if(!this.player){return this;}return this;};this.$draw=function(){this.$ext=this.$getExternal();};this.addEventListener("DOMNodeInsertedIntoDocument",function(){this.$int=this.$getLayoutNode("main","container",this.$ext);this.width=parseInt(this.width)||null;this.height=parseInt(this.height)||null;});this.addEventListener("AMLMediaReady",function(){if(this.setSource()){this.$propHandlers.type.call(this,this.type);}});this.$destroy=function(m){if(this.player&&this.player.$destroy){this.player.$destroy();}delete this.player;this.player=null;if(m){this.$ext.innerHTML="";}};}).call(apf.video.prototype=new apf.Media());apf.aml.setElement("video",apf.video);apf.video.TypeInterface={properties:["src","width","height","volume","showControls","autoPlay","totalTime","mimeType"],setOptions:function(a){if(a==null){return this;}var d=this.properties;for(var c=0;c<d.length;c++){var j=d[c];if(a[j]==null){continue;}this[j]=a[j];}return this;},getElement:function(c){var a;if(typeof c=="object"){return c;}if(apf.isIE){return window[c];}else{a=document[c]?document[c]:document.getElementById(c);if(!a){a=apf.lookup(c);}return a;}}};apf.model=function(c,a){this.$init(a||"model",apf.NODE_HIDDEN,c);this.$amlNodes={};this.$propBinds={};this.$listeners={};this.$proplisteners={};if(!apf.globalModel){apf.globalModel=this;apf.nameserver.register("model","@default",this);}};(function(){this.$parsePrio="020";this.$isModel=true;this.canHaveChildren=false;this["save-original"]=true;this.$state=0;this.$attrExcludePropBind=apf.extend({submission:1,src:1,session:1},this.$attrExcludePropBind);this.$booleanProperties.autoinit=true;this.$supportedProperties=["submission","src","session","autoinit","save-original","remote"];this.$propHandlers.src=this.$propHandlers.get=function(a,c){if(this.$amlLoaded){this.$loadFrom(a);}};this.$propHandlers.validation=function(a,c){apf.nameserver.get("validation",a).register(this);};this.$propHandlers.remote=function(a,c){if(this.rsb){this.rsb.models.remove(this);this.rsb=null;}if(a){this.rsb=apf.nameserver.get("remote",this.remote);this.rsb.models.push(this);}};this.validate=function(d,i,c,a){if(!this.$validation){return;}if(!d){}else{c=this.$validation.validate(d,i,c);if(c.valid){a.clearError();return true;}else{a.setError();return false;}}};this.register=function(c,a){if(!c||!c.load){return this;}if(c.$model&&c.$model!=this){c.$model.unregister(c);}var i=this.$amlNodes[c.$uniqueId]={amlNode:c,xpath:a};c.$model=this;var l,d,j=c.$propsUsingMainModel;for(var m in j){l=this.$bindXmlProperty(c,m,j[m].xpath,j[m].optimize);if(this.data){if(d=l.root||l.listen?this.data.selectSingleNode(l.root||l.listen):this.data){c.$execProperty(m,d);}else{this.$waitForXml(c,m);}}}if(typeof c.noloading=="undefined"&&c.$setInheritedAttribute&&!c.$setInheritedAttribute("noloading")){c.noloading=false;}if(this.$state==1){if(c.clear&&!c.noloading){c.clear("loading");}}else{if(this.data){this.$loadInAmlNode(i);}else{if(c.clear){c.clear("empty");}}}return this;};this.$register=function(c,a){this.$amlNodes[c.$uniqueId].xpath=a;};this.unregister=function(a){delete this.$amlNodes[a.$uniqueId];var c=a.$propsUsingMainModel;for(var d in c){this.$unbindXmlProperty(a,d);}};this.getXpathByAmlNode=function(a){var c=this.$amlNodes[a.$uniqueId];if(!c){return false;}return c.xpath;};this.$loadInAmlNode=function(i){var d;var a=i.xpath;var c=i.amlNode;if(this.data&&a){d=this.data.selectSingleNode(a);}else{d=this.data||null;}if(d){delete this.$listeners[c.$uniqueId];c.load(d);}else{this.$waitForXml(c);}};this.$loadInAmlProp=function(l,c){var j,d,i=this.$propBinds[l],a=apf.all[l];for(j in i){if(d=i[j].root?c.selectSingleNode(i[j].root):c){apf.xmldb.addNodeListener(c,a,"p|"+l+"|"+j+"|"+this.$uniqueId);delete this.$proplisteners[l];a.$execProperty(j,d);}else{this.$waitForXml(a,j);}}};this.$bindXmlProperty=function(j,a,n,t,o){var c,i,d=j.$uniqueId;if(!this.$propBinds[d]){this.$propBinds[d]={};}i=this.$propBinds[d][a]={bind:n};if(t){if((c=this.$amlNodes[d])&&c.xpath){n=(i.root=c.xpath)+"/"+n;}var m=n.split("/"),s=m.pop();if(s.indexOf("@")==0||s.indexOf("text()")>-1||s.indexOf("node()")>-1){i.listen=m.join("/");}else{i.listen=n;}}else{if((c=this.$amlNodes[d])&&c.xpath){i.listen=c.xpath;}}if(o){i.listen=".";}if(this.data){var u=i.listen?this.data.selectSingleNode(i.listen):this.data;if(u){apf.xmldb.addNodeListener(u,j,"p|"+j.$uniqueId+"|"+a+"|"+this.$uniqueId);return i;}}this.$waitForXml(j,a);return i;};this.$unbindXmlProperty=function(c,j){var i=c.$uniqueId;var d=this.$propBinds[i]&&this.$propBinds[i][j];if(!d){return;}if(this.data){var a=d.listen?this.data.selectSingleNode(d.listen):this.data;if(a){apf.xmldb.removeNodeListener(a,c,"p|"+i+"|"+j+"|"+this.$uniqueId);}}delete this.$proplisteners[i+j];delete this.$propBinds[i][j];return d;};this.getXml=function(){return this.data?apf.xmldb.cleanNode(this.data.cloneNode(true)):false;};this.setQueryValue=function(a,d){if(!this.data){return false;}var c=apf.createNodeFromXpath(this.data,a);if(!c){return null;}apf.setNodeValue(c,d,true);return c;};this.queryValue=function(a){if(!this.data){return false;}return apf.queryValue(this.data,a);};this.queryValues=function(a){if(!this.data){return false;}return apf.queryValue(this.data,a);};this.queryNode=function(a){if(!this.data){return null;}return this.data.selectSingleNode(a);};this.queryNodes=function(a){if(!this.data){return null;}return this.data.selectNodes(a);};this.appendXml=function(d,a){var c=a?apf.createNodeFromXpath(this.data,a):this.data;if(!c){return null;}if(typeof d=="string"){d=apf.getXml(d);}else{d=!d.nodeType?d.getXml():apf.xmldb.getCleanCopy(d);}if(!d){return;}apf.xmldb.appendChild(c,d);};this.removeXml=function(a){if(typeof a=="string"){a=this.data.selectNodes(a);}else{if(!a.length){a=[a];}}if(a){apf.xmldb.removeNodeList(a);}};this.clear=function(){this.load(null);doc=null;};this.reset=function(){this.load(this.copy);};this.savePoint=function(){this.copy=apf.xmldb.getCleanCopy(this.data);};this.reloadAmlNode=function(d){if(!this.data){return;}var c=this.$amlNodes[d];var a=c.xpath?this.data.selectSingleNode(c.xpath):this.data;c.amlNode.load(a);};this.addEventListener("DOMNodeInsertedIntoDocument",function(d){var a=this.$aml;if(this.parentNode.hasFeature(apf.__DATABINDING__)){if(!this.name){this.setProperty("id","model"+this.parentNode.$uniqueId);}this.register(this.parentNode);}if(!this.src){var i,c=a;if(c.childNodes.length){if(apf.getNode(c,[0])){if((i=c.xml||c.serialize()).match(/^[\s\S]*?>([\s\S]*)<[\s\S]*?$/)){i=RegExp.$1;if(!apf.supportNamespaces){i=i.replace(/xmlns=\"[^"]*\"/g,"");}}return this.load(apf.getXmlDom(i).documentElement);}else{if(apf.isJson(c.childNodes[0].nodeValue)){return this.load(apf.getXmlDom(c.childNodes[0].nodeValue).documentElement);}}}if(this.submission){this.load("<data />");}}if(!apf.isFalse(this.autoinit)){this.init();}return this;});this.init=function(a){if(this.session){this.$loadFrom(this.session,{isSession:true});}else{if(typeof apf.offline!="undefined"&&apf.offline.models.enabled){if(apf.offline.models.loadModel(this)){return;}if(this.src&&!apf.offline.onLine){apf.offline.models.addToInitQueue(this);return;}}if(this.src){this.$loadFrom(this.src,{callback:a});}}};this.$loadFrom=function(c,d){var j=c.split(":");if(!d){d={};}if(!d.isSession){this.src=c;this.$srcOptions=[c,d];}this.dispatchEvent("beforeretrieve");var n,i;for(n in this.$amlNodes){if(!(i=this.$amlNodes[n])||!i.amlNode){continue;}if(!i.amlNode.noloading){i.amlNode.clear("loading");}}this.$state=1;if(!this.$callCount){this.$callCount=1;}else{this.$callCount++;}var a=this,l=this.$callCount,m=d.callback;d.callback=function(s,q,o){if(l!=a.$callCount){return;}a.dispatchEvent("afterretrieve");if(q==apf.OFFLINE){apf.offline.models.addToInitQueue(this);return false;}if(q!=apf.SUCCESS){var t;t=new Error(apf.formatErrorString(1032,a,"Inserting xml data","Could not load data Instruction:"+c+"\nUrl: "+o.url+"\nInfo: "+o.message+"\n\n"+s));if(m&&m.apply(this,arguments)===true){return true;}if(o.tpModule&&o.tpModule.retryTimeout(o,q,a,t)===true){return true;}a.$state=0;throw t;}if(d&&d.isSession&&!s){if(this.src){return a.$loadFrom(this.src);}}else{if(d&&d.cancel){return;}a.load(s);a.dispatchEvent("receive",{data:s});if(m){m.apply(this,arguments);}}};return apf.getData(c,d);};this.reload=function(){if(!this.data){return;}if(this.$srcOptions){this.$loadFrom.apply(this,this.$srcOptions);}else{if(this.src){this.$loadFrom(this.src);}}};this.load=function(d,c){if(typeof d=="string"){if(d.charAt(0)=="<"){if(d.substr(0,5).toUpperCase()=="<!DOC"){d=d.substr(d.indexOf(">")+1);}d=apf.getXmlDom(d,null,true).documentElement;}else{return this.$loadFrom(d,c);}}if(this.ownerDocument&&this.ownerDocument.$domParser.$shouldWait){var a=this;apf.queue.add("modelload"+this.$uniqueId,function(){a.load(d,c);});return;}this.$state=0;if(this.dispatchEvent("beforeload",{xmlNode:d})===false){return false;}var i=d?d.ownerDocument:null;if(d){if(!apf.supportNamespaces&&(d.prefix||d.scopeName)){i.setProperty("SelectionNamespaces","xmlns:"+(d.prefix||d.scopeName)+"='"+d.namespaceURI+"'");}apf.xmldb.addNodeListener(d,this);apf.xmldb.nodeConnect(apf.xmldb.getXmlDocId(d,this),d,null,this);if((!c||!c.nocopy)&&this["save-original"]){this.copy=apf.xmldb.getCleanCopy(d);}}this.data=d;for(var j in this.$amlNodes){this.$loadInAmlNode(this.$amlNodes[j]);}for(j in this.$propBinds){this.$loadInAmlProp(j,d);}this.dispatchEvent("afterload",{xmlNode:d});return this;};this.$waitForXml=function(a,c){if(c){this.$proplisteners[a.$uniqueId+c]={id:a.$uniqueId,amlNode:a,prop:c};}else{this.$listeners[a.$uniqueId]=a;}};this.$xmlUpdate=function(j,c,i,d){var l,a;for(var m in this.$listeners){if(c=this.data.selectSingleNode(this.$amlNodes[m].xpath||".")){this.$listeners[m].load(c);delete this.$listeners[m];}}for(m in this.$proplisteners){l=this.$proplisteners[m];a=this.$propBinds[l.id][l.prop];if(c=a.listen?this.data.selectSingleNode(a.listen):this.data){apf.xmldb.addNodeListener(c,l.amlNode,"p|"+l.id+"|"+l.prop+"|"+this.$uniqueId);delete this.$proplisteners[m];l.amlNode.$execProperty(l.prop,a.root?this.data.selectSingleNode(a.root):this.data);}}};this.$insertFrom=function(c,d){if(!c){return false;}this.dispatchEvent("beforeretrieve");var i=d.callback,a=this;d.callback=function(m,l,j){a.dispatchEvent("afterretrieve");if(!j){j={};}if(l!=apf.SUCCESS){var n;if(j.tpModule.retryTimeout(j,l,d.amlNode||a,n)===true){return true;}throw n;}if(typeof d.insertPoint=="string"){d.insertPoint=a.data.selectSingleNode(d.insertPoint);}if(typeof d.clearContents=="undefined"&&j.userdata){d.clearContents=apf.isTrue(j.userdata[1]);}(d.amlNode||a).insert(m,d);if(i){i.call(this,j.data);}};apf.getData(c,d);};this.insert=function(d,a){if(typeof d=="string"){if(d.charAt(0)=="<"){d=apf.getXmlDom(d).documentElement;}else{return this.$insertFrom(d,a);}}if(!a.insertPoint){a.insertPoint=this.data;}if(typeof a.copyAttributes=="undefined"){a.copyAttributes=true;}var c=apf.mergeXml(d,a.insertPoint,a);apf.xmldb.applyChanges("insert",a.insertPoint);return d;};this.convertXml=function(a){if(!a){return this.data.xml;}return apf.convertXml(this.data,a);};this.submit=function(a,j,d,j,i,l){if(!a){a=this.submission;}if(!d){d=this.data;}if(!j){j="form";}if(this.dispatchEvent("beforesubmit",{instruction:a})===false){return false;}var c=this;function n(s,q,o){if((q==apf.TIMEOUT||(c.retryOnError&&q==apf.ERROR))&&o.retries<apf.maxHttpRetries){return o.tpModule.retry(o.id);}else{if(q!=apf.SUCCESS){c.dispatchEvent("submiterror",o);}else{c.dispatchEvent("submitsuccess",apf.extend({data:s},o));}}}var m;if(j.indexOf("xml")>-1){m=apf.getXmlString(d);}else{if(j.indexOf("form")>-1){m=apf.convertXml(apf.xmldb.getCleanCopy(d),"cgiobjects");}else{if(j.indexOf("json")>-1){m=apf.convertXml(d,"json");}}}apf.saveData(a,{xmlNode:d,data:m,callback:n});this.dispatchEvent("aftersubmit");};this.$destroy=function(){if(this.session&&this.data){apf.saveData(this.session,{xmlNode:this.getXml()});}};}).call(apf.model.prototype=new apf.AmlElement());apf.aml.setElement("model",apf.model);apf.list=function(c,a){this.$init(a||"list",apf.NODE_VISIBLE,c);};apf.thumbnail=function(c,a){this.$init(a||"thumbnail",apf.NODE_VISIBLE,c);};apf.select=function(c,a){this.$init(a||"select",apf.NODE_VISIBLE,c);};apf.select1=function(c,a){this.$init(a||"selectl",apf.NODE_VISIBLE,c);};(function(){if(!apf.isIphone){this.implement(apf.Rename);}this.$getCaptionElement=function(){if(!(this.$caret||this.$selected)){return;}var d=this.$getLayoutNode("item","caption",this.$caret||this.$selected);if(!d){return;}return d.nodeType==1?d:d.parentNode;};this.addEventListener("afterselect",function(d){if(this.hasFeature(apf.__VALIDATION__)){this.validate(true);}});this.$supportedProperties.push("appearance","mode","more","thumbsize");this.$propHandlers.thumbsize=function(l){var j=this.thumbclass;if(apf.isIE){j=j.splitSafe(",");for(var d=0;d<j.length;d++){apf.setStyleRule(j[d],"width",l+"px");apf.setStyleRule(j[d],"height",l+"px");}return;}apf.setStyleRule(j,"width",l+"px");apf.setStyleRule(j,"height",l+"px");};this.$propHandlers.appearance=function(d){};this.mode="normal";this.$propHandlers.mode=function(d){this.mode=d||"normal";if("check|radio".indexOf(this.mode)>-1){this.allowdeselect=false;this.addEventListener("afterrename",a);if(this.mode=="check"){this.autoselect=false;this.ctrlselect=true;}else{if(this.mode=="radio"){this.multiselect=false;}}}else{this.ctrlselect=false;this.removeEventListener("afterrename",a);}};function a(){}this.$propHandlers.more=function(d){if(d){this.delayedselect=false;this.addEventListener("xmlupdate",c);this.addEventListener("afterload",c);this.$setClearMessage=function(i){if(!this.moreItem){this.$fill();}this.$int.appendChild(this.moreItem);};this.$updateClearMessage=function(){};this.$removeClearMessage=function(){};}else{this.removeEventListener("xmlupdate",c);this.removeEventListener("afterload",c);}};function c(d){if((!d.action||"insert|add|synchronize|move".indexOf(d.action)>-1)&&this.moreItem){this.$int.appendChild(this.moreItem);}}this.addEventListener("keydown",this.$keyHandler,true);this.$draw=function(){this.appearance=this.getAttribute("appearance")||"compact";var i=this.getAttribute("mode");this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);if(apf.hasCssUpdateScrollbarBug&&!this.mode){this.$fixScrollBug();}var d=this;this.$ext.onclick=function(j){d.dispatchEvent("click",{htmlEvent:j||event});};this.listtype=parseInt(this.$getOption("main","type"))||1;this.behaviour=parseInt(this.$getOption("main","behaviour"))||1;this.thumbsize=this.$getOption("main","thumbsize");this.thumbclass=this.$getOption("main","thumbclass");};this.$loadAml=function(d){};this.$destroy=function(){if(this.$ext){this.$ext.onclick=null;}apf.destroyHtmlNode(this.oDrag);this.oDrag=null;};}).call(apf.list.prototype=new apf.BaseList());apf.thumbnail.prototype=apf.select.prototype=apf.select1.prototype=apf.list.prototype;apf.aml.setElement("thumbnail",apf.thumbnail);apf.aml.setElement("select",apf.select);apf.aml.setElement("select1",apf.select1);apf.aml.setElement("list",apf.list);apf.errorbox=function(c,a){this.$init(a||"errorbox",apf.NODE_VISIBLE,c);};(function(){this.$positioning="basic";this.display=function(d){this.host=d;var c=d.validityState.$errorHtml||d.$ext;document.body.appendChild(this.$ext);var a=(parseFloat(d.$getOption&&d.$getOption("main","erroffsetx")||0)),i=(parseFloat(d.$getOption&&d.$getOption("main","erroffsety")||0));this.show();apf.popup.show(this.$uniqueId,{x:a,y:i,animate:false,ref:c});this.$setStyleClass(this.$ext,a+this.$ext.offsetWidth>this.$ext.offsetParent.offsetWidth?"rightbox":"leftbox",["leftbox","rightbox"]);};this.setMessage=function(a){if(a&&a.indexOf(";")>-1){a=a.split(";");a="<strong>"+a[0]+"</strong>"+a[1];}this.$int.innerHTML=a||"";};this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);this.oClose=this.$getLayoutNode("main","close",this.$ext);if(this.oClose){var a=this;this.oClose.onclick=function(){a.hide();if(apf.document.activeElement){apf.document.activeElement.focus(true,{mouse:true});}};}this.$ext.onmousedown=function(c){(c||event).cancelBubble=true;if(apf.hasFocusBug){apf.window.$focusfix();}};this.hide();apf.popup.setContent(this.$uniqueId,this.$ext,"",null,null);};this.$loadAml=function(a){};this.$destroy=function(){if(this.oClose){this.oClose.onclick=null;}this.$ext.onmousedown=null;apf.popup.removeContent(this.$uniqueId);};}).call(apf.errorbox.prototype=new apf.Presentation());apf.aml.setElement("errorbox",apf.errorbox);apf.services=function(c,a){this.$init(a||"services",apf.NODE_VISIBLE,c);this.addEventListener("DOMNodeInsertedIntoDocument",function(i){var d=this.parentNode;if(d.register){d.register(this);}});};apf.services.prototype=new apf.AmlElement();apf.aml.setElement("services",apf.services);apf.validation=function(c,a){this.$init(a||"validation",apf.NODE_HIDDEN,c);};(function(){this.$rules=[];var a={};this.register=function(c){if(c.tagName!="model"){return;}a[c.$uniqueId]=c;c.$validation=this;};this.unregister=function(){a[amlNode.$uniqueId]=null;delete a[amlNode.$uniqueId];amlNode.$validation=null;};this.getRule=function(j){var m=apf.xmldb.nodeConnect(apf.xmldb.getXmlDocId(j),j.nodeType==1?j:j.parentNode);for(var d=0,c=this.$rules.length;d<c;d++){if(j.ownerDocument.selectSingleNode("(.//"+this.$rules[d][0].split("|").join("|.//")+")[@"+apf.xmldb.xmlIdTag+"='"+m+"']")){return this.$rules[d][1];}}};this.validate=function(d,i,c){var j=this.getRule(d);if(!j){return c;}return(j.isValid||(j.isValid=apf.validator.compile(j)))(apf.queryValue(d),i,c);};this.addEventListener("DOMNodeInsertedIntoDocument",function(q){var u=this.$aml;var t,s,d,c=u.childNodes;for(var o=0,m=c.length;o<m;o++){if((d=c[o]).nodeType!=1){continue;}this.$rules.push([d.getAttribute("match"),(t={})]);s=d.attributes;for(var n=0;n<s.length;n++){t[s[n].nodeName]=s[n].nodeValue;}t.node=d;}this.register(this.parentNode);});}).call(apf.validation.prototype=new apf.AmlElement());apf.aml.setElement("validation",apf.validation);apf.splitter=function(c,a){this.$init(a||"splitter",apf.NODE_VISIBLE,c);apf.plane.init();};(function(){this.$focussable=true;this.update=function(){var E=(this.type=="vertical")?{fsize:"fwidth",size:"width",offsetPos:"offsetLeft",offsetSize:"offsetWidth",pos:"left"}:{fsize:"fheight",size:"height",offsetPos:"offsetTop",offsetSize:"offsetHeight",pos:"top"};this.$ext.offsetTop;this.$amlNode=this.refNode;var m=this.refHtml;var o=apf.layout.vars;var u=this.oItem;var D=false;var C=m?m[E.offsetPos]:o[E.pos+"_"+u.id];var l=m?m[E.offsetSize]:o[E.size+"_"+u.id];var d=u.parent.children;for(var n=0,A=0;A<d.length;A++){if(!d[A][E.fsize]){n++;}}if(!u[E.fsize]&&n>1){for(var c=0,a=0,A=u.stackId+1;A<d.length;A++){if(!d[A][E.fsize]){c+=d[A].weight||1;a+=(d[A].node?d[A].oHtml[E.offsetSize]:o[E.size+"_"+d[A].id]);}}var q=this.$ext[E.offsetPos]-C-l;var B=(a-q)/c;for(var A=0;A<u.stackId;A++){if(!d[A][E.fsize]){d[A].original.weight=(d[A].node?d[A].oHtml[E.offsetSize]:o[E.size+"_"+d[A].id])/B;}}u.original.weight=(l+q)/B;D=true;}else{var s=u[E.fsize]?u[E.fsize].match(/^\d+$/):false;var G=u[E.fsize]?u[E.fsize].match(/^([\d\.]+)\%$/):false;if(s||G||!u[E.fsize]){var q=this.$ext[E.offsetPos]-C-l;var w=this.$ext[E.offsetPos]-C;for(var I=0,t=0,A=u.stackId+1;A<d.length;A++){if(!d[A][E.fsize]){I+=d[A].weight||1;t+=(d[A].node?d[A].oHtml[E.offsetSize]:o[E.size+"_"+d[A].id]);}}if(I>0){var j=((t-q)/I)/(t/I);for(var A=u.stackId+1;A<d.length;A++){d[A].original.weight=j*(d[A].weight||1);}}else{for(var A=u.stackId+1;A<d.length;A++){if(d[A][E.fsize].match(/^\d+$/)){var F=(d[A].node?d[A].oHtml[E.offsetSize]:o[E.size+"_"+d[A].id])-q;d[A].original[E.fsize]=""+Math.max(0,F,d[A].minheight||0);if(d[A][E.fsize]-F!=0){q=d[A][E.fsize]-F;}else{break;}}else{if(d[A][E.fsize].match(/^([\d\.]+)\%$/)){var F=(d[A].node?d[A].oHtml[E.offsetSize]:o[E.size+"_"+d[A].id])-q;d[A].original[E.fsize]=Math.max(0,((parseFloat(RegExp.$1)/(d[A].node?d[A].oHtml[E.offsetSize]:o[E.size+"_"+d[A].id]))*F))+"%";break;}}}}if(u.original[E.fsize]){u.original[E.fsize]=G?((parseFloat(G[1])/l)*w)+"%":""+w;}D=true;}}if(D){apf.layout.compile(this.$ext.parentNode);apf.layout.activateRules(this.$ext.parentNode);if(apf.hasSingleRszEvent){apf.layout.forceResize();}return;}apf.layout.forceResize(this.$ext.parentNode);};this.init=function(w,q,z){this.min=0;this.max=1000000;this.size=parseInt(w)||3;this.refNode=null;this.refHtml=null;var c;if(q){if(typeof q!="object"){q=apf.lookup(q);}this.refNode=q;this.refHtml=this.refNode.$ext;c=this.refHtml.parentNode;z=q.aData.calcData;}else{c=z.pHtml;}this.oItem=z;if(c&&c!=this.$ext.parentNode){c.appendChild(this.$ext);}var u=apf.getDiff(this.$ext);this.$verdiff=u[0];this.$hordiff=u[1];this.$sizeArr=[];this.type=z.parent.vbox?"horizontal":"vertical";var D=apf.layout.get(this.$ext.parentNode).layout;var E="splitter"+this.$uniqueId;D.addRule("var "+E+" = apf.lookup("+this.$uniqueId+").$ext");var a=[E+".style.left = "];var l=[E+".style.top = "];var m=[E+".style.width = -"+this.$hordiff+" + "];var t=[E+".style.height = -"+this.$verdiff+" + "];var s=z.parent.children[z.stackId+1];if(this.type=="horizontal"){m.push("Math.max(");if(z.node){a.push(z.id+".offsetLeft");l.push(z.id+".offsetTop + "+z.id+".offsetHeight");m.push(z.id+".offsetWidth");}else{a.push("v.left_"+z.id);l.push("v.top_"+z.id+" + v.height_"+z.id);m.push("v.width_"+z.id);}m.push(",",s?(s.node?s.id+".offsetWidth":"v.width_"+s.id):0,")");D.addRule(m.join(""));this.$ext.style.height=(z.splitter-this.$hordiff)+"px";}else{t.push("Math.max(");if(z.node){a.push(z.id+".offsetLeft + "+z.id+".offsetWidth");l.push(z.id+".offsetTop");t.push(z.id+".offsetHeight");}else{a.push("v.left_"+z.id+" + v.width_"+z.id);l.push("v.top_"+z.id);t.push("v.height_"+z.id);}t.push(",",s?(s.node?s.id+".offsetHeight":"v.height_"+s.id):0,")");D.addRule(t.join(""));this.$ext.style.width=(z.splitter-this.$hordiff)+"px";}D.addRule(a.join(""));D.addRule(l.join(""));var n=z.parent.children;if(this.type=="vertical"){D.addRule(E+".host.min = "+(z.node?"document.getElementById('"+z.id+"').offsetLeft":"v.left_"+z.id)+" + "+parseInt(z.minwidth||z.childminwidth||10));var A=[],j=[];for(var o=false,B=z.stackId+1;B<n.length;B++){if(!n[B].fwidth){o=true;}}for(var C,B=z.stackId+1;B<n.length;B++){C=n[B];if(C.minwidth||C.childminheight){A.push(parseInt(C.minwidth||C.childminheight));}else{if(C.fwidth){if(!o&&B==z.stackId+1){A.push(10);}else{if(C.fwidth.indexOf("%")!=-1){A.push("("+C.parent.innerspace+") * "+(parseFloat(C.fwidth)/100));}else{A.push(C.fwidth);}}}else{A.push(10);}}A.push(C.edgeMargin);}D.addRule(E+".host.max = v.left_"+z.parent.id+" + v.width_"+z.parent.id+" - ("+(A.join("+")||0)+")");}else{D.addRule(E+".host.min = "+(z.node?"document.getElementById('"+z.id+"').offsetTop":"v.top_"+z.id)+" + "+parseInt(z.minheight||z.childminheight||10));var A=[],j=[];for(var o=false,B=z.stackId+1;B<n.length;B++){if(!n[B].fheight){o=true;}}if(!o&&s&&s.state>0){return this.$ext.parentNode.removeChild(this.$ext);}for(var C,B=z.stackId+1;B<n.length;B++){C=n[B];if(C.minheight||C.childminheight){A.push(parseInt(C.minheight||C.childminheight));}else{if(C.fheight){if(!o&&B==z.stackId+1){A.push(10);}else{if(C.fheight.indexOf("%")!=-1){A.push("("+C.parent.innerspace+") * "+(parseFloat(C.fheight)/100));}else{A.push(C.fheight);}}}else{A.push(10);}}if(C.edgeMargin){A.push(C.edgeMargin);}}D.addRule(E+".host.max = v.top_"+z.parent.id+" + v.height_"+z.parent.id+" - ("+(A.join("+")||0)+")");}this.$setStyleClass(this.$ext,this.type,[this.type=="horizontal"?"vertical":"horizontal"]);if(this.type=="vertical"){this.$setStyleClass(this.$ext,"w-resize",["n-resize"]);}else{this.$setStyleClass(this.$ext,"n-resize",["w-resize"]);}return this;};this.$draw=function(){this.$ext=this.$getExternal();var a=this;this.$ext.onmousedown=function(d){if(!d){d=event;}var c=a;var i=apf.getAbsolutePosition(this);if(c.type=="vertical"){c.tx=d.clientX-i[0];}else{c.ty=d.clientY-i[1];}c.startPos=c.type=="vertical"?this.offsetLeft:this.offsetTop;d.returnValue=false;d.cancelBubble=true;apf.plane.show(this);c.$setStyleClass(this,"moving");c.$setStyleClass(document.body,c.type=="vertical"?"w-resize":"n-resize",[c.type=="vertical"?"n-resize":"w-resize"]);document.onmouseup=function(){c.$setStyleClass(c.$ext,"",["moving"]);apf.plane.hide();c.update();c.$setStyleClass(document.body,"",["n-resize","w-resize"]);document.onmouseup=document.onmousemove=null;};document.onmousemove=function(j){if(!j){j=event;}if(c.type=="vertical"){if(j.clientX>=0){var l=apf.getAbsolutePosition(c.$ext.offsetParent);c.$ext.style.left=(Math.min(c.max,Math.max(c.min,(j.clientX-l[0])-c.tx)))+"px";}}else{if(j.clientY>=0){var l=apf.getAbsolutePosition(c.$ext.offsetParent);c.$ext.style.top=(Math.min(c.max,Math.max(c.min,(j.clientY-l[1])-c.ty)))+"px";}}j.returnValue=false;j.cancelBubble=true;};};};this.$loadAml=function(c){if(this.left||this.top){var l=this.left||this.top;var j=this.right||this.bottom;l=l.split(/\s*,\s*/);j=j.split(/\s*,\s*/);for(var d=0;d<l.length;d++){l[d]=l[d];}for(var d=0;d<j.length;d++){j[d]=j[d];}var a=this;$setTimeout(function(){this.$amlNode.init(a.type,a.size,a.min,a.max,a.change,l,j);});}};}).call(apf.splitter.prototype=new apf.Presentation());apf.aml.setElement("splitter",apf.splitter);apf.pager=function(c,a){this.$init(a||"pager",apf.NODE_VISIBLE,c);};(function(){this.previous="Previous";this.next="Next";this.range=5;this.curpage=1;this.totalpages=0;this.autohide=false;this.oEmpty=null;this.$attrExcludePropBind=apf.extend({pageload:1},this.$attrExcludePropBind);this.$supportedProperties.push("range","curpage","totalpages","previous","next","autohide","pageload");this.$booleanProperties.autohide=true;this.$propHandlers.curpage=function(a){this.gotoPage(a);};this.gotoPage=function(j,i){var d=this.curpage;this.curpage=j||this.curpage+i;if(d!=this.curpage){this.setProperty("curpage",this.curpage);}if(this.curpage<1){this.curpage=1;}else{if(this.totalpages&&this.curpage>this.totalpages){this.curpage=this.totalpages;}}if(this.dispatchEvent("beforepagechange",{page:this.curpage})===false){return false;}var c=this.getModel(true),a=this;if(c){c.$loadFrom(this.pageload,{xmlNode:this.xmlRoot,page:this.curpage,callback:function(){a.dispatchEvent("afterpagechange",{page:a.curpage});}});}else{$setTimeout(function(){var l=a.getModel(true);if(l){l.$loadFrom(a.pageload,{xmlNode:a.xmlRoot,page:a.curpage,callback:function(){a.dispatchEvent("afterpagechange",{page:a.curpage});}});}a.removeEventListener("afterload",arguments.callee);});}};this.addEventListener("$clear",function(a){return false;});this.$setClearMessage=function(c,a){if(!this.$empty){this.$empty=this.$int.ownerDocument.createElement("span");this.$setStyleClass(this.$empty,"loader");}if(a=="loading"){this.$setStyleClass(this.$ext,this.$baseCSSname+"Loading");this.$int.appendChild(this.$empty);}};this.$removeClearMessage=function(){if(this.$empty&&this.$empty.parentNode){this.$empty.parentNode.removeChild(this.$empty);this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Loading"]);}};this.$draw=function(){this.$ext=this.$getExternal("main");this.$int=this.$getLayoutNode("main","container",this.$ext);};this.$load=function(j){this.setProperty("curpage",parseInt(this.$applyBindRule("current",j)));this.setProperty("totalpages",parseInt(this.$applyBindRule("total",j)));var l=this.curpage,o=this.totalpages,a=[],d;this.$int.innerHTML="";if(!o){return;}if(l!=1||!this.autohide){this.$getNewContext("button");d=this.$getLayoutNode("button");this.$getLayoutNode("button","caption").nodeValue=this.previous;this.$setStyleClass(d,"previous");if(l!=1){d.setAttribute("onclick","apf.lookup("+this.$uniqueId+").gotoPage(null, -1)");}else{this.$setStyleClass(d,"disabled");}a.push(d);}var q=Math.floor(this.range/2),c=Math.max(1,l-q),m=Math.min(o+1,c+this.range),n;if(m-c<this.range&&c!=1){c=Math.max(m-this.range,1);}for(n=c;n<m;n++){this.$getNewContext("button");d=this.$getLayoutNode("button");this.$getLayoutNode("button","caption").nodeValue=n;d.setAttribute("onclick","apf.lookup("+this.$uniqueId+").gotoPage("+n+")");a.push(d);if(n==l){this.$setStyleClass(d,"current");}}if(l!=o||!this.autohide){this.$getNewContext("button");d=this.$getLayoutNode("button");this.$getLayoutNode("button","caption").nodeValue=this.next;this.$setStyleClass(d,"next");if(l!=o){d.setAttribute("onclick","apf.lookup("+this.$uniqueId+").gotoPage(null, 1)");}else{this.$setStyleClass(d,"disabled");}a.push(d);}apf.insertHtmlNodes(a,this.$int);if(this.$empty){this.$int.appendChild(this.$empty);}};}).call(apf.pager.prototype=new apf.StandardBinding());apf.aml.setElement("pager",apf.pager);apf.aml.setElement("total",apf.BindingRule);apf.aml.setElement("current",apf.BindingRule);apf.calendar=function(c,a){this.$init(a||"calendar",apf.NODE_VISIBLE,c);this.$calVars={days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:[{name:"January",number:31},{name:"February",number:28},{name:"March",number:31},{name:"April",number:30},{name:"May",number:31},{name:"June",number:30},{name:"July",number:31},{name:"August",number:31},{name:"September",number:30},{name:"October",number:31},{name:"November",number:30},{name:"December",number:31}],day:null,month:null,year:null,hours:1,minutes:0,seconds:0,currentMonth:null,currentYear:null,numberOfDays:null,dayNumber:null,temp:null,inited:false,startDiffs:[],prevWidth:0,rRows:[],rCells:[[],[],[],[],[],[]],rDoW:[]};};(function(){this.implement(apf.DataAction);this.$supportedProperties.push("output-format","default");this.$propHandlers["output-format"]=function(d){if(this.value){var i=this.$calVars;this.setProperty("value",new Date(i.year,i.month,i.day,i.hours,i.minutes,i.seconds).format(this.outputFormat=d));}else{this.outputFormat=d;}};this.$propHandlers.value=function(i){var j=this.$calVars;if(!this.outputFormat){j.temp=i;return;}var d=Date.parse(i,this.outputFormat);j.day=d.getDate();j.month=d.getMonth();j.year=d.getFullYear();j.hours=d.getHours();j.minutes=d.getMinutes();j.seconds=d.getSeconds();this.value=i;this.redraw(j.month,j.year);};this.setValue=function(c){this.setProperty("value",c,false,true);};this.getValue=function(){return this.value;};this.addEventListener("keydown",function(j){j=j||event;var i=j.keyCode,l=j.ctrlKey,d=j.shiftKey,m=this.$calVars;switch(i){case 13:this.selectDay(m.day);break;case 33:this.nextMonth();break;case 34:this.prevMonth();break;case 37:if(l){this.prevMonth();}else{if(d){this.prevYear();}else{if(m.day-1<1){this.prevMonth();this.selectDay(m.months[m.currentMonth].number);}else{this.selectDay(m.day-1);}}}break;case 38:if(m.day-7<1){this.prevMonth();this.selectDay(m.months[m.currentMonth].number+m.day-7);}else{this.selectDay(m.day-7);}break;case 39:if(l){this.nextMonth();}else{if(d){this.nextYear();}else{this.selectDay(m.day+1);}}break;case 40:this.selectDay(m.day+7);break;case 84:if(l){this.today();}return false;break;}},true);this.$blur=function(){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);};this.$focus=function(){this.$setStyleClass(this.oFocus||this.$ext,this.$baseCSSname+"Focus");};var a=function(c){return((c%4==0)&&(c%100!==0))||(c%400==0)?true:false;};this.$getMargin=function(c){if(apf.isIE){return[(parseInt(apf.getStyle(c,"marginLeft"))||0)+(parseInt(apf.getStyle(c,"marginLeft"))||0),(parseInt(apf.getStyle(c,"marginTop"))||0)+(parseInt(apf.getStyle(c,"marginBottom"))||0)];}else{return[parseInt(apf.getStyle(c,"margin-right")||0)+parseInt(apf.getStyle(c,"margin-left")||0),parseInt(apf.getStyle(c,"margin-top")||0)+parseInt(apf.getStyle(c,"margin-bottom")||0)];}};this.$getFontSize=function(c){return apf.isIE?parseInt(apf.getStyle(c,"fontSize")):parseInt(apf.getStyle(c,"font-size"));};this.$getPadding=function(c){return apf.isIE?[parseInt(apf.getStyle(c,"paddingLeft"))+parseInt(apf.getStyle(c,"paddingRight")),parseInt(apf.getStyle(c,"paddingTop"))+parseInt(apf.getStyle(c,"paddingBottom"))]:[parseInt(apf.getStyle(c,"padding-left"))+parseInt(apf.getStyle(c,"padding-right")),parseInt(apf.getStyle(c,"padding-top"))+parseInt(apf.getStyle(c,"padding-bottom"))];};this.$resize=function(){var z=parseInt(this.$ext.style.width||0),K=this.$calVars,G,E,B,C;if(K.rRows.length==0){rows=this.oContent.childNodes;for(G=0,B=rows.length;G<B;G++){if((rows[G].className||"").indexOf("row")>-1){K.rRows.push(rows[G]);cells=rows[G].childNodes;for(E=0,C=cells.length;E<C;E++){if((cells[E].className||"").indexOf("cell")>-1){K.rCells[K.rRows.length-1].push(cells[E]);}}}}}if(K.rDoW.length==0){var s=this.oDow.childNodes;for(G=0,B=s.length;G<B;G++){if((s[G].className||"").indexOf("dayofweek")>-1){K.rDoW.push(s[G]);}}}if(z>0&&K.prevWidth!==z){K.prevWidth=z;var u=apf.getDiff(this.$ext),o=parseInt(this.$ext.offsetWidth||this.$ext.style.width||apf.getStyle(this.$ext,"width"))-u[0],n=K.startDiffs[0],A=K.startDiffs[1],J=K.startDiffs[2],F=K.startDiffs[3],m=K.startDiffs[4],M=o-n[0]-A[0],D=Math.floor(M*0.125)-J[0]-F[0],w=D+(J[1]>J[0]?J[0]-J[1]:0)+(F[1]>F[0]?F[0]-F[1]:0),t,I=Math.floor((M-n[0]-A[0]-(D+J[0]+F[0])*8)*0.5);for(G=0,B=K.rRows.length;G<B;G++){var q=K.rRows[G];for(E=0,C=K.rCells[G].length;E<C;E++){var d=K.rCells[G][E];t=Math.ceil((w-this.$getFontSize(d))*0.5);d.style.width=(Math.max(D,0)-(apf.isIE||apf.isChrome?1:0))+"px";d.style.height=(w-(2*t-J[1]))+"px";d.style.paddingTop=(t>0?t+1:0)+"px";d.style.paddingBottom=(t>0?t-1:0)+"px";if(apf.isIE||apf.isChrome){d.style.paddingLeft=(parseInt(d.style.paddingLeft||0)+1)+"px";}}q.style.paddingLeft=I+"px";this.$ext.style.paddingBottom=(Math.floor(m[1]*0.5)+I)+"px";}this.oDow.style.paddingLeft=I+"px";for(G=0,B=K.rDoW.length;G<B;G++){var N=K.rDoW[G];N.style.width=D+"px";if(D<16){N.style.fontSize="9px";}}}};this.redraw=function(W,B){var I=new Date(B,0,1),Y=I.getDay(),C=Y,T=this.$calVars;T.currentMonth=W;T.currentYear=B;for(O=0;O<=W;O++){if(a(B)&&O==1){C++;}C+=T.months[O].number;}var J=Math.ceil(C/7),U=new Date(B,W);T.numberOfDays=T.months[U.getMonth()].number;if(a(B)&&U.getMonth()==1){T.numberOfDays++;}T.dayNumber=new Date(B,W,1).getDay();var Z=W==0?11:W-1,ab=T.months[Z].number-T.dayNumber+1,E=1,w=apf.getDiff(this.$ext),o=parseInt(this.$ext.offsetWidth||this.$ext.style.width||apf.getStyle(this.$ext,"width"))-w[0],aa=this.oNavigation.childNodes;if(!o){return;}for(O=0;O<aa.length;O++){if((aa[O].className||"").indexOf("today")!=-1){aa[O].innerHTML="T";}else{if((aa[O].className||"").indexOf("status")!=-1){if(o>=300){aa[O].innerHTML=T.months[T.currentMonth].name+" "+T.currentYear;aa[O].style.width="100px";aa[O].style.marginLeft="-50px";}else{aa[O].innerHTML=(T.currentMonth+1)+"/"+T.currentYear;aa[O].style.width="40px";aa[O].style.marginLeft="-20px";}}}}var A=this.oContent.childNodes,M,P;for(var O=0,t=0,u=0;O<A.length;O++){if((A[O].className||"").indexOf("row")>-1){var l=!T.inited?apf.getDiff(A[O]):T.startDiffs[0];var G=!T.inited?this.$getMargin(A[O]):T.startDiffs[1];var V=o-l[0]-G[0];if(!T.inited){T.startDiffs[0]=l;T.startDiffs[1]=G;}var m=A[O].childNodes;for(var K=0,n=0;K<m.length;K++){if((m[K].className||"").indexOf("cell")>-1){var Q=!T.inited?apf.getDiff(m[K]):T.startDiffs[2],N=!T.inited?this.$getMargin(m[K]):T.startDiffs[3];if(!T.inited){T.startDiffs[2]=Q;T.startDiffs[3]=N;}M=Math.floor(V/8)-Q[0]-N[0];var F=M,D=M+(Q[1]>Q[0]?Q[0]-Q[1]:0)+(N[1]>N[0]?N[0]-N[1]:0),R;var s=R=Math.ceil((D-this.$getFontSize(m[K]))/2);D-=(R+s-Q[1]);m[K].style.width=(F>0?F:0)+"px";m[K].style.height=(D>0?D:0)+"px";m[K].style.paddingTop=(R>0?R+1:0)+"px";m[K].style.paddingBottom=(s>0?s-1:0)+"px";this.$setStyleClass(m[K],"",["weekend","disabled","active","prev","next","weeknumber"]);t++;if((t-1)%8==0){m[K].innerHTML=J-Math.ceil((T.months[T.month].number+T.dayNumber)/7)+1+(t-1)/8;this.$setStyleClass(m[K],"weeknumber");}else{u++;if(u<=T.dayNumber){m[K].innerHTML=ab++;this.$setStyleClass(m[K],"disabled prev");}else{if(u>T.dayNumber&&u<=T.numberOfDays+T.dayNumber){m[K].innerHTML=u-T.dayNumber;var X=new Date(B,W,u-T.dayNumber).getDay();if(X==0||X==6){this.$setStyleClass(m[K],"weekend");}if(W==T.month&&B==T.year&&u-T.dayNumber==T.day){this.$setStyleClass(m[K],"active");}}else{if(u>T.numberOfDays+T.dayNumber){m[K].innerHTML=E++;this.$setStyleClass(m[K],"disabled next");n++;}}}}}}P=Math.floor((V-l[0]-G[0]-(M+Q[0]+N[0])*8)/2);A[O].style.paddingLeft=P+"px";var d=!T.inited?this.$getPadding(this.$ext):T.startDiffs[4];if(!T.inited){T.startDiffs[4]=d;}this.$ext.style.paddingBottom=(Math.floor(d[1]/2)+P)+"px";if(!this.height){A[O].style.display=n==7?"none":"block";}else{A[O].style.visibility=n==7?"hidden":"visible";}}}var q=this.oDow.childNodes;this.oDow.style.paddingLeft=P+"px";for(var t=0,O=0;O<q.length;O++){if((q[O].className||"").indexOf("dayofweek")>-1){q[O].style.width=(M>0?M:0)+"px";if(M<16){q[O].style.fontSize="9px";}if(t>0){q[O].innerHTML=T.days[t-1].substr(0,M<12?1:(M<16?2:3));}else{q[O].innerHTML="&nbsp;";}t++;}}T.inited=true;};this.selectDay=function(j,i){var m=this.$calVars,l=i=="prev"?m.currentMonth:(i=="next"?m.currentMonth+2:m.currentMonth+1),d=m.currentYear;if(l<1){l=12;d--;}else{if(l>12){l=1;d++;}}this.change(new Date(d,(l-1),j,m.hours,m.minutes,m.seconds).format(this.outputFormat));};this.nextYear=function(){this.redraw(this.$calVars.currentMonth,this.$calVars.currentYear+1);};this.prevYear=function(){this.redraw(this.$calVars.currentMonth,this.$calVars.currentYear-1);};this.nextMonth=function(){var d=this.$calVars;this.redraw(d.currentMonth>10?0:d.currentMonth+1,d.currentMonth>10?d.currentYear+1:d.currentYear);};this.prevMonth=function(){var d=this.$calVars;this.redraw(d.currentMonth<1?11:d.currentMonth-1,d.currentMonth<1?d.currentYear-1:d.currentYear);};this.today=function(){this.setProperty("value",new Date().format(this.outputFormat));};this.$draw=function(){this.$ext=this.$getExternal("main",null,function(l){var m=this.$getLayoutNode("main","content",l);for(var q=0;q<6;q++){this.$getNewContext("row");var c=m.appendChild(this.$getLayoutNode("row"));for(var n=0;n<8;n++){this.$getNewContext("cell");var s=this.$getLayoutNode("cell");if(n>0){s.setAttribute("onmouseover","if (this.className.indexOf('disabled') > -1 || this.className.indexOf('active') > -1) return; apf.lookup("+this.$uniqueId+").$setStyleClass(this, 'hover');");s.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+").$setStyleClass(this, '', ['hover']);");s.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+"); if (this.className.indexOf('prev') > -1) { o.selectDay(this.innerHTML, 'prev');} else if (this.className.indexOf('next') > -1) {o.selectDay(this.innerHTML, 'next');} else {o.selectDay(this.innerHTML);}");}c.appendChild(s);}}var u=this.$getLayoutNode("main","navigation",l);if(u){var t=["prevYear","prevMonth","nextYear","nextMonth","today","status"];for(var q=0;q<t.length;q++){this.$getNewContext("button");var d=u.appendChild(this.$getLayoutNode("button"));this.$setStyleClass(d,t[q]);if(t[q]!=="status"){d.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+")."+t[q]+"()");}}}var o=this.$getLayoutNode("main","daysofweek",l);for(var q=0;q<this.$calVars.days.length+1;q++){this.$getNewContext("day");o.appendChild(this.$getLayoutNode("day"));}});this.oNavigation=this.$getLayoutNode("main","navigation",this.$ext);this.oDow=this.$getLayoutNode("main","daysofweek",this.$ext);this.oContent=this.$getLayoutNode("main","content",this.$ext);apf.layout.setRules(this.$ext,"resize","var o = apf.all["+this.$uniqueId+"];        if (o) o.$resize()",true);apf.layout.queue(this.$ext);};this.$loadAml=function(d){if(typeof this.value=="undefined"){switch(this["default"]){case"today":this.setProperty("value",new Date().format(this.outputFormat));break;default:this.setProperty("value",new Date().format(this.outputFormat));break;}}else{var j=this.$calVars,i=Date.parse(j.temp||this.value,this.outputFormat);j.day=i.getDate();j.month=i.getMonth();j.year=i.getFullYear();if(j.day&&j.month&&j.year){this.setProperty("value",new Date(j.year,j.month,j.day,j.hours,j.minutes,j.seconds).format(this.outputFormat));}}};this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);apf.destroyHtmlNode(this.$ext);this.oCalendar=null;};}).call(apf.calendar.prototype=new apf.StandardBinding());apf.aml.setElement("calendar",apf.calendar);apf.comment=function(){this.$init("comment",apf.NODE_HIDDEN);};apf.comment.prototype=new apf.AmlComment();apf.lineselect=function(c,a){this.$init(a||"lineselect",apf.NODE_VISIBLE,c);};(function(){this.deselect=function(){this.value=this.selected=null;};this.select=function(a){if(this.selected){this.selected.className=this.skin.clsItem;}a.className=this.skin.clsSelected;this.selected=a;this.dispatchEvent("afterselect",a.innerHTML);};this.$focus=function(){if(this.selected){this.selected.className=this.skin.clsSelected;}};this.$blur=function(){if(this.selected){this.selected.className=this.skin.clsBlur;}};this.$focussable=true;this.getHTML=function(a){a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");a=a.replace(/(^|\n)[^\(]*\(/g,"\n(");return a;};this.loadText=function(j){var c=this.getHTML(j).split("\n");for(var d=0;d<c.length;d++){if(c[d].match(/error \E/)){var a="red";}else{if(c[d].match(/warning \P/)){var a="yellow";}else{var a="white";}}c[d]="<div style='color:"+a+"' onmousedown='apf.lookup("+this.$uniqueId+").select(this)' ondblclick=\"apf.lookup("+this.$uniqueId+").dispatchEvent('onchoose', this.innerHTML)\" class='"+this.skin.clsItem+"'>"+c[d]+"</div>";}this.$ext.innerHTML="<div style='color:white' class='"+this.skin.clsItem+"'>APF Packager</div><div nowrap style='color:white' class='"+this.skin.clsItem+"'>(c) 2001-2003 All Rights Reserved.</div><br>"+c.join("");};this.addEventListener("keydown",function(d){var a=d.keyCode;if(this.renaming){if(a==27||a==13){this.stopRename();if(a==13){this.stopRename();}}return;}if(!this.selected){return;}switch(a){case 13:this.dispatchEvent("choose");break;case 38:if(!this.value){return;}var c=this.value;if(c.previousSibling){c=c.previousSibling;}if(c&&c.nodeType==1){this.select(document.getElementById(c.getAttribute("id")));}return false;break;case 40:if(!this.value){return;}var c=this.value;if(c.nextSibling){c=c.nextSibling;}if(c&&c.nodeType==1){this.select(document.getElementById(c.getAttribute("id")));}return false;break;}},true);this.$draw=function(c,a){this.$ext=this.$getExternal();this.$int=this.$ext;};}).call(apf.lineselect.prototype=new apf.GuiElement());apf.aml.setElement("lineselect",apf.lineselect);apf.upload=function(c,a){this.$init(a||"upload",apf.NODE_VISIBLE,c);this.DEFAULT_SWF_PATH=(apf.config.resourcePath||apf.basePath)+"resources/Swiff.Uploader.swf?noCache=".appendRandomNumber(5);this.$playerId=apf.flash.addPlayer(this);this.$useFlash=apf.flash.isAvailable("9.0.0");this.$files=new apf.upload.files();};(function(){this.implement(apf.DataAction);this.width=300;this.height=20;this.method="post";this.progress=0;this.uploading=false;this["type-filter"]=null;this.multiple=true;this.queued=1;this.policyfile=null;this.data=null;this["merge-data"]=true;this.fieldname="Filedata";this["filesize-min"]=1;this["filesize-max"]=0;this["allow-duplicates"]=false;this["time-limit"]=apf.isLinux?0:30;this.noflash=false;this.timeout=100000;this.$player=null;this.$playerInited=false;this.$focussable=false;this.$booleanProperties.uploading=true;this.$booleanProperties.multiple=true;this.$booleanProperties["merge-data"]=true;this.$booleanProperties["allow-duplicates"]=true;this.$booleanProperties.noflash=true;this.$supportedProperties.push("value","target","method","progress","uploading","rel","bgswitch","file-type","multiple","queued","policyfile","data","merge-data","fieldname","filesize-min","filesize-max","allow-duplicates","time-limit","model");this.$propHandlers.value=function(value){if(!this.value){this.old_value=value;}this.value=value;};this.$propHandlers.target=function(value){this.target=value=this.$qualifyPath(value);if(this.form){this.form.setAttribute("action",value);}};this.$propHandlers.bgswitch=function(value){if(!value){return;}this.$getLayoutNode("main","background",this.$ext).style.backgroundImage="url("+this.mediaPath+value+")";this.$getLayoutNode("main","background",this.$ext).style.backgroundRepeat="no-repeat";};this.$propHandlers.rel=function(value){var _self=this;window.setTimeout(function(){_self.rel=eval(value);if(_self.rel){_self.$reposition();}});};var propModelHandler=this.$propHandlers.model;this.$propHandlers.model=function(value){if(!value){return;}this.$files=new apf.upload.files(value);propModelHandler.call(this,value);};this.$propHandlers.noflash=function(value){this.$useFlash=!value;};this.setIcon=function(url){this.setProperty("icon",url,false,true);};this.setCaption=function(value){this.setProperty("caption",value,false,true);};this.getValue=function(){return this.value;};this.setValue=function(value){this.setProperty("value",value,false,true);};this.browse=function(){if(this.disabled||this.$useFlash||!this.$ext.parentNode.offsetHeight){return;}this.inpFile.click();if(this.inpFile.value!=this.value){this.setProperty("value",this.inpFile.value,false,true);this.dispatchEvent("afterbrowse",{value:this.value});}};this.upload=function(){if(!this.$useFlash){if(this.value!=this.inpFile.value||!this.inpFile.value){return;}this.old_value=this.value;this.value=this.inpFile.value;this.setValue(this.value);}this.$upload();};this.cancel=function(msg){return this.$cancel(msg);};this.setTarget=function(target){if(this.$useFlash){return;}this.target=target;this.$initForm();};this.event=function(eventName,eventObj){switch(eventName){case"load":this.$initUploader();break;case"fail":break;case"queue":this.setProperty("bytes-loaded",eventObj.bytesLoaded);this.setProperty("bytes-total",eventObj.size);this.setProperty("progress",eventObj.percentLoaded/100);this.setProperty("rate",eventObj.rate);break;case"complete":this.setProperty("uploading",false);break;case"buttonEnter":case"buttonLeave":case"buttonDown":case"buttonDisable":this.$setState(eventName);break;case"browse":case"disabledBrowse":if(this.rel&&!this.rel.disabled){this.rel.setProperty("disabled",true);}break;case"cancel":this.setProperty("uploading",false);break;case"selectSuccess":this.$files.createMany(eventObj);break;case"selectFail":this.$files.removeMany(eventObj);break;case"fileStart":case"fileStop":case"fileRequeue":case"fileOpen":case"fileProgress":case"fileComplete":case"fileRemove":this.$files.update(eventObj);break;default:break;}this.setAttribute("value",this.$files.getValue());};this.$initUploader=function(){this.$playerInited=true;apf.flash.remote(this.$player,"initialize",{width:this.width,height:this.height,typeFilter:this["type-filter"],multiple:this.multiple,queued:this.queued,url:this.target,method:this.method,data:this.data,mergeData:this["merge-data"],fieldName:this["fieldname"],verbose:false,fileSizeMin:this["filesize-min"],fileSizeMax:this["filesize-max"],allowDuplicates:this["allow-duplicates"],timeLimit:this["time-limit"],policyFile:this["policyfile"]});};var states={buttonEnter:"Over",buttonLeave:"Out",buttonDown:"Down"};this.$setState=function(state){if(!this.rel){return null;}if(state=="buttonDisabled"){return this.rel.setProperty("disabled",true);}else{if(this.rel.disabled){this.rel.setProperty("disabled",false);}}return this.rel.$setState(states[state]);};this.$reposition=function(){if(!this.rel){return;}var o=this.rel.$ext,pos=apf.getAbsolutePosition(o);this.$ext.style.top=pos[1]+"px";this.$ext.style.left=pos[0]+"px";this.$ext.style.width=o.offsetWidth+"px";this.$ext.style.height=o.offsetHeight+"px";};var anchor;this.$qualifyPath=function(path){(anchor||(anchor=document.createElement("a"))).href=path;return anchor.href;};this.$updateProgress=function(){this.setProperty("progress",Math.min(1,(this.progress||0)+(1/800)));};this.$upload=function(){this.$uploading=true;this.setProperty("uploading",true);if(this.$useFlash){apf.flash.remote(this.$player,"start");}else{this.timer=setInterval("apf.lookup("+this.$uniqueId+").$updateProgress()",800);this.timeout_timer=$setTimeout("apf.lookup("+this.$uniqueId+").$timeout()",this.timeout);this.form.submit();}};this.$done=function(data){window.clearInterval(this.timer);window.clearInterval(this.timeout_timer);window.setTimeout("apf.lookup("+this.$uniqueId+").$clearProgress()",300);this.old_value=null;this.data=data;this.dispatchEvent("uploaded",{data:data});this.$initForm();this.$uploading=false;};this.$cancel=function(value){if(this.$useFlash){apf.flash.remote(this.$player,"stop");}else{window.clearInterval(this.timer);window.clearInterval(this.timeout_timer);if(this.old_value){this.setValue(this.old_value);}this.old_value=null;this.$initForm();}this.dispatchEvent("cancel",{returnValue:value});this.$uploading=false;this.$clearProgress();};this.$timeout=function(){clearInterval(this.timer);clearInterval(this.timeout_timer);this.$clearProgress();if(this.old_value){this.setValue(this.old_value);}this.old_value=null;this.dispatchEvent("timeout");this.$initForm();this.$uploading=false;};this.$clearProgress=function(){this.setProperty("progress",0);this.setProperty("uploading",false);};this.$initForm=function(){if(apf.isIE){this.oFrame.contentWindow.document.write("<body></body>");this.form=apf.insertHtmlNode(this.$getLayoutNode("form"),this.oFrame.contentWindow.document.body);}this.form.setAttribute("action",this.target);this.form.setAttribute("target","upload"+this.$uniqueId);this.$getLayoutNode("form","inp_uid",this.form).setAttribute("value",this.$uniqueId);this.inpFile=this.$getLayoutNode("form","inp_file",this.form);var _self=this;if(!apf.isIE){this.inpFile.setAttribute("size","0");this.inpFile.onchange=function(){_self.setProperty("value",this.value);};}if(apf.debug==2){this.oFrame.style.visibility="visible";this.oFrame.style.width="100px";this.oFrame.style.height="100px";}if(apf.isIE){return;}var timer=setInterval(function(){var oNode=_self.rel?_self.rel:null;_self.inpFile.onchange=function(){_self.browse();};if(oNode&&oNode.$ext&&oNode.$ext.offsetHeight){if(oNode.$ext.offsetWidth==0||oNode.$ext.offsetHeight==0){return;}var z=parseInt(oNode.$ext.style.zIndex)||1;oNode.$ext.style.zIndex=z;_self.inpFile.style.zIndex=++z;_self.inpFile.style.margin="0";_self.inpFile.style.position=oNode.$ext.style.position;_self.inpFile.style.width=oNode.$ext.offsetWidth+"px";_self.inpFile.style.height=oNode.$ext.offsetHeight+"px";_self.inpFile.style.top=(oNode.$ext.offsetTop-20)+"px";_self.inpFile.style.left=(oNode.$ext.offsetLeft-8)+"px";clearInterval(timer);}},500);};this.$draw=function(){this.$name="upload"+this.$uniqueId;var _self=this;this.$useFlash=!this.getAttribute("noflash");if(this.$useFlash&&!this["noflash"]){this.$ext=this.$getExternal("main");this.$ext.style.position="absolute";this.$ext.style.zIndex="9999";this.$ext.style.width=this.width;this.$ext.style.height=this.height;apf.flash.embed({context:this,htmlNode:this.$ext,src:this.DEFAULT_SWF_PATH,width:"100%",height:"100%",id:this.$name,quality:"high",name:this.$name,flashvars:"playerID="+this.$playerId,allowScriptAccess:"always",wMode:"transparent",swLiveConnect:"true",type:"application/x-shockwave-flash",pluginspage:"http://www.adobe.com/go/getflashplayer",menu:"false"});}else{this.width="auto";this.height="auto";this.$ext=this.$getExternal("main",null,function(oExt){oExt.appendChild(oExt.ownerDocument.createElement("iframe")).setAttribute("name","upload"+this.$uniqueId);});if(!apf.isIE){this.form=apf.insertHtmlNode(this.$getLayoutNode("form"),this.$ext);}this.oFrame=this.$ext.getElementsByTagName("iframe")[0];apf.AbstractEvent.addListener(this.oFrame,"load",function(){if(!_self.uploading){return;}var data="";try{data=apf.html_entity_decode(_self.oFrame.contentWindow.document.body.innerHTML.replace(/<PRE>|<\/PRE>/ig,""));}catch(e){}var hasFailed=_self.dispatchEvent("beforeuploaded",{data:data,frame:_self.oFrame})===false;if(hasFailed){_self.$cancel();}else{_self.$done(data);}});apf.AbstractEvent.addListener(this.oFrame,"error",function(){if(!_self.uploading){return;}_self.$cancel();});this.$initForm();}};this.addEventListener("DOMNodeRemovedFromDocument",function(){if(this.oFrame){this.oFrame.onload=null;}});}).call(apf.upload.prototype=new apf.StandardBinding());apf.upload.files=function(a){if(typeof a=="string"){a=apf.nameserver.get("model",a);}if(a){a.load("<files/>");}var c={},d={addDate:1,creationDate:1,extension:1,id:1,modificationDate:1,name:1,size:1,status:1,validationError:1};this.create=function(i){if(!i||!i.id||c[i.id]){return null;}c[i.id]=i;if(a){i.xml=a.data.ownerDocument.createElement("file");apf.xmldb.appendChild(a.data,i.xml);}return this.update(i);};this.createMany=function(j){if(!j||!j.length){return;}for(var n=0,m=j.length;n<m;n++){if(j[n]){this.create(j[n]);}}};this.read=function(i){};this.update=function(m){if(!m||!m.id){return null;}var l;if(!m.xml){var j=m;m=c[m.id];for(l in d){m[l]=j[l];}}if(!a||!m.xml){return null;}for(l in d){if(typeof m[l]=="undefined"){continue;}if(l.indexOf("Date")!=-1&&typeof m[l]=="number"){m[l]=new Date(m[l]);}m.xml.setAttribute(l,(l=="status")?apf.upload.STATUS_MAP[m[l]]:m[l]);}apf.xmldb.applyChanges("synchronize",m.xml);return m;};this.remove=function(i){if(!i||!i.id||!c[i.id]){return;}i=c[i.id];if(a&&i.xml){apf.xmldb.removeChild(a.data,i.xml);}delete c[i.id];};this.removeMany=function(j){if(!j||!j.length){return;}for(var n=0,m=j.length;n<m;n++){if(j[n]){this.remove(j[n]);}}};this.getValue=function(){var l,j=[];for(l in c){j.push(c[l].name);}return j.join("|");};};apf.upload.STATUS_QUEUED=0;apf.upload.STATUS_RUNNING=1;apf.upload.STATUS_ERROR=2;apf.upload.STATUS_COMPLETE=3;apf.upload.STATUS_STOPPED=4;apf.upload.STATUS_MAP=["queued","running","error","complete","stopped"];apf.aml.setElement("upload",apf.upload);apf.dropdown=function(c,a){this.$init(a||"dropdown",apf.NODE_VISIBLE,c);};(function(){this.$animType=1;this.$animSteps=5;this.$animSpeed=20;this.$itemSelectEvent="onmouseup";this.dragdrop=false;this.reselectable=true;this.$focussable=true;this.autoselect=false;this.multiselect=false;this.disableremove=true;this.delayedselect=false;this.maxitems=5;this.$booleanProperties.disableremove=true;this.$supportedProperties.push("maxitems","disableremove","initial-message","fill");this.$propHandlers.maxitems=function(c){this.sliderHeight=c?(Math.min(this.maxitems||100,c)*this.itemHeight):10;this.containerHeight=c?(Math.min(this.maxitems||100,c)*this.itemHeight):10;if(this.containerHeight>20){this.containerHeight=Math.ceil(this.containerHeight*0.9);}};this.slideToggle=function(c){if(!c){c=event;}if(this.isOpen){this.slideUp();}else{this.slideDown(c);}};this.slideDown=function(d){if(this.dispatchEvent("slidedown")===false){return false;}this.isOpen=true;this.$propHandlers.maxitems.call(this,this.xmlRoot&&this.each?this.getTraverseNodes().length:this.childNodes.length);this.oSlider.style.display="block";if(!this.ignoreOverflow){this.oSlider.style[apf.supportOverflowComponent?"overflowY":"overflow"]="hidden";}this.oSlider.style.display="";this.$setStyleClass(this.$ext,this.$baseCSSname+"Down");this.oSlider.style.height=(this.sliderHeight-1)+"px";this.oSlider.style.width=(this.$ext.offsetWidth-2-this.widthdiff)+"px";var c=this;apf.popup.show(this.$uniqueId,{x:0,y:this.$ext.offsetHeight,animate:true,ref:this.$ext,width:this.$ext.offsetWidth-this.widthdiff,height:this.containerHeight,callback:function(i){if(!c.ignoreOverflow){i.style[apf.supportOverflowComponent?"overflowY":"overflow"]="auto";}}});};this.slideUp=function(){if(this.isOpen==2){return false;}if(this.dispatchEvent("slideup")===false){return false;}this.isOpen=false;if(this.selected){var c=apf.xmldb.findHtmlNode(this.selected,this);if(c){this.$setStyleClass(c,"",["hover"]);}}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Down"]);apf.popup.hide();return false;};this.$setLabel=function(c){this.oLabel.innerHTML=c||this["initial-message"]||"";this.$setStyleClass(this.$ext,c?"":this.$baseCSSname+"Initial",!c?[]:[this.$baseCSSname+"Initial"]);};this.addEventListener("afterselect",function(c){if(!c){c=event;}this.slideUp();if(!this.isOpen){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over"]);}this.$setLabel(c.selection.length?this.$applyBindRule("caption",this.selected):"");});function a(){if(this.isOpen==2){this.slideDown();}}this.addEventListener("afterload",a);this.addEventListener("xmlupdate",function(){a.call(this);this.$setLabel(this.$applyBindRule("caption",this.selected));});this.$blur=function(){this.slideUp();if(!this.isOpen){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over"]);}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);};this.$setClearMessage=function(c){this.$setLabel(c);};this.$removeClearMessage=function(){this.$setLabel("");};this.addEventListener("popuphide",this.slideUp);this.addEventListener("keydown",function(n){var l=n.keyCode;if(!this.xmlRoot){return;}var m;switch(l){case 38:if(n.altKey){this.slideToggle(n.htmlEvent);return;}if(!this.selected){return;}m=this.getNextTraverseSelected(this.caret||this.selected,false);if(m){this.select(m);}break;case 40:if(n.altKey){this.slideToggle(n.htmlEvent);return;}if(!this.selected){m=this.getFirstTraverseNode();if(!m){return;}}else{m=this.getNextTraverseSelected(this.selected,true);}if(m){this.select(m);}break;default:if(l==9||!this.xmlRoot){return;}if(!this.lookup||new Date().getTime()-this.lookup.date.getTime()>1000){this.lookup={str:"",date:new Date()};}this.lookup.str+=String.fromCharCode(l);var d,c=this.getTraverseNodes();for(var j=0;j<c.length;j++){d=this.$applyBindRule("caption",c[j]);if(d&&d.indexOf(this.lookup.str)>-1){this.select(c[j]);return;}}return;}return false;},true);this.$draw=function(){this.$getNewContext("main");this.$getNewContext("container");this.$animType=this.$getOption("main","animtype")||1;this.clickOpen=this.$getOption("main","clickopen")||"button";this.$ext=this.$getExternal(null,null,function(d){d.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+');o.$setStyleClass(o.$ext, o.$baseCSSname + "Over");');d.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+');if(o.isOpen) return;o.$setStyleClass(o.$ext, "", [o.$baseCSSname + "Over"]);');var c=this.$getLayoutNode("main","button",d);if(c){c.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").slideToggle(event);");}var i=this.$getLayoutNode("main","label",d);if(this.clickOpen=="both"){i.parentNode.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").slideToggle(event);");}});this.oLabel=this.$getLayoutNode("main","label",this.$ext);if(this.oLabel.nodeType==3){this.oLabel=this.oLabel.parentNode;}this.oIcon=this.$getLayoutNode("main","icon",this.$ext);if(this.$button){this.$button=this.$getLayoutNode("main","button",this.$ext);}this.oSlider=apf.insertHtmlNode(this.$getLayoutNode("container"),document.body);this.$int=this.$getLayoutNode("container","contents",this.oSlider);this.$pHtmlDoc=apf.popup.setContent(this.$uniqueId,this.oSlider,apf.skins.getCssString(this.skinName));this.listtype=parseInt(this.$getLayoutNode("main","type"))||1;this.itemHeight=this.$getOption("main","item-height")||18.5;this.widthdiff=this.$getOption("main","width-diff")||0;this.ignoreOverflow=apf.isTrue(this.$getOption("main","ignore-overflow"))||false;};this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(typeof this["initial-message"]=="undefined"){this.$setInheritedAttribute("initial-message");}if(!this.selected&&this["initial-message"]){this.$setLabel();}});this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);apf.destroyHtmlNode(this.oSlider);this.oSlider=null;};}).call(apf.dropdown.prototype=new apf.BaseList());apf.config.$inheritProperties["initial-message"]=1;apf.aml.setElement("dropdown",apf.dropdown);apf.contextmenu=function(){this.$init("contextmenu",apf.NODE_HIDDEN);};(function(){this.$amlNodes=[];this.$attrExcludePropBind=apf.extend({match:1},this.$attrExcludePropBind);this.register=function(a){if(!a.contextmenus){a.contextmenus=[];}a.contextmenus.push(this);};this.unregister=function(a){a.contextmenus.remove(this);};this.addEventListener("DOMNodeInsertedIntoDocument",function(a){this.register(this.parentNode);});}).call(apf.contextmenu.prototype=new apf.AmlElement());apf.aml.setElement("contextmenu",apf.contextmenu);apf.menu=function(c,a){this.$init(a||"menu",apf.NODE_VISIBLE,c);};(function(){this.$focussable=apf.KEYBOARD;this.$positioning="basic";this.anim=true;this.zindex=10000000;this.$booleanProperties.anim=true;this.$propHandlers.visible=function(m,o,l,j,d){if(m){this.$ext.style.display="block";if(this.opener.localName.indexOf("item")>-1){this.opener.parentNode.$showingSubMenu=this;}}else{this.$ext.style.display="none";var n=apf.menu.lastFocus;if(n!=this.opener&&this.opener&&this.opener.$blur){this.opener.$blur();}if(this.opener&&this.opener.parentNode.localName=="menu"){if(!this.$hideTree){this.$hideTree=-1;}this.opener.parentNode.focus();}else{if(n){if(apf.window.$settingFocus){if(apf.window.$settingFocus!=n&&n.$blur){n.$blur();}this.$blur();if(apf.window.$settingFocus.localName!="menu"){apf.menu.lastFocus=null;}}else{if(!apf.window.hasFocus()){if(n.$blur){n.$blur();}this.$blur();apf.document.activeElement=n;if(n.$focusParent){n.$focusParent.$lastFocussed=n;}apf.menu.lastFocus=null;}else{if(this.$hideTree){if(!this.$hideTree){this.$hideTree=-1;}var i=(n.disabled||!n.visible)&&n!=apf.document.documentElement;if(j||i){if(n.$blur){n.$blur();}this.$blur();apf.document.activeElement=null;if(i&&apf.window.moveNext()===false){apf.window.$focusRoot();}}else{n.focus(null,null,true);}apf.menu.lastFocus=null;}}}}}if(this.$showingSubMenu){this.$showingSubMenu.hide();this.$showingSubMenu=null;}if(this.opener&&this.opener.$submenu){this.opener.$submenu(true,true);if(this.$hideTree===true&&this.opener.parentNode.localName=="menu"){this.opener.parentNode.$hideTree=true;this.opener.parentNode.hide();}this.opener=null;}this.$hideTree=null;if(this.$selected){apf.setStyleClass(this.$selected.$ext,"",["hover"]);this.$selected=null;}}};var c;this.display=function(w,t,o,u,C,q,A){this.opener=u;this.dispatchEvent("display");var B,n,j,d=this.childNodes,s=0,m=d.length,E;for(n=0;n<m;n++){j=d[n];if(j.nodeType!=1){continue;}E=!C||!j.match||(j.cmatch||(j.cmatch=apf.lm.compile(j.match,{xpathmode:3,injectself:true})))(C);if(E){j.show();if(j.localName=="divider"){B=j;if(s==0){j.hide();}s=0;}else{s++;}}else{j.hide();if(!j.nextSibling&&s==0){B.hide();}}}if(this.oOverlay){if(A){this.oOverlay.style.display="block";this.oOverlay.style.width=A+"px";}else{this.oOverlay.style.display="none";}}this.visible=false;this.show();var z=apf.getAbsolutePosition(document.body);apf.popup.show(this.$uniqueId,{x:w-z[0],y:t-z[1]-(apf.isIE&&apf.isIE<8?1:0),animate:o||!this.anim?false:"fade",ref:this.$ext.offsetParent,allowTogether:q,autoCorrect:false});var D=apf.menu.lastFocus=u&&u.$focussable===true?u:apf.menu.lastFocus||apf.document.activeElement;apf.popup.last=null;this.focus();if(D&&D!=this&&D.$focus){D.$focus();}this.xmlReference=C;};this.getValue=function(d){return this.getSelected(d).value||"";};this.getSelected=function(n){var j=this.childNodes;var m,d=j.length;for(m=0;m<d;m++){if(j[m].group!=n){continue;}if(j[m].selected){return j[m];}}return false;};this.select=function(o,n){var j=this.childNodes;var m,d=j.length;for(m=0;m<d;m++){if(j[m].group!=o){continue;}if(j[m].value==n||!j[m].value&&j[m].caption==n){j[m].$handlePropSet("selected",true);}else{if(j[m].selected){j[m].$handlePropSet("selected",false);}}}};this.addEventListener("keydown",function(l){var j,d=l.keyCode;switch(d){case 13:if(!this.$selected){return;}j=this.$selected;j.$down();j.$up();j.$click();break;case 38:j=this.$selected&&this.$selected.previousSibling||this.lastChild;if(j&&j.localName=="divider"){j=j.previousSibling;}if(!j){return;}if(this.$selected){apf.setStyleClass(this.$selected.$ext,"",["hover"]);}apf.setStyleClass(j.$ext,"hover");this.$selected=j;break;case 40:j=this.$selected&&this.$selected.nextSibling||this.firstChild;if(j&&j.localName=="divider"){j=j.nextSibling;}if(!j){return;}if(this.$selected){apf.setStyleClass(this.$selected.$ext,"",["hover"]);}apf.setStyleClass(j.$ext,"hover");this.$selected=j;break;case 37:if(!this.opener){return;}if(this.opener.localName=="button"){j=this.opener.previousSibling;while(j&&!j.submenu){j=j.previousSibling;}if(j){j.dispatchEvent("mouseover");var i=j.parentNode.menuIsPressed;if(i){self[i.submenu].dispatchEvent("keydown",{keyCode:40});}}}else{if(this.opener.parentNode.localName=="menu"){var m=this.opener;this.hide();apf.setStyleClass(m.$ext,"hover");m.parentNode.$showingSubMenu=null;}}break;case 39:if(this.$selected&&this.$selected.submenu){this.$selected.$submenu(null,true);this.$showingSubMenu.dispatchEvent("keydown",{keyCode:40});return;}if(this.opener){var m=this.opener;while(m&&m.parentNode&&m.parentNode.localName=="menu"){m=m.parentNode.opener;}if(m&&m.localName=="button"){j=m.nextSibling;while(j&&!j.submenu){j=j.nextSibling;}if(j){j.dispatchEvent("mouseover");var i=j.parentNode.menuIsPressed;if(i){self[i.submenu].dispatchEvent("keydown",{keyCode:40});}return;}}}if(!this.$selected){arguments.callee.call(this,{keyCode:40});}break;default:return;}return false;},true);function a(){if(this.$showingSubMenu){return;}if(this.$hideTree!=-1){this.$hideTree=true;this.hide();}return false;}this.addEventListener("focus",function(){apf.popup.last=this.$uniqueId;});this.addEventListener("blur",a);this.addEventListener("popuphide",a);this.$draw=function(){this.$pHtmlNode=document.body;this.$ext=this.$getExternal();this.oOverlay=this.$getLayoutNode("main","overlay",this.$ext);apf.popup.setContent(this.$uniqueId,this.$ext,"",null,null);};this.$loadAml=function(d){this.$int=this.$getLayoutNode("main","container",this.$ext);};this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);};}).call(apf.menu.prototype=new apf.Presentation());apf.aml.setElement("menu",apf.menu);apf.palette=function(c,a){this.$init(a||"palette",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction);this.$focussable=true;this.value="ff0000";this.direction="down";this.$supportedProperties.push("value");this.$propHandlers.value=function(a){this.oViewer.style.backgroundColor=a;};this.setValue=function(a){this.setProperty("value",a,false,true);};this.getValue=function(){return this.value?this.value:"";};this.$addColor=function(a,c){if(!c){c=this.oCustom;}var d=this.$getLayoutNode("item");if(c==this.oCustom){d.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").$doCustom(this)");d.setAttribute("ondblclick","apf.lookup("+this.$uniqueId+").$doCustom(this, true)");}else{d.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").change(this.style.backgroundColor.replace(/^#/, ''))");}d=apf.insertHtmlNode(d,c);this.$getLayoutNode("item","background",d).style.backgroundColor="#"+a;};this.$setCustom=function(c,a){c.style.backgroundColor=a;this.change(a);};this.$doCustom=function(c,a){if(a||c.style.backgroundColor=="#ffffff"){this.dispatchEvent("createcustom",{htmlNode:c});}else{this.change(c.style.backgroundColor.replace(/^#/,""));}};this.defaultValue="ff0000";this.colors=["fc0025","ffd800","7dff00","32ffe0","0026ff","cd00ff","ffffff","e5e5e5","d9d9d9","de003a","ffc600","009022","00bee1","003e83","dc0098","737373","666666","000000"];this.$draw=function(){this.$ext=this.$getExternal();this.oViewer=this.$getLayoutNode("main","viewer",this.$ext);this.oStandard=this.$getLayoutNode("main","standard",this.$ext);this.oCustom=this.$getLayoutNode("main","custom",this.$ext);var a;for(a=0;a<this.colors.length;a++){this.$addColor(this.colors[a],this.oStandard);}for(a=0;a<9;a++){this.$addColor("ffffff");}};}).call(apf.palette.prototype=new apf.StandardBinding());apf.aml.setElement("palette",apf.palette);apf.input=function(c,a){this.$init(a||"input",apf.NODE_VISIBLE,c);};apf.secret=function(c,a){this.$init(a||"secret",apf.NODE_VISIBLE,c);};apf.password=function(c,a){this.$init(a||"password",apf.NODE_VISIBLE,c);};apf.textarea=function(c,a){this.$init(a||"textarea",apf.NODE_VISIBLE,c);this.multiline=true;};apf.email=function(c,a){this.$init(a||"email",apf.NODE_VISIBLE,c);};apf.textbox=function(c,a){this.$init(a||"textbox",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction);this.$focussable=true;this.$masking=false;this.$childProperty="value";this.value="";this.isContentEditable=true;this.multiline=false;this.$booleanProperties.focusselect=true;this.$booleanProperties.realtime=true;this.$supportedProperties.push("value","mask","initial-message","focusselect","realtime","type");this.$propHandlers.value=function(d,i,c){if(!this.$int||!c&&this.getValue()==d){return;}if(!c&&!d){this.clear();}else{if(this.isHTMLBox){if(this.$int.innerHTML!=d){this.$int.innerHTML=d;}}else{if(this.$int.value!=d){this.$int.value=d;}}}if(this.$button){this.$button.style.display=d&&!c?"block":"none";}};this.addEventListener("prop.maxlength",function(c){if(this.$int.tagName.toLowerCase().match(/input|textarea/)){this.$int.maxLength=parseInt(c.value)||null;}});this.$propHandlers.mask=function(c){if(this.mask.toLowerCase()=="password"){return;}if(!c){throw new Error("Not Implemented");}if(!this.$masking){this.$masking=true;this.implement(apf.textbox.masking);this.focusselect=false;}this.setMask(this.mask);};this.$propHandlers["initial-message"]=function(c){if(c){if(apf.hasFocusBug){this.$int.onblur();}}if(!this.value){this.clear();}};this.$propHandlers.focusselect=function(d){var c=this;this.$int.onmousedown=function(){c.focusselect=false;};this.$int.onmouseup=this.$int.onmouseout=function(){c.focusselect=d;};};this.$propHandlers.type=function(c){if(c&&"password|username".indexOf(c)>-1&&typeof this.focusselect=="undefined"){this.focusselect=true;this.$propHandlers.focusselect.call(this,true);}};this.setValue=function(c){return this.setProperty("value",c,false,true);};this.clear=function(){if(this["initial-message"]){this.$propHandlers.value.call(this,this["initial-message"],null,true);apf.setStyleClass(this.$ext,this.$baseCSSname+"Initial");}else{this.$propHandlers.value.call(this,"",null,true);}this.dispatchEvent("clear");};this.getValue=function(){var c=this.isHTMLBox?this.$int.innerHTML:this.$int.value;return c==this["initial-message"]?"":c.replace(/\r/g,"");};this.select=function(){try{this.$int.select();}catch(c){}};this.deselect=function(){this.$int.deselect();};this.$enable=function(){this.$int.disabled=false;};this.$disable=function(){this.$int.disabled=true;};this.$insertData=function(c){return this.setValue(c);};this.insert=function(i){if(apf.hasMsRangeObject){try{this.$int.focus();}catch(d){}var c=document.selection.createRange();if(this.oninsert){i=this.oninsert(i);}c.pasteHTML(i);c.collapse(true);c.select();}else{this.$int.value+=i;}};this.addEventListener("$clear",function(){this.value="";if(this["initial-message"]&&apf.document.activeElement!=this){this.$propHandlers.value.call(this,this["initial-message"],null,true);apf.setStyleClass(this.$ext,this.$baseCSSname+"Initial");}else{this.$propHandlers.value.call(this,"");}if(!this.$int.tagName.toLowerCase().match(/input|textarea/i)){if(apf.hasMsRangeObject){try{var c=document.selection.createRange();c.moveStart("sentence",-1);c.select();}catch(d){}}}this.dispatchEvent("clear");});this.$keyHandler=function(i,n,d,j,l){if(this.$button&&i==27){this.clear();this.blur();}if(this.dispatchEvent("keydown",{keyCode:i,ctrlKey:n,shiftKey:d,altKey:j,htmlEvent:l})===false){return false;}if(false&&apf.isIE&&(i==86&&n||i==45&&d)){var m=window.clipboardData.getData("Text");if((m=this.dispatchEvent("keydown",{text:this.onpaste(m)})===false)){return false;}if(!m){m=window.clipboardData.getData("Text");}this.$int.focus();var c=document.selection.createRange();c.text="";c.collapse();c.pasteHTML(m.replace(/\n/g,"<br />").replace(/\t/g,"&nbsp;&nbsp;&nbsp;"));return false;}};var a;this.$focus=function(i){if(!this.$ext||this.$ext.disabled){return;}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");if(this["initial-message"]&&this.$int.value==this["initial-message"]){this.$propHandlers.value.call(this,"",null,true);apf.setStyleClass(this.$ext,"",[this.$baseCSSname+"Initial"]);}var c=this;function d(){try{if(!a||document.activeElement!=c.$int){c.$int.focus();}else{clearInterval(a);return;}}catch(j){}if(c.$masking){c.setPosition();}if(c.focusselect){c.select();}}if((!i||i.mouse)&&apf.isIE){clearInterval(a);a=setInterval(d,1);}else{d();}};this.$blur=function(c){if(!this.$ext){return;}if(!this.realtime){this.change(this.getValue());}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);if(this["initial-message"]&&this.$int.value==""){this.$propHandlers.value.call(this,this["initial-message"],null,true);apf.setStyleClass(this.$ext,this.$baseCSSname+"Initial");}try{if(apf.isIE||!c||c.srcElement!=apf.window){this.$int.blur();}}catch(c){}if(this.oContainer){$setTimeout("var o = apf.lookup("+this.$uniqueId+");                o.oContainer.style.display = 'none'",100);}clearInterval(a);};this.$draw=function(){var c=this;this.$ext=this.$getExternal(null,null,function(j){var i=this.getAttribute("mask");if((typeof i=="string"&&i.toLowerCase()=="password")||"secret|password".indexOf(this.localName)>-1){this.type=="password";this.$getLayoutNode("main","input").setAttribute("type","password");}else{if(this.localName=="email"){this.datatype=(this.prefix?this.prefix+":":"")+"email";this.$propHandlers.datatype.call(this,this.datatype,"datatype");}else{if(this.localName=="url"){this.datatype=(this.prefix?this.prefix+":":"")+"url";this.$propHandlers.datatype.call(this,this.datatype,"datatype");}}}j.setAttribute("onmousedown","this.host.dispatchEvent('mousedown', {htmlEvent : event});");j.setAttribute("onmouseup","this.host.dispatchEvent('mouseup', {htmlEvent : event});");j.setAttribute("onclick","this.host.dispatchEvent('click', {htmlEvent : event});");});this.$int=this.$getLayoutNode("main","input",this.$ext);this.$button=this.$getLayoutNode("main","button",this.$ext);if(this.type=="password"){this.$propHandlers.type.call(this,"password");}if(!apf.hasContentEditable&&"input|textarea".indexOf(this.$int.tagName.toLowerCase())==-1){var d=this.$int;this.$int=d.parentNode.insertBefore(document.createElement("textarea"),d);d.parentNode.removeChild(d);this.$int.className=d.className;if(this.$ext==d){this.$ext=this.$int;}}if(this.$button){this.$button.onmousedown=function(){c.clear();c.focus({mouse:true});};}if(this.$int.tagName.toLowerCase()=="textarea"){this.addEventListener("focus",function(i){});}this.$int.onselectstart=function(i){if(!i){i=event;}i.cancelBubble=true;};this.$int.host=this;this.$int.onkeydown=function(m){m=m||window.event;if(this.disabled){m.returnValue=false;return false;}if(!c.realtime){var j=c.getValue();if(m.keyCode==13&&j!=this.value){c.change(j);}}else{if(apf.isWebkit&&c.xmlRoot&&c.getValue()!=this.value){$setTimeout("var o = apf.lookup("+c.$uniqueId+");                    o.change(o.getValue())");}}if(c.multiline=="optional"&&m.keyCode==13&&!m.shiftKey||m.ctrlKey&&(m.keyCode==66||m.keyCode==73||m.keyCode==85)){m.returnValue=false;return false;}if(c.oContainer){var i=c;var l=m.keyCode;$setTimeout(function(){i.fillAutocomplete(l);});}if(!c.mask){return c.$keyHandler(m.keyCode,m.ctrlKey,m.shiftKey,m.altKey,m);}};this.$int.onkeyup=function(j){if(!j){j=event;}var i=j.keyCode;if(c.$button){c.$button.style.display=this.value?"block":"none";}if(c.realtime){$setTimeout(function(){var l;if(!c.mask&&(l=c.getValue())!=c.value){c.change(l);}c.dispatchEvent("keyup",{keyCode:i});});}else{c.dispatchEvent("keyup",{keyCode:i});}if(c.isValid&&c.isValid()&&j.keyCode!=13&&j.keyCode!=17){c.clearError();}};if(apf.hasFocusBug){apf.sanitizeTextbox(this.$int);}if(apf.hasAutocompleteXulBug){this.$int.setAttribute("autocomplete","off");}if(!this.$int.tagName.toLowerCase().match(/input|textarea/)){this.isHTMLBox=true;this.$int.unselectable="Off";this.$int.contentEditable=true;this.$int.style.width="1px";this.$int.select=function(){var i=document.selection.createRange();i.moveToElementText(this);i.select();};}this.$int.deselect=function(){if(!document.selection){return;}var i=document.selection.createRange();i.collapse();i.select();};};this.$loadAml=function(){if(typeof this["initial-message"]=="undefined"){this.$setInheritedAttribute("initial-message");}if(typeof this.realtime=="undefined"){this.$setInheritedAttribute("realtime");}};this.addEventListener("DOMNodeRemovedFromDocument",function(){if(this.$button){this.$button.onmousedown=null;}if(this.$int){this.$int.onkeypress=this.$int.onmouseup=this.$int.onmouseout=this.$int.onmousedown=this.$int.onkeydown=this.$int.onkeyup=this.$int.onselectstart=null;}});}).call(apf.textbox.prototype=new apf.StandardBinding());apf.config.$inheritProperties["initial-message"]=1;apf.config.$inheritProperties.realtime=1;apf.input.prototype=apf.secret.prototype=apf.password.prototype=apf.textarea.prototype=apf.email.prototype=apf.textbox.prototype;apf.aml.setElement("input",apf.input);apf.aml.setElement("secret",apf.secret);apf.aml.setElement("password",apf.password);apf.aml.setElement("textarea",apf.textarea);apf.aml.setElement("textbox",apf.textbox);apf.script=function(){this.$init("script",apf.NODE_HIDDEN);};(function(){this.$propHandlers.src=function(a){if(apf.isOpera){$setTimeout(function(){apf.window.loadCodeFile(apf.hostPath+a);},1000);}else{apf.window.loadCodeFile(apf.getAbsolutePath(apf.hostPath,a));}};this.addEventListener("DOMNodeInserted",function(c){if(c.currentTarget.nodeType!=1){var a=c.currentTarget.nodeValue;if(!this.type||this.type=="text/javascript"){apf.exec(a);}else{if(this.type=="application/livemarkup"||this.type=="application/lm"){this.$setDynamicProperty("$data",a);}}}});this.addEventListener("DOMNodeInsertedIntoDocument",function(n){var c=this.childNodes,j=[];for(var d=0,a=c.length;d<a;d++){j[j.length]=c[d].nodeValue;}var m=j.join("\n");if(!this.type||this.type=="text/javascript"){apf.exec(m);}else{if(this.type=="application/livemarkup"||this.type=="application/lm"){this.$setDynamicProperty("$data",m);}}});}).call(apf.script.prototype=new apf.AmlElement());apf.aml.setElement("script",apf.script);apf.tree=function(c,a){this.$init(a||"tree",apf.NODE_VISIBLE,c);this.nodes=[];this.dynCssClasses=[];};(function(){this.implement(apf.Rename,apf.DataAction,apf.Cache);this.$isTreeArch=true;this.$focussable=true;this.multiselect=false;this.bufferselect=true;this.startcollapsed=true;this.animType=apf.tween.NORMAL;this.animOpenStep=3;this.animCloseStep=1;this.animSpeed=10;var a=1<<1,d=1<<2,j=1<<3,n=1<<4,c={};c[0]="";c[a]="min";c[a|d]="plus";c[j]="last";c[j|a]="minlast";c[j|a|d]="pluslast";c[n]="root";this.$booleanProperties.openadd=true;this.$booleanProperties.startcollapsed=true;this.$booleanProperties.nocollapse=true;this.$booleanProperties.singleopen=true;this.$booleanProperties.prerender=true;this.$booleanProperties.removecontainer=true;this.openadd=true;this.startcollapsed=1;this.prerender=true;this.$mode=0;this.$propHandlers.mode=function(o){if("check|radio".indexOf(o)>-1){this.implement(apf.MultiCheck);this.addEventListener("afterrename",i);this.multicheck=o=="check";this.$mode=this.multicheck?1:2;}else{this.removeEventListener("afterrename",i);this.$mode=0;}};function i(){}this.expandAll=function(){var q=this.each.split("|").join("["+this.each.replace(/\|/g," or ")+"]|.//"),o=this;(function(u){var s=u.selectNodes(q);for(var t=0;t<s.length;t++){o.slideToggle(apf.xmldb.getHtmlNode(s[t],o),1,true);arguments.callee(s[t]);}})(this.xmlRoot);};this.collapseAll=function(){var q=this.xmlRoot.selectNodes(".//"+this.each.split("|").join("["+this.each.replace(/\|/g," or ")+"]|.//"));for(var o=q.length-1;o>=0;o--){this.slideToggle(apf.xmldb.getHtmlNode(q[o],this),2,true);}};this.selectPath=function(o){};this.slideToggle=function(t,s,q){if(this.nocollapse){return;}if(!t){t=this.$selected;}var u=t.getAttribute(apf.xmldb.htmlIdTag);while(!u&&t.parentNode){u=(t=t.parentNode).getAttribute(apf.xmldb.htmlIdTag);}var o=this.$getLayoutNode("item","container",t);if(!o){return;}if(apf.getStyle(o,"display")=="block"){if(s==1){return;}t.className=t.className.replace(/min/,"plus");this.slideClose(o,apf.xmldb.getNode(t),q);}else{if(s==2){return;}t.className=t.className.replace(/plus/,"min");this.slideOpen(o,apf.xmldb.getNode(t),q);}};this.isCollapsed=function(o){return(apf.getStyle(this.$getLayoutNode("item","container",apf.xmldb.getHtmlNode(o,this)),"display")=="none");};var l={};this.slideOpen=function(q,u,s){if(!u){u=this.selected;}var w=apf.xmldb.findHtmlNode(u,this);if(!q){q=this.$findContainer(w);}if(!q.innerHTML&&!this.getTraverseNodes(u).length){return;}if(this.singleopen){var t=this.getTraverseParent(u),z=(t||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);if(l[z]&&l[z][1]!=u&&this.getTraverseParent(l[z][1])==t){this.slideToggle(l[z][0],2);}l[z]=[w,u];}q.style.display="block";if(!this.prerender&&this.$hasLoadStatus(u,"potential")&&!q.innerHTML){this.$extend(u,q,s);return;}if(s){q.style.height="auto";return;}var o=this;apf.tween.single(q,{type:"scrollheight",from:0,to:q.scrollHeight,anim:this.animType,steps:this.animOpenStep,interval:this.animSpeed,onfinish:function(A){if(u&&o.$hasLoadStatus(u,"potential")){$setTimeout(function(){o.$extend(u,A);});A.style.height="auto";}else{A.style.height="auto";}}});};this.slideClose=function(o,s,q){if(this.nocollapse){return;}if(!s){s=this.selected;}if(this.singleopen){var u=(this.getTraverseParent(s)||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);l[u]=null;}if(!o){var t=apf.xmldb.findHtmlNode(s,this);o=this.$findContainer(t);}o.style.height=o.offsetHeight;o.style.overflow="hidden";if(q){o.style.height=0;o.style.display="none";return;}apf.tween.single(o,{type:"scrollheight",from:o.scrollHeight,to:0,anim:this.animType,steps:this.animCloseStep,interval:this.animSpeed,onfinish:function(w,z){w.style.display="none";}});};this.$add=function(I,B,D,K,E,z){var C=this.$getBindRule("insert",I)?true:false,G=this.getTraverseNodes(I),w=G.length?true:false,A=C||w,t=this.$hasBindRule("collapsed")?(this.$getDataNode("collapsed",I)?true:false):this.startcollapsed,q=(A?a:0)|(t&&A||C?d:0)|(z?j:0),F=this.$initNode(I,q,B),o=this.$getLayoutNode("item","container"),u;if(!t&&!this.nocollapse){o.setAttribute("style","overflow:visible;height:auto;display:block;");}var s,J=(!this.removecontainer||A);if(!A||C){o.setAttribute("style","display:none;");}if(!this.prerender){u=G.length;}if(A&&!this.prerender&&u>2&&t||C&&(!this.$hasLoadStatus(I)||this.$hasLoadStatus(I,"potential"))){this.$setLoading(I,o);}else{if(!w&&(s=this.$applyBindRule("empty",I))){this.$setEmptyMessage(o,s);}}if((!K||K==this.$int)&&D==this.xmlRoot&&!E){this.nodes.push(F);if(!apf.isChildOf(F,o,true)&&J){this.nodes.push(o);}this.$setStyleClass(F,"root");this.$setStyleClass(o,"root");}else{if(!K){K=apf.xmldb.findHtmlNode(I.parentNode,this);K=K?this.$getLayoutNode("item","container",K):this.$int;}if(K==this.$int){this.$setStyleClass(F,"root");this.$setStyleClass(o,"root");}if(!E&&this.getNextTraverse(I)){E=apf.xmldb.findHtmlNode(this.getNextTraverse(I),this);}if(E&&E.parentNode!=K){E=null;}if(K.style&&this.getTraverseNodes(I.parentNode).length==1){this.$removeEmptyMessage(K);}if(K.style){apf.insertHtmlNode(F,K,E);if(!apf.isChildOf(F,o,true)&&J){var o=apf.insertHtmlNode(o,K,E);}}else{K.insertBefore(F,E);if(!apf.isChildOf(K,o,true)&&J){K.insertBefore(o,E);}}if(K.style){if(!t&&this.openadd&&K!=this.$int&&K.style.display!="block"){this.slideOpen(K,D,true);}this.$fixItem(D,apf.xmldb.findHtmlNode(D,this));if(this.getNextTraverse(I,true)){this.$fixItem(this.getNextTraverse(I,true),apf.xmldb.findHtmlNode(this.getNextTraverse(I,true),this));}}}if((this.prerender||u<3||!t)&&(I.namespaceURI!=apf.ns.apf||I.localName!="item")){this.$addNodes(I,o,false);}return o;};this.$fill=function(){apf.insertHtmlNodes(this.nodes,this.$int);this.nodes.length=0;};this.$getParentNode=function(o){return o?this.$getLayoutNode("item","container",o):this.$int;};this.$fixItem=function(D,B,A,C,t){if(!B){return;}if(A){var u;if(u=this.getNextTraverse(D,true)){this.$fixItem(u,this.$findHtmlNode(u.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,true);}if(!this.emptyMessage&&D.parentNode.selectNodes(this.each).length==1){this.$fixItem(D.parentNode,this.$findHtmlNode(D.parentNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,false,true);}}else{var q=this.$getLayoutNode("item","container",B),z=false;if(t){z=false;}else{if(this.getTraverseNodes(D).length>0){z=true;}else{if(this.$hasLoadStatus(D,"potential")){z=true;}else{z=false;}}}var s=z&&q.style.display!="block",w=this.getNextTraverse(D,null,C?2:1)?false:true,o=(z?a:0)|(s?d:0)|(w?j:0);this.$setStyleClass(this.$getLayoutNode("item","class",B),c[o],["min","plus","last","minlast","pluslast"]);this.$setStyleClass(this.$getLayoutNode("item","container",B),c[o],["min","plus","last","minlast","pluslast"]);if(this.$getLayoutNode("item","openclose",B)){this.$getLayoutNode("item","openclose",B).setAttribute("children",z);}if(!z&&q){q.style.display="none";}}};this.$initNode=function(F,o,B){this.$getNewContext("item");var u=o&a||this.emptyMessage&&this.$applyBindRule("empty",F),A=this.$getLayoutNode("item");A.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+");            if (o.onmouseover) o.onmouseover(event, this);            apf.setStyleClass(this, 'hover');");A.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+");            if (o.onmouseout) o.onmouseout(event, this);            apf.setStyleClass(this, '', ['hover']);");A.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");            if (o.onmousedown) o.onmousedown(event, this);");this.$setStyleClass(this.$getLayoutNode("item","class"),c[o]).setAttribute(apf.xmldb.htmlIdTag,B);this.$setStyleClass(this.$getLayoutNode("item","container"),c[o]);var t=this.$getLayoutNode("item","openclose");if(t){t.setAttribute("children",u);t.setAttribute("onmousedown","if (this.getAttribute('children') == false) return;                var o = apf.lookup("+this.$uniqueId+");                o.slideToggle(this);                if (o.onmousedown) o.onmousedown(event, this);                apf.cancelBubble(event, o);");t.setAttribute("ondblclick","event.cancelBubble = true");}if(this.$mode){var G=this.$getLayoutNode("item","check");if(G){G.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                    o.checkToggle(this);o.$skipSelect = true;");if(this.isChecked(F)){this.$setStyleClass(A,"checked");}}else{return false;}}var q=this.opencloseaction||"ondblclick";var C=this.$getLayoutNode("item","icon");if(C&&C!=t){if(q!="ondblclick"){C.setAttribute(q,"var o = apf.lookup("+this.$uniqueId+");"+(q=="onmousedown"?"o.select(this, event.ctrlKey, event.shiftKey);":"")+(true?"o.slideToggle(this);":""));}if(q!="onmousedown"){C.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").select(this, event.ctrlKey, event.shiftKey);");}C.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+");              o.choose();o.stopRename();"+(true&&!q=="ondblclick"?"o.slideToggle(this);":"")+"apf.cancelBubble(event,o);");}var s=this.$getLayoutNode("item","select"),E;if(this.hasFeature(apf.__RENAME__)||this.hasFeature(apf.__DRAGDROP__)){E="var o = apf.lookup("+this.$uniqueId+");                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 this.hasPassedDown = true;                 if (!o.renaming && o.hasFocus() && isSelected == 1)                     this.dorename = true;                 if (!o.hasFeature(apf.__DRAGDROP__) || !isSelected && !event.ctrlKey)                     o.select(this, event.ctrlKey, event.shiftKey);";s.setAttribute("onmouseout","this.hasPassedDown = false;"+(s.getAttribute("onmouseout")||""));s.setAttribute("onmouseup","if (!this.hasPassedDown) return;                var o = apf.lookup("+this.$uniqueId+");if (this.dorename && !o.mode)                    o.startDelayedRename(event);this.dorename = false;                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 if (o.hasFeature(apf.__DRAGDROP__))                     o.select(this, event.ctrlKey, event.shiftKey);");}else{E="o.select(this, event.ctrlKey, event.shiftKey);";}if(q!="ondblclick"){s.setAttribute(q,"var o = apf.lookup("+this.$uniqueId+");"+(q=="onmousedown"?E:"")+(true?"o.slideToggle(this);":""));}if(q!="onmousedown"){s.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");"+E);}s.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+");          o.choose();o.stopRename();this.dorename=false;"+(q=="ondblclick"?"o.slideToggle(this);":"")+"apf.cancelBubble(event,o);");if(C){var z=this.$applyBindRule("icon",F);if(z){if(C.tagName.match(/^img$/i)){C.setAttribute("src",this.iconPath+z);}else{C.setAttribute("style","background-image:url("+this.iconPath+z+")");}}}var D=this.$getLayoutNode("item","caption");if(D){apf.setNodeValue(D,this.$applyBindRule("caption",F));}var w=this.$applyBindRule("tooltip",F);if(w){A.setAttribute("title",w);}var I=this.$applyBindRule("css",F);if(I){this.$setStyleClass(this.$getLayoutNode("item",null,A),I);this.$setStyleClass(this.$getLayoutNode("item","container",A),I);this.dynCssClasses.push(I);}return A;};this.$deInitNode=function(q,t){var o=this.$getLayoutNode("item","container",t),s=t.parentNode;o.parentNode.removeChild(o);s.removeChild(t);if(q.parentNode!=this.xmlRoot){this.$fixItem(q,t,true);}var u;if(!s.childNodes.length&&(u=this.$applyBindRule("empty",q))){this.$setEmptyMessage(s,u);}this.$fixItem(q,t,true);};this.$moveNode=function(A,z){if(!self.apf.debug&&!z){return;}var s;if(this.$hasLoadStatus(A.parentNode,"potential")){s=this.$getLayoutNode("item","container",z);z.parentNode.removeChild(z);s.parentNode.removeChild(s);this.$extend(A.parentNode);return;}var B=z.parentNode,q=apf.xmldb.findHtmlNode(A.parentNode,this),C=this.getNextTraverse(A),w=C?apf.xmldb.findHtmlNode(C,this):null,u=q?this.$getLayoutNode("item","container",q):this.$int;s=this.$getLayoutNode("item","container",z);if(u!=B&&this.getTraverseNodes(A.parentNode).length==1){this.$removeEmptyMessage(u);}u.insertBefore(z,w);if(s){u.insertBefore(s,w);}var t;if(!B.childNodes.length&&(t=this.$applyBindRule("empty",A))){this.$setEmptyMessage(B,t);}if(this.openadd&&q!=this.$int&&u.style.display!="block"){this.slideOpen(u,q,true);}this.$fixItem(A,z);var o=this.getTraverseParent(A);this.$fixItem(o,apf.xmldb.findHtmlNode(o,this));if(this.getNextTraverse(A,true)){this.$fixItem(this.getNextTraverse(A,true),apf.xmldb.findHtmlNode(this.getNextTraverse(A,true),this));}};this.$updateNode=function(s,u){var q=this.$getLayoutNode("item","icon",u),t=this.$applyBindRule("icon",s);if(q&&t){if(q.tagName&&q.tagName.match(/^img$/i)){q.src=this.iconPath+t;}else{q.style.backgroundImage="url("+this.iconPath+t+")";}}var z=this.$getLayoutNode("item","caption",u);if(z){if(z.nodeType!=1){z=z.parentNode;}z.innerHTML=this.$applyBindRule("caption",s);}var w=this.$applyBindRule("tooltip",s);if(w){u.setAttribute("title",w);}var o=this.$applyBindRule("css",s);if(o||this.dynCssClasses.length){this.$setStyleClass(u,o,this.dynCssClasses);if(o&&!this.dynCssClasses.contains(o)){this.dynCssClasses.push(o);}}};this.$setLoading=function(q,o){this.$setLoadStatus(q,"potential");if(!this.getTraverseNodes(q).length){this.$getNewContext("loading");apf.insertHtmlNode(this.$getLayoutNode("loading"),o);}};this.$removeLoading=function(o){if(!o){return;}this.$getLayoutNode("item","container",o).innerHTML="";};this.$extend=function(s,o,q){var u=this.$getBindRule("insert",s),t=u&&u.match?(u.cmatch||u.compile("match"))(s):s;if(u&&t){this.$setLoadStatus(s,"loading");if(u.get){if(!apf.offline.onLine){apf.offline.transactions.actionNotAllowed();this.slideClose(o,s);return;}this.getModel().$insertFrom(u.getAttribute("get"),{xmlNode:t,insertPoint:t,amlNode:this});}else{if(this.$applyBindRule("insert",s)){this.insert(data,{insertPoint:t});}}}else{if(!this.prerender){this.$setLoadStatus(s,"loading");this.$removeLoading(apf.xmldb.findHtmlNode(s,this));m.call(this,{action:"insert",xmlNode:s,result:this.$addNodes(s,o,true),anim:!q});}}};function m(s){if(s.action=="move-away"){this.$fixItem(s.xmlNode,apf.xmldb.findHtmlNode(s.xmlNode,this),true);}if(s.action!="insert"){return;}var q=this.$findHtmlNode(s.xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);if(!q){return;}if(this.$hasLoadStatus(s.xmlNode,"loading")&&s.result.length>0){var o=this.$getLayoutNode("item","container",q);this.slideOpen(o,s.xmlNode,s.anim?false:true);}else{this.$fixItem(s.xmlNode,q);}if(this.$hasLoadStatus(s.xmlNode,"loading")){this.$setLoadStatus(s.xmlNode,"loaded");}}this.addEventListener("xmlupdate",m);this.addEventListener("beforerename",function(){if(this.$tempsel){clearTimeout(this.timer);this.select(this.$tempsel);this.$tempsel=null;this.timer=null;}});this.addEventListener("keydown",function(J){var M=J.keyCode,u=J.ctrlKey,C=J.shiftKey,I=this.$caret||this.$selected,z,B,t,E,D,K,o,A;if(!I||this.renaming){return;}var q=this.caret||this.selected,s=this.$ext;switch(M){case 13:if(this.$tempsel){this.$selectTemp();}if(this.ctrlselect=="enter"){this.select(this.caret,true);}this.choose(I);break;case 32:if(this.$tempsel){this.$selectTemp();}if(this.$mode&&!u){var F=this.getSelection();if(!F.length||!this.multiselect){this.checkToggle(this.caret);}else{this.checkList(F,this.isChecked(this.selected),true);}}else{if(u||!this.isSelected(this.caret)){this.select(this.caret,true);}}return false;case 46:if(this.$tempsel){this.$selectTemp();}this.remove(this.caret);break;case 36:this.$setTempSelected(this.getFirstTraverseNode(),false,C);s.scrollTop=0;return false;case 35:var w=this.getLastTraverseNode();while(!this.isCollapsed(w)){w=this.getLastTraverseNode(w);}this.$setTempSelected(w,false,C,true);s.scrollTop=s.scrollHeight;return false;case 37:if(this.$tempsel){this.$selectTemp();}if(this.caret.selectSingleNode(this.each)&&!this.isCollapsed(this.caret)){this.slideToggle(this.$caret||this.$selected,2);}else{if(o=this.getTraverseParent(this.caret)){this.select(o);}}return false;case 107:case 187:case 39:if(this.$tempsel){this.$selectTemp();}if(this.$hasLoadStatus(this.caret,"potential")||this.getFirstTraverseNode(this.caret)){this.slideToggle(this.$caret||this.$selected,1);}break;case 109:case 189:if(this.getFirstTraverseNode(this.caret)){this.slideToggle(this.$caret||this.$selected,2);}break;case 38:if(!q&&!this.$tempsel){return;}E=this.$tempsel?apf.xmldb.getNode(this.$tempsel):q;K=this.getNextTraverse(E,true);if(K){D=this.getTraverseNodes(K);do{A=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(K,this)));if(A&&apf.getStyle(A,"display")=="block"&&D.length){K=D[D.length-1];}else{break;}}while(K&&(D=this.getTraverseNodes(K)).length);}else{if(this.getTraverseParent(E)==this.xmlRoot){this.dispatchEvent("selecttop");return;}else{K=this.getTraverseParent(E);}}if(K&&K.nodeType==1){this.$setTempSelected(K,u,C,true);}else{return false;}I=apf.xmldb.findHtmlNode(K,this);B=apf.getAbsolutePosition(I,this.$int)[1]-(I.offsetHeight/2);if(B<=s.scrollTop){s.scrollTop=B;}return false;case 40:if(!q&&!this.$tempsel){return;}E=this.$tempsel?apf.xmldb.getNode(this.$tempsel):q;K=this.getFirstTraverseNode(E);if(K){A=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(E,this)));if(A&&apf.getStyle(A,"display")!="block"){K=null;}}while(!K){o=this.getTraverseParent(E);if(!o){break;}var G=0;D=this.getTraverseNodes(o);while(D[G]&&D[G]!=E){G++;}K=D[G+1];E=o;}if(K&&K.nodeType==1){this.$setTempSelected(K,u,C);}else{return false;}I=apf.xmldb.findHtmlNode(K,this);B=apf.getAbsolutePosition(I,this.$int)[1]+(I.offsetHeight/2);if(B>s.scrollTop+s.offsetHeight){s.scrollTop=B-s.offsetHeight;}return false;case 33:z=apf.getAbsolutePosition(this.$int);t=document.elementFromPoint(z[0]+this.$int.offsetWidth-2,z[1]+2);K=apf.xmldb.findXmlNode(t);if(K==this.selected){s.scrollTop-=s.offsetHeight-apf.getHeightDiff(s);t=document.elementFromPoint(z[0]+this.$int.offsetWidth-2,z[1]+2);K=apf.xmldb.findXmlNode(t);}this.select(K);I=apf.xmldb.findHtmlNode(K,this);B=apf.getAbsolutePosition(I,this.$int)[1]-(I.offsetHeight/2);if(B<=s.scrollTop){s.scrollTop=B;}break;case 34:z=apf.getAbsolutePosition(this.$int);t=document.elementFromPoint(z[0]+this.$int.offsetWidth-2,z[1]+this.$ext.offsetHeight-4);K=apf.xmldb.findXmlNode(t);if(K==this.selected){s.scrollTop+=s.offsetHeight-apf.getHeightDiff(s);t=document.elementFromPoint(z[0]+this.$int.offsetWidth-2,z[1]+this.$ext.offsetHeight-4);K=apf.xmldb.findXmlNode(t);}this.select(K);I=apf.xmldb.findHtmlNode(K,this);B=apf.getAbsolutePosition(I,this.$int)[1]+(I.offsetHeight/2);if(B>s.scrollTop+s.offsetHeight){s.scrollTop=B-s.offsetHeight;}break;default:if(M==65&&u){this.selectAll();}break;}},true);this.$getCaptionElement=function(){if(!this.$selected){return false;}var o=this.$getLayoutNode("item","caption",this.$selected);return o.nodeType==1?o:o.parentNode;};this.$calcSelectRange=function(s,o){var u=[],w=false,t=0,q=this.xmlRoot.selectNodes(".//"+this.each.split("|").join("|.//"));for(;t<q.length;t++){if(q[t]==s){w=true;}if(w){u.push(q[t]);}if(q[t]==o){w=false;}}if(!u.length||w){u=[];for(w=false,t=q.length-1;t>=0;t--){if(q[t]==s){w=true;}if(w){u.push(q[t]);}if(q[t]==o){w=false;}}}return u;};this.$findContainer=function(o){return this.$getLayoutNode("item","container",o);};this.$selectDefault=function(s){if(this.select(this.getFirstTraverseNode(s),null,null,null,true)){return true;}else{var o=this.getTraverseNodes(s);for(var q=0;q<o.length;q++){if(this.$selectDefault(o[q])){return true;}}}};this.$setEmptyMessage=function(t,u){this.$getNewContext("empty");var q=this.$getLayoutNode("empty");if(!q){return;}var s=apf.insertHtmlNode(q,t);var o=this.$getLayoutNode("empty","caption",s);if(o){apf.setNodeValue(o,u||"");}if(t.style){this.slideOpen(t,null,true);}else{t.setAttribute("style","overflow:visible;height:auto;display:block;");}};this.$removeEmptyMessage=function(q){var o=q.firstChild;if(!o){return;}do{if(o.className=="message"){q.removeChild(o);return;}o=o.nextSibling;}while(o);};this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);this.opencloseaction=this.$getOption("main","openclose");if(apf.hasCssUpdateScrollbarBug&&!this.mode){this.$fixScrollBug();}var o=this;this.$ext.onclick=function(q){o.dispatchEvent("click",{htmlEvent:q||event});};};this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(this.nocollapse){this.startcollapsed=false;}else{if(this.startcollapsed===1){this.startcollapsed=!apf.isFalse(this.$getOption("main","startcollapsed"));}}});this.$destroy=function(){this.$ext.onclick=null;apf.destroyHtmlNode(this.oDrag);this.oDrag=null;};}).call(apf.tree.prototype=new apf.MultiSelect());apf.aml.setElement("tree",apf.tree);apf.section=function(c,a){this.$init(a||"section",apf.NODE_VISIBLE,c);};apf.menubar=function(c,a){this.$init(a||"menubar",apf.NODE_VISIBLE,c);};apf.bar=function(c,a){this.$init(a||"bar",apf.NODE_VISIBLE,c);};(function(){this.$focussable=false;this.$canLeechSkin=true;this.$isLeechingSkin=false;this.$propHandlers.caption=function(a){this.$int.innerHTML=a;};this.addEventListener("AMLReparent",function(a,d,c){if(!this.$amlLoaded){return;}if(this.$isLeechingSkin&&!c&&this.skinName!=d.skinName||!this.$isLeechingSkin&&this.parentNode.$hasLayoutNode&&this.parentNode.$hasLayoutNode(this.localName)){this.$isLeechingSkin=true;this.$forceSkinChange(this.parentNode.skinName.split(":")[0]+":"+skinName);}});this.$draw=function(){this.$ext=this.$getExternal(this.$isLeechingSkin?this.localName:"main");if(this.oDrag){this.oDrag.parentNode.removeChild(this.oDrag);}this.oDrag=this.$getLayoutNode(this.$isLeechingSkin?this.localName:"main","dragger",this.$ext);this.$int=this.$getLayoutNode(this.$isLeechingSkin?this.localName:"main","container",this.$ext);};this.$loadAml=function(a){};this.$skinchange=function(){};}).call(apf.bar.prototype=new apf.Presentation());apf.menubar.prototype=apf.section.prototype=apf.bar.prototype;apf.aml.setElement("bar",apf.bar);apf.aml.setElement("menubar",apf.menubar);apf.aml.setElement("section",apf.section);apf.actions=function(c,a){this.$init(a||"actions",apf.NODE_HIDDEN,c);this.$actions=new apf.ruleList();this.$amlNodes={};};(function(){this.$smartbinding=null;this.register=function(a){if(a.localName=="smartbinding"){this.$smartbinding=a;this.$smartbinding.add(this);return;}this.$amlNodes[a.$uniqueId]=a;a.$actions=this.$actions;a.dispatchEvent("actionsload",{bindings:this});};this.unregister=function(a){this.$amlNodes[a.$uniqueId]=null;delete this.$amlNodes[a.$uniqueId];delete a.$actions;a.dispatchEvent("actionsunload",{bindings:this});};this.addEventListener("DOMNodeInsertedIntoDocument",function(m){var c=this.childNodes;for(var j,d=0,a=c.length;d<a;d++){if((j=c[d]).nodeType!=1){continue;}j.dispatchEvent("DOMNodeInsertedIntoDocument");}this.register(this.parentNode);});}).call(apf.actions.prototype=new apf.AmlElement());apf.aml.setElement("actions",apf.actions);apf.caldropdown=function(c,a){this.$animType=1;this.$animSteps=5;this.$animSpeed=20;this.$itemSelectEvent="onmouseup";this.dragdrop=false;this.reselectable=true;this.$focussable=true;this.autoselect=false;this.multiselect=false;this.outputFormat="yyyy-mm-dd";this.captionFormat="yyyy-mm-dd";this.$sliderHeight=0;this.$calVars={day:null,month:null,year:null,hours:1,minutes:0,seconds:0,currentMonth:null,currentYear:null,numberOfDays:null,dayNumber:null,days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:[{name:"January",number:31},{name:"February",number:28},{name:"March",number:31},{name:"April",number:30},{name:"May",number:31},{name:"June",number:30},{name:"July",number:31},{name:"August",number:31},{name:"September",number:30},{name:"October",number:31},{name:"November",number:30},{name:"December",number:31}]};this.$init(a||"caldropdown",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction);this.$supportedProperties.push("initial-message","output-format","default","caption-format","value");this.$propHandlers["output-format"]=function(d){this.outputFormat=d;};this.$propHandlers["caption-format"]=function(d){if(this.value){var i=this.$calVars;this.$setLabel(new Date(i.year,i.month,i.day,i.hours,i.minutes,i.seconds).format(this.captionFormat=d));}else{this.captionFormat=d;}};this.$propHandlers.value=function(i){var l=this.$calVars;var j=this.getAttribute("output-format");if(j!==null&&j!=this.outputFormat){this.outputFormat=j;}if(!i){this.$setLabel();return;}var d=Date.parse(i,this.outputFormat);l.day=d.getDate();l.month=d.getMonth();l.year=d.getFullYear();l.hours=d.getHours();l.minutes=d.getMinutes();l.seconds=d.getSeconds();this.value=i;this.$setLabel(new Date(l.year,l.month,l.day,l.hours,l.minutes,l.seconds).format(this.captionFormat));this.redraw(l.month,l.year);};this.getValue=function(){return this.value;};this.setValue=function(d){this.setProperty("value",d,false,true);};this.addEventListener("keydown",function(j){j=j||event;var i=j.keyCode,l=j.ctrlKey,d=j.shiftKey,m=this.$calVars;switch(i){case 13:this.selectDay(m.day);this.slideUp();break;case 33:this.nextMonth();break;case 34:this.prevMonth();break;case 37:if(l){this.prevMonth();}else{if(d){this.prevYear();}else{if(m.day-1<1){this.prevMonth();this.selectDay(m.months[m.currentMonth].number);}else{this.selectDay(m.day-1);}}}break;case 38:if(l){this.slideUp();}else{if(m.day-7<1){this.prevMonth();this.selectDay(m.months[m.currentMonth].number+m.day-7);}else{this.selectDay(m.day-7);}}break;case 39:if(l){this.nextMonth();}else{if(d){this.nextYear();}else{this.selectDay(m.day+1);}}break;case 40:if(l){this.slideDown(j);}else{this.selectDay(m.day+7);}break;case 84:if(l){this.today();}return false;break;}},true);this.slideToggle=function(d){if(!d){d=event;}if(this.isOpen){this.slideUp();}else{this.slideDown(d);}};this.slideDown=function(d){if(this.dispatchEvent("slidedown")===false){return false;}this.isOpen=true;this.oSlider.style.display="block";this.oSlider.style[apf.supportOverflowComponent?"overflowY":"overflow"]="hidden";this.oSlider.style.display="";this.$setStyleClass(this.$ext,this.$baseCSSname+"Down");this.oSlider.style.height=(this.$sliderHeight>0?this.$sliderHeight-1:0)+"px";this.oSlider.style.width=(this.$ext.offsetWidth>0?this.$ext.offsetWidth-1:0)+"px";apf.caldropdown.cache.oSlider.host=this;this.redraw(this.$calVars.month,this.$calVars.year);apf.popup.show(this.$uniqueId,{x:0,y:this.$ext.offsetHeight,animate:true,ref:this.$ext,width:this.$ext.offsetWidth+1,height:this.$sliderHeight,callback:function(i){i.style[apf.supportOverflowComponent?"overflowY":"overflow"]="hidden";}});};this.$getPageScroll=function(){return[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop];};this.slideUp=function(){if(this.isOpen==2){return false;}if(this.dispatchEvent("slideup")===false){return false;}this.isOpen=false;if(this.selected){var d=apf.xmldb.findHtmlNode(this.selected,this);if(d){this.$setStyleClass(d,"",["hover"]);}}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Down"]);apf.popup.hide();return false;};this.$setLabel=function(d){this.oLabel.innerHTML=d||this["initial-message"]||"";this.$setStyleClass(this.$ext,d?"":this.$baseCSSname+"Initial",[!d?"":this.$baseCSSname+"Initial"]);};this.addEventListener("afterselect",function(d){if(!d){d=event;}this.slideUp();if(!this.isOpen){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over"]);}this.$setLabel(d.selection.length?this.$applyBindRule("value",this.selected):"");if(this.hasFeature(apf.__VALIDATION__)&&this.form){this.validate(true);}});function c(){if(this.isOpen==2){this.slideDown();}}this.$blur=function(){this.slideUp();if(!this.isOpen){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over"]);}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);};this.$focus=function(){apf.popup.forceHide();this.$setStyleClass(this.oFocus||this.$ext,this.$baseCSSname+"Focus");};this.$setClearMessage=function(d){if(d){this.$setLabel(d);}};this.$removeClearMessage=function(){this.$setLabel("");};this.addEventListener("slidedown",function(){if(!this.form||!this.form.xmlActions||this.xmlRoot){return;}var d=this.form.xmlActions.selectSingleNode("LoadList[@element='"+this.name+"']");if(!d){return;}this.isOpen=2;this.form.processLoadRule(d,true,[d]);return false;});this.addEventListener("popuphide",this.slideUp);var a=function(d){return((d%4===0)&&(d%100!==0))||(d%400===0)?true:false;};this.redraw=function(R,E){var P=this.$calVars;P.currentMonth=R;P.currentYear=E;var n=this.$ext.offsetWidth,O=Math.floor((n-36)/8)*8+32-apf.getDiff(this.oNavigation)[0],F=new Date(E,0,1).getDay();if(O>=0){this.oNavigation.style.width=O+"px";}for(N=0;N<=R;N++){if(a(E)&&N==1){F++;}F+=P.months[N].number;}var J=Math.ceil(F/7),Q=new Date(E,R);P.numberOfDays=P.months[Q.getMonth()].number;if(a(E)&&Q.getMonth()==1){P.numberOfDays++;}P.dayNumber=new Date(E,R,1).getDay();var U=R==0?11:R-1,V=P.months[U].number-P.dayNumber+1,G=1,C=this.oNavigation.childNodes,l,B;for(N=0;N<C.length;N++){if((C[N].className||"").indexOf("today")!=-1){if(n<300){var d=apf.language.getWord("sub.calendar.shortToday")||"T";C[N].innerHTML=d;C[N].style.width="8px";C[N].setAttribute("title",d);}else{var I=apf.language.getWord("sub.calendar.today")||"Today";C[N].innerHTML=I;C[N].style.width="32px";C[N].setAttribute("title",I);}}else{if((C[N].className||"").indexOf("status")!=-1){if(n>=300){C[N].innerHTML=P.months[P.currentMonth].name+" "+P.currentYear;}else{C[N].innerHTML=(P.currentMonth+1)+"/"+P.currentYear;}}}}this.$sliderHeight=22;O=Math.floor((n-37)/8);var o=O>0?O:0;var t=this.oDow.childNodes,A=Math.floor(o/4+6),D=Math.floor(o/4-8)>0?Math.floor(o/4-8):0,M=n<150?"6px":(n<=220?"9px":"11px"),s=(o*8+32);this.oDow.style.width=s+"px";this.$sliderHeight+=A+D;for(var w=0,N=0;N<t.length;N++){if((t[N].className||"").indexOf("dayofweek")>-1){t[N].style.width=o+"px";t[N].style.height=A+"px";t[N].style.paddingTop=D+"px";t[N].style.fontSize=M;if(w>0){t[N].innerHTML=P.days[w-1].substr(0,3);}w++;}}var u=Math.floor((o+12)/2),q=o-u>0?o-u:0;C=this.oSlider.childNodes;for(w=0,B=0,N=0;N<C.length;N++){if((C[N].className||"").indexOf("row")==-1){continue;}C[N].style.width=(s-apf.getDiff(C[N])[0])+"px";if(!apf.isGecko){C[N].style.paddingTop="1px";}this.$sliderHeight+=(o+5);l=C[N].childNodes;for(var K=0,m=0;K<l.length;K++){if((l[K].className||"").indexOf("cell")==-1){continue;}w++;l[K].style.width=o+"px";l[K].style.height=u+"px";l[K].style.paddingTop=q+"px";l[K].style.margin=w%8==0&&w!==1?"1px 0 1px 0":"1px 2px 1px 0";this.$setStyleClass(l[K],"",["weekend","disabled","active","prev","next","weeknumber"]);if((w-1)%8==0){l[K].innerHTML=J-Math.ceil((P.months[P.month].number+P.dayNumber)/7)+1+(w-1)/8;this.$setStyleClass(l[K],"weeknumber");}else{B++;if(B<=P.dayNumber){l[K].innerHTML=V++;this.$setStyleClass(l[K],"disabled prev");}else{if(B>P.dayNumber&&B<=P.numberOfDays+P.dayNumber){l[K].innerHTML=B-P.dayNumber;var T=new Date(E,R,B-P.dayNumber).getDay();if(T==0||T==6){this.$setStyleClass(l[K],"weekend");}if(R==P.month&&E==P.year&&B-P.dayNumber==P.day){this.$setStyleClass(l[K],"active");}}else{if(B>P.numberOfDays+P.dayNumber){l[K].innerHTML=G++;this.$setStyleClass(l[K],"disabled next");m++;}}}}}C[N].style.visibility=m==7?"hidden":"visible";}};this.selectDay=function(j,i){var m=this.$calVars,l=i=="prev"?m.currentMonth:(i=="next"?m.currentMonth+2:m.currentMonth+1),d=m.currentYear;if(l<1){l=12;d--;}else{if(l>12){l=1;d++;}}this.change(new Date(d,(l-1),j,m.hours,m.minutes,m.seconds).format(this.outputFormat));};this.nextYear=function(){this.redraw(this.$calVars.currentMonth,this.$calVars.currentYear+1);};this.prevYear=function(){this.redraw(this.$calVars.currentMonth,this.$calVars.currentYear-1);};this.nextMonth=function(){var i,d,j=this.$calVars;if(j.currentMonth>10){i=0;d=j.currentYear+1;}else{i=j.currentMonth+1;d=j.currentYear;}this.redraw(i,d);};this.prevMonth=function(){var i,d,j=this.$calVars;if(j.currentMonth<1){i=11;d=j.currentYear-1;}else{i=j.currentMonth-1;d=j.currentYear;}this.redraw(i,d);};this.today=function(){this.change(new Date().format(this.outputFormat));};this.$draw=function(){this.$getNewContext("main");this.$getNewContext("container");this.$animType=this.$getOption("main","animtype")||1;this.clickOpen=this.$getOption("main","clickopen")||"button";this.$ext=this.$getExternal(null,null,function(j){j.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+');                 o.$setStyleClass(o.$ext, o.$baseCSSname + "Over");');j.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+');                 if (o.isOpen) return;                 o.$setStyleClass(o.$ext, "", [o.$baseCSSname + "Over"]);');var i=this.$getLayoutNode("main","button",j);if(i){i.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").slideToggle(event);");}var l=this.$getLayoutNode("main","label",j);if(this.clickOpen=="both"){l.parentNode.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").slideToggle(event);");}});this.oLabel=this.$getLayoutNode("main","label",this.$ext);if(this.oLabel.nodeType==3){this.oLabel=this.oLabel.parentNode;}this.oIcon=this.$getLayoutNode("main","icon",this.$ext);if(this.$button){this.$button=this.$getLayoutNode("main","button",this.$ext);}if(apf.caldropdown.cache){var d=apf.caldropdown.cache;this.oSlider=d.oSlider;this.oNavigation=d.oNavigation;this.oDow=d.oDow;apf.caldropdown.cache.refcount++;this.$pHtmlDoc=apf.popup.setContent(this.$uniqueId,this.oSlider,apf.skins.getCssString(this.skinName));}else{this.oSlider=this.$getExternal("container",null,function(w){var q,t=this.$getLayoutNode("container","contents",w);for(q=0;q<6;q++){this.$getNewContext("row");var l=t.appendChild(this.$getLayoutNode("row"));for(var n=0;n<8;n++){this.$getNewContext("cell");var s=this.$getLayoutNode("cell");if(n>0){s.setAttribute("onmouseout","apf.setStyleClass(this, '', ['hover']);");s.setAttribute("onmouseover","if (this.className.indexOf('disabled') > -1                                    || this.className.indexOf('active') > -1)                                      return;                                 apf.setStyleClass(this, 'hover');");s.setAttribute("onmousedown","var o = apf.findHost(this);                                 if (this.className.indexOf('prev') > -1)                                      o.selectDay(this.innerHTML, 'prev');                                 else if (this.className.indexOf('next') > -1)                                      o.selectDay(this.innerHTML, 'next');                                 else                                      o.selectDay(this.innerHTML);                                 o.slideUp();");}l.appendChild(s);}}var z=this.$getLayoutNode("container","navigation",w);if(z){var u=["prevYear","prevMonth","nextYear","nextMonth","today","status"];for(q=0;q<u.length;q++){this.$getNewContext("button");var m=z.appendChild(this.$getLayoutNode("button"));this.$setStyleClass(m,u[q]);if(u[q]!=="status"){m.setAttribute("onmousedown","apf.findHost(this)."+u[q]+"()");m.setAttribute("onmouseover",'apf.setStyleClass(this, "hover");');m.setAttribute("onmouseout",'apf.setStyleClass(this, "", ["hover"]);');}}}var o=this.$getLayoutNode("container","daysofweek",w);for(q=0;q<this.$calVars.days.length+1;q++){this.$getNewContext("day");o.appendChild(this.$getLayoutNode("day"));}});this.oNavigation=this.$getLayoutNode("container","navigation",this.oSlider);this.oDow=this.$getLayoutNode("container","daysofweek",this.oSlider);}this.$pHtmlDoc=apf.popup.setContent(this.$uniqueId,this.oSlider,apf.skins.getCssString(this.skinName));document.body.appendChild(this.oSlider);this.listtype=parseInt(this.$getLayoutNode("main","type"))||1;if(!apf.caldropdown.cache){apf.caldropdown.cache={oSlider:this.oSlider,oNavigation:this.oNavigation,oDow:this.oDow};apf.caldropdown.cache.refcount=0;}};this.$loadAml=function(d){var i,j=this.$calVars;if(typeof this.value=="undefined"){switch(this["default"]){case"today":this.setProperty("value",new Date().format(this.outputFormat));break;default:i=new Date();j.day=0;j.month=i.getMonth();j.year=i.getFullYear();this.$setLabel();break;}}else{i=Date.parse(this.value,this.outputFormat);j.day=i.getDate();j.month=i.getMonth();j.year=i.getFullYear();if(j.day&&j.month&&j.year){this.setProperty("value",new Date(j.year,j.month,j.day,j.hours,j.minutes,j.seconds).format(this.outputFormat));}}};this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);apf.destroyHtmlNode(this.oSlider);this.oSlider=null;if(apf.caldropdown.cache&&apf.caldropdown.cache.refcount){if(apf.caldropdown.cache.refcount==0){apf.caldropdown.cache=null;}else{apf.caldropdown.cache.refcount--;}}};}).call(apf.caldropdown.prototype=new apf.StandardBinding());apf.config.$inheritProperties["initial-message"]=1;apf.aml.setElement("caldropdown",apf.caldropdown);apf.radiobutton=function(d,a){this.$init(a||"radiobutton",apf.NODE_VISIBLE,d);this.$constructor=apf.radiobutton;var c=apf.aml.setElement("radiobutton",function(){this.$init(a||"radiobutton",apf.NODE_VISIBLE,d);});c.prototype=apf.radiobutton.prototype;apf.radiobutton=c;};(function(){this.implement(apf.ChildValue);this.$childProperty="label";this.$focussable=true;this.$attrExcludePropBind=apf.extend({checked:1},this.$attrExcludePropBind);this.$supportedProperties.push("value","background","group","label","checked","tooltip","icon");this.$propHandlers.group=function(a){if(this.$group&&this.$group.$removeRadio){this.$group.$removeRadio(this);}if(!a){this.$group=null;return;}var c=apf.nameserver.get("radiogroup",a);if(!c){c=apf.nameserver.register("radiogroup",a,new apf.$group());c.setAttribute("id",a);c.dispatchEvent("DOMNodeInsertedIntoDocument");c.parentNode=this;}this.$group=c;if(this.oInput){this.oInput.setAttribute("name",a);}this.$group.$addRadio(this);};this.$propHandlers.tooltip=function(a){this.$ext.setAttribute("title",a);};this.$propHandlers.icon=function(a){if(!this.oIcon){return;}if(a){this.$setStyleClass(this.$ext,this.$baseCSSname+"Icon");}else{this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Icon"]);}apf.skins.setIcon(this.oIcon,a,this.iconPath);};this.$propHandlers.label=function(a){if(a){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Empty"]);}else{this.$setStyleClass(this.$ext,this.$baseCSSname+"Empty");}if(this.oLabel){this.oLabel.innerHTML=a;}};this.$propHandlers.checked=function(a){if(!this.$group){return;}if(apf.isTrue(a)){this.checked=true;this.$group.setProperty("value",this.value);}else{if(apf.isFalse(a)){this.checked=false;this.$group.setProperty("value","");}else{this.$group.$setDynamicProperty("value",a);}}};this.addEventListener("prop.model",function(a){this.$group.setProperty("model",a.value);});this.$propHandlers.background=function(c){var d=this.$getLayoutNode("main","background",this.$ext);if(c){var a=c.split("|");this.$background=a.concat(["vertical",2,16].slice(a.length-1));d.style.backgroundImage="url("+this.mediaPath+a[0]+")";d.style.backgroundRepeat="no-repeat";}else{d.style.backgroundImage="";d.style.backgroundRepeat="";this.$background=null;}};this.setValue=function(a){this.setProperty("value",a,false,true);};this.getValue=function(){return this.value;};this.check=function(){this.setProperty("checked",true,false,true);};this.uncheck=function(){this.setProperty("checked",false,false,true);};this.getGroup=function(){return this.$group;};this.$check=function(a){this.$setStyleClass(this.$ext,this.$baseCSSname+"Checked");this.checked=true;if(this.oInput){this.oInput.checked=true;}this.doBgSwitch(2);};this.$uncheck=function(){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Checked"]);this.checked=false;if(this.oInput){this.oInput.checked=false;}this.doBgSwitch(1);};this.$enable=function(){if(this.oInput){this.oInput.disabled=false;}var a=this;this.$ext.onclick=function(c){if(!c){c=event;}if((c.srcElement||c.target)==this){return;}a.dispatchEvent("click",{htmlEvent:c});a.$group.change(a.value);};this.$ext.onmousedown=function(c){if(!c){c=event;}if((c.srcElement||c.target)==this){return;}apf.setStyleClass(this,a.$baseCSSname+"Down");};this.$ext.onmouseover=function(c){if(!c){c=event;}if((c.srcElement||c.target)==this){return;}apf.setStyleClass(this,a.$baseCSSname+"Over");};this.$ext.onmouseout=this.$ext.onmouseup=function(){apf.setStyleClass(this,"",[a.$baseCSSname+"Down",a.$baseCSSname+"Over"]);};};this.$disable=function(){if(this.oInput){this.oInput.disabled=true;}this.$ext.onclick=null;this.$ext.onmousedown=null;};this.doBgSwitch=function(c){if(this.bgswitch&&(this.bgoptions[1]>=c||c==4)){if(c==4){c=this.bgoptions[1]+1;}var a=this.bgoptions[0]=="vertical"?"0 -"+(parseInt(this.bgoptions[2])*(c-1))+"px":"-"+(parseInt(this.bgoptions[2])*(c-1))+"px 0";this.$getLayoutNode("main","background",this.$ext).style.backgroundPosition=a;}};this.$focus=function(){if(!this.$ext){return;}if(this.oInput&&this.oInput.disabled){return false;}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");};this.$blur=function(){if(!this.$ext){return;}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);};this.addEventListener("keydown",function(d){var a=d.keyCode;if(a==13||a==32){this.$group.change(this.value);return false;}else{if(a==38){var c=this;while(c&&c.previousSibling){c=c.previousSibling;if(c.localName=="radiobutton"&&!c.disabled&&c.$group==this.$group){c.check();c.focus();return;}}}else{if(a==40){var c=this;while(c&&c.nextSibling){c=c.nextSibling;if(c.localName=="radiobutton"&&!c.disabled&&c.$group==this.$group){c.check();c.focus();return;}}}}}},true);this.$draw=function(){this.$ext=this.$getExternal();this.oInput=this.$getLayoutNode("main","input",this.$ext);this.oLabel=this.$getLayoutNode("main","label",this.$ext);this.oIcon=this.$getLayoutNode("main","icon",this.$ext);this.enable();};this.$childProperty="label";this.$loadAml=function(a){if(!this.group){this.$propHandlers.group.call(this,"radiogroup"+this.parentNode.$uniqueId);}};this.$destroy=function(){if(this.$group){this.$group.$removeRadio(this);}};}).call(apf.radiobutton.prototype=new apf.Presentation());apf.aml.setElement("radiobutton",apf.radiobutton);apf.$group=function(i,a){this.$init(a||"radiogroup",apf.NODE_VISIBLE,i);this.implement(apf.DataAction);var d=[];this.$supportedProperties.push("value","selectedItem");this.$propHandlers.value=function(l){for(var j=0;j<d.length;j++){if(d[j].value==l){return this.setProperty("selectedItem",d[j]);}}return this.setProperty("selectedItem",null);};var c;this.$propHandlers.selectedItem=function(l){if(c){c.$uncheck();}if(!l){return;}l.$check();c=l;for(var j=0;j<d.length;j++){d[j].setProperty("selectedItem",l);}};this.$addRadio=function(j){var l=d.push(j)-1;if(!j.value){j.setProperty("value",l);}if(this.value&&j.value==this.value){this.setProperty("selectedItem",j);}else{if(j.checked){this.setProperty("value",j.value);}}};this.$removeRadio=function(j){d.remove(j);if(j.value===j.id){j.setProperty("value","");}if(j.selectedItem==j){this.setProperty("value",null);}};this.setValue=function(j){this.setProperty("value",j);};this.getValue=function(){return this.value;};};apf.$group.prototype=new apf.StandardBinding();apf.style=function(c,a){this.$init(a||"style",apf.NODE_HIDDEN,c);};(function(){this.$focussable=false;this.addEventListener("DOMNodeInsertedIntoDocument",function(a){if(this.type!="text/chartcss"&&this.firstChild){apf.importCssString(this.firstChild.nodeValue);}});}).call(apf.style.prototype=new apf.AmlElement());apf.aml.setElement("style",apf.style);apf.xhtml.setElement("style",apf.style);apf.page=function(c,a){this.$init(a||"page",apf.NODE_VISIBLE,c);};(function(){this.canHaveChildren=true;this.$focussable=false;this.buttons=false;this.closebtn=false;this.setCaption=function(a){this.setProperty("caption",a,false,true);};this.setIcon=function(a){this.setProperty("icon",a,false,true);};this.addEventListener("beforerender",function(){this.parentNode.dispatchEvent("beforerender",{page:this});});this.addEventListener("afterrender",function(){this.parentNode.dispatchEvent("afterrender",{page:this});});this.$booleanProperties.visible=true;this.$booleanProperties.fake=true;this.$booleanProperties.closebtn=true;this.$supportedProperties.push("fake","caption","icon","type","buttons","closebtn");this.$propHandlers.buttons=function(a){this.buttons=a;};this.$propHandlers.closebtn=function(a){this.closebtn=a;};this.$propHandlers.caption=function(c){if(!this.parentNode){return;}var a=this.parentNode.$getLayoutNode("button","caption",this.$button);if(a.nodeType==1){a.innerHTML=c;}else{a.nodeValue=c;}};this.$propHandlers.icon=function(c){if(!this.parentNode){return;}var a=this.parentNode.$getLayoutNode("button","icon",this.$button);if(a&&a.nodeType==1){apf.skins.setIcon(a,c,this.parentNode.iconPath);}};this.$propHandlers.visible=function(i){if(!this.parentNode){return;}if(i){this.$ext.style.display="";if(this.parentNode.$hasButtons){this.$button.style.display="block";}if(!this.parentNode.$activepage){this.parentNode.set(this);}}else{if(this.$active){this.$deactivate();var d=this.parentNode.activepagenr+1;var c=this.parentNode.getPages();var a=c.length;while(d<a&&!c[d].visible){d++;}if(d==a){d=this.parentNode.activepagenr-1;while(d>=0&&a&&!c[d].visible){d--;}}if(d>=0){this.parentNode.set(d);}else{this.parentNode.activepage=this.parentNode.activepagenr=this.parentNode.$activepage=null;}}this.$ext.style.display="none";if(this.parentNode.$hasButtons){this.$button.style.display="none";}}};this.$propHandlers.fake=function(a){if(this.$ext){apf.destroyHtmlNode(this.$ext);this.$int=this.$ext=null;}};this.$propHandlers.type=function(a){this.setProperty("fake",true);this.relPage=this.parentNode.getPage(a);if(this.$active){this.$activate();}};this.addEventListener("DOMNodeRemoved",function(a){if(a&&a.currentTarget!=this){return;}if(this.$button){if(this.$position&1){this.parentNode.$setStyleClass(this.$button,"",["firstbtn","firstcurbtn"]);}if(this.$position&2){this.parentNode.$setStyleClass(this.$button,"",["lastbtn"]);}}if(!a.$doOnlyAdmin){if(this.$button){this.$button.parentNode.removeChild(this.$button);}if(this.parentNode.$activepage==this){if(this.$button){this.parentNode.$setStyleClass(this.$button,"",["curbtn"]);}this.parentNode.$setStyleClass(this.$ext,"",["curpage"]);}}});this.addEventListener("DOMNodeInserted",function(a){if(a&&a.currentTarget!=this||!this.$amlLoaded||!a.$oldParent){return;}if(!a.$moveWithinParent&&this.skinName!=this.parentNode.skinName){this.$destroy();}else{if(this.$button&&a.$oldParent.$hasButtons){this.parentNode.$buttons.insertBefore(this.$button,a.$beforeNode&&a.$beforeNode.$button||null);}}},true);this.$position=0;this.$first=function(a){if(a){this.$position-=1;this.parentNode.$setStyleClass(this.$button,"",["firstbtn","firstcurbtn"]);}else{this.$position=this.$position|1;this.parentNode.$setStyleClass(this.$button,"firstbtn"+(this.parentNode.$activepage==this?" firstcurbtn":""));}};this.$last=function(a){if(a){this.$position-=2;this.parentNode.$setStyleClass(this.$button,"",["lastbtn"]);}else{this.$position=this.$position|2;this.parentNode.$setStyleClass(this.$button,"lastbtn");}};this.$deactivate=function(a){if(this.disabled){return false;}this.$active=false;if(this.parentNode.$hasButtons){if(this.$position>0){this.parentNode.$setStyleClass(this.$button,"",["firstcurbtn"]);}this.parentNode.$setStyleClass(this.$button,"",["curbtn"]);}if((!this.fake||this.relPage)&&!a){this.parentNode.$setStyleClass(this.fake?this.relPage.$ext:this.$ext,"",["curpage"]);this.dispatchEvent("prop.visible",{value:false});}};this.$activate=function(){if(this.disabled){return false;}this.$active=true;if(!this.$drawn){var c;this.addEventListener("DOMNodeInsertedIntoDocument",c=function(d){this.removeEventListener("DOMNodeInsertedIntoDocument",c);if(!this.$active){return;}this.$activate();});return;}if(this.parentNode.$hasButtons){if(this.$position>0){this.parentNode.$setStyleClass(this.$button,"firstcurbtn");}this.parentNode.$setStyleClass(this.$button,"curbtn");}if(!this.fake||this.relPage){this.parentNode.$setStyleClass(this.fake?this.relPage.$ext:this.$ext,"curpage");if(apf.layout){apf.layout.forceResize(this.fake?this.relPage.$int:this.$int);}}if(this.$render){this.$render();}if(!this.fake){if(apf.isIE){var a=this.$ext.className;this.$ext.className="rnd"+Math.random();this.$ext.className=a;}this.dispatchEvent("prop.visible",{value:true});}};this.addEventListener("$skinchange",function(){if(this.caption){this.$propHandlers.caption.call(this,this.caption);}if(this.icon){this.$propHandlers.icon.call(this,this.icon);}});this.$canLeechSkin=true;this.$draw=function(d){this.skinName=this.parentNode.skinName;var m=this.getAttribute("type");if(m){this.fake=true;this.relPage=this.parentNode.getPage(m)||null;}if(this.parentNode.$hasButtons){this.parentNode.$getNewContext("button");var j=this.parentNode.$getLayoutNode("button");j.setAttribute(this.parentNode.$getOption("main","select")||"onmousedown","var page = apf.lookup("+this.$uniqueId+");                 page.parentNode.set(page);                 page.canHaveChildren = 2;");j.setAttribute("onmouseover","var o = apf.lookup("+this.parentNode.$uniqueId+");if(apf.lookup("+this.$uniqueId+') != o.$activepage) o.$setStyleClass(this, "over");');j.setAttribute("onmouseout","var o = apf.lookup("+this.parentNode.$uniqueId+');                  o.$setStyleClass(this, "", ["over"]);                  var page = apf.lookup('+this.$uniqueId+");                  page.canHaveChildren = true;");var i=this.getAttribute("id")||this.getAttribute("name"),a=this.getAttribute("closebtn");if((a=="true"||(this.parentNode.buttons=="close"&&a==null))&&i){var c=this.parentNode.$getLayoutNode("button","btncontainer");this.parentNode.$getNewContext("btnclose");var l=this.parentNode.$getLayoutNode("btnclose");if(!l){return;}l.setAttribute("onclick","var page = apf.lookup("+this.$uniqueId+");                     page.parentNode.remove("+i+");");c.appendChild(l);}this.$button=apf.insertHtmlNode(j,this.parentNode.$buttons);if(!d&&this.nextSibling&&this.nextSibling.$button){this.$button.parentNode.insertBefore(this.$button,this.nextSibling.$button);}this.$button.host=this;}if(this.fake){return;}if(this.$ext){this.$ext.parentNode.removeChild(this.$ext);}this.$ext=this.parentNode.$getExternal("page",this.parentNode.oPages,null,this);this.$ext.host=this;this.$int=this.parentNode.$getLayoutNode("page","container",this.$ext);};this.$loadAml=function(a){};this.$destroy=function(){if(this.$button){this.$button.host=null;this.$button=null;}};}).call(apf.page.prototype=new apf.Presentation());apf.aml.setElement("page",apf.page);apf.xforms=function(c,a){this.$init(a||"xforms",apf.NODE_VISIBLE,c);};apf.submitform=function(c,a){this.$init(a||"submitform",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction,apf.BaseTab,apf.ValidationGroup);this.$focussable=false;this.elements={};var buttons={next:[],previous:[],submit:[],follow:[]};this.$focussable=false;this.inputs=[];this.errorEl={};this.cq={};this.reqs=[];this.conditionDeps={};this.depends={};this.loadValueDeps={};this.loadValues={};this.listsHeldBack={};this.nextHeldBack={};this.activepagenr=0;this.zCount=1000000;this.clear=function(){};this.showLoader=function(checked,nr){if(checked){var page=nr?this.getPage(nr):this.getNextPage();if(!page||page.$rendered){return;}}if(this.loadState){this.loadState.style.display="block";var message=this.getPage().getAttribute("loadmessage");if(message){(apf.queryNode("div[@class='msg']",this.loadState)||this.loadState).innerHTML=message;}}};this.hideLoader=function(){if(this.loadState){this.loadState.style.display="none";}};var nextpagenr;this.getNextPage=function(){var nextpage,pageNr=this.activepagenr;do{nextpage=this.getPage(++pageNr);}while(nextpage&&!this.testCondition(nextpage.condition));nextpagenr=pageNr;return nextpage;};this.next=function(no_error){if(!this.testing&&!this.isValid(null,null,this.getPage())){this.hideLoader();return;}this.set(this.activepagenr+1);for(var prop in buttons){if(!prop.match(/next|previous|submit/)){continue;}this.updateButtons(prop);}nextpagenr=null;};this.previous=function(){this.set(this.activepagenr-1);for(var prop in buttons){if(!prop.match(/next|previous|submit/)){continue;}this.updateButtons(prop);}};this.$enable=function(){forbuttons("enable");};this.$disable=function(){forbuttons("disable");};function forbuttons(feat){var arr=["next","previous","submit","follow"];for(var k=0;k<arr.length;k++){for(var i=0;i<buttons[arr[k]].length;i++){buttons[arr[k]][i][feat]();}}}this.processValueChange=function(oFormEl){if(this.conditionDeps[oFormEl.name]){var c=this.conditionDeps[oFormEl.name];for(var i=0;i<c.length;i++){if(this.testCondition(c[i].condition)){c[i].setActive();}else{c[i].setInactive();}}}for(var prop in buttons){if(!prop.match(/next|previous|submit/)){continue;}this.updateButtons(prop);}this.setLoadValues(oFormEl.name);};this.addInput=function(objEl){var name=objEl.name;objEl.$validgroup=this;if(this.elements[name]&&!this.elements[name].length){this.elements[name]=[this.elements[name]];this.elements[name].getValue=new Function("for (var i = 0; i < this.length; i++)                     if (this[i].$int.checked)                         return this[i].getValue();");}if(this.elements[name]){this.elements[name].push(objEl);}else{this.elements[name]=objEl;}if(this.cq[name]){for(var i=0;i<this.cq[name].length;i++){this.cq[name][i][1].call(this.cq[name][i][0],objEl);objEl.labelEl=this.cq[name][i][0];}}if(objEl.getAttribute("dependson")){var o=self[objEl.getAttribute("dependson")];if(!this.depends[o.name]){this.depends[o.name]=[];}this.depends[o.name].push(objEl);objEl.setInactive();}if(objEl.nodeFunc==apf.NODE_VISIBLE){objEl.setZIndex(--this.zCount);}if(this.listsHeldBack[name]){var ld=this.listsHeldBack[name];this.loadLists(ld[0],ld[1],ld[2]);this.listsHeldBack[name]=null;}if(this.nQuest&&objEl.getAttribute("checknext")=="true"){if(this.lastEl){this.lastEl.nextEl=objEl;objEl.prevEl=this.lastEl;}this.lastEl=objEl;if(objEl.prevEl&&objEl.getAttribute("show")!="true"&&!this.nextHeldBack[name]&&!objHasValue(objEl)){objEl.setInactive(true);}else{if(this.condActiveCheck[objEl.name]){this.condActiveCheck[objEl.name].setActive();}}if(this.condActiveCheck[objEl.name]){objEl.container=this.condActiveCheck[objEl.name];function activateHandler(){if(this.form.hasActiveElement(this.container)){this.container.setActive();}else{this.container.setInactive();}}objEl.addEventListener("activate",activateHandler);objEl.addEventListener("deactivate",activateHandler);}}};this.hasActiveElement=function(objEl){var nodes=objEl.$aml.getElementsByTagName("*");for(var i=0;i<nodes.length;i++){if(!nodes[i].getAttribute("id")){continue;}var comp=this.elements[nodes[i].getAttribute("id")];if(comp&&comp.form==this&&comp.isActive){return true;}}return false;};this.condActiveCheck={};this.getButtons=function(action){return buttons[action];};this.registerButton=function(action,oBtn){buttons[action].push(oBtn);if(oBtn.condition){this.parseCondition(oBtn,oBtn.condition);}this.updateButtons(action,oBtn);if(action=="follow"){return;}var amlNode=this;oBtn.onclick=function(){amlNode.showLoader(true);$setTimeout(function(){amlNode[action]();},10);};};this.updateButtons=function(action,singleBtn){return false;if(!buttons[action]){return false;}var result=true;if(action=="previous"&&this.activepagenr==0){result=false;}else{if(!this.testing&&action=="next"&&!this.isValid()){result=false;}else{if(action=="next"){var cp=this.activepagenr;do{var nextpage=this.getPage(++cp);}while(nextpage&&!this.testCondition(nextpage.condition));if(!nextpage){result=false;}}}}if(this.testing){return true;}var buttons=singleBtn?[singleBtn]:buttons[action];for(var i=0;i<buttons.length;i++){if(result&&(!buttons[i].condition||this.testCondition(buttons[i].condition))){buttons[i].setActive();}else{buttons[i].setInactive();}}return true;};this.setLoadValues=function(item,clearElements,noload){var lvDep=this.loadValueDeps[item];if(!lvDep){return;}for(var i=0;i<lvDep.length;i++){try{if(!eval(lvDep[i][1])){throw new Error();}}catch(e){if(clearElements){var oEl=self[lvDep[i][0].getAttribute("element")];if(oEl){this.clearNextQuestionDepencies(oEl,true);}if(lvDep[i][0].tagName=="LoadValue"){this.dispatchEvent("clearloadvalue",lvDep[i][0]);}}continue;}if(noload){continue;}if(lvDep[i][0].getAttribute("runonrequest")!="true"){this.processLoadRule(lvDep[i][0],lvDep[i][2],lvDep[i]);}else{if(self[lvDep[i][0].getAttribute("element")]){self[lvDep[i][0].getAttribute("element")].clear();}}}};this.processLoadRule=function(xmlCommNode,isList,data){if(!apf.teleport.hasLoadRule(xmlCommNode)){return;}this.dispatchEvent(isList?"beforeloadlist":"beforeloadvalue");var nodes=xmlCommNode.childNodes;if(nodes.length){var arr,arg=xmlCommNode.getAttribute(apf.teleport.lastRuleFound.args);arg=arg?arg.split(";"):[];if(xmlCommNode.getAttribute("argarray")){arr=[];}for(var j=0;j<nodes.length;j++){if(nodes[j].nodeType!=1){continue;}if(nodes[j].getAttribute("argtype").match(/fixed|param|nocheck/)){var el=self[nodes[j].getAttribute("element")];var xpath=el.getMainBindXpath();var xNode=apf.createNodeFromXpath(this.xmlRoot,xpath);var nType=xNode.nodeType;(arr||arg)[nodes[j].getAttribute("argnr")||j]="xpath:"+xpath+(nType==1?"/text()":"");}else{if(nodes[j].getAttribute("argtype")=="xpath"){(arr||arg)[nodes[j].getAttribute("argnr")||j]="xpath:"+nodes[j].getAttribute("select");}}}if(xmlCommNode.getAttribute("argarray")){arg[xmlCommNode.getAttribute("argarray")]="("+arr.join(",")+")";}xmlCommNode.setAttribute(apf.teleport.lastRuleFound.args,arg.join(";"));}var jNode=self[xmlCommNode.getAttribute("element")];if(jNode&&jNode.nodeFunc==apf.NODE_VISIBLE){jNode.$setStyleClass(jNode.$ext,"loading",["loaded"]);}apf.teleport.callMethodFromNode(xmlCommNode,this.xmlRoot,Function("data","state","extra","apf.lookup("+this.$uniqueId+")."+(isList?"loadLists":"loadValues")+"(data, state, extra)"),null,data);};this.registerCondition=function(objEl,strCondition,no_parse){if(!no_parse){this.parseCondition(objEl,strCondition);}var forceActive=false;if(objEl.onlyWhenActive){var nodes=objEl.$aml.getElementsByTagName("*");for(var i=0;i<nodes.length;i++){if(!nodes[i].getAttribute("id")){continue;}if(this.nextHeldBack[nodes[i].getAttribute("id")]){forceActive=true;}else{if(nodes[i].getAttribute("ref")&&this.xmlRoot&&apf.queryValue(this.xmlRoot.selectSingleNode(nodes[i].getAttribute("ref")))!=""){forceActive=true;nodes[i].setAttribute("show","true");}}this.condActiveCheck[nodes[i].getAttribute("id")]=objEl;}}if(forceActive||this.testCondition(objEl.condition)&&(!objEl.onlyWhenActive||this.hasActiveElement(objEl,true))){objEl.setActive();}else{objEl.setInactive();}var matches=!no_parse?strCondition.match(/(\W|^)(\w+)(?:\=|\!\=)/g):strCondition.match(/(\b|^)([\w\.]+)/g);if(!matches){return;}for(var i=0;i<matches.length;i++){if(!no_parse){var m=matches[i].replace(/(?:\=|\!\=)$/,"").replace(/(^\s+|\s+$)/g,"");}else{var m=matches[i].split(".");if(m.length<2){continue;}m=m[0];}if(!this.conditionDeps[m]){this.conditionDeps[m]=Array();}this.conditionDeps[m].push(objEl);}};this.testCondition=function(strCondition){try{return eval(strCondition);}catch(e){return false;}};this.loadValues=function(data,state,extra){if(state!=apf.SUCCESS){if(extra.retries<apf.maxHttpRetries){return extra.tpModule.retry(extra.id);}else{throw new Error(apf.formatErrorString(1010,this,"LoadVaLue","Could not load values with LoadValue query :\n\n"+extra.message));}}if(extra.userdata[0].getAttribute("returntype")=="array"){for(var i=0;i<data.length;i++){var pnode=this.xmlRoot.selectSingleNode("//"+data[i][0]);apf.xmldb.setTextNode(pnode,data[i][1]||"");}}else{if(typeof data!="object"){data=apf.getXmlDom(data).documentElement;}var nodes=data.childNodes;var strUnique=extra.userdata[0].getAttribute("unique");for(var i=nodes.length-1;i>=0;i--){var xmlNode=nodes[i];var unique=strUnique?xmlNode.selectSingleNode(strUnique):false;var node=unique?this.xmlRoot.selectSingleNode("node()["+strUnique+" = '"+unique.nodeValue+"']"):null;if(node){apf.xmldb.copyConnections(node,xmlNode);apf.xmldb.notifyListeners(xmlNode);var valueNode=xmlNode.selectSingleNode("value");if(valueNode){apf.xmldb.copyConnections(node.selectSingleNode("value"),valueNode);apf.xmldb.notifyListeners(valueNode);}}this.xmlRoot.insertBefore(xmlNode,node);if(node){this.xmlRoot.removeChild(node);}apf.xmldb.applyChanges("attribute",xmlNode);}}this.dispatchEvent("afterloadvalue");};this.loadLists=function(data,state,extra){if(state!=apf.SUCCESS){if(extra.retries<apf.maxHttpRetries){return extra.tpModule.retry(extra.id);}else{throw new Error(apf.formatErrorString(1011,this,"Load List","Could not load data with LoadList query :\n\n"+extra.message));}}if(!self[extra.userdata[0].getAttribute("element")]){return this.listsHeldBack[extra.userdata[0].getAttribute("element")]=[data,state,extra];}var jNode=self[extra.userdata[0].getAttribute("element")];if(jNode&&jNode.nodeFunc==apf.NODE_VISIBLE){jNode.$setStyleClass(jNode.$ext,"loaded",["loading"]);$setTimeout("var jNode = apf.lookup("+jNode.$uniqueId+");                jNode.$setStyleClass(jNode.$ext, '', ['loading', 'loaded']);",500);}if(extra.userdata[0].getAttribute("clearonload")=="true"){jNode.clearSelection();this.clearNextQuestionDepencies(jNode,true);}jNode.load(data);this.dispatchEvent("afterloadlist");};this.reset=function(){var name,el;for(name in this.elements){el=this.elements[name];if(el.length){throw new Error(apf.formatErrorString(this,"clearing form","Found controls without a name or with a name that isn't unique. Please give all elements of your submitform an id: '"+name+"'"));}el.clearError();if(this.errorEl[name]){this.errorEl[name].hide();}el.clear();}};this.$xmlUpdate=function(action,xmlNode,listenNode,UndoObj){this.dispatchEvent("xmlupdate");};this.smartBinding={};this.$load=function(XMLRoot,id){apf.xmldb.addNodeListener(XMLRoot,this);};function objHasValue(objEl){var oCheck=objEl;if(!oCheck){return false;}return oCheck.$applyBindRule(oCheck.$mainBind,oCheck.xmlRoot,null,true);}function onafterload(){for(var name in this.elements){if(apf.isWebkit&&(!this.elements[name]||!this.elements[name].$amlLoaders)){continue;}if(this.elements[name].length){throw new Error(apf.formatErrorString(1012,this,"clearing form","Found controls without a name or with a name that isn't unique("+name+"). Please give all elements of your submitform an id: '"+name+"'"));}this.elements[name].clearError();if(this.errorEl[name]){this.errorEl[name].hide();}}if(this.nQuest){for(name in this.elements){var objEl=this.elements[name];if(objEl.getAttribute("checknext")=="true"){if(objHasValue(objEl)){objEl.setActive();if(this.condActiveCheck[name]){this.condActiveCheck[name].setActive();}}else{objEl.setInactive(true);}}else{if(objEl.tagName=="Radiogroup"&&objEl.current){objEl.current.uncheck();}}}}if(this.nQuest&&this.xmlRoot.childNodes.length>0){var element=this.nQuest.getAttribute("final"),amlNode=self[element].$aml;if(amlNode&&!apf.getBoundValue(amlNode,this.xmlRoot)){var fNextQNode=apf.xmldb.selectSingleNode(".//node()[@checknext='true']",this.$aml);if(!fNextQNode){return;}self[fNextQNode.getAttribute("id")].dispatchEvent("afterchange");}}}this.addEventListener("afterload",onafterload);this.addEventListener("afterinsert",onafterload);this.addEventListener("beforeload",function(){if(!this.smartBinding||!this.smartBinding.actions){return;}var nodes=this.smartBinding.actions.LoadList;if(nodes){for(var objEl,i=0;i<nodes.length;i++){if(!nodes[i].getAttribute("element")||!(objEl=this.elements[nodes[i].getAttribute("element")])){continue;}objEl.clear();}}var nodes=this.smartBinding.actions.NextQuestion;if(nodes){for(var objEl,i=0;i<nodes.length;i++){if(!nodes[i].getAttribute("final")||!(objEl=this.elements[nodes[i].getAttribute("element")])){continue;}objEl.clear();}}});this.implement(apf.GuiElement);this.addOther=function(tagName,oAml){if(tagName=="loadstate"){var htmlNode=apf.getFirstElement(oAml);this.loadState=apf.insertHtmlNode(htmlNode,this.$int);this.loadState.style.display="none";}};this.$draw=function(){this.oPages=this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);this.$ext.host=this;};this.submit=function(submissionId){if(!this.isValid()){return;}if(!this.$model){return;}var type=this.method=="urlencoded-post"?"native":(this.type||"xml");var instruction=submissionId||this.action?((this.method.match(/post/)?"url.post:":"")+this.action):"";this.$model.submit(instruction,type,this.useComponents,this.ref);};this.setModel=function(model,xpath){this.$model=model;};this.$loadAml=function(x){this.testing=x.getAttribute("testing")=="true";this.action=this.getAttribute("action");this.ref=this.getAttribute("ref");this.type=this.getAttribute("submittype")||"native";this.method=(this.getAttribute("method")||"get").toLowerCase();this.useComponents=this.getAttribute("usecomponents")||true;apf.setModel(x.getAttribute("model"),this);this.$loadChildren(function(xmlPage){this.validation=xmlPage.getAttribute("validation")||"true";this.invalidmsg=xmlPage.getAttribute("invalidmsg");});};}).call(apf.submitform.prototype=new apf.StandardBinding());apf.xforms.prototype=apf.submitform.prototype;apf.aml.setElement("xforms",apf.xforms);apf.aml.setElement("submitform",apf.submitform);apf.notifier=function(c,a){this.$init(a||"notifier",apf.NODE_VISIBLE,c);};(function(){this.timeout=2000;this.position="top-right";this.columnsize=300;this.arrange="vertical";this.margin="10 10 10 10";this.lastPos=null;this.showing=0;this.sign=1;this.$supportedProperties.push("margin","position","timeout","columnsize","arrange");this.$propHandlers.position=function(d){this.lastPos=null;};this.$propHandlers.margin=function(d){this.margin=d;};this.$propHandlers.timeout=function(d){this.timeout=parseInt(d)*1000;};function c(){return[document.documentElement.scrollTop||document.body.scrollTop,document.documentElement.scrollLeft||document.body.scrollLeft];}function a(d,j,o,m,i,n){var l=c();return[(d[0]=="top"?n[0]:(d[0]=="bottom"?j-m-n[2]:j/2-m/2))+l[0],(d[1]=="left"?n[3]:(d[1]=="right"?o-i-n[1]:o/2-i/2))+l[1]];}this.popup=function(o,B,C){if(!this.$ext){return;}this.$ext.style.width=this.columnsize+"px";var j=this,z=this.$pHtmlNode.appendChild(this.$ext.cloneNode(true)),E=apf.isIE?document.documentElement.offsetWidth:window.innerWidth,m=apf.isIE?document.documentElement.offsetHeight:window.innerHeight,A=false,s=this.$getLayoutNode("notification","icon",z),i=this.$getLayoutNode("notification","body",z);this.showing++;if(s&&B){if(s.nodeType==1){s.style.backgroundImage="url("+this.iconPath+B+")";}else{s.nodeValue=this.iconPath+B;}this.$setStyleClass(z,this.$baseCSSname+"ShowIcon");}i.insertAdjacentHTML("beforeend",o||"[No message]");z.style.display="block";var t=apf.getBox(this.margin||"0"),l=z.offsetHeight,D=z.offsetWidth,n=this.position.split("-"),q=false;if(n[1]=="top"||n[1]=="bottom"||n[0]=="left"||n[0]=="right"){n=[n[1],n[0]];}if((n[0]=="center"&&n[1]!=="center")||(n[0]!=="center"&&n[1]=="center")){n=["top","right"];}if(!this.lastPos){this.lastPos=a(n,m,E,l,D,t);this.sign=1;q=true;}if((!q&&n[0]=="bottom"&&this.sign==1)||(n[0]=="top"&&this.sign==-1)){if(this.arrange=="vertical"){this.lastPos[0]+=n[1]=="center"?0:this.sign*(n[0]=="top"?t[0]+l:(n[0]=="bottom"?-t[2]-l:0));}else{this.lastPos[1]+=n[0]=="center"?0:this.sign*(n[1]=="left"?t[3]+D:(n[1]=="right"?-t[1]-D:0));}}var d=c();if(this.lastPos[0]>m+d[0]-l||this.lastPos[0]<d[0]){this.lastPos[1]+=(n[1]=="left"?D+t[3]:(n[1]=="right"?-D-t[3]:0));this.sign*=-1;this.lastPos[0]+=this.sign*(n[0]=="top"?t[0]+l:(n[0]=="bottom"?-t[2]-l:0));}else{if(this.lastPos[1]>E+d[1]-D||this.lastPos[1]<d[1]){this.lastPos[0]+=(n[0]=="top"?l+t[0]:(n[0]=="bottom"?-l-t[0]:0));this.sign*=-1;this.lastPos[1]+=n[0]=="center"?0:this.sign*(n[1]=="left"?t[3]+D:(n[1]=="right"?-t[1]-D:0));}}if(this.lastPos){if((this.lastPos[0]>m+d[0]-l||this.lastPos[0]<d[1])&&this.arrange=="horizontal"){this.lastPos=a(n,m,E,l,D,t);this.sign=1;}if((this.lastPos[1]>E+d[1]-D||this.lastPos[1]<d[1])&&this.arrange=="vertical"){this.lastPos=a(n,m,E,l,D,t);this.sign=1;}}z.style.left=this.lastPos[1]+"px";z.style.top=this.lastPos[0]+"px";if((n[0]=="top"&&this.sign==1)||(n[0]=="bottom"&&this.sign==-1)){if(this.arrange=="vertical"){this.lastPos[0]+=n[1]=="center"?0:this.sign*(n[0]=="top"?t[0]+l:(n[0]=="bottom"?-t[2]-l:0));}else{this.lastPos[1]+=n[0]=="center"?0:this.sign*(n[1]=="left"?t[3]+D:(n[1]=="right"?-t[1]-D:0));}}var u=false;apf.tween.css(z,"fade",{anim:apf.tween.NORMAL,steps:10,interval:10,onfinish:function(F){z.style.filter="";$setTimeout(w,j.timeout);}});function w(){if(u){return;}apf.tween.css(z,"notifier_hidden",{anim:apf.tween.NORMAL,steps:10,interval:20,onfinish:function(F){apf.setStyleClass(z,"",["notifier_hover"]);if(u){return;}if(z.parentNode){if(z.parentNode.removeChild(z)&&!A){j.showing--;A=true;}}if(j.showing==0){this.lastPos=null;}}});}z.onmouseover=function(G){G=(G||event);var F=G.explicitOriginalTarget||G.toElement;if(u){return;}if(F==z||apf.isChildOf(z,F)){apf.tween.css(z,"notifier_hover",{anim:apf.tween.NORMAL,steps:10,interval:20,onfinish:function(I){apf.setStyleClass(z,"",["notifier_shown"]);}});u=true;}};z.onmouseout=function(G){G=(G||event);var F=G.explicitOriginalTarget||G.toElement;if(!u){return;}if(apf.isChildOf(F,z)||(!apf.isChildOf(z,F)&&z!==F)){u=false;w();}};if(C){z.onclick=function(){C.dispatchEvent("click");};}};this.$draw=function(){this.$pHtmlNode=document.body;this.$ext=this.$getExternal("notification");this.$ext.style.display="none";this.$ext.style.position="absolute";this.$ext.style.zIndex=100000;};}).call(apf.notifier.prototype=new apf.Presentation());apf.aml.setElement("notifier",apf.notifier);apf.aml.setElement("event",apf.event);apf.BindingDndRule=function(c,a){this.$init(a,apf.NODE_HIDDEN,c);};(function(){this.compile=function(c){if(!this[c]){return;}var a;if(c=="value"){a=apf.lm.compile(this[c],{xpathmode:3});}else{if(c=="match"){a=apf.lm.compile(this[c],{xpathmode:3,injectself:true});}else{if(c=="target"){a=apf.lm.compile(this[c],{xpathmode:2,injectself:true});}else{if(c=="action"){a=apf.lm.compile(this[c],{nostring:true});}else{if(c=="copy"){a=apf.lm.compile(this[c],{withopt:true,nostring:true});}else{throw new Error("Missing property handler for compile");}}}}}return(this["c"+c]=a);};this.$attrExcludePropBind=apf.extend({target:1,parent:1,action:1,dragcopy:1},this.$attrExcludePropBind);this.$propHandlers.target=this.$propHandlers.parent=this.$propHandlers.action=this.$propHandlers.dragcopy=function(a,c){delete this["c"+c];};this.$noderegister=function(a){apf.GuiElement.propHandlers.drop.call(a.amlNode,true);};this.addEventListener("DOMNodeInsertedIntoDocument",function(j){var d=this;while(d&&d.$bindingRule){d=d.parentNode;}if(!d){return;}if(d.localName=="bindings"){d.addEventListener("noderegister",this.$noderegister);var a=d.$amlNodes;for(var c=0;c<a.length;c++){apf.GuiElement.propHandlers.drop.call(a[c],true);}}else{apf.GuiElement.propHandlers.drop.call(d,true);}});}).call(apf.BindingDndRule.prototype=new apf.BindingRule());apf.aml.setElement("drag",apf.BindingDndRule);apf.aml.setElement("drop",apf.BindingDndRule);apf.toolbar=function(c,a){this.$init(a||"toolbar",apf.NODE_VISIBLE,c);};(function(){this.$focussable=false;this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);};}).call(apf.toolbar.prototype=new apf.Presentation());apf.aml.setElement("toolbar",apf.toolbar);apf.colorpicker=function(c,a){this.$init(a||"colorpicker",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.StandardBinding,apf.DataAction);this.$focussable=true;this.setValue=function(u,t){if(!t){t="RGBHEX";}var s;switch(t){case"HSL":this.fill(u[0],u[1],u[2]);break;case"RGB":s=i(u[0],u[1],u[2]);this.fill(s[0],s[1],s[2]);break;case"RGBHEX":var q=arguments[0].match(/(..)(..)(..)/);s=i(Math.hexToDec(q[0]),Math.hexToDec(q[1]),Math.hexToDec(q[2]));this.fill(s[0],s[1],s[2]);break;}};this.getValue=function(q){return a(d,o,c);};var c=120,o=239,d=0,j="#FF0000",n=240;function a(t,s,q){return l(t/(n-1),s/n,Math.min(q/n,1));}function i(z,w,C){var t=255,s=n,u=(s*2/3),A=Math.max(Math.max(z,w),C),q=Math.min(Math.min(z,w),C);L=(((A+q)*s)+t)/(2*t);if(A==q){S=0;H=u;}else{if(L<=(s/2)){S=(((A-q)*s)+((A+q)/2))/(A+q);}else{S=(((A-q)*s)+((2*t-A-q)/2))/(2*t-A-q);}Rdelta=(((A-z)*(s/6))+((A-q)/2))/(A-q);Gdelta=(((A-w)*(s/6))+((A-q)/2))/(A-q);Bdelta=(((A-C)*(s/6))+((A-q)/2))/(A-q);if(z==A){H=Bdelta-Gdelta;}else{if(w==A){H=(s/3)+Rdelta-Bdelta;}else{H=((2*s)/3)+Gdelta-Rdelta;}}if(H<0){H+=s;}if(H>s){H-=s;}}return[H,S,L];}function m(s){var q;if(s<0){s=s+1;}else{if(s>1){s=s-1;}}if(6*s<1){q=M1+(M2-M1)*s*6;}else{if(2*s<1){q=M2;}else{if(3*s<2){q=M1+(M2-M1)*(2/3-s)*6;}else{q=M1;}}}return Math.max(Math.floor(255*q),0);}function l(t,s,q){var w,u,z;if(s==0){u=z=w=Math.round(255*q);}else{M2=(q<=0.5)?(q*(1+s)):(q+s-q*s);M1=2*q-M2;w=m(t+1/3);u=m(t);z=m(t-1/3);}return Math.decToHex(w)+""+Math.decToHex(u)+""+Math.decToHex(z);}this.fill=function(w,u,s){var t=a(w,u,s);this.value=t;var q=t.match(/(..)(..)(..)/);this.tbRed.value=Math.hexToDec(q[1]);this.tbGreen.value=Math.hexToDec(q[2]);this.tbBlue.value=Math.hexToDec(q[3]);this.tbHue.value=Math.round(w);this.tbSatern.value=Math.round(u);this.tbLuminance.value=Math.round(s);this.tbHexColor.value=t;this.shower.style.backgroundColor=t;var z=a(w,u,120);this.bar1.style.backgroundColor=z;this.bgBar1.style.backgroundColor=a(w,u,240);this.bar2.style.backgroundColor=a(w,u,0);this.bgBar2.style.backgroundColor=z;};this.movePointer=function(s){s=s||event;var q=this.pHolder.ty;if((s.clientY-q>=0)&&(s.clientY-q<=this.pHolder.offsetHeight-this.pointer.offsetHeight+22)){this.pointer.style.top=s.clientY-q;}if(s.clientY-q<21){this.pointer.style.top=21;}if(s.clientY-q>this.pHolder.offsetHeight-this.pointer.offsetHeight+19){this.pointer.style.top=this.pHolder.offsetHeight-this.pointer.offsetHeight+19;}c=(255-(this.pointer.offsetTop-22))/2.56*2.4;this.fill(d,o,c);s.returnValue=false;s.cancelBubble=true;};this.setLogic=function(){var q=this;this.pHolder.style.zIndex=10;this.pHolder.onmousedown=function(){this.ty=apf.getAbsolutePosition(this)[1]-20;q.movePointer();document.onmousemove=q.movePointer;document.onmouseup=function(){this.onmousemove=function(){};};};this.container.onmousedown=function(s){s=s||event;this.active=true;if(s.srcElement==this){if(s.offsetX>=0&&s.offsetX<=256&&s.offsetY>=0&&s.offsetY<=256){o=(256-s.offsetY)/2.56*2.4;d=s.offsetX/2.56*2.39;}q.fill(d,o,c);q.shower.style.backgroundColor=q.currentColor;}q.point.style.display="none";s.cancelBubble=true;};this.container.onmouseup=function(s){s=s||event;this.active=false;q.point.style.top=s.offsetY-q.point.offsetHeight-2;q.point.style.left=s.offsetX-q.point.offsetWidth-2;q.point.style.display="block";q.change(q.tbHexColor.value);};this.container.onmousemove=function(s){s=s||event;if(this.active){if(s.offsetX>=0&&s.offsetX<=256&&s.offsetY>=0&&s.offsetY<=256){o=(256-s.offsetY)/2.56*2.4;d=s.offsetX/2.56*2.39;}q.fill(d,o,c);q.shower.style.backgroundColor=q.currentColor;}};};this.$mainBind="color";this.$draw=function(t,s){this.$ext=this.$getExternal();this.tbRed=this.$getLayoutNode("main","red",this.$ext);this.tbGreen=this.$getLayoutNode("main","green",this.$ext);this.tbBlue=this.$getLayoutNode("main","blue",this.$ext);this.tbHue=this.$getLayoutNode("main","hue",this.$ext);this.tbSatern=this.$getLayoutNode("main","satern",this.$ext);this.tbLuminance=this.$getLayoutNode("main","luminance",this.$ext);this.tbHexColor=this.$getLayoutNode("main","hex",this.$ext);var q=this;this.tbHexColor.onchange=function(){q.setValue(this.value,"RGBHEX");};this.shower=this.$getLayoutNode("main","shower",this.$ext);this.bar1=this.$getLayoutNode("main","bar1",this.$ext);this.bgBar1=this.$getLayoutNode("main","bgbar1",this.$ext);this.bar2=this.$getLayoutNode("main","bar2",this.$ext);this.bgBar2=this.$getLayoutNode("main","bgbar2",this.$ext);this.pHolder=this.$getLayoutNode("main","pholder",this.$ext);this.pointer=this.$getLayoutNode("main","pointer",this.$ext);this.container=this.$getLayoutNode("main","container",this.$ext);this.point=this.$getLayoutNode("main","point",this.$ext);var u=this.$ext.getElementsByTagName("input");for(var w=0;w<u.length;w++){u[w].onselectstart=function(z){z=z||event;z.cancelBubble=true;};}this.setLogic();this.setValue("ffffff");};this.$loadAml=function(q){if(q.getAttribute("color")){this.setValue(q.getAttribute("color"));}};this.$destroy=function(){this.container.host=this.tbRed.host=this.tbGreen.host=this.tbBlue.host=this.tbHexColor.host=this.pHolder.host=null;};}).call(apf.colorpicker.prototype=new apf.GuiElement());apf.aml.setElement("colorpicker",apf.colorpicker);apf.divider=function(c,a){this.$init(a||"divider",apf.NODE_VISIBLE,c);};(function(){this.$focussable=false;this.addEventListener("AMLReparent",function(a,d,c){if(!this.$amlLoaded){return;}if(!c&&this.skinName!=d.skinName){this.loadAml();}});this.show=function(){this.$ext.style.display="block";};this.hide=function(){this.$ext.style.display="none";};this.$canLeechSkin=true;this.$loadAml=function(a){this.$aml=a;if(this.$isLeechingSkin){this.$ext=apf.insertHtmlNode(this.parentNode.$getLayoutNode("divider"),this.$pHtmlNode);}else{this.$ext=this.$getExternal("main");}};}).call(apf.divider.prototype=new apf.Presentation);apf.aml.setElement("divider",apf.divider);apf.hbox=function(c,a){this.$init(a||"hbox",apf.NODE_VISIBLE,c);};apf.vbox=function(c,a){this.$init(a||"vbox",apf.NODE_VISIBLE,c);};(function(){this.$focussable=false;this.addEventListener("AMLRemoveChild",function(c,a){if(a){return;}if(c.disableAlignment){c.disableAlignment();}if(c.enableAnchoring){c.enableAnchoring();}});this.addEventListener("AMLInsert",function(c,d,a){if(a){return;}if(!c.hasFeature(apf.__ALIGNMENT__)){c.implement(apf.Alignment);if(c.hasFeature(apf.__ANCHORING__)){c.$disableAnchoring();}}c.enableAlignment();});this.addEventListener("AMLReparent",function(i,d,c,a){if(c){return;}if(a==this.$ext){d.$int.insertBefofore(document.createElement("div"),i&&i.$ext||null);}});this.addEventListener("AMLRemove",function(a){if(!a){if(this.$pHtmlNode!=this.$ext&&this.$ext.parentNode){this.$ext.parentNode.removeChild(this.$ext);}}});this.$draw=function(){this.$isParentOfChain=true;
/*this.parentNode.localName 
          || "vbox|hbox".indexOf(this.parentNode.localName) == -1;*/
if(this.$isParentOfChain){this.$int=this.$ext=this.$pHtmlNode.appendChild(document.createElement("div"));this.$int.style.minHeight="1px";this.$int.style.marginTop="-1px";if("absolute|relative".indexOf(apf.getStyle(this.$int,"position"))==-1){this.$int.style.position="relative";}this.$int.style.overflow="visible";}};this.$loadAml=function(d){var i=apf.layout.get(this.$int||this.$pHtmlNode,apf.getBox(this.margin||"")),j=apf.layout.parseXml(this,i,null,true);if(this.$isParentOfChain){this.pData=j;i.root=this.pData;if(this.childNodes.length){apf.layout.queue(this.$int||this.$pHtmlNode,null,i.root);}if(!this.$int.offsetHeight&&!this.$int.offsetWidth){var c=this;function a(o,l,q){if(apf.isTrue(q)&&(c.$ext.offsetHeight||c.$ext.offsetWidth)){apf.layout.queue(c.$int,null,i.root);var s=c;while(s){if(s.unwatch){s.unwatch("visible",a);}s=s.parentNode;}}}this.watch("visible",a);var n=this.parentNode;while(n){if(n.watch){n.watch("visible",a);}n=n.parentNode;}return;}}else{var m=this.parentNode.aData||this.parentNode.pData;this.aData=j;this.aData.stackId=m.children.push(this.aData)-1;this.aData.parent=m;}};}).call(apf.vbox.prototype=new apf.GuiElement());apf.hbox.prototype=apf.vbox.prototype;apf.aml.setElement("hbox",apf.hbox);apf.aml.setElement("vbox",apf.vbox);apf.browser=function(c,a){this.$init(a||"browser",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction,apf.StandardBinding);this.$supportedProperties.push("value","src");this.$propHandlers.src=this.$propHandlers.value=function(value,force){try{this.$int.src=value||"about:blank";}catch(e){this.$int.src="about:blank";}};this.getValue=function(){return this.value||this.src;};this.getURL=function(){return this.$int.src;};this.back=function(){this.$int.contentWindow.history.back();};this.forward=function(){this.$int.contentWindow.history.forward();};this.reload=function(){this.$int.src=this.$int.src;};this.print=function(){this.$int.contentWindow.print();};this.runCode=function(str,noError){if(noError){try{this.$int.contentWindow.eval(str);}catch(e){}}else{this.$int.contentWindow.eval(str);}};this.$draw=function(parentNode){if(!parentNode){parentNode=this.$pHtmlNode;}if(apf.cannotSizeIframe){this.$ext=parentNode.appendChild(document.createElement("DIV")).appendChild(document.createElement("<iframe frameborder='0'></iframe>")).parentNode;this.$ext.style.width="100px";this.$ext.style.height="100px";this.$int=this.$ext.firstChild;this.$int.style.width="100%";this.$int.style.height="100%";this.$int.frameBorder=0;}else{this.$ext=parentNode.appendChild(document.createElement("iframe"));this.$ext.style.width="100px";this.$ext.style.height="100px";this.$int=this.$ext;}this.$ext.host=this;};}).call(apf.browser.prototype=new apf.GuiElement());apf.aml.setElement("browser",apf.browser);apf.accordion=function(c,a){this.$init(a||"accordion",apf.NODE_VISIBLE,c);this.$animtype1=apf.tween.NORMAL;this.$animtype2=apf.tween.NORMAL;this.animdelay=10;this.hoverdelay=500;this.multiexpand=true;this.expand="click";this.startexpanded=true;this.$animStep={};this.$animStep[apf.tween.NORMAL]=5;this.$animStep[apf.tween.EASEIN]=10;this.$animStep[apf.tween.EASEOUT]=10;this.bars={};this.hoverTimer=null;this.startExpanded=0;this.$focussable=false;this.animType={normal:apf.tween.NORMAL,easein:apf.tween.EASEIN,easeout:apf.tween.EASEOUT,none:"none"};this.lastOpened=[];this.inprogress=false;};(function(){this.$booleanProperties.multiexpand=true;this.$booleanProperties.startexpanded=true;this.$supportedProperties.push("animtype","animdelay","multiexpand","expand","startexpanded");this.addEventListener("AMLRemoveChild",function(c,a){if(a){return;}});this.addEventListener("AMLInsert",this.insertChild=function(d,a,c){if(d.tagName!="bar"){return;}d.$propHandlers.icon=function(i){var j=this.$getLayoutNode("bar","icon",this.$ext);if(!j){return;}if(j.tagName=="img"){j.setAttribute("src",i?this.iconPath+i:"");}else{j.style.backgroundImage=i?"url("+this.iconPath+i+")":"";}};});this.$propHandlers.animtype=function(a){a=a.split(" ");if(a[0]){this.$animtype1=this.animType[a[0]];}if(a[1]){this.$animtype2=this.animType[a[1]];}};this.$propHandlers.animdelay=function(a){this.animdelay=parseInt(a);};this.slideToggle=function(a){if(!this.bars[a]){return;}if(this.bars[a].opened){this.slideUp(a);}else{this.slideDown(a);}};this.slideDown=function(m){var i=null;if(!this.bars[m]||this.inprogress){return;}this.inprogress=true;var j=this.bars[m];j.htmlBody.style.display="block";if(!this.multiexpand&&this.lastOpened.length>0){var c=this.lastOpened.shift();if(c!==m){i=c;}}this.lastOpened.push(m);this.$setStyleClass(j.htmlNode,"active");if(this.$dir=="vertical"){if(j.htmlBody.scrollHeight<2){var l;clearInterval(l);l=setInterval(function(){if(j.htmlBody.scrollHeight>0){a.slideDown(j.htmlTitle.id);clearInterval(l);}},100);}j.htmlBody.style.height="1px";}if(this.$animtype1=="none"){if(i){var d=this.bars[i];this.$setStyleClass(d.htmlNode,"",["active"]);d.htmlBody.style.display="none";if(this.$dir=="horizontal"){d.htmlBody.style.width="auto";}}if(this.$dir=="horizontal"){j.htmlBody.style.width="auto";}this.bars[m].opened=true;this.inprogress=false;}else{var a=this;if(i){var d=this.bars[i];this.$setStyleClass(d.htmlNode,"",["active"]);apf.tween.multi(j.htmlBody,{steps:this.$animStep[this.$animtype1],anim:this.$animtype1,interval:this.animdelay,tweens:[{type:this.$dir=="vertical"?"scrollheight":"scrollwidth",from:0,to:this.$dir=="vertical"?j.htmlBody.scrollHeight:j.htmlBody.scrollWidth},{type:this.$dir=="vertical"?"scrollheight":"scrollwidth",from:this.$dir=="vertical"?d.htmlBody.scrollHeight:d.htmlBody.scrollWidth,to:0,oHtml:d.htmlBody}],onfinish:function(){a.$setStyleClass(j.htmlNode,"active",[""]);if(a.$dir=="horizontal"){j.htmlBody.style.width="auto";}a.bars[m].opened=true;a.$setStyleClass(d.htmlNode,"",["active"]);d.htmlBody.style.display="none";if(a.$dir=="horizontal"){d.htmlBody.style.width="auto";}a.bars[i].opened=false;a.inprogress=false;}});}else{apf.tween.single(j.htmlBody,{steps:this.$animStep[this.$animtype1],type:this.$dir=="vertical"?"scrollheight":"scrollwidth",from:0,to:this.$dir=="vertical"?j.htmlBody.scrollHeight:j.htmlBody.scrollWidth,anim:this.$animtype1,interval:this.animdelay,onfinish:function(){a.$setStyleClass(j.htmlNode,"active",[""]);if(a.$dir=="horizontal"){j.htmlBody.style.width="auto";}a.bars[m].opened=true;a.inprogress=false;}});}}};this.slideUp=function(d){if(!this.bars[d]||this.inprogress){return;}this.inprogress=true;var c=this.bars[d];apf.setStyleClass(c.htmlNode,"",["active"]);if(this.$animtype2=="none"){c.htmlBody.style.display="none";if(this.$dir=="horizontal"){c.htmlBody.style.width="auto";}this.bars[d].opened=false;this.inprogress=false;}else{var a=this;apf.tween.single(c.htmlBody,{steps:this.$animStep[this.$animtype2],type:this.$dir=="vertical"?"scrollheight":"scrollwidth",from:this.$dir=="vertical"?c.htmlBody.scrollHeight:c.htmlBody.scrollWidth,to:0,anim:this.$animtype2,interval:this.animdelay,onfinish:function(){a.$setStyleClass(c.htmlNode,"",["active"]);c.htmlBody.style.display="none";if(a.$dir=="horizontal"){c.htmlBody.style.width="auto";}a.bars[d].opened=false;a.inprogress=false;}});}return false;};this.$getbarIdByNumber=function(c){var a=1;for(var d in this.bars){if(a++==c){return d;}}return null;};this.$draw=function(){this.$ext=this.$getExternal("main");this.$int=this.$getLayoutNode("main","container",this.$ext);this.$dir=this.$getOption("main","direction")||"vertical";var c=this.childNodes;var n=c.length;var d;var o=this;var m=0;var l=0;var a=[];for(var j=0;j<n;j++){d=c[j];if((d.tagName||"").indexOf("a:bar")>-1&&!d.$amlLoaded){m++;d.addEventListener("DOMNodeInsertedIntoDocument",function(G){l++;var M=o.$ext.lastChild;var A=G.currentTarget;var K;var u;var C;var w;var E=(A.getAttribute("expanded")?(A.getAttribute("expanded")=="true"?true:false):false);var t=M.childNodes;var B=t.length;for(var F=0;F<B;F++){if((t[F].className||"").indexOf("body")>-1){w=t[F];}if((t[F].className||"").indexOf("title")>-1){u=t[F];}var s=t[F].childNodes;var z=s.length;for(var D=0;D<z;D++){if((s[D].className||"").indexOf("icon")>-1){C=s[D];}if(((s[D].tagName||"").toLowerCase()).indexOf("span")>-1){K=s[D];}}}if(!u&&!w){return;}apf.setUniqueHtmlId(u);apf.setUniqueHtmlId(w);var N=A.getAttribute("title");if(N){K.innerHTML=N;}var J=A.getAttribute("icon");if(J){C.style.backgroundImage="url("+this.iconPath+J+")";}if(o.expand=="click"){u.onmousedown=function(i){o.slideToggle(this.id);};}else{if(this.expand=="hover"){u.onmouseover=function(i){(i||event).cancelBubble=true;var O=this.id;clearInterval(o.hoverTimer);o.hoverTimer=setInterval(function(){o.slideToggle(O);clearInterval(o.hoverTimer);},o.hoverdelay);};C.onmouseover=function(i){(i||event).cancelBubble=true;var O=(i.srcElement||i.target).parentNode.id;clearInterval(o.hoverTimer);o.hoverTimer=setInterval(function(){o.slideToggle(O);clearInterval(o.hoverTimer);},o.hoverdelay);};}}o.bars[u.id]={amlNode:A,htmlNode:M,opened:false,htmlTitle:u,htmlBody:w,htmlIcon:C};if((E||o.startexpanded)&&(o.multiexpand||o.startExpanded==0)){a.push(u.id);o.startExpanded++;}if(l==m){o.oEnding=o.$getExternal("ending");var I=o.$getLayoutNode("ending","container",o.oEnding);o.$int.appendChild(I);}});}}var q=null;clearInterval(q);q=setInterval(function(){if(l==m){for(var s=0;s<a.length;s++){var t=a.pop();o.slideDown(t);}clearInterval(q);}},50);};this.$loadAml=function(a){};this.$destroy=function(){};}).call(apf.accordion.prototype=new apf.Presentation());apf.aml.setElement("accordion",apf.accordion);apf.event=function(c,a){this.$init(a||"event",apf.NODE_HIDDEN,c);};(function(){this.$hasInitedWhen=false;this.$booleanProperties.repeat=true;this.$supportedProperties.push("when","message","icon","repeat");this.$propHandlers.when=function(c){if(this.$hasInitedWhen&&c&&this.parentNode&&this.parentNode.popup){var a=this;$setTimeout(function(){a.parentNode.popup(a.message,a.icon,a);});}this.$hasInitedWhen=true;if(this.repeat){delete this.when;}};this.$loadAml=function(a){};}).call(apf.event.prototype=new apf.AmlElement());apf.aml.setElement("event",apf.event);apf.source=function(c,a){this.$init(a||"source",apf.NODE_HIDDEN,c);};(function(){this.$supportedProperties.push("src","type");this.addEventListener("DOMNodeInsertedIntoDocument",function(a){if(this.parentNode.$addSource){this.parentNode.$addSource(this);}});}).call(apf.source.prototype=new apf.AmlElement());apf.aml.setElement("source",apf.source);apf.flashplayer=function(c,a){this.$init(a||"flashplayer",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction,apf.StandardBinding);this.setValue=function(a){this.setProperty("value",a,false,true);};this.$supportedProperties.push("value");this.$propHandlers.value=function(a){this.setSource(a);};this.$draw=function(){this.$ext=this.$int=this.$pHtmlNode.appendChild(document.createElement("div"));this.$ext.onclick=function(){this.host.dispatchEvent("click");};var a=this.getAttribute("src")||"";this.$ext.insertAdjacentHTML("beforeend",'<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"               codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0"               width="100%"               height="100%"               align="middle">                <param name="allowScriptAccess" value="sameDomain" />                <param name="allowFullScreen" value="false" />                <param name="movie" value="'+a+'" />                <param name="play" value="true" />                <param name="menu" value="false" />                <param name="quality" value="high" />                <param name="wmode" value="transparent" />                <param name="bgcolor" value="#ffffff" />                <embed src="'+a+'" play="true" menu="false"                   quality="high" wmode="transparent" bgcolor="#ffffff" width="100%"                   height="100%" align="middle" allowScriptAccess="sameDomain"                   allowFullScreen="false" type="application/x-shockwave-flash"                   pluginspage="http://www.macromedia.com/go/getflashplayer" />            </object>');};this.$loadAml=function(a){};}).call(apf.flashplayer.prototype=new apf.GuiElement());apf.aml.setElement("flashplayer",apf.flashplayer);apf.BindingSeriesRule=function(c,a){this.$init(a||"series",apf.NODE_HIDDEN,c);};(function(){this.$attrExcludePropBind=apf.extend({formula:1},this.$attrExcludePropBind);this.$propHandlers.formula=function(a,c){delete this["c"+c];};}).call(apf.BindingSeriesRule.prototype=new apf.BindingRule());apf.aml.setElement("series",apf.BindingSeriesRule);apf.defaults=function(c,a){this.$init(a||"services",apf.NODE_HIDDEN,c);};(function(){this.$parsePrio="002";this.$propHandlers["for"]=function(a){if(this.$lastFor){apf.nameserver.remove("defaults_"+this.$lastFor,this);}apf.nameserver.add("defaults_"+a,this);this.$lastFor=a;};this.addEventListener("DOMNodeRemovedFromDocument",function(a){apf.nameserver.remove("defaults_"+this.$lastFor,this);});}).call(apf.defaults.prototype=new apf.AmlElement());apf.aml.setElement("defaults",apf.defaults);apf.iconmap=function(){this.$init("iconmap",apf.NODE_HIDDEN);};(function(){this.$parsePrio="050";this.addEventListener("DOMNodeInsertedIntoDocument",function(a){apf.skins.addIconMap({name:this.id,src:this.src,type:this.type,size:parseInt(this.size),width:parseInt(this.width),height:parseInt(this.height),offset:(this.offset||"0,0").splitSafe(",")});});}).call(apf.iconmap.prototype=new apf.AmlElement());apf.aml.setElement("iconmap",apf.iconmap);apf.progress=function(c,a){this.$init(a||"progress",apf.NODE_VISIBLE,c);};apf.progressbar=function(c,a){this.$init(a||"progressbar",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction);this.$focussable=false;this.value=0;this.min=0;this.max=100;this.$running=false;this.$timer;this.$booleanProperties.autostart=true;this.$booleanProperties.autohide=true;this.$supportedProperties.push("value","min","max","autostart","autohide");this.$propHandlers.value=function(a){this.value=parseInt(a)||this.min;if(this.value>=this.max){apf.setStyleClass(this.$ext,this.$baseCSSname+"Complete",[this.$baseCSSname+"Running"]);}else{apf.setStyleClass(this.$ext,this.$baseCSSname+"Running",[this.$baseCSSname+"Complete"]);}this.oSlider.style.width=(this.value*100/(this.max-this.min))+"%";this.oCaption.nodeValue=Math.round((this.value/(this.max-this.min))*100)+"%";};this.$propHandlers.min=function(a){this.min=parseFloat(a);};this.$propHandlers.max=function(a){this.max=parseFloat(a);};this.setValue=function(a){this.setProperty("value",a,false,true);};this.getValue=function(){return this.value;};this.clear=function(){this.$clear();};this.$clear=function(c,d){clearInterval(this.$timer);this.setValue(this.min);apf.setStyleClass(this.$ext,"",[this.$baseCSSname+"Running",this.$baseCSSname+"Complete"]);if(c){var a=this;this.$timer=setInterval(function(){a.start(d);});}if(this.autohide){this.hide();}this.$running=false;};this.start=function(c){if(this.autohide){this.show();}clearInterval(this.$timer);var a=this;this.$timer=setInterval(function(){if(a.$amlDestroyed){clearInterval(a.$timer);}else{a.$step();}},c||1000);this.$setStyleClass(this.$ext,this.$baseCSSname+"Running");};this.pause=function(){clearInterval(this.$timer);};this.stop=function(c,i,d){clearInterval(this.$timer);this.setValue(this.max);var a=this;this.$timer=setInterval(function(){a.$clear(c,(d||0));},i||500);};this.$step=function(){if(this.value==this.max){return;}this.setValue(this.value+1);};this.$draw=function(c,a,i,d){this.$ext=this.$getExternal();this.oSlider=this.$getLayoutNode("main","progress",this.$ext);this.oCaption=this.$getLayoutNode("main","caption",this.$ext);};this.$loadAml=function(a){if(this.autostart){this.start();}if(this.autohide){this.hide();}};}).call(apf.progressbar.prototype=new apf.StandardBinding());apf.progress.prototype=apf.progressbar.prototype;apf.aml.setElement("progress",apf.progress);apf.aml.setElement("progressbar",apf.progressbar);apf.collection=function(c,a){this.$init(a||"collection",apf.NODE_VISIBLE,c);};apf.docklet=function(c,a){this.$init(a||"docklet",apf.NODE_VISIBLE,c);};(function(){this.$focussable=false;this.addEventListener("DOMNodeInsertedIntoDocument",function(a){if(this.parentNode&&this.parentNode.$int!=this.$pHtmlNode){this.$pHtmlNode=this.parentNode.$int;}this.$int=this.$pHtmlNode;this.$originalNodes=this.parentNode.$originalNodes;this.skinName=this.parentNode.skinName;});}).call(apf.collection.prototype=new apf.AmlElement());apf.docklet.prototype=apf.collection.prototype;apf.aml.setElement("collection",apf.collection);apf.aml.setElement("docklet",apf.docklet);apf.Chart=function(c,a){this.$init(a||"chart",apf.NODE_VISIBLE,c);};apf.aml.setElement("chart",apf.Chart);(function(){this.$timer=null;this.$animTimer=null;this.$doinit=true;this.$doresize=false;this.drawtime=10;this.anim=0;this.a=0;this.b=0;this.c=0;this.d=0;this.$supportedProperties=["anim","a","b","c","d"];this.$redraw=function(d,c){if(c){this.$doresize=true;}if(d){if(this.$timer){window.clearTimeout(this.$timer);}this.$timer=null;this.$drawChart();}else{var a=this;if(!this.$timer){this.$timer=window.setTimeout(function(){a.$timer=null;a.$drawChart();},this.drawtime);}}};this.$drawChart=function(){if(!this.childNodes){return;}if(!this.$ext.offsetHeight&&(apf.isIE||!this.$ext.offsetWidth)){return;}if(this.$doinit){this.$doinit=false;this.$doresize=false;this.$copyPos();apf.draw.initRoot(this);}else{if(this.$doresize){this.$copyPos();apf.draw.resizeRoot(this);}}for(var c,a=0;a<this.childNodes.length;a++){if((c=this.childNodes[a]).$drawAxis){c.$drawAxis(this.$doresize);}}this.$doresize=false;};this.$copyPos=function(i,a){this.left=0,this.top=0;var c,j,l=this.width!=(c=this.$ext.offsetWidth),d=this.height!=(j=this.$ext.offsetHeight);if(i){if(a){i.left=this.left+a.left,i.top=this.top+a.top;i.width=this.width-(a.left+a.right),i.height=this.height-(a.top+a.bottom);}else{i.left=this.left,i.top=this.top;i.width=this.width,i.height=this.height;}}return l||d;};this.$resize=function(){if(this.$copyPos()){this.$redraw(true,true);}};this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);var d,a,i,c,t,q=[],n=false;var l=[0,1,2,3,3],j=[1,3,2,0,0];var o=this;this.$ext.onmousedown=function(A){if(this.$doinit){return;}if(!A){A=event;}if(A.button>4||A.button<0){return;}t=(o.canvas)?j[A.button]:l[A.button];if(!t){return;}var z=A.shiftKey?1:0+A.ctrlKey?2:0+A.altKey?4:0;var B=apf.getAbsolutePosition(o.$ext,document.documentElement);i=A.clientX-B[0]+document.documentElement.scrollLeft,c=A.clientY-B[1]+document.documentElement.scrollTop;d=i,a=c;for(var w,u=o.childNodes.length-1;u>=0;u--){w=o.childNodes[u];if(d>=w.left&&d<=w.left+w.width&&a>=w.top&&a<=w.top+w.height){if(w.$mouseDown){w.$mouseDown(d-w.left,a-w.top,t,z);q.push(w);}}}s=false;};this.$ext.oncontextmenu=function(){return false;};this.$ext.onselectstart=function(){return false;};var s;this.addEventListener("contextmenu",function(u){if(s){u.cancelBubble=true;}});this.$ext.onmouseup=function(A){if(this.$doinit){return;}if(!A){A=event;}t=0;var C=apf.getAbsolutePosition(o.$ext,document.documentElement);var u=A.clientX-C[0]+document.documentElement.scrollLeft,B=A.clientY-C[1]+document.documentElement.scrollTop;for(var z,w=q.length-1;w>=0;w--){(z=q[w]).$mouseUp(u-z.left,B-z.top);}q.length=0;};this.$ext.onmousemove=function(C){if(this.$doinit){return;}if(!C){C=event;}var D=apf.getAbsolutePosition(o.$ext,document.documentElement);var w=(-i+(i=C.clientX-D[0]+document.documentElement.scrollLeft)),u=(-c+(c=C.clientY-D[1]+document.documentElement.scrollTop));var B=C.shiftKey?1:0+C.ctrlKey?2:0+C.altKey?4:0;if(t){if(t==2){s=true;}for(var A,z=q.length-1;z>=0;z--){(A=q[z]).$mouseMove(w,u,t,d-A.left,a-A.top,i-A.left,c-A.top,B);}}else{for(var A,z=o.childNodes.length-1;z>=0;z--){if((A=o.childNodes[z]).$mouseMove){A.$mouseMove(w,u,t,d-A.left,a-A.top,i-A.left,c-A.top,B);}}}};var m=function(B){if(this.$doinit){return;}if(!B){B=window.event;}var C=B.wheelDelta?(window.opera?-1:1)*B.wheelDelta/120:(B.detail?-B.detail/3:0);var A=B.shiftKey?1:0+B.ctrlKey?2:0+B.altKey?4:0;if(C){var E=apf.getAbsolutePosition(o.$ext,document.documentElement);var u=B.clientX-E[0]+document.documentElement.scrollLeft,D=B.clientY-E[1]+document.documentElement.scrollTop;for(var z,w=0;w<o.childNodes.length;w++){z=o.childNodes[w];if(u>=z.left&&u<=z.left+z.width&&D>=z.top&&D<=z.top+z.height){z.$mouseWheel(u-z.left,D-z.top,C,A);}}}if(B.preventDefault){B.preventDefault();}B.returnValue=false;};if(!apf.supportVML&&this.$ext.addEventListener){this.$ext.addEventListener("DOMMouseScroll",m,false);}this.$ext.onmousewheel=m;apf.layout.setRules(this.$ext,"resize","var o = apf.all["+this.$uniqueId+"];            if (o) o.$resize()",true);apf.layout.queue(this.$ext);};this.$loadAml=function(c){apf.draw.initDriver();if(this.anim>0){var a=this;this.$animTimer=window.setInterval(function(){a.$redraw();},this.anim);}};this.$destroy=function(){apf.layout.removeRule(this.$ext,"resize");this.$ext.onmousedown=this.$ext.oncontextmenu=this.$ext.onselectstart=this.$ext.onmouseup=this.$ext.onmousemove=this.$ext.onmousewheel=null;window.clearTimeout(this.$timer);window.clearInterval(this.$animTimer);};}).call(apf.Chart.prototype=new apf.Presentation());apf.BindingColumnRule=function(c,a){this.$init(a,apf.NODE_HIDDEN,c);this.$className="col"+this.$uniqueId;};(function(){this.$defaultwidth="100";this.$width=100;this.$sortable=true;this.$resizable=true;this.$movable=true;this.$cssInit=false;this.$propHandlers.icon=function(a,c){};this.$propHandlers.caption=function(a,c){};this.$propHandlers.width=function(a,c){if(!a){a=this.$defaultwidth;}this.$isPercentage=a&&String(a).indexOf("%")>-1;this.$width=parseFloat(a);};this.$propHandlers.options=function(a,c){this.$sortable=a.indexOf("sort")>-1;this.$resizable=a.indexOf("size")>-1;this.$movable=a.indexOf("move")>-1;};this.$propHandlers.editor=function(a,c){};this.$propHandlers.colspan=function(a,c){};this.$propHandlers.align=function(a,c){};this.$propHandlers.css=function(a,c){};this.resize=function(c,A){var s;if(this.$isPercentage){var u=c/(this.$ext.offsetWidth-(A.$widthdiff-3)),t=[],w=0,d=this.$ext.nextSibling;while(d&&d.getAttribute("hid")){s=apf.all[d.getAttribute("hid")];if(s.$isPercentage){t.push(s);w+=s.$width;}d=d.nextSibling;}var l=u*this.$width,q=l-this.$width,o=(w-q)/w;if(o<0.01){if(c<20){return;}return this.resize(c-10,A);}for(var a,m=0;m<t.length;m++){a=t[m];a.$width*=o;apf.setStyleRule("."+a.$className,"width",a.$width+"%");}this.$width=l;apf.setStyleRule("."+this.$className,"width",this.$width+"%");}else{var z=c-this.$width;this.$width=c;if(apf.isIE&&A.oIframe){this.$ext.style.width=c+"px";}else{}apf.setStyleRule("."+this.$className,"width",c+"px",null,A.oWin);A.$fixed+=z;var j=(A.$fixed+5)+"px";if(!this.$isFixedGrid){apf.setStyleRule("."+A.$baseCSSname+" .row"+A.$uniqueId,"paddingRight",j,null,this.oWin);apf.setStyleRule("."+A.$baseCSSname+" .row"+A.$uniqueId,"marginRight","-"+j,null,A.oWin);A.$int.style.paddingRight=A.$head.style.paddingRight=j;}}};this.hide=function(){apf.setStyleRule("."+this.$baseCSSname+" .records ."+h.$className,"visibility","hidden",null,this.oWin);};this.show=function(){apf.setStyleRule("."+this.$baseCSSname+" .records ."+h.$className,"visibility","visible",null,this.oWin);};this.sort=function(a){if(a.$lastSorted==this){apf.setStyleClass(this.$int,a.toggleSortOrder()?"ascending":"descending",["descending","ascending"]);return;}var c;if(c=a.$lastSorted){apf.setStyleRule("."+c.$className,"background","white");apf.setStyleClass(c.$int,"",["descending","ascending"]);}apf.setStyleRule("."+this.$className,"background","#f3f3f3");apf.setStyleClass(this.$int,"ascending",["descending","ascending"]);if(!a.length){return;}a.resort({order:"ascending",xpath:this.cvalue2.xpaths[1]});a.$lastSorted=this;};this.move=function(d,m){if(d&&this==d){return;}var l=this,a=apf.getChildNumber(l.$int),n=d&&apf.getChildNumber(d.$int);m.$head.insertBefore(l.$int,d&&d.$int||null);if(!m.length){return;}var o,c=m.$int.childNodes;for(var j=0;j<c.length;j++){if(m.$withContainer&&((j+1)%2)==0){continue;}o=c[j];o.insertBefore(o.childNodes[a],typeof n!="undefined"&&o.childNodes[n]||null);}};this.$draw=function(j,d,m,l){var j=j||this.parentNode;while(j.$bindingRule){j=j.parentNode;}if(!j.hasFeature(apf.__PRESENTATION__)){return;}if(m){this.$propHandlers.width.call(this,m);}apf.importStylesheet([["."+this.$className,"width:"+this.$width+(this.$isPercentage?"%;":"px;")+"text-align:"+this.align]]);j.$getNewContext("headitem");var c=j.$getLayoutNode("headitem");c.setAttribute("class",this.$className+(l?" "+l:""));c.setAttribute("hid",this.$uniqueId);var i=j.$getLayoutNode("headitem","caption");if(this.icon){this.$sortable=false;c.setAttribute("style","background-image:url("+apf.getAbsolutePath(j.iconPath,this.icon)+")");i.nodeValue="&nbsp;";}else{i.nodeValue=this.caption||d||"";}this.$ext=this.$int=apf.insertHtmlNode(c,j.$head||j.$int);var n=false;var a=this;this.$int.onmouseover=function(o){if(!o){o=event;}if(j.disabled){return;}apf.setStyleClass(this,"hover",["down"]);};this.$int.onmouseup=function(o){if(!o){o=event;}if(j.disabled||!apf.isChildOf(n,this,true)){return;}apf.setStyleClass(this,"hover",["down"]);if(a.$sortable){a.sort(j);}j.dispatchEvent("sortcolumn",a);};this.$int.onmousedown=function(u){if(!u){u=event;}n=target=this;if(j.disabled){return;}var A=apf.getAbsolutePosition(target),w=j.$head.scrollLeft;var z=u.clientX-A[0]+w;if(z<4||target.offsetWidth-z-8<3&&apf.getChildNumber(a.$int)<j.$headings.length-1){var D=z<4&&target.previousSibling||target;if(a.$resizable){A=apf.getAbsolutePosition(D);apf.setStyleClass(j.$pointer,"size_pointer",["move_pointer"]);j.$pointer.style.display="block";j.$pointer.style.left=(D.offsetLeft-w-1)+"px";j.$pointer.style.width=(D.offsetWidth-j.$widthdiff+1)+"px";apf.plane.show(j.$pointer,null,true);n=true;document.onmouseup=function(){if(!u){u=event;}document.onmouseup=document.onmousemove=null;apf.all[D.getAttribute("hid")].resize(j.$pointer.offsetWidth,j);n=false;j.$pointer.style.display="none";apf.plane.hide();};document.onmousemove=function(t){if(!t){t=event;}j.$pointer.style.width=Math.max(10,Math.min(j.$int.offsetWidth-j.$pointer.offsetLeft-20,t.clientX-A[0]-1+w))+"px";};return;}}apf.setStyleClass(target,"down",["hover"]);if(!a.$movable){document.onmouseup=function(t){document.onmouseup=null;n=false;};return;}apf.setStyleClass(j.$pointer,"move_pointer",["size_pointer"]);var C=u.clientX-target.offsetLeft,s=u.clientX,B=u.clientY-target.offsetTop,q=u.clientY,o;document.onmouseup=function(F){if(!F){F=event;}document.onmouseup=document.onmousemove=null;n=false;j.$pointer.style.display="none";if(!o){return;}o.style.top="-100px";var E=document.elementFromPoint(F.clientX,F.clientY);if(E.parentNode==o.parentNode){var G=apf.getAbsolutePosition(E);var t=(F.clientX-G[0]>E.offsetWidth/2?E.nextSibling:E);a.move(t?apf.all[t.getAttribute("hid")]:null,j);}apf.destroyHtmlNode(o);};document.onmousemove=function(F){if(!F){F=event;}if(!o){if(Math.abs(F.clientX-s)<3&&Math.abs(F.clientY-q)<3){return;}o=target.cloneNode(true);o.style.position="absolute";var E=apf.getWidthDiff(target);o.style.width=(target.offsetWidth-E-j.$widthdiff+2)+"px";o.style.left=target.offsetLeft;o.style.top=target.offsetTop;o.style.margin=0;o.removeAttribute("hid");apf.setStyleClass(o,"drag",["ascending","descending"]);target.parentNode.appendChild(o);}o.style.top="-100px";j.$pointer.style.display="none";var t=document.elementFromPoint(F.clientX,F.clientY);if(t.parentNode==o.parentNode){var G=apf.getAbsolutePosition(t);j.$pointer.style.left=(t.offsetLeft+((F.clientX-G[0]>t.offsetWidth/2)?t.offsetWidth-8:0))+"px";j.$pointer.style.display="block";}o.style.left=(F.clientX-C)+"px";o.style.top=(F.clientY-B)+"px";};};this.$int.onmouseout=function(o){if(!o){o=event;}if(j.disabled){return;}j.$ext.style.cursor="";apf.setStyleClass(this,"",["hover","down"]);};this.$int.onmousemove=function(s){if(n||j.disabled){return;}if(!s){s=event;}var w=apf.getAbsolutePosition(this),o=j.$head.scrollLeft;var u=s.clientX-w[0]+o;if(u<4||this.offsetWidth-u-j.$widthdiff<3&&apf.getChildNumber(a.$int)<j.$headings.length-1){var q=u<4?this.previousSibling:this;j.$ext.style.cursor=q&&a.$resizable?"w-resize":"default";}else{j.$ext.style.cursor="default";}};return this;};this.addEventListener("DOMNodeInsertedIntoDocument",function(a){this.$draw();});this.addEventListener("DOMNodeRemovedFromDocument",function(a){if(!this.$int){return;}this.$int.onmouseover=this.$int.onmouseup=this.$int.onmousedown=this.$int.onmousemove=this.$int.onmouseout=null;});}).call(apf.BindingColumnRule.prototype=new apf.BindingRule());apf.aml.setElement("column",apf.BindingColumnRule);apf.table=function(c,a){this.$init(a||"table",apf.NODE_VISIBLE,c);};(function(){var a=apf.layout;this.$focussable=false;this.$update=false;this.columns="100,*";this.padding=2;this.margin="5 5 5 5";this.cellheight=19;this.$supportedProperties.push("columns","padding","margin","cellheight","span");this.$propHandlers.columns=this.$propHandlers.padding=this.$propHandlers.margin=this.$propHandlers.cellheight=function(i){if(!this.$update&&apf.loaded){a.queue(this.$ext,this.$updateObj);}this.$update=true;};function c(){var i=this.parentNode;if(!i.$update&&apf.loaded){a.queue(i.$ext,i.$updateObj);}i.$update=true;}this.register=function(i){i.$propHandlers.width=i.$propHandlers.height=i.$propHandlers.margin=i.$propHandlers.span=this.$updateObj.updateTrigger;i.addEventListener("prop.visible",c);a.queue(this.$ext,this.$updateObj);this.$update=true;};this.unregister=function(i){i.$propHandlers.width=i.$propHandlers.height=i.$propHandlers.margin=i.$propHandlers.span=null;i.removeEventListener("prop.visible",c);a.queue(this.$ext,this.$updateObj);this.$update=true;};this.addEventListener("DOMNodeRemoved",function(j){if(this.$isWaitingOnDisplay||!this.$updateObj){return;}if(j.currentTarget==this){var i=this;while(i){i.unwatch("visible",this.$updateObj.propChange);i=i.parentNode;}}else{if(j.relatedNode==this){this.unregister(j.currentTarget);j.currentTarget.$setLayout();}}});this.addEventListener("DOMNodeInserted",function(j){if(this.$isWaitingOnDisplay||j.currentTarget!=this){return;}if(j.currentTarget==this){var i=this;while(i){i.watch("visible",this.$updateObj.propChange);i=i.parentNode;}}else{if(j.relatedNode==this&&!j.$moveWithinParent){j.currentTarget.$setLayout("table");}}});function d(j,i){return typeof j=="string"?j.replace(apf.percentageMatch,"(("+i+" * $1)/100)"):j;}this.$isWaitingOnDisplay=false;this.$updateTable=function(){if(!this.$update){return;}if(!this.$ext.offsetWidth){this.$isWaitingOnDisplay=true;this.watch("visible",this.$updateObj.propChange);var P=this.parentNode;while(P){P.watch("visible",this.$updateObj.propChange);P=P.parentNode;}return;}this.cellheight=parseInt(this.cellheight);this.padding=parseInt(this.padding);var Q;var T="pWidth",B="pHeight",I=d(this.columns,T).split(/\s*,\s*/),Z=I.length,N=apf.getBox(this.margin),u=[],w=[],ab=this.childNodes,A,E,q,J,W,U,G,Y,D;this.ids=[this.$ext];for(var R=[],aa=0,X=0,V=ab.length;X<V;X++){D=ab[X];if(D.nodeType!=1&&D.nodeType!=7||D.nodeFunc==apf.NODE_HIDDEN||D.visible===false){continue;}if(D.hasFeature(apf.__ANCHORING__)){D.$disableAnchoring();}U=apf.getBox(String(D.margin));J=apf.getDiff(D.$ext);q=D.$ext;if(!q.getAttribute("id")){apf.setUniqueHtmlId(q);}if(apf.isIE){q.style.position="absolute";}Y=D.span;G={span:Y=="*"?Z-(aa%Z):parseInt(Y)||1,m:U,height:d(D.height,B),width:D.width,oHtml:q,hordiff:J[0],verdiff:J[1],id:(apf.hasHtmlIdsInJs?q.getAttribute("id"):"document.getElementById('"+q.getAttribute("id")+"')")};R.push(G);E=Math.floor(aa/Z);aa+=G.span;if(G.height=="*"||u[E]=="*"){u[E]="*";G.height=null;}else{if(G.height&&parseInt(G.height)!=G.height){u[E]=G.height;}else{if(typeof u[E]!="string"){u[E]=Math.max(u[E]||0,parseFloat(G.height||this.cellheight));}}}}var M=new Date().getTime();if(R.length==0){return;}var ac,t,K=null,O=null;var C=["var ids = apf.all["+this.$uniqueId+"].ids","var total = 0, pHeight = ids[0].offsetHeight - "+((u.length-1)*this.padding+N[0]+N[2]),"var pWidth  = ids[0].offsetWidth - "+((Z-1)*this.padding+N[1]+N[3])];for(ac=0,X=0;X<Z;X++){if(I[X]=="*"){K=X;}else{if(parseFloat(I[X])!=I[X]){C.push("var colw"+X+"; total += colw"+X+" = "+I[X]);I[X]="colw"+X;}else{ac+=I[X]=parseFloat(I[X]);}}}if(K!==null){C.push("var colw"+K+" = "+T+" - total - "+ac);I[K]="colw"+K;}var z=[N[3]];C.push("var coll0 = "+N[3]);for(X=1;X<Z;X++){if(typeof z[X-1]=="number"&&typeof I[X-1]=="number"){z[X]=z[X-1]+I[X-1]+this.padding;}else{C.push("var coll"+X+" = coll"+(X-1)+" + colw"+(X-1)+" + "+this.padding);z[X]="coll"+X;}}C.push("total = 0");var n=false;for(ac=0,X=0;X<u.length;X++){if(u[X]=="*"){O=X;}else{if(parseFloat(u[X])!=u[X]){n=true;C.push("var rowh"+X+"; total += rowh"+X+" = "+u[X]);u[X]="rowh"+X;}else{ac+=u[X]=parseFloat(u[X]);}}}if(O!==null){n=true;C.push("var rowh"+O+" = "+B+" - total - "+ac);u[O]="rowh"+O;}if(!n){this.$ext.style.height=(ac+((u.length-1)*this.padding)+N[0]+N[2])+"px";}var s=[N[0]];C.push("var rowt0 = "+N[0]);for(X=1;X<u.length;X++){if(typeof s[X-1]=="number"&&typeof u[X-1]=="number"){s[X]=s[X-1]+u[X-1]+this.padding;}else{C.push("var rowt"+X+" = rowt"+(X-1)+" + rowh"+(X-1)+" + "+this.padding);s[X]="rowt"+X;}}for(aa=0,X=0;X<R.length;X++){G=R[X];A=aa%Z;E=Math.floor(aa/Z);aa+=G.span;Q=G.id;if(typeof s[E]=="number"){G.oHtml.style.top=(s[E]+G.m[0])+"px";}else{C.push(Q+".style.top    = rowt"+E+" + "+G.m[0]+" + 'px'");}if(typeof z[A]=="number"){G.oHtml.style.left=(z[A]+G.m[3])+"px";}else{C.push(Q+".style.left   = coll"+A+" + "+G.m[3]+" + 'px'");}if(G.span&&G.span>1&&!G.width){var F=0;for(t=[],W=0;W<G.span;W++){if(typeof I[A+W]=="number"){F+=I[A+W];}else{t.push("colw"+(A+W));F-=1000000;}}var o=(G.span-1)*this.padding;if(F>0){G.oHtml.style.width=(F+o-(G.m[1]+G.m[3]+G.hordiff))+"px";}else{if(F>-1000000){t.push(F+1000000);}C.push(Q+".style.width = ("+t.join(" + ")+" + "+o+" - "+(G.m[1]+G.m[3]+G.hordiff)+") + 'px'");}}else{if(parseFloat(G.width)==G.width||typeof I[A]=="number"){G.oHtml.style.width=((G.width||I[A])-(G.m[1]+G.m[3]+G.hordiff))+"px";}else{C.push(Q+".style.width = ("+(G.width||"colw"+A)+" - "+(G.m[1]+G.m[3]+G.hordiff)+") + 'px'");}}if(parseFloat(G.height)==G.height||typeof u[E]=="number"){G.oHtml.style.height=((G.height||u[E]-(G.m[0]+G.m[2]))-G.verdiff)+"px";}else{C.push(Q+".style.height = ("+(G.height||"rowh"+E)+" - "+(G.m[0]+G.m[2]+G.verdiff)+") + 'px'");}}apf.layout.setRules(this.$ext,"table",(C.length?"try{"+C.join(";}catch(e){};\ntry{")+";}catch(e){};":""),true);apf.layout.queue(this.$ext);this.$update=false;};this.$draw=function(){var i=this;this.$updateObj={$updateLayout:function(){i.$updateTable();},updateTrigger:function(j){if(!i.$update&&apf.loaded){a.queue(i.$ext,i.$updateObj);}i.$update=true;},propChange:function(l,j,m){if(i.$update&&apf.isTrue(m)&&i.$ext.offsetWidth){i.$updateTable();apf.layout.activateRules(i.$ext);var n=i;while(n){n.unwatch("visible",i.$updateObj.propChange);n=n.parentNode;}i.$isWaitingOnDisplay=false;}}};this.$ext=this.$pHtmlNode.appendChild(document.createElement("div"));this.$ext.className="table "+(this.getAttributeNode("class")||"");this.$int=this.$ext;this.$ext.host=this;if(!this.$ext.getAttribute("id")){apf.setUniqueHtmlId(this.$ext);}this.$htmlId=apf.hasHtmlIdsInJs?this.$ext.getAttribute("id"):"document.getElementById('"+this.$ext.getAttribute("id")+"')";this.$ext.style.position="relative";this.$ext.style.minHeight="10px";if(this.getAttribute("class")){apf.setStyleClass(this.$ext,this.getAttribute("class"));}if(!apf.isIE&&!apf.table.$initedcss){apf.importCssString(".table>*{position:absolute}");apf.table.$initedcss=true;}};this.$loadAml=function(i){if(!this.width&&(apf.getStyle(this.$ext,"position")=="absolute"||this.left||this.top||this.right||this.bottom||this.anchors)){this.$ext.style.width="100%";}};}).call(apf.table.prototype=new apf.GuiElement());apf.aml.setElement("table",apf.table);apf["switch"]=function(c,a){this.$hasButtons=false;this.$init(a||"switch",apf.NODE_VISIBLE,c);};apf.pages=function(c,a){this.$hasButtons=false;this.$init(a||"pages",apf.NODE_VISIBLE,c);};apf.tab=function(c,a){this.$hasButtons=true;this.$init(a||"tab",apf.NODE_VISIBLE,c);};(function(){this.$focussable=apf.KEYBOARD;this.$draw=function(a){this.$ext=this.$getExternal();this.$loadChildren();};}).call(apf.tab.prototype=new apf.BaseTab());apf["switch"].prototype=apf.pages.prototype=apf.tab.prototype;apf.aml.setElement("switch",apf["switch"]);apf.aml.setElement("pages",apf.pages);apf.aml.setElement("tab",apf.tab);apf.aml.setElement("teleport",apf.AmlElement);apf.label=function(c,a){this.$init(a||"label",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction);var a=this;this.$focussable=false;var c;this.setValue=function(d){this.setProperty("value",d,false,true);};this.getValue=function(){return this.value;};this.$supportedProperties.push("caption","value","for");this.$propHandlers.caption=this.$propHandlers.value=function(d){this.$int.innerHTML=d;};this.$propHandlers["for"]=function(d){c=typeof d=="string"?self[d]:d;};this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","caption",this.$ext);if(this.$int.nodeType!=1){this.$int=this.$int.parentNode;}this.$ext.onmousedown=function(){if(c&&c.$focussable&&c.focussable){c.focus();}};};this.$childProperty="value";}).call(apf.label.prototype=new apf.BaseSimple());apf.aml.setElement("label",apf.label);apf.slideshow=function(c,a){this.$init(a||"slideshow",apf.NODE_VISIBLE,c);this.title="number";this.thumbheight=50;this.loadmsg=null;this.defaultthumb=null;this.defaultimage=null;this.defaulttitle=null;this.delay=5;this.scalewidth=false;this.previous=null,this.next=null,this.current=null,this.last=null;this.inuse=false;this.play=false;this.thumbnails=true;this.lastChoose=null;this.$vSpace=210;this.$hSpace=150;this.tmrShowLast=null;this.tmrIsResized=null;this.tmrPlay=null;this.tmrKeyDown=null;this.tmrOnScroll=null;this.tmrZoom=null;this.tmrHoverDelay=null;this.$imageWidth;this.$imageHeight;this.viewPortWidth=0;this.viewPortHeight=0;this.$zooming=false;this.$oEmpty;this.$IEResizeCounter=0;this.lastOverflow=null;this.$positioning="basic";};(function(){this.implement(apf.DataAction);this.$supportedProperties.push("model","thumbheight","title","loadmsg","defaultthumb","defaulttitle","defaultimage","scalewidth");this.$booleanProperties.scalewidth=true;this.$propHandlers.thumbheight=function(a){if(parseInt(a)){this.thumbheight=parseInt(a);}};this.$propHandlers.delay=function(a){if(parseInt(a)){this.delay=parseInt(a);}};this.$setSiblings=function(){var c=this.getNextTraverse(this.current),a=this.getNextTraverse(this.current,true);this.next=c?c:this.getFirstTraverseNode();this.previous=a?a:this.getLastTraverseNode();};this.$showLast=function(){var a=this;clearInterval(this.tmrShowLast);this.tmrShowLast=setInterval(function(){if(!a.inuse){if(a.lastChoose){a.current=a.lastChoose;a.lastChoose=null;a.$refresh();}clearInterval(a.tmrShowLast);}},100);};this.$paint=function(){var a=this;this.current=this.getFirstTraverseNode();this.oImage.src="about:blank";this.oThumbnails.style.height=this.otBody.style.height=this.otPrevious.style.height=this.otNext.style.height=this.thumbheight+"px";this.oLoading.innerHTML=this.loadmsg||apf.language.getWord("sub.slideshow.loadmsg")||"Loading...";this.oImage.onload=function(){a.last=a.current;a.oBody.style.display="block";a.oImageBase.style.display="block";a.oImageBase.src=a.oImage.src;this.style.display="block";var l=a.oImageBase.offsetWidth||a.oImageBase.width;var o=a.oImageBase.offsetHeight||a.oImageBase.height;this.style.display="none";a.oImageBase.style.display="none";var c=apf.isIE?document.documentElement.offsetWidth:window.innerWidth;windowHeight=apf.isIE?document.documentElement.offsetHeight:window.innerHeight;var m=a.$getPanelSize();var j=apf.getDiff(a.oBody);var s=[false,false];var d=windowHeight-m/2-a.$vSpace,n=c-a.$hSpace;var i=o,q=l;if(i>d){q=parseInt(q*(d/i));i=d;}if(q>n){i=parseInt(i*(n/q));q=n;}a.viewPortHeight=i;a.viewPortWidth=q;apf.tween.single(a.oBody,{steps:apf.isGecko?20:(Math.abs(l-a.oBody.offsetWidth)>40?10:3),anim:apf.tween.EASEIN,type:"mwidth",from:a.oBody.offsetWidth-j[0],to:q,onfinish:function(){s[0]=true;}});apf.tween.single(a.oBody,{steps:apf.isGecko?20:(Math.abs(o-a.oBody.offsetHeight)>40?10:3),anim:apf.tween.EASEIN,type:"mheight",margin:-1*(m/2-10),from:a.oBody.offsetHeight-j[1],to:i,onfinish:function(){s[1]=true;}});a.oImage.style.display="block";a.oImage.style.width=q+"px";a.oImage.style.height=i+"px";a.oImage.style.display="none";clearInterval(a.tmrIsResized);a.tmrIsResized=setInterval(function(){if(s[0]&&s[1]){clearInterval(a.tmrIsResized);if(a.current){a.$setSiblings();}a.oConsole.style.visibility="visible";a.oImage.style.display="block";a.oTitle.style.display="block";a.$checkThumbSize();if(a.thumbnails){a.oThumbnails.style.display="block";}apf.tween.single(a.oImage,{steps:2,type:"fade",from:0,to:1});apf.tween.single(a.oTitle,{steps:10,type:"fade",from:0,to:1});a.inuse=false;a.addSelection();if(a.play){a.$play();}}},30);};this.oImage.onerror=function(){a.inuse=false;};this.oImage.onabort=function(){a.inuse=false;};this.oContent.innerHTML=a.title=="text"?this.$applyBindRule("title",this.current):(this.title=="number+text"?"<b>"+(apf.language.getWord("sub.slideshow.image")||"Image")+" "+(this.getPos()+1)+" "+(apf.language.getWord("sub.slideshow.of")||"of")+" "+this.getTraverseNodes().length+"</b><br />"+(this.$applyBindRule("title",this.current)||(this.defaulttitle?this.defaulttitle:(apf.language.getWord("sub.slideshow.defaulttitle")||"No description"))):"Image "+(this.getPos()+1)+" of "+this.getTraverseNodes().length);};this.getPos=function(){return Array.prototype.indexOf.call(this.getTraverseNodes(),this.current);};this.addSelection=function(c){var n=apf.xmldb.findHtmlNode(this.current,this),m=apf.isIE?document.documentElement.offsetWidth:window.innerWidth,a=apf.getDiff(this.otPrevious),d=apf.getDiff(this.otNext),j=parseInt(apf.getStyle(this.otPrevious,"width")),l=parseInt(apf.getStyle(this.otNext,"width")),i=parseInt(apf.getStyle(n,"width"));if(n.offsetLeft+i+5>m-j-l-a[0]-d[0]){if(c){if(c>0){this.$tPrevious();}else{if(c<0){this.$tNext();}}this.addSelection(c);}}if(this.$selected){this.$selected.className="ssPicBox";}if(n){n.className="ssPicBox ssselected";}this.$selected=n;};this.$refresh=function(){var a=this;if(this.inuse){this.lastChoose=this.current;this.$showLast();return;}if(this.play){clearInterval(this.tmrPlay);}this.$setSiblings();this.inuse=true;apf.tween.single(this.oImage,{steps:5,type:"fade",from:1,to:0});this.oTitle.style.display="block";apf.tween.single(this.oTitle,{steps:3,type:"fade",from:1,to:0,onfinish:function(){a.oImage.style.left="0px";a.oImage.style.top="0px";var d=(a.$applyBindRule("src",a.current)||a.defaultimage||a.defaultthumb);var c=a.oImage.src;a.oImage.src=d;a.oImage.style.display="none";if(a.oImage.src==c&&apf.isWebkit){a.inuse=false;apf.tween.single(a.oImage,{steps:5,type:"fade",from:0,to:1});apf.tween.single(a.oTitle,{steps:3,type:"fade",from:0,to:1});}a.oContent.innerHTML=a.title=="text"?a.$applyBindRule("title",a.current):(a.title=="number+text"?"<b>"+(apf.language.getWord("sub.slideshow.image")||"Image")+" "+(a.getPos()+1)+" "+(apf.language.getWord("sub.slideshow.of")||"of")+" "+a.getTraverseNodes().length+"</b><br />"+(a.$applyBindRule("title",a.current)||(a.defaulttitle?a.defaulttitle:apf.language.getWord("sub.slideshow.defaulttitle")||"No description")):"Image "+(a.getPos()+1)+" of "+a.getTraverseNodes().length);}});};this.select=function(a){this.current=a;this.$show();};this.$hideScrollbars=function(){this.lastOverflow=document.documentElement.style.overflow=="hidden"?"auto":document.documentElement.style.overflow;document.documentElement.style.overflow="hidden";};this.$showScrollbars=function(){document.documentElement.style.overflow=this.lastOverflow;};this.$show=function(){var a=this;this.$hideScrollbars();this.oBeam.style.display="none";this.oBody.style.display="none";this.$int.style.display="block";this.$ext.style.display="block";apf.tween.single(a.oCurtain,{steps:10,type:"fade",from:0,to:0.7,onfinish:function(){a.oBeam.style.display="block";apf.tween.single(a.oBeam,{steps:10,type:"fade",from:0,to:1,onfinish:function(){a.oBody.style.display="block";a.oBody.style.width="100px";a.oBody.style.height="100px";a.oBody.style.marginLeft="-50px";a.oBody.style.marginTop="-50px";apf.tween.single(a.oBody,{steps:5,type:"fade",from:0,to:1,onfinish:function(){if(apf.isIE){a.oBody.style.filter="";a.oBeam.style.filter="";}a.$refresh();}});}});}});};this.$Next=function(){this.current=this.next;this.addSelection(-1);this.$refresh();};this.$Previous=function(){this.current=this.previous;this.addSelection(1);this.$refresh();};this.$tNext=function(){this.otBody.appendChild(this.otBody.childNodes[0]);};this.$tPrevious=function(){this.otBody.insertBefore(this.otBody.childNodes[this.otBody.childNodes.length-1],this.otBody.firstChild);};this.$play=function(){var a=this;clearInterval(this.tmrPlay);this.tmrPlay=setInterval(function(){a.play=true;if(a.inuse){return;}a.$Next();},a.delay*1000);};this.$stop=function(){clearInterval(this.tmrPlay);this.tmrPlay=null;this.play=false;};this.$clickThumb=function(a){this.current=apf.xmldb.getNode(a);this.addSelection();this.$refresh();};this.$getPanelSize=function(){var a=this.oTitle.offsetHeight||parseInt(apf.getStyle(this.oTitle,"height"))+apf.getDiff(this.oTitle)[1];return Math.max(this.oBeam.offsetHeight,a+(this.thumbnails?this.thumbheight:0)+this.oConsole.offsetHeight);};this.$resize=function(){if(apf.isIE){this.$IEResizeCounter++;if(this.$IEResizeCounter==2){this.$IEResizeCounter=0;return;}}var j=this;j.oImage.style.display="none";var c=apf.isIE?document.documentElement.offsetWidth:window.innerWidth,a=apf.isIE?document.documentElement.offsetHeight:window.innerHeight;var n=j.oImageBase.offsetWidth||j.oImageBase.width;var q=j.oImageBase.offsetHeight||j.oImageBase.height;var m=apf.getDiff(this.oBody);var o=this.$getPanelSize();var d=a-o/2-j.$vSpace;var l=c-j.$hSpace;var i=q;var s=n;if(i>d){s=parseInt(s*(d/i));i=d;}if(s>l){i=parseInt(i*(l/s));s=l;}this.viewPortHeight=i;this.viewPortWidth=s;var t=[false,false];apf.tween.single(j.oBody,{steps:5,anim:apf.tween.EASEIN,type:"mwidth",from:j.oBody.offsetWidth-m[0],to:s,onfinish:function(){t[0]=true;}});apf.tween.single(j.oBody,{steps:5,anim:apf.tween.EASEIN,type:"mheight",margin:-1*(o/2-10),from:j.oBody.offsetHeight-m[1],to:i,onfinish:function(){t[1]=true;}});clearInterval(j.tmrIsResized);j.tmrIsResized=setInterval(function(){if(t[0]&&t[1]){clearInterval(j.tmrIsResized);j.oImage.style.display="block";j.oImage.style.width=s+"px";j.oImage.style.height=i+"px";apf.tween.single(j.oImage,{steps:2,type:"fade",from:0,to:1});}},30);};this.$draw=function(){this.$pHtmlNode=document.body;this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);this.oCurtain=this.$getLayoutNode("main","curtain",this.$ext);this.oBody=this.$getLayoutNode("main","body",this.$ext);this.oContent=this.$getLayoutNode("main","content",this.$ext);this.oImage=this.$getLayoutNode("main","image",this.$ext);this.oImageBase=this.$getLayoutNode("main","image_base",this.$ext);this.oClose=this.$getLayoutNode("main","close",this.$ext);this.oBeam=this.$getLayoutNode("main","beam",this.$ext);this.oTitle=this.$getLayoutNode("main","title",this.$ext);this.oThumbnails=this.$getLayoutNode("main","thumbnails",this.$ext);this.otBody=this.$getLayoutNode("main","tbody",this.$ext);this.otPrevious=this.$getLayoutNode("main","tprevious",this.$ext);this.otNext=this.$getLayoutNode("main","tnext",this.$ext);this.oLoading=this.$getLayoutNode("main","loading",this.$ext);this.oEmpty=this.$getLayoutNode("main","empty",this.$ext);this.oConsole=this.$getLayoutNode("main","console",this.$ext);this.oPrevious=this.$getLayoutNode("main","previous",this.$ext);this.oPlay=this.$getLayoutNode("main","play",this.$ext);this.oNext=this.$getLayoutNode("main","next",this.$ext);var a=this;var d="var o = apf.all["+this.$uniqueId+"];                     if (o) o.$resize()";apf.layout.setRules(this.$pHtmlNode,this.$uniqueId+"_scaling",d,true);apf.layout.queue(this.$pHtmlNode);this.oPrevious.onclick=this.oNext.onclick=function(j){if((this.className||"").indexOf("ssprevious")!=-1){a.$Previous();}else{if((this.className||"").indexOf("ssnext")!=-1){a.$Next();}}};var i=null;this.otPrevious.onmousedown=function(j){i=setInterval(function(){a.$tPrevious();},50);};this.otNext.onmousedown=function(j){i=setInterval(function(){a.$tNext();},50);};this.otNext.onmouseover=function(j){a.$setStyleClass(a.otNext,"ssnhover");};this.otPrevious.onmouseover=function(j){a.$setStyleClass(a.otPrevious,"ssphover");};this.otNext.onmouseout=function(j){a.$setStyleClass(a.otNext,"",["ssnhover"]);};this.otPrevious.onmouseout=function(j){a.$setStyleClass(a.otPrevious,"",["ssphover"]);};this.oPlay.onclick=function(j){if(a.tmrPlay){a.$stop();a.$setStyleClass(a.oPlay,"",["ssstop"]);a.$setStyleClass(a.oPlay,"ssplay");a.oNext.style.visibility="visible";a.oPrevious.style.visibility="visible";a.oThumbnails.style.display="block";}else{a.$play();a.$setStyleClass(a.oPlay,"",["ssplay"]);a.$setStyleClass(a.oPlay,"ssstop");a.oNext.style.visibility="hidden";a.oPrevious.style.visibility="hidden";a.oThumbnails.style.display="none";}};this.oClose.onclick=function(){a.$hide();a.$showScrollbars();};document.onmouseup=function(j){clearInterval(i);return false;};this.oImage.onmouseover=function(G){a.inuse=true;var G=G||event;var J=G.target||G.srcElement;var m=a.oImageBase.offsetWidth||a.oImageBase.width;var F=a.oImageBase.offsetHeight||a.oImageBase.height;var I=apf.isIE?document.documentElement.offsetWidth:window.innerWidth;var n=apf.isIE?document.documentElement.offsetHeight:window.innerHeight;var z=apf.getDiff(a.oBody);var l=a.oBody.offsetLeft+z[0]/2;var j=a.oBody.offsetTop+z[1]/2;var u=0,q=0;var s,D,E,C;var B=G.clientX-l;var A=G.clientY-j;s=a.$imageWidth=parseInt(a.oImage.style.width);D=a.$imageHeight=parseInt(a.oImage.style.height);var t=B/a.$imageWidth;var o=A/a.$imageHeight;this.onmousemove=function(w){var w=w||event;B=w.clientX-l;A=w.clientY-j;t=B/a.$imageWidth;o=A/a.$imageHeight;if((a.$imageWidth==parseInt(a.oImage.style.width)&&a.$imageHeight==parseInt(a.oImage.style.height))||a.$zooming){return;}E=-1*(t*s-B);C=-1*(o*D-A);if(E<=0&&E>=-1*(s-a.viewPortWidth)){a.oImage.style.left=E+"px";}if(C<=0&&C>=-1*(D-a.viewPortHeight)){a.oImage.style.top=C+"px";}};clearInterval(a.tmrHoverDelay);a.tmrHoverDelay=setInterval(function(){clearInterval(a.tmrHoverDelay);clearInterval(a.tmrZoom);a.tmrZoom=setInterval(function(){a.$zooming=true;s=parseInt(a.oImage.style.width);D=parseInt(a.oImage.style.height);var w=parseInt(a.oImage.style.left);var K=parseInt(a.oImage.style.top);var M=apf.isIE?0.03:0.01;if(s<m){a.oImage.style.width=(s+s*M)+"px";a.oImage.style.left=-1*(t*s-B)+"px";}if(D<F){a.oImage.style.height=(D+D*M)+"px";a.oImage.style.top=-1*(o*D-A)+"px";}if(s>=m&&D>=F){clearInterval(a.tmrZoom);a.$zooming=false;}},apf.isIE?5:10);},1000);};this.oImage.onmouseout=function(j){a.inuse=false;clearInterval(a.tmrZoom);clearInterval(a.tmrHoverDelay);a.oImage.style.width=a.$imageWidth+"px";a.oImage.style.height=a.$imageHeight+"px";a.oImage.style.top="0px";a.oImage.style.left="0px";document.onmousemove=null;};var c=false;apf.addEventListener("mousescroll",function(n){if(!a.xmlRoot||a.$ext.style.display=="none"){return;}n=n||event;if(apf.isWebkit){c=c?false:true;if(!c){return;}}var o=n.delta;var m=a.current;var j=a.getNextTraverse(m);var l=a.getNextTraverse(m,true);a.next=j?j:a.getFirstTraverseNode();a.previous=l?l:a.getLastTraverseNode();a.current=o<0?a.next:a.previous;a.addSelection(o);if(a.current!==m){clearInterval(a.tmrOnScroll);a.tmrOnScroll=setInterval(function(){a.$refresh();clearInterval(a.tmrOnScroll);},400);}return false;});apf.addEventListener("onkeydown",function(o){o=(o||event);var m=o.keyCode;var n=a.current;var j=a.getNextTraverse(n);var l=a.getNextTraverse(n,true);a.next=j?j:a.getFirstTraverseNode();a.previous=l?l:a.getLastTraverseNode();a.current=m==39?a.next:(m==37?a.previous:a.current);a.addSelection(m==39?-1:(m==37?1:0));if(a.current!==n){clearInterval(a.tmrKeyDown);a.tmrKeyDown=setInterval(function(){a.$refresh();clearInterval(a.tmrKeyDown);},550);}return false;});};this.$hide=function(){var a=this;a.$ext.style.display="block";apf.tween.single(a.oBody,{steps:10,type:"fade",from:1,to:0,onfinish:function(){a.oBody.style.display="none";}});apf.tween.single(a.oBeam,{steps:10,type:"fade",from:1,to:0,onfinish:function(){a.oBeam.style.display="none";apf.tween.single(a.oCurtain,{steps:10,type:"fade",from:0.7,to:0,onfinish:function(){a.$int.style.display="none";a.$ext.style.display="none";}});}});};this.$checkThumbSize=function(){var j=this.getTraverseNodes();var A=j.length;var t=this.otBody.childNodes;var n=t.length;var z=0;var d,o,l,u,B,q,m,c=0;for(var s=0;s<n;s++){if((t[s].className||"").indexOf("ssPicBox")>-1){l=t[s];o=this.$applyBindRule("thumb",j[c]);d=apf.getDiff(l);q=this.thumbheight-10-d[1];if(this.scalewidth){m=new Image();document.body.appendChild(m);m.src=o?o:this.defaultthumb;u=q;if(m.height<q){B=m.width;}else{m.setAttribute("height",q);B=m.width;}document.body.removeChild(m);}else{u=B=q;}z+=B+d[0]+(parseInt(apf.getStyle(l,"margin-left")||apf.getStyle(l,"marginLeft")))+(parseInt(apf.getStyle(l,"margin-right")||apf.getStyle(l,"marginRight")));l.style.width=B+"px";c++;}}var a=apf.getDiff(this.otBody);this.otPrevious.style.visibility=this.otNext.style.visibility=z<this.oThumbnails.offsetWidth-a[0]?"hidden":"visible";};this.$load=function(m){apf.xmldb.addNodeListener(m,this);var c=this.getTraverseNodes();var t=c.length;var a,l,d,q,u,n,j=null;for(var o=0;o<t;o++){d=this.otBody.appendChild(document.createElement("div"));l=this.$applyBindRule("thumb",c[o]);d.style.backgroundImage="url("+(l?l:this.defaultthumb)+")";d.className="ssPicBox";a=apf.getDiff(d);n=this.thumbheight-10-a[1];if(this.scalewidth){j=new Image();document.body.appendChild(j);j.src=l?l:this.defaultthumb;q=n;if(j.height<n){u=j.width;}else{j.setAttribute("height",n);u=j.width;}document.body.removeChild(j);}else{q=u=n;}d.style.height=q+"px";d.style.width=u+"px";d.style.marginTop=d.style.marginBottom="5px";apf.xmldb.nodeConnect(this.documentId,c[o],d,this);var s=this;d.onclick=function(i){s.$clickThumb(this);};}if(t!=this.length){this.setProperty("length",t);}this.$paint();};this.addEventListener("$clear",function(){return false;});this.$destroy=function(){this.otNext.onmouseover=this.otPrevious.onmouseover=this.otNext.onmouseout=this.otPrevious.onmouseout=this.$ext.onresize=this.oImage.onmousedown=this.otNext.onmousedown=this.otPrevious.onmousedown=this.oNext.onclick=this.oPrevious.onclick=null;this.x=null;};this.$setClearMessage=function(l,c){var j=apf.isIE?document.documentElement.offsetWidth:window.innerWidth;var d=parseInt(apf.getStyle(this.otPrevious,"width"));var i=parseInt(apf.getStyle(this.otNext,"width"));var a=parseInt(apf.getStyle(this.oEmpty,"width"));this.$oEmpty=this.oCurtain.appendChild(this.oEmpty.cloneNode(true));apf.setNodeValue(this.$oEmpty,l||"");this.$oEmpty.setAttribute("id","empty"+this.$uniqueId);this.$oEmpty.style.display="block";this.$oEmpty.style.left=((j-a)/2-d-i)+"px";apf.setStyleClass(this.$oEmpty,c,["ssloading","ssempty","offline"]);};this.$removeClearMessage=function(){if(!this.$oEmpty){this.$oEmpty=document.getElementById("empty"+this.$uniqueId);}if(this.$oEmpty&&this.$oEmpty.parentNode){this.$oEmpty.parentNode.removeChild(this.$oEmpty);}};this.$setCurrentFragment=function(a){this.otBody.appendChild(a);this.dataset=a.dataset;if(!apf.window.hasFocus(this)){this.blur();}};this.$getCurrentFragment=function(){var a=document.createDocumentFragment();while(this.otBody.childNodes.length){a.appendChild(this.otBody.childNodes[0]);}a.dataset=this.dataset;return a;};}).call(apf.slideshow.prototype=new apf.MultiselectBinding());apf.aml.setElement("slideshow",apf.slideshow);apf.aml.setElement("src",apf.BindingRule);apf.aml.setElement("title",apf.BindingRule);apf.aml.setElement("thumb",apf.BindingRule);apf.scrollbar=function(c,a){this.$init(a||"scrollbar",apf.NODE_VISIBLE,c);};(function(){this.realtime=true;this.$scrollValue=0;this.$stepValue=0.03;this.$bigStepValue=0.1;this.$curValue=0;this.$timer=null;this.$scrollWait;this.$slideMaxHeight;this.addEventListener("focus",function(){this.$host.host.focus();});this.attach=function(i,j,d){this.$host=j;this.$onscroll=d;this.$viewheight=i.offsetHeight;this.$scrollheight=this.$viewheight;this.$attachedHtml=i;i.parentNode.appendChild(this.$ext);if(this.overflow=="scroll"){this.$ext.style.display="block";}this.$ext.style.zIndex=100000;var a=this;function c(n){if(!n){n=event;}var o=null;if(n.wheelDelta){o=n.wheelDelta/120;if(apf.isOpera){o*=-1;}}else{if(n.detail){o=-n.detail/3;}}if(o!==null){var m={delta:o};var l=apf.dispatchEvent("mousescroll",m);if(l===false||m.returnValue===false){if(n.preventDefault){n.preventDefault();}n.returnValue=false;}}a.$stepValue=(j.limit/j.length)/5;a.$curValue+=((apf.isOpera?1:-1)*o*a.$stepValue);a.setScroll(true);if(n.preventDefault){n.preventDefault();}return false;}if(document.addEventListener){document.addEventListener("DOMMouseScroll",c,false);}else{i.onmousewheel=c;}this.$scrollWait=0;this.$slideMaxHeight=this.$ext.offsetHeight-this.$btnDown.offsetHeight-this.$btnUp.offsetHeight;this.$stepValue=(this.$viewheight/this.$scrollheight)/20;this.$bigStepValue=this.$stepValue*3;if(j.length){this.$caret.style.height=Math.max(5,((j.limit/j.length)*this.$slideMaxHeight))+"px";if(this.$caret.offsetHeight-4==this.$slideMaxHeight){this.$ext.style.display="none";}}return this;};this.setScroll=function(a,c){if(this.$curValue>1){this.$curValue=1;}if(this.$curValue<0){this.$curValue=0;}this.$caret.style.top=(this.$btnUp.offsetHeight+(this.$ext.offsetHeight-(this.$btnUp.offsetHeight*2)-this.$caret.offsetHeight)*this.$curValue)+"px";this.pos=this.$curValue;if(!c){this.$onscroll(a,this.pos);}};this.scrollUp=function(a){if(a>this.$caret.offsetTop){return this.$ext.onmouseup();}this.$curValue-=this.$bigStepValue;this.setScroll();this.$slideFast.style.height=Math.max(1,this.$caret.offsetTop-this.$btnUp.offsetHeight)+"px";this.$slideFast.style.top=this.$btnUp.offsetHeight+"px";};this.scrollDown=function(a){if(a<this.$caret.offsetTop+this.$caret.offsetHeight){return this.$ext.onmouseup();}this.$curValue+=this.$bigStepValue;this.setScroll();this.$slideFast.style.top=(this.$caret.offsetTop+this.$caret.offsetHeight)+"px";this.$slideFast.style.height=Math.max(1,this.$ext.offsetHeight-this.$slideFast.offsetTop-this.$btnUp.offsetHeight)+"px";};this.getPosition=function(){return this.pos;};this.setPosition=function(c,a){this.$curValue=c;setScroll(null,a);};this.update=function(c){var c=this.$attachedHtml;this.$ext.style.left=(c.offsetLeft+c.offsetWidth+1)+"px";this.$ext.style.top=(c.offsetTop-1)+"px";this.$ext.style.height=(c.offsetHeight-2)+"px";var d=this.$host;if(d.length){this.$ext.style.display="block";d.initialLimit=0;d.findNewLimit();var a;this.$slideMaxHeight=this.$ext.offsetHeight-this.$btnDown.offsetHeight-this.$btnUp.offsetHeight;this.$caret.style.height=((a=Math.max(10,(((d.limit-1)/d.length)*this.$slideMaxHeight)))-apf.getHeightDiff(this.$caret))+"px";this.$caret.style.top=(this.$curValue*(this.$slideMaxHeight-Math.round(a))+this.$btnUp.offsetHeight)+"px";this.$stepValue=(d.limit/d.length)/20;this.$bigStepValue=this.$stepValue*3;}if(!d.length||d.limit>=d.length&&c.scrollHeight<c.offsetHeight){if(this.overflow=="scroll"){this.$caret.style.display="none";this.disable();}else{this.$ext.style.display="none";}c.style.overflowY="visible";}else{if(this.overflow=="scroll"){this.$caret.style.display="block";this.enable();}else{this.$ext.style.display="block";this.$caret.style.display="block";}c.style.overflowY="scroll";}};this.updatePos=function(){var c=this.$host;var a=Math.round(Math.max(10,(((c.limit-1)/c.length)*this.$slideMaxHeight)));this.$caret.style.top=(this.$curValue*(this.$slideMaxHeight-a)+this.$btnUp.offsetHeight)+"px";};this.$onscroll=function(a,c){this.$host.scrollTop=(this.$host.scrollHeight-this.$host.offsetHeight+4)*this.$curValue;};this.$draw=function(){this.$getNewContext("main");this.$ext=this.$getExternal();this.$ext.style.display="none";this.$caret=this.$getLayoutNode("main","indicator",this.$ext);this.$slideFast=this.$getLayoutNode("main","slidefast",this.$ext);this.$btnUp=this.$getLayoutNode("main","btnup",this.$ext);this.$btnDown=this.$getLayoutNode("main","btndown",this.$ext);this.$startPos=false;this.$caret.ondragstart=function(){return false;};var a=this;this.$btnUp.onmousedown=function(c){if(!c){c=event;}this.className="btnup btnupdown";clearTimeout(a.$timer);a.$curValue-=a.$stepValue;a.setScroll();c.cancelBubble=true;apf.window.$mousedown();a.$timer=$setTimeout(function(){a.$timer=setInterval(function(){a.$curValue-=a.$stepValue;a.setScroll();},20);},300);};this.$btnDown.onmousedown=function(c){if(!c){c=event;}this.className="btndown btndowndown";clearTimeout(a.$timer);a.$curValue+=a.$stepValue;a.setScroll();c.cancelBubble=true;apf.window.$mousedown();a.$timer=$setTimeout(function(){a.$timer=setInterval(function(){a.$curValue+=a.$stepValue;a.setScroll();},20);},300);};this.$btnUp.onmouseout=this.$btnUp.onmouseup=function(){this.className="btnup";clearInterval(a.$timer);};this.$btnDown.onmouseout=this.$btnDown.onmouseup=function(){this.className="btndown";clearInterval(a.$timer);};this.$caret.onmousedown=function(c){if(!c){c=event;}a.$startPos=[c.offsetX,c.offsetY+a.$btnUp.offsetHeight];if(this.setCapture){this.setCapture();}document.onmousemove=function(l){if(!l){l=event;}if(!a.$startPos){return false;}var j=a.$btnUp.offsetHeight+(l.clientY-a.$startPos[1]-apf.getAbsolutePosition(a.$ext)[1]-2);var i=a.$btnUp.offsetHeight;if(j<i){j=i;}var d=(a.$ext.offsetHeight-(a.$btnUp.offsetHeight)-a.$caret.offsetHeight);if(j>d){j=d;}a.$curValue=(j-i)/(d-i);a.setScroll(true);};document.onmouseup=function(){a.$startPos=false;if(!a.realtime){a.setScroll();}if(this.releaseCapture){this.releaseCapture();}document.onmouseup=document.onmousemove=null;};c.cancelBubble=true;apf.window.$mousedown();return false;};this.$ext.onmousedown=function(c){if(!c){c=event;}clearInterval(a.$timer);var d;if(c.offsetY>a.$caret.offsetTop+a.$caret.offsetHeight){a.$curValue+=a.$bigStepValue;a.setScroll(true);a.$slideFast.style.display="block";a.$slideFast.style.top=(a.$caret.offsetTop+a.$caret.offsetHeight)+"px";a.$slideFast.style.height=(a.$ext.offsetHeight-a.$slideFast.offsetTop-a.$btnUp.offsetHeight)+"px";d=c.offsetY;a.$timer=$setTimeout(function(){a.$timer=setInterval(function(){a.scrollDown(d);},20);},300);}else{if(c.offsetY<a.$caret.offsetTop){a.$curValue-=a.$bigStepValue;a.setScroll(true);a.$slideFast.style.display="block";a.$slideFast.style.top=a.$btnUp.offsetHeight+"px";a.$slideFast.style.height=(a.$caret.offsetTop-a.$btnUp.offsetHeight)+"px";d=c.offsetY;a.$timer=$setTimeout(function(){a.$timer=setInterval(function(){a.scrollUp(d);},20);},300);}}};this.$ext.onmouseup=function(){clearInterval(a.$timer);if(!a.realtime){a.setScroll();}a.$slideFast.style.display="none";};};}).call(apf.scrollbar.prototype=new apf.Presentation());apf.aml.setElement("scrollbar",apf.scrollbar);apf.BindingLoadRule=function(c,a){this.$init(a,apf.NODE_HIDDEN,c);};(function(){this.$attrExcludePropBind=apf.extend({get:1},this.$attrExcludePropBind);this.$propHandlers.get=function(a,c){delete this["c"+c];};}).call(apf.BindingLoadRule.prototype=new apf.BindingRule());apf.aml.setElement("load",apf.BindingLoadRule);apf.aml.setElement("insert",apf.BindingLoadRule);apf.submit=function(c,a){this.$init(a||"submit",apf.NODE_VISIBLE,c);};apf.trigger=function(c,a){this.$init(a||"trigger",apf.NODE_VISIBLE,c);};apf.reset=function(c,a){this.$init(a||"reset",apf.NODE_VISIBLE,c);};apf.button=function(c,a){this.$init(a||"button",apf.NODE_VISIBLE,c);};(function(){this.$useExtraDiv;this.$childProperty="caption";this.$inited=false;this.$isLeechingSkin=false;this.$canLeechSkin=true;this.$focussable=true;this.value=null;this.$init(function(){var n,i=this;this.$propHandlers["default"]=function(o){if(!this.focussable&&o||n){this.setAttribute("focussable",n=o);}this.parentNode.removeEventListener("focus",m);this.parentNode.removeEventListener("blur",j);if(!o){return;}this.parentNode.addEventListener("focus",m);this.parentNode.addEventListener("blur",j);};function m(o){if(o.defaultButtonSet||o.returnValue===false){return;}o.defaultButtonSet=true;if(this.$useExtraDiv){i.$ext.appendChild(apf.button.$extradiv);}i.$setStyleClass(i.$ext,i.$baseCSSname+"Default");if(o.srcElement!=i&&i.$focusParent){i.$focusParent.addEventListener("keydown",l);}}function j(o){if(this.$useExtraDiv&&apf.button.$extradiv.parentNode==i.$ext){i.$ext.removeChild(apf.button.$extradiv);}i.$setStyleClass(i.$ext,"",[i.$baseCSSname+"Default"]);if(o.srcElement!=i&&i.$focusParent){i.$focusParent.removeEventListener("keydown",l);}}function l(q){var s;var o=apf.document.activeElement;if(o){if(o.hasFeature(apf.__MULTISELECT__)){return;}s=o.multiline;}if(!i.$ext.onmouseup){return;}if(s&&s!="optional"&&q.keyCode==13&&q.ctrlKey||(!s||s=="optional")&&q.keyCode==13&&!q.ctrlKey&&!q.shiftKey&&!q.altKey){i.$ext.onmouseup(q.htmlEvent,true);}}this.addEventListener("focus",m);this.addEventListener("blur",j);this.$enable=function(){if(this["default"]){m({});if(apf.document.activeElement){apf.document.activeElement.focus(true);}}if(this.state&&this.value){this.$setState("Down",{});}this.$doBgSwitch(1);};this.$disable=function(){if(this["default"]){j({});}this.$doBgSwitch(4);this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over",this.$baseCSSname+"Down"]);};});this.$booleanProperties["default"]=true;this.$supportedProperties.push("icon","value","tooltip","state","color","caption","action","target","default","submenu");this.$propHandlers.icon=function(i){if(!this.oIcon){return;}if(i){this.$setStyleClass(this.$ext,this.$baseCSSname+"Icon");}else{this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Icon"]);}apf.skins.setIcon(this.oIcon,i,this.iconPath);};this.$propHandlers.value=function(i){if(i===undefined){i=!this.value;}this.value=i;if(this.value){this.$setState("Down",{});}else{this.$setState("Out",{});}};this.$propHandlers.tooltip=function(i){this.$ext.setAttribute("title",i);};this.$propHandlers.state=function(i){this.$setStateBehaviour(i==1);};this.$propHandlers.color=function(i){if(this.oCaption){this.oCaption.parentNode.style.color=i;}};this.$propHandlers.caption=function(i){if(i){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Empty"]);}else{this.$setStyleClass(this.$ext,this.$baseCSSname+"Empty");}if(this.oCaption){this.oCaption.nodeValue=String(i||"").trim();}};function a(m){return;var i=m.keyCode;var j,l=apf.getChildNumber(this);if(i==37){j=l==0?this.parentNode.childNodes.length-1:l-1;this.parentNode.childNodes[j].dispatchEvent("mouseover");}else{if(i==39){j=(l>=this.parentNode.childNodes.length-1)?0:l+1;this.parentNode.childNodes[j].dispatchEvent("mouseover");}}}function d(i){var j=self[this.submenu];this.value=!this.value;if(this.value){this.$setState("Down",{});}if(!this.value){j.hide();this.$setState("Over",{},"toolbarover");this.parentNode.menuIsPressed=false;if(this.parentNode.hasMoved){this.value=false;}if(apf.hasFocusBug){apf.window.$focusfix();}return false;}this.parentNode.menuIsPressed=this;var l=apf.getAbsolutePosition(this.$ext,j.$ext.offsetParent);j.display(l[0],l[1]+this.$ext.offsetHeight,false,this,null,null,this.$ext.offsetWidth-2);this.parentNode.hasMoved=false;i.htmlEvent.cancelBubble=true;return false;}function c(){var j=this.parentNode.menuIsPressed;if(!j||j==this){return;}j.setValue(false);var i=self[j.submenu];i.$propHandlers.visible.call(i,false,true);this.setValue(true);this.parentNode.menuIsPressed=this;var l=self[this.submenu];var m=apf.getAbsolutePosition(this.$ext,l.$ext.offsetParent);l.display(m[0],m[1]+this.$ext.offsetHeight,true,this,null,null,this.$ext.offsetWidth-2);this.$focus();this.parentNode.hasMoved=true;return false;}this.$propHandlers.submenu=function(i){if(!i){if(this.value&&this.parentNode){d.call(this);}this.$focussable=true;this.$setNormalBehaviour();this.removeEventListener("mousedown",d);this.removeEventListener("mouseover",c);this.removeEventListener("keydown",a,true);return;}this.$focussable=false;this.$setStateBehaviour();this.addEventListener("mousedown",d);this.addEventListener("mouseover",c);this.addEventListener("keydown",a,true);};this.setValue=function(i){this.setProperty("value",i,false,true);};this.setCaption=function(i){this.setProperty("caption",i,false,true);};this.setIcon=function(i){this.setProperty("icon",i,false,true);};this.$setStateBehaviour=function(i){this.value=i||false;this.isBoolean=true;this.$setStyleClass(this.$ext,this.$baseCSSname+"Bool");if(this.value){this.$setStyleClass(this.$ext,this.$baseCSSname+"Down");this.$doBgSwitch(this.states.Down);}};this.$setNormalBehaviour=function(){this.value=null;this.isBoolean=false;this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Bool"]);};this.$setState=function(j,m,l){if(this.disabled){return;}if(l&&this.dispatchEvent(l,{htmlEvent:m})===false){return;}this.$doBgSwitch(this.states[j]);var i=this.$baseCSSname;this.$setStyleClass(this.$ext,(j!="Out"?i+j:""),[(this.value?"":i+"Down"),i+"Over"]);if(this.submenu){i=this.$baseCSSname+"menu";this.$setStyleClass(this.$ext,(j!="Out"?i+j:""),[(this.value?"":i+"Down"),i+"Over"]);}};this.$clickHandler=function(){if(this.isBoolean&&!this.submenu){this.setProperty("value",!this.value);return true;}};this.$submenu=function(i,j){if(i){this.setValue(false);this.$setState("Out",{},"mouseout");this.parentNode.menuIsPressed=false;}};this.$draw=function(){var j,i=(j=this.parentNode).localName=="toolbar"||j.parentNode&&j.parentNode.localName=="toolbar";if(i){if(typeof this.focussable=="undefined"){this.focussable=false;}this.$focussable=apf.KEYBOARD;}this.$ext=this.$getExternal();this.oIcon=this.$getLayoutNode("main","icon",this.$ext);this.oCaption=this.$getLayoutNode("main","caption",this.$ext);this.$useExtraDiv=apf.isTrue(this.$getOption("main","extradiv"));if(!apf.button.$extradiv&&this.$useExtraDiv){(apf.button.$extradiv=document.createElement("div")).className="extradiv";}if(this.localName=="submit"){this.action="submit";}else{if(this.localName=="reset"){this.action="reset";}}this.$setupEvents();};this.addEventListener("$skinchange",function(){if(this.caption){this.$propHandlers.caption.call(this,this.caption);}if(this.icon){this.$propHandlers.icon.call(this,this.icon);}this.$updateState({reset:1});});this.addEventListener("click",function(l){var j=this.action;if(!j){j=this.localName;}var i=this;$setTimeout(function(){(apf.button.actions[j]||apf.K).call(i);});});}).call(apf.button.prototype=new apf.BaseButton());apf.submit.prototype=apf.trigger.prototype=apf.reset.prototype=apf.button.prototype;apf.aml.setElement("submit",apf.submit);apf.aml.setElement("trigger",apf.trigger);apf.aml.setElement("reset",apf.reset);apf.aml.setElement("button",apf.button);apf.submit.action=apf.trigger.actions=apf.reset.actions=apf.button.actions={undo:function(i){var d;if(this.target&&self[this.target]){d=self[this.target].localName=="actiontracker"?self[this.target]:self[this.target].getActionTracker();}else{var a,c=this;while(c.parentNode){a=(c=c.parentNode).$at;}}(d||apf.window.$at)[i||"undo"]();},redo:function(){apf.button.actions.undo.call(this,"redo");},remove:function(){if(this.target&&self[this.target]){self[this.target].remove();}},add:function(){if(this.target&&self[this.target]){self[this.target].add();}},rename:function(){if(this.target&&self[this.target]){self[this.target].startRename();}},login:function(){var c=this.target&&self[this.target]?self[this.target]:this.parentNode;var a=c.$validgroup||new apf.ValidationGroup();if(!a.childNodes.length){a.childNodes=c.childNodes.slice();}var j={};function i(n){for(var q,o=0,m=n.length;o<m;o++){q=n[o];if(q.hasFeature(apf.__VALIDATION__)&&!q.$validgroup&&!q.form){q.setProperty("validgroup",a);}if(q.type){j[q.type]=q.getValue();}if(j.username&&j.password){return;}if(q.childNodes.length){i(q.childNodes);}}}i(c.childNodes);if(!a.isValid()){return;}if(!j.username||!j.password){return;}var d=this.ownerDocument.getElementsByTagNameNS(apf.ns.apf,"auth")[0];if(!d){return;}d.loginFn(j.username,j.password);},logout:function(){var a=this.ownerDocument.getElementsByTagNameNS(apf.ns.apf,"auth")[0];if(!a){return;}a.logoutFn();},submit:function(j){var a,c;var d=this.target&&self[this.target]?self[this.target]:this.parentNode;if(d.localName=="model"){c=d;}else{if(!d.$validgroup){d.$validgroup=d.validgroup?self[d.validgroup]:new apf.ValidationGroup();}a=d.$validgroup;if(!a.childNodes.length){a.childNodes=d.childNodes.slice();}function i(n){for(var q,o=0,m=n.length;o<m;o++){q=n[o];if(q.getModel){c=q.getModel();if(c){return false;}}if(q.childNodes.length){if(i(q.childNodes)===false){return false;}}}}i(d.childNodes);if(!c){c=apf.globalModel;if(!c){return;}}}if(j){c.reset();return;}if(a&&!a.isValid()){return;}c.submit();},reset:function(){apf.button.actions.submit.call(this,true);},ok:function(){var a;if(this.target){a=self[this.target];}else{var a=this.parentNode;while(a&&!a.hasFeature(apf.__TRANSACTION__)){a=a.parentNode;}if(a&&!a.hasFeature(apf.__TRANSACTION__)){return;}}if(a.commit()&&a.close){a.close();}},cancel:function(){var a;if(this.target){a=self[this.target];}else{var a=this.parentNode;while(a&&!a.hasFeature(apf.__TRANSACTION__)){a=a.parentNode;}if(a&&!a.hasFeature(apf.__TRANSACTION__)){return;}}a.rollback();if(a.close){a.close();}},apply:function(){var a;if(this.target){a=self[this.target];}else{var a=this.parentNode;while(a&&!a.hasFeature(apf.__TRANSACTION__)){a=a.parentNode;}if(a&&!a.hasFeature(apf.__TRANSACTION__)){return;}}if(a.autoshow){a.autoshow=-1;}if(a.commit(true)){a.begin("update");}},close:function(){var a=this.target&&self[this.target]?self[this.target]:this.parentNode;while(a&&!a.close){a=a.parentNode;}if(a&&a.close){a.close();}}};apf.statusbar=function(c,a){this.$init(a||"statusbar",apf.NODE_VISIBLE,c);};(function(){this.$focussable=false;var a;this.addEventListener("AMLRemoveChild",function(d,c){if(c){return;}});this.addEventListener("AMLInsert",a=function(i,c,d){if(i.tagName!="bar"){return;}i.$propHandlers.caption=function(j){apf.setNodeValue(this.$getLayoutNode("bar","caption",this.$ext),j);};i.$propHandlers.icon=function(j){var l=this.$getLayoutNode("bar","icon",this.$ext);if(!l){return;}if(j){this.$setStyleClass(this.$ext,this.$baseCSSname+"Icon");}else{this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Icon"]);}if(l.tagName=="img"){l.setAttribute("src",j?this.iconPath+j:"");}else{l.style.backgroundImage=j?"url("+this.iconPath+j+")":"";}};});this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);};this.$loadAml=function(c){var d=this.childNodes;for(var j=d.length-1;j>=0;j--){if(d[j].localName=="section"){d[j].addEventListener("DOMNodeInsertedIntoDocument",function(){this.$setStyleClass(this.$ext,this.$baseCSSname+"Last");});break;}}};}).call(apf.statusbar.prototype=new apf.Presentation());apf.aml.setElement("statusbar",apf.statusbar);apf.smartbinding=function(c,a){this.$init(a||"smartbinding",apf.NODE_HIDDEN,c);this.$bindNodes={};};(function(){this.$supportedProperties=["bindings","actions","model"];this.$handlePropSet=function(j,d,c){switch(j){case"model":if(typeof d=="string"){d=apf.nameserver.get("model",d);}this.model=apf.nameserver.register("model",this.name,d);var a;for(var i in this.$bindNodes){a=this.$bindNodes[i];this.model.unregister(a);this.model.register(a,this.$modelXpath[a.getHost?a.getHost().$uniqueId:a.$uniqueId]||this.modelBaseXpath);}break;case"bindings":if(this.$bindings){this.remove(this.$bindings);}this.$bindings=typeof d=="object"?d:apf.nameserver.lookup("bindings",d);this.add(this.$bindings);break;case"actions":if(this.$actions){this.remove(this.$actions);}this.$actions=typeof d=="object"?d:apf.nameserver.lookup("actions",d);this.add(this.$actions);break;}this[j]=d;};this.add=function(c){for(var a in this.$bindNodes){c.register(this.$bindNodes[a]);}this["$"+c.localName]=c;};this.remove=function(c){for(var a in this.$bindNodes){c.unregister(this.$bindNodes[a]);}};this.register=function(a){this.$bindNodes[a.$uniqueId]=a;if(this.$bindings){this.$bindings.register(a);}if(this.$actions){this.$actions.register(a);}if(this.$model){this.$model.register(a);}};this.unregister=function(a){this.$bindNodes[a.$uniqueId]=null;delete this.$bindNodes[a.$uniqueId];if(this.$bindings){this.$bindings.unregister(a);}if(this.$actions){this.$actions.unregister(a);}if(this.$model){this.$model.unregister(a);}};this.load=function(a){new apf.model().register(this).load(a);};this.clear=function(a){};this.addEventListener("DOMNodeInsertedIntoDocument",function(a){if(this.parentNode.hasFeature(apf.__DATABINDING__)){this.register(this.parentNode);}});}).call(apf.smartbinding.prototype=new apf.AmlElement());apf.aml.setElement("smartbinding",apf.smartbinding);var HAS_CHILD=1<<1,IS_CLOSED=1<<2,IS_LAST=1<<3,IS_ROOT=1<<4;apf.markupedit=function(c,a){this.$init(a||"markupedit",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction,apf.Rename,apf.MultiSelect,apf.Cache);this.$isTreeArch=true;this.$focussable=true;this.clearMessage="There are no items";this.startClosed=true;this.animType=0;this.animSteps=3;this.animSpeed=20;this.dynCssClasses=[];var a=this;this.setAttributeValue=function(q,o,s){if(!q){q=this.caret||this.selected;}if(!q||q.getAttribute(o)==s){return;}this.$executeAction("setAttribute",[q,o,s],"setAttributeValue",q);};this.renameAttribute=function(s,q,o){if(!s){s=this.caret||this.selected;}if(!s||q==o){return;}this.$executeAction("multicall",[{func:"removeAttribute",args:[s,q]},{func:"setAttribute",args:[s,o,s.getAttribute(q)]}],"renameAttribute",s);};this.setTextNode=function(o,q){if(!o){o=this.caret||this.selected;}if(!o||apf.queryValue(o,"text()")==q){return;}this.$executeAction("setTextNode",[o,q],"setTextNode",o);};this.slideToggle=function(t,s){if(this.noCollapse){return;}if(!t){t=this.$selected;}var u=t.getAttribute(apf.xmldb.htmlIdTag);while(!u&&t.parentNode){var u=(t=t.parentNode).getAttribute(apf.xmldb.htmlIdTag);}var q,o=this.$getLayoutNode("item","container",t);if(apf.getStyle(o,"display")=="block"){if(s==1){return;}q=this.$getLayoutNode("item","openclose",t);q.className=q.className.replace(/min/,"plus");this.slideClose(o,apf.xmldb.getNode(t));}else{if(s==2){return;}q=this.$getLayoutNode("item","openclose",t);q.className=q.className.replace(/plus/,"min");this.slideOpen(o,apf.xmldb.getNode(t));}};var j={};this.slideOpen=function(o,t,q){if(!t){t=this.selected;}var u=apf.xmldb.findHtmlNode(t,this);if(!o){o=this.$findContainer(u);}if(this.singleopen){var s=this.getTraverseParent(t);var w=(s||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);if(j[w]&&j[w][1]!=t&&this.getTraverseParent(j[w][1])==s){this.slideToggle(j[w][0],2);}j[w]=[u,t];}o.style.display="block";if(q){o.style.height="auto";return;}apf.tween.single(o,{type:"scrollheight",from:0,to:o.scrollHeight,anim:this.animType,steps:this.animOpenStep,interval:this.animSpeed,onfinish:function(z){if(t&&a.$hasLoadStatus(t,"potential")){$setTimeout(function(){a.$extend(t,z);});z.style.height="auto";}else{z.style.height="auto";}}});};this.slideClose=function(o,q){if(this.noCollapse){return;}if(!q){q=this.selected;}if(this.singleopen){var s=(this.getTraverseParent(q)||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);j[s]=null;}o.style.height=o.offsetHeight;o.style.overflow="hidden";apf.tween.single(o,{type:"scrollheight",from:o.scrollHeight,to:0,anim:this.animType,steps:this.animCloseStep,interval:this.animSpeed,onfinish:function(t,u){t.style.display="none";}});};this.doUpdate=function(s,q){var w=this.$getBindRule("insert",s);var u=w&&w[1]?w[1](s):null;if(w&&u){this.$setLoadStatus(s,"loading");if(w.getAttribute("get")){this.getModel().$insertFrom(w.getAttribute("get"),{xmlNode:u,insertPoint:u,amlNode:this});}else{var t=this.$applyBindRule("Insert",s);if(t){this.insert(t,{insertPoint:u});}}}else{if(!this.prerender){this.$setLoadStatus(s,"loading");var o=this.$addNodes(s,q,true);l.call(this,"insert",s,o);}}};var c={};c[0]="";c[HAS_CHILD]="min";c[HAS_CHILD|IS_CLOSED]="plus";c[IS_LAST]="last";c[IS_LAST|HAS_CHILD]="minlast";c[IS_LAST|HAS_CHILD|IS_CLOSED]="pluslast";c[IS_ROOT]="root";this.fixItem=function(D,B,A,C,t){if(!B){return;}if(A){var u;if(u=this.getNextTraverse(D,true)){this.fixItem(u,this.$findHtmlNode(u.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,true);}if(!this.emptyMessage&&D.parentNode.selectNodes(this.each).length==1){this.fixItem(D.parentNode,this.$findHtmlNode(D.parentNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,false,true);}}else{var z,q=this.$getLayoutNode("item","container",B);if(t){z=false;}else{if(D.selectNodes(this.each).length>0){z=true;}else{if(this.$getBindRule("insert",D)){z=true;}else{z=false;}}}var s=z&&q.style.display!="block";var w=this.getNextTraverse(D,null,C?2:1)?false:true;var o=(z?HAS_CHILD:0)|(s?IS_CLOSED:0)|(w?IS_LAST:0);this.$setStyleClass(this.$getLayoutNode("item","openclose",B),c[o],["min","plus","last","minlast","pluslast"]);this.$setStyleClass(this.$getLayoutNode("item","container",B),c[o],["min","plus","last","minlast","pluslast"]);if(!z){q.style.display="none";}if(o&HAS_CHILD){}}};this.startRenameThis=function(z,q,u){this.$getCaptionElement=function(){return z;};var t=z.getAttribute("aname");var s=apf.xmldb.getNodeById(q);this.$getCaptionXml=function(){return t?s.getAttributeNode(t):s.firstChild;};this.getSelectFromRule=function(A,B){return[null,t?s.getAttributeNode(t):s.firstChild];};if(u){var o=function(B){this.removeEventListener("beforerename",o,true);this.removeEventListener("stoprename",w,true);if(B.args[2]==t){return false;}var A=[];A.push({func:"removeAttribute",args:[s,t]});A.push({func:"setAttribute",args:[s,B.args[2],s.getAttribute(t)||""]});B.action="multicall";B.args=A;};var w=function(){this.removeEventListener("beforerename",o,true);this.removeEventListener("stoprename",w,true);};this.addEventListener("beforerename",o,true);this.addEventListener("stoprename",w,true);}this.startRename();if(u){this.oTxt[apf.hasContentEditable?"innerHTML":"value"]=t;}};function i(s,q,w,u,o){a.$getNewContext("attribute");var z=a.$getLayoutNode("attribute","name");var t=a.$getLayoutNode("attribute","value");apf.setNodeValue(z,q);apf.setNodeValue(t,(w.length>50?"...":w));if(w.length>50){t.setAttribute("title",w);}z.setAttribute("aname",q);z.setAttribute("onmousedown","apf.lookup("+a.$uniqueId+").startRenameThis(this, '"+o+"', true);            event.cancelBubble=true;");z.setAttribute("onmouseup","            event.cancelBubble=true;            return false;");z.setAttribute("onkeydown","if (event.keyCode==13) {              this.blur();              return false;            };            event.cancelBubble=true;");z.setAttribute("onselectstart","event.cancelBubble = true;");z.setAttribute("ondblclick","event.cancelBubble = true;");t.setAttribute("aname",q);t.setAttribute("onmousedown","apf.lookup("+a.$uniqueId+").startRenameThis(this, '"+o+"');            event.cancelBubble=true;");t.setAttribute("onmouseup","apf.selectTextHtml(this);            event.cancelBubble=true;            return false;");t.setAttribute("onkeydown","if (event.keyCode==13) {              this.blur();              return false;            };            event.cancelBubble=true;");t.setAttribute("onselectstart","event.cancelBubble = true;");t.setAttribute("ondblclick","event.cancelBubble = true;");if(s.style){u=apf.insertHtmlNode(a.$getLayoutNode("attribute"),s,a.$getLayoutNode("item","begintag",u).nextSibling);m(u);m(a.$getLayoutNode("attribute","name",u));m(a.$getLayoutNode("attribute","value",u));}else{s.appendChild(a.$getLayoutNode("attribute"));}}function n(s,u,q){a.$getNewContext("textnode");var w=a.$getLayoutNode("textnode","text");var o=a.$getLayoutNode("textnode","tag");apf.setNodeValue(w,(u.length>50?"...":u));if(u.length>50){w.setAttribute("title",u);}w.setAttribute("onmousedown","apf.lookup("+a.$uniqueId+").startRenameThis(this, '"+q+"');");w.setAttribute("onmouseup","            event.cancelBubble=true;            return false;");w.setAttribute("onkeydown","if (event.keyCode==13) {              this.blur();              return false;            };            event.cancelBubble=true;");w.setAttribute("onselectstart","event.cancelBubble = true;");w.setAttribute("ondblclick","event.cancelBubble = true;");apf.setNodeValue(o,"&gt;");if(s.style){var t=apf.insertHtmlNode(a.$getLayoutNode("textnode"),s,s.lastChild);m(a.$getLayoutNode("textnode","text",t));}else{s.appendChild(a.$getLayoutNode("textnode"));}}this.initNode=function(D,o,C){this.$getNewContext("item");var z=(o&HAS_CHILD||this.emptyMessage&&this.$applyBindRule("empty",D));var F=this.$getLayoutNode("item");F.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+");            if (o.onmouseover)                 o.onmouseover(event, this);");F.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+");            if(o.onmouseout)                 o.onmouseout(event, this)");F.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");            if (o.onmousedown)                 o.onmousedown(event, this);");F.setAttribute(apf.xmldb.htmlIdTag,C);this.$setStyleClass(this.$getLayoutNode("item","openclose"),c[o]);this.$setStyleClass(this.$getLayoutNode("item","container"),c[o]);var s=this.$getLayoutNode("item","openclose");if(z){s.setAttribute(this.opencloseaction||"onmousedown","var o = apf.lookup("+this.$uniqueId+");                o.slideToggle(this);                if (o.onmousedown)                     o.onmousedown(event, this);                apf.cancelBubble(event,o);");}var t=this.$getLayoutNode("item","select");if(z){var E="var o = apf.lookup("+this.$uniqueId+");                o.slideToggle(this, true);";}t.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");            apf.cancelBubble(event, o);            if (o.hasFocus())                 o.select(this);            if (o.onmousedown)                 o.onmousedown(event, this);"+(E&&this.opencloseaction=="onmousedown"?E:""));var J=this.$getLayoutNode("item","begintag");apf.setNodeValue(J,"&lt;"+D.tagName);var q=this.$getLayoutNode("item","attributes");var A=D.attributes.length;if(typeof A=="function"){A=D.attributes.length();}for(var w=0;w<A;w++){var B=D.attributes.item(w);if(B.nodeName.match(/a_id|a_listen|a_doc|a_loaded/)){continue;}i(q,B.nodeName,B.nodeValue,null,C);}var G=this.$getLayoutNode("item","begintail");var u=this.$getLayoutNode("item","endtag");if(!(o&HAS_CHILD)){u.setAttribute("style","display:none");if(D.childNodes.length){n(q,D.childNodes[0].nodeValue,C);apf.setNodeValue(G,"&lt;/"+D.tagName+"&gt;");}else{apf.setNodeValue(G," /&gt;");}}else{apf.setNodeValue(u,"&lt;/"+D.tagName+"&gt;");apf.setNodeValue(G,"&gt;");}G.parentNode.appendChild(G);u.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");apf.cancelBubble(event, o);");var I=this.$applyBindRule("css",D);if(I){this.$setStyleClass(this.$getLayoutNode("item",null,this.$getLayoutNode("item")),I);if(I){this.dynCssClasses.push(I);}}return this.$getLayoutNode("item");};this.$deInitNode=function(q,t){var o=this.$getLayoutNode("item","container",t);var s=t.parentNode;o.parentNode.removeChild(o);s.removeChild(t);if(q.parentNode!=this.xmlRoot){this.fixItem(q,t,true);}if(this.emptyMessage&&!s.childNodes.length){this.setEmpty(s);}this.fixItem(q,t,true);if(q==this.selected){this.clearSelection();}};function m(o){if(!o.offsetHeight){return;}apf.setStyleClass(o,"highlight");$setTimeout(function(){apf.tween.css(o,"highlight",{anim:0,steps:20,interval:30},true);},400);}this.$updateNode=function(G,E){var B,w,t={};var u=this.$getLayoutNode("item","attributes",E);var z=this.$getLayoutNode("item","endtag",E);var J=this.$getLayoutNode("item","begintail",E);B=G.attributes.length;for(var w=0;w<B;w++){var D=G.attributes.item(w);if(D.nodeName.match(/a_id|a_listen|a_doc|a_loaded/)){continue;}t[D.nodeName]=D.nodeValue;}var I=false;var s=[],A=u.childNodes;for(w=0;w<A.length;w++){s.push(A[w]);}for(w=0;w<s.length;w++){if(s[w].nodeType!=1){continue;}if(s[w].className.indexOf("textnode")>-1){if(G.childNodes.length==1&&G.childNodes[0].nodeType==3){var F=this.$getLayoutNode("textnode","text",s[w]);if(G.firstChild.nodeValue!=F.innerHTML){F.innerHTML=G.firstChild.nodeValue;m(F);}}else{s[w].parentNode.removeChild(s[w]);apf.setNodeValue(J," /&gt;");}I=true;}if(s[w].className.indexOf("attribute")==-1){continue;}var o=this.$getLayoutNode("attribute","name",s[w]);var C=this.$getLayoutNode("attribute","value",s[w]);var q=o.innerHTML;if(!t[q]){s[w].parentNode.removeChild(s[w]);}else{if(t[q]!=C.innerHTML){C.innerHTML=t[q];m(C);delete t[q];}else{if(t[q]){delete t[q];}}}o.setAttribute("aname",q);C.setAttribute("aname",q);}for(var D in t){i(u,D,t[D],E,G.getAttribute(apf.xmldb.xmlIdTag));}if(!I&&G.childNodes.length==1&&G.childNodes[0].nodeType==3){n(u,G.childNodes[0].nodeValue);apf.setNodeValue(J,"</"+G.tagName+">");}var K=this.$applyBindRule("css",G);if(K||this.dynCssClasses.length){this.$setStyleClass(E,K,this.dynCssClasses);if(K&&!this.dynCssClasses.contains(K)){this.dynCssClasses.push(K);}}};this.clearEmpty=function(o){o.innerHTML="";};this.setEmpty=function(o){this.$getNewContext("empty");var q=this.$getLayoutNode("empty");this.$getLayoutNode("empty","caption").nodeValue=this.emptyMessage;apf.insertHtmlNode(q,o);if(!this.startClosed){if(o.style){}}};this.$setLoading=function(q,o){this.$getNewContext("Loading");this.$setLoadStatus(q,"potential");apf.insertHtmlNode(this.$getLayoutNode("loading"),o);};this.$removeLoading=function(o){if(!o){return;}this.$getLayoutNode("item","container",o).innerHTML="";};function l(s){if(s.action=="move-away"){this.fixItem(s.xmlNode,apf.xmldb.findHtmlNode(s.xmlNode,this),true);}if(s.action!="insert"){return;}var q=this.$findHtmlNode(s.xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);if(!q){return;}if(this.$hasLoadStatus(s.xmlNode,"loading")&&s.result.length>0){var o=this.$getLayoutNode("item","container",q);this.slideOpen(o,s.xmlNode);}else{this.fixItem(s.xmlNode,q);}if(this.$hasLoadStatus(s.xmlNode,"loading")){this.$setLoadStatus(s.xmlNode,"loaded");}}this.addEventListener("xmlupdate",l);this.addEventListener("keydown",function(A){var F=A.keyCode;var s=A.ctrlKey;var C=A.shiftKey;var B=this.$caret||this.$selected;if(!B||this.renaming){return;}var D=this.caret||this.selected;var t=this.$ext;switch(F){case 13:if(this.$tempsel){this.$selectTemp();}if(this.ctrlselect=="enter"){this.select(this.caret,true);}this.choose(B);break;case 32:if(s){this.select(this.caret,true);}break;case 46:if(this.$tempsel){this.$selectTemp();}this.remove(this.mode?this.caret:null);break;case 109:case 37:if(this.$tempsel){this.$selectTemp();}if(this.caret.selectSingleNode(this.each)){this.slideToggle(this.$caret||this.$selected,2);}break;case 107:case 39:if(this.$tempsel){this.$selectTemp();}if(this.caret.selectSingleNode(this.each)){this.slideToggle(this.$caret||this.$selected,1);}break;case 187:if(C){arguments.callee(39);}break;case 189:if(!C){arguments.callee(37);}break;case 38:if(!D&&!this.$tempsel){return;}var u=this.$tempsel?apf.xmldb.getNode(this.$tempsel):D;var z=this.getNextTraverse(u,true);if(z){var q=this.getTraverseNodes(z);do{var o=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(z,this)));if(o&&apf.getStyle(o,"display")=="block"&&q.length){z=q[q.length-1];}else{break;}}while(z&&(q=this.getTraverseNodes(z)).length);}else{if(this.getTraverseParent(u)==this.xmlRoot){this.dispatchEvent("selecttop");return;}else{z=this.getTraverseParent(u);}}if(z&&z.nodeType==1){this.$setTempSelected(z,s,C);}if(this.$tempsel&&this.$tempsel.offsetTop<t.scrollTop){t.scrollTop=this.$tempsel.offsetTop;}return false;break;case 40:if(!D&&!this.$tempsel){return;}var u=this.$tempsel?apf.xmldb.getNode(this.$tempsel):D;var z=this.getFirstTraverseNode(u);if(z){var o=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(u,this)));if(o&&apf.getStyle(o,"display")!="block"){z=null;}}while(!z){var E=this.getTraverseParent(u);if(!E){break;}var w=0;var q=this.getTraverseNodes(E);while(q[w]&&q[w]!=u){w++;}z=q[w+1];u=E;}if(z&&z.nodeType==1){this.$setTempSelected(z,s,C);}if(this.$tempsel&&this.$tempsel.offsetTop+this.$tempsel.offsetHeight>t.scrollTop+t.offsetHeight){t.scrollTop=this.$tempsel.offsetTop-t.offsetHeight+this.$tempsel.offsetHeight+10;}return false;break;case 33:break;case 34:break;case 36:break;case 35:break;}},true);var d=[];this.$add=function(G,A,C,I,D,u){var B=this.$getBindRule("insert",G)?true:false;var w=(B||G.selectSingleNode(this.each))?true:false;var z=this.startClosed;var t=(w?HAS_CHILD:0)|(z&&w||B?IS_CLOSED:0)|(u?IS_LAST:0);var F=this.initNode(G,t,A);var s=this.$getLayoutNode("item","container");if(!z&&!this.noCollapse){s.setAttribute("style","overflow:visible;height:auto;display:block;");}if(!w||B){s.setAttribute("style","display:none;");}if(B&&!this.$hasLoadStatus(G)){this.$setLoading(G,s);}else{if(!this.getTraverseNodes(G).length&&this.$applyBindRule("empty",G)){this.setEmpty(s);}}if(!I&&(C==this.xmlRoot||G==this.xmlRoot)){d.push(F);if(!apf.isChildOf(F,s,true)){d.push(s);}this.$setStyleClass(F,"root");this.$setStyleClass(s,"root");}else{if(!I){I=apf.xmldb.findHtmlNode(G.parentNode,this);I=I?this.$getLayoutNode("item","container",I):this.$int;}if(I==this.$int){this.$setStyleClass(F,"root");this.$setStyleClass(s,"root");if(this.renderRoot){var E=apf.xmldb.findHtmlNode(this.xmlRoot,this);I=this.$getLayoutNode("item","container",E);}}if(!D&&this.getNextTraverse(G)){D=apf.xmldb.findHtmlNode(this.getNextTraverse(G),this);}if(D&&D.parentNode!=I){D=null;}if(I.style&&this.getTraverseNodes(G.parentNode).length==1){this.clearEmpty(I);}if(I.style){var o=apf.insertHtmlNode(F,I,D);m(this.$getLayoutNode("item","select",o));if(!apf.isChildOf(F,s,true)){var s=apf.insertHtmlNode(s,I,D);}}else{I.insertBefore(F,D);if(!apf.isChildOf(I,s,true)){I.insertBefore(s,D);}}if(I.style){if(!z&&this.openOnAdd&&I!=this.$int&&I.style.display!="block"){this.slideOpen(I,C);}this.fixItem(C,apf.xmldb.findHtmlNode(C,this));if(this.getNextTraverse(G,true)){this.fixItem(this.getNextTraverse(G,true),apf.xmldb.findHtmlNode(this.getNextTraverse(G,true),this));}}}if(this.prerender){this.$addNodes(G,s,true);}else{this.$setLoadStatus(G,"potential");}return s;};this.$fill=function(){var o;apf.insertHtmlNodes(d,o||this.$int);d.length=0;};this.$getParentNode=function(o){return o?this.$getLayoutNode("item","container",o):this.$int;};this.$calcSelectRange=function(q,o){return[q,o];};this.$findContainer=function(o){return this.$getLayoutNode("item","container",o);};this.multiselect=false;this.$selectDefault=function(s){if(this.select(this.getFirstTraverseNode(s),null,null,null,true)){return true;}else{var o=this.getTraverseNodes(s);for(var q=0;q<o.length;q++){if(this.$selectDefault(o[q])){return true;}}}};this.$select=function(q){if(!q||!q.style){return;}this.$setStyleClass(this.$getLayoutNode("item","class",q),"selected");return q;};this.$deselect=function(q){if(!q){return;}this.$setStyleClass(this.$getLayoutNode("item","class",q),"",["selected","indicate"]);return q;};this.$indicate=function(q){if(!q){return;}this.$setStyleClass(this.$getLayoutNode("item","class",q),"indicate");return q;};this.$deindicate=function(q){if(!q){return;}this.$setStyleClass(this.$getLayoutNode("item","class",q),"",["indicate"]);return q;};this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);this.opencloseaction=this.$getOption("Main","openclose");this.$ext.onclick=function(o){this.host.dispatchEvent("click",{htmlEvent:o||event});};};this.$loadAml=function(o){this.openOnAdd=!apf.isFalse(o.getAttribute("openonadd"));this.startClosed=!apf.isFalse(this.getAttribute("startclosed")||this.$getOption("Main","startclosed"));this.noCollapse=apf.isTrue(this.getAttribute("nocollapse"));if(this.noCollapse){this.startClosed=false;}this.singleopen=apf.isTrue(this.getAttribute("singleopen"));this.prerender=!apf.isFalse(this.getAttribute("prerender"));};this.$destroy=function(){this.$ext.onclick=null;apf.destroyHtmlNode(this.oDrag);this.oDrag=null;};}).call(apf.markupedit.prototype=new apf.GuiElement());apf.aml.setElement("markupdit",apf.markupedit);apf.BindingEachRule=function(d,c){this.$init(c,apf.NODE_HIDDEN,d);var a=this;this.$noderegister=function(i){i.amlNode.$handleBindingRule(a.match,"each");i.amlNode.$sort=a.sort?new apf.Sort(a):null;};};(function(){this.$attrExcludePropBind=apf.extend({sort:1,"data-type":1,"date-format":1,"sort-method":1,order:1,"case-order":1},this.$attrExcludePropBind);this.$propHandlers.sort=this.$propHandlers["data-type"]=this.$propHandlers["date-format"]=this.$propHandlers.order=this.$propHandlers["case-order"]=function(c,d){delete this["c"+d];};this.addEventListener("prop.match",function(l){var j=this.parentNode;if(j.localName=="bindings"){var c=j.$amlNodes;for(var d=0;d<c.length;d++){c[d].$handleBindingRule(this.match,"each");}}else{j.$handleBindingRule(this.match,"each");}});var a;this.addEventListener("DOMNodeInserted",a=function(l){if(l.currentTarget!=this){return;}var j=this.parentNode;if(j.localName=="bindings"){j.addEventListener("noderegister",this.$noderegister);var c=j.$amlNodes;for(var d=0;d<c.length;d++){c[d].$handleBindingRule(this.match,"each");c[d].$sort=this.sort?new apf.Sort(this):null;}}else{j.$handleBindingRule(this.match,"each");j.$sort=this.sort?new apf.Sort(this):null;}});this.addEventListener("DOMNodeRemoved",function(l){if(l.currentTarget!=this){return;}var j=this.parentNode;if(j.localName=="bindings"){j.removeEventListener("noderegister",this.$noderegister);var c=j.$amlNodes;for(var d=0;d<c.length;d++){delete c[d].$sort;}}else{delete j.$sort;}});this.addEventListener("DOMNodeInsertedIntoDocument",a);}).call(apf.BindingEachRule.prototype=new apf.BindingRule());apf.aml.setElement("each",apf.BindingEachRule);apf.webdav=function(c,a){this.$init(a||"webdav",apf.NODE_HIDDEN,c);this.$locks={};this.$lockedStack=[];this.$lockId=0;this.$serverVars={};this.$fsCache=[];};(function(){this.useHTTP=true;this.method="GET";this.$showHidden=false;this.$booleanProperties.showhidden=true;this.$supportedProperties.push("showhidden");this.$propHandlers.showhidden=function(z){this.$showHidden=z;};this.$regVar=function(z,A){this.$serverVars[z]=A;return A;};function l(){for(var z=0;z<arguments.length;z++){if(typeof this.$serverVars[arguments[z]]!="undefined"){this.$serverVars[arguments[z]]=null;delete this.$serverVars[arguments[z]];}}}this.$getVar=function(z){return this.$serverVars[z]||"";};this.doRequest=function(F,B,C,E,D,A){if(!this.$getVar("authenticated")){return a.call(this,{method:this.doRequest,context:this,args:arguments});}if(D){if(!E){E={};}E["Content-type"]="text/xml; charset=utf-8";}var z=this;return this.get(this.$server+B||"",{callback:function(K,J,G){if(J!=apf.SUCCESS){var O;O=u.call(this,"Url: "+G.url+"\nInfo: "+G.message);if(G.tpModule.retryTimeout(G,J,z,O)===true){return true;}throw O;}var N=parseInt(G.http.status);if(N==401){return;}var I=(G.http.responseText||"");if(I.replace(/^[\s\n\r]+|[\s\n\r]+$/g,"")!=""&&I.indexOf("<?xml version=")==0){try{K=(G.http.responseXML&&G.http.responseXML.documentElement)?apf.xmlParseError(G.http.responseXML):apf.getXmlDom(G.http.responseText);if(!apf.supportNamespaces){K.setProperty("SelectionLanguage","XPath");}G.data=K.documentElement;}catch(M){throw u.call(this,"Received invalid XML\n\n"+M.message);}}if(typeof F=="function"){F.call(z,K,J,G,A);}},nocache:false,useXML:false,ignoreOffline:true,data:C||"",headers:E,username:this.$getVar("auth-username")||null,password:this.$getVar("auth-password")||null});};function c(B){l.call(this,"auth-password");var A={username:this.$getVar("auth-username"),server:this.$server,message:B||"Access denied. Please check you username or password."};var z=this.$getVar("auth-callback");if(z){z(null,apf.ERROR,A);l.call(this,"auth-callback");}return this.dispatchEvent("authfailure",A);}function m(B){l.call(this,"auth-password");var A={username:this.$getVar("auth-username"),server:this.$server,message:B||"Could not connect to server, please contact your System Administrator."};var z=this.$getVar("auth-callback");if(z){z(null,apf.ERROR,A);l.call(this,"auth-callback");}return this.dispatchEvent("connectionerror",A);}function u(z){return new Error(apf.formatErrorString(0,this,"WebDAV Communication error",z));}function a(D){var z,C=false;if(apf.isIE){try{z=new ActiveXObject("Msxml2.DOMDocument");}catch(B){}}else{if(document.implementation&&document.implementation.createDocument){try{z=document.implementation.createDocument("","",null);}catch(B){}}}try{if(apf.isIE){z.async=false;z.load(this.$server+this.$rootPath);}}catch(B){C=true;}var A=this.ownerDocument.getElementsByTagNameNS(apf.ns.apf,"auth")[0];if(C){A.authRequired(D);}else{this.$regVar("authenticated",true);if(D&&D.method){D.method.apply(D.context,D.args);}}}this.authenticate=function(C,z,B){this.$regVar("auth-username",C);this.$regVar("auth-password",z);this.$regVar("auth-callback",B);var A=apf.document.getElementsByTagNameNS(apf.ns.apf,"auth")[0];if(!A){return;}this.doRequest(function(G,F,E){if(E.http.status==401){return A.authRequired();}this.$regVar("authenticated",true);var D=this.$getVar("auth-callback");if(D){D(null,F,E);l.call(this,"auth-callback");}},this.$rootPath,null,{},false,null);};this.reset=function(){l.call(this,"authenticated");l.call(this,"auth-username");l.call(this,"auth-password");l.call(this,"auth-callback");};this.read=function(z,A){this.method="GET";this.doRequest(function(D,C,B){var F=parseInt(B.http.status);if(F==403){var E=u.call(this,"Unable to read file. Server says: "+apf.webdav.STATUS_CODES["403"]);if(this.dispatchEvent("error",{error:E,bubbles:true})===false){throw E;}}else{A?A.call(this,D,C,B):this.dispatchEvent("onfilecontents",{data:D});}},z);};this.readDir=function(z,A){if(z.charAt(z.length-1)!="/"){z+="/";}return this.getProperties(z,1,A);};this.mkdir=function(z,B){var A=this.lock(z);if(!A.token){return j.call(this,A,"mkdir",arguments);}this.method="MKCOL";this.doRequest(function(E,D,C){var G=parseInt(C.http.status);if(G==201){}else{if(G==403||G==405||G==409||G==415||G==507){var F=u.call(this,"Unable to create directory '"+z+"'. Server says: "+apf.webdav.STATUS_CODES[String(G)]);if(this.dispatchEvent("error",{error:F,bubbles:true})===false){throw F;}}}this.unlock(A);},z,null,A.token?{If:"<"+A.token+">"}:null,true,B);};this.list=function(z){return this.getProperties(z,0);};this.write=function(z,A,C,D){var B=this.lock(z);if(!B.token){return j.call(this,B,"write",arguments);}this.method="PUT";this.doRequest(function(G,F,E){var J=parseInt(E.http.status);if(J==409||J==405){var I=u.call(this,"Unable to write to file. Server says: "+apf.webdav.STATUS_CODES[String(J)]);if(this.dispatchEvent("error",{error:I,bubbles:true})===false){throw I;}D.call(this,G,apf.ERROR,E);}else{this.getProperties(z,0,D);}},z,A,C?{If:"<"+C+">"}:null);};this.copy=function(A,z,B,E){if(!z||A==z){return;}var C=this.lock(A);if(!C.token){return j.call(this,C,"copy",arguments);}this.method="COPY";var D={Destination:this.$server+z};if(typeof B=="undefined"){B=true;}if(!B){D.Overwrite="F";}if(C.token){D.If="<"+C.token+">";}this.doRequest(function(I,G,F){q.call(this,A);var K=parseInt(F.http.status);if(K==403||K==409||K==412||K==423||K==424||K==502||K==507){var J=u.call(this,"Unable to copy file '"+A+"' to '"+z+"'. Server says: "+apf.webdav.STATUS_CODES[String(K)]);if(this.dispatchEvent("error",{error:J,bubbles:true})===false){throw J;}}else{this.getProperties(z,0,E);}},A,null,D);};this.move=function(A,z,B,E){if(!z||A==z){return;}var C=this.lock(A);if(!C.token){return j.call(this,C,"move",arguments);}this.method="MOVE";var D={Destination:this.$server+z};if(typeof B=="undefined"){B=true;}if(!B){D.Overwrite="F";}if(C.token){D.If="<"+C.token+">";}this.doRequest(function(I,G,F){q.call(this,A);var K=parseInt(F.http.status);if(K==403||K==409||K==412||K==423||K==424||K==502){var J=u.call(this,"Unable to move file '"+A+"' to '"+z+"'. Server says: "+apf.webdav.STATUS_CODES[String(K)]);if(this.dispatchEvent("error",{error:J,bubbles:true})===false){throw J;}}else{o.call(this,A).path=z;}E.call(this,I,G,F);},A,null,D);};this.remove=function(z,B){var A=this.lock(z);if(!A.token){return j.call(this,A,"remove",arguments);}this.method="DELETE";this.doRequest(function(E,D,C){q.call(this,z);var G=parseInt(C.http.status);if(G==423||G==424){var F=u.call(this,"Unable to remove file '"+z+"'. Server says: "+apf.webdav.STATUS_CODES[String(G)]);if(this.dispatchEvent("error",{error:F,bubbles:true})===false){throw F;}}B.call(this,E,D,C);},z,null,A.token?{If:"<"+A.token+">"}:null);};this.lock=function(A,z,F,E,G){var C=this.$locks[A];if(C&&C.token){return C;}this.method="LOCK";F=F?"Infinite, Second-4100000000":"Second-"+F;var D={Timeout:F};if(z){D.Depth=z||"Infinity";}if(E){D.If="<"+E+">";}var B='<?xml version="1.0" encoding="utf-8"?><D:lockinfo xmlns:D="'+apf.webdav.NS.D+'"><D:lockscope><D:exclusive /></D:lockscope><D:locktype><D:write /></D:locktype><D:owner><D:href>'+document.location.toString().escapeHTML()+ +"</D:href></D:owner></D:lockinfo>";this.doRequest(s,A,B,D,true,G);return i.call(this,A);};this.unlock=function(z,A){if(typeof z=="string"){z=this.$locks[z];}if(!z||!z.token){return;}this.method="UNLOCK";this.doRequest(function(D,C,B){q.call(this,B.url.replace(this.$server,""));},z.path,null,{"Lock-Token":"<"+z.token+">"},true,A);};function i(z){return $this.locks[z]={path:z,id:this.$lockId++,token:null};}function s(E,z,C){var F=parseInt(C.http.status),D=C.url.replace(this.$server,""),I=this.$locks[D]||i.call(this,D);if(F==409||F==423||F==412){q.call(this,C.url.replace(this.$server,""));var G=u.call(this,"Unable to apply lock to '"+D+"'. Server says: "+apf.webdav.STATUS_CODES[String(F)]);if(this.dispatchEvent("error",{error:G,bubbles:true})===false){throw G;}}var B=apf.webdav.NS,J=$xmlns(E,"owner",B.ns0)[0],A=$xmlns(E,"locktoken",B.D)[0];I.path=D;I.type="write";I.scope=$xmlns(E,"exclusive",B.D).length?"exclusive":"shared";I.depth=$xmlns(E,"depth",B.D)[0].firstChild.nodeValue;I.owner=$xmlns(J,"href",B.ns0)[0].firstChild.nodeValue;I.timeout=$xmlns(E,"timeout",B.D)[0].firstChild.nodeValue;I.token=$xmlns(A,"href",B.D)[0].firstChild.nodeValue.split(":")[1];t.call(this,I);}function q(z){var A=this.$locks[z];if(!A){return;}t.call(this,A,true);this.$locks[z]=A=null;delete this.$locks[z];}function j(A,z,B){return this.$lockedStack.push({lockId:A.id,func:z,args:B});}function t(B,z){for(var A=this.$lockedStack.length-1;A>=0;A--){if(this.$lockedStack[A].lockId!=B.id){continue;}if(!z){this[this.$lockedStack[A].func].apply(this,this.$lockedStack[A].args);}this.$lockedStack.remove(A);}}this.getProperties=function(A,z,D,C){this.method="PROPFIND";var B='<?xml version="1.0" encoding="utf-8" ?><D:propfind xmlns:D="'+apf.webdav.NS.D+'"><D:allprop /></D:propfind>';C=C||{};C.Depth=typeof z!="undefined"?z:1;this.doRequest(d,A,B,C,true,D);};this.setProperties=function(A,z,B,C){this.method="PROPPATCH";this.doRequest(function(F,E,D){},A,w.call(this,z,B),C?{If:"<"+C+">"}:null,true);};function w(A,C){var F=['<?xml version="1.0" encoding="utf-8" ?>','<D:propertyupdate xmlns:D="',apf.webdav.NS.D,'">'];var z=false,E,D,B;for(E in A){z=true;break;}if(z){F.push("<D:set>");for(E in A){for(D in A[E]){F.push("<D:prop>",A[E][D],"</D:prop>");}}F.push("</D:set>");}z=false;for(E in C){z=true;break;}if(z){F.push("<D:remove><D:prop>");for(E in C){for(D=0,B=C[E].length;D<B;D++){F.push("<",C[E][D],' xmlns="',E,'"/>');}}F.push("</D:prop></D:remove>");}F.push("</D:propertyupdate>");return F.join("");}function d(F,E,z,G){if(parseInt(z.http.status)==403){return;}var D=$xmlns(F,"response",apf.webdav.NS.D),C=[];if(D.length){this.$regVar("authenticated",true);}for(var B=D.length>1?1:0,A=D.length;B<A;B++){C.push(n.call(this,D[B]));}if(G){G.call(this,"<files>"+C.join("")+"</files>",E,z);}}function n(I){var C=apf.webdav.NS,D=$xmlns(I,"href",C.D)[0].firstChild.nodeValue.replace(/[\\\/]+$/,""),E=decodeURIComponent(D.split("/").pop()),G=(E.charAt(0)==".");if(!this.$showHidden&&G){return"";}var A,F=o.call(this,D);if(F&&typeof F.id=="number"){A=F.id;}else{A=this.$fsCache.length;}var z=$xmlns(I,"collection",C.D).length>0?"folder":"file",J=$xmlns(I,"getcontenttype",C.D),B=$xmlns(I,"executable",C.lp2);F=this.$fsCache[A]={id:A,path:D,type:z,size:parseInt(z=="file"?$xmlns(I,"getcontentlength",C.lp1)[0].firstChild.nodeValue:0),name:E,contentType:(z=="file"&&J.length?J[0].firstChild.nodeValue:""),creationDate:$xmlns(I,"creationdate",C.lp1)[0].firstChild.nodeValue,lastModified:$xmlns(I,"getlastmodified",C.lp1)[0].firstChild.nodeValue,etag:$xmlns(I,"getetag",C.lp1)[0].firstChild.nodeValue,lockable:($xmlns(I,"locktype",C.D).length>0),executable:(B.length>0&&B[0].firstChild.nodeValue=="T")};return F.xml="<"+z+" id='"+A+"'  type='"+z+"' size='"+F.size+"' name='"+F.name+"' contenttype='"+F.contentType+"' creationdate='"+F.creationDate+"' lockable='"+F.lockable.toString()+"' hidden='"+G.toString()+"' executable='"+F.executable.toString()+"'/>";}function o(z){for(var B=0,A=this.$fsCache.length;B<A;B++){if(this.$fsCache[B].path==z){return this.$fsCache[B];}}return null;}this.getItemById=function(z){if(typeof z=="string"){z=parseInt(z);}return this.$fsCache[z]||null;};this.exec=function(E,A,D){var C=this.getItemById(A[0]);switch(E){case"login":case"authenticate":this.authenticate(A[0],A[1],D);break;case"logout":this.reset();break;case"read":this.read(C.path,D);break;case"create":this.write(C.path+"/"+A[1],A[2],null,D);break;case"write":case"store":case"save":this.write(C.path,A[1],null,D);break;case"copy":case"cp":var B=this.getItemById(A[1]);this.copy(C.path,B.path,A[2],D);break;case"rename":C=this.getItemById(A[1]);if(!C){break;}var z=C.path.replace(C.name,"");this.move(C.path,z+A[0],false,D);break;case"move":case"mv":this.move(C.path,this.getItemById(A[1]).path+"/"+C.name,false,D);break;case"remove":case"rmdir":case"rm":this.remove(C.path,D);break;case"scandir":case"readdir":this.readDir(C.path,D);break;case"getroot":this.getProperties(this.$rootPath,0,D);break;case"mkdir":break;case"lock":this.lock(C.path,null,null,null,D);break;case"unlock":this.unlock(C.path,D);break;default:break;}};}).call(apf.webdav.prototype=new apf.Teleport());apf.aml.setElement("webdav",apf.webdav);apf.webdav.NS={D:"DAV:",ns0:"DAV:",lp1:"DAV:",lp2:"http://apache.org/dav/props/"};apf.webdav.STATUS_CODES={"100":"Continue","101":"Switching Protocols","102":"Processing","200":"OK","201":"Created","202":"Accepted","203":"None-Authoritive Information","204":"No Content","1223":"No Content","205":"Reset Content","206":"Partial Content","207":"Multi-Status","300":"Multiple Choices","301":"Moved Permanently","302":"Found","303":"See Other","304":"Not Modified","305":"Use Proxy","307":"Redirect","400":"Bad Request","401":"Unauthorized","402":"Payment Required","403":"Forbidden","404":"Not Found","405":"Method Not Allowed","406":"Not Acceptable","407":"Proxy Authentication Required","408":"Request Time-out","409":"Conflict","410":"Gone","411":"Length Required","412":"Precondition Failed","413":"Request Entity Too Large","414":"Request-URI Too Large","415":"Unsupported Media Type","416":"Requested range not satisfiable","417":"Expectation Failed","422":"Unprocessable Entity","423":"Locked","424":"Failed Dependency","500":"Internal Server Error","501":"Not Implemented","502":"Bad Gateway","503":"Service Unavailable","504":"Gateway Time-out","505":"HTTP Version not supported","507":"Insufficient Storage"};apf.editor=function(c,a){this.$init(a||"editor",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.ContentEditable);this.value="";this.$value="";this.$oWin=this.$oBookmark=this.$fTimer=null;this.isContentEditable=true;this.$supportedProperties.push("value","characterset");this.$propHandlers.value=function(i){if(typeof i!="string"){i="";}if(this.$value.replace(/\r/g,"")==i){return;}this.$value=i;i=i.replace(/<p[^>]*>/gi,"").replace(/<\/p>/gi,"<br _apf_marker='1' /><br _apf_marker='1' />");i=apf.htmlCleaner.prepare(i);if(this.$pluginsActive=="code"){this.$plugins.code.update(this,i);}else{this.$activeDocument.body.innerHTML=i;this.$controlAgentBehavior(this.$activeDocument.body);}this.dispatchEvent("sethtml",{editor:this});};this.makeEditable=function(){var i=this;if(apf.isIE){$setTimeout(function(){i.$activeDocument.body.contentEditable=true;});}else{try{this.$activeDocument.designMode="on";if(apf.isGecko){this.$activeDocument.execCommand("enableObjectResizing",false,this.imagehandles);this.$activeDocument.execCommand("enableInlineTableEditing",false,this.tablehandles);}}catch(j){}}this.dispatchEvent("complete",{editor:this});};this.getValue=function(i){return(this.$value=apf.htmlCleaner.parse(this.$activeDocument.body.innerHTML,i));};this.setValue=function(i){return this.setProperty("value",i,false,true);};this.addEventListener("$clear",function(i){if(!i.nomsg){this.value="";return this.$propHandlers.value.call(this,"");}});function d(j){var i=this;$setTimeout(function(){var l=this.$activeDocument.body.innerHTML;if(l.match(/mso[a-zA-Z]+/i)){var m=i.$plugins.pasteword;if(m){i.$propHandlers.value.call(i,m.parse(l));}}if(i.realtime){i.change(i.getValue());}});}function c(l){if(this.$oBookmark&&apf.isGecko){var n=i.$selection.getBookmark();if(typeof n.start=="undefined"&&typeof n.end=="undefined"){}}var m=l.which,j=l.button,i=this;$setTimeout(function(){var o=((m==3)||(j==2));if(apf.document.activeElement!=this){i.focus({});}else{if(!o){i.$focus({});}}});apf.AbstractEvent.stop(l);}function a(i){if(this.state==apf.DISABLED){return;}this.$notifyAllPlugins("context",i);}this.$focus=function(l){if(!this.$ext||this.$ext.disabled){return;}this.setProperty("state",(this.$pluginsActive=="code")?apf.DISABLED:apf.OFF);this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");var i=this;function j(){try{if(!i.$fTimer||document.activeElement!=i.$ext){i.$visualFocus(true);clearInterval(i.$fTimer);}else{clearInterval(i.$fTimer);return;}}catch(m){}}if(l&&l.mouse&&apf.isIE){clearInterval(this.$fTimer);this.$fTimer=setInterval(j,1);}else{j();}};this.$isContentEditable=function(i){return apf.isChildOf(this.$activeDocument,i.srcElement,true);};this.$blur=function(l){if(!this.$ext){return;}var i=apf.popup.last&&apf.lookup(apf.popup.last);if(i&&i.editor==this){apf.popup.forceHide();}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);var j=(this.$pluginsActive=="code");if(!this.realtime||j){this.change(j?this.$plugins.code.getValue():this.getValue());}this.setProperty("state",apf.DISABLED);};this.$addListeners=function(){var i=this;apf.AbstractEvent.addListener(this.$activeDocument,"mouseup",c.bindWithEvent(this,false));apf.AbstractEvent.addListener(this.$activeDocument,"keyup",apf.window.$keyup);apf.AbstractEvent.addListener(this.$activeDocument,"keydown",apf.window.$keydown);apf.AbstractEvent.addListener(this.$activeDocument,"mousedown",function(j){j=j||window.event;i.$selection.cache();apf.popup.forceHide();apf.window.$mousedown(j);});apf.AbstractEvent.addListener(this.$activeDocument,"contextmenu",a.bindWithEvent(this,false));apf.AbstractEvent.addListener(this.$activeDocument,"focus",apf.window.$focusevent);apf.AbstractEvent.addListener(this.$activeDocument,"blur",apf.window.$blurevent);this.$activeDocument.host=this;apf.AbstractEvent.addListener(this.$activeDocument.body,"paste",d.bindWithEvent(this,false));};this.$draw=function(){this.$editable(function(){var l=this.$getLayoutNode("main","editor",this.$ext),i=this;this.iframe=document.createElement("iframe");this.iframe.setAttribute("frameborder","0");this.iframe.setAttribute("border","0");this.iframe.setAttribute("marginwidth","0");this.iframe.setAttribute("marginheight","0");l.appendChild(this.iframe);this.$oWin=this.iframe.contentWindow;this.$activeDocument=this.$oWin.document;this.$selection=new apf.selection(this.$oWin,this.$activeDocument,this);var j=apf.queryValue($xmlns(apf.skins.skins[this.skinName.split(":")[0]].xml,"docstyle",apf.ns.aml)[0],"text()");if(!j){j="                    html {                        cursor: text;                        border: 0;                    }                    body {                        margin: 8px;                        padding: 0;                        border: 0;                        color: #000;                        font-family: Verdana,Arial,Helvetica,sans-serif;                        font-size: 10pt;                        background: #fff;                        word-wrap: break-word;                    }                    .itemAnchor {                        background:url(images/editor/items.gif) no-repeat left bottom;                        line-height:6px;                        overflow:hidden;                        padding-left:12px;                        width:12px;                    }                    .visualAid table,                    .visualAid table td {                        border: 1px dashed #bbb;                    }                    .visualAid table td {                        margin: 8px;                    }                    h1 {                        margin : 15px 0 15px 0;                    }                    p {                        margin: 0;                        padding: 0;                    }                    sub, sup {                        line-height: 10px;                    }";}var m=this.getAttribute("characterset")||this.getAttribute("charset")||apf.characterSet;this.$activeDocument.open();this.$activeDocument.write('<?xml version="1.0" encoding="'+m+'"?>                <html>                <head>                    <meta http-equiv="Content-Type" content="text/html; charset='+m+'" />                    <title></title>                    <style type="text/css">'+j+'</style>                </head>                <body class="visualAid"></body>                </html>');this.$activeDocument.close();if(apf.hasFocusBug){apf.sanitizeTextbox(this.$activeDocument.body);}apf.layout.setRules(this.$ext,this.$uniqueId+"_editor","var o = apf.all["+this.$uniqueId+"];                if (o) o.$resize()");apf.layout.queue(this.$ext);this.$addListeners();this.makeEditable();$setTimeout(function(){i.setProperty("state",apf.DISABLED);});});};this.$resize=function(){if(!this.iframe||!this.iframe.parentNode||!this.$ext.offsetHeight){return;}var i=(this.$ext.offsetHeight-this.oToolbar.offsetHeight-2);if(!i||i<0){i=0;}this.iframe.parentNode.style.height=i+"px";this.$notifyAllPlugins("resize");if(this.$pluginsActive=="code"){this.$plugins.code.setSize(this);}};this.addEventListener("DOMNodeInsertedIntoDocument",function(){this.$int=this.$getLayoutNode("main","container",this.$ext);if(apf.isOnlyChild(this.firstChild,[3,4])){this.$handlePropSet("value",this.firstChild.nodeValue.trim());}});this.$destroy=function(){this.$selection.$destroy();this.$selection=this.$activeDocument.host=this.oToobar=this.$activeDocument=this.$oWin=this.iframe=null;};}).call(apf.editor.prototype=new apf.StandardBinding());apf.aml.setElement("editor",apf.editor);apf.text=function(c,a){this.$init(a||"text",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.ChildValue,apf.Cache);this.$focussable=true;this.focussable=false;this.$allowSelect=true;this.$hasStateMessages=true;this.$textTimer=this.$lastMsg=this.$lastClass=this.$changedHeight=null;this.$booleanProperties.scrolldown=true;this.$booleanProperties.secure=true;this.$supportedProperties.push("behavior","scrolldown","secure","value");this.$propHandlers.behavior=function(a){this.addOnly=a=="addonly";};this.$propHandlers.value=function(c){var a=false;if(c){this.$removeClearMessage();}if(typeof c!="string"){c=c?c.toString():"";}if(this.secure){c=c.replace(/<a /gi,"<a target='_blank' ").replace(/<object.*?\/object>/g,"").replace(/<script.*?\/script>/g,"").replace(new RegExp("ondblclick|onclick|onmouseover|onmouseout|onmousedown|onmousemove|onkeypress|onkeydown|onkeyup|onchange|onpropertychange","g"),"ona");}if(this.addOnly){if(a){a.contents+=c;}else{this.$int.insertAdjacentHTML("beforeend",c);}}else{c=c.replace(/\<\?xml version="1\.0" encoding="UTF-16"\?\>/,"");if(a){a.contents=c;}else{this.$int.innerHTML=c;}}if(apf.cannotSizeIframe&&this.oIframe){this.oIframe.style.width=this.oIframe.offsetWidth+"px";}if(this.scrolldown&&this.$scrolldown){this.oScroll.scrollTop=this.oScroll.scrollHeight;}};this.$propHandlers["empty-message"]=function(a){if(!this.childNodes.length){this.$setClearMessage(this["empty-message"]);}};this.setValue=function(a){this.setProperty("value",a,false,true);};this.getValue=function(){return this.$int.innerHTML;};this.addEventListener("keydown",function(c){var a=c.keyCode;switch(a){case 33:this.$int.scrollTop-=this.$int.offsetHeight;break;case 34:this.$int.scrollTop+=this.$int.offsetHeight;break;case 35:this.$int.scrollTop=this.$int.scrollHeight;break;case 36:this.$int.scrollTop=0;break;case 38:this.$int.scrollTop-=10;break;case 40:this.$int.scrollTop+=10;break;default:return;}return false;},true);this.$xmlUpdate=function(j,c,i,d){if(this.addOnly&&j!="add"){return;}if(d){d.xmlNode=this.addOnly?c:this.xmlRoot;}if(this.addOnly){apf.xmldb.nodeConnect(this.documentId,c,null,this);var a=this.$findHtmlNode(i.getAttribute("id")+"|"+this.$uniqueId);this.$propHandlers.value.call(this,this.$applyBindRule("value",c)||"");}else{this.$propHandlers.value.call(this,this.$applyBindRule("value",this.xmlRoot)||"");}};this.$load=function(c){apf.xmldb.addNodeListener(c,this);var d=this.$applyBindRule("value",c);if(d||typeof d=="string"){if(this.caching){var a=this.$findHtmlNode(c.getAttribute("id")+"|"+this.$uniqueId);if(a){a.contents=d;}}this.$propHandlers.value.call(this,d);}else{this.$propHandlers.value.call(this,"");}};this.$getCurrentFragment=function(){return{nodeType:1,contents:this.$int.innerHTML};};this.$setCurrentFragment=function(a){this.$int.innerHTML=a.contents;if(this.scrolldown){this.$int.scrollTop=this.$int.scrollHeight;}};this.$setClearMessage=this.$updateClearMessage=function(c,a){if(this.$lastClass){this.$removeClearMessage();}apf.setStyleClass(this.$ext,(this.$lastClass=this.$baseCSSname+(a||"Empty").uCaseFirst()));if(c){if(!this.height){if(this.$int.offsetHeight&&apf.getStyle(this.$int,"height")=="auto"&&(this.$changedHeight=true)){this.$int.style.height=(this.$int.offsetHeight-apf.getHeightDiff(this.$int))+"px";}this.$int.innerHTML=c;}this.$lastMsg=this.$int.innerHTML;}};this.$removeClearMessage=function(){if(this.$lastClass){apf.setStyleClass(this.$ext,"",[this.$lastClass]);this.$lastClass=null;}if(this.$int.innerHTML==this.$lastMsg){if(this.$changedHeight&&!(this.$changedHeight=false)){this.$int.style.height="";}this.$int.innerHTML="";}};this.caching=false;this.$draw=function(){var a=this;this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);if(apf.hasCssUpdateScrollbarBug&&!apf.getStyle(this.$int,"padding")){this.$fixScrollBug();}this.oScroll=this.oFocus?this.oFocus.parentNode:this.$int;this.$scrolldown=true;this.oScroll.onscroll=function(){a.$scrolldown=this.scrollTop>=this.scrollHeight-this.offsetHeight+apf.getVerBorders(this);};clearInterval(this.$textTimer);this.$textTimer=setInterval(function(){if(a.oScroll&&a.$scrolldown&&a.scrolldown){a.oScroll.scrollTop=a.oScroll.scrollHeight;}},60);if(this.$int.tagName.toLowerCase()=="iframe"){if(apf.isIE){this.oIframe=this.$int;var d=this.skin.selectSingleNode("iframe_style");this.oIframe.contentWindow.document.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                    <head>                        <style>'+(d?d.firstChild.nodeValue:"")+"</style>                        <script>                            document.onkeydown = function(e){                                if (!e) e = event;                                if (top.apf.disableF5 && e.keyCode == 116) {                                    e.keyCode = 0;                                    return false;                                }                            }                        <\/script>                    </head>                    <body oncontextmenu='return false'></body>");this.$int=this.oIframe.contentWindow.document.body;}else{var c=document.createElement("div");this.$ext.parentNode.replaceChild(c,this.$ext);c.className=this.$ext.className;this.$ext=this.$int=c;}}else{this.$int.onselectstart=function(i){(i?i:event).cancelBubble=true;};this.$int.oncontextmenu=function(i){if(!this.host.contextmenus){(i?i:event).cancelBubble=true;}};this.$int.style.cursor="";this.$int.onmouseover=function(i){if(!self.STATUSBAR){return;}if(!i){i=event;}if(i.srcElement.tagName.toLowerCase()=="a"){if(!this.lastStatus){this.lastStatus=STATUSBAR.getStatus();}STATUSBAR.status("icoLink.gif",i.srcElement.getAttribute("href"));}else{if(this.lastStatus){STATUSBAR.status(this.lastStatus[0],this.lastStatus[1]);this.lastStatus=false;}}};}};this.addEventListener("DOMNodeRemovedFromDocument",function(){clearInterval(this.$textTimer);apf.destroyHtmlNode(this.oDrag);if(this.oScroll){this.oScroll.onscoll=this.oScroll=null;}this.oDrag=this.oIframe=this.oFocus=null;});}).call(apf.text.prototype=new apf.BaseSimple());apf.aml.setElement("text",apf.text);apf.propedit=function(c,a){this.$init(a||"propedit",apf.NODE_VISIBLE,c);};(function(){this.$init(function(){this.$nodes=[];this.$editors={};this.dynCssClasses=[];this.addEventListener("keydown",a,true);});this.$focussable=true;this.$isTreeArch=true;this.$isWindowContainer=-1;this.startClosed=true;this.$animType=apf.tween.NORMAL;this.$animSteps=3;this.$animSpeed=20;this.$useiframe=0;this.$attrExcludePropBind=apf.extend({properties:1},this.$attrExcludePropBind);this.$booleanProperties.iframe=true;this.$propHandlers.properties=function(i){var d=this;apf.setModel(i,{load:function(j){if(typeof j=="string"){j=apf.getXml(j);}d.$properties=j;if(d.xmlRoot){d.$load(j);}}});};this.$canLoadData=function(){return true;};this.$columns=["50%","50%"];this.$propHandlers.columns=function(d){this.$columns=d&&d.splitSafe(",")||["50%","50%"];if(this.$headings){this.$headings[0].setProperty("width",this.$columns[0]);this.$headings[1].setProperty("width",this.$columns[1]);}};function c(){var d=(this.current||this.$selected),i=this.$int;i.scrollTop=(d.offsetTop)-21;}this.$findHtmlNode=function(d){return this.$pHtmlDoc.getElementById(d);};function a(z){var E=z.keyCode,j=z.ctrlKey,q=z.shiftKey;var d=this.$lastEditor&&this.$lastEditor[2],C=this.$useiframe?this.oDoc.documentElement:this.$int,o,u,m,D,B,s,i;switch(E){case 36:return false;case 35:return false;case 107:break;case 37:this.$slideToggle(this.$selected.firstChild);return false;case 107:case 39:this.$slideToggle(this.$selected.firstChild);return false;case 38:var u=d;var A=d.previousSibling;while(A&&A.nodeType!=1){A=A.previousSibling;}if(A){var l=A,t;while((t=l.selectNodes("prop")).length){l=t[t.length-1];}A=l;}else{A=u.parentNode;if(A[apf.TAGNAME]!="prop"){A=A.previousSibling;while(A&&A.nodeType!=1){A=A.previousSibling;}if(A&&A[apf.TAGNAME]!="prop"){A=(t=A.selectNodes("prop"))[t.length-1];while(A&&A.nodeType!=1){A=A.previousSibling;}}}}if(!A){return;}var w=apf.xmldb.findHtmlNode(A,this);while(!w.offsetWidth){w=apf.xmldb.findHtmlNode(A=A.parentNode,this);}var n=apf.getAbsolutePosition(w,this.$int)[1]-(w.offsetHeight/2);if(n<=this.$ext.scrollTop){this.$ext.scrollTop=n;}this.select(w);return false;case 40:var u,A=(u=d).selectSingleNode("prop")||u.nextSibling;do{while(A&&(A.nodeType!=1||A[apf.TAGNAME]!="prop")){A=A.nextSibling;}if(!A){A=u.parentNode.nextSibling;if(A&&A[apf.TAGNAME]!="prop"){A=A.selectSingleNode("prop");}}}while(A&&A.nodeType!=1);if(!A){return;}var w=apf.xmldb.findHtmlNode(A,this);while(!w.offsetWidth){w=apf.xmldb.findHtmlNode(A=A.parentNode,this);}if(A==u){A=u.nextSibling;while(A&&(A.nodeType!=1||A[apf.TAGNAME]!="prop")){A=A.nextSibling;}var w=apf.xmldb.findHtmlNode(A,this);}var n=apf.getAbsolutePosition(w,this.$int)[1]+(w.offsetHeight/2);if(n>this.$ext.scrollTop+this.$ext.offsetHeight){this.$ext.scrollTop=n-this.$ext.offsetHeight;}this.select(w);return false;}}this.$focus=function(){if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;}this.$setStyleClass(this.oFocus||this.$ext,this.$baseCSSname+"Focus");if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");}};this.$blur=function(){if(this.renaming){this.stopRename(null,true);}if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;}this.$setStyleClass(this.oFocus||this.$ext,"",[this.$baseCSSname+"Focus"]);if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,"",[this.$baseCSSname+"Focus"]);}};this.$slideToggle=function(d){container=d.parentNode.lastChild;if(apf.getStyle(container,"display")=="block"){d.className=d.className.replace(/min/,"plus");this.$slideClose(container);}else{d.className=d.className.replace(/plus/,"min");this.$slideOpen(container);}};this.$slideOpen=function(d){d.style.display="";apf.tween.single(d,{type:"scrollheight",from:3,diff:-2,to:d.scrollHeight,anim:this.$animType,steps:this.$animSteps,interval:this.$animSpeed,onfinish:function(i){i.style.overflow="visible";i.style.height="auto";}});};this.$slideClose=function(d){d.style.height=d.offsetHeight;d.style.overflow="hidden";apf.tween.single(d,{type:"scrollheight",from:d.scrollHeight,diff:-2,to:0,anim:this.$animType,steps:this.$animSteps,interval:this.$animSpeed,onfinish:function(i,j){i.style.display="none";}});};this.$findContainer=function(i){var d=i.nextSibling;if(!d){return i;}return d.nodeType==1?d:d.nextSibling;};this.addEventListener("bindingsload",this.$loaddatabinding=function(m){var n=m.bindings.properties;if(!n||!n.length){return;}for(var j=0,d=n.length;j<d;j++){}});this.$unloaddatabinding=function(){};this.getColumn=function(d){return this.$headings[d||this.$lastcol||0];};this.resizeColumn=function(j,i){var d=this.$headings[j];d.resize(i);};this.hideColumn=function(i){var d=this.$headings[i];d.hide();};this.showColumn=function(i){var d=this.$headings[i];d.show();};this.$getProperties=function(j){if(this.properties){if(!this.$properties){return false;}else{return this.$properties;}}else{if(this.$bindings.properties){var l=this.$bindings.properties;for(var d=0;d<l.length;d++){if(!l[d].match){return xx;}}}}return false;};this.$load=function(m){var o=this.$getProperties();if(!o){return false;}var j=[];var l=this.documentId=apf.xmldb.getXmlDocId(o);apf.xmldb.addNodeListener(m,this);apf.xmldb.addNodeListener(this.xmlRoot,this);var d=this,n=o.ownerDocument;(function i(q,E,A){for(var G,I,F,D,C,B,t,z=0,w=q.length;z<w;z++){t=q[z];d.$getNewContext("row");B=d.$getLayoutNode("row");if(t[apf.TAGNAME]=="group"){d.$getNewContext("cell");apf.setStyleClass(B,"heading");F=B.appendChild(d.$getLayoutNode("cell"));apf.setNodeValue(d.$getLayoutNode("cell","caption",F),(t.getAttribute("caption")||"").trim()||"");C=B.appendChild(n.createElement("blockquote"));i(t.selectNodes("prop"),C,A);B.insertBefore(G=n.createElement("u"),B.firstChild).appendChild(n.createTextNode(" "));G.setAttribute("class","min");}else{apf.xmldb.nodeConnect(l,t,B,d);d.$getNewContext("cell");h=d.$headings[0];F=B.appendChild(d.$setStyleClass(d.$getLayoutNode("cell"),h.$className));apf.setNodeValue(d.$getLayoutNode("cell","caption",F),(t.getAttribute("caption")||"").trim()||"");if(A){F.firstChild.setAttribute("style","padding-left:"+(A*15)+"px");}d.$getNewContext("cell");h=d.$headings[1];F=B.appendChild(d.$setStyleClass(d.$getLayoutNode("cell"),h.$className));apf.setNodeValue(d.$getLayoutNode("cell","caption",F),((apf.lm.compile(t.getAttribute("value"),{nostring:true}))(d.xmlRoot)||"")||"");if((I=t.selectNodes("prop")).length){C=B.appendChild(n.createElement("blockquote"));C.setAttribute("style","display:none;overflow:hidden;height:0;");i(I,d.$getLayoutNode("heading","container",C),A+1);B.insertBefore(G=n.createElement("u"),B.firstChild).appendChild(n.createTextNode(" "));G.setAttribute("class","plus");}}if(!E){j.push(B);}else{E.appendChild(B);}}})(o.selectNodes("group|prop"),null,0);apf.insertHtmlNodes(j,this.$int);this.setProperty("root",this.xmlRoot);this.select(this.$findHtmlNode(o.selectSingleNode(".//prop").getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId));};this.$xmlUpdate=function(q,w,m,t){if(this.$lastEditor[0]==t.amlNode){this.$lastEditor[1].firstChild.innerHTML=((apf.lm.compile(this.$lastEditor[2].getAttribute("value"),{nostring:true}))(this.xmlRoot)||"")||"";}else{var j=this.$getProperties();var n,u,d=j.selectNodes(".//prop");for(var s=0,o=d.length;s<o;s++){n=d[s];u=this.$findHtmlNode(n.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);u.childNodes[u.firstChild.tagName=="U"?2:1].firstChild.innerHTML=((apf.lm.compile(n.getAttribute("value"),{nostring:true}))(this.xmlRoot)||"")||"";}}};this.select=function(C){if(this.$selected==C){return;}if(this.$selected){this.$setStyleClass(this.$selected,"",["selected"]);}this.$setStyleClass(C,"selected");this.$selected=C;if(this.$lastEditor){this.$lastEditor[0].setProperty("visible",false);var j=this.$lastEditor[1].childNodes;for(var s=0,o=j.length;s<o;s++){if(!j[s].host){j[s].style.display="";}}}var d=apf.xmldb.getNode(C);var w=this;var A=this.$selected.childNodes[this.$selected.firstChild.tagName=="U"?2:1];var B,u=d.getAttribute("editor");var n=apf.lm.compile(u,{xpathmode:2});if(n.type==2){if(!this.$editors[u]){var z=apf.namespaces[apf.ns.aml].elements[u];var m={htmlNode:A,width:"100%+2",style:"position:relative;z-index:10000",value:"[{"+this.id+".root}::"+(v=d.getAttribute("value")).substr(1,v.length-2)+"]",focussable:false};if(z.prototype.hasFeature(apf.__MULTISELECT__)){m.caption="[text()]";m.eachvalue="[@value]";m.each="item";m.model="{apf.xmldb.getElementById('"+d.getAttribute(apf.xmldb.xmlIdTag)+"')}";}B=this.$editors[u]=new z(m);var t=apf.getBox(apf.getStyle(B.$ext,"margin"));if(t[1]||t[3]){B.setAttribute("width","100%+2-"+(t[1]+t[3]));}else{if(!t[3]){B.$ext.style.marginLeft="-1px";}}B.parentNode=this;B.$focusParent=this;B.setAttribute("focussable","true");}else{B=this.$editors[u];if(B.hasFeature(apf.__MULTISELECT__)){B.setAttribute("model","{apf.xmldb.getElementById('"+d.getAttribute(apf.xmldb.xmlIdTag)+"')}");}B.setAttribute("value","[{"+this.id+".root}::"+(v=d.getAttribute("value")).substr(1,v.length-2)+"]");B.setProperty("visible",true);A.appendChild(B.$ext);}}else{var q=n.call(this,this.xmlRoot);if(q.localName=="template"){}else{}}var j=A.childNodes;for(var s=0,o=j.length;s<o;s++){if(!j[s].host){j[s].style.display="none";}}this.$lastEditor=[B,A,d];};this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","body",this.$ext);this.$head=this.$getLayoutNode("main","head",this.$ext);this.$pointer=this.$getLayoutNode("main","pointer",this.$ext);if(this.$head.firstChild){this.$head.removeChild(this.$head.firstChild);}if(this.$int.firstChild){this.$int.removeChild(this.$int.firstChild);}var i=this.$widthdiff=this.$getOption("main","widthdiff")||0;this.$defaultwidth=this.$getOption("main","defaultwidth")||"100";this.$useiframe=apf.isIE&&(apf.isTrue(this.$getOption("main","iframe"))||this.iframe);var d=this;if(this.$useiframe&&!this.oIframe){var j=this.$int.className;this.oIframe=this.$int.appendChild(document.createElement(apf.isIE?"<iframe frameborder='0'></iframe>":"iframe"));this.oIframe.frameBorder=0;this.oWin=this.oIframe.contentWindow;this.oDoc=this.oWin.document;this.oDoc.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                <html xmlns="http://www.w3.org/1999/xhtml">                    <head><script>                        apf = {                            lookup : function(uid){                                return window.parent.apf.lookup(uid);                            },                            Init : {add:function(){},run:function(){}}                        };<\/script>                    </head>                    <body></body>                </html>');this.$int=this.oDoc.body;this.$int.className=j;this.oDoc.documentElement.className=this.$ext.className;apf.skins.loadCssInWindow(this.skinName,this.oWin,this.mediaPath,this.iconPath);if(apf.isIE){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");}apf.convertIframe(this.oIframe,true);if(apf.getStyle(this.oDoc.documentElement,apf.isIE?"overflowY":"overflow-y")=="auto"){this.oIframe.onresize=function(){d.$head.style.marginRight=d.oDoc.documentElement.scrollHeight>d.oDoc.documentElement.offsetHeight?"16px":"0";};this.addEventListener("afterload",this.oIframe.onresize);this.addEventListener("xmlupdate",this.oIframe.onresize);}this.oDoc.documentElement.onmousedown=function(l){if(!l){l=d.oWin.event;}if((l.srcElement||l.target).tagName=="HTML"){apf.popup.forceHide();}};this.oDoc.documentElement.onscroll=function(){if(d.$isFixedGrid){d.$head.scrollLeft=d.oDoc.documentElement.scrollLeft;}};}else{if(apf.getStyle(this.$int,apf.isIE?"overflowY":"overflow-y")=="auto"){this.$resize=function(){d.$head.style.marginRight=d.$int.scrollHeight>d.$int.offsetHeight?"16px":"0";};apf.layout.setRules(this.$ext,this.$uniqueId+"_datagrid","var o = apf.all["+this.$uniqueId+"];                     if (o) o.$resize()");apf.layout.queue(this.$ext);this.addEventListener("afterload",this.$resize);this.addEventListener("xmlupdate",this.$resize);}this.$int.onmousedown=function(l){if(!l){l=event;}if((l.srcElement||l.target)==this){apf.popup.forceHide();}};this.$int.onscroll=function(){if(d.$isFixedGrid){d.$head.scrollLeft=d.$int.scrollLeft;}};}var d=this;this.$int.onmousedown=function(m){if(!m){m=event;}var l=m.srcElement||m.target;if(l==this){return;}if(l.tagName=="U"){d.$slideToggle(l);return;}while(l.host||(l.getAttribute(apf.xmldb.htmlIdTag)||"").indexOf("|")==-1){l=l.parentNode;if(l==this){return;}}d.select(l);};};this.$loadAml=function(d){this.$headings=[new apf.BindingColumnRule().$draw(this,"Property",this.$columns[0],"first"),new apf.BindingColumnRule().$draw(this,"Value",this.$columns[1])];};this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);this.$ext.onclick=this.$int.onresize=null;apf.layout.removeRule(this.$int,"dg"+this.$uniqueId);apf.layout.activateRules(this.$int);};}).call(apf.propedit.prototype=new apf.DataBinding());apf.aml.setElement("propedit",apf.propedit);apf.aml.setElement("column",apf.BindingColumnRule);apf.aml.setElement("description",apf.BindingRule);apf.aml.setElement("color",apf.BindingRule);apf.range=function(c,a){this.$init(a||"range",apf.NODE_VISIBLE,c);};apf.slider=function(c,a){this.$init(a||"slider",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction);this.$focussable=true;this.$dragging=false;this.$onlySetXml=false;this.disabled=false;this.realtime=true;this.balloon=true;this.value=0;this.mask="%";this.min=0;this.max=1000001;this.$supportedProperties.push("step","mask","min","max","slide","value","markers");this.$booleanProperties.realtime=true;this.$booleanProperties.markers=true;this.$booleanProperties.balloon=true;this.$propHandlers.step=function(a){this.step=parseInt(a)||0;if(!this.$hasLayoutNode("marker")){return;}if(!this.slider){this.slideDiscreet=true;}};this.$propHandlers.markers=function(s){var l,j=this.oMarkers.childNodes;for(l=j.length-1;l>=0;l--){if(j[l].tagName=="U"&&j[l].nodeType==1){apf.destroyHtmlNode(j[l]);}}if(!this.step&&this.$aml){this.step=parseInt(this.getAttribute("step"))||0;}if(s&&this.step){var n,d,c=[],q=(this.max==1000001)?1:this.max,m=(q-this.min)/this.step,a=this.$dir=="horizontal"?"left":"top",t=this.$dir=="horizontal"?this.$ext.offsetWidth-this.oKnob.offsetWidth-apf.getWidthDiff(this.oContainer):this.$ext.offsetHeight-this.oKnob.offsetHeight;for(l=0;l<m+1;l++){this.$getNewContext("marker");d=this.$getLayoutNode("marker");n=Math.max(0,(l*(1/(m))));d.setAttribute("style",a+":"+Math.round(n*t)+"px");c.push(d);}apf.insertHtmlNodes(c,this.oMarkers);}};this.$resize=function(){this.$propHandlers.value.call(this,this.value);var j=(this.max-this.min)/this.step;if(!j){return;}var m,d,l=this.$dir=="horizontal"?"left":"top",c=this.$dir=="horizontal"?this.$ext.offsetWidth-this.oKnob.offsetWidth-apf.getWidthDiff(this.oContainer):this.$ext.offsetHeight-this.oKnob.offsetHeight,a=this.oMarkers.getElementsByTagName("U");for(d=a.length-1;d>=0;d--){m=Math.max(0,d*(1/j));a[d].style[l]=Math.round(m*c)+"px";}};this.$propHandlers.mask=function(a){if(!a){this.mask="%";}if(!this.mask.match(/^(%|#)$/)){this.mask=a.split(/\||;/);}};this.$propHandlers.progress=function(a){if(!this.oProgress){this.oProgress=apf.insertHtmlNode(this.$getLayoutNode("progress"),this.$getLayoutNode("main","progress",this.$ext));}this.oProgress.style.width=((a||0)*100)+"%";};this.$propHandlers.min=function(a){this.min=parseInt(a)||0;if(this.markers){this.$propHandlers.markers.call(this,this.markers);}if(this.value<this.min||this.value!=this.$value){this.value=-1;this.setProperty("value",this.$value);}};this.$propHandlers.max=function(a){this.max=parseInt(a)||1;if(this.markers){this.$propHandlers.markers.call(this,this.markers);}if(this.value>this.min||this.value!=this.$value){this.value=-1;this.setProperty("value",this.$value);}};this.$propHandlers.slide=function(a){this.slideDiscreet=a=="discrete";this.slideSnap=a=="snap";};this.$propHandlers.value=function(n,a,c,d){if(!this.$dir||this.$onlySetXml){return;}if(this.$dragging&&!c&&!this.realtime){return;}this.$value=n;this.value=Math.max(this.min,Math.min(this.max,n))||0;var m,j,i,l=this,o=this.max==this.min?0:(this.value-this.min)/(this.max-this.min);if(this.$dir=="horizontal"){m=(this.oContainer.offsetWidth-apf.getWidthDiff(this.oContainer))-this.oKnob.offsetWidth;j=parseInt(apf.getBox(apf.getStyle(this.oContainer,"padding"))[3]);i=(((m-j)*o)+j);if(d){apf.tween.single(this.oKnob,{type:"left",steps:5,interval:10,from:this.oKnob.offsetLeft,to:i,anim:apf.tween.NORMAL,oneach:function(q){if(l.oFill){l.oFill.style.width=(q.offsetLeft+3)+"px";}}});}else{this.oKnob.style.left=i+"px";if(this.oFill){this.oFill.style.width=(i+3)+"px";}}}else{m=(this.oContainer.offsetHeight-apf.getHeightDiff(this.oContainer))-this.oKnob.offsetHeight;j=parseInt(apf.getBox(apf.getStyle(this.oContainer,"padding"))[0]);i=(((m-j)*(1-o))+j);if(d){apf.tween.single(this.oKnob,{type:"top",steps:5,interval:10,from:this.oKnob.offsetTop,to:i,anim:apf.tween.NORMAL,oneach:function(q){if(l.oFill){l.oFill.style.height=(q.offsetTop+3)+"px";}}});}else{this.oKnob.style.top=i+"px";if(this.oFill){this.oFill.style.height=(i+3)+"px";}}}if(this.oLabel){if(this.mask=="%"){this.oLabel.nodeValue=Math.round(o*100)+"%";}else{if(this.mask=="#"){this.oLabel.nodeValue=this.step?(Math.round(this.value/this.step)*this.step):this.value;}else{this.oLabel.nodeValue=this.mask[Math.round(this.value-this.min)/(this.step||1)];}}}};this.setValue=function(a){this.setProperty("value",a,false,true);};this.getValue=function(){return this.step?Math.round(parseInt(this.value)/this.step)*this.step:this.value;};this.addEventListener("keydown",function(c){var a=c.keyCode;var d=c.ctrlKey;switch(a){case 37:if(this.$dir!="horizontal"){return;}this.setValue(this.value-(d?0.01:0.1));break;case 38:if(this.$dir!="vertical"){return;}this.setValue(this.value+(d?0.01:0.1));break;case 39:if(this.$dir!="horizontal"){return;}this.setValue(this.value+(d?0.01:0.1));break;case 40:if(this.$dir!="vertical"){return;}this.setValue(this.value-(d?0.01:0.1));break;default:return;}return false;},true);this.$draw=function(){this.$ext=this.$getExternal();this.oLabel=this.$getLayoutNode("main","status",this.$ext);this.oMarkers=this.$getLayoutNode("main","markers",this.$ext);this.oKnob=this.$getLayoutNode("main","slider",this.$ext);this.oFill=this.$getLayoutNode("main","fill",this.$ext);this.oBalloon=this.$getLayoutNode("main","balloon",this.$ext);this.$int=this.oContainer=this.$getLayoutNode("main","container",this.$ext);this.$dir=this.$getOption("main","direction")||"horizontal";this.oKnob.style.left=(parseInt(apf.getBox(apf.getStyle(this.$ext,"padding"))[3]))+"px";var a=this;function d(i){this.x=(i.clientX||i.x);this.y=(i.clientY||i.y);this.stX=this.offsetLeft;this.siX=this.offsetWidth;this.stY=this.offsetTop;this.siY=this.offsetheight;this.startValue=a.value;if(a.$dir=="horizontal"){this.max=parseInt(apf.getStyle(a.oContainer,"width"))-this.offsetWidth;this.min=parseInt(apf.getBox(apf.getStyle(a.oContainer,"padding"))[3]);}else{this.max=parseInt(apf.getStyle(a.oContainer,"height"))-this.offsetHeight;this.min=parseInt(apf.getBox(apf.getStyle(a.oContainer,"padding"))[0]);}}function c(l,j,n){var m=(a.$dir=="horizontal")?(j.clientX||j.x)-l.x+l.stX:(j.clientY||j.y)-l.y+l.stY;m=(m>l.max?l.max:(m<l.min?l.min:m));var i=(((m-l.min)*100/(l.max-l.min)/100)*(a.max-a.min))+a.min;i=n?(Math.round(i/a.step)*a.step):i;i=(a.$dir=="horizontal")?i:1-i;return i;}this.oKnob.onmousedown=function(j){if(a.disabled){return false;}j=j||window.event;document.dragNode=this;d.call(this,j);a.$setStyleClass(this,"btndown",["btnover"]);apf.dragMode=true;a.$dragging=true;if(a.balloon&&a.oBalloon){a.oBalloon.style.display="block";a.oBalloon.style.left=(a.oKnob.offsetLeft-(a.oBalloon.offsetWidth-a.oKnob.offsetWidth)/2)+"px";}var i=this.value;document.onmousemove=function(n){n=n||window.event;var q=this.dragNode;if(!q){apf.dragMode=document.onmousemove=document.onmouseup=null;return;}var m=c(q,n,a.slideSnap);if(a.realtime){if(a.slideDiscreet){this.$onlySetXml=true;var l=a.change(Math.round(m/a.step)*a.step);this.$onlySetXml=false;if(l!==false){a.$propHandlers.value.call(a,m,"value",true);}}else{a.change(m);}}else{a.$propHandlers.value.call(a,m,"value",true);}if(a.balloon&&a.oBalloon){a.oBalloon.style.left=(a.oKnob.offsetLeft-(a.oBalloon.offsetWidth-a.oKnob.offsetWidth)/2)+"px";}};document.onmouseup=function(n){var q=this.dragNode;this.dragNode=null;q.onmouseout();a.$dragging=false;var m=c(q,n||window.event,a.slideDiscreet||a.slideSnap);a.value=i;var l=i!=m?a.change(m,true):false;if(l!==false&&a.slideDiscreet){a.$propHandlers.value.call(a,m,"value",true);}apf.dragMode=false;document.onmousemove=document.onmouseup=null;if(a.balloon&&a.oBalloon){a.oBalloon.style.left=(a.oKnob.offsetLeft-(a.oBalloon.offsetWidth-a.oKnob.offsetWidth)/2)+"px";$setTimeout(function(){if(apf.isIE){a.oBalloon.style.display="none";}else{apf.tween.single(a.oBalloon,{type:"fade",from:1,to:0,steps:5,onfinish:function(){a.oBalloon.style.display="none";a.oBalloon.style.opacity=1;}});}},a.slideDiscreet?200:0);}};return false;};this.oKnob.onmouseup=this.oKnob.onmouseover=function(){if(document.dragNode!=this){a.$setStyleClass(this,"btnover",["btndown"]);}};this.oKnob.onmouseout=function(){if(document.dragNode!=this){a.$setStyleClass(this,"",["btndown","btnover"]);}};this.$ext.onmousedown=function(l){if(a.disabled){return false;}l=l||window.event;var m=a.oKnob;if((l.srcElement||l.target)!=m){var j=apf.getAbsolutePosition(m);d.call(m,{x:j[0]+m.offsetWidth/2,y:j[1]+m.offsetHeight/2});var i=c(m,l,a.slideDiscreet||a.slideSnap);a.$propHandlers.value.call(a,c(m,l,a.slideDiscreet),"value",true,true);a.setValue(i);}};if(apf.isIphone){apf.iphone.linkEvents(this.oKnob);}};this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(this.max==1000001){this.setProperty("max",1);}apf.layout.setRules(this.$ext,"knob","apf.all["+this.$uniqueId+"].$resize()",true);apf.layout.queue(this.$ext);});this.$destroy=function(){this.oKnob.onmousedown=this.oKnob.onmouseup=this.oKnob.onmouseover=this.oKnob.onmouseout=null;apf.layout.removeRule(this.$ext,"knob");};}).call(apf.slider.prototype=new apf.StandardBinding());apf.range.prototype=apf.slider.prototype;apf.aml.setElement("range",apf.range);apf.aml.setElement("slider",apf.slider);apf.colorpicker=function(c,a){this.$init(a||"colorpicker",apf.NODE_VISIBLE,c);};(function(){this.value="ff0000";this.changeTimer=null;var a=apf.color;this.$supportedProperties.push("color","red","green","blue","hue","saturation","brightness","hex");this.$propHandlers.red=this.$propHandlers.green=this.$propHandlers.blue=this.$propHandlers.hue=this.$propHandlers.saturation=this.$propHandlers.brightness=this.$propHandlers.hex=function(i,d){clearTimeout(this.changeTimer);if(d){var c=this;this.changeTimer=$setTimeout(function(){c.$change();});}};this.$propHandlers.value=function(c){this.$restoreOriginal();};this.$restoreOriginal=function(){this.$change(a.hexToHSB(this.value));this.oCustomColor.style.backgroundColor=(this.value.substr(0,1)!="#"?"#":"")+this.value;};this.$change=function(c){if(!c){c={h:this.hue,s:this.saturation,b:this.brightness};}c=a.fixHSB(c);var i=a.HSBToHex(c),d=a.HSBToRGB(c);this.oNewColor.style.backgroundColor="#"+i;this.setProperty("red",d.r);this.setProperty("green",d.g);this.setProperty("blue",d.b);this.setProperty("saturation",c.s);this.setProperty("brightness",c.b);this.setProperty("hue",c.h);this.setProperty("hex",i);this.oSelector.style.background="#"+a.HSBToHex({h:c.h,s:100,b:100});this.oHue.style.top=parseInt(150-150*c.h/360,10)+"px";this.oSelectorInd.style.left=parseInt(150*c.s/100,10)+"px";this.oSelectorInd.style.top=parseInt(150*(100-c.b)/100,10)+"px";};this.$draw=function(){if(!this.id){this.setProperty("id","colorpicker"+this.$uniqueId);}this.$ext=this.$getExternal();this.oSelector=this.$getLayoutNode("main","selector",this.$ext);this.oSelectorInd=this.$getLayoutNode("main","selector_indic",this.$ext);this.oHue=this.$getLayoutNode("main","hue",this.$ext);this.oNewColor=this.$getLayoutNode("main","newcolor",this.$ext);this.oCustomColor=this.$getLayoutNode("main","customcolor",this.$ext);this.oInputs=this.$getLayoutNode("main","inputs",this.$ext);this.$restoreOriginal();var d=this,m=(!document.compatMode||document.compatMode=="CSS1Compat")?document.html:document.body;function i(){document.onmousemove=document.onmouseup=null;d.$change();return false;}function l(){var o=this,s=apf.getAbsolutePosition(o);function q(w){w=w||event;var u=w.pageX||w.clientX+(m?m.scrollLeft:0),t=w.pageY||w.clientY+(m?m.scrollTop:0);d.brightness=parseInt(100*(150-Math.max(0,Math.min(150,(t-s[1]))))/150,10);d.saturation=parseInt(100*(Math.max(0,Math.min(150,(u-s[0]))))/150,10);d.$change();s=apf.getAbsolutePosition(o);return false;}document.onmousemove=q;document.onmouseup=function(t){q(t);return i(t);};}function c(s){var q=this,t=apf.getAbsolutePosition(q);function o(w){w=w||event;var u=w.pageY||w.clientY+(m?m.scrollTop:0);d.hue=parseInt(360*(150-Math.max(0,Math.min(150,(u-t[1]))))/150,10);d.$change();t=apf.getAbsolutePosition(q);}document.onmousemove=o;document.onmouseup=function(u){o(u);return i(u);};}this.oSelector.onmousedown=l;this.oHue.parentNode.onmousedown=c;this.oCustomColor.onmousedown=function(){d.$restoreOriginal();};function n(s){var t=s.currentTarget,u=false;if(t.id.indexOf("hue")>-1){d.hue=s.value;}else{if(t.id.indexOf("saturation")>-1){d.saturation=s.value;}else{if(t.id.indexOf("brightness")>-1){d.brightness=s.value;}else{if(t.id.indexOf("red")>-1){d.red=s.value,u=true;}else{if(t.id.indexOf("green")>-1){d.green=s.value,u=true;}else{if(t.id.indexOf("blue")>-1){d.blue=s.value,u=true;}}}}}}if(u){var q=a.RGBToHSB({r:d.red,g:d.green,b:d.blue});d.hue=q.h;d.saturation=q.s;d.brightness=q.b;}d.$change();}var j=apf.getInheritedAttribute(this.parentNode,"skinset");new apf.table({htmlNode:this.oInputs,skinset:j,left:206,top:52,width:150,columns:"50%,50%",cellheight:26,childNodes:[new apf.spinner({id:this.id+"_hue",width:62,min:0,max:360,value:"{"+this.id+".hue}",onafterchange:n}),new apf.spinner({id:this.id+"_red",width:62,min:0,max:255,value:"{"+this.id+".red}",onafterchange:n}),new apf.spinner({id:this.id+"_saturation",width:62,min:0,max:100,value:"{"+this.id+".saturation}",onafterchange:n}),new apf.spinner({id:this.id+"_green",width:62,min:0,max:255,value:"{"+this.id+".green}",onafterchange:n}),new apf.spinner({id:this.id+"_brightness",width:62,min:0,max:100,value:"{"+this.id+".brightness}",onafterchange:n}),new apf.spinner({id:this.id+"_blue",width:62,min:0,max:255,value:"{"+this.id+".blue}",onafterchange:n})]});new apf.label({htmlNode:this.oInputs,skinset:j,left:212,top:142,width:7,value:"#","for":this.id+"_hex"});new apf.textbox({htmlNode:this.oInputs,skinset:j,left:222,top:140,width:75,value:"{"+this.id+".hex}",onafterchange:function(q){d.hex=a.fixHex(q.value);var o=a.hexToHSB(d.hex);d.hue=o.h;d.saturation=o.s;d.brightness=o.b;d.$change();}});};this.$destroy=function(){this.$ext=this.oSelector=this.oSelectorInd=this.oHue=this.oNewColor=this.oCustomColor=this.oInputs=null;};}).call(apf.colorpicker.prototype=new apf.StandardBinding());apf.aml.setElement("colorpicker",apf.colorpicker);apf.StateServer={states:{},groups:{},locs:{},removeGroup:function(a,c){this.groups[a].remove(c);if(!this.groups[a].length){if(self[a]){self[a].destroy();self[a]=null;}delete this.groups[a];}},addGroup:function(c,i,d){if(!this.groups[c]){this.groups[c]=[];var a=new apf.state("state",null,null,true);a.parentNode=d;a.implement(apf.AmlNode);a.name=c;a.toggle=function(){for(var l=0,j=0;j<apf.StateServer.groups[c].length;j++){if(apf.StateServer.groups[c][j].active){l=j+1;break;}}apf.StateServer.groups[c][(l==apf.StateServer.groups[c].length)?0:l].activate();};this.groups[c].pState=self[c]=a;}if(i){this.groups[c].push(i);}return this.groups[c].pState;},removeState:function(a){delete this.states[a.name];},addState:function(a){this.states[a.name]=a;}};apf.state=function(c,a){this.$init(a||"state",apf.NODE_HIDDEN,c);this.$signalElements=[];this.$groupAdded={};this.$locationAdded="";};(function(){this.$supportedProperties.push("active");this.$propHandlers.active=function(l){if(apf.isTrue(l)){if(this.group){var c=apf.StateServer.groups[this.group];if(!c){apf.StateServer.addGroup(this.group,this);c=apf.StateServer.groups[this.group];}for(var d=0;d<c.length;d++){if(c[d]!=this&&c[d].active!==false){c[d].deactivate();}}}var j=this.$signalElements;for(var d=0;d<j.length;d++){if(!self[j[d][0]]||!self[j[d][0]].setProperty){continue;}self[j[d][0]].setProperty(j[d][1],this[j[d].join(".")]);}if(this.group){var a=this.attributes;for(var d=0;d<a.length;d++){if(a[d].nodeName.match(/^on|^(?:group|id)$|^.*\..*$/)){continue;}self[this.group].setProperty(a[d].nodeName,a[d].nodeValue);}apf.StateServer.groups[this.group].pState.dispatchEvent("change");}this.dispatchEvent("change");}else{this.setProperty("active",false);this.dispatchEvent("change");}};this.setValue=function(a){this.active=9999;this.setProperty("active",a,false,true);};this.activate=function(){this.active=9999;this.setProperty("active",true,false,true);};this.deactivate=function(){this.setProperty("active",false,false,true);};this.$propHandlers.group=function(a){if(a){apf.StateServer.addGroup(a,this);this.$groupAdded={value:a,elState:this};}else{apf.StateServer.removeGroup(this.$groupAdded.value,this.$groupAdded.elState);this.$groupAdded={};}};this.$propHandlers.location=function(a){if(a){apf.StateServer.locs[a]=this;this.$locationAdded=a;}else{delete apf.StateServer.locs[this.$locationAdded];this.$locationAdded="";}};this.addEventListener("DOMNodeInsertedIntoDocument",function(j){apf.StateServer.addState(this);var a=this.attributes;for(var d,c=0;c<a.length;c++){d=a[c].nodeName.split(".");if(d.length==2){this.$signalElements.push(d);}}});this.addEventListener("DOMNodeRemovedFromDocument",function(){this.$signalElements=null;apf.StateServer.removeState(this);if(this.group){apf.StateServer.removeGroup(this.group,this);}});}).call(apf.state.prototype=new apf.AmlElement());apf.aml.setElement("state",apf.state);apf.checkbox=function(c,a){this.$init(a||"checkbox",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction);this.$notfromext=true;this.$focussable=true;this.checked=false;this.$values=[1,0];this.$booleanProperties.checked=true;this.$supportedProperties.push("value","checked","label","values");this.$propHandlers.value=function(a){a=(typeof a=="string"?a.trim():a);this.checked=(a!==undefined&&a.toString()==this.$values[0].toString());if(a!==null&&a.toString()==this.$values[0].toString()){apf.setStyleClass(this.$ext,this.$baseCSSname+"Checked");}else{apf.setStyleClass(this.$ext,"",[this.$baseCSSname+"Checked"]);}};this.$propHandlers.checked=function(a){if(!this.$values){if(this.getAttribute("values")){this.$propHandler.values.call(this,this.getAttribute("values"));}else{this.$values=[false,true];}}this.setProperty("value",this.$values[a?0:1]);};this.$propHandlers.label=function(a){if(!this.$ext){return;}apf.setNodeValue(this.$getLayoutNode("main","label",this.$ext),a);};this.$propHandlers.values=function(a){this.$values=typeof a=="string"?a.split("|"):(a||[1,0]);};this.setValue=function(a){if(!this.$values){return;}this.setProperty("value",a,false,true);};this.getValue=function(){return this.xmlRoot?this.$values[this.checked?0:1]:this.value;};this.check=function(){this.setProperty("value",this.$values[0],false,true);};this.uncheck=function(){this.setProperty("value",this.$values[1],false,true);};this.addEventListener("$clear",function(){this.setProperty("value",this.$values[1]);});this.$enable=function(){if(this.$int){this.$int.disabled=false;}this.$doBgSwitch(1);};this.$disable=function(){if(this.$int){this.$int.disabled=true;}this.$doBgSwitch(4);};this.$setState=function(a,d,c){if(this.disabled){return;}this.$doBgSwitch(this.states[a]);this.$setStyleClass(this.$ext,(a!="Out"?this.$baseCSSname+a:""),[this.$baseCSSname+"Down",this.$baseCSSname+"Over"]);this.state=a;this.dispatchEvent(c,d);};this.$clickHandler=function(){this.change(this.$values[(!this.checked)?0:1]);if(this.validate){this.validate(true);}return true;};this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","input",this.$ext);this.$setupEvents();};this.$childProperty="label";this.addEventListener("$skinchange",function(){if(this.label){this.$propHandlers.label.call(this,this.label);}});}).call(apf.checkbox.prototype=new apf.BaseButton());apf.aml.setElement("checkbox",apf.checkbox);apf.application=function(){this.$init("application",apf.NODE_HIDDEN);if(!apf.isO3){this.$int=document.body;this.$tabList=[];this.$focussable=apf.KEYBOARD;this.focussable=true;this.visible=true;this.$isWindowContainer=true;this.focus=function(){this.dispatchEvent("focus");};this.blur=function(){this.dispatchEvent("blur");};apf.window.$addFocus(this);}};apf.application.prototype=new apf.AmlElement();apf.aml.setElement("application",apf.application);apf.img=function(c,a){this.$init(a||"img",apf.NODE_VISIBLE,c);};apf.preview=function(c,a){this.$init(a||"preview",apf.NODE_VISIBLE,c);};(function(){this.setValue=function(a){this.setProperty("value",a,false,true);};this.getValue=function(a){return this.value;};this.$supportedProperties.push("value","src");this.$propHandlers.src=this.$propHandlers.value=function(c){if(this.oImage.nodeType==1){this.oImage.style.backgroundImage="url("+c+")";}else{this.oImage.nodeValue=c;}if(this.oImage.nodeType==2&&!this.$resize.done){if(this.oImg){var a=apf.hasSingleRszEvent?this.$pHtmlNode:this.$ext;apf.layout.setRules(a,this.$uniqueId+"_image","var o = apf.all["+this.$uniqueId+"];                     if (o) o.$resize()");apf.layout.queue(a);this.oImg.onload=function(){apf.layout.forceResize(a);};}this.$resize.done=true;}if(this.oImg){this.oImg.style.display=c?"block":"none";}};this.addEventListener("$clear",function(){this.value="";if(this.oImg){this.oImg.style.display="none";}});this.$draw=function(){this.$int=this.$ext=this.$getExternal();this.$ext.onclick=function(c){this.host.dispatchEvent("click",{htmlEvent:c||event});};this.oImage=this.$getLayoutNode("main","image",this.$ext);this.oImg=this.$int.getElementsByTagName("img")[0];if(this.localName=="preview"){var a=this;this.$int.onclick=function(){if(!a.sPreview){return;}a.$int.innerHTML=a.sPreview;this.onclick=null;};}};this.addEventListener("DOMNodeInsertedIntoDocument",function(){var c,d="",a=this.childNodes.length;for(;a>=0;--a){if((c=this.childNodes[a])&&c.nodeName&&c.nodeName=="#cdata-section"){d=c.nodeValue;c.removeNode();}}this.sPreview=d;});this.$resize=function(){var c=apf.getDiff(this.$ext);var d=1,a=1;this.oImg.style.width="";this.oImg.style.height="";if(this.oImg.offsetWidth>this.$ext.offsetWidth){d=this.oImg.offsetWidth/(this.$ext.offsetWidth-c[0]);}if(this.oImg.offsetHeight>this.$ext.offsetHeight){a=this.oImg.offsetHeight/(this.$ext.offsetHeight-c[1]);}if(d>a&&d>1){this.oImg.style.width="100%";}else{if(a>d&&a>1){this.oImg.style.height="100%";}}this.oImg.style.top=((this.$ext.offsetHeight-apf.getHeightDiff(this.$ext)-this.oImg.offsetHeight)/2)+"px";};}).call(apf.img.prototype=new apf.BaseSimple());apf.preview.prototype=apf.img.prototype;apf.aml.setElement("img",apf.img);apf.aml.setElement("preview",apf.preview);apf.aml.setElement("name",apf.BindingRule);apf.aml.setElement("image",apf.BindingRule);apf.loader=function(){this.$init("loader",apf.NODE_HIDDEN);this.show=function(){this.$ext.style.display="block";};this.hide=function(){this.$ext.style.display="none";};this.addEventListener("DOMNodeInsertedIntoDocument",function(c){var d;if(!(d=this.parentNode.$int)){return;}this.$ext=apf.insertHtmlNode(null,d,null,this.$aml?(this.$aml.serialize?this.$aml.serialize():this.$aml.xml):this.serialize());if(!apf.loaded){var a=this;apf.addEventListener("load",function(){if(apf.config.autoHideLoading){apf.queue.empty();a.hide();}});}});};apf.loader.prototype=new apf.AmlElement();apf.aml.setElement("loader",apf.loader);apf.body=function(){this.$init("body",apf.NODE_VISIBLE);};apf.AmlConfig=function(){this.$init("config",apf.NODE_VISIBLE);};(function(){this.focussable=false;this.$canLeechSkin=true;this.$draw=function(){this.$ext=this.$int=this.$getExternal(this.$isLeechingSkin?this.localName:"main");};}).call(apf.body.prototype=new apf.Presentation());apf.AmlConfig.prototype=apf.body.prototype;apf.aml.setElement("body",apf.body);apf.aml.setElement("config",apf.AmlConfig);apf.stateGroup=function(){this.$init("state-group",apf.NODE_HIDDEN);};apf.aml.setElement("state-group",apf.stateGroup);(function(){this.$handlePropSet=function(o,n,m){if(o=="id"){return;}var j,c=this.childNodes;for(var d=0,a=c.length;d<a;d++){j=c[d];if(j.nodeType!=1||j.localName!="state"){continue;}if(!j[o]||j.$inheritProperties[o]==2){j.$inheritProperties[o]=2;j.setProperty(o,n);}}};this.addEventListener("DOMNodeInsertedIntoDocument",function(j){if(!this.id){this.id="stategroup"+this.$uniqueId;}var c=this.childNodes;for(var d=0,a=c.length;d<a;d++){c[d].setProperty("group",this.id);}});}).call(apf.stateGroup.prototype=new apf.AmlElement());apf.bindings=function(c,a){this.$init(a||"bindings",apf.NODE_HIDDEN,c);this.$bindings=new apf.ruleList();this.$amlNodes={};};(function(){this.$smartbinding=null;this.register=function(a){if(a.localName=="smartbinding"){this.$smartbinding=a;this.$smartbinding.add(this);return;}if(!a.hasFeature(apf.__DATABINDING__)){return;}this.$amlNodes[a.$uniqueId]=a;if(!this.$amlLoaded){return;}if(!this.$bindings.$isCompiled){this.$cbindings=this.$bindings.compile();}a.$bindings=this.$bindings;a.$cbindings=this.$cbindings;a.dispatchEvent("bindingsload",{bindings:this.$bindings,compiled:this.$cbindings});this.dispatchEvent("noderegister",{amlNode:a});a.$checkLoadQueue();};this.unregister=function(){this.$amlNodes[this.amlNode.$uniqueId]=null;delete this.$amlNodes[this.amlNode.$uniqueId];this.amlNode.$bindings=this.amlNode.$cbindings=false;this.amlNode.dispatchEvent("bindingsunload",{bindings:this.$bindings,compiled:this.$cbindings});};this.reload=function(){for(var a in this.$amlNodes){this.$amlNodes[a].reload();}};this.addEventListener("DOMNodeInsertedIntoDocument",function(m){var c=this.childNodes;for(var j,d=0,a=c.length;d<a;d++){if(!(j=c[d]).$amlLoaded&&j.nodeType==1){j.dispatchEvent("DOMNodeInsertedIntoDocument");}}this.register(this.parentNode);for(var n in this.$amlNodes){this.register(this.$amlNodes[n]);}});}).call(apf.bindings.prototype=new apf.AmlElement());apf.ruleList=function(){this.$compiled={};};apf.ruleList.prototype={$isCompiled:false,getRule:function(c,j){var o=this[c];if(!o){return false;}for(var m,n,d=0,a=o.length;d<a;d++){n=o[d];if(!n.match){return n;}m=n.cmatch||n.compile("match",{injectself:true,xpathmode:2});if(m&&m(j)){return n;}}},compile:function(d){var o,m,q=this.$compiled;if(d){m=[];o=this[d];for(var n,j=0,a=o.length;j<a;j++){if(!(n=o[j]).match&&!n.value){continue;}m.push(n.match,n.value);}q[d]=apf.lm.compileMatch(m);return q;}for(d in this){if(d=="each"){continue;}o=this[d];if(o.dataType!=apf.ARRAY){continue;}m=[];for(var n,j=0,a=o.length;j<a;j++){if(!(n=o[j]).match&&!n.value){continue;}m.push(n.match,n.value);}q[d]=apf.lm.compileMatch(m);}this.$isCompiled=true;return q;},getRuleIndex:function(c,a){var d=this[c][a];if(d.value){if(!d.cvalue){d.compile("value");}}else{if(d.match){if(!d.cmatch){d.compile("match");}}}return d;},getDataNode:function(a,s,q,m,u){var n,j,d,c,o,t=this[a];if(!t){return;}for(o,n=0,j=t.length;n<j;n++){o=t[n];d=o.cvaluematch;if(!d){if(o.match&&o.value){o.valuematch="{_n = "+o.match+"; %[child::"+o.value.substr(1,o.value.length-2).split("|").join("|child::")+"]}";}else{o.valuematch=o.match||o.value;}d=o.$compile("valuematch",{xpathmode:u?4:3,injectself:o.match?true:false});}if(d&&(c=d(s,q))){if(m){m.push(o);}return c;}}return false;}};apf.aml.setElement("bindings",apf.bindings);apf.viewport=function(c,a){this.$init(a||"viewport",apf.NODE_VISIBLE,c);if(document.documentElement){this.$ext=this.$int=document.documentElement.appendChild(document.createElement("div"));}};(function(){this.$focussable=false;this.$draw=function(){if(!this.$ext){this.$ext=this.$int=document.documentElement.appendChild(document.createElement("div"));}};this.$loadAml=function(a){};}).call(apf.viewport.prototype=new apf.AmlElement());apf.aml.setElement("viewport",apf.viewport);apf.appsettings=function(c,a){this.$init(a||"appsettings",apf.NODE_HIDDEN,c);};(function(){this.$parsePrio="001";this.$attrExcludePropBind={language:1,login:1,logout:1,layout:1};this.$supportedProperties=["debug","name","baseurl","resource-path","disable-right-click","allow-select","allow-blur","auto-disable-actions","auto-disable","disable-f5","auto-hide-loading","disable-space","disable-backspace","undokeys","initdelay","default-page","query-append","outline","drag-outline","resize-outline","resize-outline","iepngfix","iepngfix-elements","iphone-fullscreen","iphone-statusbar","iphone-icon","iphone-icon-is-glossy","iphone-fixed-viewport","layout","skinset","language","storage","offline","login"];this.$booleanProperties={debug:1,"disable-right-click":1,"allow-select":1,"allow-blur":1,"auto-disable-actions":1,"auto-disable":1,"disable-f5":1,"auto-hide-loading":1,"disable-space":1,"disable-backspace":1,undokeys:1,initdelay:1,outline:1,iepngfix:1,"iphone-fullscreen":1,"iphone-icon-is-glossy":1,"iphone-fixed-viewport":1};this.$handlePropSet=function(d,c,a){if(this.$booleanProperties[d]){c=apf.isTrue(c);}this[d]=c;apf.config.setProperty(d,c);};this.addEventListener("DOMNodeInsertedIntoDocument",function(a){if(apf.isIphone&&apf.runIphone){apf.runIphone();delete apf.runIphone;}});}).call(apf.appsettings.prototype=new apf.AmlElement());apf.aml.setElement("appsettings",apf.appsettings);apf.BindingColorRule=function(c,a){this.$init(a,apf.NODE_HIDDEN,c);};(function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(c){if(this.$bindings&&this.$bindings.color){var a=this.$bindings.color[0];apf.setStyleRule("."+this.$baseCSSname+(apf.isIE?" .records .highlight SPAN":" .records .highlight span"),"color",a.getAttribute("text"),null,this.oWin);apf.setStyleRule("."+this.$baseCSSname+(apf.isIE?" .records .highlight SPAN":" .records .highlight span"),"backgroundColor",a.getAttribute("row"),null,this.oWin);apf.setStyleRule("."+this.$baseCSSname+(apf.isIE?" .records .highlight":" .records .highlight"),"backgroundColor",a.getAttribute("row"),null,this.oWin);}apf.importStylesheet([["."+this.className,"width:"+this.$width+(this.$isPercentage?"%;":"px;")+"text-align:"+h.align],["."+this.className,"width:"+this.$width+(this.$isPercentage?"%;":"px;")+"text-align:"+h.align]]);this.$draw();});}).call(apf.BindingColorRule.prototype=new apf.BindingRule());apf.aml.setElement("color",apf.BindingColorRule);apf.rpc=function(c,a){this.$init(a||"rpc",apf.NODE_HIDDEN,c);if(!this.supportMulticall){this.multicall=false;}this.stack={};this.urls={};this.$methods={};};(function(){this.useHTTP=true;this.namedArguments=false;this["route-server"]=apf.host+"/cgi-bin/rpcproxy.cgi";this.autoroute=false;this.$auth=false;this.$booleanProperties.multicall=true;this.$supportedProperties.push("protocol","type","multicall","http-method");this.$propHandlers.protocol=function(a){if(!a){return;}if(!apf[a]){return;}this.implement(apf[a]);};this.$propHandlers.type=function(a){this.$useXml=(typeof a=="string"&&a.toUpperCase()=="XML");};this.setCallback=function(a,c){this.$methods[a].callback=c;};this.$convertArgs=function(o,n){if(!this.namedArguments){return Array.prototype.slice.call(n);}var d=this.$methods[o].names;if(!d||!d.length){return{};}var s,m,q,c,a={};for(m=0,q=0,c=d.length;q<c;q++){o=d[q].name;s=d[q].value;if(s){s=apf.parseExpression(s);}else{s=n[m++];if(apf.isNot(s)&&d[q]["default"]){s=apf.parseExpression(d[q]["default"]);}}s=apf.isTrue(d[q].encoded)?encodeURIComponent(s):s;a[o]=s;}return a;};this.call=function(c,n,t){var s,l=this.$methods[c];if(typeof n[n.length-1]=="function"){n=Array.prototype.slice.call(n);s=n.pop();}else{s=(typeof l.callback=="string"?self[l.callback]:l.callback)||function(){};}n=this.$convertArgs(c,n);if(this.multicall){if(!this.stack[this.url]){this.stack[this.url]=this.getMulticallObject?this.getMulticallObject():[];}this.getSingleCall(c,n,this.stack[this.url]);return true;}var q=this,m=this.createMessage(l["method-name"]||c,n);function i(w,u,o){o.data=w;if(u!=apf.SUCCESS){s.call(q,null,u,o);}else{if(q.isValid&&!q.isValid(o)){s.call(q,null,apf.ERROR,o);}else{s.call(q,q.unserialize(o.data),u,o);}}}var j,a=apf.getAbsolutePath(this.baseurl||apf.config.baseurl,this.url),d=apf.extend({callback:i,async:l.async,userdata:l.userdata,nocache:(this.nocache===false)?false:true,data:m,useXML:this.$useXml,caching:l.caching,ignoreOffline:l["ignore-offline"]},t);if(l.auth&&this.$auth){if(j=this.$auth.$credentials){d.username=j.username;d.password=j.password;}else{return this.$auth.authRequired(function(){j=q.$auth.$credentials;d.username=j.username;d.password=j.password;q.$get(a,d);});}}return this.$get(a,d);};this.purge=function(o,n,d,q){var j=this.createMessage("multicall",[this.stack[this.url]]),a=apf.getAbsolutePath(this.baseurl||apf.config.baseurl,this.url);if(q){for(var m=[],l=0;l<q.length;l++){m.push(encodeURIComponent(q[l][0])+"="+encodeURIComponent(q[l][1]||""));}a=a+(a.match(/\?/)?"&":"?")+m.join("&");}var c=this.$get(a,{callback:o,async:d,userdata:n,nocache:true,data:j,useXML:this.$useXml});this.stack[this.url]=this.getMulticallObject?this.getMulticallObject():[];};this.revert=function(a){this.stack[a.url]=this.getMulticallObject?this.getMulticallObject():[];};this.getStackLength=function(){return this.stack[this.url]?this.stack[this.url].length:0;};this.$addMethod=function(m){if(m.localName!="method"){return false;}var d=m.name,a=m.receive||this.receive,j=0,c=m.childNodes.length,n;this[d]=function(){return this.call(d,arguments);};if(a){m.callback=a;}this.$methods[d]=m;if(!m.names){m.names=[];}for(;j<c;j++){n=m.childNodes[j];if(n.localName=="param"||n.localName=="variable"){m.names.push(n);}}return true;};this.$removeMethod=function(c){var a=c.name;delete this[a];delete this.$methods[a];};this.$setAuth=function(a){this.$auth=a;};this.exec=function(l,d,j,c){if(!c){c={};}if(c.multicall){this.forceMulticall=true;}var i=this.$methods[l];if(c.userdata){i.userdata=c.userdata;}if(!this.multicall){i.callback=j;}var a=this.call(l,d,c);if(this.multicall){return this.purge(j,"&@^%!@");}else{if(c.multicall){this.forceMulticall=false;return this;}}if(typeof apf.offline!="undefined"&&!apf.offline.onLine){return;}if(!this.multicall&&!i.async&&j){j(a,apf.SUCCESS,{tpModule:this});}};}).call(apf.rpc.prototype=new apf.Teleport());apf.config.$inheritProperties.baseurl=1;apf.aml.setElement("rpc",apf.rpc);apf.panel=function(c,a){this.$init(a||"panel",apf.NODE_VISIBLE,c);};apf.fieldset=function(c,a){this.$init(a||"fieldset",apf.NODE_VISIBLE,c);};apf.frame=function(c,a){this.$init(a||"submit",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.BaseStateButtons);this.$focussable=false;this.$supportedProperties.push("caption","url");this.$propHandlers.caption=function(a){if(!this.oCaption){return;}if(this.oCaption.nodeType==1){this.oCaption.innerHTML=a;}else{this.oCaption.nodeValue=a;}};this.$propHandlers.icon=function(a){var c=this.$getLayoutNode("main","icon",this.$ext);if(!c){return;}if(c.nodeType==1){c.style.display=a?"block":"none";}apf.skins.setIcon(c,a,this.iconPath);};this.$propHandlers.url=function(c){var a=this.oCaption;if(a.tagName=="A"||a.nodeType!=1){a=a.parentNode;}a.innerHTML="<a href='"+c+"' "+(c.match(/^http:\/\//)?"target='_blank'":"")+">"+this.caption+"</a>";this.oCaption=this.oCaption.firstChild;};this.setTitle=function(a){this.setProperty("title",a);};this.$draw=function(){this.$ext=this.$getExternal(null,null,function(a){this.$initButtons(a);});this.oCaption=this.$getLayoutNode("main","caption",this.$ext);this.$int=this.$getLayoutNode("main","container",this.$ext);this.$buttons=this.$getLayoutNode("main","buttons",this.$ext);};this.$loadAml=function(a){};}).call(apf.frame.prototype=new apf.Presentation());apf.panel.prototype=apf.fieldset.prototype=apf.frame.prototype;apf.aml.setElement("panel",apf.panel);apf.aml.setElement("fieldset",apf.fieldset);apf.aml.setElement("frame",apf.frame);apf.Axis=function(c,a){this.$init(a||"axis",apf.NODE_VISIBLE,c);this.$subpos={left:0,right:0,width:1,height:1};};apf.aml.setElement("axis",apf.Axis);(function(){this.$supportedProperties=["left","top","width","height","mode","zoom","zoomx","zoomy","movex","movey","orbitx","orbity","distance","x1","x2","y1","y2","z1","z2","t1","t2","x3d","y3d","z3d","p3d","orbitxanim","orbityanim","orbitzanim"];this.$drawCode=0;this.$_style=null;this.$docompile=true;this.$doinit=true;this.$timer;this.zoomx=1,this.zoomy=1,this.zoomz=1;this.movex=0,this.movey=0,this.movez=0;this.mousex=0,this.mousey=0;this.$tilex=0,this.$tiley=0;this.orbitx=0,this.orbity=0,this.orbitz=0;this.distance=4;this.rotate=0;this.orbitxanim=0;this.orbityanim=0;this.orbitzanim=0;this.x1=-2,this.x2=2;this.y1=-1,this.y2=2;this.z1=-0.7,this.z2=1;this.t1=0,this.t2=1;this.x3d=2,this.y3d=2,this.z3d=2;this.p3d=1;this.$styletag="";this.style="";this.mode="2D";this.left=0,this.top=0,this.width=0,this.height=0;this.resetView=function(){if(!this.animreset){this.setProperty("movex",0);this.setProperty("movey",0);this.setProperty("movez",0);this.setProperty("zoomx",1);this.setProperty("zoomy",1);this.setProperty("zoomz",1);this.setProperty("orbitx",0);this.setProperty("orbity",0);this.setProperty("orbitz",0);this.setProperty("distance",4);}var c=0;var a=this;var d=window.setInterval(function(){var j=0.7,i=1-j;if(c++>20){window.clearInterval(d),d=0;}a.setProperty("movex",!d?0:j*a.movex);a.setProperty("movey",!d?0:j*a.movey);a.setProperty("zoomx",!d?1:i+j*a.zoomx);a.setProperty("zoomy",!d?1:i+j*a.zoomy);a.setProperty("orbitx",!d?0:i*0+j*a.orbitx);a.setProperty("orbity",!d?0:i*0+j*a.orbity);a.setProperty("distance",!d?4:i*4+j*a.distance);},20);};this.$copySubPos=function(a){a.left=this.$subpos.left,a.top=this.$subpos.top;a.width=this.$subpos.width,a.height=this.$subpos.height;};this.$mouseDown=function(c,s,j,m){if(j==3){this.resetView();}for(var l=0,o=this.childNodes,a=o.length,q;l<a;){if((q=o[l++]).$mouseDown){q.$mouseDown(c,s,j,m);}}};this.$mouseUp=function(c,o){for(var j=0,l=this.childNodes,a=l.length,m;j<a;){if((m=l[j++]).$mouseUp){m.$mouseUp(c,o);}}};this.$mouseMove=function(t,q,C,o,m,l,j,u){var c=this.$subpos.left,a=this.$subpos.top;for(var z=0,B=this.childNodes,A=B.length,w;z<A;){if((w=B[z++]).$mouseMove){w.$mouseMove(t,q,C,o-c,m-a,l-c,j-a,u);}}t=t/this.$subpos.width,q=q/this.$subpos.height;var I=this.zoomx,G=this.zoomy,F=this.zoomz,s;this.mousex=l/this.$subpos.width;this.mousey=j/this.$subpos.height;if(o<this.$subpos.left){t=0;}if(m>this.$subpos.top+this.$subpos.height){q=0;}if(this.mode=="2D"){if(C==1){this.$tilex-=t*this.$subpos.width;this.$tiley-=q*this.$subpos.height;this.setProperty("movex",this.movex+t*this.zoomx);this.setProperty("movey",this.movey+q*this.zoomy);}else{if(C==2){var E=(o-this.$subpos.left)/this.$subpos.width,D=1-((m-this.$subpos.top)/this.$subpos.height);this.setProperty("zoomx",(s=this.zoomx*(1-4*t))<0.001?0.001:(s>10000?10000:s));this.setProperty("zoomy",(s=this.zoomy*(1-4*q))<0.001?0.001:(s>10000?10000:s));this.setProperty("movex",this.movex-(I-this.zoomx)*E);this.setProperty("movey",this.movey+(G-this.zoomy)*D);}}}else{if(C==1){if(u&1){this.setProperty("movex",this.movex+t*this.zoomx*1.5);this.setProperty("movey",this.movey+q*this.zoomy*1.5);}else{if(u&2){this.setProperty("movex",this.movex+t*this.zoomx*1.5);this.setProperty("movez",this.movez-q*this.zoomz*1.5);}else{this.setProperty("orbitx",this.orbitx-4*t);this.setProperty("orbity",this.orbity+4*q);}}}else{if(C==2){if(u&1){this.setProperty("zoomx",(s=this.zoomx*(1-4*t))<0.001?0.001:(s>10000?10000:s));this.setProperty("zoomy",(s=this.zoomy*(1-4*q))<0.001?0.001:(s>10000?10000:s));this.setProperty("movex",this.movex-(I-this.zoomx)*0.5);this.setProperty("movey",this.movey+(G-this.zoomy)*0.5);}else{if(u&2){this.setProperty("zoomx",(s=this.zoomx*(1-4*t))<0.001?0.001:(s>10000?10000:s));this.setProperty("zoomz",(s=this.zoomz*(1-4*q))<0.001?0.001:(s>10000?10000:s));this.setProperty("movex",this.movex-(I-this.zoomx)*0.5);this.setProperty("movez",this.movez+(F-this.zoomz)*0.5);}else{this.setProperty("distance",Math.min(Math.max(this.distance*(1-4*q),1),100));}}}}}};this.$mouseWheel=function(o,n,m,s){var i=this.zoomx,c=this.zoomy,a=this.zoomz,q,l=(o-this.$subpos.left)/this.$subpos.width,j=1-((n-this.$subpos.top)/this.$subpos.height);if(this.mode=="2D"){if(!this.lockxzoom){this.setProperty("zoomx",(q=this.zoomx*(1-0.1*m))<0.001?0.001:(q>10000?10000:q));}if(!this.lockyzoom){this.setProperty("zoomy",(q=this.zoomy*(1-0.1*m))<0.001?0.001:(q>10000?10000:q));}this.setProperty("movex",this.movex-(i-this.zoomx)*l);this.setProperty("movey",this.movey+(c-this.zoomy)*j);}else{if(s&1){if(!this.lockxzoom){this.setProperty("zoomx",(q=this.zoomx*(1-0.1*m))<0.001?0.001:(q>10000?10000:q));}if(!this.lockyzoom){this.setProperty("zoomy",(q=this.zoomy*(1-0.1*m))<0.001?0.001:(q>10000?10000:q));}this.setProperty("movex",this.movex-(i-this.zoomx)*0.5);this.setProperty("movey",this.movey+(c-this.zoomy)*0.5);}else{if(s&2){if(!this.lockzzoom){this.setProperty("zoomz",(q=this.zoomz*(1-0.1*m))<0.001?0.001:(q>10000?10000:q));}this.setProperty("movez",this.movez+(a-this.zoomz)*0.5);}else{this.setProperty("distance",Math.min(Math.max(this.distance*(1-0.1*m),3),100));}}}this.$redraw();};this.$propHandlers.left=this.$propHandlers.top=this.$propHandlers.width=this.$propHandlers.height=function(a){};this.$propHandlers.mode=function(j){this.$_style=null;for(var c=0,l=this.childNodes,a=l.length,m;c<a;){if((m=l[c++]).$drawGraph){m.$regenerate();}}this.$docompile=true;this.$redraw(false,true);};this.$propHandlers.style=function(a){this.$_style=null;this.$docompile=true;this.$redraw(false,true);};this.$propHandlers.x1=this.$propHandlers.x2=this.$propHandlers.y1=this.$propHandlers.y2=this.$propHandlers.z1=this.$propHandlers.z2=this.$propHandlers.t1=this.$propHandlers.t2=this.$propHandlers.x3d=this.$propHandlers.y3d=this.$propHandlers.z3d=this.$propHandlers.p3d=this.$propHandlers.orbitxanim=this.$propHandlers.orbityanim=this.$propHandlers.orbitzanim=function(c,a){this[a]=parseFloat(c);this.$redraw();};this.$propHandlers.movex=this.$propHandlers.movey=this.$propHandlers.movez=this.$propHandlers.zoomx=this.$propHandlers.zoomy=this.$propHandlers.zoomz=this.$propHandlers.distance=this.$propHandlers.orbitx=this.$propHandlers.orbity=this.$propHandlers.orbitz=function(c,a){this[a]=parseFloat(c);this.$redraw();};this.$redraw=function(c,a){if(this.$parentChart){this.$parentChart.$redraw(c,a);}};this.$calcViewport=function(){var c=this.x1,j=this.y1,l=this.z1,a=this.x2-c,i=this.y2-j,m=this.z2-l;this.orbitx+=this.orbitxanim;this.orbity+=this.orbityanim;this.orbitz+=this.orbitzanim;this.a=this.$parentChart.a;this.b=this.$parentChart.b;this.c=this.$parentChart.c;this.d=this.$parentChart.d;this.rx=this.orbity,this.ry=this.orbitx,this.rz=this.orbitz+3.141516;this.tx=0,this.ty=0,this.tz=-this.distance;this.vx2=(this.vx1=c+this.movex*-a)+this.zoomx*a,this.vy2=(this.vy1=j+this.movey*i)+this.zoomy*i;this.vz2=(this.vz1=l+this.movez*m)+this.zoomz*m;};this.$drawAxis=function(j){this.$calcViewport();if(this.$doinit){this.$doinit=false;this.$parentChart.$copyPos(this);apf.draw.initLayer(this,this.$parentChart);}else{if(j){this.$parentChart.$copyPos(this);if(this.$_style){this.$parentChart.$copyPos(this.$subpos,this.$_style.margin);}apf.draw.resizeLayer(this,this.$parentChart);}}if(this.$docompile){this.$docompile=false;var l={};var o="axis"+this.mode;if(!this.$_style){this.$_style=apf.draw.parseStyle(apf.chart_draw["_"+o],this.style+this.$styletag,l);}if(this.$_style){this.$parentChart.$copyPos(this.$subpos,this.$_style.margin);}else{this.$parentChart.$copyPos(this.$subpos);}this.$drawCode=apf.chart_draw[o](this,this.$_style);}if(this.$drawCode){this.$drawCode(this,this);}for(var c=0,m=this.childNodes,a=m.length,q;c<a;){if((q=m[c++]).$drawGraph){q.$tilex=this.$tilex,q.$tiley=this.$tiley,q.zoomx=this.zoomx,q.zoomy=this.zoomy,q.zoomz=this.zoomz;q.p3d=this.p3d;q.a=this.a;q.b=this.b;q.c=this.c;q.d=this.d;q.$drawGraph(this,j);}}};this.addEventListener("DOMNodeInsertedIntoDocument",function(a){this.$parentChart=this.parentNode;var c=this.getElementsByTagNameNS(apf.ns.apf,"style");if(c.length>0){this.$styletag=c[0].firstChild.nodeValue.trim().replace(/\t/g," ");}this.$redraw();});}).call(apf.Axis.prototype=new apf.AmlElement());apf.method=function(c,a){this.$init(a||"method",apf.NODE_HIDDEN,c);this.async=true;this.caching=false;this["ignore-offline"]=false;};(function(){this.$parsePrio="002";this.$booleanProperties.async=true;this.$booleanProperties.caching=true;this.$booleanProperties["ignore-offline"]=true;this.$supportedProperties.push("name","receive","async","caching","ignore-offline","method-name");this.$propHandlers["ignore-offline"]=function(a){this.ignoreOffline=a;};this.$propHandlers["method-name"]=function(a){this.methodName=a;};this.addEventListener("DOMNodeInserted",function(a){if(this.parentNode.$addMethod){this.parentNode.$addMethod(this);}});this.addEventListener("DOMNodeRemoved",function(a){if(this.parentNode.$removeMethod){this.parentNode.$removeMethod(this);}});this.addEventListener("DOMNodeInsertedIntoDocument",function(a){if(this.parentNode.$addMethod){this.parentNode.$addMethod(this);}});}).call(apf.method.prototype=new apf.AmlElement());apf.aml.setElement("method",apf.method);apf.jsonrpc=function(){this.supportMulticall=false;this.multicall=false;this.method="POST";this.useXML=false;this.id=0;this.namedArguments=false;this.getSingleCall=function(c,a,d){d.push({method:c,params:a});};this.createMessage=function(d,a){this.fName=d;this.id++;var c="{'method':'"+d+"','params':"+apf.serialize(a)+",'id':"+this.id+"}";return c;};this.$headerHook=function(a){a.setRequestHeader("X-JSON-RPC",this.fName);};this.unserialize=function(c){var a=JSON.parse(c);return a.result;};};apf.yql=function(){this.supportMulticall=false;this.namedArguments=true;this.nocache=false;this.format="xml";this.diagnostics=true;this.debug=false;this.$booleanProperties.diagnostics=true;this.$booleanProperties.debug=true;this.$supportedProperties.push("diagnostics","debug","format");this.$propHandlers.format=function(a){if(!apf.yql.FORMATS[a]){this.format="xml";}};this.unserialize=function(a){return a;};this.getSingleCall=function(c,a,d){d.push(a);};this.createMessage=function(i,d){var c=this.$methods[i],a="POST|PUT".indexOf(c["http-method"])>-1?d.pop():"";this.method=c["http-method"];if(c["content-type"]){this.contentType=c["content-type"];}this.url=apf.yql.PUBLIC+"?q="+encodeURIComponent(this.query)+"&format="+(c.format||this.format)+(typeof c.callback=="string"?"&callback="+encodeURIComponent(c.callback):"")+"&diagnostics="+(c.diagnostics||this.diagnostics)+"&debug="+(c.debug||this.debug);return a;};};apf.yql.PUBLIC="http://query.yahooapis.com/v1/public/yql";apf.yql.PRIVATE="http://query.yahooapis.com/v1/yql";apf.yql.FORMATS={xml:1,json:1};apf.soap=function(){this.supportMulticall=false;this.method="POST";this.useXML=true;this.nsName="m";this.nsURL="http://www.ajax.org";this.namedArguments=true;var a={host:this,0:function(i){var j,c,d=i;for(j in d){if(typeof d[j]!="function"&&j!="type"){c+=this.host.doSerialize(d[j],j);}}return c;},5:function(c){return c.replace(/\]\]/g,"] ]");},2:function(c){return c;},4:function(c){return c==true?1:0;},3:function(i){return c(i.getUTCYear())+j(i.getMonth())+j(i.getUTCDate())+"T"+j(i.getHours())+":"+j(i.getMinutes())+":"+j(i.getSeconds());function j(d){d=String("0"+d);return d.substr(d.length-2,2);}function c(d){if(d>9999||d<0){XMLRPC.handleError(new Error("Unsupported year: "+d));}d=String("0000"+d);return d.substr(d.length-4,4);}},1:function(d){var c="";for(var j=0;j<d.length;j++){c+=this.host.doSerialize(d[j],"item");}return c;}};this.doSerialize=function(i,d){var j=d?i:i[1],d=d?d:i[0];if(typeof j=="function"){throw new Error("Cannot Parse functions");}if(j===false){return"<"+d+' xsi:null="1"/>';}else{return"<"+d+" "+this.getXSIType(j)+">"+a[j.dataType||0](j)+"</"+d+">";}};this.getXSIType=function(d){if(!d.dataType){return"";}else{if(d.dataType==apf.ARRAY){return'xsi:type="SOAP-ENC:Array" SOAP-ENC:arrayType="xsd:ur-type['+d.length+']"';}else{if(d.dataType==apf.NUMBER){return'xsi:type="'+(parseInt(d)==d?"xsd:int":"xsd:float")+'"';}else{if(d.dataType=="data"){return'xsi:type="xsd:timeInstant"';}else{return'xsi:type="xsd:'+d.dataType+'"';}}}}};this.createMessage=function(n,d){var m=['<?xml version="1.0"?>','<SOAP-ENV:Envelope SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"',' xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/"',' xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"',' xmlns:xsd="http://www.w3.org/1999/XMLSchema"',' xmlns:xsi="http://www.w3.org/1999/XMLSchema-instance">',"<SOAP-ENV:Body><",this.nsName,":",n," xmlns:",this.nsName,'="',this.nsURL,'">'];for(var j=0,c=d.length;j<c;j++){m.push(this.doSerialize(d[j]));}m.push("</",this.nsName,":",n,"></SOAP-ENV:Body></SOAP-ENV:Envelope>");return m.join("");};this.$headerHook=function(c){c.setRequestHeader("SOAPAction",'"'+this.url.replace(/http:\/\/.*\/([^\/]*)$/,"$1")+'"');};this.unserialize=function(m){return m;var d,j,c;var l=m.getAttribute("xsi:type");switch(l){case"xsd:string":return(m.firstChild)?new String(m.firstChild.nodeValue):"";break;case"xsd:int":case"xsd:double":case"xsd:float":return(m.firstChild)?parseFloat(m.firstChild.nodeValue):0;break;case"xsd:timeInstant":var q=apf.dateSeparator;if(/^(\d{4})(\d{2})(\d{2})T(\d{2}):(\d{2}):(\d{2})/.test(m.firstChild.nodeValue)){return new Date(RegExp.$2+q+RegExp.$3+q+RegExp.$1+" "+RegExp.$4+":"+RegExp.$5+":"+RegExp.$6);}else{return new Date();}break;case"xsd:boolean":return Boolean(isNaN(parseInt(m.firstChild.nodeValue))?(m.firstChild.nodeValue=="true"):parseInt(m.firstChild.nodeValue));break;case"SOAP-ENC:base64":return apf.crypt.Base64.decode(m.firstChild.nodeValue);break;case"SOAP-ENC:Array":c=m.childNodes;d=[];for(j=0;j<c.length;j++){if(c[j].nodeType!=1){continue;}d.push(this.unserialize(c[j]));}return d;break;default:if(l&&!self[l]){throw new Error(apf.formatErrorString(1084,null,"SOAP","Invalid Object Specified in SOAP message: "+l));}c=m.childNodes;var n=l?new self[l]:{};d=[];for(j=0;j<c.length;j++){if(c[j].nodeType!=1){continue;}d[c[j].tagName]=this.unserialize(c[j]);}return d;break;}};this.isValid=function(c){var i=c.data;if(!apf.supportNamespaces){i.ownerDocument.setProperty("SelectionNamespaces","xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xds='http://www.w3.org/2001/XMLSchema' xmlns:SOAP-ENV='http://schemas.xmlsoap.org/soap/envelope/'");}var d=i.getElementsByTagName("SOAP-ENV:Body")[0];if(!d&&i.getElementsByTagNameNS){d=i.getElementsByTagNameNS("http://schemas.xmlsoap.org/soap/envelope/","Body")[0];}c.data=d;return true;};this.addEventListener("DOMNodeInsertedIntoDocument",function(){this.nsName=this["soap-prefix"]||this.nsName;this.nsURL=this["soap-xmlns"]||this.nsURL;});};apf.jphp=function(){this.supportMulticall=true;this.multicall=false;this.mcallname="multicall";this.method="POST";this.useXML=true;this.namedArguments=false;var createMessage={host:this,0:function(ob){var ob=ob.valueOf();var length=0,x="",prop;for(prop in ob){if(typeof this[prop]!="function"){length++;var r=prop;x+=this.host.doSerialize(r)+";"+this.host.doSerialize(ob[r])+(typeof ob[r]=="object"||typeof ob[r]=="array"?"":";");}}if(ob.className){return"O:"+ob.className.length+':"'+ob.className+'":'+length+":{"+x.substr(0,x.length)+"}";}return"a:"+length+":{"+x.substr(0,x.length)+"}";},5:function(str){var str=str.replace(/[\r]/g,"");str=str.replace(/\]\]/g,"]-]-]").replace(/\]\]/g,"]-]-]");return"s:"+str.length+':"'+str+'"';},2:function(nr){if(nr==parseInt(nr)){return"i:"+nr;}else{if(nr==parseFloat(nr)){return"d:"+nr;}else{return this["boolean"](false);}}},4:function(b){return"b:"+(b==true?1:0);},1:function(ar){var x="a:"+ar.length+":{";for(var i=0;i<ar.length;i++){x+="i:"+i+";"+this.host.doSerialize(ar[i])+(i<ar.length&&typeof ar[i]!="object"&&typeof ar[i]!="array"?";":"");}return x+"}";}};this.unserialize=function(str){return eval(str.replace(/\|-\|-\|/g,"]]").replace(/\|\|\|/g,"\\n"));};this.doSerialize=function(args){if(typeof args=="function"){throw new Error("Cannot Parse functions");}else{if(apf.isNot(args)){return createMessage["boolean"](false);}}return createMessage[args.dataType||0](args);};this.createMessage=function(functionName,args){return"<?xml version='1.0' encoding='UTF-16'?><run m='"+functionName+"'><![CDATA["+this.doSerialize(args)+"]]></run>";};this.isValid=function(extra){var data=extra.data;if(data&&data.tagName=="data"){data=data.firstChild.nodeValue;if(data&&data[0]=="error"){extra.message=data[1];return false;}}else{extra.message="Malformed RPC Message: Parse Error\n\n:'"+http.responseText+"'";return false;}extra.data=data;return true;};};apf.xmlrpc=function(){this.supportMulticall=true;this.multicall=false;this.mcallname="system.multicall";this.method="POST";this.useXML=true;this.namedArguments=false;var a={host:this,0:function(i){var j,c="<struct>",d=i;for(j in d){if(typeof d[j]!="function"&&j!="type"){c+="<member><name>"+j+"</name><value>"+this.host.doSerialize(d[j])+"</value></member>";}}c+="</struct>";return c;},5:function(c){return"<string><![CDATA["+apf.xmlentities(c)+"]]></string>";},2:function(c){if(c==parseInt(c)){return"<int>"+c+"</int>";}else{if(c==parseFloat(c)){return"<double>"+c+"</double>";}else{return this["boolean"](false);}}},4:function(c){if(c==true){return"<boolean>1</boolean>";}else{return"<boolean>0</boolean>";}},3:function(i){return"<dateTime.iso8601>"+c(i.getUTCYear())+j(i.getMonth())+j(i.getUTCDate())+"T"+j(i.getHours())+":"+j(i.getMinutes())+":"+j(i.getSeconds())+"</dateTime.iso8601>";function j(d){d=String("0"+d);return d.substr(d.length-2,2);}function c(d){if(d>9999||d<0){XMLRPC.handleError(new Error(apf.formatErrorString(1085,null,"XMLRPC serialization","Unsupported year: "+d)));}d=String("0000"+d);return d.substr(d.length-4,4);}},1:function(d){var c="<array><data>";for(var j=0;j<d.length;j++){c+="<value>";c+=this.host.doSerialize(d[j]);c+="</value>";}return c+"</data></array>";}};this.getSingleCall=function(d,c,i){i.push({m:d,p:c});};this.doSerialize=function(c){if(typeof c=="function"){throw new Error(apf.formatErrorString(1086,null,"XMLRPC serialization","Cannot Parse functions"));}else{if(apf.isNot(c)){return a["boolean"](false);}}return a[c.dataType||0](c);};this.createMessage=function(l,c){var j=['<?xml version="1.0" encoding="UTF-8"?><methodCall><methodName>',l,"</methodName><params>"];for(var d=0;d<c.length;d++){j.push("<param><value>",this.doSerialize(c[d]),"</value></param>");}j.push("</params></methodCall>");return j.join("");};this.unserialize=function(j){var c,d;switch(j.tagName){case"string":if(apf.isGecko){j=(new XMLSerializer()).serializeToString(j);j=j.replace(/^\<string\>/,"");j=j.replace(/\<\/string\>$/,"");j=j.replace(/\&lt;/g,"<");j=j.replace(/\&gt;/g,">");return j;}return(j.firstChild)?j.firstChild.nodeValue:"";break;case"int":case"i4":case"double":return(j.firstChild)?new Number(j.firstChild.nodeValue):0;break;case"dateTime.iso8601":var l=apf.dateSeparator;if(/^(\d{4})(\d{2})(\d{2})T(\d{2}):(\d{2}):(\d{2})/.test(j.firstChild.nodeValue)){return new Date(RegExp.$2+l+RegExp.$3+l+RegExp.$1+" "+RegExp.$4+":"+RegExp.$5+":"+RegExp.$6);}else{return new Date();}break;case"array":j=apf.getNode(j,[0]);if(j&&j.tagName=="data"){c=new Array();var m;d=0;while(m=apf.getNode(j,[d++])){c.push(this.unserialize(m));}return c;}else{this.handleError(new Error(apf.formatErrorString(1087,null,"","Malformed XMLRPC Message")));return false;}break;case"struct":c={};d=0;while(m=apf.getNode(j,[d++])){if(m.tagName=="member"){c[apf.getNode(m,[0]).firstChild.nodeValue]=this.unserialize(apf.getNode(m,[1]));}else{this.handleError(new Error(apf.formatErrorString(1087,null,"","Malformed XMLRPC Message2")));return false;}}return c;break;case"boolean":return Boolean(isNaN(parseInt(j.firstChild.nodeValue))?(j.firstChild.nodeValue=="true"):parseInt(j.firstChild.nodeValue));break;case"base64":return apf.crypt.Base64.decode(j.firstChild.nodeValue);break;case"value":m=apf.getNode(j,[0]);return(!m)?((j.firstChild)?new String(j.firstChild.nodeValue):""):this.unserialize(m);break;default:throw new Error(apf.formatErrorString(1088,null,"","Malformed XMLRPC Message: "+j.tagName));return false;break;}};this.isValid=function(c){var i=c.data;if(apf.getNode(i,[0]).tagName=="fault"){var d,j;if(!apf.isWebkit){d=i.selectSingleNode("//member[name/text()='faultCode']/value/int/text()").nodeValue;j="\n"+i.selectSingleNode("//member[name/text()='faultString']/value/string/text()").nodeValue;}else{d=j="";}c.message=j;c.errorcode=d;return false;}c.data=apf.getNode(i,[0,0,0]);return true;};};apf.header=function(){this.supportMulticall=false;this.method="GET";this.vartype="header";this.isXML=true;this.namedArguments=true;this.unserialize=function(a){return a;};this.createMessage=function(m,d){for(var a=[],j=0,c=d.length;j<c;j++){if(!d[j][0]||!d[j][1]){continue;}http.setRequestHeader(d[j][0],d[j][1]);}this.$HeaderHook=new Function("http",a.join("\n"));return"";};};apf.rest=function(){this.supportMulticall=false;this.namedArguments=false;this.nocache=false;this.unserialize=function(a){return a;};this.getSingleCall=function(c,a,d){d.push(a);};this.createMessage=function(j,i){if(!this.baseUrl){this.baseUrl=this.url;}var d=this.$methods[j],a="NOTIFY|SEND|POST|PUT".indexOf(d["http-method"])>-1?i.pop():"",c;this.method=d["http-method"];if(d["content-type"]){this.contentType=d["content-type"];}this.url=(c=this.urls[j]?this.urls[j]:this.baseUrl)+(i.length?(c.charAt(c.length-1)=="/"?"":"/")+i.join("/"):"");return a;};};apf.cgi=function(){this.supportMulticall=false;this.namedArguments=true;this.unserialize=function(a){return a;};this.getSingleCall=function(c,a,d){d.push(a);};this.createMessage=function(j,a){var m,l=[];function d(q,i){if(q&&q.dataType==apf.ARRAY){for(var n=0;n<q.length;n++){d(q[n],i+"%5B"+n+"%5D");}}else{if(typeof q=="object"){for(m in q){if(apf.isSafariOld&&(!q[m]||typeof q[m]!="object")){continue;}if(typeof q[m]=="function"){continue;}d(q[m],i+"%5B"+encodeURIComponent(m)+"%5D");}}else{if(typeof q!="undefined"&&q!==null){l.push(i+"="+encodeURIComponent(q));}}}}if(this.multicall){l.push("func="+this.mcallname);for(var c=0;c<a[0].length;c++){d(a[0][c],"f%5B"+c+"%5D");}}else{for(m in a){if(apf.isSafariOld&&(!a[m]||typeof a[m]=="function")){continue;}d(a[m],m);}}if(!this.baseUrl){this.baseUrl=this.url;}this.url=this.$methods[j].url?this.$methods[j].url:this.baseUrl;if(this.method!="GET"){return l.join("&");}this.url=this.url+(l.length?(this.url.indexOf("?")>-1?"&":"?")+l.join("&"):"");return"";};this.addEventListener("DOMNodeInsertedIntoDocument",function(){this.method=(this["http-method"]||"GET").toUpperCase();this.contentType=this.method=="GET"?null:"application/x-www-form-urlencoded";});this.submitForm=function(n,q){if(!this["postform"]){this.addMethod("postform",q);}var d=[];for(var m=0,a=n.elements.length;m<a;m++){if(!n.elements[m].name){continue;}if(n.elements[m].tagname=="input"&&(n.elements[m].type=="checkbox"||n.elements[m].type=="radio")&&!n.elements[m].checked){continue;}if(n.elements[m].tagname="select"&&n.elements[m].multiple){for(var c=0;c<n.elements[m].options.length;c++){if(n.elements[m].options[c].selected){d.push(n.elements[m].name+"="+encodeURIComponent(n.elements[m].options[c].value));}}}else{d.push(n.elements[m].name+"="+encodeURIComponent(n.elements[m].value));}}var o=(n.action||location.href);this.urls.postform=o+(o.indexOf("?")>-1?"&":"?")+d.join("&");this["postform"].call(this);return false;};};apf.audio.TypeFlash=function(a,d,c){this.oAudio=a;this.isNine=apf.flash.isAvailable("9.0.0");this.DEFAULT_SWF_PATH=(apf.config.resourcePath||apf.basePath)+"resources/soundmanager2"+(this.isNine?"_flash9":"")+".swf";this.NULL_MP3_PATH=(apf.config.resourcePath||apf.basePath)+"resources/null.mp3";this.id=apf.flash.addPlayer(this);this.inited=false;this.divName=a.$uniqueId;this.htmlElement=d;this.name="soundmgr_"+a.$uniqueId;this.audioPath=c.src;this.paused=false;this.player=null;apf.extend(this,apf.audio.TypeInterface);this.delayCalls=[];this.totalTime=this.bytesLoaded=this.totalBytes=0;this.state=null;this.autoPlay=this.autoLoad=this.firstLoad=true;this.volume=50;this.playheadTime=null;this.bufferTime=0.1;this.playheadUpdateInterval=1000;this.setOptions(c).createPlayer();};apf.audio.TypeFlash.isSupported=function(){return apf.flash.isAvailable();};apf.audio.TypeFlash.prototype={properties:["volume","autoPlay","autoLoad","playHeadTime","totalTime","bufferTime","playheadUpdateInterval"],load:function(a,c){this.setTotalTime(c);if(a!=null){this.audioPath=a;}if(this.audioPath==null&&!this.firstLoad){return this.oAudio.$errorHook({type:"error",error:"SoundManager::play - No audioPath has been set."});}if(a==null&&this.firstLoad&&!this.autoLoad){a=this.audioPath;}this.firstLoad=false;this.callMethod("unloadSound",this.NULL_MP3_PATH);if(this.isNine){this.callMethod("createSound",this.audioPath,0,true,true,true,false,false);}else{this.callMethod("createSound",0);}this.callMethod("setVolume",this.volume).callMethod("loadSound",this.audioPath,true,this.autoPlay);return this;},play:function(){if(!this.paused){return this.callMethod("startSound",1,0);}return this.pause();},pause:function(){this.paused=!this.paused;return this.callMethod("pauseSound");},stop:function(){return this.callMethod("stopSound",true);},seek:function(a){return this.callMethod("setPosition",a,this.paused);},setVolume:function(a){return this.callMethod("setVolume",a);},getPlayheadTime:function(){return this.playheadTime;},setPlayheadTime:function(a){return this.playheadTime=a;},getTotalTime:function(){return this.totalTime;},setTotalTime:function(a){if(!a){return;}return this.totalTime=a;},callMethod:function(){if(!this.inited||!this.player||!this.player.callMethod){this.delayCalls.push(arguments);}else{var a=Array.prototype.slice.call(arguments);a.unshift(this.player,"callMethod");apf.flash.remote.apply(null,a);}return this;},makeDelayCalls:function(){for(var c=0,a=this.delayCalls.length;c<a;c++){this.callMethod.apply(this,this.delayCalls[c]);}return this;},event:function(c,a){switch(c){case"progress":this.bytesLoaded=a.bytesLoaded;this.totalBytes=a.totalBytes;this.oAudio.$progressHook({type:"progress",bytesLoaded:this.bytesLoaded,totalBytes:this.totalBytes});break;case"playheadUpdate":this.playheadTime=a.playheadTime;this.totalTime=a.totalTime;this.oAudio.$changeHook({type:"change",playheadTime:this.playheadTime,totalTime:this.totalTime});if(a.waveData||a.peakData||a.eqData){this.oAudio.$metadataHook({type:"metadata",waveData:a.waveData,peakData:a.peakData,eqData:a.eqData});}break;case"stateChange":this.state=a.state;this.oAudio.$stateChangeHook({type:"stateChange",state:this.state});break;case"change":this.oAudio.$changeHook({type:"change"});break;case"complete":this.oAudio.$completeHook({type:"complete"});break;case"ready":this.callMethod("setPan",0);if(this.paused&&this.autoPlay){this.paused=false;}this.oAudio.$readyHook({type:"ready"});break;case"metaData":this.oAudio.$metadataHook({type:"metaData",infoObject:a});break;case"cuePoint":this.oAudio.$cuePointHook({type:"cuePoint",infoObject:a});break;case"init":if(this.inited){return;}this.inited=true;this.makeDelayCalls();this.player.callMethod("setPolling",true);this.oAudio.$initHook(apf.extend(a,apf.flash.getSandbox(a.sandboxType)));break;case"id3":this.oAudio.$metadataHook({type:"metadata",id3Data:a});break;case"debug":apf.console.log(">> SWF DBUG: "+a.msg);break;}},createPlayer:function(){var a=this.htmlElement;if(a==null){return this;}a.style.position="absolute";a.style.width="1px";a.style.height="1px";a.style.left="-2000px";apf.flash.embed({context:this,htmlNode:a,property:"player",src:this.DEFAULT_SWF_PATH,align:"middle",id:this.name,quality:"high",name:this.name,flashvars:"playerID="+this.id,allowScriptAccess:"always",type:"application/x-shockwave-flash",pluginspage:"http://www.adobe.com/go/getflashplayer",menu:"true"});return this;},$destroy:function(){this.callMethod("destroySound");if(this.player){delete this.player;this.player=null;}}};apf.audio.TypeNative=function(a,d,c){this.oAudio=a;this.inited=false;this.divName=a.$uniqueId;this.htmlElement=d;this.name="soundmgr_"+a.$uniqueId;this.audioPath=c.src;this.paused=false;this.player=null;apf.extend(this,apf.audio.TypeInterface);this.setOptions(c).createPlayer();};apf.audio.TypeNative.isSupported=function(){return apf.hasAudio;};apf.audio.TypeNative.prototype={load:function(a,c){if(c!=null){this.setTotalTime(c);}if(a!=null){this.audioPath=a;}if(this.audioPath==null&&!this.firstLoad){return this.oAudio.$errorHook({type:"error",error:"SoundManager::play - No audioPath has been set."});}if(a==null&&this.firstLoad&&!this.autoLoad){a=this.audioPath;}this.firstLoad=false;this.setVolume(this.volume);return this;},play:function(){if(!this.paused){return this.player.play();}return this.pause();},pause:function(){return this.player.pause();},stop:function(){return this.player.stop();},seek:function(a){return this.player.currentTime=parseInt(a)/1000;},setVolume:function(a){this.player.volume=parseInt(a)/100;return this;},getPlayheadTime:function(){return this.player.playheadTime;},setPlayheadTime:function(a){this.playheadTime=parseInt(a);return this;},getTotalTime:function(){return this.totalTime;},setTotalTime:function(a){this.totalTime=parseInt(a);return this;},event:function(c,a){switch(c){case"progress":this.bytesLoaded=a.bytesLoaded;this.totalBytes=a.totalBytes;this.oAudio.$progressHook({type:"progress",bytesLoaded:this.bytesLoaded,totalBytes:this.totalBytes});break;case"playheadUpdate":this.playheadTime=a.playheadTime;this.totalTime=a.totalTime;this.oAudio.$changeHook({type:"change",playheadTime:this.playheadTime,totalTime:this.totalTime});if(a.waveData||a.peakData||a.eqData){this.oAudio.$metadataHook({type:"metadata",waveData:a.waveData,peakData:a.peakData,eqData:a.eqData});}break;case"stateChange":this.state=a.state;this.oAudio.$stateChangeHook({type:"stateChange",state:this.state});break;case"change":this.oAudio.$changeHook({type:"change"});break;case"complete":this.oAudio.$completeHook({type:"complete"});break;case"ready":if(this.paused&&this.autoPlay){this.paused=false;}this.oAudio.$readyHook({type:"ready"});break;case"metaData":this.oAudio.$metadataHook({type:"metaData",infoObject:a});break;case"cuePoint":this.oAudio.$cuePointHook({type:"cuePoint",infoObject:a});break;case"init":this.inited=true;this.oAudio.$initHook(apf.extend(a,apf.flash.getSandbox(a.sandboxType)));break;case"id3":this.oAudio.$metadataHook({type:"metadata",id3Data:a});break;case"debug":apf.console.log(">> SWF DBUG: "+a.msg);break;}},createPlayer:function(){var j=this.htmlElement;if(j==null){return this;}j.style.position="absolute";j.style.width="1px";j.style.height="1px";j.style.left="-2000px";var d=this.player=document.createElement("audio");d.setAttribute("src",this.audioPath);d.setAttribute("volume",this.volume);if(this.autoPlay){d.setAttribute("autoplay","true");}j.appendChild(d);var c=this,i;d.addEventListener("canplay",function(){c.oAudio.$readyHook({type:"ready"});},false);d.addEventListener("timeupdate",i=function(a){c.playheadTime=parseInt(c.player.currentTime||0)*1000;c.totalTime=parseInt(c.player.duration)*1000;c.oAudio.$changeHook({type:"change",playheadTime:c.playheadTime,totalTime:c.totalTime});},false);d.addEventListener("duration",i,false);d.addEventListener("volumechange",function(){c.oAudio.$changeHook({type:"change",volume:c.player.muted?0:parseInt(c.player.volume)*100});},false);d.addEventListener("progress",function(a){c.bytesLoaded=a.loaded;c.totalBytes=a.total;c.oAudio.$progressHook({type:"progress",bytesLoaded:c.bytesLoaded,totalBytes:c.totalBytes});},false);d.addEventListener("ended",function(){c.oAudio.$completeHook({type:"complete"});},false);d.addEventListener("error",function(a){throw new Error(apf.formatErrorString(0,c,"Audio playback",a.message,c.oAudio));},false);d.load();return this;},$destroy:function(){if(!this.player){return;}this.player.setAttribute("src","");delete this.player;this.player=null;}};apf.modalwindow.widget=function(){var m,l,c,j,d;var a=this;this.$isWindowContainer=false;this.kbclose=false;this.$isWidget=true;this.dragStart=function(s){if(!s){s=event;}if(a.state.indexOf("maximized")>-1||!a.draggable){return;}m=a.$ext.offsetLeft-s.clientX-document.documentElement.scrollLeft;l=a.$ext.offsetTop-s.clientY-document.documentElement.scrollTop;var o=a.$ext;var q=a.positionHolder;if(!q){var q=this.positionHolder=document.body.appendChild(document.createElement("div"));}q.className="position_holder";o.parentNode.insertBefore(q,o);q.style.height=(o.offsetHeight-(apf.isIE6?0:apf.getHeightDiff(q)))+"px";var n=[o.style.width,o.style.height];o.style.width=(o.offsetWidth-apf.getWidthDiff(o))+"px";o.style.left=(s.clientX+m)+"px";o.style.top=(s.clientY+l)+"px";o.style.position="absolute";o.style.zIndex=o.parentNode.style.zIndex=100000;o.parentNode.style.left="0";o.parentNode.style.minHeight=(o.parentNode.offsetHeight-apf.getHeightDiff(o.parentNode))+"px";if(apf.isIE<8){apf.setStyleClass(o,"dockletDrag");}if(!apf.hasStyleFilters){apf.tween.fade(o,0.8);}apf.dragMode=true;d=[o,q];document.onmousemove=a.dragMove;document.onmouseup=function(){document.onmousemove=document.onmouseup=null;o.style.position="";o.style.left=0;o.style.top=0;o.style.width=n[0];o.style.zIndex=o.parentNode.style.zIndex=1;o.parentNode.style.minHeight="";q.parentNode.insertBefore(o,q);q.parentNode.removeChild(q);apf.tween.fade(o,1);if(apf.isIE<8){apf.setStyleClass(o,"",["dockletDrag"]);}a.parentNode.$moveDocklet(a);if(!apf.supportOpacity||o.className.indexOf("dockblank")>-1){o.style.filter="";}if(a.$ext){apf.layout.forceResize(a.$ext);}apf.dragMode=false;};if(apf.isIE){document.onmousemove();}s.cancelBubble=true;return false;};function i(q,z){var A=apf.getAbsolutePosition(q);var t=z-A[1];var n=q.childNodes;for(var o=0,w=0,u=n.length;w<u;w++){var s=n[w];if(s.nodeType!=1||apf.getStyle(s,"position")=="absolute"){continue;}o=s.offsetTop+s.offsetHeight;if(o>t){q.insertBefore(d[1],o-(s.offsetHeight/2)>t?s:s.nextSibling);break;}}if(w==n.length){q.appendChild(d[1]);}}this.dragMove=function(s){if(!s){s=event;}a.$ext.style.top="10000px";var o=s.clientX;var n=s.clientY;var q=document.elementFromPoint(o,n);if(q){if(q.isColumn){i(q,n);}else{while(q.parentNode&&!q.isColumn){q=q.parentNode;}if(q.isColumn){i(q,n);}}}a.$ext.style.left=(s.clientX+m+document.documentElement.scrollLeft)+"px";a.$ext.style.top=(s.clientY+l+document.documentElement.scrollTop)+"px";s.cancelBubble=true;};this.$loadAml=function(n){this.$create();};this.$create=function(){apf.WinServer.setTop(this);var n=apf.getDiff(this.$ext);j=n[0];c=n[1];this.oDrag.onmousedown=this.dragStart;this.collapsedHeight=this.$getOption("Main","collapsed-height");if(this.resizable){this.resizable=false;}if(this.draggable===undefined){this.draggable=true;}this.minwidth=this.$getOption("Main","min-width");this.minheight=this.$getOption("Main","min-height");};};apf.textbox.masking=function(){var l=9128748732;var B={"0":"\\d","1":"[12]","9":"[\\d ]","#":"[\\d +-]",L:"[A-Za-z]","?":"[A-Za-z ]",A:"[A-Za-z0-9]",a:"[A-Za-z0-9 ]",X:"[0-9A-Fa-f]",x:"[0-9A-Fa-f ]","&":"[^s]",C:"."};var t=-1;var c=false;var d=this.$ext;var q,s=[],a,z,A,j;this.setPosition=function(C){w(C||t||0);};this.addEventListener("$clear",function(){this.value="";if(this.mask){return this.setValue("");}});this.$propHandlers.value=function(E){var D="";if(this.includeNonTypedChars){for(var C=0;C<q.length;C++){if(q.substr(C,1)!=E.substr(C,1)){D+=E.substr(C,1);}}}this.$insertData(D||E);};var i={"96":"0","97":"1","98":"2","99":"3","100":"4","101":"5","102":"6","103":"7","104":"8","105":"9","106":"*","107":"+","109":"-","110":".","110":"/"};this.addEventListener("keydown",function(G){var D=G.keyCode,C=false;switch(D){case 39:w(t+1);C=true;break;case 37:w(t-1);C=true;break;case 35:case 34:w(a.length);C=true;break;case 33:case 36:w(0);C=true;break;case 8:o(t-1);w(t-1);C=true;break;case 46:o(t);w(t);C=true;break;default:if(D==67&&G.ctrlKey){window.clipboardData.setData("Text",this.getValue());C=true;}break;}var E=i[D]||String.fromCharCode(D);if(u(E)){w(t+1);}var F,I=t;if(this.realtime&&(F=this.getValue())!=this.value){this.change(F);w(I);}if(apf.isCharacter(G.keyCode)||C){return false;}},true);this.$initMasking=function(){this.$keyHandler=null;c=true;this.$int[apf.isIphone?"onclick":"onmouseup"]=function(C){var D=Math.min(n(),a.length);w(D);return false;};this.$int.onpaste=function(C){C=C||window.event;C.returnValue=false;this.host.setValue(window.clipboardData.getData("Text")||"");$setTimeout(function(){w(t);},1);};this.getValue=function(){if(this.includeNonTypedChars){return q==this.$int.value?"":this.$int.value.replace(new RegExp(j,"g"),"");}else{return a.join("");}};this.setValue=function(E){if(this.includeNonTypedChars){for(var D="",C=0;C<q.length;C++){if(q.substr(C,1)!=E.substr(C,1)){D+=E.substr(C,1);}}}this.$insertData(D);};};this.setMask=function(F){if(!c){this.$initMasking();}F=F.split(";");j=F.pop();this.includeNonTypedChars=parseInt(F.pop())!==0;var N=F.join("");var G="",C="",E="-",M=false,D=false,I;s=[],z="",A="";for(var K=-1,J=0;J<N.length;J++){I=N.substr(J,1);if(!I.match(/[\!\'\"\>\<\\]/)){K++;}else{if(I=="!"){D=true;}else{if(I=="<"||I==">"){E=I;}else{if(I=="'"||I=='"'){M=!M;}}}continue;}if(!M&&B[I]){s.push(K);C+=j;z+=I;A+=E;G+=B[I];}else{C+=I;}}this.$int.value=C;q=C;a=[];j=j;};function m(C,E){var D=z.substr(E,1);var F=A.substr(E,1);if(C.match(new RegExp(B[D]))==null){return l;}if(F==">"){return C.toUpperCase();}if(F=="<"){return C.toLowerCase();}return C;}function w(D){if(D<0){D=0;}if(apf.hasMsRangeObject){var C=d.createTextRange();C.expand("textedit");C.select();if(s[D]==null){C.collapse(false);C.select();t=s.length;return false;}C.collapse();C.moveStart("character",s[D]);C.moveEnd("character",1);C.select();}else{if(typeof s[D]=="undefined"){d.selectionStart=d.selectionEnd=s[s.length-1]+1;t=s.length;return false;}d.selectionStart=s[D];d.selectionEnd=s[D]+1;}t=D;}function u(E){if(s[t]==null){return false;}E=m(E,t);if(E==l){return false;}if(apf.hasMsRangeObject){var D=d.createTextRange();D.expand("textedit");D.collapse();D.moveStart("character",s[t]);D.moveEnd("character",1);D.text=E;if(apf.document.activeElement==this){D.select();}}else{var F=d.value,G=d.selectionStart,C=d.selectionEnd;d.value=F.substr(0,G)+E+F.substr(C);d.selectionStart=G;d.selectionEnd=C;}a[t]=E;return true;}function o(E){if(s[E]==null){return false;}if(apf.hasMsRangeObject){var D=d.createTextRange();D.expand("textedit");D.collapse();D.moveStart("character",s[E]);D.moveEnd("character",1);D.text=j;D.select();}else{var F=d.value,G=s[E],C=s[E]+1;d.value=F.substr(0,G)+j+F.substr(C);d.selectionStart=G;d.selectionEnd=C;}a[E]=" ";}this.$insertData=function(I){if(I==this.getValue()){return;}var E,C;try{if(!apf.hasMsRangeObject&&d.selectionStart==d.selectionEnd){w(0);}}catch(D){if(!I){return;}var F,G;for(E=0,C=I.length;E<C;E++){t=E;if(s[t]==null){continue;}F=m(I.substr(E,1),E);if(F==l){continue;}G=d.value;d.value=G.substr(0,s[E])+F+G.substr(s[E]+1);}if(I.length){t++;}return;}I=this.dispatchEvent("insert",{data:I})||I;if(!I){if(!this.getValue()){return;}for(E=this.getValue().length-1;E>=0;E--){o(E);}w(0);return;}for(E=0,C=I.length;E<C;E++){t=E;u(I.substr(E,1));if(!apf.hasMsRangeObject){w(E+1);}}if(I.length){t++;}};function n(){var E,C=0;if(!apf.hasMsRangeObject){C=d.selectionStart;}else{E=document.selection.createRange();var D=E.duplicate();D.expand("textedit");D.setEndPoint("EndToStart",E);C=D.text.length;}for(var F=0;F<s.length;F++){if(s[F]>C){return(F==0)?0:F-1;}}return a.length;}};apf.textbox.autocomplete=function(){var a={};this.initAutocomplete=function(c){c.parentNode.removeChild(c);a.nodeset=c.getAttribute("nodeset").split(":");a.method=c.getAttribute("method");a.value=c.getAttribute("value");a.count=parseInt(c.getAttribute("count"))||5;a.sort=c.getAttribute("sort");a.lastStart=-1;this.oContainer=apf.insertHtmlNode(this.$getLayoutNode("container"),this.$ext.parentNode,this.$ext.nextSibling);};this.fillAutocomplete=function(t){if(t){switch(t){case 9:case 27:case 13:return this.oContainer.style.display="none";case 40:if(a.suggestData&&a.lastStart<a.suggestData.length){this.clear();var q=a.suggestData[a.lastStart++];this.$int.value=q;this.change(q);this.oContainer.style.display="none";return;}break;case 38:if(a.lastStart>0){if(a.lastStart>=a.suggestData.length){a.lastStart=a.suggestData.length-1;}this.clear();var q=a.suggestData[a.lastStart--];this.$int.value=q;this.change(q);this.oContainer.style.display="none";return;}break;}if(t>10&&t<20){return;}}if(a.method){var d=0,s=self[a.method]();a.count=s.length;}else{if(this.$int.value.length==0){this.oContainer.style.display="none";return;}if(!a.suggestData){var c=self[a.nodeset[0]].data.selectNodes(a.nodeset[1]);for(var q,s=[],m=0;m<c.length;m++){q=apf.queryValue(c[m],a.value);if(q){s.push(q.toLowerCase());}}if(a.sort){s.sort();}a.suggestData=s;}else{s=a.suggestData;}var q=this.$int.value.toUpperCase();for(var d=s.length-a.count,m=0;m<s.length;m++){if(q<=s[m].toUpperCase()){d=m;break;}}a.lastStart=d;}this.oContainer.innerHTML="";this.oContainer.style.left=this.$int.offsetLeft+"px";this.oContainer.style.top=this.$int.offsetTop+"px";for(var n=[],l=d;l<Math.min(d+a.count,s.length);l++){this.$getNewContext("item");var o=this.$getLayoutNode("item");apf.setNodeValue(this.$getLayoutNode("item","caption"),s[l]);o.setAttribute("onmouseover",'this.className = "hover"');o.setAttribute("onmouseout",'this.className = ""');o.setAttribute("onmousedown","event.cancelBubble = true");o.setAttribute("onclick","var o = apf.lookup("+this.$uniqueId+");                o.$int.value = this.innerHTML;                o.change(this.innerHTML);                o.$int.select();                o.$int.focus();                o.oContainer.style.display = 'none';");n.push(this.$getLayoutNode("item"));}apf.insertHtmlNode(n,this.oContainer);this.oContainer.style.display="block";};this.setAutocomplete=function(c,i,d){a.lastStart=-1;a.suggestData=null;a.nodeset=[c,i];a.value=d;this.oContainer.style.display="none";};};apf.xmpp_muc=function(){var d=this,c={},l="SID",i="JID",a="connected";this.$mucRoster=new apf.xmpp_roster(this.oMucModel,{muc:true},this.resource);function j(m){if(!m){return;}d.$doXmlRequest(d.$restartListener,d.$isPoll?d.$createStreamElement(null,null,m):d.$createBodyElement({rid:d.$getRID(),sid:d.$serverVars[l],xmlns:apf.xmpp.NS.httpbind},m));}this.$getStatusCode=function(o,s){var q=o.getElementsByTagName("status");for(var n=0,m=q.length;n<m;n++){if(q[n]&&parseInt(q[n].getAttribute("code"))==s){return s;}}return false;};this.queryRooms=function(){if(!this.$canMuc||!this.$serverVars[a]){return;}j(this.$createIqBlock({from:this.$serverVars[i],to:this.$mucDomain,type:"get",id:this.$makeUnique("disco")},"<query xmlns='"+apf.xmpp.NS.disco_items+"'/>"));};this.$addRoom=function(n,m){return this.$mucRoster.getEntityByJID(n.replace(/\/.*$/,""),m);};this.$isRoom=function(n){var m=n.replace(/\/.*$/,"").split("@");return this.$mucRoster.getEntity(m[0],m[1],null,true)?true:false;};this.$addRoomOccupant=function(m){return this.$mucRoster.getEntityByJID(m);};this.queryRoomInfo=function(m){};this.getRoom=function(m,n){if(!this.$canMuc||!this.$serverVars[a]){return;}c["room_cb_"+m]=n;j(this.$createIqBlock({from:this.$serverVars[i],to:m,type:"get",id:this.$makeUnique("disco")},"<query xmlns='"+apf.xmpp.NS.disco_items+"'/>"));};this.$mucSignal=function(o,n){n=n.replace(/\/.*$/,"");var q="room_cb_"+n,m=c[q];delete c[q];if(typeof m!="function"){return;}switch(o){case apf.xmpp_muc.ROOM_CREATE:case apf.xmpp_muc.ROOM_EXISTS:m(true);break;case apf.xmpp_muc.ROOM_NOTFOUND:m(false);break;}};this.joinRoom=function(n,m,o){if(!n||!this.$canMuc||!this.$serverVars[a]){return;}if(!o){o=this.$serverVars.username;}var q=n.split("@");this.$mucRoster.registerAccount(q[0],q[1],o);j(this.$createPresenceBlock({from:this.$serverVars[i],to:n+"/"+o},"<x xmlns='"+apf.xmpp.NS.muc+(m?"'><password>"+m+"</x>":"'/>")));};this.leaveRoom=function(n,m,o){if(!n||!this.$canMuc||!this.$serverVars[a]){return;}if(!o){o=this.$serverVars.username;}j(this.$createPresenceBlock({from:this.$serverVars[i],to:n+"/"+o,type:apf.xmpp.TYPE_UNAVAILABLE},m?"<status>"+m+"</status>":""));};this.leaveAllRooms=function(n,q){if(!this.$canMuc||!this.$serverVars[a]){return;}if(!q){q=this.$serverVars.username;}var o,m,s=this.$mucRoster.getRooms();for(o=0,m=s.length;o<m;o++){this.leaveRoom(s[o].bareJID,n,q);}};this.changeNick=function(m,n){if(!m||!this.$canMuc||!this.$serverVars[a]){return;}if(!n){n=this.username;}var o=m.split("@");this.$mucRoster.registerAccount(o[0],o[1],n);j(this.$createPresenceBlock({from:this.$serverVars[i],to:m+"/"+n}));};this.invite=function(n,q,m){var o=this.$serverVars.roster.getEntityByJID(q);if(!o){return;}j(createMessageBlock({from:d.$serverVars[i],to:n},"<x xmlns='"+apf.xmpp.NS.muc_user+"'><invite to='"+o.bareJID+(m?"'><reason>"+m+"</reason></invite>":"'/>")+"</x>"));};this.declineInvite=function(n,q,m){var o=this.$serverVars.roster.getEntityByJID(q);if(!o){return;}j(createMessageBlock({from:d.$serverVars[i],to:n},"<x xmlns='"+apf.xmpp.NS.muc_user+"'><decline to='"+o.bareJID+(m?"'><reason>"+m+"</reason></invite>":"'/>")+"</x>"));};this.moderate=function(n,m){};this.createRoom=function(m,n,s){if(!m||!this.$canMuc||!this.$serverVars[a]){return;}if(!n){n=this.$serverVars.username;}m=this.$mucRoster.sanitizeJID(m);var q=m.split("@"),o="room_cb_"+m;this.$mucRoster.registerAccount(q[0],q[1],n);c[o]=function(t){delete c[o];if(!t){return(typeof s=="function"?s(t):false);}c[o]=function(u){delete c[o];d.$addRoom(m,m.substr(0,m.indexOf("@")));if(s){s(u);}};j(d.$createIqBlock({from:d.$serverVars[i],to:m,type:"set",id:d.$makeUnique("create")},"<query xmlns='"+apf.xmpp.NS.muc_owner+"'><x xmlns='"+apf.xmpp.NS.data+"' type='submit'/></query>"));};j(this.$createPresenceBlock({from:this.$serverVars[i],to:m+"/"+n},"<x xmlns='"+apf.xmpp.NS.muc+"'/>"));};this.joinOrCreateRoom=function(m,n){if(!m||!this.$canMuc||!this.$serverVars[a]){return;}if(!n){n=this.$serverVars.username;}var o=m.split("@");this.$mucRoster.registerAccount(o[0],o[1],n);m=this.$mucRoster.sanitizeJID(m);this.getRoom(m,function(q){if(q){return d.joinRoom(m,null,n);}d.createRoom(m,n,function(s){if(s){d.joinRoom(m,null,n);}});});};this.destroyRoom=function(n,m){if(!n||!this.$canMuc||!this.$serverVars[a]){return;}j(this.$createIqBlock({from:this.$serverVars[i],to:n,type:"set",id:this.$makeUnique("create")},"<query xmlns='"+apf.xmpp.NS.muc_owner+"'><destroy jid='"+n+(m?"'><reason>"+m+"</reason></destroy>":"'/>")+"</query>"));};};apf.xmpp_muc.ROOM_CREATE=1;apf.xmpp_muc.ROOM_EXISTS=2;apf.xmpp_muc.ROOM_NOTFOUND=3;apf.xmpp_muc.ROOM_JOINED=4;apf.xmpp_muc.ROOM_LEFT=5;apf.xmpp_muc.ACTION_SUBJECT=1;apf.xmpp_muc.ACTION_KICK=2;apf.xmpp_muc.ACTION_BAN=4;apf.xmpp_muc.ACTION_GRANT=8;apf.xmpp_muc.ACTION_REVOKE=16;apf.xmpp_roster=function(c,a,d){this.resource=d;this.username=this.domain=this.fullJID="";var l=[],j=[],i={node:1,domain:1,resource:1,bareJID:1,fullJID:1,status:1};this.registerAccount=function(o,n,m){if(!m){m=this.resource;}else{this.resource=m;}this.username=o||"";this.domain=n||"";this.bareJID=this.username+"@"+this.domain;this.fullJID=this.username+"@"+this.domain+(m?"/"+m:"");};this.getEntity=function(o,w,s,C){if(typeof o=="undefined"){return null;}var D=[];if(o.indexOf("@")!=-1){var B=o.split("@");o=B[0];w=B[1];}var m,z,q,u,A=(s&&!C),t=o+"@"+w+(s?"/"+s:"");for(z=0,q=l.length;z<q;z++){m=l[z];if(m&&m.node==o&&m.domain==w&&(!A||m.resources.contains(s))&&(!C||m.isRoom)){D.push(m);if(m.fullJID==t){u=m;}}}if(D.length===0){return null;}if(D.length>1&&u){return u;}return(D.length==1)?D[0]:D;};this.getEntityByJID=function(q,o){var u=null,s;if(!o){o={};}if(q.indexOf("/")!=-1){u=q.substring(q.indexOf("/")+1)||"";q=q.substring(0,q.indexOf("/"));}if(q.indexOf("@")!=-1){s=q.substring(0,q.indexOf("@"));q=q.substring(q.indexOf("@")+1);}var t=q,m=this.getEntity(s,t,a.muc?u:null),n=s+"@"+t;if(!m){var w=(a.muc&&!u);m=this.update({node:s,domain:t,resources:u?[u]:[],bareJID:n,fullJID:n+(u?"/"+u:""),isRoom:w,room:(a.muc&&u)?n:null,roomJID:null,subscription:o.subscription||"",affiliation:null,role:null,group:o.group||"",status:(w||(a.muc&&u))?apf.xmpp.TYPE_AVAILABLE:apf.xmpp.TYPE_UNAVAILABLE});}else{this.update(apf.extend(m,o));}if(u&&m&&!m.isRoom&&!m.resources.contains(u)){m.resources.push(u);m.fullJID=n+"/"+u;}return m;};this.update=function(m,n){if(!m.xml){var o=(m.node==this.username&&m.domain==this.domain&&(!a.muc||m.resources.contains(this.resource)));l.push(m);if(m.isRoom){j.push(m);}if(c&&(a.roster||a.muc)){m.xml=c.data.ownerDocument.createElement(o?"account":m.isRoom?"room":"user");this.updateEntityXml(m);apf.xmldb.appendChild((m.room&&!m.isRoom)?this.getEntity(m.node,m.domain,null,true).xml:c.data,m.xml);}}if(typeof n!="undefined"){m.status=n;}return this.updateEntityXml(m);};this.updateEntityXml=function(m){if(!m||!m.xml){return null;}for(var n in i){if(typeof m[n]!="undefined"){m.xml.setAttribute(n,m[n]);}}if(a.muc){m.xml.setAttribute("name",m.isRoom?m.subscription:m.resources[m.resources.length-1]);if(!m.isRoom&&m.room){m.xml.setAttribute("room",m.room);}}apf.xmldb.applyChanges("synchronize",m.xml);return m;};this.updateMessageHistory=function(t,q){if(!c||!(a.chat||a.muc)){return false;}var n,m;if(a.muc){m=this.getEntityByJID(t.replace(/\/.*$/,""));}n=this.getEntityByJID(t);if(!n||!n.xml){return false;}var o=c.data.ownerDocument,s=o.createElement("message");s.setAttribute("from",t);s.appendChild(o.createTextNode(q));apf.xmldb.appendChild((m?m.xml:n.xml),s);apf.xmldb.applyChanges("synchronize",n.xml);return !(n.node==this.username&&n.domain==this.domain);};this.getLastAvailableEntity=function(){for(var m=l.length-1;m>=0;m--){if(l[m].status!==apf.xmpp.TYPE_UNAVAILABLE){return l[m];}}return null;};this.getRooms=function(){return j;};this.getAllEntities=function(t,q){if(typeof t!="string"){return l;}var s=[],n=0,m=l.length;for(;n<m;n++){if(!q&&l[n].bareJID==this.bareJID){continue;}if(l[n].status==t){s.push(l[n]);}}return s;};this.reset=function(){if(c){c.reset();}l=[];j=[];this.username=this.domain=this.fullJID="";};this.sanitizeJID=function(m){return m.replace(/[\"\s\&\\\/\:<>]+/,"");};};apf.video.TypeQTCompat=(function(){var u=null;var d="qt_event_source";var m=true;function s(){return apf.isIE?'<object id="'+d+'" classid="clsid:CB927D12-4FF7-4a9e-A169-56E4B8A75598"               codebase="http://www.apple.com/qtactivex/qtplugin.cab#version=7,3,0,0"></object>':"";}function o(J,E){var F=false;var G=document.getElementsByTagName("object");for(var D=0,I;I=G[D];D++){if(I.getAttribute("classid")=="clsid:CB927D12-4FF7-4a9e-A169-56E4B8A75598"){if(I.getAttribute("id")==d){F=false;}break;}}return F;}function B(){var D=false;if(m&&apf.isIE&&!o()){D=true;}return D;}function w(G,D,E){var F;F=u[G+D];if(null==F){F=u[D];}if(null!=F){if(0==D.indexOf(G)&&(null==E)){E=D.substring(G.length);}if(null==E){E=D;}return" "+E+'="'+F+'"';}else{return"";}}function A(D,E){if(0==D.indexOf("emb#")){return"";}if(0==D.indexOf("obj#")&&(null==E)){E=D.substring(4);}return w("obj#",D,E);}function C(D,E){if(0==D.indexOf("obj#")){return"";}if(0==D.indexOf("emb#")&&(null==E)){E=D.substring(4);}return w("emb#",D,E);}function n(D,G){var I;var F="";var E=(G)?" />":">";if(-1==D.indexOf("emb#")){I=u["obj#"+D];if(null==I){I=u[D];}if(0==D.indexOf("obj#")){D=D.substring(4);}if(null!=I){F='<param name="'+D+'" value="'+I+'"'+E;}}return F;}function j(){for(var D=0;D<arguments.length;D++){var E=arguments[D];delete u[E];delete u["emb#"+E];delete u["obj#"+E];}}function t(E,F,J){u={src:J[0],width:J[1],height:J[2],classid:"clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B",pluginspage:"http://www.apple.com/quicktime/download/"};var D=J[3];if((null==D)||(""==D)){D="7,3,0,0";}u.codebase="http://www.apple.com/qtactivex/qtplugin.cab#version="+D;var K,I;for(var N=4;N<J.length;N+=2){K=J[N].toLowerCase();I=J[N+1];u[K]=I;if(("postdomevents"==K)&&(I.toLowerCase()!="false")){m=true;if(apf.isIE){u["obj#style"]="behavior:url(#"+d+")";}}}var M=["<object ",A("classid"),A("width"),A("height"),A("codebase"),A("name"),A("id"),A("tabindex"),A("hspace"),A("vspace"),A("border"),A("align"),A("class"),A("title"),A("accesskey"),A("noexternaldata"),A("obj#style"),">",n("src",F)];var G=["<embed ",C("src"),C("width"),C("height"),C("pluginspage"),C("name"),C("id"),C("align"),C("tabindex")];j("src","width","height","pluginspage","classid","codebase","name","tabindex","hspace","vspace","border","align","noexternaldata","class","title","accesskey","id","style");for(var K in u){I=u[K];if(null!=I){G.push(C(K));M.push(n(K,F));}}return M.join("")+G.join("")+"></embed></object>";}function i(){var D=t("QT_GenerateOBJECTText_XHTML",true,arguments);if(B()){D=s()+D;}return D;}function c(){var D=false;if(navigator.plugins&&navigator.plugins.length){for(var G=0;G<navigator.plugins.length;G++){var F=navigator.plugins[G];if(F.name.indexOf("QuickTime")>-1){D=true;}}}else{var E=false;execScript('on error resume next: qtObj = IsObject(CreateObject("QuickTimeCheckObject.QuickTimeCheck.1"))',"VBScript");D=E;}return D;}function q(){var F="0";if(navigator.plugins&&navigator.plugins.length){for(var I=0;I<navigator.plugins.length;I++){var G=navigator.plugins[I];var J=G.name.match(/quicktime\D*([\.\d]*)/i);if(J&&J[1]){F=J[1];}}}else{var D=null;execScript('on error resume next: ieQTVersion = CreateObject("QuickTimeCheckObject.QuickTimeCheck.1").QuickTimeVersion',"VBScript");if(D){var E="";F=(D).toString(16)/1000000+"";E+=parseInt(F)+".";E+=((parseFloat(F)-parseInt(F))*1000)/100+"";F=E;}}return F;}function l(G,E){function I(K,N){var M=parseInt(K[0],10);if(isNaN(M)){M=0;}var J=parseInt(N[0],10);if(isNaN(J)){J=0;}if(M===J){if(K.length>1){return I(K.slice(1),N.slice(1));}else{return true;}}else{return(M<J);}}var F=G.split(/\./);var D=E?E.split(/\./):q().split(/\./);return I(F,D);}var z={};function a(D){if(typeof D=="undefined"){D="7.2.1";}if(typeof z[D]=="undefined"){z[D]=c()&&l(D);}return z[D];}return{generateOBJECTText:i,isAvailable:a};})();apf.video.TypeQT=function(c,i,d){this.oVideo=c;this.name="QT_"+this.oVideo.$uniqueId;this.htmlElement=i;this.videoWidth=this.videoHeight=this.totalTime=this.bytesLoaded=this.totalBytes=0;this.state=null;this.autoPlay=this.autoLoad=this.showControls=true;this.volume=50;this.mimeType="video/quicktime";this.firstLoad=true;this.pluginError=false;this.pollTimer=null;this.videoPath=d.src;this.player=null;apf.extend(this,apf.video.TypeInterface);this.setOptions(d);var a=this;window.setTimeout(function(){a.oVideo.$initHook({state:1});},1);};apf.video.TypeQT.isSupported=function(){return apf.video.TypeQTCompat.isAvailable();};apf.video.TypeQT.prototype={load:function(a){this.videoPath=a.splitSafe(",")[this.oVideo.$lastMimeType]||a;return this.$draw().attachEvents();},play:function(){if(this.player){try{this.player.Play();if(apf.isIE){this.handleEvent({type:"qt_play"});}}catch(a){this.oVideo.$stateChangeHook({type:"stateChange",state:"connectionError"});}}return this;},pause:function(){if(this.player){try{this.player.Stop();if(apf.isIE){this.handleEvent({type:"qt_pause"});}}catch(a){this.oVideo.$stateChangeHook({type:"stateChange",state:"connectionError"});}}return this;},stop:function(){return this.pause();},seek:function(c){if(!this.player){return;}try{this.player.SetTime(c);}catch(a){this.oVideo.$stateChangeHook({type:"stateChange",state:"connectionError"});}return this;},setVolume:function(a){if(this.player){try{this.player.SetVolume(Math.round((a/100)*256));}catch(c){this.oVideo.$stateChangeHook({type:"stateChange",state:"connectionError"});}}return this;},getTotalTime:function(){if(!this.player){return 0;}return this.player.GetDuration();},$draw:function(){if(this.player){this.stopPlayPoll();delete this.player;this.player=null;}this.htmlElement.innerHTML=apf.video.TypeQTCompat.generateOBJECTText(this.videoPath,"100%","100%","","autoplay",apf.isIE?"false":this.autoPlay.toString(),"controller",this.showControls.toString(),"kioskmode","true","showlogo","true","bgcolor","black","scale","aspect","align","middle","EnableJavaScript","True","postdomevents","True","target","myself","cache","false","qtsrcdontusebrowser","true","type",this.mimeType.splitSafe(",")[this.oVideo.$lastMimeType]||this.mimeType,"obj#id",this.name,"emb#NAME",this.name,"emb#id",this.name+"emb");this.player=document[this.name];return this;},events:["qt_begin","qt_abort","qt_canplay","qt_canplaythrough","qt_durationchange","qt_ended","qt_error","qt_load","qt_loadedfirstframe","qt_loadedmetadata","qt_pause","qt_play","qt_progress","qt_stalled","qt_timechanged","qt_volumechange","qt_waiting"],attachEvents:function(){var c=document.getElementById(this.name);if(!c){c=document.getElementById(this.name+"emb");}var a=this;function d(l){if(!l){l=window.event;}a.handleEvent(l);}var i=c.addEventListener?"addEventListener":"attachEvent";var j=c.addEventListener?"":"on";this.events.forEach(function(l){c[i](j+l,d,false);});if(apf.isIE&&this.autoPlay){this.handleEvent({type:"qt_play"});}return this;},handleEvent:function(a){switch(a.type){case"qt_play":this.oVideo.$stateChangeHook({type:"stateChange",state:"playing"});this.startPlayPoll();break;case"qt_pause":this.oVideo.$stateChangeHook({type:"stateChange",state:"paused"});this.stopPlayPoll();break;case"qt_volumechange":this.oVideo.$changeHook({type:"change",volume:Math.round((this.player.GetVolume()/256)*100)});break;case"qt_timechanged":this.oVideo.$changeHook({type:"change",playheadTime:this.player.GetTime()});break;case"qt_stalled":this.oVideo.$completeHook({type:"complete"});this.stopPlayPoll();break;case"qt_canplay":this.oVideo.$readyHook({type:"ready"});break;case"qt_load":case"qt_canplaythrough":this.oVideo.setProperty("readyState",apf.Media.HAVE_ENOUGH_DATA);if(this.autoPlay&&apf.isIE){this.player.Play();}break;}return this;},startPlayPoll:function(){clearTimeout(this.pollTimer);var a=this;this.pollTimer=$setTimeout(function(){if(!a.player){return;}try{a.handleEvent({type:"qt_timechanged"});var c=a.player.GetMaxBytesLoaded();var i=a.player.GetMovieSize();a.oVideo.$progressHook({bytesLoaded:c,totalBytes:i});if(!a.oVideo.ready&&Math.abs(c-i)<=20){a.handleEvent({type:"qt_load"});}}catch(d){}a.startPlayPoll();},100);return this;},stopPlayPoll:function(){clearTimeout(this.pollTimer);return this;},$destroy:function(){this.stopPlayPoll();if(this.player){try{this.player.Stop();}catch(a){}this.player=null;delete this.player;}this.oVideo=this.htmlElement=null;delete this.oVideo;delete this.htmlElement;}};apf.video.TypeWmpCompat=(function(){var i=false;function d(){var u=false,s=false;if(apf.isWin&&apf.isIE){var o;try{o=new ActiveXObject("MediaPlayer.MediaPlayer.1");i=true;u=true;}catch(t){i=false;u=false;}if(i){try{o=new ActiveXObject("WMPlayer.OCX");s=true;}catch(t){s=false;}}}else{for(var q=0,n=navigator.plugins.length;q<n;q++){if(navigator.plugins[q].name.indexOf("Windows Media Player")!=-1){i=true;u=true;s=true;o={versionInfo:"7.3"};}}}var m;if(s){m=o.versionInfo;o=null;}else{m="6.4";}return parseFloat(m);}function c(m,n){if(!m||!n){return"";}return'<param name="'+m+'" value="'+n+'" />';}function a(w,q,s,m,u){u.URL=q;u.src=q;u.SendPlayStateChangeEvents="true";u.StretchToFit="true";var o=['<object id="',w,'" width="',s,'" height="',m,'"             classid="clsid:6BF52A52-394A-11d3-B153-00C04F79FAA6"             type="application/x-oleobject">'];var n=['<embed id="',w,'emb" width="',s,'" height="',m,'"'];for(var t in u){if(!t||!u[t]){continue;}o.push('<param name="',t,'" value="',u[t],'" />');n.push(" ",t,'="',u[t],'"');}return o.join("")+n.join("")+" /></object>";}var l=null;function j(){if(l===null){l=d()>=7&&i;}return l;}return{isAvailable:j,generateOBJECTText:a};})();apf.video.TypeWmp=function(c,i,d){this.oVideo=c;this.name="WMP_"+this.oVideo.$uniqueId;this.htmlElement=i;this.player=this.pollTimer=null;this.volume=50;this.videoPath=d.src;apf.extend(this,apf.video.TypeInterface);this.setOptions(d);var a=this;window.setTimeout(function(){a.oVideo.$initHook({state:1});},1);};apf.video.TypeWmp.isSupported=function(){return apf.video.TypeWmpCompat.isAvailable();};apf.video.TypeWmp.prototype={load:function(a){this.videoPath=a.splitSafe(",")[this.oVideo.$lastMimeType]||a;return this.$draw();},play:function(){if(this.player){this.player.controls.play();}return this;},pause:function(){if(this.player){this.player.controls.pause();}return this;},stop:function(){if(this.player){this.player.controls.stop();}return this;},seek:function(a){if(this.player){this.player.controls.pause();this.player.controls.currentPosition=a/1000;if(!this.oVideo.paused){this.player.controls.play();}}return this;},fullscreen:function(a){this.player.fullscreen=a?true:false;},setVolume:function(a){if(this.player){this.player.settings.volume=a;}return this;},getTotalTime:function(){if(!this.player){return 0;}return Math.round(this.player.controls.currentItem.duration*1000);},$draw:function(){if(this.player){this.stopPlayPoll();delete this.player;this.player=null;}var c=this.name+"_Player";this.htmlElement.innerHTML=apf.video.TypeWmpCompat.generateOBJECTText(c,this.videoPath,"100%","100%",{AutoStart:this.autoPlay.toString(),uiMode:this.showControls?"mini":"none",PlayCount:1});this.player=this.getElement(c);var a=this;try{this.player[window.addEventListener?"addEventListener":"attachEvent"]("PlayStateChange",function(i){a.handleEvent(i);});}catch(d){this.player.onplaystatechange=function(i){a.handleEvent(i);};}return this;},handleEvent:function(a){switch(a){case 1:case 8:this.oVideo.$completeHook({type:"complete"});this.stopPlayPoll();break;case 2:this.oVideo.$stateChangeHook({type:"stateChange",state:"paused"});this.stopPlayPoll();break;case 3:this.oVideo.$stateChangeHook({type:"stateChange",state:"playing"});if(!this.oVideo.ready){this.oVideo.setProperty("readyState",apf.Media.HAVE_ENOUGH_DATA);}this.startPlayPoll();break;case 10:this.oVideo.$stateChangeHook({type:"ready"});break;case 4:case 5:case 6:case 7:case 9:case 11:break;}return this;},startPlayPoll:function(){clearTimeout(this.pollTimer);var a=this;this.pollTimer=$setTimeout(function(){if(!a.player||!a.player.controls){return;}a.oVideo.$changeHook({type:"change",playheadTime:Math.round(a.player.controls.currentPosition*1000)});a.startPlayPoll();},200);return this;},stopPlayPoll:function(){clearTimeout(this.pollTimer);return this;},$destroy:function(){this.stopPlayPoll();if(this.player){try{this.player.controls.stop();}catch(a){}this.player=null;delete this.player;}this.htmlElement.innerHTML="";this.oVideo=this.htmlElement=null;delete this.oVideo;delete this.htmlElement;}};apf.video.TypeSilverlight=function(a,d,c){this.oVideo=a;if(!apf.video.TypeSilverlight.INITED){apf.silverlight.startup();apf.video.TypeSilverlight.INITED=true;}this.DEFAULT_PLAYER=(apf.config.resourcePath||apf.basePath)+"resources/wmvplayer.xaml";this.htmlElement=d;this.options={backgroundcolor:"000000",windowless:"false",file:"",image:"",backcolor:"000000",frontcolor:"FFFFFF",lightcolor:"FFFFFF",screencolor:"FFFFFF",width:"100%",height:"100%",logo:"",overstretch:"true",shownavigation:"false",showstop:"false",showdigits:"true",usefullscreen:"true",usemute:"false",autostart:"true",bufferlength:"3",duration:"0",repeat:"false",sender:"",start:"0",volume:"90",link:"",linkfromdisplay:"false",linktarget:"_self"};this.options.file=c.src;for(var i in this.options){if(c[i]!=undefined){if(i.indexOf("color")>0){this.options[i]=c[i].substr(c[i].length-6);}else{this.options[i]=c[i];}}}apf.silverlight.createObjectEx({id:this.oVideo.$uniqueId+"_Player",source:this.DEFAULT_PLAYER,parentElement:d,properties:{width:"100%",height:"100%",version:"1.0",inplaceInstallPrompt:true,isWindowless:this.options.windowless,background:"#"+this.options.backgroundcolor},events:{onLoad:this.onLoadHandler,onError:apf.silverlight.default_error_handler},context:this});apf.layout.setRules(this.oVideo.$ext,this.oVideo.$uniqueId+"_silverlight","apf.all["+this.oVideo.$uniqueId+"].player.resizePlayer()");apf.layout.queue(this.oVideo.$ext);};apf.video.TypeSilverlight.isSupported=function(){return apf.silverlight.isAvailable("1.0");};apf.video.TypeSilverlight.INITED=false;apf.video.TypeSilverlight.prototype={load:function(a){this.video.Source=this.options.file;this.oVideo.$readyHook({type:"ready"});if(this.options.usemute=="true"){this.setVolume(0);}else{this.setVolume(this.options.volume);}if(this.options.autostart=="true"){this.play();}else{this.pause();}return this;},play:function(){if(this.state=="buffering"||this.state=="playing"){if(this.options.duration==0){this.stop();}else{this.pause();}}else{this.video.Visibility="Visible";this.preview.Visibility="Collapsed";if(this.state=="closed"){this.video.Source=this.options.file;}else{this.video.play();}}return this;},pause:function(){if(!this.video){return this;}this.video.pause();return this;},stop:function(){if(!this.video){return;}this.stopPlayPoll();this.video.Visibility="Collapsed";this.preview.Visibility="Visible";this.pause().seek(0);this.video.Source="null";return this;},seek:function(c){if(!this.video){return;}this.stopPlayPoll();if(c<2){c=0;}else{if(c>this.options.duration-4){c=this.options.duration-4;}}if(!isNaN(c)){try{this.video.Position=this.oVideo.getCounter(c,"%H:%M:%S");}catch(a){}}if(this.state=="buffering"||this.state=="playing"){this.play();}else{this.pause();}return this;},setVolume:function(a){if(!this.video){return;}this.video.Volume=a/100;return this;},getTotalTime:function(){if(!this.video){return 0;}return this.options.duration||0;},spanstring:function(a){var d=Math.floor(a/3600);var c=Math.floor(a%3600/60);var i=Math.round(a%60*10)/10;var j=d+":"+c+":"+i;return j;},onLoadHandler:function(d,a,c){a.options.sender=c;a.video=a.options.sender.findName("VideoWindow");a.preview=a.options.sender.findName("PlaceholderImage");var i={"true":"UniformToFill","false":"Uniform",fit:"Fill",none:"None"};a.state=a.video.CurrentState.toLowerCase();a.pollTimer;a.video.Stretch=i[a.options.overstretch];a.preview.Stretch=i[a.options.overstretch];a.display=c.findName("PlayerDisplay");a.display.Visibility="Visible";a.video.BufferingTime=a.spanstring(a.options.bufferlength);a.video.AutoPlay=true;a.video.AddEventListener("CurrentStateChanged",function(){a.handleState("CurrentStateChanged");});a.video.AddEventListener("MediaEnded",function(){a.handleState("MediaEnded");});a.video.AddEventListener("DownloadProgressChanged",function(j){a.oVideo.$progressHook({bytesLoaded:Math.round(j.downloadProgress*100),totalBytes:100});});if(a.options.image!=""){a.preview.Source=a.options.image;}a.resizePlayer();a.oVideo.$initHook({state:a.state});},handleState:function(c){var a=this.video.CurrentState.toLowerCase();if(c=="MediaEnded"){this.stopPlayPoll();this.oVideo.$changeHook({type:"change",playheadTime:Math.round(this.video.Position.Seconds*1000)});if(this.options.repeat=="true"){this.seek(0).play();}else{this.state="completed";this.video.Visibility="Collapsed";this.preview.Visibility="Visible";this.seek(0).pause().oVideo.$completeHook({type:"complete"});}}else{if(a!=this.state){this.state=a;this.options.duration=Math.round(this.video.NaturalDuration.Seconds*1000);if(a!="playing"&&a!="buffering"&&a!="opening"){this.oVideo.$stateChangeHook({type:"stateChange",state:"paused"});this.stopPlayPoll();}else{this.oVideo.$stateChangeHook({type:"stateChange",state:"playing"});this.startPlayPoll();}}}},startPlayPoll:function(){clearTimeout(this.pollTimer);var a=this;this.pollTimer=$setTimeout(function(){if(a.oVideo&&!a.oVideo.ready&&a.video.CanSeek){a.oVideo.setProperty("readyState",apf.Media.HAVE_ENOUGH_DATA);}a.oVideo.$changeHook({type:"change",playheadTime:Math.round(a.video.Position.Seconds*1000)});a.startPlayPoll();},100);return this;},stopPlayPoll:function(){clearTimeout(this.pollTimer);return this;},resizePlayer:function(){var i=this.options.sender;if(!i){return;}var d=this.display.getHost().content;var c=d.actualWidth;var a=d.actualHeight;this.stretchElement("PlayerDisplay",c,a).stretchElement("VideoWindow",c,a).stretchElement("PlaceholderImage",c,a).centerElement("BufferIcon",c,a).centerElement("BufferText",c,a);this.display.findName("OverlayCanvas")["Canvas.Left"]=c-this.display.findName("OverlayCanvas").Width-10;this.display.Visibility="Visible";return this;},centerElement:function(c,a,d){var i=this.options.sender.findName(c);i["Canvas.Left"]=Math.round(a/2-i.Width/2);i["Canvas.Top"]=Math.round(d/2-i.Height/2);return this;},stretchElement:function(c,a,d){var i=this.options.sender.findName(c);i.Width=a;if(d!=undefined){i.Height=d;}return this;},$destroy:function(){apf.layout.removeRule(this.oVideo.$ext,this.oVideo.$uniqueId+"_silverlight");this.stopPlayPoll();if(this.player){this.player=this.video=this.preview=null;delete this.player;delete this.video;delete this.preview;}this.htmlElement.innerHTML="";this.oVideo=this.htmlElement=null;delete this.oVideo;delete this.htmlElement;}};apf.video.TypeNative=function(a,d,c){this.oVideo=a;this.inited=false;this.divName=a.$uniqueId;this.htmlElement=d;this.name="soundmgr_"+a.$uniqueId;this.videoPath=c.src;this.paused=false;this.player=null;apf.extend(this,apf.video.TypeInterface);this.setOptions(c).createPlayer();};apf.video.TypeNative.isSupported=function(){return apf.hasVideo;};apf.video.TypeNative.prototype={load:function(c,a){if(a!=null){this.setTotalTime(a);}if(c!=null){this.videoPath=c;}if(this.videoPath==null&&!this.firstLoad){return this.oVideo.$errorHook({type:"error",error:"SoundManager::play - No videoPath has been set."});}if(c==null&&this.firstLoad&&!this.autoLoad){c=this.videoPath;}this.firstLoad=false;this.setVolume(this.volume);return this;},play:function(){if(!this.paused){return this.player.play();}return this.pause();},pause:function(){return this.player.pause();},stop:function(){return this.player.stop();},seek:function(a){return this.player.currentTime=parseInt(a)/1000;},setVolume:function(a){this.player.volume=parseInt(a)/100;return this;},getPlayheadTime:function(){return this.player.playheadTime;},setPlayheadTime:function(a){this.playheadTime=parseInt(a);return this;},getTotalTime:function(){return this.totalTime;},setTotalTime:function(a){this.totalTime=parseInt(a);return this;},event:function(c,a){switch(c){case"progress":this.bytesLoaded=a.bytesLoaded;this.totalBytes=a.totalBytes;this.oVideo.$progressHook({type:"progress",bytesLoaded:this.bytesLoaded,totalBytes:this.totalBytes});break;case"playheadUpdate":this.playheadTime=a.playheadTime;this.totalTime=a.totalTime;this.oVideo.$changeHook({type:"change",playheadTime:this.playheadTime,totalTime:this.totalTime});if(a.waveData||a.peakData||a.eqData){this.oVideo.$metadataHook({type:"metadata",waveData:a.waveData,peakData:a.peakData,eqData:a.eqData});}break;case"stateChange":this.state=a.state;this.oVideo.$stateChangeHook({type:"stateChange",state:this.state});break;case"change":this.oVideo.$changeHook({type:"change"});break;case"complete":this.oVideo.$completeHook({type:"complete"});break;case"ready":if(this.paused&&this.autoPlay){this.paused=false;}this.oVideo.$readyHook({type:"ready"});break;case"metaData":this.oVideo.$metadataHook({type:"metaData",infoObject:a});break;case"cuePoint":this.oVideo.$cuePointHook({type:"cuePoint",infoObject:a});break;case"init":this.inited=true;this.oVideo.$initHook(apf.extend(a,apf.flash.getSandbox(a.sandboxType)));break;case"id3":this.oVideo.$metadataHook({type:"metadata",id3Data:a});break;case"debug":apf.console.log(">> SWF DBUG: "+a.msg);break;}},createPlayer:function(){var j=this.htmlElement;if(j==null){return this;}var d=this.player=document.createElement("video");d.setAttribute("src",this.videoPath);d.setAttribute("volume",this.volume);if(this.autoPlay){d.setAttribute("autoplay","true");}j.appendChild(d);var c=this,i;d.addEventListener("canplay",function(){c.oVideo.$readyHook({type:"ready"});},false);d.addEventListener("timeupdate",i=function(a){c.playheadTime=parseInt(c.player.currentTime||0)*1000;c.totalTime=parseInt(c.player.duration)*1000;c.oVideo.$changeHook({type:"change",playheadTime:c.playheadTime,totalTime:c.totalTime});},false);d.addEventListener("duration",i,false);d.addEventListener("volumechange",function(){c.oVideo.$changeHook({type:"change",volume:c.player.muted?0:parseInt(c.player.volume)*100});},false);d.addEventListener("progress",function(a){c.bytesLoaded=a.loaded;c.totalBytes=a.total;c.oVideo.$progressHook({type:"progress",bytesLoaded:c.bytesLoaded,totalBytes:c.totalBytes});},false);d.addEventListener("ended",function(){c.oVideo.$completeHook({type:"complete"});},false);d.addEventListener("error",function(a){throw new Error(apf.formatErrorString(0,c,"Audio playback",a.message,c.oVideo));},false);d.load();return this;},$destroy:function(){if(!this.player){return;}this.player.setAttribute("src","");delete this.player;this.player=null;}};apf.video.TypeFlv=function(a,d,c){this.oVideo=a;this.DEFAULT_SWF_PATH=(apf.config.resourcePath||apf.basePath)+"resources/FAVideo.swf";this.id=apf.flash.addPlayer(this);this.inited=false;this.resizeTimer=null;this.divName=this.oVideo.$uniqueId;this.htmlElement=d;this.name="FAVideo_"+this.oVideo.$uniqueId;this.videoPath=c.src;this.width="100%";this.height="100%";this.player=null;apf.extend(this,apf.video.TypeInterface);this.initProperties().setOptions(c).createPlayer();};apf.video.TypeFlv.isSupported=function(){return apf.flash.isAvailable();};apf.video.TypeFlv.prototype={load:function(c,a){c=c.splitSafe(",")[this.oVideo.$lastMimeType]||c;if(a!=null){this.setTotalTime(a);}if(c!=null){this.videoPath=c;}if(this.videoPath==null&&!this.firstLoad){return this.oVideo.$errorHook({type:"error",error:"FAVideo::play - No videoPath has been set."});}if(c==null&&this.firstLoad&&!this.autoLoad){c=this.videoPath;}this.firstLoad=false;if(this.autoPlay){this.callMethod("playVideo",c,a);}else{this.callMethod("loadVideo",this.videoPath);}return this;},play:function(){return this.pause(false);},pause:function(a){if(typeof a=="undefined"){a=true;}this.callMethod("pause",a);return this;},stop:function(){this.callMethod("stop");return this;},seek:function(a){this.callMethod("seek",a/1000);return this;},setVolume:function(a){this.callMethod("setVolume",a);return this;},onResize:function(){clearTimeout(this.resizeTimer);var a=this;this.resizeTimer=window.setTimeout(function(){a.setSize();},20);},setSize:function(){this.callMethod("setSize",this.htmlElement.offsetWidth,this.htmlElement.offsetHeight);return this;},getPlayheadTime:function(){return this.playheadTime;},setPlayheadTime:function(a){return this.setProperty("playheadTime",a);},getTotalTime:function(){return this.totalTime;},setTotalTime:function(a){return this.setProperty("totalTime",a);},callMethod:function(){if(!this.inited||!this.player||!this.player.callMethod){this.delayCalls.push(arguments);}else{var a=Array.prototype.slice.call(arguments);a.unshift(this.player,"callMethod");apf.flash.remote.apply(null,a);}return this;},makeDelayCalls:function(){for(var c=0,a=this.delayCalls.length;c<a;c++){this.callMethod.apply(this,this.delayCalls[c]);}return this;},update:function(a){for(var c in a){if(c.indexOf("Time")!=-1&&typeof a[c]=="number"){a[c]=a[c]*1000;}this[c]=a[c];}a.type="change";this.oVideo.$changeHook(a);},event:function(c,a){apf.console.log("[FLASH] video event: "+c+", "+a);switch(c){case"progress":this.bytesLoaded=a.bytesLoaded;this.totalBytes=a.bytesTotal;this.oVideo.$progressHook({type:"progress",bytesLoaded:this.bytesLoaded,totalBytes:this.totalBytes});break;case"playheadUpdate":this.playheadTime=a.playheadTime*1000;this.totalTime=a.totalTime*1000;this.oVideo.$playheadUpdateHook({type:"playheadUpdate",playheadTime:this.playheadTime,totalTime:this.totalTime});break;case"stateChange":this.state=a.state;this.oVideo.$stateChangeHook({type:"stateChange",state:this.state});break;case"change":this.oVideo.$changeHook({type:"change"});break;case"complete":this.oVideo.$completeHook({type:"complete"});break;case"ready":this.oVideo.$readyHook({type:"ready"});break;case"metaData":this.oVideo.$metadataHook({type:"metadata",infoObject:a});break;case"cuePoint":this.oVideo.$cuePointHook({type:"cuePoint",infoObject:a});break;case"fullscreen":apf.console.log("fullscreen: ",a.state);this.oVideo.fullscreen=false;case"init":this.inited=true;this.invalidateProperty("clickToTogglePlay","skinVisible","skinAutoHide","autoPlay","autoLoad","volume","bufferTime","videoScaleMode","videoAlign","playheadUpdateInterval","previewImagePath").validateNow().makeDelayCalls();this.oVideo.$initHook({type:"init"});this.onResize();var d=this.oVideo.$int;$setTimeout(function(){apf.layout.forceResize(d);},1000);break;}},initProperties:function(){this.delayCalls=[];this.videoWidth=this.videoHeight=this.totalTime=this.bytesLoaded=this.totalBytes=0;this.state=null;this.clickToTogglePlay=this.autoPlay=this.autoLoad=this.skinVisible=true;this.volume=50;this.skinVisible=false;this.skinAutoHide=false;this.playheadTime=null;this.bufferTime=0.1;this.videoScaleMode="maintainAspectRatio";this.videoAlign="center";this.playheadUpdateInterval=1000;this.previewImagePath=this.themeColor=null;this.firstLoad=true;this.pluginError=false;this.properties=["volume","skinAutoHide","showControls","autoPlay","clickToTogglePlay","autoLoad","playHeadTime","totalTime","bufferTime","videoScaleMode","videoAlign","playheadUpdateInterval","previewImagePath"];apf.layout.setRules(this.oVideo.$ext,this.oVideo.$uniqueId+"_favideo","(apf.all["+this.oVideo.$uniqueId+"].player && apf.all["+this.oVideo.$uniqueId+"].player.onResize                 ? apf.all["+this.oVideo.$uniqueId+"].player                 : {onResize:apf.K}).onResize()");apf.layout.queue(this.oVideo.$ext);return this;},createPlayer:function(){if(this.htmlElement==null){return this;}this.pluginError=false;apf.flash.embed({context:this,htmlNode:this.htmlElement,property:"player",src:this.DEFAULT_SWF_PATH,width:"100%",height:"100%",align:"middle",id:this.name,quality:"high",bgcolor:"#000000",allowFullScreen:"true",name:this.name,flashvars:"playerID="+this.id+"&volume="+this.volume,allowScriptAccess:"always",type:"application/x-shockwave-flash",pluginspage:"http://www.adobe.com/go/getflashplayer",menu:"true"});return this;},invalidateProperty:function(){if(this.invalidProperties==null){this.invalidProperties={};}for(var a=0;a<arguments.length;a++){this.invalidProperties[arguments[a]]=true;}if(this.validateInterval==null&&this.inited){var c=this;this.validateInterval=$setTimeout(function(){c.validateNow();},100);}return this;},validateNow:function(){this.validateInterval=null;var a={};for(var c in this.invalidProperties){a[c]=this[c];}this.invalidProperties={};this.callMethod("update",a);return this;},setProperty:function(c,a){this[c]=a;if(this.inited){this.invalidateProperty(c);}return this;},$destroy:function(){if(apf.layout){apf.layout.removeRule(this.oVideo.$ext,this.oVideo.$uniqueId+"_favideo");}if(this.player){try{this.stop();}catch(a){}this.player=null;delete this.player;}this.htmlElement.innerHTML="";this.oVideo=this.htmlElement=null;delete this.oVideo;delete this.htmlElement;}};apf.LiveMarkupPi=function(){this.$init();};(function(){this.mainBind="data";this.implement(apf.StandardBinding);this.getDocument=function(){return this.$data&&this.$data.ownerDocument;};this.clear=function(a){if(a=="loading"&&apf.getInheritedAttribute(this,"loading-message")){this.$propHandlers.calcdata.call(this,"<div class='loading'>Loading...</div>");this.calcdata="";}};this.$propHandlers.calcdata=function(d){if(this.$data){var a=this.$data.childNodes;for(var c=a.length-1;c>=0;c--){a[c].destroy(true);}}if(d&&d.indexOf("<a:")>-1){this.$int.innerHTML="";this.$data=this.ownerDocument.$domParser.parseFromString("<a:application xmlns:a='"+apf.ns.apf+"'>"+d+"</a:application>","text/xml",{htmlNode:this.$int}).documentElement;}else{if(this.$data){var a=this.$data.childNodes;for(var c=0;c<a.length;c++){a[c].destroy(true);}}this.$int.innerHTML=d||"";}};}).call(apf.LiveMarkupPi.prototype=new apf.AmlProcessingInstruction(true));apf.aml.setProcessingInstruction("lm",apf.LiveMarkupPi);apf.aml.setProcessingInstruction("livemarkup",apf.LiveMarkupPi);apf.LiveTextPi=function(){this.$init();};(function(){this.mainBind="data";this.implement(apf.StandardBinding);this.$propHandlers.calcdata=function(a){this.$int.innerHTML=a&&apf.htmlentities(a)||"";};}).call(apf.LiveTextPi.prototype=new apf.AmlProcessingInstruction(true));apf.aml.setProcessingInstruction("lt",apf.LiveTextPi);apf.aml.setProcessingInstruction("livetext",apf.LiveTextPi);if(document.all){var oldWinError=window.onerror;window.onerror=function(a){apf.console.error("Error caught from early startup. Might be a html parser syntax error (not your fault). "+a);if(!arguments.caller){return true;}};}apf.Init.addConditional(function(){if(document.all){window.onerror=oldWinError;}apf.dispatchEvent("domready");},null,["body","class"]);apf.addDomLoadEvent(function(){apf.Init.run("body");});apf.start();